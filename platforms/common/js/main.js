(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/fields/index.js":[function(require,module,exports){
"use strict";
var ready      = require('elements/domready'),
    $          = require('elements/attributes'),
    storage    = require('prime/map'),
    deepEquals = require('mout/lang/deepEquals'),
    invoke     = require('mout/array/invoke'),
    History    = require('../utils/history');


var originals, collectFieldsValues = function() {
    var map = new storage();

    var fields = $('.settings-block [name]');
    if (!fields) { return false; }

    fields.forEach(function(field) {
        field = $(field);
        map.set(field.attribute('name'), field.value());
    }, this);

    return map;
};

ready(function() {
    var body = $('body'), compare = {
        single: function(){},
        whole: function(){}
    };

    originals = collectFieldsValues();

    compare.single = function(event, element) {
        var parent = element.parent('.settings-param') || element.parent('h4'),
            target = parent ? (parent.matches('h4') ? parent : parent.find('.settings-param-title')) : null,
            isOverride = parent ? parent.find('.settings-param-toggle') : false;

        if (!parent) { return; }

        if (!target || !originals || originals.get(element.attribute('name')) == null) { return; }
        if (originals.get(element.attribute('name')) !== element.value()) {
            if (isOverride && event.forceOverride && !isOverride.checked()) { isOverride[0].click(); }
            target.showIndicator('changes-indicator font-small fa fa-circle-o fa-fw');
        } else {
            if (isOverride && event.forceOverride  && isOverride.checked()) { isOverride[0].click(); }
            target.hideIndicator();
        }

        compare.whole();
    };

    compare.whole = function() {
        var equals = deepEquals(originals, collectFieldsValues()),
            save = $('[data-save]');

        if (!save) { return; }

        save[equals ? 'hideIndicator' : 'showIndicator']('changes-indicator fa fa-circle-o fa-fw');
    };

    body.delegate('input', '.settings-block input[name][type="text"], .settings-block textarea[name]', compare.single);
    body.delegate('change', '.settings-block input[name][type="hidden"], .settings-block input[name][type="checkbox"], .settings-block select[name]', compare.single);

    body.on('statechangeEnd', function() {
        var State = History.getState();
        body.emit('updateOriginalFields');
    });

    body.on('updateOriginalFields', function(){
        originals = collectFieldsValues();
    });
});

module.exports = {};

},{"../utils/history":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/history.js","elements/attributes":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/attributes.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","mout/array/invoke":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/invoke.js","mout/lang/deepEquals":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepEquals.js","prime/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/map.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/atom.js":[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    $          = require('elements'),
    Base       = require('./base'),
    zen        = require('elements/zen'),
    getAjaxURL = require('../../utils/get-ajax-url').config;

var Atom = new prime({
    inherits: Base,
    options: {
        type: 'atom'
    },

    constructor: function(options) {
        Base.call(this, options);

        this.on('changed', this.hasChanged);
    },

    updateTitle: function(title) {
        this.block.find('.title').text(title);
        this.setTitle(title);
        return this;
    },

    layout: function() {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId()),
            subtype      = this.getSubType() ? 'data-lm-blocksubtype="' + this.getSubType() + '"' : '';
        return '<div class="' + this.getType() + '" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '" ' + subtype + '><span><span class="title">' + this.getTitle() + '</span><span class="font-small">' + (this.getSubType() || this.getKey() || this.getType()) + '</span></span><div class="float-right"><i class="fa fa-cog" data-lm-nodrag data-lm-nodrag data-lm-settings="' + settings_uri + '"></i></div></div>';
    },

    hasChanged: function(state, parent) {
        var icon = this.block.find('span > i.changes-indicator:first-child');

        // if the particle has changes but the parent block doesn't, we want to keep the indicator showing
        if (icon && parent && !parent.changeState) { return; }

        this.block[state ? 'addClass' : 'removeClass']('block-has-changes');

        if (!state && icon) { icon.remove(); }
        if (state && !icon) { zen('i.fa.fa-circle-o.changes-indicator').before(this.block.find('.title')); }
    },

    onRendered: function(element, parent) {
        var globally_disabled = $('[data-lm-disabled][data-lm-subtype="' + this.getSubType() + '"]');

        if (globally_disabled || this.getAttribute('enabled') === 0) { this.disable(); }
    }
});

module.exports = Atom;

},{"../../utils/get-ajax-url":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-url.js","./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/base.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/atoms.js":[function(require,module,exports){
"use strict";
var prime   = require('prime'),
    Section = require('./section');

var Atoms = new prime({
    inherits: Section,
    options: {
        type: 'atoms',
        attributes: {
            name: "Atoms Section"
        }
    },

    layout: function() {
        return '<div class="atoms-section" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '"><div class="section-header clearfix"><h4 class="float-left">' + (this.getAttribute('name')) + '</h4></div></div>';
    },

    getId: function() {
        return this.id || (this.id = this.options.type);
    },

    onDone: function(event) {
        if (!this.block.search('[data-lm-id]')) {
            this.grid.insert(this.block, 'bottom');
            this.options.builder.add(this.grid);
        }
    }
});

module.exports = Atoms;

},{"./section":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/section.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/base.js":[function(require,module,exports){
"use strict";
var prime   = require('prime'),
    Options = require('prime-util/prime/options'),
    Bound    = require('prime-util/prime/bound'),
    Emitter = require('prime/emitter'),
    guid    = require('mout/random/guid'),
    zen     = require('elements/zen'),
    $       = require('elements'),

    get     = require('mout/object/get'),
    has     = require('mout/object/has'),
    set     = require('mout/object/set');

require('elements/traversal');

var Base = new prime({
    mixin: [Bound, Options],
    inherits: Emitter,
    options: {
        subtype: false,
        attributes: {}
    },
    constructor: function(options) {
        this.setOptions(options);
        this.fresh = !this.options.id;
        this.id = this.options.id || this.guid();
        this.attributes = this.options.attributes || {};

        this.block = zen('div').html(this.layout()).firstChild();

        this.on('rendered', this.bound('onRendered'));

        return this;
    },

    guid: function() {
        return guid();
    },

    getId: function() {
        return this.id || (this.id = this.guid());
    },

    getType: function() {
        return this.options.type || '';
    },

    getSubType: function() {
        return this.options.subtype || '';
    },

    getTitle: function() {
        return this.options.title || 'Untitled';
    },

    setTitle: function(title) {
        this.options.title = title || 'Untitled';
        return this;
    },

    getKey: function() {
        return '';
    },

    getPageId: function() {
        var root = $('[data-lm-root]');
        if (!root) return 'data-root-not-found';

        return root.data('lm-page');
    },

    getAttribute: function(key) {
        return get(this.attributes, key);
    },

    getAttributes: function() {
        return this.attributes || {};
    },

    updateTitle: function() {
        return this;
    },

    setAttribute: function(key, value) {
        set(this.attributes, key, value);
        return this;
    },

    setAttributes: function(attributes) {
        this.attributes = attributes;

        return this;
    },

    hasAttribute: function(key) {
        return has(this.attributes, key);
    },

    disable: function() {
        this.block.attribute('title', 'This particle has been disabled and it won\'t be rendered on front-end. You can still configure, move and delete.');
        this.block.addClass('particle-disabled');
    },

    enable: function() {
        this.block.attribute('title', null);
        this.block.removeClass('particle-disabled');
    },

    insert: function(target, location) {
        this.block[location || 'after'](target);
        return this;
    },

    adopt: function(element) {
        element.insert(this.block);
        return this;
    },

    isNew: function(fresh) {
        if (typeof fresh !== 'undefined') {
            this.fresh = !!fresh;
        }
        return this.fresh;
    },

    dropzone: function() {
        return 'data-lm-dropzone';
    },

    addDropzone: function(){
        this.block.data('lm-dropzone', true);
    },

    removeDropzone: function(){
        this.block.data('lm-dropzone', null);
    },

    layout: function() {},

    onRendered: function(){},

    setLayout: function(layout) {
        this.block = layout;
        return this;
    }
});

module.exports = Base;

},{"elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/traversal":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/traversal.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/object/get":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js","mout/object/has":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/has.js","mout/object/set":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/set.js","mout/random/guid":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/guid.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/block.js":[function(require,module,exports){
"use strict";
var prime     = require('prime'),
    Base      = require('./base'),
    $         = require('../../utils/elements.utils'),
    zen       = require('elements/zen'),
    precision = require('mout/number/enforcePrecision'),
    bind      = require('mout/function/bind');

var Block = new prime({
    inherits: Base,
    options: {
        type: 'block',
        attributes: {
            size: 100
        }
    },

    constructor: function(options) {
        Base.call(this, options);

        this.on('changed', this.hasChanged);
    },

    getSize: function() {
        return this.getAttribute('size');
    },

    setSize: function(size, store) {
        size = typeof size === 'undefined' ? this.getSize() : Math.max(0, Math.min(100, parseFloat(size)));
        if (store) {
            this.setAttribute('size', size);
        }

        $(this.block).style({
            flex: '0 1 ' + size + '%',
            '-webkit-flex': '0 1 ' + size + '%',
            '-ms-flex': '0 1 ' + size + '%'
        });

        this.emit('resized', size, this);
    },

    setAnimatedSize: function(size, store) {
        size = typeof size === 'undefined' ? this.getSize() : Math.max(0, Math.min(100, parseFloat(size)));
        if (store) {
            this.setAttribute('size', size);
        }
        $(this.block).animate({
            flex: '0 1 ' + size + '%',
            '-webkit-flex': '0 1 ' + size + '%',
            '-ms-flex': '0 1 ' + size + '%'
        }, bind(function() {
            this.block.attribute('style', null);
            this.setSize(size);
        }, this));

        this.emit('resized', size, this);
    },

    setLabelSize: function(size) {
        var label = this.block.find('> .particle-size');
        if (!label) { return false; }

        label.text(precision(size, 1) + '%');
    },

    layout: function() {
        return '<div class="g-block" data-lm-id="' + this.getId() + '"' + this.dropzone() + ' data-lm-blocktype="block"></div>';
    },

    onRendered: function(element, parent) {
        if (element.block.find('> [data-lm-blocktype="section"]')) {
            this.removeDropzone();
        }

        if (!parent) { return; }

        var grandpa = parent.block.parent();
        if (grandpa.data('lm-root') || (grandpa.data('lm-blocktype') == 'container' && grandpa.parent().data('lm-root'))) {
            zen('span.particle-size').text(this.getSize() + '%').top(element.block);
            element.on('resized', this.bound('onResize'));
        }
    },

    onResize: function(resize) {
        this.setLabelSize(resize);
    },

    hasChanged: function(state) {
        var icon,
            child = this.block.find('> [data-lm-id]:not([data-lm-blocktype="section"]):not([data-lm-blocktype="container"])');

        this.changeState = state;

        if (!child) {
            child = this.block.find('> .particle-size');
            icon = child.find('i:first-child');

            if (!state && icon) { icon.remove(); }
            if (state && !icon) { zen('i.fa.fa-circle-o.changes-indicator').top(child); }

            return;
        }

        this.options.builder.get(child.data('lm-id')).emit('changed', state, this);
    }
});

module.exports = Block;

},{"../../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/base.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/number/enforcePrecision":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/enforcePrecision.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/container.js":[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    Base       = require('./base'),
    $          = require('elements');

var Container = new prime({
    inherits: Base,
    options: {
        type: 'container'
    },

    constructor: function(options) {
        Base.call(this, options);
    },

    layout: function() {
        return '<div class="g-lm-container" data-lm-id="' + this.getId() + '" data-lm-blocktype="container"></div>';
    }
});

module.exports = Container;

},{"./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/base.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/grid.js":[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    Base       = require('./base'),
    $          = require('elements'),
    getAjaxURL = require('../../utils/get-ajax-url').config;

var Grid = new prime({
    inherits: Base,
    options: {
        type: 'grid'
    },

    constructor: function(options) {
        Base.call(this, options);

        this.on('changed', this.hasChanged);
    },

    layout: function() {
        return '<div class="g-grid nowrap" data-lm-id="' + this.getId() + '" ' + this.dropzone() + '  data-lm-samewidth data-lm-blocktype="grid"></div>';
    },

    onRendered: function() {
        var parent = this.block.parent();
        if (parent && parent.data('lm-root') || (parent.data('lm-blocktype') == 'container' && parent.parent().data('lm-root'))) {
            this.removeDropzone();
        }
    },

    hasChanged: function(state) {
        // Grids don't have room for an indicator so we forward it to the parent Section
        var parent = this.block.parent('[data-lm-blocktype="section"]'),
            id = parent ? parent.data('lm-id') : false;

        this.changeState = state;

        if (!parent || !id) { return; }

        if (this.options.builder) { this.options.builder.get(id).emit('changed', state, this); }
    }
});

module.exports = Grid;

},{"../../utils/get-ajax-url":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-url.js","./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/base.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/index.js":[function(require,module,exports){
module.exports = {
    base: require('./base'),
    atom: require('./atom'),
    section: require('./section'),
    offcanvas: require('./offcanvas'),
    atoms: require('./atoms'),
    grid: require('./grid'),
    container: require('./container'),
    block: require('./block'),
    particle: require('./particle'),
    position: require('./position'),
    pagecontent: require('./pagecontent'),
    spacer: require('./spacer')
};

},{"./atom":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/atom.js","./atoms":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/atoms.js","./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/base.js","./block":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/block.js","./container":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/container.js","./grid":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/grid.js","./offcanvas":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/offcanvas.js","./pagecontent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/pagecontent.js","./particle":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/particle.js","./position":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/position.js","./section":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/section.js","./spacer":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/spacer.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/offcanvas.js":[function(require,module,exports){
"use strict";
var prime   = require('prime'),
    Section = require('./section'),

    getAjaxURL = require('../../utils/get-ajax-url').config;

var Offcanvas = new prime({
    inherits: Section,
    options: {
        type: 'offcanvas',
        attributes: {
            name: "Offcanvas Section"
        }
    },

    layout: function() {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId());
        return '<div class="offcanvas-section" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '"><div class="section-header clearfix"><h4 class="float-left">' + (this.getAttribute('name')) + '</h4><div class="section-actions float-right"><span class="g-tooltip g-tooltip-right" data-title="Adds a new row in the offcanvas"><i class="fa fa-plus"></i></span> <span class="g-tooltip g-tooltip-right" data-title="Offcanvas settings"><i class="fa fa-cog" data-lm-settings="' + settings_uri + '"></i></span></div></div></div>';
    },

    getId: function() {
        return this.id || (this.id = this.options.type);
    }
});

module.exports = Offcanvas;

},{"../../utils/get-ajax-url":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-url.js","./section":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/section.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/pagecontent.js":[function(require,module,exports){
"use strict";
var prime    = require('prime'),
    Particle = require('./particle');

var Pagecontent = new prime({
    inherits: Particle,
    options: {
        type: 'pagecontent',
        title: 'Page Content',
        attributes: {}
    }
});

module.exports = Pagecontent;

},{"./particle":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/particle.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/particle.js":[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    $          = require('elements'),
    Atom       = require('./atom'),
    bind       = require('mout/function/bind'),
    precision  = require('mout/number/enforcePrecision'),
    getAjaxURL = require('../../utils/get-ajax-url').config;

var UID = 0;

var Particle = new prime({
    inherits: Atom,
    options: {
        type: 'particle'
    },

    constructor: function(options) {
        ++UID;
        Atom.call(this, options);
    },

    layout: function() {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId()),
            subtype      = this.getSubType() ? 'data-lm-blocksubtype="' + this.getSubType() + '"' : '';

        return '<div class="' + this.getType() + '" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '" ' + subtype + '><span><span class="title">' + this.getTitle() + '</span><span class="font-small">' + (this.getKey() || this.getSubType() || this.getType()) + '</span></span><div class="float-right"><span class="particle-size"></span> <i class="fa fa-cog" data-lm-nodrag data-lm-settings="' + settings_uri + '"></i></div></div>';
    },

    setLabelSize: function(size) {
        var label = this.block.find('.particle-size');
        if (!label) { return false; }

        label.text(precision(size, 1) + '%');
    },

    onRendered: function(element, parent) {
        var size              = parent.getSize() || 100,
            globally_disabled = $('[data-lm-disabled][data-lm-subtype="' + this.getSubType() + '"]');

        if (globally_disabled || this.getAttribute('enabled') === 0) { this.disable(); }

        this.setLabelSize(size);
        parent.on('resized', this.bound('onParentResize'));
    },

    onParentResize: function(resize) {
        this.setLabelSize(resize);
    }
});

module.exports = Particle;

},{"../../utils/get-ajax-url":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-url.js","./atom":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/atom.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/number/enforcePrecision":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/enforcePrecision.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/position.js":[function(require,module,exports){
"use strict";
var prime    = require('prime'),
    trim     = require('mout/string/trim'),
    Particle = require('./particle');

var UID = 0;

var Position = new prime({
    inherits: Particle,
    options: {
        type: 'position'
    },

    constructor: function(options) {
        ++UID;
        Particle.call(this, options);
        this.setAttribute('title', this.getTitle());
        this.setAttribute('key', this.getKey());

        if (this.isNew()) { --UID; }
    },

    getTitle: function() {
        return (this.options.title || 'Position ' + UID);
    },

    getKey: function() {
        return (this.getAttribute('key') || trim(this.getTitle()).replace(/\s/g, '-').toLowerCase());
    },

    updateKey: function(key) {
        this.options.key = key || this.getKey();
        this.block.find('.font-small').text(this.getKey());
        return this;
    },
});

module.exports = Position;

},{"./particle":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/particle.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/section.js":[function(require,module,exports){
"use strict";
var prime = require('prime'),
    Base  = require('./base'),
    Bound = require('prime-util/prime/bound'),
    Grid  = require('./grid'),
    $     = require('elements'),
    zen   = require('elements/zen'),

    bind  = require('mout/function/bind'),
    getAjaxURL = require('../../utils/get-ajax-url').config;

require('elements/insertion');

var UID = 0;

var Section = new prime({
    inherits: Base,
    options: {},

    constructor: function(options) {
        ++UID;
        this.grid = new Grid();
        Base.call(this, options);

        this.on('done', this.bound('onDone'));
        this.on('changed', this.hasChanged);
    },

    layout: function() {
        var settings_uri = getAjaxURL(this.getPageId() + '/layout/' + this.getType() + '/' + this.getId());

        return '<div class="section" data-lm-id="' + this.getId() + '" data-lm-blocktype="' + this.getType() + '"><div class="section-header clearfix"><h4 class="float-left">' + (this.getTitle()) + '</h4><div class="section-actions float-right"><span class="g-tooltip g-tooltip-right" data-title="Adds a new row in the section"><i class="fa fa-plus"></i></span> <span class="g-tooltip g-tooltip-right" data-title="Section settings"><i class="fa fa-cog" data-lm-settings="' + settings_uri + '"></i></span></div></div></div>';
    },

    adopt: function(child) {
        $(child).insert(this.block.find('.g-grid'));
    },

    hasChanged: function(state, child) {
        var icon = this.block.find('h4 > i:first-child');

        // if the the event is triggered from a grid we need to be cautious not to override the proper state
        if (icon && child && !child.changeState) { return; }

        this.block[state ? 'addClass' : 'removeClass']('block-has-changes');

        if (!state && icon) { icon.remove(); }
        if (state && !icon) { zen('i.fa.fa-circle-o.changes-indicator').top(this.block.find('h4')); }
    },

    onDone: function(event) {
        if (!this.block.search('[data-lm-id]')) {
            this.grid.insert(this.block, 'bottom');
            this.options.builder.add(this.grid);
        }

        var plus = this.block.find('.fa-plus');
        if (plus) {
            plus.on('click', bind(function(e) {
                if (e) { e.preventDefault(); }

                if (this.block.find('.g-grid:last-child:empty')) { return false; }

                this.grid = new Grid();
                this.grid.insert(this.block.find('[data-lm-blocktype="container"]') ? this.block.find('[data-lm-blocktype="container"]') : this.block, 'bottom');
                this.options.builder.add(this.grid);
            }, this));
        }
    }
});

module.exports = Section;

},{"../../utils/get-ajax-url":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-url.js","./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/base.js","./grid":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/grid.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/insertion":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/insertion.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/spacer.js":[function(require,module,exports){
"use strict";
var prime    = require('prime'),
    Particle = require('./particle');

var UID = 0;

var Spacer = new prime({
    inherits: Particle,
    options: {
        type: 'spacer',
        title: 'Spacer',
        attributes: {}
    }
});

module.exports = Spacer;

},{"./particle":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/particle.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/builder.js":[function(require,module,exports){
"use strict";
var prime   = require('prime'),
    $       = require('elements'),
    Emitter = require('prime/emitter');

var Blocks = require('./blocks/');

var forOwn     = require('mout/object/forOwn'),
    forEach    = require('mout/collection/forEach'),
    size       = require('mout/collection/size'),
    isArray    = require('mout/lang/isArray'),
    flatten    = require('mout/array/flatten'),
    guid       = require('mout/random/guid'),

    set        = require('mout/object/set'),
    unset      = require('mout/object/unset'),
    get        = require('mout/object/get'),
    deepFillIn = require('mout/object/deepFillIn'),
    omit       = require('mout/object/omit');

require('elements/attributes');
require('elements/traversal');


// start Debug
var rpad   = require('mout/string/rpad'),
    repeat = require('mout/string/repeat');
// end   Debug

$.implement({
    empty: function() {
        return this.forEach(function(node) {
            var first;
            while ((first = node.firstChild)) {
                node.removeChild(first);
            }
        });
    }
});

var Builder = new prime({

    inherits: Emitter,

    constructor: function(structure) {
        if (structure) {
            this.setStructure(structure);
        }
        this.map = {};

        return this;
    },

    setStructure: function(structure) {
        try {
            this.structure = (typeof structure === 'object') ? structure : JSON.parse(structure);
        }
        catch (e) {
            console.error("Parsing error:", e);
        }
    },

    add: function(block) {
        var id = typeof block === 'string' ? block : block.id;
        set(this.map, id, block);
        block.isNew(false);
    },

    remove: function(block) {
        block = typeof block === 'string' ? block : block.id;
        unset(this.map, block);
    },

    get: function(block) {
        var id = typeof block === 'string' ? block : block.id;
        return get(this.map, id, block);
    },

    load: function(data) {
        this.recursiveLoad(data);
        this.emit('loaded', data);

        return this;
    },

    serialize: function(root, flat) {
        var serieChildren = [];
        root = root || $('[data-lm-root]');

        if (!root) { return; }

        var blocks = root.search((!flat ? '> ' : '') + '[data-lm-id]'),
            id, type, subtype, serial, hasChildren, children;

        forEach(blocks, function(element) {
            element = $(element);
            id = element.data('lm-id');
            type = element.data('lm-blocktype');
            subtype = element.data('lm-blocksubtype') || false;
            hasChildren = element.search('> [data-lm-id]');

            if (flat) {
                children = hasChildren ? hasChildren.map(function(element){ return $(element).data('lm-id'); }) : false;
            } else {
                children = hasChildren ? this.serialize(element) : [];
            }

            serial = {
                id: id,
                type: type,
                subtype: subtype,
                title: get(this.map, id) ? get(this.map, id).getTitle() : 'Untitled',
                attributes: get(this.map, id) ? get(this.map, id).getAttributes() : {},
                children: children
            };

            if (flat) {
                var obj = {}; obj[id] = serial;
                serial = obj;
            }

            serieChildren.push(serial);
        }, this);

        return serieChildren;
    },

    insert: function(key, value, parent/*, object*/) {
        var root = $('[data-lm-root]');
        if (!root) {
            return;
        }

        if (!Blocks[value.type]) {
            console[console.error ? 'error' : 'log'](value.type + ' does not exist');
        }

        var Element = new (Blocks[value.type] || Blocks['section'])(deepFillIn({
            id: key,
            attributes: {},
            subtype: value.subtype || false,
            builder: this
        }, omit(value, 'children')));

        if (!parent) {
            Element.block.insert(root);
        }
        else {
            Element.block.insert($('[data-lm-id="' + parent + '"]'));
        }

        if (Element.getType() === 'block') {
            Element.setSize();
        }

        this.add(Element);
        Element.emit('rendered', Element, parent ? get(this.map, parent) : null);

        return Element;
    },

    reset: function(data) {
        this.map = {};
        this.setStructure(data || {});
        $('[data-lm-root]').empty();
        this.load();
    },

    cleanupLonely: function() {
        var ghosts = [],
            parent, children = $('[data-lm-root] > .g-section > .g-grid > .g-block .g-grid > .g-block, [data-lm-root] > .g-section > .g-grid > .g-block > .g-block');

        if (!children) {
            return;
        }


        var isGrid;
        children.forEach(function(child) {
            child = $(child);
            parent = null;
            isGrid = child.parent().hasClass('g-grid');

            if (isGrid && child.siblings()) {
                return false;
            }

            if (isGrid) {
                ghosts.push(child.data('lm-id'));
                parent = child.parent();
            }

            ghosts.push(child.data('lm-id'));
            child.children().before(parent ? parent : child);
            (parent ? parent : child).remove();
        });

        return ghosts;
    },

    recursiveLoad: function(data, callback, depth, parent) {
        data = data || this.structure;
        depth = depth || 0;
        parent = parent || false;
        callback = callback || this.insert;

        forEach(data, function(value/*, key, object*/) {

            if (!value.id) {
                value.id = guid();
            }

            // debug (flat view of the structure)
            if (console && console.log) {
                console.log(rpad(repeat('    ', depth) + '' + value.type, 35) + ' (' + rpad(value.id, 36) + ') parent: ' + parent);
            }

            this.emit('loading', callback.call(this, value.id, value, parent, depth));
            if (value.children && size(value.children)) {
                depth++;

                forEach(value.children, function(childValue/*, childKey, array*/) {
                    this.recursiveLoad([childValue], callback, depth, value.id);
                }, this);
            }

            this.get(value.id).emit('done', this.get(value.id));

            depth--;
        }, this);
    }
});

module.exports = Builder;

},{"./blocks/":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/index.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/attributes":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/attributes.js","elements/traversal":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/traversal.js","mout/array/flatten":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/flatten.js","mout/collection/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/forEach.js","mout/collection/size":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/size.js","mout/lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","mout/object/deepFillIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/deepFillIn.js","mout/object/forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js","mout/object/get":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js","mout/object/omit":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/omit.js","mout/object/set":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/set.js","mout/object/unset":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/unset.js","mout/random/guid":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/guid.js","mout/string/repeat":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/repeat.js","mout/string/rpad":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/rpad.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/drag.resizer.js":[function(require,module,exports){
"use strict";
var DragEvents = require('../ui/drag.events'),
    prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    bind       = require('mout/function/bind'),
    isString   = require('mout/lang/isString'),
    nMap       = require('mout/math/map'),
    clamp      = require('mout/math/clamp'),
    precision  = require('mout/number/enforcePrecision'),
    get        = require('mout/object/get'),
    $          = require('../utils/elements.utils');

require('elements/events');
require('elements/delegation');

var Resizer = new prime({
    mixin: [Bound, Options],
    DRAG_EVENTS: DragEvents,
    options: {
        minSize: 5
    },
    constructor: function(container, options) {
        this.setOptions(options);
        this.history = this.options.history || {};
        this.builder = this.options.builder || {};
        this.origin = {
            x: 0,
            y: 0,
            transform: null,
            offset: {
                x: 0,
                y: 0
            }
        };
    },

    getBlock: function(element) {
        return get(this.builder.map, isString(element) ? element : $(element).data('lm-id') || '');
    },

    getAttribute: function(element, prop) {
        return this.getBlock(element).getAttribute(prop);
    },

    getSize: function(element) {
        return this.getAttribute($(element), 'size');
    },

    start: function(event, element, siblings, offset) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }
        
        if (element.LMTooltip) { element.LMTooltip.remove(); }
        if (event.which && event.which !== 1) { return true; }

        // Stops text selection
        event.preventDefault();

        this.element = $(element);
        this.siblings = {
            occupied: 0,
            elements: siblings,
            next: this.element.nextSibling(),
            prevs: this.element.previousSiblings(),
            sizeBefore: 0
        };

        if (this.siblings.elements.length > 1) {
            this.siblings.occupied -= this.getSize(this.siblings.next);
            this.siblings.elements.forEach(function(sibling) {
                this.siblings.occupied += this.getSize(sibling);
            }, this);
        }

        if (this.siblings.prevs) {
            this.siblings.prevs.forEach(function(sibling) {
                this.siblings.sizeBefore += this.getSize(sibling);
            }, this);
        }

        this.origin = {
            size: this.getSize(this.element),
            maxSize: this.getSize(this.element) + this.getSize(this.siblings.next),
            x: event.changedTouches ? event.changedTouches[0].pageX : event.pageX + 6,
            y: event.changedTouches ? event.changedTouches[0].pageY : event.pageY
        };

        var clientRect = this.element[0].getBoundingClientRect(),
            parentRect = this.element.parent()[0].getBoundingClientRect();

        this.origin.offset = {
            clientRect: clientRect,
            parentRect: {left: parentRect.left, right: parentRect.right},
            x: this.origin.x - clientRect.right,
            y: clientRect.top - this.origin.y,
            down: offset
        };

        this.origin.offset.parentRect.left = this.element.parent().find('> [data-lm-id]:first-child')[0].getBoundingClientRect().left;
        this.origin.offset.parentRect.right = this.element.parent().find('> [data-lm-id]:last-child')[0].getBoundingClientRect().right;

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).on(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).on(event, this.bound('stop'));
        }, this));
    },

    move: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        var clientX = event.clientX || event.touches[0].clientX || 0,
            clientY = event.clientY || event.touches[0].clientY || 0,
            parentRect = this.origin.offset.parentRect;

        var deltaX = (this.lastX || clientX) - clientX,
            deltaY = (this.lastY || clientY) - clientY;

        this.direction =
            Math.abs(deltaX) > Math.abs(deltaY) && deltaX > 0 && 'left' ||
            Math.abs(deltaX) > Math.abs(deltaY) && deltaX < 0 && 'right' ||
            Math.abs(deltaY) > Math.abs(deltaX) && deltaY > 0 && 'up' ||
                                                                 'down';
        var size,
            diff = 100 - this.siblings.occupied,
            value = clientX + (!this.siblings.prevs ? this.origin.offset.x - this.origin.offset.down : this.siblings.prevs.length),
            normalized = clamp(value, parentRect.left, parentRect.right);

        size = nMap(normalized, parentRect.left, parentRect.right, 0, 100);
        size = size - this.siblings.sizeBefore;
        size = precision(clamp(size, this.options.minSize, this.origin.maxSize - this.options.minSize), 0);

        //grids?
        //console.log((size / 12) * (100 / 12));

        diff = precision(diff - size, 0);

        this.getBlock(this.element).setSize(size, true);
        this.getBlock(this.siblings.next).setSize(diff, true);

        // Hack to handle cases where size is not an integer
        var siblings = this.element.siblings(),
            amount = siblings ? siblings.length + 1 : 1;
        if (amount == 3 || amount == 6 || amount == 7 || amount == 8 || amount == 9 || amount == 11 || amount == 12) {
            var total = 0, blocks;

            blocks = $([siblings, this.element]);
            blocks.forEach(function(block, index){
                block = this.getBlock(block);
                size = block.getSize();
                if (size % 1) {
                    size = precision(100 / amount, 0);
                    block.setSize(size, true);
                }

                total += size;

                if (blocks.length == index + 1 && total != 100) {
                    diff = 100 - total;
                    block.setSize(size + diff, true);
                }

            }, this);
        }

        this.lastX = clientX;
        this.lastY = clientY;
    },

    stop: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).off(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).off(event, this.bound('move'));
        }, this));

        if (this.origin.size !== this.getSize(this.element)) { this.history.push(this.builder.serialize()); }
    },

    evenResize: function(elements, animated) {
        var total = elements.length,
            size = precision(100 / total, 4),
            block;

        if (typeof animated === 'undefined') { animated = true; }

        elements.forEach(function(element) {
            element = $(element);
            block = this.getBlock(element);
            if (block && block.hasAttribute('size')) {
                block[animated ? 'setAnimatedSize' : 'setSize'](size, size !== block.getSize());
            } else {
                if (element) { element[animated ? 'animate' : 'style']({ flex: '0 1 ' + size + '%' }); }
            }
        }, this);
    }
});

module.exports = Resizer;

},{"../ui/drag.events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/drag.events.js","../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","elements/delegation":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/delegation.js","elements/events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/events.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/lang/isString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isString.js","mout/math/clamp":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/clamp.js","mout/math/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/map.js","mout/number/enforcePrecision":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/enforcePrecision.js","mout/object/get":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/eraser.js":[function(require,module,exports){
"use strict";
var prime     = require('prime'),
    $         = require('../utils/elements.utils'),
    Emitter   = require('prime/emitter'),
    Bound     = require('prime-util/prime/bound'),
    Options   = require('prime-util/prime/options');


var Eraser = new prime({
    mixin: [Options, Bound],

    inherits: Emitter,

    constructor: function(element, options){
        this.setOptions(options);

        this.element = $(element);

        if (!this.element) { return; }
        this.hide(true);
    },

    show: function(fast){
        this.out();
        this.element[fast ? 'style' : 'animate']({top: 0}, {duration: '150ms'});
    },

    hide: function(fast){
        var top = {top: -(this.element[0].offsetHeight)};
        this.out();
        this.element[fast ? 'style' : 'animate'](top, {duration: '150ms'});
    },

    over: function(){
        this.element.find('.trash-zone').animate({transform: 'scale(1.2)'}, {duration: '150ms', equation: 'cubic-bezier(0.5,0,0.5,1)'});
    },

    out: function(){
        this.element.find('.trash-zone').animate({transform: 'scale(1)'}, {duration: '150ms', equation: 'cubic-bezier(0.5,0,0.5,1)'});
    }
});

module.exports = Eraser;

},{"../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/history.js":[function(require,module,exports){
var prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    slice      = require('mout/array/slice'),
    merge      = require('mout/object/merge'),
    deepEquals = require('mout/lang/deepEquals');

var History = new prime({

    inherits: Emitter,

    constructor: function(session) {
        this.index = 0;
        session = merge({}, session);
        this.setSession(session);
    },

    undo: function() {
        if (!this.index) return;
        this.index--;

        var session = this.get();
        this.emit('undo', session, this.index);
        return session;
    },

    redo: function() {
        if (this.index == this.session.length - 1) return;
        this.index++;

        var session = this.get();
        this.emit('redo', session, this.index);
        return session;
    },

    reset: function() {
        this.index = 0;

        var session = this.get();
        this.emit('reset', session, this.index);
        return session;
    },

    push: function(session) {
        session = merge({}, session);
        var sliced = this.index < this.session.length - 1;
        if (this.index < this.session.length - 1) this.session = slice(this.session, 0, -(this.session.length - 1 - this.index));
        session = {
            time: +(new Date()),
            data: session
        };

        if (this.equals(session.data)) { return session; }

        this.session.push(session);
        this.index = this.session.length - 1;

        this.emit('push', session, this.index, sliced);
        return session;
    },

    get: function(index) {
        return this.session[index || this.index] || false;
    },

    equals: function(session, compare) {
        if (!compare) { compare = this.get().data; }

        return deepEquals(session, compare);
    },

    setSession: function(session) {
        session = !session ? []
            : [{
            time: +(new Date()),
            data: merge({}, session)
        }];

        this.session = session;
        this.index = 0;
        return this.session;
    },

    import: function() {},
    export: function() {}
});

module.exports = History;

},{"mout/array/slice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js","mout/lang/deepEquals":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepEquals.js","mout/object/merge":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/index.js":[function(require,module,exports){
"use strict";
var ready         = require('elements/domready'),
    //json          = require('./json_test'), // debug
    $             = require('elements/attributes'),
    modal         = require('../ui').modal,
    toastr        = require('../ui').toastr,
    request       = require('agent'),
    zen           = require('elements/zen'),
    contains      = require('mout/array/contains'),
    size          = require('mout/collection/size'),
    trim          = require('mout/string/trim'),
    forEach       = require('mout/collection/forEach'),

    getAjaxSuffix = require('../utils/get-ajax-suffix'),

    Builder       = require('./builder'),
    History       = require('../utils/history'),
    LMHistory     = require('./history'),
    LayoutManager = require('./layoutmanager'),
    SaveState     = require('../utils/save-state');

require('../ui/popover');

var builder, layoutmanager, lmhistory, savestate;


builder = new Builder();
lmhistory = new LMHistory();
savestate = new SaveState();

ready(function() {
    var body = $('body');

    body.delegate('click', '[data-lm-back]', function(e, element) {
        if (e) { e.preventDefault(); }
        if ($(element).hasClass('disabled')) return false;
        lmhistory.undo();
    });

    body.delegate('click', '[data-lm-forward]', function(e, element) {
        if (e) { e.preventDefault(); }
        if ($(element).hasClass('disabled')) return false;
        lmhistory.redo();
    });

    /* lmhistory events */
    lmhistory.on('push', function(session, index, reset) {
        var HM = {
            back: $('[data-lm-back]'),
            forward: $('[data-lm-forward]')
        };

        if (index && HM.back.hasClass('disabled')) HM.back.removeClass('disabled');
        if (reset && !HM.forward.hasClass('disabled')) HM.forward.addClass('disabled');
        layoutmanager.updatePendingChanges();
    });

    lmhistory.on('undo', function(session, index) {
        var notice = $('#lm-no-layout'),
            HM     = {
                back: $('[data-lm-back]'),
                forward: $('[data-lm-forward]')
            };

        if (notice) { notice.style({ display: !size(session.data) ? 'block' : 'none' }); }

        builder.reset(session.data);
        HM.forward.removeClass('disabled');
        if (!index) HM.back.addClass('disabled');
        layoutmanager.singles('disable');
        layoutmanager.updatePendingChanges();
    });
    lmhistory.on('redo', function(session, index) {
        var notice = $('#lm-no-layout'),
            HM     = {
                back: $('[data-lm-back]'),
                forward: $('[data-lm-forward]')
            };

        if (notice) { notice.style({ display: !size(session.data) ? 'block' : 'none' }); }

        builder.reset(session.data);
        HM.back.removeClass('disabled');
        if (index == this.session.length - 1) HM.forward.addClass('disabled');
        layoutmanager.singles('disable');
        layoutmanager.updatePendingChanges();
    });

});

ready(function() {
    var body = $('body'), root = $('[data-lm-root]'), data;

    // Layout Manager
    layoutmanager = new LayoutManager('body', {
        delegate: '[data-lm-root] .g-grid > .g-block > [data-lm-blocktype]:not([data-lm-nodrag]) !> .g-block, .g5-lm-particles-picker [data-lm-blocktype], [data-lm-root] [data-lm-blocktype="section"] > [data-lm-blocktype="grid"]:not(:empty):not(.no-move):not([data-lm-nodrag]), [data-lm-root] [data-lm-blocktype="section"] > [data-lm-blocktype="container"] > [data-lm-blocktype="grid"]:not(:empty):not(.no-move):not([data-lm-nodrag])',
        droppables: '[data-lm-dropzone]',
        exclude: '.section-header .button, .lm-newblocks .float-right .button, [data-lm-nodrag]',
        resize_handles: '[data-lm-root] .g-grid > .g-block:not(:last-child)',
        builder: builder,
        history: lmhistory,
        savestate: savestate
    });

    module.exports.layoutmanager = layoutmanager;

    // load builder data
    if (root) {
        data = JSON.parse(root.data('lm-root'));
        if (data.name) { data = data.layout; }
        builder.setStructure(data);
        builder.load();

        layoutmanager.history.setSession(builder.serialize());
        layoutmanager.savestate.setSession(builder.serialize(null, true));
    }

    // attach events
    // Modal Tabs
    body.delegate('mousedown', '.g-tabs a', function(event, element) {
        element = $(element);
        event.preventDefault();

        var index  = 0,
            parent = element.parent('.g-tabs'),
            panes  = parent.siblings('.g-panes'),
            links  = parent.search('a');

        links.forEach(function(link, i) {
            if (link == element[0]) { index = i + 1; }
        });

        panes.find('.active').removeClass('active');
        parent.find('.active').removeClass('active');
        panes.find('.g-pane:nth-child(' + index + ')').addClass('active');
        parent.find('li:nth-child(' + index + ')').addClass('active');
    });

    // Picker
    body.delegate('statechangeBefore', '[data-g5-lm-picker]', function() {
        modal.close();
    });

    // Sub-navigation links
    body.delegate('statechangeAfter', '#navbar [data-g5-ajaxify]', function(event, element) {
        root = $('[data-lm-root]');
        if (!root) { return true; }
        data = JSON.parse(root.data('lm-root'));
        builder.setStructure(data);
        builder.load();

        layoutmanager.history.setSession(builder.serialize());
        layoutmanager.savestate.setSession(builder.serialize(null, true));

        // refresh LM eraser
        layoutmanager.eraser.element = $('[data-lm-eraseblock]');
        layoutmanager.eraser.hide();
    });

    // Particles filtering
    body.delegate('input', '.sidebar-block .search input', function(event, element) {
        var value = $(element).value().toLowerCase(),
            list  = $('.sidebar-block [data-lm-blocktype]'),
            text, type;
        if (!list) { return false; }

        list.style({ display: 'none' }).forEach(function(blocktype) {
            blocktype = $(blocktype);
            type = blocktype.data('lm-blocktype').toLowerCase();
            text = trim(blocktype.text()).toLowerCase();
            if (type.substr(0, value.length) == value || text.match(value)) {
                blocktype.style({ display: 'block' });
            }
        }, this);
    });

    // TODO: this was the + handler for new layouts which is now gone in favor of Configurations
    body.delegate('click', '[data-g5-lm-add]', function(event, element) {
        event.preventDefault();
        modal.open({
            content: 'Loading',
            remote: $(element).attribute('href') + getAjaxSuffix()
        });
    });

    // Grid same widths button (evenize, equalize)
    body.delegate('click', '[data-lm-samewidth]:not(:empty)', function(event, element) {
        if (element.LMTooltip) { element.LMTooltip.remove(); }
        var clientRect = element[0].getBoundingClientRect();
        if (event.clientX < clientRect.width + clientRect.left) { return; }

        var blocks = element.search('> [data-lm-blocktype="block"]'), id;
        if (!blocks || blocks.length == 1) { return; }

        blocks.forEach(function(block) {
            id = $(block).data('lm-id');
            builder.get(id).setSize(100 / blocks.length, true);
        });

        lmhistory.push(builder.serialize());
    });

    body.delegate('mouseover', '[data-lm-samewidth]:not(:empty)', function(event, element) {
        var clientRect = element[0].getBoundingClientRect(),
            clientX = event.clientX || (event.touches && event.touches[0].clientX) || 0,
            tooltips = {
                equalize: clientX + 5 > clientRect.width + clientRect.left,
                move: clientX - 5 < clientRect.left
            };

        if (!tooltips.equalize && !tooltips.move) { return; }

        var msg = tooltips.equalize ? 'Equalize the width the blocks in this grid' : 'Sort or Move the Grid',
            tooltip = zen('span.g-tooltip.g-tooltip-force[data-title="' + msg + '"]').top(element);

        if (tooltips.equalize) { tooltip.addClass('g-tooltip-right'); }
        tooltip.style({position: 'absolute', top: 26 }).style(tooltips.equalize ? 'right' : 'left', -30);

        element.LMTooltip = tooltip;
    });

    body.delegate('mouseout', '[data-lm-samewidth]:not(:empty)', function(event, element) {
        if (element.LMTooltip) { element.LMTooltip.remove(); }
    });

    // Clear Layout
    body.delegate('click', '[data-lm-clear]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        var type, child;
        forEach(builder.map, function(obj, id) {
            type = obj.getType();
            child = obj.block.find('> [data-lm-id]');
            if (child) { child = child.data('lm-blocktype'); }
            if (contains(['particle', 'grid', 'block'], type) && (type == 'block' && (child && (child !== 'section' && child !== 'container')))) {
                builder.remove(id);
                obj.block.remove();
            }
        }, this);

        layoutmanager.singles('cleanup', builder);

        lmhistory.push(builder.serialize());
    });

    // Switcher
    body.delegate('mouseover', '[data-lm-switcher]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        if (!element.PopoverDefined) {
            var popover = element.getPopover({
                type: 'async',
                url: element.data('lm-switcher') + getAjaxSuffix(),
                allowElementsClick: '.g-tabs a'
            });
        }
    });

    // Clear Layout
    body.delegate('mousedown', '[data-switch]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        // it's already loading something.
        if (element.parent('.g5-popover-content').find('[data-switch] i')) {
            return false;
        }

        element.showIndicator();

        request('get', element.data('switch') + getAjaxSuffix(), function(error, response) {
            element.hideIndicator();

            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });
                return;
            }

            var structure = response.body.data,
                notice    = $('#lm-no-layout');

            root.data('lm-root', JSON.stringify(structure)).empty();
            if (notice) { notice.style({ display: 'none' }); }
            builder.setStructure(structure);
            builder.load();

            lmhistory.push(builder.serialize());

            $('[data-lm-switcher]').getPopover().hide();
        });
    });

    // Particles settings
    body.delegate('click', '[data-lm-settings]', function(event, element) {
        element = $(element);

        var blocktype   = element.data('lm-blocktype'),
            settingsURL = element.data('lm-settings'),
            data        = null, parent;

        // grid is a special case, since relies on pseudo elements for sorting and same width (evenize)
        // we need to check where the user clicked.
        if (blocktype === 'grid') {
            var clientX   = event.clientX || (event.touches && event.touches[0].clientX) || 0,
                boundings = element[0].getBoundingClientRect();

            if (clientX + 4 - boundings.left < boundings.width) {
                return false;
            }
        }

        element = element.parent('[data-lm-blocktype]');
        parent = element.parent('[data-lm-blocktype]');
        blocktype = element.data('lm-blocktype');

        var ID       = element.data('lm-id'),
            parentID = parent ? parent.data('lm-id') : false;

        if (!contains(['block', 'grid'], blocktype)) {
            data = {};
            data.type = builder.get(element.data('lm-id')).getType() || element.data('lm-blocktype') || false;
            data.subtype = builder.get(element.data('lm-id')).getSubType() || element.data('lm-blocksubtype') || false;
            data.title = (element.find('h4') || element.find('.title')).text() || data.type || 'Untitled';
            data.options = builder.get(element.data('lm-id')).getAttributes() || {};
            data.block = parent ? builder.get(parent.data('lm-id')).getAttributes() || {} : {};

            if (!data.type) { delete data.type; }
            if (!data.subtype) { delete data.subtype; }
        }

        modal.open({
            content: 'Loading',
            method: 'post',
            data: data,
            remote: settingsURL + getAjaxSuffix(),
            remoteLoaded: function(response, content) {
                var form       = content.elements.content.find('form'),
                    submit     = content.elements.content.find('input[type="submit"], button[type="submit"]'),
                    dataString = [];

                if (!form || !submit) { return true; }

                // Particle Settings apply
                submit.on('click', function(e) {
                    e.preventDefault();
                    dataString = [];

                    submit.showIndicator();

                    $(form[0].elements).forEach(function(input) {
                        input = $(input);
                        var name     = input.attribute('name'),
                            value    = input.value(),
                            parent   = input.parent('.settings-param'),
                            override = parent ? parent.find('> input[type="checkbox"]') : null;

                        if (!name || input.disabled() || (override && !override.checked())) { return; }
                        dataString.push(name + '=' + encodeURIComponent(value));
                    });

                    var title = content.elements.content.find('[data-title-editable]');
                    if (title) {
                        dataString.push('title=' + encodeURIComponent(title.data('title-editable')));
                    }

                    request(form.attribute('method'), form.attribute('action') + getAjaxSuffix(), dataString.join('&') || {}, function(error, response) {
                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            var particle = builder.get(ID),
                                block    = null;

                            // particle attributes
                            particle.setAttributes(response.body.data.options);

                            if (particle.hasAttribute('enabled')) { particle[particle.getAttribute('enabled') ? 'enable' : 'disable'](); }

                            if (particle.getType() != 'section') {
                                particle.setTitle(response.body.data.title || 'Untitled');
                                particle.updateTitle(particle.getTitle());
                            }

                            if (particle.getType() == 'position') {
                                particle.updateKey();
                            }

                            // parent block attributes
                            if (response.body.data.block && size(response.body.data.block)) {
                                block = builder.get(parentID);

                                var sibling     = block.block.nextSibling() || block.block.previousSibling(),
                                    currentSize = block.getSize(),
                                    diffSize;

                                block.setAttributes(response.body.data.block);

                                diffSize = currentSize - block.getSize();

                                block.setAnimatedSize(block.getSize());

                                if (sibling) {
                                    sibling = builder.get(sibling.data('lm-id'));
                                    sibling.setAnimatedSize(parseFloat(sibling.getSize()) + diffSize, true);
                                }
                            }

                            lmhistory.push(builder.serialize());
                            modal.close();

                            toastr.success('The particle "' + particle.getTitle() + '" settings have been applied to the Layout. <br />Remember to click the Save button to store them.', 'Settings Applied');
                        }

                        submit.hideIndicator();
                    });
                });
            }
        });

    });

});

module.exports = {
    $: $,
    builder: builder,
    layoutmanager: layoutmanager,
    history: lmhistory,
    savestate: savestate
};
},{"../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../ui/popover":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/popover.js","../utils/get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","../utils/history":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/history.js","../utils/save-state":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/save-state.js","./builder":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/builder.js","./history":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/history.js","./layoutmanager":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/layoutmanager.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements/attributes":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/attributes.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","mout/collection/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/forEach.js","mout/collection/size":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/size.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/layoutmanager.js":[function(require,module,exports){
"use strict";
var prime      = require('prime'),
    $          = require('../utils/elements.utils'),
    zen        = require('elements/zen'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    Blocks     = require('./blocks'),
    DragDrop   = require('../ui/drag.drop'),
    Resizer    = require('./drag.resizer'),
    Eraser     = require('./eraser'),
    get        = require('mout/object/get'),
    keys       = require('mout/object/keys'),

    every      = require('mout/array/every'),
    precision  = require('mout/number/enforcePrecision'),
    isArray    = require('mout/lang/isArray'),
    deepEquals = require('mout/lang/deepEquals'),
    find       = require('mout/collection/find'),
    isObject   = require('mout/lang/isObject');

var singles = {
    disable: function() {
        var grids = $('[data-lm-root] [data-lm-blocktype="grid"]');
        if (grids) { grids.removeClass('no-hover'); }
    },
    enable: function() {
        var grids = $('[data-lm-root] [data-lm-blocktype="grid"]');
        if (grids) { grids.addClass('no-hover'); }
    },
    cleanup: function(builder, dropLast) {
        var emptyGrids = $('[data-lm-blocktype="section"] > .g-grid:empty, [data-lm-blocktype="container"] > .g-grid:empty');
        if (emptyGrids) {
            emptyGrids.forEach(function(grid) {
                grid = $(grid);
                // empty grids should go away unless they are last and/or dropLast is true
                if (grid.nextSibling('[data-lm-id]') || dropLast) {
                    builder.remove(grid.data('lm-id'));
                    grid.remove();
                }
            });
        }
    }

};

var LayoutManager = new prime({

    mixin: [Bound, Options],
    inherits: Emitter,

    constructor: function(element, options) {
        if (!element) { return; }
        this.dragdrop = new DragDrop(element, options);
        this.resizer = new Resizer(element, options);
        this.eraser = new Eraser('[data-lm-eraseblock]', options);
        this.dragdrop
            .on('dragdrop:start', this.bound('start'))
            .on('dragdrop:location', this.bound('location'))
            .on('dragdrop:nolocation', this.bound('nolocation'))
            .on('dragdrop:resize', this.bound('resize'))
            .on('dragdrop:stop:erase', this.bound('removeElement'))
            .on('dragdrop:stop', this.bound('stop'))
            .on('dragdrop:stop:animation', this.bound('stopAnimation'));

        this.builder = options.builder;
        this.history = options.history;
        this.savestate = options.savestate || null;

        singles.disable();
    },

    singles: function(mode, builder, dropLast) {
        singles[mode](builder, dropLast);
    },

    updatePendingChanges: function() {
        var saveData = this.savestate.getData(),
            serialData = this.builder.serialize(null, true),
            different = false,

            equals = deepEquals(saveData, serialData),
            save = $('[data-save="Layout"]'),
            icon = save.find('i'),
            indicator = save.find('.changes-indicator');

        if (equals && indicator) { save.hideIndicator(); }
        if (!equals && !indicator) { save.showIndicator('changes-indicator fa fa-fw fa-circle-o') }

        // Emits the changed event for all particles
        // Used for UI to show particles where there have been differences applied
        // After a saved state
        var saved, current, id;
        serialData.forEach(function(block){
            id = keys(block)[0];
            saved = find(saveData, function(data) { return data[id]; });
            current = find(serialData, function(data) { return data[id]; });
            different = !deepEquals(saved, current);

            id = this.builder.get(id);
            if (id) { id.emit('changed', different); }
        }, this);
    },

    start: function(event, element) {
        var root = $('[data-lm-root]'),
            size = $(element).position();

        this.block = null;
        this.mode = root.data('lm-root') || 'page';

        root.addClass('moving');

        var type = $(element).data('lm-blocktype'),
            clone = element[0].cloneNode(true);

        if (!this.placeholder) { this.placeholder = zen('div.block.placeholder[data-lm-placeholder]'); }
        this.placeholder.style({ display: 'none' });

        this.original = $(clone).after(element).style({
            display: 'block',
            opacity: 0.5
        }).addClass('original-placeholder').data('lm-dropzone', null);

        if (type === 'grid') { this.original.style({ display: 'flex' }); }

        this.originalType = type;

        this.block = get(this.builder.map, element.data('lm-id') || '') || new Blocks[type]({
            builder: this.builder,
            subtype: element.data('lm-subtype'),
            title: element.text()
        });

        if (!this.block.isNew()) {
            element.style({
                position: 'absolute',
                zIndex: 1500,
                opacity: 0.5,
                width: Math.ceil(size.width),
                height: Math.ceil(size.height)
            }).find('[data-lm-blocktype]');

            if (this.block.getType() === 'grid') {
                var siblings = this.block.block.siblings(':not(.original-placeholder):not(.section-header):not(:empty)');
                if (siblings) {
                    siblings.search('[data-lm-id]').style({ 'pointer-events': 'none' });
                }
            }

            this.placeholder.before(element);
            this.eraser.show();
        } else {
            var position = element.position(),
                parentOffset = {
                    top: element.parent()[0].scrollTop,
                    left: element.parent()[0].scrollLeft
                };
            this.original.style({
                position: 'absolute',
                opacity: 0.5
            }).style({
                left: element[0].offsetLeft - parentOffset.left,
                top: element[0].offsetTop - parentOffset.top,
                width: position.width,
                height: position.height
            });
            this.element = this.dragdrop.element;
            this.dragdrop.element = this.original;
        }

        var blocks;
        if (type === 'grid' && (blocks = root.search('[data-lm-dropzone]:not([data-lm-blocktype="grid"])'))) {
            blocks.style({ 'pointer-events': 'none' });
        }

        singles.enable();
    },

    location: function(event, location, target/*, element*/) {
        target = $(target);
        if (!this.placeholder) { this.placeholder = zen('div.block.placeholder[data-lm-placeholder]').style({ display: 'none' }); }

        var position,
            dataType = target.data('lm-blocktype'),
            originalType = this.block.getType();

        if (!dataType && target.data('lm-root')) { dataType = 'root'; }
        if (this.mode !== 'page' && dataType === 'section') { return; }
        if (dataType === 'grid' && (target.parent().data('lm-root') || (target.parent().data('lm-blocktype') === 'container' && target.parent().parent().data('lm-root')))) { return; }

        // Check for adjacents and avoid inserting any placeholder since it would be the same position
        var exclude = ':not(.placeholder):not([data-lm-id="' + this.original.data('lm-id') + '"])',
            adjacents = {
                before: this.original.previousSiblings(exclude),
                after: this.original.nextSiblings(exclude)
            };

        if (adjacents.before) { adjacents.before = $(adjacents.before[0]); }
        if (adjacents.after) { adjacents.after = $(adjacents.after[0]); }

        if (dataType === 'block' && ((adjacents.before === target && location.x === 'after') || (adjacents.after === target && location.x === 'before'))) {
            return;
        }
        if (dataType === 'grid' && ((adjacents.before === target && location.y === 'below') || (adjacents.after === target && location.y === 'above'))) {
            return;
        }

        var nonVisible = target.parent('[data-lm-blocktype="atoms"]'),
            child = this.block.block.find('[data-lm-id]');

        if ((child ? child.data('lm-blocktype') : originalType) == 'atom') {
            if (!nonVisible) { return; }
        } else {
            if (nonVisible) { return; }
        }

        // handles the types cases and normalizes the locations (x and y)
        var grid, block, method;

        switch (dataType) {
            case 'root':
            case 'section':
                break;
            case 'grid':
                var empty = !target.children(':not(.placeholder)');
                // new particles cannot be dropped in existing grids, only empty ones
                if (originalType !== 'grid' && !empty) { return; }


                if (empty) {
                    if (originalType === 'grid') {
                        this.placeholder.before(target);
                    } else {
                        // we are dropping a new particle into an empty grid, placeholder goes inside
                        this.placeholder.bottom(target);
                    }
                } else {
                    // we are sorting grids ordering, placeholder goes above/below
                    method = (location.y === 'above' ? 'before' : 'after');
                    this.placeholder[method](target);
                }

                break;
            case 'block':
                method = (location.y === 'above' ? 'top' : 'bottom');
                position = (location.x === 'other') ? method : location.x;
                this.placeholder[position](target);

                break;
        }

        // If it's not a block we don't want a small version of the placeholder
        this.placeholder.removeClass('in-between').removeClass('in-between-grids').removeClass('in-between-grids-first').removeClass('in-between-grids-last');
        this.placeholder.style({ display: 'block' })[dataType !== 'block' ? 'removeClass' : 'addClass']('in-between');

        if (originalType === 'grid' && dataType === 'grid') {
            var next = this.placeholder.nextSibling(),
                previous = this.placeholder.previousSibling();

            this.placeholder.addClass('in-between-grids');
            if (previous && !previous.data('lm-blocktype')) { this.placeholder.addClass('in-between-grids-first'); }
            if (!next || !next.data('lm-blocktype')) { this.placeholder.addClass('in-between-grids-last'); }
        }
    },

    nolocation: function(event) {
        if (this.placeholder) { this.placeholder.remove(); }
        if (!this.block) { return; }

        if (!this.block.isNew()) {
            if ($(event.target).matches(this.eraser.element) || this.eraser.element.find($(event.target))) {
                this.dragdrop.removeElement = true;
                this.eraser.over();
            } else {
                this.dragdrop.removeElement = false;
                this.eraser.out();
            }
        }
    },

    resize: function(event, element, siblings, offset) {
        this.resizer.start(event, element, siblings, offset);
    },

    removeElement: function(event, element) {
        this.dragdrop.removeElement = false;

        var transition = {
            opacity: 0
        };

        element.animate(transition, {
            duration: '150ms'
        });

        var root = $('[data-lm-root]'), blocks;
        if (this.block.getType() === 'grid' && (blocks = root.search('[data-lm-dropzone]:not([data-lm-blocktype="grid"])'))) {
            blocks.style({ 'pointer-events': 'inherit' });
        }

        var siblings = this.block.block.siblings(':not(.original-placeholder)');

        if (siblings && this.block.getType() == 'block') {
            var size = this.block.getSize(),
                diff = size / siblings.length,
                newSize, block, total = 0, last;
            siblings.forEach(function(sibling, index) {
                sibling = $(sibling);
                block = get(this.builder.map, sibling.data('lm-id'));
                if (index + 1 == siblings.length) { last = block; }
                newSize = precision(block.getSize() + diff, 0);
                total += newSize;
                block.setSize(newSize, true);
            }, this);

            // ensuring it's always 100%
            if (total != 100 && last) {
                size = last.getSize();
                diff = 100 - total;
                last.setSize(size + diff, true);
            }
        }

        this.eraser.hide();

        $(document).off(this.dragdrop.EVENTS.MOVE, this.dragdrop.bound('move'));
        $(document).off(this.dragdrop.EVENTS.STOP, this.dragdrop.bound('stop'));

        this.builder.remove(this.block.getId());

        var children = this.block.block.search('[data-lm-id]');
        if (children && children.length) {
            children.forEach(function(child) {
                this.builder.remove($(child).data('lm-id'));
            }, this);
        }

        this.block.block.remove();

        if (this.placeholder) { this.placeholder.remove(); }
        if (this.original) { this.original.remove(); }
        this.element = this.block = null;

        singles.disable();
        singles.cleanup(this.builder);

        this.history.push(this.builder.serialize());
        root.removeClass('moving');

    },

    stop: function(event, target/*, element*/) {
        // we are removing the block
        var lastOvered = $(this.dragdrop.lastOvered);
        if (lastOvered && lastOvered.matches(this.eraser.element.find('.trash-zone'))) {
            this.eraser.hide();
            return;
        }

        if (this.block.getType() === 'grid') {
            var siblings = this.block.block.siblings(':not(.original-placeholder):not(.section-header):not(:empty)');
            if (siblings) {
                siblings.search('[data-lm-id]').style({ 'pointer-events': 'inherit' });
            }
        }

        if (!this.block.isNew()) { this.eraser.hide(); }
        if (!this.dragdrop.matched) {
            if (this.placeholder) { this.placeholder.remove(); }

            return;
        }

        target = $(target);

        var wrapper, insider,
            multiLocationResize = false,
            blockWasNew = this.block.isNew(),
            type = this.block.getType(),
            targetId = target.data('lm-id'),
            targetType = !targetId ? false : get(this.builder.map, targetId) ? get(this.builder.map, targetId).getType() : target.data('lm-blocktype'),
            placeholderParent = this.placeholder.parent();

        if (!placeholderParent) { return; }

        var parentId = placeholderParent.data('lm-id'),
            parentType = get(this.builder.map, parentId || '') ? get(this.builder.map, parentId).getType() : false,
            resizeCase = false;

        this.original.remove();

        // case 1: it's a new particle dropped in the LM, we need to wrap it inside a block
        if (type !== 'block' && type !== 'grid' && ((targetType === 'section' || targetType === 'grid') || (targetType === 'block' && parentType !== 'block'))) {
            wrapper = new Blocks.block({
                builder: this.builder
            }).adopt(this.block.block);

            insider = new Blocks[type]({
                id: this.block.block.data('lm-id'),
                type: type,
                subtype: this.element.data('lm-blocksubtype'),
                title: this.element.text(),
                builder: this.builder
            }).setLayout(this.block.block);

            wrapper.setSize();

            this.block = wrapper;
            this.builder.add(wrapper);
            this.builder.add(insider);

            insider.emit('rendered', insider, wrapper);
            wrapper.emit('rendered', wrapper, null);

            resizeCase = { case: 1 };
        }

        // case 2: moving a block around, need to fix sizes if it's a multi location resize
        if (this.originalType === 'block' && this.block.getType() === 'block') {
            resizeCase = { case: 3 };
            var previous = this.block.block.parent('[data-lm-blocktype="grid"]'),
                placeholderPrevious = this.placeholder.parent('[data-lm-blocktype="grid"]');
            //if (previous.find('!> [data-lm-blocktype="container"]')) { previous = previous.parent(); }
            //if (placeholderPrevious.find('!> [data-lm-blocktype="container"]')) { placeholderPrevious = placeholderPrevious.parent(); }
            if (placeholderPrevious !== previous) {
                multiLocationResize = {
                    from: this.block.block.siblings(':not(.placeholder)'),
                    to: this.placeholder.siblings(':not(.placeholder)')
                };
            }

            if (previous.find('!> [data-lm-blocktype="container"]')) { previous = previous.parent(); }
            previous = previous.siblings(':not(.original-placeholder)');
            if (!this.block.isNew() && previous.length) { this.resizer.evenResize(previous); }

            this.block.block.attribute('style', null);
            this.block.setSize();
        }

        if (type === 'grid' && !siblings) {
            var plus = this.block.block.parent('[data-lm-blocktype="section"]').find('.fa-plus');
            if (plus) { plus.emit('click'); }
        }

        if (this.block.hasAttribute('size')) { this.block.setSize(this.placeholder.compute('flex')); }

        this.block.insert(this.placeholder);
        this.placeholder.remove();

        if (blockWasNew) {
            if (resizeCase) { this.resizer.evenResize($([this.block.block, this.block.block.siblings()])); }

            this.element.attribute('style', null);
        }


        if (multiLocationResize.from || (multiLocationResize.to && multiLocationResize.to != this.block.block)) {
            // if !from / !to means it's empty grid, should we remove it?
            var size = this.block.getSize(), diff, block;

            // we are moving the particle to an empty grid, resetting the size to 100%
            if (!multiLocationResize.to) { this.block.setSize(100, true); }

            // we need to compensate the remaining blocks on the FROM with the leaving particle size
            if (multiLocationResize.from) {
                diff = size / multiLocationResize.from.length;
                multiLocationResize.from.forEach(function(sibling) {
                    sibling = $(sibling);
                    block = get(this.builder.map, sibling.data('lm-id'));
                    block.setSize(block.getSize() + diff, true);
                }, this);
            }

            // the TO is receiving a new block so we are going to evenize
            if (multiLocationResize.to) {
                size = 100 / (multiLocationResize.to.length + 1);
                multiLocationResize.to.forEach(function(sibling) {
                    sibling = $(sibling);
                    block = get(this.builder.map, sibling.data('lm-id'));
                    block.setSize(size, true);
                }, this);
                this.block.setSize(size, true);
            }
        }

        singles.disable();
        singles.cleanup(this.builder);

        this.history.push(this.builder.serialize());
    },

    stopAnimation: function(element) {
        var root = $('[data-lm-root]');
        root.removeClass('moving');

        if (this.original) { this.original.remove(); }
        singles.disable();

        if (!this.block) { this.block = get(this.builder.map, element.data('lm-id')); }
        if (this.block && this.block.getType() === 'block') { this.block.setSize(); }
        if (this.block && this.block.isNew() && this.element) { this.element.attribute('style', null); }

        if (this.originalType === 'grid') {
            var blocks, block;
            if (blocks = root.search('[data-lm-dropzone]:not([data-lm-blocktype="grid"])')) {
                blocks.forEach(function(element){
                    element = $(element);
                    block = get(this.builder.map, element.data('lm-id'));
                    element.attribute('style', null);
                    block.setSize();
                }, this);
            }
        }
    }
});

module.exports = LayoutManager;

},{"../ui/drag.drop":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/drag.drop.js","../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","./blocks":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/blocks/index.js","./drag.resizer":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/drag.resizer.js","./eraser":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/eraser.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/every":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/every.js","mout/collection/find":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/find.js","mout/lang/deepEquals":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepEquals.js","mout/lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","mout/lang/isObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isObject.js","mout/number/enforcePrecision":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/enforcePrecision.js","mout/object/get":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js","mout/object/keys":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/keys.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/main.js":[function(require,module,exports){
var $             = require('elements'),
    ready         = require('elements/domready'),
    request       = require('agent'),
    ui            = require('./ui'),
    interpolate   = require('mout/string/interpolate'),
    trim          = require('mout/string/trim'),
    setParam      = require('mout/queryString/setParam'),
    modal         = ui.modal,
    toastr        = ui.toastr,

    getAjaxSuffix = require('./utils/get-ajax-suffix'),

    lm            = require('./lm'),
    mm            = require('./menu');

require('elements/attributes');
require('elements/events');
require('elements/delegation');
require('elements/insertion');
require('elements/traversal');
require('./fields');
require('./ui/popover');
require('./utils/ajaxify-links');

var createHandler = function(divisor,noun,restOfString){
    return function(diff){
        var n = Math.floor(diff/divisor);
        var pluralizedNoun = noun + ( n > 1 ? 's' : '' );
        return "" + n + " " + pluralizedNoun + " " + restOfString;
    }
};

var formatters = [
    { threshold: -31535999, handler: createHandler(-31536000,	"year",     "from now" ) },
    { threshold: -2591999, 	handler: createHandler(-2592000,  	"month",    "from now" ) },
    { threshold: -604799,  	handler: createHandler(-604800,   	"week",     "from now" ) },
    { threshold: -172799,   handler: createHandler(-86400,    	"day",      "from now" ) },
    { threshold: -86399,   	handler: function(){ return      	"tomorrow" } },
    { threshold: -3599,    	handler: createHandler(-3600,     	"hour",     "from now" ) },
    { threshold: -59,     	handler: createHandler(-60,       	"minute",   "from now" ) },
    { threshold: -0.9999,   handler: createHandler(-1,			"second",   "from now" ) },
    { threshold: 1,        	handler: function(){ return      	"just now" } },
    { threshold: 60,       	handler: createHandler(1,        	"second",	"ago" ) },
    { threshold: 3600,     	handler: createHandler(60,       	"minute",	"ago" ) },
    { threshold: 86400,    	handler: createHandler(3600,     	"hour",     "ago" ) },
    { threshold: 172800,   	handler: function(){ return      	"yesterday" } },
    { threshold: 604800,   	handler: createHandler(86400,    	"day",      "ago" ) },
    { threshold: 2592000,  	handler: createHandler(604800,   	"week",     "ago" ) },
    { threshold: 31536000, 	handler: createHandler(2592000,  	"month",    "ago" ) },
    { threshold: Infinity, 	handler: createHandler(31536000, 	"year",     "ago" ) }
];

var prettyDate = {
    format: function (date) {
        var diff = (((new Date()).getTime() - date.getTime()) / 1000);
        for( var i=0; i<formatters.length; i++ ){
            if( diff < formatters[i].threshold ){
                return formatters[i].handler(diff);
            }
        }
        throw new Error("exhausted all formatter options, none found"); //should never be reached
    }
};

ready(function() {
    var body     = $('body'),
        sentence = 'The {{type}} {{verb}} been successfully saved! {{extras}}';

    // Close notification
    body.delegate('click', '[data-g-close]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var parent = element.data('g-close');
        parent = parent ? element.parent(parent) : element;

        parent.slideUp(function() {
            parent.remove();
        });
    });

    // Platform Settings redirect
    body.delegate('mousedown', '[data-settings-key]', function(event, element){
        var key = element.data('settings-key');
        if (!key) { return true; }

        var redirect = window.location.search,
            settings = element.attribute('href'),
            uri = window.location.href.split('?');
        if (uri.length > 1 && uri[0].match(/index.php$/)) { redirect = 'index.php' + redirect; }

        redirect = setParam(settings, key, btoa(redirect));
        element.href(redirect);
    });

    // Save Tooltip
    body.delegate('mouseover', '.button-save', function(event, element){
        if (!element.lastSaved) { return true; }
        element.addClass('g-tooltip').addClass('g-tooltip-right').data('title', 'Last Saved: ' + prettyDate.format(element.lastSaved));
    });

    // Save
    body.delegate('click', '.button-save', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        element.showIndicator();

        var data    = {},
            type    = element.data('save'),
            extras  = '',
            page    = $('[data-lm-root]') ? 'layout' : ($('[data-mm-id]') ? 'menu' : 'other'),
            saveURL = trim(window.location.href, '#') + getAjaxSuffix();

        switch (page) {
            case 'layout':
                lm.layoutmanager.singles('cleanup', lm.builder, true);
                lm.savestate.setSession(lm.builder.serialize(null, true));
                data.layout = JSON.stringify(lm.builder.serialize());

                break;
            case 'menu':
                data.menutype = $('select.menu-select-wrap').value();
                data.settings = JSON.stringify(mm.menumanager.settings);
                data.ordering = JSON.stringify(mm.menumanager.ordering);
                data.items = JSON.stringify(mm.menumanager.items);

                saveURL = element.parent('form').attribute('action') + getAjaxSuffix();
                break;

            case 'other':
            default:
                var form = element.parent('form');

                if (form && element.attribute('type') == 'submit') {
                    $(form[0].elements).forEach(function(input) {
                        input = $(input);
                        var name     = input.attribute('name'),
                            value    = input.value(),
                            parent   = input.parent('.settings-param'),
                            override = parent ? parent.find('> input[type="checkbox"]') : null;

                        if (!name || input.disabled() || (override && !override.checked())) { return; }
                        data[name] = value;
                    });
                }

                $('.settings-param-title, .card.settings-block > h4').hideIndicator();

                if ($('#styles')) { extras = '<br />The CSS was successfully compiled!'; }
        }

        body.emit('updateOriginalFields');

        request('post', saveURL, data, function(error, response) {
            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });
            } else {
                modal.close();
                toastr.success(interpolate(sentence, {
                    verb: type.slice(-1) == 's' ? 'have' : 'has',
                    type: type,
                    extras: extras
                }), type + ' Saved');
            }

            element.hideIndicator();
            element.lastSaved = new Date();

            if (page == 'layout') { lm.layoutmanager.updatePendingChanges(); }
        });
    });

    // Editable titles
    body.delegate('click', '[data-title-edit]', function(event, element) {
        element = $(element);
        var $title = element.siblings('[data-title-editable]') || element.previousSiblings().find('[data-title-editable]') || element.nextSiblings().find('[data-title-editable]'), title;
        if (!$title) { return true; }

        title = $title[0];

        $title.attribute('contenteditable', true);
        title.focus();

        var range = document.createRange(), selection;
        range.selectNodeContents(title);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        $title.storedTitle = trim($title.text());
        $title.emit('title-edit-start', $title.storedTitle);
    });

    body.delegate('keydown', '[data-title-editable]', function(event, element) {
        element = $(element);
        switch (event.keyCode) {
            case 13: // return
            case 27: // esc
                event.stopPropagation();
                if (event.keyCode == 27) {
                    if (typeof element.storedTitle !== 'undefined') {
                        element.text(element.storedTitle);
                    }
                }

                element.attribute('contenteditable', null);
                window.getSelection().removeAllRanges();
                element[0].blur();

                element.emit('title-edit-exit', element.data('title-editable'), event.keyCode == 13 ? 'enter' : 'esc');
                return false;
            default:
                return true;
        }
    });

    body.delegate('blur', '[data-title-editable]', function(event, element) {
        element = $(element);
        element.attribute('contenteditable', null);
        element.data('title-editable', trim(element.text()));
        window.getSelection().removeAllRanges();
        element.emit('title-edit-end', element.data('title-editable'));
    }, true);

    // Quick Ajax Calls [data-ajax-action]
    body.delegate('click', '[data-ajax-action]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        var href   = element.attribute('href') || element.data('ajax-action'),
            method = element.data('ajax-action-method') || 'post';

        if (!href) { return false; }

        element.showIndicator();
        request(method, href + getAjaxSuffix(), function(error, response) {
            if (!response.body.success) {
                modal.open({
                    content: response.body.html || response.body,
                    afterOpen: function(container) {
                        if (!response.body.html) { container.style({ width: '90%' }); }
                    }
                });

                element.hideIndicator();
                return false;
            } else {
                toastr.success(response.body.html || 'Action successfully completed.', response.body.title || '');
            }

            element.hideIndicator();
        })
    });

});

var modules = {
    /*mout    : require('mout'),
     prime   : require('prime'),
     "$"     : elements,
     zen     : zen,
     domready: domready,
     agent   : require('agent'),*/
    lm: lm,
    mm: mm,
    ui: require('./ui'),
    styles: require('./styles'),
    "$": $,
    domready: require('elements/domready'),
    particles: require('./particles'),
    zen: require('elements/zen'),
    moofx: require('moofx')
};

window.G5 = modules;
module.exports = modules;

},{"./fields":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/fields/index.js","./lm":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/lm/index.js","./menu":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/index.js","./particles":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/index.js","./styles":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/styles/index.js","./ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","./ui/popover":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/popover.js","./utils/ajaxify-links":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/ajaxify-links.js","./utils/get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/attributes":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/attributes.js","elements/delegation":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/delegation.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/events.js","elements/insertion":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/insertion.js","elements/traversal":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/traversal.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","moofx":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/index.js","mout/queryString/setParam":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/queryString/setParam.js","mout/string/interpolate":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/interpolate.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/drag.resizer.js":[function(require,module,exports){
"use strict";
var DragEvents = require('../ui/drag.events'),
    prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    bind       = require('mout/function/bind'),
    isString   = require('mout/lang/isString'),
    nMap       = require('mout/math/map'),
    clamp      = require('mout/math/clamp'),
    precision  = require('mout/number/enforcePrecision'),
    get        = require('mout/object/get'),
    $          = require('../utils/elements.utils');

require('elements/events');
require('elements/delegation');

var Resizer = new prime({
    mixin: [Bound, Options],
    DRAG_EVENTS: DragEvents,
    options: {
        minSize: 5
    },
    constructor: function(container, options, menumanager) {
        this.setOptions(options);
        this.history = this.options.history || {};
        this.builder = this.options.builder || {};
        this.map = this.builder.map;
        this.menumanager = menumanager;
        this.origin = {
            x: 0,
            y: 0,
            transform: null,
            offset: {
                x: 0,
                y: 0
            }
        };
    },

    getBlock: function(element) {
        return get(this.map, isString(element) ? element : $(element).data('lm-id') || '');
    },

    getAttribute: function(element, prop) {
        return this.getBlock(element).getAttribute(prop);
    },

    getSize: function(element) {
        element = $(element);
        var parent = element.matches('[data-mm-id]') ? element : element.parent('[data-mm-id]'),
            size = parent.find('.percentage input');

        return Number(size.value());
    },

    setSize: function(element, size, animated) {
        element = $(element);
        animated = typeof animated === 'undefined' ? false : animated;

        var parent = element.matches('[data-mm-id]') ? element : element.parent('[data-mm-id]'),
            pc = parent.find('.percentage input');

        parent[animated ? 'animate' : 'style']({'flex': '0 1 '+size+'%'});
        pc.value(precision(size, 1));
    },

    start: function(event, element, siblings, offset) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }
        if (event.which && event.which !== 1) { return true; }

        // Stops text selection
        event.preventDefault();

        this.element = $(element);

        var parent = this.element.parent('.submenu-selector');
        if (!parent) { return false; }

        parent.addClass('moving');
        
        this.siblings = {
            occupied: 0,
            elements: siblings,
            next: this.element.parent('[data-mm-id]').nextSibling().find('> .submenu-column'),
            prevs: this.element.parent('[data-mm-id]').previousSiblings(),
            sizeBefore: 0
        };

        if (this.siblings.elements.length > 1) {
            this.siblings.occupied -= this.getSize(this.siblings.next);
            this.siblings.elements.forEach(function(sibling) {
                this.siblings.occupied += this.getSize(sibling);
            }, this);
        }

        if (this.siblings.prevs) {
            this.siblings.prevs.forEach(function(sibling) {
                this.siblings.sizeBefore += this.getSize(sibling);
            }, this);
        }

        this.origin = {
            size: this.getSize(this.element),
            maxSize: this.getSize(this.element) + this.getSize(this.siblings.next),
            x: event.changedTouches ? event.changedTouches[0].pageX : event.pageX + 6,
            y: event.changedTouches ? event.changedTouches[0].pageY : event.pageY
        };

        var clientRect = this.element[0].getBoundingClientRect(),
            parentRect = this.element.parent()[0].getBoundingClientRect();

        this.origin.offset = {
            clientRect: clientRect,
            parentRect: {left: parentRect.left, right: parentRect.right},
            x: this.origin.x - clientRect.right,
            y: clientRect.top - this.origin.y,
            down: offset
        };

        this.origin.offset.parentRect.left = this.element.parent('.submenu-selector').find('> [data-mm-id]:first-child')[0].getBoundingClientRect().left;
        this.origin.offset.parentRect.right = this.element.parent('.submenu-selector').find('> [data-mm-id]:last-child')[0].getBoundingClientRect().right;


        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).off(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).off(event, this.bound('stop'));
        }, this));
    },

    move: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        var clientX = event.clientX || event.touches[0].clientX || 0,
            clientY = event.clientY || event.touches[0].clientY || 0,
            parentRect = this.origin.offset.parentRect;

        var deltaX = (this.lastX || clientX) - clientX,
            deltaY = (this.lastY || clientY) - clientY;

        this.direction =
            Math.abs(deltaX) > Math.abs(deltaY) && deltaX > 0 && 'left' ||
            Math.abs(deltaX) > Math.abs(deltaY) && deltaX < 0 && 'right' ||
            Math.abs(deltaY) > Math.abs(deltaX) && deltaY > 0 && 'up' ||
                                                                 'down';
        var size,
            diff = 100 - this.siblings.occupied,
            value = clientX + (!this.siblings.prevs ? this.origin.offset.x - this.origin.offset.down : this.siblings.prevs.length),
            normalized = clamp(value, parentRect.left, parentRect.right);

        size = nMap(normalized, parentRect.left, parentRect.right, 0, 100);
        size = size - this.siblings.sizeBefore;
        size = precision(clamp(size, this.options.minSize, this.origin.maxSize - this.options.minSize), 0);

        diff = precision(diff - size, 0);

        this.setSize(this.element, size);
        this.setSize(this.siblings.next, diff);

        // Hack to handle cases where size is not an integer
        var siblings = this.siblings.elements,
            amount = siblings ? siblings.length + 1 : 1;
        if (amount == 3 || amount == 6 || amount == 7 || amount == 8 || amount == 9 || amount == 11 || amount == 12) {
            var total = 0, blocks;

            blocks = $([siblings, this.element.parent('[data-mm-id]')]);
            blocks.forEach(function(block, index){
                block = $(block);
                size = this.getSize(block);
                if (size % 1) {
                    size = precision(100 / amount, 0);
                    this.setSize(block, size);
                }

                total += size;

                if (blocks.length == index + 1 && total != 100) {
                    diff = 100 - total;
                    this.setSize(block, (size + diff));
                }

            }, this);
        }

        this.lastX = clientX;
        this.lastY = clientY;
    },

    stop: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).off(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).off(event, this.bound('stop'));
        }, this));

        this.element.parent('.submenu-selector').removeClass('moving');

        this.menumanager.emit('dragEnd', this.menumanager.map, 'resize');
        //if (this.origin.size !== this.getSize(this.element)) { this.history.push(this.builder.serialize()); }
    },

    updateItemSizes: function(elements) {
        var parent = this.element ? this.element.parent('.submenu-selector') : null;
        if (!parent && !elements) { return false; }

        var blocks = elements || parent.search('> [data-mm-id]'),
            sizes = [],
            active = $('.menu-selector .active'),
            path = active ? active.data('mm-id') : null;

        blocks.forEach(function(block){
            sizes.push(this.getSize(block));
        }, this);

        // update active path with new columns sizes
        this.menumanager.items[path].columns = sizes;

        this.updateMaxValues(elements);

        return sizes;
    },

    updateMaxValues: function(elements) {
        var parent = this.element ? this.element.parent('.submenu-selector') : null;
        if (!parent && !elements) { return false; }

        var blocks = elements || parent.search('> [data-mm-id]'), sizes, inputs;

        blocks.forEach(function(block){
            block = $(block);
            var sibling = block.nextSibling() || block.previousSibling();
            if (!sibling) { return; }

            inputs = {
                block: block.find('input.column-pc'),
                sibling: sibling.find('input.column-pc')
            };

            sizes = {
                current: this.getSize(block),
                sibling: this.getSize(sibling)
            };

            sizes.total = sizes.current + sizes.sibling;
            inputs.block.attribute('max', sizes.total - Number(inputs.block.attribute('min')));
            inputs.sibling.attribute('max', sizes.total - Number(inputs.sibling.attribute('min')));
        }, this);
    },

    evenResize: function(elements, animated) {
        var total = elements.length,
            size = precision(100 / total, 4);

        elements.forEach(function(element) {
            element = $(element);
            this.setSize(element, size, (typeof animated == 'undefined' ? false : animated));
        }, this);

        this.updateItemSizes(elements);
        this.menumanager.emit('dragEnd', this.menumanager.map, 'evenResize');
    }
});

module.exports = Resizer;

},{"../ui/drag.events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/drag.events.js","../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","elements/delegation":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/delegation.js","elements/events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/events.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/lang/isString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isString.js","mout/math/clamp":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/clamp.js","mout/math/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/map.js","mout/number/enforcePrecision":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/enforcePrecision.js","mout/object/get":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/extra-items.js":[function(require,module,exports){
"use strict";
var $             = require('elements'),
    zen           = require('elements/zen'),
    ready         = require('elements/domready'),
    modal         = require('../ui').modal,
    request       = require('agent'),
    getAjaxSuffix = require('../utils/get-ajax-suffix'),
    deepEquals    = require('mout/lang/deepEquals');

var StepOne = function(map, mode) { // mode [reorder, resize, evenResize]
    if (mode !== 'reorder') { return; }
    this.resizer.updateItemSizes();

    var save    = $('[data-save]'),
        current = {
            settings: this.settings,
            ordering: this.ordering,
            items: this.items
        };

    if (!deepEquals(map, current)) {
        save.showIndicator('fa fa-fw changes-indicator fa-circle-o');
    } else {
        save.hideIndicator();
    }

    if (this.isParticle && this.isNewParticle) {
        var blocktype = this.block.data('mm-blocktype');
        this.block.attribute('data-mm-blocktype', null).addClass('g-menu-item-' + blocktype).data('mm-original-type', blocktype);
        zen('span.menu-item-type.badge').text(blocktype).after(this.block.find('.menu-item .title'));
        modal.open({
            content: 'Loading',
            method: 'post',
            //data: data,
            remote: $(this.block).find('.config-cog').attribute('href') + getAjaxSuffix(),
            remoteLoaded: function(response, content) {

            }
        });
    }

    this.type = undefined;
};

var StepTwo = function(data, content, button) {
    var uri = content.find('[data-mm-particle-stepone]').data('mm-particle-stepone');

    request('post', uri + getAjaxSuffix(), data, function(error, response) {
        if (!response.body.success) {
            modal.open({
                content: response.body.html || response.body,
                afterOpen: function(container) {
                    if (!response.body.html) { container.style({ width: '90%' }); }
                }
            });

            button.hideIndicator();

            return;
        }

        content.html(response.body.html);
    });
};


ready(function(){
    var body = $('body');

    body.delegate('click', '.menu-editor-extras [data-lm-blocktype], .menu-editor-extras [data-mm-module]', function(event, element) {
        var container    = element.parent('.menu-editor-extras'),
            elements     = container.search('[data-lm-blocktype], [data-mm-module]'),
            selectButton = container.find('[data-mm-select]');

        elements.removeClass('selected');
        element.addClass('selected');

        selectButton.attribute('disabled', null);
    });

    // second step
    body.delegate('click', '.menu-editor-extras [data-mm-select]', function(event, element) {
        event.preventDefault();

        if (element.hasClass('disabled') || element.attribute('disabled')) { return false; }

        var container = element.parent('.menu-editor-extras'),
            selected  = container.find('[data-lm-blocktype].selected, [data-mm-module].selected'),
            type      = selected.data('mm-type'),
            data      = {type: type};

        switch (type) {
            case 'particle':
                data['particle'] = selected.data('lm-subtype');
                break;

            case 'module':
                data['module_id'] = selected.data('mm-module');
                break;
        }

        element.showIndicator();

        StepTwo(data, element.parent('.g5-content'), element);
    });
});

module.exports = StepOne;
},{"../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../utils/get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/lang/deepEquals":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepEquals.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/index.js":[function(require,module,exports){
"use strict";
var ready         = require('elements/domready'),
    MenuManager   = require('./menumanager'),
    $             = require('elements'),
    zen           = require('elements/zen'),
    modal         = require('../ui').modal,
    toastr        = require('../ui').toastr,
    extraItems    = require('./extra-items'),
    request       = require('agent'),
    deepEquals    = require('mout/lang/deepEquals'),
    trim          = require('mout/string/trim'),
    clamp         = require('mout/math/clamp'),
    contains      = require('mout/array/contains'),
    getAjaxSuffix = require('../utils/get-ajax-suffix');

var menumanager, map;

var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;

var FOCUSIN   = isFirefox ? 'focus' : 'focusin',
    FOCUSOUT  = isFirefox ? 'blur' : 'focusout';

ready(function() {
    var body = $('body');

    menumanager = new MenuManager('body', {
        delegate: '.g5-mm-particles-picker ul li, #menu-editor > section ul li, .submenu-column, .submenu-column li, .column-container .g-block',
        droppables: '#menu-editor [data-mm-id]',
        exclude: '[data-lm-nodrag], .fa-cog, .config-cog',
        resize_handles: '.submenu-column:not(:last-child)',
        catchClick: true
    });


    // Handles Modules / Particles items in the Menu
    menumanager.on('dragEnd', extraItems);

    module.exports.menumanager = menumanager;

    // Menu Manager
    menumanager.setRoot();

    // Refresh ordering/items on menu type change or Menu navigation link
    body.delegate('statechangeAfter', '#main-header [data-g5-ajaxify], select.menu-select-wrap', function(event, element) {
        menumanager.setRoot();
    });

    body.delegate(FOCUSIN, '.percentage input', function(event, element) {
        element = $(element);
        element.currentSize = Number(element.value());

        element[0].focus();
        element[0].select();
    }, true);

    body.delegate('keydown', '.percentage input', function(event, element) {
        if (contains([46, 8, 9, 27, 13, 110, 190], event.keyCode) ||
                // Allow: [Ctrl|Cmd]+A | [Ctrl|Cmd]+R
            (event.keyCode == 65 && (event.ctrlKey === true || event.ctrlKey === true)) ||
            (event.keyCode == 82 && (event.ctrlKey === true || event.metaKey === true)) ||
                // Allow: home, end, left, right, down, up
            (event.keyCode >= 35 && event.keyCode <= 40)) {
            // let it happen, don't do anything
            return;
        }
        // Ensure that it is a number and stop the keypress
        if ((event.shiftKey || (event.keyCode < 48 || event.keyCode > 57)) && (event.keyCode < 96 || event.keyCode > 105)) {
            event.preventDefault();
        }
    });

    body.delegate('keydown', '.percentage input', function(event, element) {
        element = $(element);
        var value = Number(element.value()),
            min = Number(element.attribute('min')),
            max = Number(element.attribute('max')),
            upDown = event.keyCode == 38 || event.keyCode == 40;

        if (upDown) {
            value += event.keyCode == 38 ? +1 : -1;
            value = clamp(value, min, max);
            element.value(value);
            body.emit('keyup', {target: element});
        }
    });

    body.delegate('keyup', '.percentage input', function(event, element) {
        element = $(element);
        var value = Number(element.value()),
            min = Number(element.attribute('min')),
            max = Number(element.attribute('max'));

        var resizer = menumanager.resizer,
            parent = element.parent('[data-mm-id]'),
            sibling = parent.nextSibling('[data-mm-id]') || parent.previousSibling('[data-mm-id]');

        if (!value || value < min || value > max) { return; }

        var sizes = {
            current: Number(element.currentSize),
            sibling: Number(resizer.getSize(sibling))
        };

        element.currentSize = value;

        sizes.total = sizes.current + sizes.sibling;
        sizes.diff = sizes.total - value;

        resizer.setSize(parent, value);
        resizer.setSize(sibling, sizes.diff);

        menumanager.resizer.updateItemSizes(parent.parent('.submenu-selector').search('> [data-mm-id]'));
        menumanager.emit('dragEnd', menumanager.map, 'inputChange');
    });

    body.delegate(FOCUSOUT, '.percentage input', function(event, element) {
        element = $(element);
        var value = Number(element.value());
        if (value < Number(element.attribute('min')) || value > Number(element.attribute('max'))) {
            element.value(element.currentSize);
        }
    }, true);

    // Add new columns
    body.delegate('click', '.add-column', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        element = $(element);

        var container = element.parent('[data-g5-menu-columns]').find('.submenu-selector'),
            children = container.children(),
            last = container.find('> :last-child'),
            count = children ? children.length : 0,
            active = $('.menu-selector .active'),
            path = active ? active.data('mm-id') : null;

        var block = $(last[0].cloneNode(true));
        block.data('mm-id', 'list-' + count);
        block.find('.submenu-items').empty();
        block.after(last);

        menumanager.ordering[path].push([]);
        menumanager.resizer.evenResize($('.submenu-selector > [data-mm-id]'));
    });

    // Attach events to pseudo (x) for deleting a column
    body.delegate('click', '[data-g5-menu-columns] .submenu-items:empty', function(event, element) {
        var bounding = element[0].getBoundingClientRect(),
            x = event.pageX, y = event.pageY,
            deleter = {
                width: 36,
                height: 36
            };

        if (x >= bounding.left + bounding.width - deleter.width && x <= bounding.left + bounding.width &&
            Math.abs(window.scrollY - y) - bounding.top < deleter.height) {
            var parent = element.parent('[data-mm-id]'),
                index = parent.data('mm-id').match(/\d+$/)[0],
                active = $('.menu-selector .active'),
                path = active ? active.data('mm-id') : null;

            parent.remove();
            menumanager.ordering[path].splice(index, 1);
            menumanager.resizer.evenResize($('.submenu-selector > [data-mm-id]'));
        }
    });

    // Menu Items settings
    body.delegate('click', '#menu-editor .config-cog, #menu-editor .global-menu-settings', function(event, element) {
        event.preventDefault();

        var data = {}, isRoot = element.hasClass('global-menu-settings');

        if (isRoot) {
            data.settings = JSON.stringify(menumanager.settings);
        } else {
            data.item = JSON.stringify(menumanager.items[element.parent('[data-mm-id]').data('mm-id')]);
        }

        modal.open({
            content: 'Loading',
            method: 'post',
            data: data,
            remote: $(element).attribute('href') + getAjaxSuffix(),
            remoteLoaded: function(response, content) {
                var form = content.elements.content.find('form'),
                    submit = content.elements.content.find('input[type="submit"], button[type="submit"]'),
                    dataString = [];

                if (!form || !submit) { return true; }

                // Menuitems Settings apply
                submit.on('click', function(e) {
                    e.preventDefault();
                    dataString = [];

                    submit.showIndicator();

                    $(form[0].elements).forEach(function(input) {
                        input = $(input);
                        var name = input.attribute('name'),
                            value = input.value();

                        if (!name) { return; }
                        dataString.push(name + '=' + encodeURIComponent(value));
                    });

                    var title = content.elements.content.find('[data-title-editable]');
                    if (title) {
                        dataString.push((isRoot ? 'settings[title]' : 'title') + '=' + encodeURIComponent(title.data('title-editable')));
                    }

                    request(form.attribute('method'), form.attribute('action') + getAjaxSuffix(), dataString.join('&'), function(error, response) {
                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            if (response.body.path) {
                                menumanager.items[response.body.path] = response.body.item;
                            } else {
                                menumanager.settings = response.body.settings;
                            }

                            if (response.body.html) {
                                var parent = element.parent('[data-mm-id]');
                                if (parent) { parent.html(response.body.html); }
                            }

                            menumanager.emit('dragEnd', menumanager.map);
                            modal.close();
                            toastr.success('The Menu Item settings have been applied to the Main Menu. <br />Remember to click the Save button to store them.', 'Settings Applied');
                        }

                        submit.hideIndicator();
                    });
                });
            }
        });
    });
});

module.exports = {
    menumanager: menumanager
};
},{"../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../utils/get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","./extra-items":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/extra-items.js","./menumanager":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/menumanager.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","mout/lang/deepEquals":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepEquals.js","mout/math/clamp":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/clamp.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/menumanager.js":[function(require,module,exports){
"use strict";
var prime     = require('prime'),
    $         = require('../utils/elements.utils'),
    zen       = require('elements/zen'),
    Emitter   = require('prime/emitter'),
    Bound     = require('prime-util/prime/bound'),
    Options   = require('prime-util/prime/options'),
    DragDrop  = require('../ui/drag.drop'),
    Resizer   = require('./drag.resizer'),
    get       = require('mout/object/get'),

    every     = require('mout/array/every'),
    last      = require('mout/array/last'),
    indexOf   = require('mout/array/indexOf'),
    isArray   = require('mout/lang/isArray'),
    isObject  = require('mout/lang/isObject'),
    deepClone = require('mout/lang/deepClone'),
    equals    = require('mout/object/equals');


var MenuManager = new prime({

    mixin: [Bound, Options],

    inherits: Emitter,

    constructor: function(element, options) {
        this.map = {};
        this.setRoot();

        this.dragdrop = new DragDrop(element, options, this);
        this.resizer = new Resizer(element, options, this);
        this.dragdrop
            .on('dragdrop:click', this.bound('click'))
            .on('dragdrop:start', this.bound('start'))
            .on('dragdrop:move:once', this.bound('moveOnce'))
            .on('dragdrop:location', this.bound('location'))
            .on('dragdrop:nolocation', this.bound('nolocation'))
            .on('dragdrop:resize', this.bound('resize'))
            .on('dragdrop:stop', this.bound('stop'))
            .on('dragdrop:stop:animation', this.bound('stopAnimation'));

        //console.log(this.ordering, this.items);
    },

    setRoot: function() {
        this.root = $('#menu-editor');

        if (this.root) {
            this.settings = JSON.parse(this.root.data('menu-settings'));
            this.ordering = JSON.parse(this.root.data('menu-ordering'));
            this.items = JSON.parse(this.root.data('menu-items'));

            this.map = {
                settings: deepClone(this.settings),
                ordering: deepClone(this.ordering),
                items: deepClone(this.items)
            };

            var submenus = $('[data-g5-menu-columns] .submenu-selector'), columns;
            if (this.resizer && submenus && (columns = submenus.search('> [data-mm-id]'))) { this.resizer.updateMaxValues(columns); }
        }
    },

    click: function(event, element) {
        if (element.hasClass('g-block')) {
            this.stopAnimation();
            return true;
        }

        var menuItem = element.find('> .menu-item');
        if (menuItem && menuItem.tag() == 'span') {
            this.stopAnimation();
            return true;
        }

        var siblings = element.siblings();
        element.addClass('active');
        if (siblings) { siblings.removeClass('active'); }
        element.emit('click');

        var link = element.find('a');
        if (link) { link[0].click(); }
    },

    resize: function(event, element, siblings, offset) {
        this.resizer.start(event, element, siblings, offset);
    },

    start: function(event, element) {
        var root = element.parent('.menu-selector') || element.parent('.submenu-column') || element.parent('.submenu-selector') || element.parent('.g5-mm-particles-picker'),
            size = $(element).position();

        this.block = null;
        this.targetLevel = undefined;
        this.addNewItem = false;
        this.type =  element.parent('.g-toplevel') || element.matches('.g-toplevel') ? 'main' : (element.matches('.g-block') ? 'column' : 'columns_items');
        this.isParticle = element.matches('[data-mm-blocktype]') || element.matches('[data-mm-original-type]');
        this.wasActive = element.hasClass('active');
        this.isNewParticle = element.parent('.g5-mm-particles-picker');
        this.ParticleIndex = -1;
        this.root = root;

        this.itemID = element.data('mm-id');
        this.itemLevel = element.data('mm-level');
        this.itemFrom = element.parent('[data-mm-id]');
        this.itemTo = null;

        if (this.isParticle && !this.isNewParticle) {
            var children = element.parent().children('[data-mm-id]');
            this.ParticleIndex = indexOf(children, element[0]);
        }

        root.addClass('moving');

        var type = $(element).data('mm-id'),
            clone = element[0].cloneNode(true);

        if (!this.placeholder) { this.placeholder = zen((this.type == 'column' ? 'div' : 'li') + '.block.placeholder[data-mm-placeholder]'); }
        this.placeholder.style({ display: 'none' });
        this.original = $(clone).after(element).style({
            display: 'inline-block',
            opacity: 1
        }).addClass('original-placeholder').data('lm-dropzone', null);
        this.originalType = type;
        this.block = element;

        if (!this.isNewParticle) {
            element.style({
                position: 'absolute',
                zIndex: 1000,
                width: Math.ceil(size.width),
                height: Math.ceil(size.height)
            }).addClass('active');

            this.placeholder.before(element);
        } else {
            var position = element.position(),
                parentOffset = {
                    top: element.parent()[0].scrollTop,
                    left: element.parent()[0].scrollLeft
                };
            this.original.style({
                position: 'absolute',
                opacity: 0.5
            }).style({
                left: element[0].offsetLeft - parentOffset.left,
                top: element[0].offsetTop - parentOffset.top,
                width: position.width,
                height: position.height
            });
            this.element = this.dragdrop.element;
            this.block = this.dragdrop.element;
            this.dragdrop.element = this.original;
        }

        if (this.type == 'column') {
            root.search('.g-block > *').style({ 'pointer-events': 'none' });
        }
    },

    moveOnce: function(/*element*/) {
        if (this.original) { this.original.style({ opacity: 0.5 }); }
    },

    location: function(event, location, target/*, element*/) {
        target = $(target);
        if (!this.placeholder) { this.placeholder = zen((this.type == 'column' ? 'div' : 'li') + '.block.placeholder[data-mm-placeholder]').style({ display: 'none' }); }

        var targetType = target.parent('.g-toplevel') || target.matches('.g-toplevel') ? 'main' : (target.matches('.g-block') ? 'column' : 'columns_items'),
            dataLevel = target.data('mm-level'),
            originalLevel = this.block.data('mm-level');

        if (this.isParticle && (targetType === 'main' && !dataLevel)) {
            this.dragdrop.matched = false;
            return;
        }

        // Workaround for layout and style of columns
        if (dataLevel === null && (this.type === 'columns_items' || this.isParticle)) {
            var submenu_items = target.find('.submenu-items');
            if (!submenu_items || submenu_items.children()) {
                this.dragdrop.matched = false;
                return;
            }

            this.placeholder.style({ display: 'block' }).bottom(submenu_items);
            this.addNewItem = submenu_items;
            this.targetLevel = 2;
            return;
        }


        if (!this.isParticle) {

            // We only allow sorting between same level items
            if (this.type !== 'column' && originalLevel !== dataLevel) {
                this.dragdrop.matched = false;
                return;
            }

            // Ensuring columns can only be dragged before/after other columns
            if (this.type == 'column' && dataLevel) {
                this.dragdrop.matched = false;
                return;
            }

            // For levels > 2 we only allow sorting within the same column
            if (dataLevel > 2 && target.parent('ul') != this.block.parent('ul')) {
                this.dragdrop.matched = false;
                return;
            }
        }

        // Check for adjacents and avoid inserting any placeholder since it would be the same position
        var exclude = ':not(.placeholder):not([data-mm-id="' + this.original.data('mm-id') + '"])',
            adjacents = {
                before: this.original.previousSiblings(exclude),
                after: this.original.nextSiblings(exclude)
            };

        if (adjacents.before) { adjacents.before = $(adjacents.before[0]); }
        if (adjacents.after) { adjacents.after = $(adjacents.after[0]); }


        if (targetType === 'main' && ((adjacents.before === target && location.x === 'after') || (adjacents.after === target && location.x === 'before'))) {
            return;
        }
        if (targetType === 'column' && ((adjacents.before === target && location.x === 'after') || (adjacents.after === target && location.x === 'before'))) {
            return;
        }
        if (targetType === 'columns_items' && ((adjacents.before === target && location.y === 'below') || (adjacents.after === target && location.y === 'above'))) {
            return;
        }

        // Handles the types cases and normalizes the locations (x and y)
        switch (targetType) {
            case 'main':
            case 'column':
                this.placeholder[location.x](target);
                break;
            case 'columns_items':
                this.placeholder[location.y === 'above' ? 'before' : 'after'](target);

                break;
        }

        this.targetLevel = dataLevel;

        // If it's not a block we don't want a small version of the placeholder
        this.placeholder.style({ display: 'block' })[targetType !== 'main' ? 'removeClass' : 'addClass']('in-between');

    },

    nolocation: function(/*event*/) {
        if (this.placeholder) { this.placeholder.remove(); }
        this.targetLevel = undefined;
    },

    stop: function(event, target, element) {
        target = $(target);
        if (target) { element.removeClass('active'); }
        if (this.type == 'column') {
            this.root.search('.g-block > *').attribute('style', null);
        }

        if (!this.dragdrop.matched && !this.addNewItem) {
            if (this.placeholder) { this.placeholder.remove(); }

            this.type = undefined;
            this.targetLevel = false;
            this.isParticle = undefined;
            return;
        }

        var placeholderParent = this.placeholder.parent();
        if (!placeholderParent) {
            this.type = undefined;
            this.targetLevel = false;
            this.isParticle = undefined;
            return;
        }

        if (this.addNewItem) { this.block.attribute('style', null).removeClass('active'); }

        var parent = this.block.parent();

        if (this.original) {
            if (!this.isNewParticle) { this.original.remove(); }
            else { this.original.attribute('style', null).removeClass('original-placeholder'); }
        }


        this.block.after(this.placeholder);
        this.placeholder.remove();
        this.itemTo = this.block.parent('[data-mm-id]');
        this.currentLevel = this.itemLevel;
        if (this.wasActive) { element.addClass('active'); }

        if (this.isParticle) {
            var id = last(this.itemID.split('/')),
                targetItem = (target || this.itemTo),
                base = targetItem[target ? 'parent' : 'find']('[data-mm-base]').data('mm-base');

            this.itemID = base ? base + '/' + id : id;
            this.itemLevel = this.targetLevel;
            this.block.data('mm-id', this.itemID).data('mm-level', this.targetLevel);
        }

        var path = this.itemID.split('/'),
            items, column;

        path.splice(this.itemLevel - 1);
        path = path.join('/');

        // Items reorder for root or sublevels with logic to reorder FROM and TO sublevel column if needed
        if (this.itemFrom || this.itemTo) {
            var sources = this.itemFrom == this.itemTo ? [this.itemFrom] : [this.itemFrom, this.itemTo];
            sources.forEach(function(source) {
                if (!source) { return; }

                items = source.search('[data-mm-id]');
                column = Number(this.block.data('mm-level') > 2 ? 0 : (source.data('mm-id').match(/\d+$/) || [0])[0]);

                if (!items) {
                    this.ordering[path][column] = [];
                    return;
                }

                items = items.map(function(element) {
                    return $(element).data('mm-id');
                });

                this.ordering[path][column] = items;
            }, this);

            // Refresh the origin if it's a particle
            base = this.itemFrom ? (this.itemFrom.attribute('data-mm-base') !== null ? this.itemFrom : this.itemFrom.find('[data-mm-base]')) : null;
            if (this.isParticle && base && this.targetLevel != this.currentLevel) {
                var list = (this.itemFrom.data('mm-id').match(/\d+$/) || [0])[0];
                this.ordering[base.data('mm-base') || ''][list].splice(this.ParticleIndex, 1);
            }
        }

        // Column reordering, we just need to swap the array indexes
        if (!this.itemFrom && !this.itemTo && !this.isParticle) {
            var colsOrder = [],
                active = $('.g-toplevel [data-mm-id].active').data('mm-id');
            items = parent.search('> [data-mm-id]');

            items.forEach(function(element, index) {
                element = $(element);

                var id = element.data('mm-id'),
                    column = Number((id.match(/\d+$/) || [0])[0]);

                element.data('mm-id', id.replace(/\d+$/, index));
                colsOrder.push(this.ordering[active][column]);
            }, this);

            this.ordering[active] = colsOrder;
        }

        if (!parent.children()) { parent.empty(); }

        /*if (console && console.group && console.info && console.table && console.groupEnd) {
         console.group();
         console.info('New Ordering');
         console.table(this.ordering);
         console.groupEnd();
         }*/

        var selector = this.block.parent('.submenu-selector');
        if (selector) { this.resizer.updateItemSizes(selector.search('> [data-mm-id]')); }

        this.emit('dragEnd', this.map, 'reorder');
    },

    stopAnimation: function(/*element*/) {
        var flex = null;
        if (this.type == 'column') { flex = this.resizer.getSize(this.block); }
        if (this.root) { this.root.removeClass('moving'); }
        if (this.block) {
            this.block.attribute('style', null);
            if (flex) { this.block.style('flex', '0 1 ' + flex + ' %'); }
        }

        if (this.original) {
            if (!this.isNewParticle || (!this.dragdrop.matched && !this.targetLevel)) { this.original.remove(); }
            else { this.original.attribute('style', null).removeClass('original-placeholder'); }
        }

        if (!this.wasActive && this.block) { this.block.removeClass('active'); }
    }
});


module.exports = MenuManager;

},{"../ui/drag.drop":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/drag.drop.js","../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","./drag.resizer":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/drag.resizer.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/every":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/every.js","mout/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/indexOf.js","mout/array/last":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/last.js","mout/lang/deepClone":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepClone.js","mout/lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","mout/lang/isObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isObject.js","mout/object/equals":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/equals.js","mout/object/get":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/collections/index.js":[function(require,module,exports){
"use strict";

var ready         = require('elements/domready'),
    $             = require('elements'),
    zen           = require('elements/zen'),
    modal         = require('../../ui').modal,
    toastr        = require('../../ui').toastr,
    request       = require('agent'),
    lastItem      = require('mout/array/last'),
    indexOf       = require('mout/array/indexOf'),
    simpleSort    = require('sortablejs'),

    trim          = require('mout/string/trim'),

    getAjaxSuffix = require('../../utils/get-ajax-suffix');

require('elements/insertion');

ready(function() {
    var body = $('body');

    var addNewByEnter = function(title, key) {
        if (key == 'enter' && this.CollectionNew) {
            this.CollectionNew = false;
            body.emit('click', { target: this.parent('.settings-param').find('[data-collection-addnew]') });
        }

        if (key == 'esc' && this.CollectionNew) {
            this.CollectionNew = false;
            body.emit('click', { target: this.parent('[data-collection-item]').find('[data-collection-remove]') });
        }
    };

    var createSortables = function(list) {
        var lists = list || $('.collection-list ul');
        if (!lists) { return; }
        lists.forEach(function(list) {
            list = $(list);
            list.SimpleSort = simpleSort.create(list[0], {
                handle: '.fa-reorder',
                filter: '[data-collection-nosort]',
                scroll: false,
                animation: 150,
                onStart: function() {
                    $(this.el).addClass('collection-sorting');
                },
                onEnd: function(evt) {
                    var element = $(this.el);
                    element.removeClass('collection-sorting');

                    if (evt.oldIndex === evt.newIndex) { return; }

                    var dataField = element.parent('.settings-param').find('[data-collection-data]'),
                        data      = dataField.value();

                    data = JSON.parse(data);

                    data.splice(evt.newIndex, 0, data.splice(evt.oldIndex, 1)[0]);
                    dataField.value(JSON.stringify(data));
                    body.emit('change', { target: dataField });
                }
            });
        });
    };

    createSortables();

    // delegate sortables collections for ajax support
    body.delegate('mouseover', '.collection-list ul', function(event, element) {
        if (!element.SimpleSort) { createSortables(element); }
    });

    // Add new item
    body.delegate('click', '[data-collection-addnew]', function(event, element) {
        var param     = element.parent('.settings-param'),
            list      = param.find('ul'),
            editall   = list.parent().find('[data-collection-editall]'),
            dataField = param.find('[data-collection-data]'),
            tmpl      = param.find('[data-collection-template]'),
            items     = list.search('> [data-collection-item]') || [],
            last      = $(lastItem(items));

        var clone = $(tmpl[0].cloneNode(true)), title, editable;

        if (last) { clone.after(last); }
        else { clone.top(list); }

        if (items.length && editall) { editall.style('display', 'inline-block'); }

        title = clone.find('a');
        editable = title.find('[data-title-editable]');

        var re = new RegExp('%id%', 'g');
        title.href(title.href().replace(re, items.length));

        clone.attribute('style', null).data('collection-item', clone.data('collection-template'));
        clone.attribute('data-collection-template', null);
        clone.attribute('data-collection-nosort', null);
        editable.CollectionNew = true;
        body.emit('click', { target: title.siblings('[data-title-edit]') });

        editable.on('title-edit-exit', addNewByEnter);
        body.emit('change', { target: dataField });
    });

    // Edit Title
    body.delegate('blur', '[data-collection-item] [data-title-editable]', function(event, element) {
        var text      = trim(element.text()),
            item      = element.parent('[data-collection-item]'),
            key       = item.data('collection-item'),
            items     = element.parent('ul').search('> [data-collection-item]'),
            dataField = element.parent('.settings-param').find('[data-collection-data]'),
            data      = dataField.value(),
            index     = indexOf(items, item[0]);

        if (index == -1) { return; }

        data = JSON.parse(data);
        if (!data[index]) { data.splice(index, 0, {}); }
        data[index][key] = text;
        dataField.value(JSON.stringify(data));
        body.emit('change', { target: dataField });
    }, true);

    // Remove item
    body.delegate('click', '[data-collection-remove]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var item      = element.parent('[data-collection-item]'),
            list      = element.parent('ul'),
            items     = list.search('> [data-collection-item]'),
            index     = indexOf(items, item[0]),
            dataField = element.parent('.settings-param').find('[data-collection-data]'),
            data      = dataField.value();

        data = JSON.parse(data);
        data.splice(index, 1);
        dataField.value(JSON.stringify(data));
        item.remove();
        if (items.length) { list.parent().find('[data-collection-editall]').style('display', 'none'); }
        body.emit('change', { target: dataField });
    });

    // Preventing click of links when title is being edited
    body.delegate('click', '[data-collection-item] a', function(event, element) {
        if (element.find('[contenteditable]')) {
            event.preventDefault();
            event.stopPropagation();
        }
    });

    // Load item settings
    body.delegate('click', '[data-collection-item] .config-cog, [data-collection-editall]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }

        var editable = element.find('[data-title-editable]');
        if (editable && editable.attribute('contenteditable')) {
            event.stopPropagation();
            return false;
        }

        var isEditAll = element.data('collection-editall') !== null,
            parent    = element.parent('.settings-param'),
            dataField = parent.find('[data-collection-data]'),
            data      = dataField.value(),
            item      = element.parent('[data-collection-item]'),
            items     = parent.search('ul > [data-collection-item]');

        var dataPost = { data: isEditAll ? data : JSON.stringify(JSON.parse(data)[indexOf(items, item[0])]) };
        modal.open({
            content: 'Loading',
            method: 'post',
            className: 'g5-dialog-theme-default g5-modal-collection g5-modal-collection-' + (isEditAll ? 'editall' : 'single'),
            data: dataPost,
            remote: element.attribute('href') + getAjaxSuffix(),
            remoteLoaded: function(response, content) {
                var form       = content.elements.content.find('form'),
                    submit     = content.elements.content.find('input[type="submit"], button[type="submit"]'),
                    dataString = [],
                    dataValue  = JSON.parse(data);

                if (dataValue.length == 1) {
                    content.elements.content.style({ width: 450 });
                }

                if (!form || !submit) {
                    return true;
                }

                // Collection Settings apply
                submit.on('click', function(e) {
                    e.preventDefault();
                    dataString = [];

                    submit.showIndicator();

                    $(form[0].elements).forEach(function(input) {
                        input = $(input);
                        var name     = input.attribute('name'),
                            value    = input.value(),
                            parent   = input.parent('.settings-param'),
                            override = parent ? parent.find('> input[type="checkbox"]') : null;

                        if (!name || input.disabled() || (override && !override.checked())) { return; }
                        dataString.push(name + '=' + encodeURIComponent(value));
                    });

                    var titles = content.elements.content.search('[data-title-editable]'), key;
                    if (titles) {
                        titles.forEach(function(title) {
                            title = $(title);
                            key = title.data('collection-key') || 'title';
                            dataString.push(key + '=' + encodeURIComponent(title.data('title-editable')));
                        });
                    }

                    request(form.attribute('method'), form.attribute('action') + getAjaxSuffix(), dataString.join('&') || {}, function(error, response) {
                        if (!response.body.success) {
                            modal.open({
                                content: response.body.html || response.body,
                                afterOpen: function(container) {
                                    if (!response.body.html) { container.style({ width: '90%' }); }
                                }
                            });
                        } else {
                            if (item) { // single editing
                                dataValue[indexOf(items, item[0])] = response.body.data;
                            } else { // multi editing
                                dataValue = response.body.data;
                            }

                            dataField.value(JSON.stringify(dataValue));
                            body.emit('change', { target: dataField });

                            element.parent('.settings-param-field').search('ul > [data-collection-item]').forEach(function(item, index){
                                item = $(item);
                                var label = item.find('[data-title-editable]'),
                                    text = dataValue[index][item.data('collection-item')];

                                label.data('title-editable', text).text(text);
                            });

                            modal.close();
                            toastr.success('Collection Item updated', 'Item Updated');
                        }

                        submit.hideIndicator();
                    });
                });
            }
        });
    });
});

module.exports = {};

},{"../../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../../utils/get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/insertion":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/insertion.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/indexOf.js","mout/array/last":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/last.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js","sortablejs":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/sortablejs/Sortable.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/colorpicker/index.js":[function(require,module,exports){
"use strict";

var prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    $          = require('elements'),
    ready      = require('elements/domready'),
    zen        = require('elements/zen'),

    DragEvents = require('../../ui/drag.events'),

    forEach    = require('mout/collection/forEach'),
    bind       = require('mout/function/bind'),
    clamp      = require('mout/math/clamp');

var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;

var MOUSEDOWN = DragEvents.EVENTS.START,
    MOUSEMOVE = DragEvents.EVENTS.MOVE,
    MOUSEUP   = DragEvents.EVENTS.STOP,
    FOCUSIN   = isFirefox ? 'focus' : 'focusin';

var ColorPicker = new prime({
    mixin: [Options, Bound],
    inherits: Emitter,
    options: {},
    constructor: function(options) {
        this.setOptions(options);
        this.built = false;
        this.attach();
    },

    attach: function() {
        var body = $('body');

        MOUSEDOWN.forEach(bind(function(mousedown) {
            body.delegate(mousedown, '.colorpicker i', this.bound('iconClick'));
        }, this));

        body.delegate(FOCUSIN, '.colorpicker input', this.bound('show'), true);


        body.delegate('keydown', '.colorpicker input', bind(function(event, element) {
            switch (event.keyCode) {
                case 9: // tab
                    this.hide();
                    break;
                case 13: // enter
                case 27: // esc
                    this.hide();
                    element[0].blur();
                    break;
            }
            return true;
        }, this));

        // Update on keyup
        body.delegate('keyup', '.colorpicker input', bind(function(event, element) {
            this.updateFromInput(true, element);
            return true;
        }, this));

        // Update on paste
        body.delegate('paste', '.colorpicker input', bind(function(event, element) {
            setTimeout(bind(function() {
                this.updateFromInput(true, element);
            }, this), 1);
        }, this));
    },

    show: function(event, element) {
        var body = $('body');

        if (!this.built) {
            this.build();
        }

        this.element = element;
        this.reposition();
        this.wrapper.addClass('cp-visible');
        this.updateFromInput();

        MOUSEMOVE.forEach(bind(function(mousemove) {
            body.on(mousemove, this.bound('bodyMove'));
        }, this));

        MOUSEDOWN.forEach(bind(function(mousedown) {
            this.wrapper.delegate(mousedown, '.cp-grid, .cp-slider, .cp-opacity-slider', this.bound('bodyDown'));
            body.on(mousedown, this.bound('bodyClick'));
        }, this));

        MOUSEUP.forEach(bind(function(mouseup) {
            body.on(mouseup, this.bound('targetReset'));
        }, this));
    },

    hide: function() {
        var body = $('body');

        if (!this.built) { return; }
        this.wrapper.removeClass('cp-visible');

        MOUSEMOVE.forEach(bind(function(mousemove) {
            body.off(mousemove, this.bound('bodyMove'));
        }, this));

        MOUSEDOWN.forEach(bind(function(mousedown) {
            this.wrapper.undelegate(mousedown, '.cp-grid, .cp-slider, .cp-opacity-slider', this.bound('bodyDown'));
            body.off(mousedown, this.bound('bodyClick'));
        }, this));

        MOUSEUP.forEach(bind(function(mouseup) {
            body.off(mouseup, this.bound('targetReset'));
        }, this));
    },

    iconClick: function(event, element) {
        event.preventDefault();

        var input = $(element).sibling('input');
        input[0].focus();

        this.show(event, input);
    },

    bodyMove: function(event) {
        event.preventDefault();

        if (this.target) { this.move(this.target, event); }
    },

    bodyClick: function(event) {
        var target = $(event.target);
        if (!target.parent('.cp-wrapper') && !target.parent('.colorpicker')) {
            this.hide();
        }
    },

    bodyDown: function(event, element) {
        event.preventDefault();

        this.target = element;
        this.move(this.target, event, true);
    },

    targetReset: function(event) {
        event.preventDefault();

        this.target = null;
    },

    move: function(target, event) {
        var input      = this.element,
            picker     = target.find('.cp-picker'),
            clientRect = target[0].getBoundingClientRect(),
            offsetX    = clientRect.left + window.scrollX,
            offsetY    = clientRect.top + window.scrollY,
            x          = Math.round(event.pageX - offsetX),
            y          = Math.round(event.pageY - offsetY),
            wx, wy, r, phi;

        // Touch support
        if (event.changedTouches) {
            x = event.changedTouches[0].pageX - offsetX;
            y = event.changedTouches[0].pageY - offsetY;
        }

        // Constrain picker to its container
        if (x < 0) x = 0;
        if (y < 0) y = 0;
        if (x > clientRect.width) x = clientRect.width;
        if (y > clientRect.height) y = clientRect.height;

        // Constrain color wheel values to the wheel
        if (target.parent('.cp-mode-wheel') && picker.parent('.cp-grid')) {
            wx = 75 - x;
            wy = 75 - y;
            r = Math.sqrt(wx * wx + wy * wy);
            phi = Math.atan2(wy, wx);

            if (phi < 0) phi += Math.PI * 2;
            if (r > 75) {
                x = 75 - (75 * Math.cos(phi));
                y = 75 - (75 * Math.sin(phi));
            }

            x = Math.round(x);
            y = Math.round(y);
        }

        // Move the picker
        if (target.hasClass('cp-grid')) {
            picker.style({
                top: y,
                left: x
            });

            this.updateFromPicker(input, target);
        } else {
            picker.style({
                top: y
            });
            this.updateFromPicker(input, target);
        }
    },

    build: function() {
        this.wrapper = zen('div.cp-wrapper.cp-with-opacity.cp-mode-hue');
        this.slider = zen('div.cp-slider.cp-sprite').bottom(this.wrapper).appendChild(zen('div.cp-picker'));
        this.opacitySlider = zen('div.cp-opacity-slider.cp-sprite').bottom(this.wrapper).appendChild(zen('div.cp-picker'));
        this.grid = zen('div.cp-grid.cp-sprite').bottom(this.wrapper).appendChild(zen('div.cp-grid-inner')).appendChild(zen('div.cp-picker'));

        zen('div').bottom(this.grid.find('.cp-picker'));

        var tabs = zen('div.cp-tabs').bottom(this.wrapper);

        this.tabs = {
            hue: zen('div.cp-tab-hue.active').text('HUE').bottom(tabs),
            brightness: zen('div.cp-tab-brightness').text('BRI').bottom(tabs),
            saturation: zen('div.cp-tab-saturation').text('SAT').bottom(tabs),
            wheel: zen('div.cp-tab-wheel').text('WHEEL').bottom(tabs)
        };

        tabs.delegate('click', '> div', bind(function(event, element) {
            var active  = tabs.find('.active'),
                mode    = active.attribute('class').replace(/\s|active|cp-tab-/g, ''),
                newMode = element.attribute('class').replace(/\s|active|cp-tab-/g, '');

            this.wrapper.removeClass('cp-mode-' + mode).addClass('cp-mode-' + newMode);
            active.removeClass('active');
            element.addClass('active');

            this.mode = newMode;
            this.updateFromInput();
        }, this));

        this.wrapper.bottom('body');

        this.built = true;
        this.mode = 'hue';
    },

    updateFromInput: function(dontFireEvent, element) {
        element = this.element || element;
        var value   = element.value(),
            opacity = value.replace(/\s/g, '').match(/^rgba?\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},(.+)\)/),
            hex, hsb;

        value = rgbstr2hex(value) || value;
        opacity = opacity ? clamp(opacity[1], 0, 1) : 1;

        if (!(hex = parseHex(value))) { hex = '#ffff00'; }
        hsb = hex2hsb(hex);

        if (this.built) {
            // opacity
            this.opacity = opacity;
            var sliderHeight = this.opacitySlider.position().height;
            this.opacitySlider.find('.cp-picker').style({ 'top': clamp(sliderHeight - (sliderHeight * this.opacity), 0, sliderHeight) });

            // bg color
            var gridHeight = this.grid.position().height,
                gridWidth  = this.grid.position().width,
                r, phi, x, y;

            sliderHeight = this.slider.position().height;

            switch (this.mode) {
                case 'wheel':
                    // Set grid position
                    r = clamp(Math.ceil(hsb.s * 0.75), 0, gridHeight / 2);
                    phi = hsb.h * Math.PI / 180;
                    x = clamp(75 - Math.cos(phi) * r, 0, gridWidth);
                    y = clamp(75 - Math.sin(phi) * r, 0, gridHeight);
                    this.grid.style({ backgroundColor: 'transparent' }).find('.cp-picker').style({
                        top: y,
                        left: x
                    });

                    // Set slider position
                    y = 150 - (hsb.b / (100 / gridHeight));
                    if (hex === '') y = 0;
                    this.slider.find('.cp-picker').style({ top: y });

                    // Update panel color
                    this.slider.style({
                        backgroundColor: hsb2hex({
                            h: hsb.h,
                            s: hsb.s,
                            b: 100
                        })
                    });
                    break;

                case 'saturation':
                    // Set grid position
                    x = clamp((5 * hsb.h) / 12, 0, 150);
                    y = clamp(gridHeight - Math.ceil(hsb.b / (100 / gridHeight)), 0, gridHeight);
                    this.grid.find('.cp-picker').style({
                        top: y,
                        left: x
                    });

                    // Set slider position
                    y = clamp(sliderHeight - (hsb.s * (sliderHeight / 100)), 0, sliderHeight);
                    this.slider.find('.cp-picker').style({ top: y });

                    // Update UI
                    this.slider.style({
                        backgroundColor: hsb2hex({
                            h: hsb.h,
                            s: 100,
                            b: hsb.b
                        })
                    });
                    this.grid.find('.cp-grid-inner').style({ opacity: hsb.s / 100 });
                    break;

                case 'brightness':
                    // Set grid position
                    x = clamp((5 * hsb.h) / 12, 0, 150);
                    y = clamp(gridHeight - Math.ceil(hsb.s / (100 / gridHeight)), 0, gridHeight);
                    this.grid.find('.cp-picker').style({
                        top: y,
                        left: x
                    });

                    // Set slider position
                    y = clamp(sliderHeight - (hsb.b * (sliderHeight / 100)), 0, sliderHeight);
                    this.slider.find('.cp-picker').style({ top: y });

                    // Update UI
                    this.slider.style({
                        backgroundColor: hsb2hex({
                            h: hsb.h,
                            s: hsb.s,
                            b: 100
                        })
                    });
                    this.grid.find('.cp-grid-inner').style({ opacity: 1 - (hsb.b / 100) });
                    break;
                case 'hue':
                default:
                    // Set grid position
                    x = clamp(Math.ceil(hsb.s / (100 / gridWidth)), 0, gridWidth);
                    y = clamp(gridHeight - Math.ceil(hsb.b / (100 / gridHeight)), 0, gridHeight);
                    this.grid.find('.cp-picker').style({
                        top: y,
                        left: x
                    });

                    // Set slider position
                    y = clamp(sliderHeight - (hsb.h / (360 / sliderHeight)), 0, sliderHeight);
                    this.slider.find('.cp-picker').style({ top: y });

                    // Update panel color
                    this.grid.style({
                        backgroundColor: hsb2hex({
                            h: hsb.h,
                            s: 100,
                            b: 100
                        })
                    });
                    break;
            }
        }

        if (!dontFireEvent) { element.value(this.getValue(hex)); }

        this.emit('change', element, hex, opacity);

    },

    updateFromPicker: function(input, target) {
        var getCoords = function(picker, container) {

            var left, top;
            if (!picker.length || !container) return null;
            left = picker[0].getBoundingClientRect().left;
            top = picker[0].getBoundingClientRect().top;

            return {
                x: left - container[0].getBoundingClientRect().left + (picker[0].offsetWidth / 2),
                y: top - container[0].getBoundingClientRect().top + (picker[0].offsetHeight / 2)
            };

        };

        var hex, hue, saturation, brightness, x, y, r, phi,

            // Panel objects
            grid                = this.wrapper.find('.cp-grid'),
            slider              = this.wrapper.find('.cp-slider'),
            opacitySlider       = this.wrapper.find('.cp-opacity-slider'),

            // Picker objects
            gridPicker          = grid.find('.cp-picker'),
            sliderPicker        = slider.find('.cp-picker'),
            opacityPicker       = opacitySlider.find('.cp-picker'),

            // Picker positions
            gridPos             = getCoords(gridPicker, grid),
            sliderPos           = getCoords(sliderPicker, slider),
            opacityPos          = getCoords(opacityPicker, opacitySlider),

            // Sizes
            gridWidth           = grid[0].getBoundingClientRect().width,
            gridHeight          = grid[0].getBoundingClientRect().height,
            sliderHeight        = slider[0].getBoundingClientRect().height,
            opacitySliderHeight = opacitySlider[0].getBoundingClientRect().height;

        var value = this.element.value();
        value = rgbstr2hex(value) || value;
        if (!(hex = parseHex(value))) { hex = '#ffff00'; }

        // Handle colors
        if (target.hasClass('cp-grid') || target.hasClass('cp-slider')) {

            // Determine HSB values
            switch (this.mode) {
                case 'wheel':
                    // Calculate hue, saturation, and brightness
                    x = (gridWidth / 2) - gridPos.x;
                    y = (gridHeight / 2) - gridPos.y;
                    r = Math.sqrt(x * x + y * y);
                    phi = Math.atan2(y, x);
                    if (phi < 0) phi += Math.PI * 2;
                    if (r > 75) {
                        r = 75;
                        gridPos.x = 69 - (75 * Math.cos(phi));
                        gridPos.y = 69 - (75 * Math.sin(phi));
                    }
                    saturation = clamp(r / 0.75, 0, 100);
                    hue = clamp(phi * 180 / Math.PI, 0, 360);
                    brightness = clamp(100 - Math.floor(sliderPos.y * (100 / sliderHeight)), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.style({
                        backgroundColor: hsb2hex({
                            h: hue,
                            s: saturation,
                            b: 100
                        })
                    });
                    break;

                case 'saturation':
                    // Calculate hue, saturation, and brightness
                    hue = clamp(parseInt(gridPos.x * (360 / gridWidth), 10), 0, 360);
                    saturation = clamp(100 - Math.floor(sliderPos.y * (100 / sliderHeight)), 0, 100);
                    brightness = clamp(100 - Math.floor(gridPos.y * (100 / gridHeight)), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.style({
                        backgroundColor: hsb2hex({
                            h: hue,
                            s: 100,
                            b: brightness
                        })
                    });
                    grid.find('.cp-grid-inner').style({ opacity: saturation / 100 });
                    break;

                case 'brightness':
                    // Calculate hue, saturation, and brightness
                    hue = clamp(parseInt(gridPos.x * (360 / gridWidth), 10), 0, 360);
                    saturation = clamp(100 - Math.floor(gridPos.y * (100 / gridHeight)), 0, 100);
                    brightness = clamp(100 - Math.floor(sliderPos.y * (100 / sliderHeight)), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.style({
                        backgroundColor: hsb2hex({
                            h: hue,
                            s: saturation,
                            b: 100
                        })
                    });
                    grid.find('.cp-grid-inner').style({ opacity: 1 - (brightness / 100) });
                    break;

                default:
                    // Calculate hue, saturation, and brightness
                    hue = clamp(360 - parseInt(sliderPos.y * (360 / sliderHeight), 10), 0, 360);
                    saturation = clamp(Math.floor(gridPos.x * (100 / gridWidth)), 0, 100);
                    brightness = clamp(100 - Math.floor(gridPos.y * (100 / gridHeight)), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    grid.style({
                        backgroundColor: hsb2hex({
                            h: hue,
                            s: 100,
                            b: 100
                        })
                    });
                    break;

            }
        }

        // Handle opacity
        if (target.hasClass('cp-opacity-slider')) {
            this.opacity = parseFloat(1 - (opacityPos.y / opacitySliderHeight)).toFixed(2);
        }

        // Adjust case
        input.value(this.getValue(hex));

        // Handle change event
        this.emit('change', this.element, hex, this.opacity);

    },

    reposition: function() {
        var offset = this.element[0].getBoundingClientRect();
        this.wrapper.style({
            top: offset.top + offset.height + window.scrollY,
            left: offset.left + window.scrollX
        });
    },

    getValue: function(hex) {
        if (this.opacity == 1) { return hex; }
        var rgb = hex2rgb(hex);
        return 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + this.opacity + ')';
    }
});

// Parses a string and returns a valid hex string when possible
var parseHex = function(string) {
    string = string.replace(/[^A-F0-9]/ig, '');
    if (string.length !== 3 && string.length !== 6) return '';
    if (string.length === 3) {
        string = string[0] + string[0] + string[1] + string[1] + string[2] + string[2];
    }

    return '#' + string.toLowerCase();
};

// Converts an HSB object to an RGB object
var hsb2rgb = function(hsb) {
    var rgb = {};
    var h = Math.round(hsb.h);
    var s = Math.round(hsb.s * 255 / 100);
    var v = Math.round(hsb.b * 255 / 100);
    if (s === 0) {
        rgb.r = rgb.g = rgb.b = v;
    } else {
        var t1 = v;
        var t2 = (255 - s) * v / 255;
        var t3 = (t1 - t2) * (h % 60) / 60;
        if (h === 360) h = 0;
        if (h < 60) {
            rgb.r = t1;
            rgb.b = t2;
            rgb.g = t2 + t3;
        }
        else if (h < 120) {
            rgb.g = t1;
            rgb.b = t2;
            rgb.r = t1 - t3;
        }
        else if (h < 180) {
            rgb.g = t1;
            rgb.r = t2;
            rgb.b = t2 + t3;
        }
        else if (h < 240) {
            rgb.b = t1;
            rgb.r = t2;
            rgb.g = t1 - t3;
        }
        else if (h < 300) {
            rgb.b = t1;
            rgb.g = t2;
            rgb.r = t2 + t3;
        }
        else if (h < 360) {
            rgb.r = t1;
            rgb.g = t2;
            rgb.b = t1 - t3;
        }
        else {
            rgb.r = 0;
            rgb.g = 0;
            rgb.b = 0;
        }
    }
    return {
        r: Math.round(rgb.r),
        g: Math.round(rgb.g),
        b: Math.round(rgb.b)
    };
};

// Converts an RGB object to a hex string
var rgb2hex = function(rgb) {
    var hex = [
        rgb.r.toString(16),
        rgb.g.toString(16),
        rgb.b.toString(16)
    ];

    forEach(hex, function(val, nr) {
        if (val.length === 1) hex[nr] = '0' + val;
    });

    return '#' + hex.join('');
};

var rgbstr2hex = function(rgb) {
    rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return (rgb && rgb.length === 4) ? "#" +
    ("0" + parseInt(rgb[1], 10).toString(16)).slice(-2) +
    ("0" + parseInt(rgb[2], 10).toString(16)).slice(-2) +
    ("0" + parseInt(rgb[3], 10).toString(16)).slice(-2) : '';
};

// Converts an HSB object to a hex string
var hsb2hex = function(hsb) {
    return rgb2hex(hsb2rgb(hsb));
};

// Converts a hex string to an HSB object
var hex2hsb = function(hex) {
    var hsb = rgb2hsb(hex2rgb(hex));
    if (hsb.s === 0) hsb.h = 360;
    return hsb;
};

// Converts an RGB object to an HSB object
var rgb2hsb = function(rgb) {
    var hsb = {
        h: 0,
        s: 0,
        b: 0
    };
    var min = Math.min(rgb.r, rgb.g, rgb.b);
    var max = Math.max(rgb.r, rgb.g, rgb.b);
    var delta = max - min;
    hsb.b = max;
    hsb.s = max !== 0 ? 255 * delta / max : 0;
    if (hsb.s !== 0) {
        if (rgb.r === max) {
            hsb.h = (rgb.g - rgb.b) / delta;
        } else if (rgb.g === max) {
            hsb.h = 2 + (rgb.b - rgb.r) / delta;
        } else {
            hsb.h = 4 + (rgb.r - rgb.g) / delta;
        }
    } else {
        hsb.h = -1;
    }
    hsb.h *= 60;
    if (hsb.h < 0) {
        hsb.h += 360;
    }
    hsb.s *= 100 / 255;
    hsb.b *= 100 / 255;
    return hsb;
};

// Converts a hex string to an RGB object
var hex2rgb = function(hex) {
    hex = parseInt(((hex.indexOf('#') > -1) ? hex.substring(1) : hex), 16);
    return {
        /* jshint ignore:start */
        r: hex >> 16,
        g: (hex & 0x00FF00) >> 8,
        b: (hex & 0x0000FF)
        /* jshint ignore:end */
    };
};


ready(function() {
    var x = new ColorPicker(), body = $('body');
    x.on('change', function(element, hex, opacity) {
        clearTimeout(this.timer);
        var rgb   = hex2rgb(hex),
            yiq   = (((rgb.r * 299) + (rgb.g * 587) + (rgb.b * 114)) / 1000) >= 128 ? 'dark' : 'light',
            check = yiq == 'dark' || (!opacity || opacity < 0.35);

        if (opacity < 1) {
            var str = 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + opacity + ')';
            element.style({ backgroundColor: str });
        } else {
            element.style({ backgroundColor: hex });
        }

        element.parent('.colorpicker')[!check ? 'addClass' : 'removeClass']('light-text');

        this.timer = setTimeout(function() {
            element.emit('input');
            body.emit('input', { target: element });
        }, 150);

    });
});

module.exports = ColorPicker;

},{"../../ui/drag.events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/drag.events.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/collection/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/forEach.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/math/clamp":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/clamp.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/filepicker/index.js":[function(require,module,exports){
"use strict";

var $             = require('../../utils/elements.utils'),
    prime         = require('prime'),
    request       = require('agent'),
    zen           = require('elements/zen'),
    domready      = require('elements/domready'),
    bind          = require('mout/function/bind'),
    rtrim         = require('mout/string/rtrim'),
    deepClone     = require('mout/lang/deepClone'),
    deepFillIn    = require('mout/object/deepFillIn'),
    modal         = require('../../ui').modal,
    getAjaxSuffix = require('../../utils/get-ajax-suffix'),
    getAjaxURL    = require('../../utils/get-ajax-url').global,
    dropzone      = require('dropzone');

var FilePicker = new prime({
    constructor: function(element) {
        var data = element.data('g5-filepicker');
        this.data = data ? JSON.parse(data) : false;

        this.colors = {
            error: '#D84747',
            success: '#9ADF87',
            small: '#aaaaaa',
            gradient: ['#9e38eb', '#4e68fc']
        };

        //console.log(this.data);
    },

    open: function() {
        modal.open({
            method: 'post',
            data: this.data,
            content: 'Loading',
            className: 'g5-dialog-theme-default g5-modal-filepicker',
            remote: getAjaxURL('filepicker') + getAjaxSuffix(),
            remoteLoaded: bind(this.loaded, this),
            afterClose: bind(function() {
                if (this.dropzone) { this.dropzone.destroy(); }
            }, this)
        });
    },

    getPath: function() {
        var actives = this.content.search('.g-folders .active'), active, path;
        if (!actives) { return null; }

        active = $(actives[actives.length - 1]);
        path = JSON.parse(active.data('folder')).pathname;
        return rtrim(path, '/') + '/';
    },

    getPreviewTemplate: function() {
        var li    = zen('li[data-file]'),
            thumb = zen('div.g-thumb[data-dz-thumbnail]').bottom(li),
            name  = zen('span.g-file-name[data-dz-name]').bottom(li),
            size  = zen('span.g-file-size[data-dz-size]').bottom(li),
            mtime = zen('span.g-file-mtime[data-dz-mtime]').bottom(li);

        zen('span.g-file-progress[data-file-uploadprogress]').html('<span class="g-file-progress-text"></span>').bottom(li);

        li.bottom('body');
        var html = li[0].outerHTML;
        li.remove();

        return html;
    },

    loaded: function(response, modalInstance) {
        var content   = modalInstance.elements.content,
            bookmarks = content.search('.g-bookmark'),
            files     = content.find('.g-files'),
            fieldData = deepClone(this.data),
            colors    = this.colors;

        this.content = content;

        if (files) {
            this.dropzone = new dropzone('body', {
                previewTemplate: this.getPreviewTemplate(),
                previewsContainer: files.find('ul:not(.g-list-labels)')[0],
                thumbnailWidth: 100,
                thumbnailHeight: 100,
                url: bind(function(file) {
                    return getAjaxURL('filepicker/upload/' + this.getPath() + file[0].name) + getAjaxSuffix();
                }, this)
            });


            this.dropzone.on('thumbnail', function(file, dataUrl) {
                $(file.previewElement).find('[data-dz-thumbnail]').attribute('style', 'background-image: url(' + dataUrl + ');');
            });

            this.dropzone.on('addedfile', function(file) {
                var element      = $(file.previewElement),
                    uploader     = element.find('[data-file-uploadprogress]'),
                    isList       = files.hasClass('g-filemode-list'),
                    progressConf = {
                        value: 0,
                        animation: false,
                        insertLocation: 'bottom'
                    };

                if (!file.type.match(/image.*/)) {
                    var ext = file.name.split('.');
                    ext = (!ext.length || ext.length == 1) ? '-' : ext.reverse()[0];
                    element.find('.g-thumb').text(ext);
                }

                progressConf = deepFillIn((isList ? {
                    size: 20,
                    thickness: 10,
                    fill: {
                        color: colors.small,
                        gradient: false
                    }
                } : {
                    size: 50,
                    thickness: 'auto',
                    fill: {
                        gradient: colors.gradient,
                        color: false
                    }
                }), progressConf);

                element.addClass('g-file-uploading');
                uploader.progresser(progressConf);
                uploader.attribute('title', 'processing...').find('.g-file-progress-text').html('&bull;&bull;&bull;').attribute('title', 'processing...');

            }).on('processing', function(file) {

                var element = $(file.previewElement).find('[data-file-uploadprogress]');
                element.find('.g-file-progress-text').text('0%').attribute('title', '0%');

            }).on('sending', function(file, xhr, formData) {

                var element = $(file.previewElement).find('[data-file-uploadprogress]');
                element.attribute('title', '0%').find('.g-file-progress-text').text('0%').attribute('title', '0%');

            }).on('uploadprogress', function(file, progress, bytesSent) {

                var element = $(file.previewElement).find('[data-file-uploadprogress]');
                element.progresser({ value: progress / 100 });
                element.attribute('title', Math.round(progress) + '%').find('.g-file-progress-text').text(Math.round(progress) + '%').attribute('title', Math.round(progress) + '%');

            }).on('complete', function(file) {

            }).on('error', function(file, error) {
                var element  = $(file.previewElement),
                    uploader = element.find('[data-file-uploadprogress]'),
                    text     = element.find('.g-file-progress-text'),
                    isList   = files.hasClass('g-filemode-list');

                element.addClass('g-file-error');

                uploader.title('Error').progresser({
                    fill: {
                        color: colors.error,
                        gradient: false
                    },
                    value: 1,
                    thickness: isList ? 10 : 25
                });

                text.title('Error').html('<i class="fa fa-exclamation"></i>').parent('[data-file-uploadprogress]').popover({
                    content: error.html ? error.html : error,
                    placement: 'auto',
                    trigger: 'mouse',
                    style: 'above-modal',
                    width: 'auto',
                    targetEvents: false
                });

            }).on('success', function(file, response, xhr) {
                var element  = $(file.previewElement),
                    uploader = element.find('[data-file-uploadprogress]'),
                    mtime    = element.find('.g-file-mtime'),
                    text     = element.find('.g-file-progress-text'),
                    thumb    = element.find('.g-thumb'),
                    isList   = files.hasClass('g-filemode-list');

                uploader.progresser({
                    fill: {
                        color: colors.success,
                        gradient: false
                    },
                    value: 1,
                    thickness: isList ? 10 : 25
                });

                text.html('<i class="fa fa-check"></i>');

                setTimeout(bind(function() {
                    uploader.animate({ opacity: 0 }, { duration: 500 });
                    thumb.animate({ opacity: 1 }, {
                        duration: 500,
                        callback: function() {
                            element.removeClass('g-file-uploading');
                            uploader.remove();
                            mtime.text('just now');
                        }
                    });
                }, this), 500);
            });
        }

        content.delegate('click', '.g-bookmark-title', function(e, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            var sibling = element.nextSibling('.g-folders'),
                parent  = element.parent('.g-bookmark');

            if (!sibling) { return; }
            sibling.slideToggle(function() {
                parent.toggleClass('collapsed', sibling.gSlideCollapsed);
            });
        });

        content.delegate('click', '[data-folder]', bind(function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            var data = JSON.parse(element.data('folder'));

            fieldData.root = data.pathname;
            fieldData.subfolder = true;

            element.showIndicator('fa fa-li fa-fw fa-spin-fast fa-spinner');
            request(getAjaxURL('filepicker') + getAjaxSuffix(), fieldData).send(bind(function(error, response) {
                element.hideIndicator();
                this.addActiveState(element);

                if (!response.body.success) {
                    modal.open({
                        content: response.body.html || response.body,
                        afterOpen: function(container) {
                            if (!response.body.html) { container.style({ width: '90%' }); }
                        }
                    });
                } else {
                    var dummy, next;
                    if (response.body.subfolder) {
                        dummy = zen('div').html(response.body.subfolder);
                        next = element.nextSibling();

                        if (next && !next.attribute('data-folder')) { next.remove(); }
                        dummy.children().after(element);
                    }

                    if (response.body.files) {
                        files.empty();
                        dummy = zen('div').html(response.body.files);
                        dummy.children().bottom(files).style({ opacity: 0 }).animate({ opacity: 1 }, { duration: '250ms' });
                    } else {
                        files.find('> ul:not(.g-list-labels)').empty();
                    }

                    this.dropzone.previewsContainer = files.find('ul:not(.g-list-labels)')[0];
                }
            }, this));
        }, this));

        content.delegate('click', '[data-file]', bind(function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            if (element.hasClass('g-file-error') || element.hasClass('g-file-uploading')) { return; }
            var data = JSON.parse(element.data('file'));

            files.search('[data-file]').removeClass('selected');
            element.addClass('selected');
        }, this));

        content.delegate('click', '[data-select]', bind(function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            var selected = files.find('[data-file].selected'),
                value = selected ? selected.data('file-url') : '';

            $(this.data.field).value(value);
            modal.close();
        }, this));

        content.delegate('click', '[data-files-mode]', bind(function(event, element) {
            if (event && event.preventDefault) { event.preventDefault(); }
            if (element.hasClass('active')) { return; }

            var modes = $('[data-files-mode]');
            modes.removeClass('active');
            element.addClass('active');

            files.animate({ opacity: 0 }, {
                duration: 200,
                callback: function() {
                    var mode           = element.data('files-mode'),
                        uploadProgress = files.search('[data-file-uploadprogress]'),
                        progressConf   = (mode == 'list') ? {
                            size: 20,
                            thickness: 10,
                            fill: {
                                color: colors.small,
                                gradient: false
                            }
                        } : {
                            size: 50,
                            thickness: 'auto',
                            fill: {
                                gradient: colors.gradient,
                                color: false
                            }
                        };


                    files.attribute('class', 'g-files g-block g-filemode-' + mode);
                    if (uploadProgress) {
                        uploadProgress.forEach(function(element) {
                            element = $(element);
                            var config = deepClone(progressConf);

                            if (element.parent('.g-file-error')) {
                                config.fill = { color: colors.error };
                                config.value = 1;
                                config.thickness = mode == 'list' ? 10 : 25;
                            }

                            element.progresser(config);
                        });
                    }
                    files.animate({ opacity: 1 }, { duration: 200 });
                }
            });

        }, this));
    },

    addActiveState: function(element) {
        var opened = this.content.search('[data-folder].active, .g-folders > .active'), parent = element.parent();
        if (opened) { opened.removeClass('active'); }

        element.addClass('active');

        while (parent.tag() == 'ul' && !parent.hasClass('g-folders')) {
            parent.previousSibling().addClass('active');
            parent = parent.parent();
        }
    }
});

domready(function() {
    var body = $('body');
    body.delegate('click', '[data-g5-filepicker]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        element = $(element);
        if (!element.GantryFilePicker) {
            element.GantryFilePicker = new FilePicker(element);
        }

        element.GantryFilePicker.open();
    });
});


module.exports = FilePicker;
},{"../../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","../../utils/get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","../../utils/get-ajax-url":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-url.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","dropzone":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/dropzone/dist/dropzone.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/lang/deepClone":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepClone.js","mout/object/deepFillIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/deepFillIn.js","mout/string/rtrim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/rtrim.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/fonts/index.js":[function(require,module,exports){
"use strict";
// fonts list: https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyB2yJM8DBwt66u2MVRgb6M4t9CqkW7_IRY
var prime       = require('prime'),
    $           = require('../../utils/elements.utils'),
    zen         = require('elements/zen'),
    storage     = require('prime/map')(),
    Emitter     = require('prime/emitter'),
    Bound       = require('prime-util/prime/bound'),
    Options     = require('prime-util/prime/options'),
    domready    = require('elements/domready'),

    bind        = require('mout/function/bind'),
    map         = require('mout/array/map'),
    forEach     = require('mout/array/forEach'),
    contains    = require('mout/array/contains'),
    last        = require('mout/array/last'),
    split       = require('mout/array/split'),
    removeAll   = require('mout/array/removeAll'),
    insert      = require('mout/array/insert'),
    find        = require('mout/array/find'),
    combine     = require('mout/array/combine'),
    merge       = require('mout/object/merge'),

    unhyphenate = require('mout/string/unhyphenate'),
    properCase  = require('mout/string/properCase'),
    trim        = require('mout/string/trim'),

    modal       = require('../../ui').modal,
    async       = require('async'),

    request     = require('agent'),

    wf          = require('./webfont');

require('../../utils/elements.viewport');

var Fonts = new prime({

    mixin: Bound,

    inherits: Emitter,

    previewSentence: {
        'latin': 'Wizard boy Jack loves the grumpy Queen\'s fox.',
        'latin-ext': 'Wizard boy Jack loves the grumpy Queen\'s fox.',
        'cyrillic': '     ? ,   !',
        'cyrillic-ext': '     ? ,   !',
        'devanagari': '        ',
        'greek': '    ,    ',
        'greek-ext': '    ,    ',
        'khmer': ' ',
        'telugu': '   ',
        'vietnamese': 'Ti c th n thy tinh m khng hi g.'
    },

    constructor: function() {
        this.wf = wf;
        this.data = null;
        this.field = null;
        this.element = null;
        this.throttle = false;
        this.selected = null;
        this.loadedFonts = [];
        this.filters = {
            search: '',
            script: 'latin',
            categories: []
        };
    },

    open: function(event, element, container) {
        if (!this.data || !this.field) { return this.getData(element); }

        var list = [];
        forEach(this.data, function(value) {
            list.push(value.family);
        });

        if (container) {
            container.empty().attribute('style', null).appendChild(this.buildLayout());
            this.scroll(container.find('ul.g-fonts-list'));
            this.updateTotal();
            this.selectFromValue();
            return;
        }

        modal.open({
            content: 'Loading...',
            className: 'g5-dialog-theme-default g5-modal-fonts',
            afterOpen: bind(function(container) {
                setTimeout(bind(function() {
                    container.empty().appendChild(this.buildLayout());
                    this.scroll(container.find('ul.g-fonts-list'));
                    this.updateTotal();
                    this.selectFromValue();
                }, this), 1);
            }, this)
        });
    },

    getData: function(element) {
        var data = element.data('g5-fontpicker');
        if (!data) {
            throw new Error('No fontpicker data found');
        }

        data = JSON.parse(data);
        this.field = $(data.field);

        modal.open({
            content: 'Loading...',
            className: 'g5-dialog-theme-default g5-modal-fonts',
            remote: data.data,
            remoteLoaded: bind(function(response, instance) {
                if (response.error) {
                    instance.elements.content.html(response.body.html + '[' + data.data + ']');
                    return false;
                }

                this.data = response.body.items;

                this.open(null, element, instance.elements.content);
            }, this)
        });
    },

    scroll: function(container) {
        clearTimeout(this.throttle);
        this.throttle = setTimeout(bind(function() {
            var elements = (container.find('ul.g-fonts-list') || container).inviewport(' > li:not(.g-font-hide)', 5000),
                list = [];

            if (!elements) { return; }

            $(elements).forEach(function(element) {
                element = $(element);
                var dataFont = element.data('font'),
                    variant = element.data('variant');

                if (!contains(this.loadedFonts, dataFont)) { list.push(dataFont + (variant != 'regular' ? ':' + variant : '')); }
                else {
                    element.find('[data-variant="' + variant + '"] .preview').style({
                        fontFamily: dataFont,
                        fontWeight: variant == 'regular' ? 'normal' : variant
                    });
                }
            }, this);

            if (!list || !list.length) { return; }

            this.wf.load({
                classes: false,
                google: {
                    families: list
                },
                fontactive: bind(function(family, fvd) {
                    container.find('li[data-font="' + family + '"]:not(.g-variant-hide) > .preview').style({
                        fontFamily: family,
                        fontWeight: fvd
                    });
                    this.loadedFonts.push(family);
                }, this)
            });
        }, this), 250);
    },

    unselect: function(selected) {
        selected = selected || this.selected;
        if (!selected) { return false; }

        var baseVariant = selected.element.data('variant');
        selected.element.removeClass('selected');
        selected.element.search('input[type=checkbox]').checked(false);
        selected.element.search('[data-font]').addClass('g-variant-hide');
        selected.element.find('[data-variant="' + baseVariant + '"]').removeClass('g-variant-hide');
        selected.variants = [selected.baseVariant];
        selected.selected = [];
    },

    selectFromValue: function() {
        var value = this.field.value();

        if (!value.match('family=')) { return false; }

        var split = value.split('&'),
            family = split[0],
            split2 = family.split(':'),
            name = split2[0].replace('family=', '').replace(/\+/g, ' '),
            variants = split2[1] ? split2[1].split(',') : ['regular'],
            subset = split[1] ? split[1].replace('subset=', '').split(',') : ['latin'];

        if (contains(variants, '400')) {
            removeAll(variants, '400');
            insert(variants, 'regular');
        }
        if (contains(variants, '400italic')) {
            removeAll(variants, '400italic');
            insert(variants, 'italic');
        }

        var element = $('ul.g-fonts-list > [data-font="' + name + '"]');

        this.selected = {
            font: name,
            baseVariant: element.data('variant'),
            element: element,
            variants: variants,
            selected: [],
            charsets: subset,
            availableVariants: element.data('variants').split(','),
            expanded: false,
            loaded: false
        };

        variants.forEach(function(variant) {
            this.select(element, variant);
            element.find('> ul > [data-variant="' + variant + '"]').removeClass('g-variant-hide');
        }, this);

        var charsetSelected = element.find('.font-charsets-selected');
        if (charsetSelected) { charsetSelected.text('(' + subset.length + ' selected)'); }

        $('ul.g-fonts-list')[0].scrollTop = element[0].offsetTop;
        this.toggleExpansion();
        setTimeout(bind(function() { this.toggleExpansion(); }, this), 50);
    },

    select: function(element, variant/*, target*/) {
        var baseVariant = element.data('variant');

        if (!this.selected || this.selected.element != element) {
            if (variant && this.selected) {
                var charsetSelected = this.selected.element.find('.font-charsets-selected');
                if (charsetSelected) { charsetSelected.text('(1 selected)'); }
            }
            this.selected = {
                font: element.data('font'),
                baseVariant: baseVariant,
                element: element,
                variants: [baseVariant],
                selected: [],
                charsets: ['latin'],
                availableVariants: element.data('variants').split(','),
                expanded: false,
                loaded: false
            };
        }

        if (!variant) {
            this.toggleExpansion();
        }


        if (variant) {
            var selected = ($('ul.g-fonts-list > [data-font]:not([data-font="' + this.selected.font + '"]) input[type="checkbox"]:checked'));
            if (selected) {
                selected.checked(false);
                selected.parent('[data-variants]').removeClass('font-selected');
            }
            var checkbox = this.selected.element.find('input[type="checkbox"][value="' + variant + '"]'),
                checked = checkbox.checked();
            if (checkbox) {
                checkbox.checked(!checked);
            }

            if (!checked) {
                insert(this.selected.variants, variant);
                insert(this.selected.selected, variant);
            } else {
                if (variant != this.selected.baseVariant) { removeAll(this.selected.variants, variant); }
                removeAll(this.selected.selected, variant);
            }

            this.updateSelection();
        }
    },

    toggleExpansion: function() {
        if (this.selected.availableVariants.length <= 1) { return; }
        if (!this.selected.expanded) {
            var variants = this.selected.element.data('variants'), variant;
            if (variants.split(',').length > 1) {
                this.manipulateLink(this.selected.font);
                this.selected.element.search('[data-font]').removeClass('g-variant-hide');

                if (!this.selected.loaded) {
                    this.wf.load({
                        classes: false,
                        google: {
                            families: [this.selected.font.replace(/\s/g, '+') + ':' + variants]
                        },
                        fontactive: bind(function(family, fvd) {
                            var style = this.fvdToStyle(family, fvd),
                                search = style.fontWeight;

                            if (search == '400') {
                                search = style.fontStyle == 'normal' ? 'regular' : 'italic';
                            } else if (style.fontStyle == 'italic') {
                                search += 'italic';
                            }

                            this.selected.element.find('li[data-variant="' + search + '"] .preview').style(style);
                            this.selected.loaded = true;
                        }, this)
                    });
                }
            }
        } else {
            var exclude = ':not([data-variant="' + this.selected.variants.join('"]):not([data-variant="') + '"])';
            exclude = this.selected.element.search('[data-font]' + exclude);
            if (exclude) { exclude.addClass('g-variant-hide'); }
        }

        this.selected.expanded = !this.selected.expanded;
    },

    manipulateLink: function(family) {
        family = family.replace(/\s/g, '+');
        var link = $('head link[href*="' + family + '"]');
        if (!link) { return; }

        var parts = decodeURIComponent(link.href()).split('|');
        if (!parts || parts.length <= 1) { return; }

        removeAll(parts, family);

        link.attribute('href', encodeURI(parts.join('|')));
    },

    toggle: function(event, element) {
        element = $(element);
        var target = $(event.target);

        if (target.attribute('type') == 'checkbox') {
            target.checked(!target.checked());
        }

        this.select(element.parent('[data-font]') || element, element.parent('[data-font]') ? element.data('variant') : false, element);

        return false;
    },

    updateSelection: function() {
        var preview = $('.g-particles-footer .font-selected'), selected;
        if (!preview) { return; }

        if (!this.selected.selected.length) {
            preview.empty();
            this.selected.element.removeClass('font-selected');
            return;
        }

        selected = this.selected.selected.sort();
        this.selected.element.addClass('font-selected');
        preview.html('<strong>' + this.selected.font + '</strong> (<small>' + selected.join(', ').replace('regular', 'normal') + '</small>)');
    },

    updateTotal: function() {
        var totals = $('.g-particles-header .particle-search-total'),
            count = $('.g-fonts-list > [data-font]:not(.g-font-hide)');

        totals.text(count ? count.length : 0);
    },

    buildLayout: function() {
        this.filters.script = 'latin';
        var previewSentence = this.previewSentence[this.filters.script],
            html = zen('div#g-fonts.g-grid'),
            main = zen('div.g-particles-main').bottom(html),
            ul = zen('ul.g-fonts-list').bottom(main),
            families = [], list, categories = [], subsets = [];


        this.buildHeader(html).top(html);
        this.buildFooter(html).bottom(html);

        ul.on('scroll', bind(this.scroll, this, ul));

        html.delegate('click', '.g-fonts-list li[data-font]', bind(this.toggle, this));

        async.eachSeries(this.data, bind(function(font, callback) {
            combine(subsets, font.subsets);
            insert(categories, font.category);
            this.filters.categories.push(font.category);
            var variants = font.variants.join(',').replace('regular', 'normal'),
                variant = contains(font.variants, 'regular') ? '' : ':' + font.variants[0],
                li = zen('li[data-font="' + font.family + '"][data-variant="' + (variant.replace(':', '') || 'regular') + '"][data-variants="' + variants + '"]').bottom(ul),
                total = font.variants.length + ' style' + (font.variants.length > 1 ? 's' : ''),
                charsets = font.subsets.length > 1 ? ', <span class="font-charsets">' + font.subsets.length + ' charsets <span class="font-charsets-selected">(1 selected)</span></span>' : '';

            var family = zen('div.family').html('<strong>' + font.family + '</strong>, ' + total + charsets).bottom(li),
                charset = family.find('.font-charsets-selected');

            if (charset) {
                charset.popover({
                    placement: 'auto',
                    width: '200',
                    trigger: 'mouse',
                    style: 'font-categories, above-modal'
                }).on('beforeshow.popover', bind(function(popover) {
                    var subsets = font.subsets,
                        content = popover.$target.find('.g5-popover-content'),
                        checked;

                    content.empty();

                    var div, current;
                    subsets.forEach(function(cs) {
                        current = contains(this.selected.charsets, cs) ? (cs == 'latin' ? 'checked disabled' : 'checked') : '';
                        zen('div').html('<label><input type="checkbox" ' + current + ' value="' + cs + '"/> ' + properCase(unhyphenate(cs.replace('ext', 'extended'))) + '</label>').bottom(content);
                    }, this);

                    content.delegate('click', 'input[type="checkbox"]', bind(function(event, input) {
                        input = $(input);
                        checked = content.search('input[type="checkbox"]:checked');
                        this.selected.charsets = checked ? checked.map('value') : [];
                        charset.text('(' + this.selected.charsets.length + ' selected)');
                    }, this));

                    popover.displayContent();
                }, this));
            }

            var variantContainer = zen('ul').bottom(li), variantFont, label;
            async.each(font.variants, bind(function(current) {
                variantFont = zen('li[data-font="' + font.family + '"][data-variant="' + current + '"]').bottom(variantContainer);
                zen('input[type="checkbox"][value="' + current + '"]').bottom(variantFont);
                zen('div.variant').html('<small>' + this.mapVariant(current) + '</small>').bottom(variantFont);
                zen('div.preview').text(previewSentence).bottom(variantFont);

                if (':' + current !== variant && current !== (variant || 'regular')) { variantFont.addClass('g-variant-hide'); }
            }, this));

            if (!contains(font.subsets, 'latin')) {
                li.addClass('g-font-hide');
            }

            families.push(font.family + variant);
            callback();
        }, this));

        var catContainer = html.find('a.font-category'), subContainer = html.find('a.font-subsets');

        catContainer.data('font-categories', categories.join(',')).html('Categories (<small>' + categories.length + '</small>) <i class="fa fa-caret-down"></i>');
        subContainer.data('font-subsets', subsets.join(',')).html('Subsets (<small>' + properCase(unhyphenate(this.filters.script.replace('ext', 'extended'))) + '</small>) <i class="fa fa-caret-down"></i>');

        return html;
    },

    buildHeader: function(html) {
        var container = zen('div.settings-block.g-particles-header').bottom(html),
            preview = zen('input.float-left.font-preview[type="text"][data-font-preview][placeholder="Font Preview..."][value="' + this.previewSentence[this.filters.script] + '"]').bottom(container),
            searchWrapper = zen('span.particle-search-wrapper.float-right').bottom(container),
            search = zen('input.font-search[type="text"][data-font-search][placeholder="Search Font..."]').bottom(searchWrapper);
        zen('span.particle-search-total').bottom(searchWrapper);

        search.on('keyup', bind(this.search, this, search));
        preview.on('keyup', bind(this.updatePreview, this, preview));

        return container;
    },

    buildFooter: function(html) {
        var container = zen('div.settings-block.g-particles-footer').bottom(html),
            leftContainer = zen('div.float-left.font-left-container').bottom(container),
            rightContainer = zen('div.float-right.font-right-container').bottom(container),
            category = zen('a.font-category.button').bottom(leftContainer),
            subsets = zen('a.font-subsets.button').bottom(leftContainer),
            selected = zen('span.font-selected').bottom(rightContainer),
            select = zen('button.button.button-primary').text('Select').bottom(rightContainer),
            current;

        zen('span').html('&nbsp;').bottom(rightContainer);
        zen('button.button.g5-dialog-close').text('Cancel').bottom(rightContainer);

        select.on('click', bind(function() {
            if (!$('ul.g-fonts-list > [data-font] input[type="checkbox"]:checked')) {
                this.field.value('');
                modal.close();
                return;
            }

            var name = this.selected.font.replace(/\s/g, '+'),
                variation = this.selected.selected,
                charset = this.selected.charsets;

            if (variation.length == 1 && variation[0] == 'regular') { variation = []; }
            if (charset.length == 1 && charset[0] == 'latin') { charset = []; }

            if (contains(variation, 'regular')) {
                removeAll(variation, 'regular');
                insert(variation, '400');
            }
            if (contains(variation, 'italic')) {
                removeAll(variation, 'italic');
                insert(variation, '400italic');
            }

            this.field.value('family=' + name + (variation.length ? ':' + variation.join(',') : '') + (charset.length ? '&subset=' + charset.join(',') : ''));

            this.field.emit('input');
            $('body').emit('input', {target: this.field});

            modal.close();
        }, this));

        category.popover({
            placement: 'top',
            width: '200',
            trigger: 'mouse',
            style: 'font-categories, above-modal'
        }).on('beforeshow.popover', bind(function(popover) {
            var categories = category.data('font-categories').split(','),
                content = popover.$target.find('.g5-popover-content'),
                checked;

            content.empty();

            var div;
            categories.forEach(function(category) {
                current = contains(this.filters.categories, category) ? 'checked' : '';
                zen('div').html('<label><input type="checkbox" ' + current + ' value="' + category + '"/> ' + properCase(unhyphenate(category)) + '</label>').bottom(content);
            }, this);

            content.delegate('click', 'input[type="checkbox"]', bind(function(event, input) {
                input = $(input);
                checked = content.search('input[type="checkbox"]:checked');
                this.filters.categories = checked ? checked.map('value') : [];
                category.find('small').text(this.filters.categories.length);
                this.search();
            }, this));

            popover.displayContent();
        }, this));

        subsets.popover({
            placement: 'top',
            width: '200',
            trigger: 'mouse',
            style: 'font-subsets, above-modal'
        }).on('beforeshow.popover', bind(function(popover) {
            var subs = subsets.data('font-subsets').split(','),
                content = popover.$target.find('.g5-popover-content');

            content.empty();

            var div;
            subs.forEach(function(sub) {
                current = sub == this.filters.script ? 'checked' : '';
                zen('div').html('<label><input name="font-subset[]" type="radio" ' + current + ' value="' + sub + '"/> ' + properCase(unhyphenate(sub.replace('ext', 'extended'))) + '</label>').bottom(content);
            }, this);

            content.delegate('change', 'input[type="radio"]', bind(function(event, input) {
                input = $(input);
                this.filters.script = input.value();
                $('.g-particles-header input.font-preview').value(this.previewSentence[this.filters.script]);
                subsets.find('small').text(properCase(unhyphenate(input.value().replace('ext', 'extended'))));
                this.search();
                this.updatePreview();
            }, this));

            popover.displayContent();
        }, this));

        return container;
    },

    search: function(input) {
        input = input || $('.g-particles-header input.font-search');
        var list = $('.g-fonts-list'),
            value = input.value(),
            name, data;

        list.search('> [data-font]').forEach(function(font) {
            font = $(font);
            name = font.data('font');
            data = find(this.data, { family: name });
            font.removeClass('g-font-hide');

            // We dont want to hide selected fonts
            if (this.selected && this.selected.font == name && this.selected.selected.length) { return; }

            // Filter by Subset
            if (!contains(data.subsets, this.filters.script)) {
                font.addClass('g-font-hide');
                return;
            }

            // Filter by Category
            if (!contains(this.filters.categories, data.category)) {
                font.addClass('g-font-hide');
                return;
            }

            // Filter by Name
            if (!name.match(new RegExp("^" + value + '|\\s' + value, 'gi'))) {
                font.addClass('g-font-hide');
            } else {
                font.removeClass('g-font-hide');
            }
        }, this);

        this.updateTotal();

        clearTimeout(input.refreshTimer);

        input.refreshTimer = setTimeout(bind(function() {
            this.scroll($('ul.g-fonts-list'));
        }, this), 400);

        input.previousValue = value;
    },

    updatePreview: function(input) {
        input = input || $('.g-particles-header input.font-preview');

        clearTimeout(input.refreshTimer);

        var value = input.value(),
            list = $('.g-fonts-list');

        value = trim(value) ? trim(value) : this.previewSentence[this.filters.script];

        if (input.previousValue == value) { return true; }

        list.search('[data-font] .preview').text(value);

        input.previousValue = value;
    },

    fvdToStyle: function(family, fvd) {
        var match = fvd.match(/([a-z])([0-9])/);
        if (!match) return '';

        var styleMap = {
            n: 'normal',
            i: 'italic',
            o: 'oblique'
        };
        return {
            fontFamily: family,
            fontStyle: styleMap[match[1]],
            fontWeight: (match[2] * 100).toString()
        }
    },

    mapVariant: function(variant) {
        switch (variant) {
            case '100':
                return 'Thin 100';
                break;
            case '100italic':
                return 'Thin 100 Italic';
                break;
            case '200':
                return 'Extra-Light 200';
                break;
            case '200italic':
                return 'Extra-Light 200 Italic';
                break;
            case '300':
                return 'Light 300';
                break;
            case '300italic':
                return 'Light 300 Italic';
                break;
            case '400':
            case 'regular':
                return 'Normal 400';
                break;
            case '400italic':
            case 'italic':
                return 'Normal 400 Italic';
                break;
            case '500':
                return 'Medium 500';
                break;
            case '500italic':
                return 'Medium 500 Italic';
                break;
            case '600':
                return 'Semi-Bold 600';
                break;
            case '600italic':
                return 'Semi-Bold 600 Italic';
                break;
            case '700':
                return 'Bold 700';
                break;
            case '700italic':
                return 'Bold 700 Italic';
                break;
            case '800':
                return 'Extra-Bold 800';
                break;
            case '800italic':
                return 'Extra-Bold 800 Italic';
                break;
            case '900':
                return 'Ultra-Bold 900';
                break;
            case '900italic':
                return 'Ultra-Bold 900 Italic';
                break;
            default:
                return 'Unknown Variant';
        }
    }
});

domready(function() {
    var body = $('body');
    body.delegate('click', '[data-g5-fontpicker]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var FontPicker = storage.get(element);
        if (!FontPicker) {
            FontPicker = new Fonts();
            storage.set(element, FontPicker);
        }

        FontPicker.open(event, element);
    });
});

module.exports = Fonts;
},{"../../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","../../utils/elements.viewport":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.viewport.js","./webfont":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/fonts/webfont.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","async":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/async/lib/async.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/combine":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/combine.js","mout/array/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","mout/array/find":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/find.js","mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/forEach.js","mout/array/insert":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/insert.js","mout/array/last":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/last.js","mout/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/map.js","mout/array/removeAll":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/removeAll.js","mout/array/split":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/split.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/object/merge":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js","mout/string/properCase":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/properCase.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js","mout/string/unhyphenate":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/unhyphenate.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js","prime/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/map.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/fonts/webfont.js":[function(require,module,exports){
/* Web Font Loader v1.5.14 - (c) Adobe Systems, Google. License: Apache 2.0 */
;(function(window,document,undefined){function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function k(a,b,c){k=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return k.apply(null,arguments)}var n=Date.now||function(){return+new Date};function q(a,b){this.J=a;this.t=b||a;this.C=this.t.document}q.prototype.createElement=function(a,b,c){a=this.C.createElement(a);if(b)for(var d in b)b.hasOwnProperty(d)&&("style"==d?a.style.cssText=b[d]:a.setAttribute(d,b[d]));c&&a.appendChild(this.C.createTextNode(c));return a};function r(a,b,c){a=a.C.getElementsByTagName(b)[0];a||(a=document.documentElement);a&&a.lastChild&&a.insertBefore(c,a.lastChild)}function ca(a,b){function c(){a.C.body?b():setTimeout(c,0)}c()}
    function s(a,b,c){b=b||[];c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}b=[];for(e=0;e<d.length;e+=1){f=!1;for(g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function t(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}
    function u(a){if("string"===typeof a.ma)return a.ma;var b=a.t.location.protocol;"about:"==b&&(b=a.J.location.protocol);return"https:"==b?"https:":"http:"}function v(a,b){var c=a.createElement("link",{rel:"stylesheet",href:b}),d=!1;c.onload=function(){d||(d=!0)};c.onerror=function(){d||(d=!0)};r(a,"head",c)}
    function w(a,b,c,d){var e=a.C.getElementsByTagName("head")[0];if(e){var f=a.createElement("script",{src:b}),g=!1;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))};e.appendChild(f);window.setTimeout(function(){g||(g=!0,c&&c(Error("Script load timeout")))},d||5E3);return f}return null};function x(a,b){this.X=a;this.fa=b};function y(a,b,c,d){this.c=null!=a?a:null;this.g=null!=b?b:null;this.A=null!=c?c:null;this.e=null!=d?d:null}var da=/^([0-9]+)(?:[\._-]([0-9]+))?(?:[\._-]([0-9]+))?(?:[\._+-]?(.*))?$/;y.prototype.compare=function(a){return this.c>a.c||this.c===a.c&&this.g>a.g||this.c===a.c&&this.g===a.g&&this.A>a.A?1:this.c<a.c||this.c===a.c&&this.g<a.g||this.c===a.c&&this.g===a.g&&this.A<a.A?-1:0};y.prototype.toString=function(){return[this.c,this.g||"",this.A||"",this.e||""].join("")};
    function z(a){a=da.exec(a);var b=null,c=null,d=null,e=null;a&&(null!==a[1]&&a[1]&&(b=parseInt(a[1],10)),null!==a[2]&&a[2]&&(c=parseInt(a[2],10)),null!==a[3]&&a[3]&&(d=parseInt(a[3],10)),null!==a[4]&&a[4]&&(e=/^[0-9]+$/.test(a[4])?parseInt(a[4],10):a[4]));return new y(b,c,d,e)};function A(a,b,c,d,e,f,g,h){this.M=a;this.k=h}A.prototype.getName=function(){return this.M};function B(a){this.a=a}var ea=new A("Unknown",0,0,0,0,0,0,new x(!1,!1));
    B.prototype.parse=function(){var a;if(-1!=this.a.indexOf("MSIE")||-1!=this.a.indexOf("Trident/")){a=C(this);var b=z(D(this)),c=null,d=E(this.a,/Trident\/([\d\w\.]+)/,1),c=-1!=this.a.indexOf("MSIE")?z(E(this.a,/MSIE ([\d\w\.]+)/,1)):z(E(this.a,/rv:([\d\w\.]+)/,1));""!=d&&z(d);a=new A("MSIE",0,0,0,0,0,0,new x("Windows"==a&&6<=c.c||"Windows Phone"==a&&8<=b.c,!1))}else if(-1!=this.a.indexOf("Opera"))a:if(a=z(E(this.a,/Presto\/([\d\w\.]+)/,1)),z(D(this)),null!==a.c||z(E(this.a,/rv:([^\)]+)/,1)),-1!=this.a.indexOf("Opera Mini/"))a=
        z(E(this.a,/Opera Mini\/([\d\.]+)/,1)),a=new A("OperaMini",0,0,0,C(this),0,0,new x(!1,!1));else{if(-1!=this.a.indexOf("Version/")&&(a=z(E(this.a,/Version\/([\d\.]+)/,1)),null!==a.c)){a=new A("Opera",0,0,0,C(this),0,0,new x(10<=a.c,!1));break a}a=z(E(this.a,/Opera[\/ ]([\d\.]+)/,1));a=null!==a.c?new A("Opera",0,0,0,C(this),0,0,new x(10<=a.c,!1)):new A("Opera",0,0,0,C(this),0,0,new x(!1,!1))}else/OPR\/[\d.]+/.test(this.a)?a=F(this):/AppleWeb(K|k)it/.test(this.a)?a=F(this):-1!=this.a.indexOf("Gecko")?
        (a="Unknown",b=new y,z(D(this)),b=!1,-1!=this.a.indexOf("Firefox")?(a="Firefox",b=z(E(this.a,/Firefox\/([\d\w\.]+)/,1)),b=3<=b.c&&5<=b.g):-1!=this.a.indexOf("Mozilla")&&(a="Mozilla"),c=z(E(this.a,/rv:([^\)]+)/,1)),b||(b=1<c.c||1==c.c&&9<c.g||1==c.c&&9==c.g&&2<=c.A),a=new A(a,0,0,0,C(this),0,0,new x(b,!1))):a=ea;return a};
    function C(a){var b=E(a.a,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);if(""!=b)return/BB\d{2}/.test(b)&&(b="BlackBerry"),b;a=E(a.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS|PlayStation|CrKey)/,1);return""!=a?("Mac_PowerPC"==a?a="Macintosh":"PlayStation"==a&&(a="Linux"),a):"Unknown"}
    function D(a){var b=E(a.a,/(OS X|Windows NT|Android) ([^;)]+)/,2);if(b||(b=E(a.a,/Windows Phone( OS)? ([^;)]+)/,2))||(b=E(a.a,/(iPhone )?OS ([\d_]+)/,2)))return b;if(b=E(a.a,/(?:Linux|CrOS|CrKey) ([^;)]+)/,1))for(var b=b.split(/\s/),c=0;c<b.length;c+=1)if(/^[\d\._]+$/.test(b[c]))return b[c];return(a=E(a.a,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?a:"Unknown"}
    function F(a){var b=C(a),c=z(D(a)),d=z(E(a.a,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,1)),e="Unknown",f=new y,f="Unknown",g=!1;/OPR\/[\d.]+/.test(a.a)?e="Opera":-1!=a.a.indexOf("Chrome")||-1!=a.a.indexOf("CrMo")||-1!=a.a.indexOf("CriOS")?e="Chrome":/Silk\/\d/.test(a.a)?e="Silk":"BlackBerry"==b||"Android"==b?e="BuiltinBrowser":-1!=a.a.indexOf("PhantomJS")?e="PhantomJS":-1!=a.a.indexOf("Safari")?e="Safari":-1!=a.a.indexOf("AdobeAIR")?e="AdobeAIR":-1!=a.a.indexOf("PlayStation")&&(e="BuiltinBrowser");"BuiltinBrowser"==
    e?f="Unknown":"Silk"==e?f=E(a.a,/Silk\/([\d\._]+)/,1):"Chrome"==e?f=E(a.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):-1!=a.a.indexOf("Version/")?f=E(a.a,/Version\/([\d\.\w]+)/,1):"AdobeAIR"==e?f=E(a.a,/AdobeAIR\/([\d\.]+)/,1):"Opera"==e?f=E(a.a,/OPR\/([\d.]+)/,1):"PhantomJS"==e&&(f=E(a.a,/PhantomJS\/([\d.]+)/,1));f=z(f);g="AdobeAIR"==e?2<f.c||2==f.c&&5<=f.g:"BlackBerry"==b?10<=c.c:"Android"==b?2<c.c||2==c.c&&1<c.g:526<=d.c||525<=d.c&&13<=d.g;return new A(e,0,0,0,0,0,0,new x(g,536>d.c||536==d.c&&11>d.g))}
    function E(a,b,c){return(a=a.match(b))&&a[c]?a[c]:""};function G(a){this.la=a||"-"}G.prototype.e=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.la)};function H(a,b){this.M=a;this.Y=4;this.N="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.N=c[1],this.Y=parseInt(c[2],10))}H.prototype.getName=function(){return this.M};function I(a){return a.N+a.Y}function ga(a){var b=4,c="n",d=null;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b};function ha(a,b){this.d=a;this.p=a.t.document.documentElement;this.P=b;this.j="wf";this.h=new G("-");this.ga=!1!==b.events;this.B=!1!==b.classes}function J(a){if(a.B){var b=t(a.p,a.h.e(a.j,"active")),c=[],d=[a.h.e(a.j,"loading")];b||c.push(a.h.e(a.j,"inactive"));s(a.p,c,d)}K(a,"inactive")}function K(a,b,c){if(a.ga&&a.P[b])if(c)a.P[b](c.getName(),I(c));else a.P[b]()};function ia(){this.w={}};function L(a,b){this.d=a;this.G=b;this.m=this.d.createElement("span",{"aria-hidden":"true"},this.G)}function M(a){r(a.d,"body",a.m)}
    function N(a){var b;b=[];for(var c=a.M.split(/,\s*/),d=0;d<c.length;d++){var e=c[d].replace(/['"]/g,"");-1==e.indexOf(" ")?b.push(e):b.push("'"+e+"'")}b=b.join(",");c="normal";"o"===a.N?c="oblique":"i"===a.N&&(c="italic");return"display:block;position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b+";"+("font-style:"+c+";font-weight:"+(a.Y+"00")+";")}
    L.prototype.remove=function(){var a=this.m;a.parentNode&&a.parentNode.removeChild(a)};function O(a,b,c,d,e,f,g,h){this.Z=a;this.ja=b;this.d=c;this.s=d;this.G=h||"BESbswy";this.k=e;this.I={};this.W=f||3E3;this.ba=g||null;this.F=this.D=null;a=new L(this.d,this.G);M(a);for(var m in P)P.hasOwnProperty(m)&&(b=new H(P[m],I(this.s)),b=N(b),a.m.style.cssText=b,this.I[P[m]]=a.m.offsetWidth);a.remove()}var P={ra:"serif",qa:"sans-serif",pa:"monospace"};
    O.prototype.start=function(){this.D=new L(this.d,this.G);M(this.D);this.F=new L(this.d,this.G);M(this.F);this.na=n();var a=new H(this.s.getName()+",serif",I(this.s)),a=N(a);this.D.m.style.cssText=a;a=new H(this.s.getName()+",sans-serif",I(this.s));a=N(a);this.F.m.style.cssText=a;Q(this)};function R(a,b,c){for(var d in P)if(P.hasOwnProperty(d)&&b===a.I[P[d]]&&c===a.I[P[d]])return!0;return!1}
    function Q(a){var b=a.D.m.offsetWidth,c=a.F.m.offsetWidth;b===a.I.serif&&c===a.I["sans-serif"]||a.k.fa&&R(a,b,c)?n()-a.na>=a.W?a.k.fa&&R(a,b,c)&&(null===a.ba||a.ba.hasOwnProperty(a.s.getName()))?S(a,a.Z):S(a,a.ja):ja(a):S(a,a.Z)}function ja(a){setTimeout(k(function(){Q(this)},a),25)}function S(a,b){a.D.remove();a.F.remove();b(a.s)};function T(a,b,c,d){this.d=b;this.u=c;this.R=0;this.da=this.aa=!1;this.W=d;this.k=a.k}function ka(a,b,c,d,e){c=c||{};if(0===b.length&&e)J(a.u);else for(a.R+=b.length,e&&(a.aa=e),e=0;e<b.length;e++){var f=b[e],g=c[f.getName()],h=a.u,m=f;h.B&&s(h.p,[h.h.e(h.j,m.getName(),I(m).toString(),"loading")]);K(h,"fontloading",m);h=null;h=new O(k(a.ha,a),k(a.ia,a),a.d,f,a.k,a.W,d,g);h.start()}}
    T.prototype.ha=function(a){var b=this.u;b.B&&s(b.p,[b.h.e(b.j,a.getName(),I(a).toString(),"active")],[b.h.e(b.j,a.getName(),I(a).toString(),"loading"),b.h.e(b.j,a.getName(),I(a).toString(),"inactive")]);K(b,"fontactive",a);this.da=!0;la(this)};
    T.prototype.ia=function(a){var b=this.u;if(b.B){var c=t(b.p,b.h.e(b.j,a.getName(),I(a).toString(),"active")),d=[],e=[b.h.e(b.j,a.getName(),I(a).toString(),"loading")];c||d.push(b.h.e(b.j,a.getName(),I(a).toString(),"inactive"));s(b.p,d,e)}K(b,"fontinactive",a);la(this)};function la(a){0==--a.R&&a.aa&&(a.da?(a=a.u,a.B&&s(a.p,[a.h.e(a.j,"active")],[a.h.e(a.j,"loading"),a.h.e(a.j,"inactive")]),K(a,"active")):J(a.u))};function U(a){this.J=a;this.v=new ia;this.oa=new B(a.navigator.userAgent);this.a=this.oa.parse();this.T=this.U=0;this.Q=this.S=!0}
    U.prototype.load=function(a){this.d=new q(this.J,a.context||this.J);this.S=!1!==a.events;this.Q=!1!==a.classes;var b=new ha(this.d,a),c=[],d=a.timeout;b.B&&s(b.p,[b.h.e(b.j,"loading")]);K(b,"loading");var c=this.v,e=this.d,f=[],g;for(g in a)if(a.hasOwnProperty(g)){var h=c.w[g];h&&f.push(h(a[g],e))}c=f;this.T=this.U=c.length;a=new T(this.a,this.d,b,d);d=0;for(g=c.length;d<g;d++)e=c[d],e.K(this.a,k(this.ka,this,e,b,a))};
    U.prototype.ka=function(a,b,c,d){var e=this;d?a.load(function(a,b,d){ma(e,c,a,b,d)}):(a=0==--this.U,this.T--,a&&0==this.T?J(b):(this.Q||this.S)&&ka(c,[],{},null,a))};function ma(a,b,c,d,e){var f=0==--a.U;(a.Q||a.S)&&setTimeout(function(){ka(b,c,d||null,e||null,f)},0)};function na(a,b,c){this.O=a?a:b+oa;this.q=[];this.V=[];this.ea=c||""}var oa="//fonts.googleapis.com/css";na.prototype.e=function(){if(0==this.q.length)throw Error("No fonts to load!");if(-1!=this.O.indexOf("kit="))return this.O;for(var a=this.q.length,b=[],c=0;c<a;c++)b.push(this.q[c].replace(/ /g,"+"));a=this.O+"?family="+b.join("%7C");0<this.V.length&&(a+="&subset="+this.V.join(","));0<this.ea.length&&(a+="&text="+encodeURIComponent(this.ea));return a};function pa(a){this.q=a;this.ca=[];this.L={}}
    var qa={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},ra={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},sa={i:"i",italic:"i",n:"n",normal:"n"},ta=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
    pa.prototype.parse=function(){for(var a=this.q.length,b=0;b<a;b++){var c=this.q[b].split(":"),d=c[0].replace(/\+/g," "),e=["n4"];if(2<=c.length){var f;var g=c[1];f=[];if(g)for(var g=g.split(","),h=g.length,m=0;m<h;m++){var l;l=g[m];if(l.match(/^[\w-]+$/)){l=ta.exec(l.toLowerCase());var p=void 0;if(null==l)p="";else{p=void 0;p=l[1];if(null==p||""==p)p="4";else var fa=ra[p],p=fa?fa:isNaN(p)?"4":p.substr(0,1);l=l[2];p=[null==l||""==l?"n":sa[l],p].join("")}l=p}else l="";l&&f.push(l)}0<f.length&&(e=f);
        3==c.length&&(c=c[2],f=[],c=c?c.split(","):f,0<c.length&&(c=qa[c[0]])&&(this.L[d]=c))}this.L[d]||(c=qa[d])&&(this.L[d]=c);for(c=0;c<e.length;c+=1)this.ca.push(new H(d,e[c]))}};function V(a,b){this.a=(new B(navigator.userAgent)).parse();this.d=a;this.f=b}var ua={Arimo:!0,Cousine:!0,Tinos:!0};V.prototype.K=function(a,b){b(a.k.X)};V.prototype.load=function(a){var b=this.d;"MSIE"==this.a.getName()&&1!=this.f.blocking?ca(b,k(this.$,this,a)):this.$(a)};
    V.prototype.$=function(a){for(var b=this.d,c=new na(this.f.api,u(b),this.f.text),d=this.f.families,e=d.length,f=0;f<e;f++){var g=d[f].split(":");3==g.length&&c.V.push(g.pop());var h="";2==g.length&&""!=g[1]&&(h=":");c.q.push(g.join(h))}d=new pa(d);d.parse();v(b,c.e());a(d.ca,d.L,ua)};function W(a,b){this.d=a;this.f=b;this.o=[]}W.prototype.H=function(a){var b=this.d;return u(this.d)+(this.f.api||"//f.fontdeck.com/s/css/js/")+(b.t.location.hostname||b.J.location.hostname)+"/"+a+".js"};
    W.prototype.K=function(a,b){var c=this.f.id,d=this.d.t,e=this;c?(d.__webfontfontdeckmodule__||(d.__webfontfontdeckmodule__={}),d.__webfontfontdeckmodule__[c]=function(a,c){for(var d=0,m=c.fonts.length;d<m;++d){var l=c.fonts[d];e.o.push(new H(l.name,ga("font-weight:"+l.weight+";font-style:"+l.style)))}b(a)},w(this.d,this.H(c),function(a){a&&b(!1)})):b(!1)};W.prototype.load=function(a){a(this.o)};function X(a,b){this.d=a;this.f=b;this.o=[]}X.prototype.H=function(a){var b=u(this.d);return(this.f.api||b+"//use.typekit.net")+"/"+a+".js"};X.prototype.K=function(a,b){var c=this.f.id,d=this.d.t,e=this;c?w(this.d,this.H(c),function(a){if(a)b(!1);else{if(d.Typekit&&d.Typekit.config&&d.Typekit.config.fn){a=d.Typekit.config.fn;for(var c=0;c<a.length;c+=2)for(var h=a[c],m=a[c+1],l=0;l<m.length;l++)e.o.push(new H(h,m[l]));try{d.Typekit.load({events:!1,classes:!1})}catch(p){}}b(!0)}},2E3):b(!1)};
    X.prototype.load=function(a){a(this.o)};function Y(a,b){this.d=a;this.f=b;this.o=[]}Y.prototype.K=function(a,b){var c=this,d=c.f.projectId,e=c.f.version;if(d){var f=c.d.t;w(this.d,c.H(d,e),function(e){if(e)b(!1);else{if(f["__mti_fntLst"+d]&&(e=f["__mti_fntLst"+d]()))for(var h=0;h<e.length;h++)c.o.push(new H(e[h].fontfamily));b(a.k.X)}}).id="__MonotypeAPIScript__"+d}else b(!1)};Y.prototype.H=function(a,b){var c=u(this.d),d=(this.f.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+d+"/"+a+".js"+(b?"?v="+b:"")};
    Y.prototype.load=function(a){a(this.o)};function Z(a,b){this.d=a;this.f=b}Z.prototype.load=function(a){var b,c,d=this.f.urls||[],e=this.f.families||[],f=this.f.testStrings||{};b=0;for(c=d.length;b<c;b++)v(this.d,d[b]);d=[];b=0;for(c=e.length;b<c;b++){var g=e[b].split(":");if(g[1])for(var h=g[1].split(","),m=0;m<h.length;m+=1)d.push(new H(g[0],h[m]));else d.push(new H(g[0]))}a(d,f)};Z.prototype.K=function(a,b){return b(a.k.X)};var $=new U(this);$.v.w.custom=function(a,b){return new Z(b,a)};$.v.w.fontdeck=function(a,b){return new W(b,a)};$.v.w.monotype=function(a,b){return new Y(b,a)};$.v.w.typekit=function(a,b){return new X(b,a)};$.v.w.google=function(a,b){return new V(b,a)};this.WebFont||(this.WebFont={},this.WebFont.load=k($.load,$),this.WebFontConfig&&$.load(this.WebFontConfig));})(this,document);


module.exports = window.WebFont;
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/icons/index.js":[function(require,module,exports){
"use strict";
var $             = require('../../utils/elements.utils'),
    domready      = require('elements/domready'),
    modal         = require('../../ui').modal,
    getAjaxSuffix = require('../../utils/get-ajax-suffix'),
    getAjaxURL    = require('../../utils/get-ajax-url').global,

    trim          = require('mout/string/trim'),
    contains      = require('mout/array/contains');

domready(function() {
    var body = $('body');
    body.delegate('keyup', '.g-icons input[type="text"]', function(event, element){
        element = $(element);
        var preview = element.sibling('[data-g5-iconpicker]'),
            value = element.value(),
            size;

        preview.attribute('class', value || 'fa fa-hand-o-up picker');

        size = preview[0].offsetWidth;

        if (!size) { preview.attribute('class', 'fa fa-hand-o-up picker'); }
    });

    body.delegate('click', '[data-g5-iconpicker]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        element = $(element);
        var field = $(element.data('g5-iconpicker')),
            realPreview = element,
            value = trim(field.value()).replace(/\s{2,}/g, ' ').split(' ');

        modal.open({
            content: 'Loading',
            className: 'g5-dialog-theme-default g5-modal-icons',
            remote: getAjaxURL('icons') + getAjaxSuffix(),
            afterClose: function() {
                var popovers = $('.g5-popover');
                if (popovers) { popovers.remove(); }
            },
            remoteLoaded: function(response, content) {
                var html, large,
                    container = content.elements.content,
                    icons = container.search('[data-g-icon]');

                if (!icons || !response.body.success) {
                    container.html(response.body.html || response.body);
                    return false;
                }

                var updatePreview = function() {
                    var data = [],
                        active = container.find('[data-g-icon].active'),
                        options = container.search('.g-particles-header .float-right input:checked, .g-particles-header .float-right select');

                    if (active) { data.push(active.data('g-icon')); }
                    if (options) {
                        options.forEach(function(option) {
                            var v = $(option).value();
                            if (v && v !== 'fa-') { data.push(v); }
                        });
                    }

                    container.find('.g-icon-preview').html('<i class="fa ' + data.join(' ') + '"></i> <span>' + data[0] + '</span>');
                };

                var updateTotal = function() {
                    var total = container.search('[data-g-icon]:not(.hide-icon)');
                    container.find('.particle-search-total').text(total ? total.length : 0);
                };

                container.delegate('click', '[data-g-icon]', function(event, element) {
                    if (event && event.preventDefault) { event.preventDefault(); }
                    element = $(element);

                    var active = container.find('[data-g-icon].active');
                    if (active) { active.removeClass('active'); }

                    element.addClass('active');

                    updatePreview();
                });

                container.delegate('click', '[data-g-select]', function(event){
                    event.preventDefault();

                    var output = container.find('.g-icon-preview i');
                    field.value(output.attribute('class'));
                    realPreview.find('i').attribute('class', output.attribute('class'));

                    field.emit('input');

                    $('body').emit('input', {target: field});

                    modal.close();
                });

                container.delegate('change', '.g-particles-header .float-right input[type="checkbox"], .g-particles-header .float-right select', function(/*e, input*/) {
                    updatePreview();
                });

                container.delegate('keyup', '.particle-search-wrapper input[type="text"]', function(e, input) {
                    input = $(input);
                    var value = input.value(),
                        hidden = container.search('[data-g-icon].hide-icon');

                    if (!value) {
                        if (hidden) {
                            hidden.removeClass('hide-icon');
                            updateTotal();
                        }
                        return true;
                    }

                    var found = container.search('[data-g-icon*="' + value + '"]');
                    container.search('[data-g-icon]').addClass('hide-icon');
                    if (found) {
                        found.removeClass('hide-icon');
                    }

                    updateTotal();

                });

                icons.forEach(function(icon) {
                    icon = $(icon);
                    html = '';
                    for (var i = 5, l = 0; i > l; i--) {
                        large = (!i) ? 'lg' : i + 'x';
                        html += '<i class="fa ' + icon.data('g-icon') + ' fa-' + large + '"></i> ';
                    }

                    icon.popover({
                        content: html,
                        placement: 'auto',
                        trigger: 'mouse',
                        style: 'above-modal, icons-preview',
                        width: 'auto',
                        targetEvents: false,
                        delay: 1
                    }).on('hidden.popover', function(instance) {
                        if (instance.$target) { instance.$target.remove(); }
                    });

                    if (contains(value, icon.data('g-icon'))) {
                        // set active icon
                        icon.addClass('active');

                        // toggle options
                        value.forEach(function(name) {
                            var field = container.find('[name="' + name + '"]');
                            if (field) { field.checked(true); }
                            else {
                                field = container.find('option[value="' + name + '"]');
                                if (field) { field.parent().value(name); }
                            }
                        });

                        // scroll into place of active icon
                        var wrap = icon.parent('.icons-wrapper'),
                            wrapHeight = wrap[0].offsetHeight;
                        wrap[0].scrollTop = icon[0].offsetTop - (wrapHeight / 2);

                        // update preview
                        updatePreview();
                    }
                });
            }
        });
    });
});

module.exports = {};
},{"../../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","../../utils/get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","../../utils/get-ajax-url":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-url.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","mout/array/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/index.js":[function(require,module,exports){
"use strict";

module.exports = {
    colorpicker: require('./colorpicker'),
    fonts: require('./fonts'),
    menu: require('./menu'),
    icons: require('./icons'),
    filepicker: require('./filepicker'),
    collections: require('./collections'),
    keyvalue: require('./keyvalue')
};
},{"./collections":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/collections/index.js","./colorpicker":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/colorpicker/index.js","./filepicker":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/filepicker/index.js","./fonts":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/fonts/index.js","./icons":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/icons/index.js","./keyvalue":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/keyvalue/index.js","./menu":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/menu/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/keyvalue/index.js":[function(require,module,exports){
"use strict";

var ready         = require('elements/domready'),
    $             = require('elements'),
    zen           = require('elements/zen'),
    has           = require('mout/object/has'),
    some          = require('mout/array/some'),
    modal         = require('../../ui').modal,
    toastr        = require('../../ui').toastr,
    request       = require('agent'),
    indexOf       = require('mout/array/indexOf'),
    contains      = require('mout/array/contains'),
    lastItem      = require('mout/array/last'),
    simpleSort    = require('sortablejs'),
    escapeUnicode = require('mout/string/escapeUnicode'),

    trim          = require('mout/string/trim'),

    getAjaxSuffix = require('../../utils/get-ajax-suffix');

require('elements/insertion');

ready(function() {
    var body = $('body');

    var createSortables = function(list) {
        var lists = list || $('.g-keyvalue-field ul');
        if (!lists) { return; }
        lists.forEach(function(list) {
            list = $(list);
            list.SimpleSort = simpleSort.create(list[0], {
                handle: '.fa-reorder',
                filter: '[data-keyvalue-nosort]',
                scroll: false,
                animation: 150,
                onStart: function() {
                    $(this.el).addClass('keyvalue-sorting');
                },
                onEnd: function(evt) {
                    var element = $(this.el);
                    element.removeClass('keyvalue-sorting');

                    if (evt.oldIndex === evt.newIndex) { return; }

                    var dataField = element.parent('.settings-param').find('[data-keyvalue-data]'),
                        data      = dataField.value();

                    data = JSON.parse(data);

                    data.splice(evt.newIndex, 0, data.splice(evt.oldIndex, 1)[0]);
                    dataField.value(JSON.stringify(data));
                    body.emit('change', { target: dataField });
                }
            });
        });
    };

    createSortables();

    // delegate sortables collections for ajax support
    body.delegate('mouseover', '.g-keyvalue-field ul', function(event, element) {
        if (!element.SimpleSort) { createSortables(element); }
    });

    // Add new item
    body.delegate('click', '[data-keyvalue-addnew]', function(event, element) {
        var param = element.parent('.settings-param'),
            list  = param.find('ul'),
            tmpl  = param.find('[data-keyvalue-template]'),
            items = list.search('> [data-keyvalue-item]') || [],
            last  = $(lastItem(items));

        var clone = $(tmpl[0].cloneNode(true));

        if (last) { clone.after(last); }
        else { clone.top(list); }

        clone.attribute('style', null).data('keyvalue-item', clone.data('keyvalue-template'));
        clone.attribute('data-keyvalue-template', null);
        clone.attribute('data-keyvalue-nosort', null);
        clone.find('[data-keyvalue-key]')[0].focus();

        //body.emit('change', { target: dataField });
    });

    // Remove item
    body.delegate('click', '[data-keyvalue-remove]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var item      = element.parent('[data-keyvalue-item]'),
            key       = item.find('input[type="text"]').data('keyvalue-key'),
            dataField = element.parent('.settings-param').find('[data-keyvalue-data]'),
            items     = element.parent('ul').search('> [data-keyvalue-item]'),
            index     = indexOf(items, item[0]),
            data      = JSON.parse(dataField.value());

        data.splice(index, 1);
        dataField.value(escapeUnicode(JSON.stringify(data)));
        item.remove();

        body.emit('change', { target: dataField });
    });

    // Change values
    body.delegate('blur', '[data-keyvalue-item] input[type="text"]', function(event, element) {
        var parent     = element.parent('[data-keyvalue-item]'),
            wrapper    = parent.find('.g-keyvalue-wrapper'),
            keyElement = parent.find('[data-keyvalue-key]'),
            valElement = parent.find('[data-keyvalue-value]'),
            key        = keyElement.data('keyvalue-key'),
            keyValue   = trim(keyElement.value()),
            valValue   = trim(valElement.value()),
            items     = element.parent('ul').search('> [data-keyvalue-item]:not(.g-keyvalue-warning):not(.g-keyvalue-excluded)'),
            index     = indexOf(items, parent[0]),

            dataField  = element.parent('.settings-param').find('[data-keyvalue-data]'),
            data       = JSON.parse(dataField.value()),
            exclude    = JSON.parse(dataField.data('keyvalue-exclude')),
            excluded   = contains(exclude, keyValue),
            duplicate  = some(data, function(obj) { return has(obj, keyValue); }) && key !== keyValue;

        if (keyElement == element) {
            // renamed or cleared key, need to cleanup JSON
            if (key !== keyValue && !duplicate) {
                data.splice(index, 1);
                keyElement.data('keyvalue-key', keyValue || '');
            }

            parent[duplicate ? 'addClass' : 'removeClass']('g-keyvalue-warning');
            parent[excluded ? 'addClass' : 'removeClass']('g-keyvalue-excluded');

            wrapper[excluded || duplicate ? 'addClass' : 'removeClass']('g-tooltip');
            wrapper.data('title', duplicate ? 'The key "' + keyValue + '" is a duplicate' : (excluded ? 'The key "' + keyValue + '" has been excluded and cannot be used' : null));
        }

        if (keyValue && !excluded && !duplicate) {
            if (!data[index]) { data.splice(index, 0, {}); }
            data[index][keyValue] = valValue;
        }

        dataField.value(escapeUnicode(JSON.stringify(data)));
        body.emit('change', { target: dataField });

    }, true);

});

module.exports = {};

},{"../../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../../utils/get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/insertion":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/insertion.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","mout/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/indexOf.js","mout/array/last":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/last.js","mout/array/some":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/some.js","mout/object/has":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/has.js","mout/string/escapeUnicode":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/escapeUnicode.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js","sortablejs":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/sortablejs/Sortable.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/particles/menu/index.js":[function(require,module,exports){
"use strict";
var $             = require('../../utils/elements.utils'),
    domready      = require('elements/domready');

domready(function() {
    var body = $('body');
    body.delegate('click', '[data-g5-content] .g-main-nav .g-toplevel [data-g5-ajaxify]', function(event, element) {
        if (event && event.preventDefault) { event.preventDefault(); }
        var items = $('[data-g5-content] .g-main-nav .g-toplevel [data-g5-ajaxify] !> li');
        if (items) { items.removeClass('active'); }
        element.parent('li').addClass('active');
    });
});

module.exports = {};
},{"../../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/styles/index.js":[function(require,module,exports){
"use strict";
var ready = require('elements/domready'),
    $ = require('elements/attributes'),
    modal = require('../ui').modal,
    contains = require('mout/array/contains'),
    forEach = require('mout/collection/forEach');

require('../ui/popover');

var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1,
    FOCUSIN   = isFirefox ? 'focus' : 'focusin';

ready(function() {

    var body = $('body');

    body.delegate('click', '[data-g-styles]', function(event, element) {
        var target = $(event.target);
        if (event && event.preventDefault) { event.preventDefault(); }
        if (target.hasClass('swatch-preview') || target.parent('.swatch-preview')) { return true; }
        ;
        var data = JSON.parse(element.data('g-styles')), input, value, type, evt;
        forEach(data, function(preset, name) {
            input = $('[name="' + name + '"]');
            value = input ? input.value() : false;

            if (!input || value === preset) { return; }

            evt = {
                target: input,
                forceOverride: true
            };

            type = (input.tag() == 'select' || contains(['hidden', 'checkbox'], input.type())) ? 'change' : 'input';

            input.value(preset);
            body.emit(type, evt);
            body.emit('keyup', evt);
        });
    });

    body.delegate('click', '[data-g-styles] .swatch-preview', function(event, element) {
        var image = element.parent('[data-g-styles]').find('img');
        if (!image) { return false; }

        modal.open({
            content: image[0].outerHTML,
            afterOpen: function(container) {
                var padding = parseInt(container.compute('padding-left'), 10) + parseInt(container.compute('padding-right'), 10);
                container.style({
                    maxWidth: '80%',
                    width: padding + (image[0].naturalWidth || image[0].width)
                });
            }
        });
    });

});

module.exports = {};

},{"../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../ui/popover":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/popover.js","elements/attributes":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/attributes.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","mout/array/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","mout/collection/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/forEach.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/drag.drop.js":[function(require,module,exports){
"use strict";

var prime      = require('prime'),
    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),
    bind       = require('mout/function/bind'),
    contains   = require('mout/array/contains'),
    DragEvents = require('./drag.events'),
    $          = require('../utils/elements.utils');

// $ utils
require('elements/events');
require('elements/delegation');

var isIE = (navigator.appName === "Microsoft Internet Explorer");

var DragDrop = new prime({

    mixin: [Bound, Options],
    inherits: Emitter,

    options: {
        delegate: null,
        droppables: false,
        catchClick: false
    },

    DRAG_EVENTS: DragEvents,

    constructor: function(container, options) {
        this.container = $(container);
        if (!this.container) { return; }
        this.setOptions(options);

        this.element = null;
        this.origin = {
            x: 0,
            y: 0,
            transform: null,
            offset: {
                x: 0,
                y: 0
            }
        };

        this.matched = false;
        this.lastMatched = false;
        this.lastOvered = null;

        this.attach();
    },

    attach: function() {
        this.DRAG_EVENTS.EVENTS.START.forEach(bind(function(event) {
            this.container.delegate(event, this.options.delegate, this.bound('start'));
        }, this));
    },

    detach: function() {
        this.DRAG_EVENTS.EVENTS.START.forEach(bind(function(event) {
            this.container.undelegate(event, this.options.delegate, this.bound('start'));
        }, this));
    },

    start: function(event, element) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        clearTimeout(this.scrollInterval);
        if (element.LMTooltip) { element.LMTooltip.remove(); }
        $('html').attribute('style', 'height: 100% !important');
        this.scrollHeight = document.body.scrollHeight;

        // Prevents dragging a column from itself and limiting to its handle
        var target = $(event.target);
        if (!element.parent('[data-lm-root]') && element.hasClass('g-block') && (!target.matches('.submenu-reorder') && !target.parent('.submenu-reorder'))) { return true; }

        if (event.which && event.which !== 1 || $(event.target).matches(this.options.exclude)) { return true; }
        this.element = $(element);
        this.matched = false;
        if (this.options.catchClick) { this.moved = false; }

        // we force the menu column reorder handle to the g-block parent
        if (target.matches('.submenu-reorder') || target.parent('.submenu-reorder')) {
            this.element = target.parent('[data-mm-id]');
        }

        this.emit('dragdrop:beforestart', event, this.element);

        // Stops default MS touch actions since preventDefault doesn't work
        if (isIE) {
            this.element.style({
                '-ms-touch-action': 'none',
                'touch-action': 'none'
            });
        }

        // Stops text selection
        event.preventDefault();

        this.origin = {
            x: event.changedTouches ? event.changedTouches[0].pageX : event.pageX,
            y: event.changedTouches ? event.changedTouches[0].pageY : event.pageY,
            transform: this.element.compute('transform')
        };

        var clientRect = this.element[0].getBoundingClientRect();
        this.origin.offset = {
            clientRect: clientRect,
            x: this.origin.x - clientRect.right,
            y: clientRect.top - this.origin.y
        };

        // Only allow to sort grids when targeting the left handle
        if (this.element.data('lm-blocktype') === 'grid' && Math.abs(this.origin.offset.x) < clientRect.width) {
            return false;
        }

        var offset  = Math.abs(this.origin.offset.x),
            columns = (this.element.parent().data('lm-blocktype') === 'grid' && this.element.parent().parent().data('lm-root')) ||
                (this.element.parent().parent().data('lm-blocktype') == 'container' && this.element.parent().parent().parent().data('lm-root'));

        if (
            this.element.data('lm-blocktype') == 'grid' &&
            (this.element.parent().data('lm-blocktype') === 'container' && this.element.parent().parent().parent().data('lm-root')) ||
            (this.element.parent().data('lm-blocktype') === 'section' && this.element.parent().parent().parent().data('lm-root'))
        ) { columns = false; }

        // Resizing and only if it's not a non-visible (atoms) section
        if ((offset < 6 && this.element.parent().find(':last-child') !== this.element) || (columns && offset > 3 && offset < 10)) {
            if (this.element.parent('[data-lm-blocktype="atoms"]')) { return false; }

            this.emit('dragdrop:resize', event, this.element, (this.element.parent('[data-mm-id]') || this.element).siblings(':not(.placeholder)'), this.origin.offset.x);
            return false;
        }

        if (columns || (element.hasClass('submenu-column') && (!target.matches('.submenu-reorder') && !target.parent('.submenu-reorder')))) { return true; }

        this.element.style({
            'pointer-events': 'none',
            zIndex: 100
        });

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).on(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).on(event, this.bound('stop'));
        }, this));

        this.emit('dragdrop:start', event, this.element);

        return this.element;
    },

    stop: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        clearTimeout(this.scrollInterval);
        $('html').attribute('style', null);
        if (!this.moved && this.options.catchClick) {
            // this is just a click
            this.element.style({ transform: this.origin.transform || 'translate(0, 0)' });
            this.emit('dragdrop:stop', event, this.matched, this.element);
            this._removeStyleAttribute(this.element);
            this.emit('dragdrop:stop:animation', this.element);
            this.emit('dragdrop:click', event, this.element);

            this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
                $(document).off(event, this.bound('move'));
            }, this));

            this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
                $(document).off(event, this.bound('stop'));
            }, this));

            this.element = null;

            return;
        }

        var settings = { duration: '250ms' };

        if (this.removeElement) {
            this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
                $(document).off(event, this.bound('move'));
            }, this));

            this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
                $(document).off(event, this.bound('stop'));
            }, this));

            return this.emit('dragdrop:stop:erase', event, this.element);
        }

        if (this.element) {

            this.emit('dragdrop:stop', event, this.matched, this.element);

            if (this.matched) {
                this.element.style({
                    opacity: 0,
                    transform: 'translate(0, 0)'
                }).removeClass('active');
            }

            if (!this.matched) {

                settings.callback = bind(function(element) {
                    this._removeStyleAttribute(element);
                    setTimeout(bind(function() {
                        this.emit('dragdrop:stop:animation', element);
                    }, this), 1);
                }, this, this.element);

                this.element.animate({
                    transform: this.origin.transform || 'translate(0, 0)',
                    opacity: 1
                }, settings);
            } else {

                this.element.style({
                    transform: this.origin.transform || 'translate(0, 0)',
                    opacity: 1
                });

                this._removeStyleAttribute(this.element);
                this.emit('dragdrop:stop:animation', this.element);
            }
        }

        this.DRAG_EVENTS.EVENTS.MOVE.forEach(bind(function(event) {
            $(document).off(event, this.bound('move'));
        }, this));

        this.DRAG_EVENTS.EVENTS.STOP.forEach(bind(function(event) {
            $(document).off(event, this.bound('stop'));
        }, this));

        this.element = null;
    },

    move: function(event) {
        if (event && event.type.match(/^touch/i)) { event.preventDefault(); }

        if (this.options.catchClick) {
            var didItMove = {
                x: event.changedTouches ? event.changedTouches[0].pageX : event.pageX,
                y: event.changedTouches ? event.changedTouches[0].pageY : event.pageY
            };

            if (Math.abs(didItMove.x - this.origin.x) <= 3 && Math.abs(didItMove.y - this.origin.y) <= 3) {
                return;
            }

            if (!this.moved) {
                this.element.style({ opacity: 0.5 });
                this.emit('dragdrop:move:once', this.element);
            }

            this.moved = true;
        }

        var clientX = event.clientX || (event.touches && event.touches[0].clientX) || 0,
            clientY = event.clientY || (event.touches && event.touches[0].clientY) || 0,
            overing = document.elementFromPoint(clientX, clientY),
            isGrid  = this.element.data('lm-blocktype') === 'grid';


        // Logic to auto-scroll on drag
        var scrollHeight = this.scrollHeight,
            Height       = document.body.clientHeight,
            Scroll       = document.body.scrollTop;

        clearTimeout(this.scrollInterval);
        if (!overing) { return; }

        if (!$(overing).matches('#trash') && !$(overing).parent('#trash')) {
            var st, sl, trash = $('#g5-container #trash');
            if (clientY + 50 >= Height && Scroll + Height < scrollHeight) {
                this.scrollInterval = setInterval(function() {
                    sl = (window.pageXOffset || document.documentElement.scrollLeft) - (document.documentElement.clientLeft || 0);
                    st = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
                    window.scrollTo(sl, Math.min(scrollHeight, st + 4));
                }, 8);
            } else if (clientY - 50 <= (trash ? trash[0].offsetHeight : 0) && scrollHeight > 0) {
                this.scrollInterval = setInterval(function() {
                    sl = (window.pageXOffset || document.documentElement.scrollLeft) - (document.documentElement.clientLeft || 0);
                    st = (window.pageYOffset || document.documentElement.scrollTop) - (document.documentElement.clientTop || 0);
                    window.scrollTo(sl, Math.max(0, st - 4));
                }, 8);
            }
        }

        // We tweak the overing to take into account the negative offset for the handle
        if (isGrid) {
            // More accurate is: clientX + (this.element[0].getBoundingClientRect().left - clientX)
            overing = document.elementFromPoint(clientX + 30, clientY);
        }

        if (!overing) { return false; }

        this.matched = $(overing).matches(this.options.droppables) ? overing : ($(overing).parent(this.options.droppables) || [false])[0];
        this.isPlaceHolder = $(overing).matches('[data-lm-placeholder]') ? true : ($(overing).parent('[data-lm-placeholder]') ? true : false);

        var deltaX    = this.lastX - clientX,
            deltaY    = this.lastY - clientY,
            direction = Math.abs(deltaX) > Math.abs(deltaY) && deltaX > 0 && 'left' ||
                Math.abs(deltaX) > Math.abs(deltaY) && deltaX < 0 && 'right' ||
                Math.abs(deltaY) > Math.abs(deltaX) && deltaY > 0 && 'up' ||
                'down';


        deltaX = (event.changedTouches ? event.changedTouches[0].pageX : event.pageX) - this.origin.x;
        deltaY = (event.changedTouches ? event.changedTouches[0].pageY : event.pageY) - this.origin.y;

        this.direction = direction;
        this.element.style({ transform: 'translate(' + deltaX + 'px, ' + deltaY + 'px)' });

        if (!this.isPlaceHolder) {
            if (this.lastMatched && this.matched !== this.lastMatched) {
                this.emit('dragdrop:leave', event, this.lastMatched, this.element);
                this.lastMatched = false;
            }

            if (this.matched && this.matched !== this.lastMatched && overing !== this.lastOvered) {
                this.emit('dragdrop:enter', event, this.matched, this.element);
                this.lastMatched = this.matched;
            }

            if (this.matched && this.lastMatched) {
                var rect = this.matched.getBoundingClientRect();
                // Note: you can divide x axis by 3 rather than 2 for 4 directions
                var location = {
                    x: Math.abs((clientX - rect.left)) < (rect.width / 2) && 'before' ||
                    Math.abs((clientX - rect.left)) >= (rect.width - (rect.width / 2)) && 'after' ||
                    'other',
                    y: Math.abs((clientY - rect.top)) < (rect.height / 2) && 'above' ||
                    Math.abs((clientY - rect.top)) >= (rect.height / 2) && 'below' ||
                    'other'
                };

                this.emit('dragdrop:location', event, location, this.matched, this.element);
            } else {
                this.emit('dragdrop:nolocation', event);
            }
        }

        this.lastOvered = overing;
        this.lastX = clientX;
        this.lastY = clientY;

        this.emit('dragdrop:move', event, this.element);
    },

    _removeStyleAttribute: function(element) {
        element = $(element || this.element);
        if (element.data('mm-id')) { return; }

        element.attribute('style', null);//.style({flex: flex});
    }

});

module.exports = DragDrop;

},{"../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","./drag.events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/drag.events.js","elements/delegation":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/delegation.js","elements/events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/events.js","mout/array/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/drag.events.js":[function(require,module,exports){
"use strict";
var getSupportedEvent = function(events) {
    events = events.split(' ');

    var element = document.createElement('div'), event;
    var isSupported = false;

    for (var i = events.length - 1; i >= 0; i--) {
        event = 'on' + events[i];
        isSupported = (event in element);

        if (!isSupported) {
            element.setAttribute(event, 'return;');
            isSupported = typeof element[event] === 'function';
        }

        if (isSupported) {
            isSupported = events[i];
            break;
        }
    }

    element = null;
    return isSupported;
};

var getSupportedEvents = function(events) {
    events = events.split(' ');

    var isSupported = false, supported = [];
    for (var i = events.length - 1; i >= 0; i--) {
        isSupported = getSupportedEvent(events[i]);
        if (isSupported) { supported.push(isSupported); }
    }

    return supported;
};

var EVENT = {
        START: getSupportedEvent('mousedown touchstart MSPointerDown pointerdown'),
        MOVE: getSupportedEvent('mousemove touchmove MSPointerMove pointermove'),
        STOP: getSupportedEvent('mouseup touchend MSPointerUp pointerup')
    },
    EVENTS = {
        START: getSupportedEvents('mousedown touchstart MSPointerDown pointerdown'),
        MOVE: getSupportedEvents('mousemove touchmove MSPointerMove pointermove'),
        STOP: getSupportedEvents('mouseup touchend MSPointerUp pointerup')
    };


module.exports = {
    EVENT: EVENT,
    EVENTS: EVENTS
};

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js":[function(require,module,exports){
"use strict";

var Modal = require('./modal'),
    Selectize = require('./selectize');

module.exports = {
    modal: new Modal(),
    togglers: require('./togglers'),
    selectize: Selectize,
    toastr: require('./toastr')
};

},{"./modal":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/modal.js","./selectize":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/selectize.js","./toastr":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/toastr.js","./togglers":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/togglers.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/modal.js":[function(require,module,exports){
"use strict";
// Based on Vex (https://github.com/hubspot/vex)

var prime    = require('prime'),
    $        = require('../utils/elements.utils'),
    zen      = require('elements/zen'),
    storage  = require('prime/map')(),
    Emitter  = require('prime/emitter'),
    Bound    = require('prime-util/prime/bound'),
    Options  = require('prime-util/prime/options'),
    domready = require('elements/domready'),

    bind     = require('mout/function/bind'),
    map      = require('mout/array/map'),
    forEach  = require('mout/array/forEach'),
    last     = require('mout/array/last'),
    merge    = require('mout/object/merge'),

    request  = require('agent');

var animationEndSupport = false;

domready(function() {
    var style = (document.body || document.documentElement).style;

    forEach(['animation', 'WebkitAnimation', 'MozAnimation', 'MsAnimation', 'OAnimation'], function(animation, index) {
        if (animationEndSupport) {
            return;
        }
        animationEndSupport = style[animation] !== undefined ? Modal.prototype.animationEndEvent[index] : false;
    });
});

var Modal = new prime({
    mixin: [Bound, Options],

    inherits: Emitter,

    animationEndEvent: ['animationend', 'webkitAnimationEnd', 'mozAnimationEnd', 'MSAnimationEnd', 'oanimationend'],

    globalID: 1,

    options: {
        baseClassNames: {
            container: 'g5-dialog',
            content: 'g5-content',
            overlay: 'g5-overlay',
            close: 'g5-close',
            closing: 'g5-closing',
            open: 'g5-dialog-open'
        },

        content: '',
        remote: '',
        showCloseButton: true,
        escapeToClose: true,
        overlayClickToClose: true,
        appendNode: '#g5-container',
        className: 'g5-dialog-theme-default',
        css: {},
        overlayClassName: '',
        overlayCSS: '',
        contentClassName: '',
        contentCSS: '',
        closeClassName: 'g5-dialog-close',
        closeCSS: '',

        afterOpen: null,
        afterClose: null
    },

    constructor: function(options) {
        this.setOptions(options);
        this.defaults = this.options;

        var self = this;
        domready(function() {
            $(window).on('keydown', function(event) {
                if (event.keyCode === 27) {
                    return self.closeByEscape();
                }
            });

            self.animationEndEvent = animationEndSupport;
        });

        this
            .on('dialogOpen', function(options) {
                $('body').addClass(options.baseClassNames.open);
                $('html').addClass(options.baseClassNames.open);
            })
            .on('dialogAfterClose', bind(function(options) {
                var all = this.getAll();
                if (!all || !all.length) {
                    $('body').removeClass(options.baseClassNames.open);
                    $('html').removeClass(options.baseClassNames.open);
                }
            }, this));
    },

    storage: function() {
        return storage;
    },

    open: function(options) {
        options = merge(this.options, options);
        options.id = this.globalID++;

        var elements = {};

        // container
        elements.container = zen('div')
            .addClass(options.baseClassNames.container)
            .addClass(options.className)
            .style(options.css);

        storage.set(elements.container, { dialog: options });

        // overlay
        elements.overlay = zen('div')
            .addClass(options.baseClassNames.overlay)
            .addClass(options.overlayClassName)
            .style(options.overlayCSS);

        storage.set(elements.overlay, { dialog: options });

        if (options.overlayClickToClose) {
            elements.container.on('click', bind(this._overlayClick, this, elements.container[0]));
            elements.overlay.on('click', bind(this._overlayClick, this, elements.overlay[0]));
        }

        elements.container.appendChild(elements.overlay);

        // content
        elements.content = zen('div')
            .addClass(options.baseClassNames.content)
            .addClass(options.contentClassName)
            .style(options.contentCSS)
            .html(options.content);

        storage.set(elements.content, { dialog: options });
        elements.container.appendChild(elements.content);

        if (options.overlayClickToClose) {
            elements.content.on('click', function(/*e*/){
                return true;
            });
        }

        // remote
        if (options.remote && options.remote.length > 1) {
            this.showLoading();

            options.method = options.method || 'get';
            var agent = request();
            agent.method(options.method);
            agent.url(options.remote);
            if (options.data) { agent.data(options.data); }
            agent.send(bind(function(error, response) {
                elements.content.html(response.body.html || response.body);

                if (!response.body.success) {
                    if (!response.body.html) { elements.content.style({ width: '90%' }); }
                }

                this.hideLoading();
                if (options.remoteLoaded) {
                    options.remoteLoaded(response, options);
                }

                var selects = $('[data-selectize]');
                if (selects) { selects.selectize(); }
            }, this));
        }

        // close button
        if (options.showCloseButton) {
            elements.closeButton = zen('div')
                .addClass(options.baseClassNames.close)
                .addClass(options.closeClassName)
                .style(options.closeCSS);

            storage.set(elements.closeButton, { dialog: options });
            elements.content.appendChild(elements.closeButton);
        }

        // delegate container to pick g5-close clicks
        elements.container.delegate('click', '.g5-dialog-close', bind(function(event){
            event.preventDefault();
            this._closeButtonClick(elements.container);
        }, this));

        // inject the dialog in the DOM
        $(options.appendNode).appendChild(elements.container);

        options.elements = elements;

        if (options.afterOpen) {
            options.afterOpen(elements.content, options);
        }

        setTimeout(bind(function() {
            return this.emit('dialogOpen', options);
        }, this), 0);

        return elements.content;
    },

    getAll: function() {
        var options = this.options;
        return $("." + options.baseClassNames.container + ":not(." + options.baseClassNames.closing + ") ." + options.baseClassNames.content);
    },

    getByID: function(id) {
        var all = this.getAll();
        if (!all) { return []; }

        return $(all.filter(function(element) {
            element = $(element);
            return storage.get(element).dialog.id === id;
        }));
    },

    close: function(id) {
        if (!id) {
            var element = $(last(this.getAll()));
            if (!element) {
                return false;
            }

            id = storage.get(element).dialog.id;
        }

        return this.closeByID(id);
    },

    closeAll: function() {
        var ids;

        ids = map(this.getAll(), function(element) {
            element = $(element);

            return storage.get(element).dialog.id;
        });

        if (!ids.length) {
            return false;
        }

        forEach(ids.reverse(), function(id) {
            return this.closeByID(id);
        }, this);

        return true;
    },

    closeByID: function(id) {
        var content = this.getByID(id);
        if (!content || !content.length) {
            return false;
        }

        var container, options;

        container = storage.get(content).dialog.elements.container;
        options = merge({}, storage.get(content).dialog);

        var beforeClose = function() {
                if (options.beforeClose) {
                    return options.beforeClose(content, options);
                }
            },
            close = bind(function() {
                content.emit('dialogClose', options);
                container.remove();
                this.emit('dialogAfterClose', options);
                if (options.afterClose) {
                    return options.afterClose(content, options);
                }
            }, this);

        if (animationEndSupport) {
            beforeClose();
            container.off(this.animationEndEvent).on(this.animationEndEvent, function() {
                return close();
            }).addClass(options.baseClassNames.closing);
        } else {
            beforeClose();
            close();
        }

        return true;
    },

    closeByEscape: function() {
        var ids, id;

        ids = map(this.getAll(), function(element) {
            element = $(element);

            return storage.get(element).dialog.id;
        });

        if (!ids.length) {
            return false;
        }

        id = Math.max.apply(Math, ids);

        var element = this.getByID(id);

        if (!storage.get(element).dialog.escapeToClose) {
            return false;
        }

        return this.closeByID(id);

    },

    showLoading: function() {
        this.hideLoading();
        return $('body').appendChild(zen('div.g5-dialog-loading-spinner.' + this.options.className));
    },

    hideLoading: function() {
        var spinner = $('.g5-dialog-loading-spinner');
        return spinner ? spinner.remove() : false;
    },

    // private
    _overlayClick: function(element, event) {
        if (event.target !== element) {
            return;
        }

        return this.close(storage.get($(element)).dialog.id);
    },

    _closeButtonClick: function(element) {
        return this.close(storage.get($(element)).dialog.id);
    }
});

module.exports = Modal;
},{"../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/forEach.js","mout/array/last":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/last.js","mout/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/map.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/object/merge":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js","prime/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/map.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/popover.js":[function(require,module,exports){
"use strict";

var prime    = require('prime'),
    $        = require('../utils/elements.utils'),
    zen      = require('elements/zen'),
    storage  = require('prime/map')(),
    Emitter  = require('prime/emitter'),
    Bound    = require('prime-util/prime/bound'),
    Options  = require('prime-util/prime/options'),
    domready = require('elements/domready'),

    bind     = require('mout/function/bind'),
    map      = require('mout/array/map'),
    forEach  = require('mout/array/forEach'),
    last     = require('mout/array/last'),
    merge    = require('mout/object/merge'),
    isFunct  = require('mout/lang/isFunction'),

    request  = require('agent');

var Popover = new prime({
    mixin: [Bound, Options],

    inherits: Emitter,

    options: {
        mainClass: 'g5-popover',
        placement: 'auto',
        width: 'auto',
        height: 'auto',
        trigger: 'click',
        style: '',
        delay: 300,
        cache: true,
        multi: false,
        arrow: true,
        title: '',
        content: '',
        closeable: false,
        padding: true,
        targetEvents: true,
        allowElementsClick: false,
        url: '',
        type: 'html',
        where: '#g5-container',
        template: '<div class="g5-popover">' +
        '<div class="arrow"></div>' +
        '<div class="g5-popover-inner">' +
        '<a href="#" class="close">x</a>' +
        '<h3 class="g5-popover-title"></h3>' +
        '<div class="g5-popover-content"><i class="icon-refresh"></i> <p>&nbsp;</p></div>' +
        '</div>' +
        '</div>'
    },

    constructor: function(element, options) {
        this.setOptions(options);
        this.element = $(element);

        if (this.options.trigger === 'click') {
            this.element.off('click', this.bound('toggle')).on('click', this.bound('toggle'));
        } else {
            this.element.off('mouseenter', this.bound('mouseenterHandler')).off('mouseleave', this.bound('mouseleaveHandler'))
                .on('mouseenter', this.bound('mouseenterHandler'))
                .on('mouseleave', this.bound('mouseleaveHandler'));
        }

        this._poped = false;
        //this._inited = true;
    },

    destroy: function() {
        this.hide();
        storage.set(this.element[0], null);
        this.element.off('click', this.bound('toggle')).off('mouseenter', this.bound('mouseenterHandler')).off('mouseleave', this.bound('mouseleaveHandler'));

        if (this.$target) {
            this.$target.remove();
        }
    },

    hide: function(event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        //var e = $.Event('hide.' + pluginType);
        this.element.emit('hide.popover', this);
        if (this.$target) {
            this.$target.removeClass('in').style({ display: 'none' });
            this.$target.remove();
        }
        this.element.emit('hidden.popover', this);
    },

    toggle: function(e) {
        if (e) {
            e.preventDefault();
            e.stopPropagation();
        }
        this[this.getTarget().hasClass('in') ? 'hide' : 'show']();
    },

    hideAll: function(force) {
        var css = '';
        if (force) { css = 'div.' + this.options.mainClass; }
        else { css = 'div.' + this.options.mainClass + ':not(.' + this.options.mainClass + '-fixed)'; }

        var elements = $(css);
        if (!elements) { return this; }
        elements.removeClass('in').style({ display: 'none' });

        return this;
    },

    show: function() {
        var target = this.getTarget().attribute('class', null).addClass(this.options.mainClass);

        if (!this.options.multi) {
            this.hideAll();
        }

        // use cache by default, if not cache setted  , reInit the contents
        this.element.emit('beforeshow.popover', this);
        if (!this.options.cache || !this._poped) {
            this.setTitle(this.getTitle());

            if (!this.options.closeable) {
                target.find('.close').off('click').remove();
            }

            if (!this.isAsync()) {
                this.setContent(this.getContent());
            } else {
                this.setContentASync(this.options.content);
                this.displayContent();
                return;
            }

            target.style({ display: 'block' });
        }

        this.displayContent();
        this.bindBodyEvents();
    },

    displayContent: function() {
        var elementPos    = this.element.position(),
            target        = this.getTarget().attribute('class', null).addClass(this.options.mainClass),
            targetContent = this.getContentElement(),
            targetWidth, targetHeight, placement;

        this.element.emit('show.popover', this);

        if (this.options.width !== 'auto') {
            target.style({ width: this.options.width });
        }
        if (this.options.height !== 'auto') {
            targetContent.style({ height: this.options.height });
        }

        // init the popover and insert into the document body
        if (!this.options.arrow && target.find('.arrow')) {
            target.find('.arrow').remove();
        }
        target.remove().style({
            top: -1000,
            left: -1000,
            display: 'block'
        }).bottom(this.options.where);
        targetWidth = target[0].offsetWidth;
        targetHeight = target[0].offsetHeight;
        placement = this.getPlacement(elementPos, targetHeight);
        if (this.options.targetEvents) { this.initTargetEvents(); }
        var positionInfo = this.getTargetPositin(elementPos, placement, targetWidth, targetHeight);
        this.$target.style(positionInfo.position).addClass(placement).addClass('in');

        if (this.options.type === 'iframe') {
            var iframe = target.find('iframe');
            iframe.style({
                width: target.position().width,
                height: iframe.parent().position.height
            });
        }

        if (this.options.style) {
            if (typeof this.options.style === 'string') {
                this.options.style = this.options.style.split(',').map(Function.prototype.call, String.prototype.trim);
            }

            this.options.style.forEach(function(style) {
                this.$target.addClass(this.options.mainClass + '-' + style);
            }, this);
        }

        if (!this.options.padding) {
            targetContent.css('height', targetContent.position().height);
            this.$target.addClass('g5-popover-no-padding');
        }
        if (!this.options.arrow) {
            this.$target.style({ 'margin': 0 });
        }
        if (this.options.arrow) {
            var arrow = this.$target.find('.arrow');
            arrow.attribute('style', null);
            if (positionInfo.arrowOffset) {
                arrow.style(positionInfo.arrowOffset);
            }
        }
        this._poped = true;
        this.element.emit('shown.popover', this);

    },


    /*getter setters */
    getTarget: function() {
        if (!this.$target) {
            this.$target = $(zen('div').html(this.options.template).children()[0]);
        }
        return this.$target;
    },

    getTitleElement: function() {
        return this.getTarget().find('.' + this.options.mainClass + '-title');
    },

    getContentElement: function() {
        return this.getTarget().find('.' + this.options.mainClass + '-content');
    },

    getTitle: function() {
        return this.options.title || this.element.data('g5-popover-title') || this.element.attribute('title');
    },

    setTitle: function(title) {
        var element = this.getTitleElement();
        if (title) {
            element.html(title);
        }
        else {
            element.remove();
        }
    },

    hasContent: function() {
        return this.getContent();
    },

    getContent: function() {
        if (this.options.url) {
            if (this.options.type === 'iframe') {
                this.content = $('<iframe frameborder="0"></iframe>').attribute('src', this.options.url);
            }
        } else if (!this.content) {
            var content = '';
            if (isFunct(this.options.content)) {
                content = this.options.content.apply(this.element[0], arguments);
            } else {
                content = this.options.content;
            }
            this.content = this.element.data('g5-popover-content') || content;
        }
        return this.content;
    },

    setContent: function(content) {
        var target = this.getTarget();
        this.getContentElement().html(content);
        this.$target = target;
    },

    isAsync: function() {
        return this.options.type === 'async';
    },

    setContentASync: function(content) {
        request('get', this.options.url, bind(function(error, response) {
            if (content && isFunct(content)) {
                this.content = content.apply(this.element[0], [response]);
            } else {
                this.content = response.body.html;
            }

            this.setContent(this.content);

            var target = this.getContentElement();
            target.attribute('style', null);
            this.displayContent();
            this.bindBodyEvents();

            var selects = $('[data-selectize]');
            if (selects) { selects.selectize(); }
        }, this));
    },

    bindBodyEvents: function() {
        var body = $('body');
        body.off('keyup', this.bound('escapeHandler')).on('keyup', this.bound('escapeHandler'));
        body.off('click', this.bound('bodyClickHandler')).on('click', this.bound('bodyClickHandler'));
    },


    /* event handlers */
    mouseenterHandler: function() {
        if (this._timeout) {
            clearTimeout(this._timeout);
        }
        if (!(this.getTarget()[0].offsetWidth > 0 || this.getTarget()[0].offsetHeight > 0)) {
            this.show();
        }
    },
    mouseleaveHandler: function() {
        // key point, set the _timeout  then use clearTimeout when mouse leave
        this._timeout = setTimeout(bind(function() {
            this.hide();
        }, this), this.options.delay);
    },

    escapeHandler: function(e) {
        if (e.keyCode === 27) {
            this.hideAll();
        }
    },

    bodyClickHandler: function() {
        this.hideAll();
    },

    targetClickHandler: function(e) {
        e.stopPropagation();
    },

    initTargetEvents: function() {
        if (this.options.trigger !== 'click') {
            this.$target
                .off('mouseenter', this.bound('mouseenter'))
                .off('mouseleave', this.bound('mouseleave'))
                .on('mouseenter', this.bound('mouseenterHandler'))
                .on('mouseleave', this.bound('mouseleaveHandler'));
        }

        var close = this.$target.find('.close');
        if (close) {
            close.off('click', this.bound('hide')).on('click', this.bound('hide'));
        }

        this.$target.off('click', this.bound('targetClickHandler')).on('click', this.bound('targetClickHandler'));
    },

    /* utils methods */
    getPlacement: function(pos, targetHeight) {
        var
            placement,
            de           = document.documentElement,
            db           = document.body,
            clientWidth  = de.clientWidth,
            clientHeight = de.clientHeight,
            scrollTop    = Math.max(db.scrollTop, de.scrollTop),
            scrollLeft   = Math.max(db.scrollLeft, de.scrollLeft),
            pageX        = Math.max(0, pos.left - scrollLeft),
            pageY        = Math.max(0, pos.top - scrollTop),
            arrowSize    = 20;

        // if placement equals autocaculate the placement by element information;
        if (typeof(this.options.placement) === 'function') {
            placement = this.options.placement.call(this, this.getTarget()[0], this.element[0]);
        } else {
            placement = this.element.data('g5-popover-placement') || this.options.placement;
        }

        if (placement === 'auto') {
            if (pageX < clientWidth / 3) {
                if (pageY < clientHeight / 3) {
                    placement = 'bottom-right';
                } else if (pageY < clientHeight * 2 / 3) {
                    placement = 'right';
                } else {
                    placement = 'top-right';
                }
                //placement= pageY>targetHeight+arrowSize?'top-right':'bottom-right';
            } else if (pageX < clientWidth * 2 / 3) {
                if (pageY < clientHeight / 3) {
                    placement = 'bottom';
                } else if (pageY < clientHeight * 2 / 3) {
                    placement = 'bottom';
                } else {
                    placement = 'top';
                }
            } else {
                placement = pageY > targetHeight + arrowSize ? 'top-left' : 'bottom-left';
                if (pageY < clientHeight / 3) {
                    placement = 'bottom-left';
                } else if (pageY < clientHeight * 2 / 3) {
                    placement = 'left';
                } else {
                    placement = 'top-left';
                }
            }
        }
        return placement;
    },

    getTargetPositin: function(elementPos, placement, targetWidth, targetHeight) {
        var pos         = elementPos,
            elementW    = this.element.position().width,
            elementH    = this.element.position().height,
            position    = {},
            arrowOffset = null,
            arrowSize   = this.options.arrow ? 28 : 0,
            fixedW      = elementW < arrowSize + 10 ? arrowSize : 0,
            fixedH      = elementH < arrowSize + 10 ? arrowSize : 0;
        switch (placement) {
            case 'bottom':
                position = {
                    top: pos.top + pos.height,
                    left: pos.left + pos.width / 2 - targetWidth / 2
                };
                break;
            case 'top':
                position = {
                    top: pos.top - targetHeight,
                    left: pos.left + pos.width / 2 - targetWidth / 2
                };
                break;
            case 'left':
                position = {
                    top: pos.top + pos.height / 2 - targetHeight / 2,
                    left: pos.left - targetWidth
                };
                break;
            case 'right':
                position = {
                    top: pos.top + pos.height / 2 - targetHeight / 2,
                    left: pos.left + pos.width
                };
                break;
            case 'top-right':
                position = {
                    top: pos.top - targetHeight,
                    left: pos.left - fixedW
                };
                arrowOffset = { left: elementW / 2 + fixedW };
                break;
            case 'top-left':
                position = {
                    top: pos.top - targetHeight,
                    left: pos.left - targetWidth + pos.width + fixedW
                };
                arrowOffset = { left: targetWidth - elementW / 2 - fixedW };
                break;
            case 'bottom-right':
                position = {
                    top: pos.top + pos.height,
                    left: pos.left - fixedW
                };
                arrowOffset = { left: elementW / 2 + fixedW };
                break;
            case 'bottom-left':
                position = {
                    top: pos.top + pos.height,
                    left: pos.left - targetWidth + pos.width + fixedW
                };
                arrowOffset = { left: targetWidth - elementW / 2 - fixedW };
                break;
            case 'right-top':
                position = {
                    top: pos.top - targetHeight + pos.height + fixedH,
                    left: pos.left + pos.width
                };
                arrowOffset = { top: targetHeight - elementH / 2 - fixedH };
                break;
            case 'right-bottom':
                position = {
                    top: pos.top - fixedH,
                    left: pos.left + pos.width
                };
                arrowOffset = { top: elementH / 2 + fixedH };
                break;
            case 'left-top':
                position = {
                    top: pos.top - targetHeight + pos.height + fixedH,
                    left: pos.left - targetWidth
                };
                arrowOffset = { top: targetHeight - elementH / 2 - fixedH };
                break;
            case 'left-bottom':
                position = {
                    top: pos.top,
                    left: pos.left - targetWidth
                };
                arrowOffset = { top: elementH / 2 };
                break;

        }

        return {
            position: position,
            arrowOffset: arrowOffset
        };
    }

});

$.implement({
    getPopover: function(options) {
        var popover = storage.get(this);

        if (!popover && options !== 'destroy') {
            options = options || {};
            popover = new Popover(this, options);
            storage.set(this, popover);
            this.PopoverDefined = true;
        }

        return popover;
    },

    popover: function(options) {
        return this.forEach(function(element) {
            var popover = storage.get(element);

            if (!popover && options !== 'destroy') {
                options = options || {};
                popover = new Popover(element, options);
                storage.set(element, popover);
            }
        });
    },

    position: function() {
        var node    = this[0], box = {
                left: 0,
                right: 0,
                top: 0,
                bottom: 0
            },
            win     = window, doc = node.ownerDocument,
            docElem = doc.documentElement,
            body    = doc.body;

        if (typeof node.getBoundingClientRect !== "undefined") {
            box = node.getBoundingClientRect();
        }

        var clientTop  = docElem.clientTop || body.clientTop || 0,
            clientLeft = docElem.clientLeft || body.clientLeft || 0,
            scrollTop  = win.pageYOffset || docElem.scrollTop,
            scrollLeft = win.pageXOffset || docElem.scrollLeft,
            dx         = scrollLeft - clientLeft,
            dy         = scrollTop - clientTop;

        return {
            x: box.left + dx,
            left: box.left + dx,
            y: box.top + dy,
            top: box.top + dy,
            right: box.right + dx,
            bottom: box.bottom + dy,
            width: box.right - box.left,
            height: box.bottom - box.top
        };
    }
});

module.exports = $;
},{"../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/forEach.js","mout/array/last":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/last.js","mout/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/map.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/lang/isFunction":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isFunction.js","mout/object/merge":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js","prime/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/map.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/progresser.js":[function(require,module,exports){
"use strict";

var $        = require('elements'),
    prime    = require('prime'),
    Emitter  = require('prime/emitter'),
    Bound    = require('prime-util/prime/bound'),
    Options  = require('prime-util/prime/options'),
    zen      = require('elements/zen'),
    moofx    = require('moofx'),

    bind     = require('mout/function/bind'),
    isArray  = require('mout/lang/isArray'),
    isNumber = require('mout/lang/isNumber');

var Progresser = new prime({

    mixin: [Bound, Options],

    inherits: Emitter,

    options: {
        value: 0.0,
        size: 50.0,
        startAngle: -Math.PI / 2,
        thickness: 'auto',
        fill: { // { color: 'hex|rgba' } || { gradient: [from, to], gradientAngle: Math.PI / 4, gradientDirection: [x0, y0, x1, y1] }
            gradient: ['#9e38eb', '#4e68fc']//['#3aeabb', '#fdd250']
        },
        emptyFill: 'rgba(0, 0, 0, .1)',
        animation: {
            duration: 1200,
            equation: 'cubic-bezier(0.645, 0.045, 0.355, 1)'
        },
        animationStartValue: 0.0,
        reverse: false,
        lineCap: 'butt', // butt, round, square
        insertElement: null,
        insertLocation: 'before'
    },

    constructor: function(element, options) {
        this.setOptions(options);

        this.element = this.element || $(element);
        this.canvas = this.canvas || zen('canvas')[this.options.insertLocation || 'before'](this.options.insertElement || this.element)[0];
        this.radius = this.options.size / 2;
        this.arcFill = null;
        this.lastFrameValue = 0.0;

        this.canvas.width = this.options.size;
        this.canvas.height = this.options.size;
        this.ctx = this.canvas.getContext('2d');

        this.initFill();
        this.draw();
    },

    initFill: function() {
        var fill = this.options.fill,
            size = this.options.size,
            ctx  = this.ctx;

        if (!fill) { throw Error('The fill is not specified.'); }

        if (fill.color) {
            this.arcFill = fill.color;
        }

        if (fill.gradient) {
            var gr = fill.gradient;

            if (gr.length == 1) { this.arcFill = gr[0]; }
            else {
                var ga = fill.gradientAngle || 0,  // gradient direction angle; 0 by default
                    gd = fill.gradientDirection || [
                            size / 2 * (1 - Math.cos(ga)), // x0
                            size / 2 * (1 + Math.sin(ga)), // y0
                            size / 2 * (1 + Math.cos(ga)), // x1
                            size / 2 * (1 - Math.sin(ga))  // y1
                        ],
                    lg = ctx.createLinearGradient.apply(ctx, gd);

                for (var i = 0; i < gr.length; i++) {
                    var color = gr[i],
                        pos   = i / (gr.length - 1);

                    if (isArray(color)) {
                        pos = color[1];
                        color = color[0];
                    }

                    lg.addColorStop(pos, color);
                }

                this.arcFill = lg;
            }
        }
    },

    draw: function() {
        this[this.options.animation ? 'drawAnimated' : 'drawFrame'](this.options.value);
    },

    drawFrame: function(v) {
        this.lastFrameValue = v;
        this.ctx.clearRect(0, 0, this.options.size, this.options.size);
        this.drawEmptyArc(v);
        this.drawArc(v);
    },

    drawArc: function(v) {
        var ctx = this.ctx,
            r   = this.radius,
            t   = this.getThickness(),
            a   = this.options.startAngle;

        ctx.save();
        ctx.beginPath();

        if (!this.options.reverse) {
            ctx.arc(r, r, r - t / 2, a, a + Math.PI * 2 * v);
        } else {
            ctx.arc(r, r, r - t / 2, a - Math.PI * 2 * v, a);
        }

        ctx.lineWidth = t;
        ctx.lineCap = this.options.lineCap;
        ctx.strokeStyle = this.arcFill;
        ctx.stroke();
        ctx.restore();
    },

    drawEmptyArc: function(v) {
        var ctx = this.ctx,
            r   = this.radius,
            t   = this.getThickness(),
            a   = this.options.startAngle;

        if (v < 1) {
            ctx.save();
            ctx.beginPath();

            if (v <= 0) {
                ctx.arc(r, r, r - t / 2, 0, Math.PI * 2);
            } else {
                if (!this.reverse) {
                    ctx.arc(r, r, r - t / 2, a + Math.PI * 2 * v, a);
                } else {
                    ctx.arc(r, r, r - t / 2, a, a - Math.PI * 2 * v);
                }
            }

            ctx.lineWidth = t;
            ctx.strokeStyle = this.options.emptyFill;
            ctx.stroke();
            ctx.restore();
        }
    },

    drawAnimated: function(v) {
        this.element.emit('progress-animation-start');

        moofx(bind(function(now) {
            var stepValue = this.options.animationStartValue * (1 - now) + v * now;
            this.drawFrame(stepValue);
            this.element.emit('progress-animation-change', now, stepValue);
        }, this), {
            duration: this.options.animation.duration || '1200',
            equation: this.options.animation.equation || 'linear',
            callback: bind(function() {
                if (this.options.animation.callback) { this.options.animation.callback(); }
                this.element.emit('progress-animation-end');
            }, this)
        }).start(0, 1);
    },

    getThickness: function() {
        return isNumber(this.options.thickness) ? this.options.thickness : this.options.size / 14;
    }
});

module.exports = Progresser;

},{"elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","moofx":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/index.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","mout/lang/isNumber":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isNumber.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/selectize.js":[function(require,module,exports){
"use strict";

var prime      = require('prime'),
    ready      = require('elements/domready'),
    zen        = require('elements/zen'),

    sifter     = require('sifter'),

    Emitter    = require('prime/emitter'),
    Bound      = require('prime-util/prime/bound'),
    Options    = require('prime-util/prime/options'),

    $          = require('../utils/elements.utils'),
    moofx      = require('moofx'),

    bind       = require('mout/function/bind'),
    forEach    = require('mout/collection/forEach'),
    indexOf    = require('mout/array/indexOf'),
    last       = require('mout/array/last'),
    debounce   = require('mout/function/debounce'),
    isArray    = require('mout/lang/isArray'),
    isBoolean  = require('mout/lang/isBoolean'),
    merge      = require('mout/object/merge'),
    unset      = require('mout/object/unset'),
    size       = require('mout/object/size'),
    values     = require('mout/object/values'),
    escapeHTML = require('mout/string/escapeHtml'),
    trim       = require('mout/string/trim');


var IS_MAC        = /Mac/.test(navigator.userAgent),
    COUNT         = 0,

    KEY_A         = 65,
    KEY_COMMA     = 188,
    KEY_RETURN    = 13,
    KEY_ESC       = 27,
    KEY_LEFT      = 37,
    KEY_UP        = 38,
    KEY_P         = 80,
    KEY_RIGHT     = 39,
    KEY_DOWN      = 40,
    KEY_N         = 78,
    KEY_BACKSPACE = 8,
    KEY_DELETE    = 46,
    KEY_SHIFT     = 16,
    KEY_CMD       = IS_MAC ? 91 : 17,
    KEY_CTRL      = IS_MAC ? 18 : 17,
    KEY_TAB       = 9,

    TAG_SELECT    = 1,
    TAG_INPUT     = 2;

var hash_key = function(value) {
    if (typeof value === 'undefined' || value === null) return null;
    if (typeof value === 'boolean') return value ? '1' : '0';
    return value + '';
};

var isset = function(object) {
    return typeof object !== 'undefined';
};

var escape_replace = function(str) {
    return (str + '').replace(/\$/g, '$$$$');
};

var once = function(fn) {
    var called = false;
    return function() {
        if (called) return;
        called = true;
        fn.apply(this, arguments);
    };
};

var debounce_events = function(self, types, fn) {
    var type;
    var trigger = self.emit;
    var event_args = {};

    // override trigger method
    self.emit = function() {
        var type = arguments[0];
        if (types.indexOf(type) !== -1) {
            event_args[type] = arguments;
        } else {
            return trigger.apply(self, arguments);
        }
    };

    // invoke provided function
    fn.apply(self, []);
    self.emit = trigger;

    // trigger queued events
    for (type in event_args) {
        if (event_args.hasOwnProperty(type)) {
            trigger.apply(self, event_args[type]);
        }
    }
};

var build_hash_table = function(key, objects) {
    if (!isArray(objects)) return objects;
    var i, n, table = {};
    for (i = 0, n = objects.length; i < n; i++) {
        if (objects[i].hasOwnProperty(key)) {
            table[objects[i][key]] = objects[i];
        }
    }
    return table;
};

var getSelection = function(input) {
    var result = {};
    if ('selectionStart' in input) {
        result.start = input.selectionStart;
        result.length = input.selectionEnd - result.start;
    } else if (document.selection) {
        input.focus();
        var sel = document.selection.createRange();
        var selLen = document.selection.createRange().text.length;
        sel.moveStart('character', -input.value.length);
        result.start = sel.text.length - selLen;
        result.length = selLen;
    }
    return result;
};

var transferStyles = function($from, $to, properties) {
    var i, n, styles = {};
    if (properties) {
        for (i = 0, n = properties.length; i < n; i++) {
            styles[properties[i]] = $from.compute(properties[i]);
        }
    } else {
        styles = $from.compute();
    }
    $to.style(styles);
};

var measureString = function(str, $parent) {
    if (!str) {
        return 0;
    }

    var $test = zen('test').style({
        position: 'absolute',
        top: -99999,
        left: -99999,
        width: 'auto',
        padding: 0,
        whiteSpace: 'pre'
    }).text(str).bottom('body');

    transferStyles($parent, $test, [
        'letterSpacing',
        'fontSize',
        'fontFamily',
        'fontWeight',
        'textTransform'
    ]);

    var width = $test[0].offsetWidth;
    $test.remove();

    return width;
};

var highlight = function($element, pattern) {
    if (typeof pattern === 'string' && !pattern.length) return;
    var regex = (typeof pattern === 'string') ? new RegExp(pattern, 'i') : pattern;

    var highlight = function(node) {
        var skip = 0;
        if (node.nodeType === 3) {
            var pos = node.data.search(regex);
            if (pos >= 0 && node.data.length > 0) {
                var match = node.data.match(regex);
                var spannode = document.createElement('span');
                spannode.className = 'highlight';
                var middlebit = node.splitText(pos);
                var endbit = middlebit.splitText(match[0].length);
                var middleclone = middlebit.cloneNode(true);
                spannode.appendChild(middleclone);
                middlebit.parentNode.replaceChild(spannode, middlebit);
                skip = 1;
            }
        } else if (node.nodeType === 1 && node.childNodes && !/(script|style)/i.test(node.tagName)) {
            for (var i = 0; i < node.childNodes.length; ++i) {
                i += highlight(node.childNodes[i]);
            }
        }
        return skip;
    };

    return forEach($element, function(el) {
        highlight(el);
    });
};

var autoGrow = function(input) {
    input = $(input);
    var currentWidth = null;

    var update = function(options, e) {
        var value, keyCode, printable, placeholder, width;
        var shift, character, selection;
        e = e || window.event || {};
        options = options || {};

        if (e.metaKey || e.altKey) return;
        if (!options.force && input.selectizeGrow === false) return;

        value = input.value();
        if (e.type && e.type.toLowerCase() === 'keydown') {
            keyCode = e.keyCode;
            printable = (
            (keyCode >= 97 && keyCode <= 122) || // a-z
            (keyCode >= 65 && keyCode <= 90) || // A-Z
            (keyCode >= 48 && keyCode <= 57) || // 0-9
            keyCode === 32 // space
            );

            if (keyCode === KEY_DELETE || keyCode === KEY_BACKSPACE) {
                selection = getSelection(input[0]);
                if (selection.length) {
                    value = value.substring(0, selection.start) + value.substring(selection.start + selection.length);
                } else if (keyCode === KEY_BACKSPACE && selection.start) {
                    value = value.substring(0, selection.start - 1) + value.substring(selection.start + 1);
                } else if (keyCode === KEY_DELETE && typeof selection.start !== 'undefined') {
                    value = value.substring(0, selection.start) + value.substring(selection.start + 1);
                }
            } else if (printable) {
                shift = e.shiftKey;
                character = String.fromCharCode(e.keyCode);
                if (shift) character = character.toUpperCase();
                else character = character.toLowerCase();
                value += character;
            }
        }

        placeholder = input.attribute('placeholder');
        if (!value && placeholder) {
            value = placeholder;
        }

        width = measureString(value, input) + 4;
        if (width !== currentWidth) {
            currentWidth = width;
            input.style({ width: width });
            input.emit('resize');
        }
    };

    input.on('keydown', update);
    input.on('keyup', update);
    input.on('update', update);
    input.on('blur', update);

    update();
};

var Selectize = new prime({

    mixin: [Bound, Options],

    inherits: Emitter,

    options: {
        plugins: [],
        delimiter: ' ',
        persist: true,
        diacritics: true,
        create: false,
        createOnBlur: false,
        createFilter: null,
        highlight: true,
        openOnFocus: true,
        maxOptions: 1000,
        maxItems: null,
        hideSelected: null,
        addPrecedence: false,
        selectOnTab: false,
        preload: false,
        allowEmptyOption: false,

        scrollDuration: 60,
        loadThrottle: 300,

        dataAttr: 'data-data',
        optgroupField: 'optgroup',
        valueField: 'value',
        labelField: 'text',
        optgroupLabelField: 'label',
        optgroupValueField: 'value',
        optgroupOrder: null,

        sortField: '$order',
        searchField: ['text'],
        searchConjunction: 'and',

        mode: null,
        wrapperClass: 'selectize-control',
        inputClass: 'selectize-input',
        dropdownClass: 'selectize-dropdown',
        dropdownContentClass: 'selectize-dropdown-content',

        dropdownParent: null,

        copyClassesToDropdown: true,

        /*
         load            : null, // function(query, callback) { ... }
         score           : null, // function(search) { ... }
         onInitialize    : null, // function() { ... }
         onChange        : null, // function(value) { ... }
         onItemAdd       : null, // function(value, $item) { ... }
         onItemRemove    : null, // function(value) { ... }
         onClear         : null, // function() { ... }
         onOptionAdd     : null, // function(value, data) { ... }
         onOptionRemove  : null, // function(value) { ... }
         onOptionClear   : null, // function() { ... }
         onDropdownOpen  : null, // function($dropdown) { ... }
         onDropdownClose : null, // function($dropdown) { ... }
         onType          : null, // function(str) { ... }
         onDelete        : null, // function(values) { ... }
         */

        render: {
            /*
             item: null,
             optgroup: null,
             optgroup_header: null,
             option: null,
             option_create: null
             */
        }
    },

    constructor: function(input, options) {
        input = $(input);
        this.setOptions(options);

        this.input = input;
        this.input.selectizeInstance = this;

        this.tagType = input.tag() == 'select' ? TAG_SELECT : TAG_INPUT;
        this.highlightedValue = null;
        this.isRequired = input.attribute('required');
        forEach(['isOpen', 'isDisabled', 'isInvalid', 'isLocked', 'isFocused', 'isInputHidden', 'isSeup', 'isShiftDown', 'isCmdDown', 'isCtrlDown', 'ignoreFocus', 'ignoreBlur', 'ignoreHover', 'hasOptions'], function(option) {
            this[option] = false;
        }, this);
        this.currentResults = null;
        this.lastValue = '';
        this.caretPos = 0;
        this.loading = 0;
        this.loadedSearches = {};

        this.$activeOption = null;
        this.$activeItems = [];

        this.Optgroups = {};
        this.Options = {};
        this.UserOptions = {};
        this.items = [];
        this.renderCache = {};
        this.onSearchChange = this.options.loadThrottle === null ? this.onSearchChange : debounce(this.onSearchChange, this.options.loadThrottle);

        this.Options = merge(this.Options, build_hash_table(this.options.valueField, this.options.Options));
        this.Optgroups = merge(this.Optgroups, build_hash_table(this.options.optgroupValueField, this.options.Optgroups));

        delete this.options.Options;
        delete this.options.Optgroups;

        this.sifter = new sifter(this.Options, { diacritics: this.options.diacritics });

        this.options.mode = this.options.mode || (this.options.maxItems === 1 ? 'single' : 'multi');
        if (!isBoolean(this.options.hideSelected)) { this.options.hideSelected = (this.options.mode === 'multi'); }

        this.setupCallbacks();
        this.setupTemplates();
        this.setup();

    },

    setup: function() {
        var $input = this.input,
            $wrapper,
            $control,
            $control_input,
            $dropdown,
            $dropdown_content,
            $dropdown_parent,
            inputMode,
            tab_index,
            classes;

        inputMode = this.options.mode;
        tab_index = $input.attribute('tabindex') || '';
        classes = $input.attribute('class') || '';

        $wrapper = zen('div').addClass(this.options.wrapperClass).addClass(classes).addClass(inputMode).after(this.input);
        $control = zen('div').addClass(this.options.inputClass).addClass('items').bottom($wrapper);
        $control_input = zen('input[type="text"][autocomplete="off"]').bottom($control).attribute('tabindex', tab_index);
        $dropdown_parent = $(this.options.dropdownParent || $wrapper);
        $dropdown = zen('div').addClass(this.options.dropdownClass).addClass(inputMode).style({ display: 'none' }).bottom($dropdown_parent);
        $dropdown_content = zen('div').addClass(this.options.dropdownContentClass).bottom($dropdown);

        if (this.options.copyClassesToDropdown) {
            forEach(classes.split(' '), function(cls) {
                $dropdown.addClass(cls);
            });
        }


        if (inputMode == 'single') {
            $wrapper.style({
                width: parseInt($input.compute('width')) + 12 + (24) // padding compensation
            });
        }

        if ((this.options.maxItems === null || this.options.maxItems > 1) && this.tagType === TAG_SELECT) {
            $input.attribute('multiple', 'multiple');
        }

        if (this.options.placeholder) {
            $control_input.attribute('placeholder', this.options.placeholder);
        }

        if ($input.attribute('autocorrect')) {
            $control_input.attribute('autocorrect', $input.attribute('autocorrect'));
        }

        if ($input.attribute('autocapitalize')) {
            $control_input.attribute('autocapitalize', $input.attribute('autocapitalize'));
        }

        this.$wrapper = $wrapper;
        this.$control = $control;
        this.$control_input = $control_input;
        this.$dropdown = $dropdown;
        this.$dropdown_content = $dropdown_content;

        $dropdown.delegate('mouseover', '[data-selectable]', bind(function() { return this.onOptionHover.apply(this, arguments); }, this));
        $dropdown.delegate('mousedown', '[data-selectable]', bind(function() { return this.onOptionSelect.apply(this, arguments); }, this));

        autoGrow($control_input);

        $control.delegate('mousedown', '*:not(input)', bind(function(event, element) {
            if (element == $control) { return true; }
            this.onItemSelect(event, element);
        }, this));

        $control.on('mousedown', bind(function() { return this.onMouseDown.apply(this, arguments); }, this));
        $control.on('click', bind(function() { return this.onClick.apply(this, arguments); }, this));

        $control_input.on('mousedown', function(e) { e.stopPropagation(); });
        $control_input.on('keydown', bind(function() { return this.onKeyDown.apply(this, arguments); }, this));
        $control_input.on('keyup', bind(function() { return this.onKeyUp.apply(this, arguments); }, this));
        $control_input.on('keypress', bind(function() { return this.onKeyPress.apply(this, arguments); }, this));
        $control_input.on('resize', bind(function() { this.positionDropdown.apply(this, []); }, this));
        $control_input.on('blur', bind(function() { return this.onBlur.apply(this, arguments); }, this));
        $control_input.on('focus', bind(function() {
            this.ignoreBlur = false;
            return this.onFocus(arguments);
        }, this));
        $control_input.on('paste', bind(function() { return this.onPaste.apply(this, arguments); }, this));

        $(document).on('keydown', bind(function(e) {
            this.isCmdDown = e[IS_MAC ? 'metaKey' : 'ctrlKey'];
            this.isCtrlDown = e[IS_MAC ? 'altKey' : 'ctrlKey'];
            this.isShiftDown = e.shiftKey;
        }, this));

        $(document).on('keyup', bind(function(e) {
            if (e.keyCode === KEY_CTRL) this.isCtrlDown = false;
            if (e.keyCode === KEY_SHIFT) this.isShiftDown = false;
            if (e.keyCode === KEY_CMD) this.isCmdDown = false;
        }, this));

        $(document).on('mousedown', bind(function(e) {
            if (this.isFocused) {
                // prevent events on the dropdown scrollbar from causing the control to blur
                if (e.target === this.$dropdown[0] || e.target.parentNode === this.$dropdown[0]) {
                    return false;
                }
                // blur on click outside
                if (!this.$control.find($(e.target)) && e.target !== this.$control[0]) {
                    this.blur();
                }
            }
        }, this));

        $(window).on('scroll', bind(function() {
            if (this.isOpen) {
                this.positionDropdown.apply(this, arguments);
            }
        }, this));
        $(window).on('resize', bind(function() {
            if (this.isOpen) {
                this.positionDropdown.apply(this, arguments);
            }
        }, this));
        $(window).on('mousemove', bind(function() {
            this.ignoreHover = false;
        }, this));

        // store original children and tab index so that they can be
        // restored when the destroy() method is called.
        this.revertSettings = {
            $children: this.input.children(),//.detach(),
            tabindex: this.input.attribute('tabindex')
        };

        this.input.attribute('tabindex', -1).style({ display: 'none' }).after($wrapper);

        if (isArray(this.options.items)) {
            this.setValue(this.options.items);
            delete this.options.items;
        }

        // feature detect for the validation API
        if (this.input[0].validity) {
            this.input.on('invalid', bind(function(e) {
                e.preventDefault();
                this.isInvalid = true;
                this.refreshState();
            }, this));
        }

        this.updateOriginalInput();
        this.refreshItems();
        this.refreshState();
        this.updatePlaceholder();
        this.isSetup = true;

        if (this.input.matches(':disabled')) {
            this.disable();
        }

        this.on('change', this.onChange);

        this.input.selectizeInstance = this;
        this.input.addClass('selectized');
        this.emit('initialize');

        // preload options
        if (this.options.preload === true) {
            this.onSearchChange('');
        }

    },

    setupTemplates: function() {
        var field_label = this.options.labelField,
            field_optgroup = this.options.optgroupLabelField;

        var templates = {
            'optgroup': function(data) {
                return '<div class="optgroup">' + data.html + '</div>';
            },
            'optgroup_header': function(data, escape) {
                return '<div class="optgroup-header">' + escape(data[field_optgroup]) + '</div>';
            },
            'option': function(data, escape) {
                return '<div class="option">' + escape(data[field_label]) + '</div>';
            },
            'item': function(data, escape) {
                return '<div class="item">' + escape(data[field_label]) + '</div>';
            },
            'option_create': function(data, escape) {
                return '<div class="create">Add <strong>' + escape(data.input) + '</strong>&hellip;</div>';
            }
        };

        this.options.render = merge({}, templates, this.options.render);
    },

    setupCallbacks: function() {
        var callbacks = {
            'initialize': 'onInitialize',
            'change': 'onChange',
            'item_add': 'onItemAdd',
            'item_remove': 'onItemRemove',
            'clear': 'onClear',
            'option_add': 'onOptionAdd',
            'option_remove': 'onOptionRemove',
            'option_clear': 'onOptionClear',
            'dropdown_open': 'onDropdownOpen',
            'dropdown_close': 'onDropdownClose',
            'type': 'onType',
            'load': 'onLoad'
        };

        forEach(callbacks, function(value, key) {
            var fn = this.options[callbacks[key]];
            if (fn) { this.on(key, fn); }
        }, this);
    },

    updateOriginalInput: function() {
        var options;

        if (this.tagType === TAG_SELECT) {
            options = [];
            for (var i = 0, n = this.items.length; i < n; i++) {
                options.push('<option value="' + escapeHTML(this.items[i]) + '" selected="selected"></option>');
            }
            if (!options.length && !this.input.attribute('multiple')) {
                options.push('<option value="" selected="selected"></option>');
            }
            this.input.html(options.join(''));
        } else {
            this.input.value(this.getValue());
            this.input.attribute('value', this.input.value());
        }

        if (this.isSetup) {
            this.emit('change', this.input.value());
        }
    },

    getAdjacentOption: function($option, direction) {
        var $options = this.$dropdown.search('[data-selectable]');
        var index = indexOf($options, ($option ? $option[0] : null)) + direction;

        return index >= 0 && index < ($options ? $options.length : 0) ? $($options[index]) : $();
    },

    getOption: function(value) {
        return this.getElementWithValue(value, this.$dropdown_content.search('[data-selectable]'));
    },

    getElementWithValue: function(value, $els) {
        value = hash_key(value);

        if (typeof value !== 'undefined' && value !== null) {
            for (var i = 0, n = ($els ? $els.length : 0); i < n; i++) {
                if ($els[i].getAttribute('data-value') === value) {
                    return $($els[i]);
                }
            }
        }

        return $();
    },

    getItem: function(value) {
        return this.getElementWithValue(value, this.$control.children());
    },

    addItems: function(values) {
        var items = isArray(values) ? values : [values];
        for (var i = 0, n = items.length; i < n; i++) {
            this.isPending = (i < n - 1);
            this.addItem(items[i]);
        }
    },

    addItem: function(value) {
        debounce_events(this, ['change'], function() {
            var $item, $option, $options;
            var inputMode = this.options.mode;
            var i, active, value_next, wasFull;
            value = hash_key(value);

            if (this.items.indexOf(value) !== -1) {
                if (inputMode === 'single' && this.isOpen) this.close();
                return;
            }

            if (!this.Options.hasOwnProperty(value)) return;
            if (inputMode === 'single') this.clear();
            if (inputMode === 'multi' && (this.isFull() || !value)) return;

            var dummy = zen('div').html(this.render('item', this.Options[value]));
            $item = dummy.firstChild();
            wasFull = this.isFull();
            this.items.splice(this.caretPos, 0, value);
            this.insertAtCaret($item);
            if (!this.isPending || (!wasFull && this.isFull())) {
                this.refreshState();
            }

            if (this.isSetup) {
                $options = this.$dropdown_content.search('[data-selectable]');

                // update menu / remove the option (if this is not one item being added as part of series)
                if (!this.isPending) {
                    $option = this.getOption(value);
                    var adj = this.getAdjacentOption($option, 1);
                    value_next = (adj) ? adj.attribute('data-value') : null;
                    this.refreshOptions(this.isFocused && inputMode !== 'single');
                    if (value_next) {
                        this.setActiveOption(this.getOption(value_next));
                    }
                }

                // hide the menu if the maximum number of items have been selected or no options are left
                if (!$options || this.isFull()) {
                    this.close();
                } else {
                    this.positionDropdown();
                }

                this.updatePlaceholder();
                this.emit('item_add', value, $item);
                this.updateOriginalInput();
            }
        });
    },

    removeItem: function(value) {
        var $item, i, idx;

        $item = (typeof value === 'object') ? value : this.getItem(value);
        value = hash_key($item.attribute('data-value'));
        i = this.items.indexOf(value);

        if (i !== -1) {
            $item.remove();
            if ($item.hasClass('active')) {
                idx = this.$activeItems.indexOf($item[0]);
                this.$activeItems.splice(idx, 1);
            }

            this.items.splice(i, 1);
            this.lastQuery = null;
            if (!this.options.persist && this.UserOptions.hasOwnProperty(value)) {
                this.removeOption(value);
            }

            if (i < this.caretPos) {
                this.setCaret(this.caretPos - 1);
            }

            this.refreshState();
            this.updatePlaceholder();
            this.updateOriginalInput();
            this.positionDropdown();
            this.emit('item_remove', value);
        }
    },

    createItem: function(triggerDropdown) {
        var input = trim(this.$control_input.value() || '');
        var caret = this.caretPos;
        if (!this.canCreate(input)) return false;
        this.lock();

        if (typeof triggerDropdown === 'undefined') {
            triggerDropdown = true;
        }

        var setup = (typeof this.options.create === 'function') ? this.options.create : bind(function(input) {
            var data = {};
            data[this.options.labelField] = input;
            data[this.options.valueField] = input;
            return data;
        }, this);

        var create = once(bind(function(data) {
            this.unlock();

            if (!data || typeof data !== 'object') return;
            var value = hash_key(data[this.options.valueField]);
            if (typeof value !== 'string') return;

            this.setTextboxValue('');
            this.addOption(data);
            this.setCaret(caret);
            this.addItem(value);
            this.refreshOptions(triggerDropdown && this.options.mode !== 'single');
        }, this));

        var output = setup.apply(this, [input, create]);
        if (typeof output !== 'undefined') {
            create(output);
        }

        return true;
    },

    refreshItems: function() {
        this.lastQuery = null;

        if (this.isSetup) {
            for (var i = 0; i < this.items.length; i++) {
                this.addItem(this.items);
            }
        }

        this.refreshState();
        this.updateOriginalInput();
    },

    refreshState: function() {
        var invalid;
        if (this.isRequired) {
            if (this.items.length) this.isInvalid = false;
            this.$control_input.attribute('required', invalid);
        }
        this.refreshClasses();
    },

    refreshClasses: function() {
        var isFull = this.isFull(),
            isLocked = this.isLocked;

        /*self.$wrapper
         .toggleClass('rtl', self.rtl);*/

        this.$control.toggleClass('focus', this.isFocused);
        this.$control.toggleClass('disabled', this.isDisabled);
        this.$control.toggleClass('required', this.isRequired);
        this.$control.toggleClass('invalid', this.isInvalid);
        this.$control.toggleClass('locked', isLocked);
        this.$control.toggleClass('full', isFull);
        this.$control.toggleClass('not-full', !isFull);
        this.$control.toggleClass('input-active', this.isFocused && !this.isInputHidden);
        this.$control.toggleClass('dropdown-active', this.isOpen);
        this.$control.toggleClass('has-options', !size(this.options.Options));
        this.$control.toggleClass('has-items', this.items.length > 0);

        this.$control_input.selectizeGrow = !isFull && !isLocked;
    },

    isFull: function() {
        return this.options.maxItems !== null && this.items.length >= this.options.maxItems;
    },

    updatePlaceholder: function() {
        if (!this.options.placeholder) return;
        var control_input = this.$control_input;

        if (this.items.length) {
            control_input.attribute('placeholder', null);
        } else {
            control_input.attribute('placeholder', this.options.placeholder);
        }
        control_input.emit('update', { force: true });
    },

    open: function() {
        if (this.isLocked || this.isOpen || (this.options.mode === 'multi' && this.isFull())) return;
        this.focus();
        this.isOpen = true;
        this.refreshState();
        this.$dropdown.style({
            visibility: 'hidden',
            display: 'block'
        });
        this.positionDropdown();
        this.$dropdown.style({ visibility: 'visible' });
        this.emit('dropdown_open', this.$dropdown);
    },

    close: function() {
        var trigger = this.isOpen;

        if (this.options.mode === 'single' && this.items.length) {
            this.hideInput();
        }

        this.isOpen = false;
        this.$dropdown.style({ display: 'none' });
        this.setActiveOption(null);
        this.refreshState();

        if (this.options.mode === 'single' && !this.getValue()) {
            this.lastQuery = null;
            this.setTextboxValue('');
            this.addItem(this.Options[Object.keys(this.Options)[0]][this.options.valueField]);
            //this.blur();
        }

        if (trigger) this.emit('dropdown_close', this.$dropdown);
    },

    positionDropdown: function() {
        var control = this.$control,
            offset = control.position();//this.options.dropdownParent === 'body' ? control.offset() : control.position();
        offset.top += control[0].offsetHeight;

        this.$dropdown.style({
            width: control[0].offsetWidth,
            top: control[0].offsetTop + control[0].offsetHeight,
            left: control[0].offsetLeft
        });
    },

    clear: function() {
        var non_input = this.$control.children(':not(input)');
        if (!this.items.length) return;

        if (non_input) non_input.remove();
        this.items = [];
        this.lastQuery = null;
        this.setCaret(0);
        this.setActiveItem(null);
        this.updatePlaceholder();
        this.updateOriginalInput();
        this.refreshState();
        this.showInput();
        this.emit('clear');
    },

    onClick: function(e) {
        // necessary for mobile webkit devices (manual focus triggering
        // is ignored unless invoked within a click event)
        if (!this.isFocused) {
            this.focus();
            e.preventDefault();
        }
    },

    onMouseDown: function(e) {
        var defaultPrevented = e.defaultPrevented;
        var $target = $(e.target);

        if (this.isFocused) {
            // retain focus by preventing native handling. if the
            // event target is the input it should not be modified.
            // otherwise, text selection within the input won't work.
            if (e.target !== this.$control_input[0]) {
                if (this.options.mode === 'single') {
                    // toggle dropdown
                    this.isOpen ? this.close() : this.open();
                } else if (!defaultPrevented) {
                    this.setActiveItem(null);
                }

                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        } else {
            // give control focus
            if (!defaultPrevented) {
                window.setTimeout(bind(function() {
                    this.focus();
                }, this), 0);
            }
        }
    },

    onChange: function() {
        this.input.emit('change', this.input.value(), this);
        $('body').emit('change', {target: this.input});
    },

    onPaste: function(e) {
        if (this.isFull() || this.isInputHidden || this.isLocked) {
            e.preventDefault();
        }
    },

    onKeyPress: function(e) {
        if (this.isLocked) return e && e.preventDefault();
        var character = String.fromCharCode(e.keyCode || e.which);
        if (this.options.create && character === this.options.delimiter) {
            this.createItem();
            e.preventDefault();
            return false;
        }
    },

    onKeyDown: function(e) {
        var isInput = e.target === this.$control_input[0];

        if (this.isLocked) {
            if (e.keyCode !== KEY_TAB) {
                e.preventDefault();
            }
            return;
        }

        switch (e.keyCode) {
            case KEY_A:
                if (this.isCmdDown) {
                    this.selectAll();
                    return;
                }
                break;
            case KEY_ESC:
                this.close();
                this.blur();
                e.preventDefault();
                e.stopPropagation();
                return false;
            case KEY_N:
                if (!e.ctrlKey || e.altKey) break;
            case KEY_DOWN:
                if (!this.isOpen && this.hasOptions) {
                    this.open();
                } else if (this.$activeOption) {
                    this.ignoreHover = true;
                    var $next = this.getAdjacentOption(this.$activeOption, 1);
                    if ($next) this.setActiveOption($next, true, true);
                }
                e.preventDefault();
                return;
            case KEY_P:
                if (!e.ctrlKey || e.altKey) break;
            case KEY_UP:
                if (this.$activeOption) {
                    this.ignoreHover = true;
                    var $prev = this.getAdjacentOption(this.$activeOption, -1);
                    if ($prev) this.setActiveOption($prev, true, true);
                }
                e.preventDefault();
                return;
            case KEY_RETURN:
                if (this.isOpen && this.$activeOption) {
                    this.onOptionSelect({ currentTarget: this.$activeOption });
                }
                e.preventDefault();
                return;
            case KEY_LEFT:
                this.advanceSelection(-1, e);
                return;
            case KEY_RIGHT:
                this.advanceSelection(1, e);
                return;
            case KEY_TAB:
                if (this.options.selectOnTab && this.isOpen && this.$activeOption) {
                    this.onOptionSelect({ currentTarget: this.$activeOption });
                    e.preventDefault();
                }
                if (this.options.create && this.createItem()) {
                    e.preventDefault();
                }
                return;
            case KEY_BACKSPACE:
            case KEY_DELETE:
                this.deleteSelection(e);
                return;
        }

        if ((this.isFull() || this.isInputHidden) && !(IS_MAC ? e.metaKey : e.ctrlKey)) {
            e.preventDefault();
            return;
        }
    },

    onKeyUp: function(e) {

        if (this.isLocked) return e && e.preventDefault();
        var value = this.$control_input.value() || '';
        if (this.lastValue !== value) {
            this.lastValue = value;
            this.onSearchChange(value);
            this.refreshOptions();
            this.emit('type', value);
        }
    },

    onSearchChange: function(value) {
        var fn = this.options.load;
        if (!fn) return;
        if (this.loadedSearches.hasOwnProperty(value)) return;
        this.loadedSearches[value] = true;
        this.load(function(callback) {
            fn.apply(this, [value, callback]);
        });
    },

    onFocus: function(e) {
        this.isFocused = true;
        if (this.isDisabled) {
            this.blur();
            e && e.preventDefault();
            return false;
        }

        if (this.ignoreFocus) return;
        if (this.options.preload === 'focus') this.onSearchChange('');

        if (!this.$activeItems.length) {
            this.showInput();
            this.setActiveItem(null);
            this.refreshOptions(!!this.options.openOnFocus);
        }

        this.refreshState();
    },

    onBlur: function(e) {
        this.isFocused = false;
        if (this.ignoreFocus) return;

        // necessary to prevent IE closing the dropdown when the scrollbar is clicked
        if (!this.ignoreBlur && document.activeElement === this.$dropdown_content[0]) {
            this.ignoreBlur = true;
            this.onFocus(e);

            return;
        }

        if (this.options.create && this.options.createOnBlur) {
            this.createItem(false);
        }

        this.close();
        this.setTextboxValue('');
        this.setActiveItem(null);
        this.setActiveOption(null);
        this.setCaret(this.items.length);
        this.refreshState();
    },

    onOptionHover: function(e, element) {
        element = $(element);
        if (this.ignoreHover) return;
        this.setActiveOption(element || e.currentTarget, false);
    },

    onOptionSelect: function(e, element) {
        var value, $target, $option, self = this;

        if (e.preventDefault) {
            e.preventDefault();
            e.stopPropagation();
        }

        $target = $(element || e.currentTarget);
        if ($target.hasClass('create')) {
            this.createItem();
        } else {
            value = $target.attribute('data-value');
            if (typeof value !== 'undefined') {
                this.lastQuery = null;
                this.setTextboxValue('');
                this.addItem(value);
                if (!this.options.hideSelected && e.type && /mouse/.test(e.type)) {
                    this.setActiveOption(this.getOption(value));
                }
            }
        }
    },

    onItemSelect: function(e, element) {

        if (this.isLocked) return;
        if (this.options.mode === 'multi') {
            e.preventDefault();
            this.setActiveItem(element || e.currentTarget, e);
        }
    },

    load: function(fn) {
        var $wrapper = this.$wrapper.addClass('loading');

        this.loading++;
        fn.apply(this, [bind(function(results) {
            this.loading = Math.max(this.loading - 1, 0);
            if (results && results.length) {
                this.addOption(results);
                this.refreshOptions(this.isFocused && !this.isInputHidden);
            }
            if (!this.loading) {
                $wrapper.removeClass('loading');
            }
            this.emit('load', results);
        }, this)]);
    },

    setTextboxValue: function(value) {
        var $input = this.$control_input;
        var changed = $input.value() !== value;
        if (changed) {
            $input.value(value).emit('update');
            this.lastValue = value;
        }
    },

    getValue: function() {
        if (this.tagType === TAG_SELECT && this.input.attribute('multiple')) {
            return this.items;
        } else {
            return this.items.join(this.options.delimiter);
        }
    },

    /**
     * Resets the selected items to the given value.
     *
     * @param {mixed} value
     */
    setValue: function(value) {
        debounce_events(this, ['change'], function() {
            this.clear();
            this.addItems(value);
        });
    },

    focus: function() {
        if (this.isDisabled) { return; }

        this.ignoreFocus = true;
        this.$control_input[0].focus();
        setTimeout(bind(function() {
            this.ignoreFocus = false;
            this.onFocus();
        }, this), 0);
    },

    blur: function() {
        this.$control_input.emit('blur');
        this.$control_input[0].blur();
    },

    showInput: function() {
        this.$control_input.style({
            opacity: 1,
            position: 'relative',
            left: 0
        });
        this.isInputHidden = false;
    },

    setActiveItem: function(item, e) {
        var eventName, idx, begin, end, item, swap, $last;

        if (this.options.mode === 'single') { return; }
        item = $(item);

        // clear the active selection
        if (!item) {
            if (this.$activeItems.length) { $(this.$activeItems).removeClass('active'); }
            this.$activeItems = [];
            if (this.isFocused) {
                this.showInput();
            }
            return;
        }

        // modify selection
        eventName = e && e.type.toLowerCase();

        if (eventName === 'mousedown' && this.isShiftDown && this.$activeItems.length) {
            $last = $(last(this.$control.children('.active')));
            begin = Array.prototype.indexOf.apply(this.$control[0].childNodes, [$last[0]]);
            end = Array.prototype.indexOf.apply(this.$control[0].childNodes, [item[0]]);
            if (begin > end) {
                swap = begin;
                begin = end;
                end = swap;
            }
            for (var i = begin; i <= end; i++) {
                item = this.$control[0].childNodes[i];
                if (this.$activeItems.indexOf(item) === -1) {
                    $(item).addClass('active');
                    this.$activeItems.push(item);
                }
            }
            e.preventDefault();
        } else if ((eventName === 'mousedown' && this.isCtrlDown) || (eventName === 'keydown' && this.isShiftDown)) {
            if (item.hasClass('active')) {
                idx = this.$activeItems.indexOf(item[0]);
                this.$activeItems.splice(idx, 1);
                item.removeClass('active');
            } else {
                this.$activeItems.push(item.addClass('active')[0]);
            }
        } else {
            if ($(this.$activeItems)) $(this.$activeItems).removeClass('active');
            this.$activeItems = [item.addClass('active')[0]];
        }

        // ensure control has focus
        this.hideInput();
        if (!this.isFocused) {
            this.focus();
        }
    },

    refreshOptions: function(triggerDropdown) {
        var i, j, k, n, groups, groups_order, option, option_html, optgroup, optgroups, html, html_children, has_create_option;
        var $active, $active_before, $create;

        if (typeof triggerDropdown === 'undefined') {
            triggerDropdown = true;
        }

        var query = trim(this.$control_input.value());
        var results = this.search(query);
        var $dropdown_content = this.$dropdown_content;
        var active_before = this.$activeOption && hash_key(this.$activeOption.attribute('value'));

        // build markup
        n = results.items.length;
        if (typeof this.options.maxOptions === 'number') {
            n = Math.min(n, this.options.maxOptions);
        }

        // render and group available options individually
        groups = {};

        if (this.options.optgroupOrder) {
            groups_order = this.options.optgroupOrder;
            for (i = 0; i < groups_order.length; i++) {
                groups[groups_order[i]] = [];
            }
        } else {
            groups_order = [];
        }

        for (i = 0; i < n; i++) {
            option = this.Options[results.items[i].id];
            option_html = this.render('option', option);
            optgroup = option[this.options.optgroupField] || '';
            optgroups = isArray(optgroup) ? optgroup : [optgroup];

            for (j = 0, k = optgroups && optgroups.length; j < k; j++) {
                optgroup = optgroups[j];
                if (!this.Optgroups.hasOwnProperty(optgroup)) {
                    optgroup = '';
                }
                if (!groups.hasOwnProperty(optgroup)) {
                    groups[optgroup] = [];
                    groups_order.push(optgroup);
                }
                groups[optgroup].push(option_html);
            }
        }

        // render optgroup headers & join groups
        html = [];
        for (i = 0, n = groups_order.length; i < n; i++) {
            optgroup = groups_order[i];
            if (this.Optgroups.hasOwnProperty(optgroup) && groups[optgroup].length) {
                // render the optgroup header and options within it,
                // then pass it to the wrapper template
                html_children = this.render('optgroup_header', this.Optgroups[optgroup]) || '';
                html_children += groups[optgroup].join('');
                html.push(this.render('optgroup', merge({}, this.Optgroups[optgroup], {
                    html: html_children
                })));
            } else {
                html.push(groups[optgroup].join(''));
            }
        }

        $dropdown_content.html(html.join(''));

        // highlight matching terms inline
        if (this.options.highlight && results.query.length && results.tokens.length) {
            for (i = 0, n = results.tokens.length; i < n; i++) {
                highlight($dropdown_content, results.tokens[i].regex);
            }
        }

        // add "selected" class to selected options
        if (!this.options.hideSelected) {
            for (i = 0, n = this.items.length; i < n; i++) {
                this.getOption(this.items[i]).addClass('selected');
            }
        }

        // add create option
        has_create_option = this.canCreate(query);
        if (has_create_option) {
            //$dropdown_content.prepend(this.render('option_create', { input: query }));
            $dropdown_content.html(this.render('option_create', { input: query }) + $dropdown_content.html());
            $create = $($dropdown_content[0].childNodes[0]);
        }

        // activate
        this.hasOptions = results.items.length > 0 || has_create_option;
        if (this.hasOptions) {
            if (results.items.length > 0) {
                $active_before = active_before && this.getOption(active_before);
                if ($active_before && $active_before.length) {
                    $active = $active_before;
                } else if (this.options.mode === 'single' && this.items.length) {
                    $active = this.getOption(this.items[0]);
                }
                if (!$active || !$active.length) {
                    if ($create && !this.options.addPrecedence) {
                        $active = this.getAdjacentOption($create, 1);
                    } else {
                        $active = $dropdown_content.find('[data-selectable]:first-child');
                    }
                }
            } else {
                $active = $create;
            }
            this.setActiveOption($active);
            if (triggerDropdown && !this.isOpen) { this.open(); }
        } else {
            this.setActiveOption(null);
            if (triggerDropdown && this.isOpen) { this.close(); }
        }
    },

    addOption: function(data) {
        var value;

        if (isArray(data)) {
            for (var i = 0, n = data.length; i < n; i++) {
                this.addOption(data[i]);
            }
            return;
        }

        value = hash_key(data[this.options.valueField]);
        if (typeof value !== 'string' || this.Options.hasOwnProperty(value)) return;

        this.UserOptions[value] = true;
        this.Options[value] = data;
        this.lastQuery = null;
        this.emit('option_add', value, data);
    },

    removeOption: function(value) {
        value = hash_key(value);

        var cache_items = this.renderCache['item'];
        var cache_options = this.renderCache['option'];
        if (cache_items) delete cache_items[value];
        if (cache_options) delete cache_options[value];

        delete this.UserOptions[value];
        delete this.Options[value];
        this.lastQuery = null;
        this.emit('option_remove', value);
        this.removeItem(value);
    },

    setActiveOption: function($option, scroll, animate) {
        var height_menu, height_item, y;
        var scroll_top, scroll_bottom;

        if (this.$activeOption) this.$activeOption.removeClass('active');
        this.$activeOption = null;

        $option = $($option);
        if (!$option) return;

        this.$activeOption = $option.addClass('active');

        if (scroll || !isset(scroll)) {

            height_menu = this.$dropdown_content[0].offsetHeight;
            height_item = this.$activeOption[0].offsetHeight;
            scroll = this.$dropdown_content[0].scrollTop || 0;
            y = this.$activeOption.position().top - this.$dropdown_content.position().top + scroll;
            scroll_top = y;
            scroll_bottom = y - height_menu + height_item;

            if (y + height_item > height_menu + scroll) {
                this.$dropdown_content[0].scrollTop = scroll_bottom;
                /*moofx(bind(function(value){
                 this.$dropdown_content[0].scrollTop = value;
                 }, this), {
                 duration: animate ? this.options.scrollDuration : 0,
                 equation: 'linear'
                 }).start(scroll, scroll_bottom);*/
            } else if (y < scroll) {
                this.$dropdown_content[0].scrollTop = scroll_top;
                /*moofx(bind(function(value){
                 this.$dropdown_content[0].scrollTop = value;
                 }, this), {
                 duration: animate ? this.options.scrollDuration : 0,
                 equation: 'linear'
                 }).start(scroll, scroll_top);*/
            }

        }
    },

    selectAll: function() {
        if (this.options.mode === 'single') return;

        var items = this.$control.children(':not(input)');
        if (items) { items.addClass('active'); }
        this.$activeItems = Array.prototype.slice.apply(items || 0);
        if (this.$activeItems) {
            this.hideInput();
            this.close();
        }
        this.focus();
    },

    hideInput: function() {

        this.setTextboxValue('');
        this.$control_input.style({
            opacity: 0,
            position: 'absolute',
            left: -10000
        });
        this.isInputHidden = true;
    },

    search: function(query) {
        var i, value, score, result, calculateScore;
        var options = this.getSearchOptions();

        // validate user-provided result scoring function
        if (this.options.score) {
            calculateScore = this.options.score.apply(this, [query]);
            if (typeof calculateScore !== 'function') {
                throw new Error('Selectize "score" setting must be a function that returns a function');
            }
        }

        // perform search
        if (query !== this.lastQuery) {
            this.lastQuery = query;
            result = this.sifter.search(query, merge(options, { score: calculateScore }));
            this.currentResults = result;
        } else {
            result = merge({}, this.currentResults);
        }

        // filter out selected items
        if (this.options.hideSelected) {
            for (i = result.items.length - 1; i >= 0; i--) {
                if (this.items.indexOf(hash_key(result.items[i].id)) !== -1) {
                    result.items.splice(i, 1);
                }
            }
        }

        return result;
    },

    getSearchOptions: function() {
        var sort = this.options.sortField;
        if (typeof sort === 'string') {
            sort = { field: sort };
        }

        return {
            fields: this.options.searchField,
            conjunction: this.options.searchConjunction,
            sort: sort
        };
    },

    canCreate: function(input) {
        if (!this.options.create) return false;
        var filter = this.options.createFilter;
        return input.length
            && (typeof filter !== 'function' || filter.apply(self, [input]))
            && (typeof filter !== 'string' || new RegExp(filter).test(input))
            && (!(filter instanceof RegExp) || filter.test(input));
    },

    insertAtCaret: function($el) {
        var caret = Math.min(this.caretPos, this.items.length);
        if (caret === 0) {
            $el.top(this.$control);//.prepend($el);
        } else {
            //$(this.$control[0].childNodes[caret]).before($el);
            $el.after(this.$control.find(':nth-child(' + caret + ')'));
            //this.$control.find(':nth-child(' + caret + ')').before($el);
        }
        this.setCaret(caret + 1);
    },

    deleteSelection: function(e) {
        var i, n, direction, selection, values, caret, option_select, $option_select, $tail;

        direction = (e && e.keyCode === KEY_BACKSPACE) ? -1 : 1;
        selection = getSelection(this.$control_input[0]);

        if (this.$activeOption && !this.options.hideSelected) {
            option_select = this.getAdjacentOption(this.$activeOption, -1);
            if (option_select) { option_select = option_select.attribute('data-value'); }
        }

        // determine items that will be removed
        values = [];

        if (this.$activeItems.length) {
            var children = this.$control.children(':not(input)');
            $tail = this.$control.children('.active');
            if ($tail) { $tail = $(direction > 0 ? last($tail) : $tail[0]); }
            caret = (!children ? -1 : indexOf(children, $tail[0]));
            if (direction > 0) { caret++; }

            for (i = 0, n = this.$activeItems.length; i < n; i++) {
                values.push($(this.$activeItems[i]).attribute('data-value'));
            }
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
        } else if ((this.isFocused || this.options.mode === 'single') && this.items.length) {
            if (direction < 0 && selection.start === 0 && selection.length === 0) {
                values.push(this.items[this.caretPos - 1]);
            } else if (direction > 0 && selection.start === this.$control_input.value().length) {
                values.push(this.items[this.caretPos]);
            }
        }

        // allow the callback to abort
        if (!values.length || (typeof this.options.onDelete === 'function' && this.options.onDelete.apply(this, [values]) === false)) {
            return false;
        }

        // perform removal
        if (typeof caret !== 'undefined') {
            this.setCaret(caret);
        }
        while (values.length) {
            this.removeItem(values.pop());
        }

        this.showInput();
        this.positionDropdown();
        this.refreshOptions(true);

        // select previous option
        if (option_select) {
            $option_select = this.getOption(option_select);
            if ($option_select.length) {
                this.setActiveOption($option_select);
            }
        }

        return true;
    },

    advanceSelection: function(direction, e) {
        var tail, selection, idx, valueLength, cursorAtEdge, $tail;

        if (direction === 0) return;
        if (this.rtl) direction *= -1;

        tail = direction > 0 ? 'last-child' : 'first-child';
        selection = getSelection(this.$control_input[0]);

        if (this.isFocused && !this.isInputHidden) {
            valueLength = this.$control_input.value().length;
            cursorAtEdge = direction < 0
                ? selection.start === 0 && selection.length === 0
                : selection.start === valueLength;

            if (cursorAtEdge && !valueLength) {
                this.advanceCaret(direction, e);
            }
        } else {
            $tail = this.$control.children('.active:' + tail);
            if ($tail) {
                idx = this.$control.children(':not(input)').index($tail);
                this.setActiveItem(null);
                this.setCaret(direction > 0 ? idx + 1 : idx);
            }
        }
    },

    advanceCaret: function(direction, e) {
        var self = this, fn, $adj;

        if (direction === 0) return;

        fn = direction > 0 ? 'nextSibling' : 'previousSibling';
        if (this.isShiftDown) {
            $adj = this.$control_input[fn]();
            if ($adj) {
                this.hideInput();
                this.setActiveItem($adj);
                e && e.preventDefault();
            }
        } else {
            this.setCaret(this.caretPos + direction);
        }
    },

    setCaret: function(i) {

        if (this.options.mode === 'single') {
            i = this.items.length;
        } else {
            i = Math.max(0, Math.min(this.items.length, i));
        }

        if (!this.isPending) {
            // the input must be moved by leaving it in place and moving the
            // siblings, due to the fact that focus cannot be restored once lost
            // on mobile webkit devices
            var j, n, fn, $children, $child;
            $children = this.$control.children(':not(input)');
            for (j = 0, n = ($children ? $children.length : 0); j < n; j++) {
                $child = $($children[j]);//.detach();
                if (j < i) {
                    $child.before(this.$control_input);
                } else {
                    this.$control.appendChild($child);
                }
            }
        }

        this.caretPos = i;
    },

    lock: function() {
        this.close();
        this.isLocked = true;
        this.refreshState();
    },

    unlock: function() {
        this.isLocked = false;
        this.refreshState();
    },

    disable: function() {
        this.input.attribute('disabled', true);
        this.isDisabled = true;
        this.lock();
    },

    enable: function() {
        this.input.attribute('disabled', null);
        this.isDisabled = false;
        this.unlock();
    },

    destroy: function() {
        var revertSettings = this.revertSettings;

        this.emit('destroy');
        this.off();
        this.$wrapper.remove();
        this.$dropdown.remove();

        this.input
            .html('')
            .appendChild(revertSettings.$children)
            .attribute('tabindex', null)
            .removeClass('selectized')
            .attribute({ tabindex: revertSettings.tabindex })
            .style({ display: 'block' });

        /*$(window).off(eventNS);
         $(document).off(eventNS);
         $(document.body).off(eventNS);*/

        delete this.$control_input.selectizeGrow;
        delete this.input.selectizeInstance;
    },

    render: function(templateName, data) {
        var value, id, label;
        var html = '';
        var cache = false;
        var regex_tag = /^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;

        if (templateName === 'option' || templateName === 'item') {
            value = hash_key(data[this.options.valueField]);
            cache = !!value;
        }

        // pull markup from cache if it exists
        if (cache) {
            if (!isset(this.renderCache[templateName])) {
                this.renderCache[templateName] = {};
            }
            if (this.renderCache[templateName].hasOwnProperty(value)) {
                return this.renderCache[templateName][value];
            }
        }

        // render markup
        html = this.options.render[templateName].apply(this, [data, escapeHTML]);

        // add mandatory attributes
        if (templateName === 'option' || templateName === 'option_create') {
            html = html.replace(regex_tag, '<$1 data-selectable');
        }
        if (templateName === 'optgroup') {
            id = data[this.options.optgroupValueField] || '';
            html = html.replace(regex_tag, '<$1 data-group="' + escape_replace(escapeHTML(id)) + '"');
        }
        if (templateName === 'option' || templateName === 'item') {
            html = html.replace(regex_tag, '<$1 data-value="' + escape_replace(escapeHTML(value || '')) + '"');
        }

        // update cache
        if (cache) {
            this.renderCache[templateName][value] = html;
        }

        return html;
    },

    clearCache: function(templateName) {
        if (typeof templateName === 'undefined') {
            this.renderCache = {};
        } else {
            delete this.renderCache[templateName];
        }
    }
});

$.implement({
    selectize: function(settings_user) {
        settings_user = settings_user || {};
        var defaults = Selectize.prototype.options,
            settings = merge({}, defaults, settings_user),
            attr_data = settings.dataAttr,
            field_label = settings.labelField,
            field_value = settings.valueField,
            field_optgroup = settings.optgroupField,
            field_optgroup_label = settings.optgroupLabelField,
            field_optgroup_value = settings.optgroupValueField;

        var init_textbox = function(input, settings_element) {
            input = $(input);
            var i, n, values, option, value = trim(input.value() || '');
            if (!settings.allowEmptyOption && !value.length) return;

            values = value.split(settings.delimiter);
            for (i = 0, n = values.length; i < n; i++) {
                option = {};
                option[field_label] = values[i];
                option[field_value] = values[i];

                settings_element.Options[values[i]] = option;
            }

            settings_element.items = values;
        };

        var init_select = function(input, settings_element) {
            var i, n, tagName, children, order = 0;
            var options = settings_element.Options;

            var readData = function(el) {
                var data = attr_data && el.attribute(attr_data);
                if (typeof data === 'string' && data.length) {
                    return JSON.parse(data);
                }
                return null;
            };

            var addOption = function(option, group) {
                var value, opt;

                option = $(option);

                value = option.attribute('value') || '';
                if (!value.length && !settings.allowEmptyOption) return;

                // if the option already exists, it's probably been
                // duplicated in another optgroup. in this case, push
                // the current group to the "optgroup" property on the
                // existing option so that it's rendered in both places.
                if (options.hasOwnProperty(value)) {
                    if (group) {
                        if (!options[value].optgroup) {
                            options[value].optgroup = group;
                        } else if (!isArray(options[value].optgroup)) {
                            options[value].optgroup = [options[value].optgroup, group];
                        } else {
                            options[value].optgroup.push(group);
                        }
                    }
                    return;
                }

                opt = readData(option) || {};
                opt[field_label] = opt[field_label] || option.text();
                opt[field_value] = opt[field_value] || value;
                opt[field_optgroup] = opt[field_optgroup] || group;

                opt.$order = ++order;
                options[value] = opt;

                if (option.matches(':selected')) {
                    settings_element.items.push(value);
                }
            };

            var addGroup = function(optgroup) {
                var i, n, id, optgrp, options;

                optgroup = $(optgroup);
                id = optgroup.attribute('label');

                if (id) {
                    optgrp = readData(optgroup) || {};
                    optgrp[field_optgroup_label] = id;
                    optgrp[field_optgroup_value] = id;
                    settings_element.Optgroups[id] = optgrp;
                }

                options = optgroup.search('option');
                for (i = 0, n = options.length; i < n; i++) {
                    addOption(options[i], id);
                }
            };

            settings_element.maxItems = input.attribute('multiple') ? null : 1;

            children = input.children() || 0;
            for (i = 0, n = children.length; i < n; i++) {
                tagName = children[i].tagName.toLowerCase();
                if (tagName === 'optgroup') {
                    addGroup(children[i]);
                } else if (tagName === 'option') {
                    addOption(children[i]);
                }
            }
        };

        return this.forEach(function($input) {
            $input = $($input);
            if ($input.selectizeInstance) return;

            var instance,
                dataOptions = $input.data('selectize'),
                tag_name = $input.tag().toLowerCase(),
                placeholder = $input.attribute('placeholder') || $input.attribute('data-placeholder');

            if (dataOptions) { dataOptions = JSON.parse(dataOptions); }
            settings = merge({}, settings, dataOptions);

            if (!placeholder && !settings.allowEmptyOption) {
                var chlds = $input.children('option[value=""]');
                placeholder = chlds ? $input.children('option[value=""]').text() : '';
            }

            var settings_element = {
                'placeholder': placeholder,
                'Options': {},
                'Optgroups': {},
                'items': []
            };

            if (tag_name === 'select') {
                init_select($input, settings_element);
            } else {
                init_textbox($input, settings_element);
            }

            instance = new Selectize($input, merge({}, defaults, settings_element, settings_user, dataOptions));
        });
    }
});

ready(function() {
    var selects = $('[data-selectize]');
    if (!selects) { return; }

    selects.selectize();
});


module.exports = Selectize;
},{"../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","moofx":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/index.js","mout/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/indexOf.js","mout/array/last":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/last.js","mout/collection/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/forEach.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/function/debounce":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/debounce.js","mout/lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","mout/lang/isBoolean":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isBoolean.js","mout/object/merge":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js","mout/object/size":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/size.js","mout/object/unset":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/unset.js","mout/object/values":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/values.js","mout/string/escapeHtml":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/escapeHtml.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js","sifter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/sifter/sifter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/toastr.js":[function(require,module,exports){
"use strict";

var prime   = require('prime'),
    Emitter = require('prime/emitter'),
    Bound   = require('prime-util/prime/bound'),
    Options = require('prime-util/prime/options'),
    zen     = require('elements/zen'),
    $       = require('../utils/elements.utils.js'),
    storage = require('prime/map')(),

    bind    = require('mout/function/bind'),
    merge   = require('mout/object/merge');

var Toaster = new prime({
    mixin: [Bound, Options],

    inherits: Emitter,

    options: {
        tapToDismiss: true,
        noticeClass: 'g-notifications',
        containerID: 'g-notifications-container',

        types: {
            base: '',
            error: 'fa-minus-circle',
            info: 'fa-info-circle',
            success: 'fa-check-circle',
            warning: 'fa-exclamation-triangle'
        },

        showDuration: 300,
        showEquation: 'cubic-bezier(0.02, 0.01, 0.47, 1)',
        hideDuration: 500,
        hideEquation: 'cubic-bezier(0.02, 0.01, 0.47, 1)',

        timeOut: 2500, // timeOut and extendedTimeout to 0 == sticky
        extendedTimeout: 2500,

        location: 'bottom-right',

        titleClass: 'g-notifications-title',
        messageClass: 'g-notifications-message',
        closeButton: true,

        target: '#g5-container',
        targetLocation: 'bottom',

        newestOnTop: true,
        preventDuplicates: false,
        progressBar: true


        /*
        onShow: function() {},
        onHidden: function() {},
        onClick: function() {}
        */
    },

    constructor: function(options) {
        this.setOptions(options);

        this.id = 0;
        this.previousNotice = null;
        this.map = storage;
    },

    mergeOptions: function(options) {
        return merge(this.options, options || {});
    },

    base: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || '',
            type: options.type || 'base',
            message: message
        }));
    },

    success: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || 'Success!',
            type: 'success',
            message: message
        }));
    },

    info: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || 'Info',
            type: 'info',
            message: message
        }));
    },
    warning: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || 'Warning!',
            type: 'warning',
            message: message
        }));
    },

    error: function(message, title, options) {
        options = this.mergeOptions(options);

        return this.notify(merge(options, {
            title: title || 'Error!',
            type: 'error',
            message: message
        }));
    },

    notify: function(options) {
        options = this.mergeOptions(options);

        if (options.preventDuplicates && this.previousNotice === options.message) { return; }

        this.id++;
        this.previousNotice = options.message;

        var container = this.getContainer(options, true),
            element = zen('div'), title = zen('div'), message = zen('div'),
            icon = zen('i.fa'),
            progress = zen('div.g-notifications-progress'), close = zen('a.fa.fa-close[href="#"]');

        this.map.set(element, {
            container: container,
            interval: null,
            progressBar: {
                interval: null,
                hideETA: null,
                maxHideTime: null
            },
            response: {
                id: this.id,
                state: 'visible',
                start: new Date(),
                options: options
            },
            options: options
        });

        if (options.title) {
            element.appendChild(title.html(options.title).addClass(options.titleClass));
        }

        if (options.message) {
            element.appendChild(message.html(options.message).addClass(options.messageClass));
        }

        if (options.closeButton) {
            close.top(element);
        }

        if (options.progressBar) {
            progress.top(element);
        }

        if (options.type && options.title) {
            if (options.types[options.type]) {
                icon.top(title).addClass(options.types[options.type]);
            }
        }

        element.style({ opacity: 0 });
        element[options.newestOnTop ? 'top' : 'bottom'](container);
        element.animate({ opacity: 1 }, {
            duration: options.showDuration,
            equation: options.showEquation,
            callback: options.onShow
        });

        if (options.timeOut > 0) {
            var map = this.map.get(element);
            map.interval = setTimeout(bind(function() {
                this.hide(element);
            }, this), options.timeOut);
            map.progressBar.maxHideTime = parseFloat(options.timeOut);
            map.progressBar.hideETA = new Date().getTime() + map.progressBar.maxHideTime;

            if (options.progressBar) {
                map.progressBar.interval = setInterval(bind(function() {
                    this.updateProgress(element, progress);
                }, this), 10);
            }

            this.map.set(element, map);
        }

        var stick = bind(function() { this.stickAround(element); }, this),
            delay = bind(function() { this.delayedHide(element); }, this);
        element.on('mouseover', stick);
        element.on('mouseout', delay);

        if (!options.onClick && options.tapToDismiss) {
            element.on('click', bind(function(){
                element.off('mouseover', stick);
                element.off('mouseout', delay);

                this.hide(element);
            }, this));
        }

        if (options.closeButton && close) {
            close.on('click', bind(function(event){
                event.stopPropagation();
                event.preventDefault();

                element.off('mouseover', stick);
                element.off('mouseout', delay);
                this.hide(element, true);
            }, this));
        }

    },

    stickAround: function(element) {
        var map = this.map.get(element);

        clearTimeout(map.interval);
        map.progressBar.hideETA = 0;
        element.animate({ opacity: 1 }, {
            duration: map.options.showDuration,
            equation: map.options.showEquation,
            callback: map.options.onShow
        });

        this.map.set(element, map);
    },

    hide: function(element, override) {
        if (element.find(':focus') && !override) { return; }

        var map = this.map.get(element);

        clearTimeout(map.progressBar.interval);

        this.map.set(element, map);
        return element.animate({ opacity: 0 }, {
            duration: map.options.hideDuration,
            equation: map.options.hideEquation,
            callback: bind(function() {
                this.remove(element);
                if (map.options.onHidden && map.response.state !== 'hidden') { map.options.onHidden(); }
                map.response.state = 'hidden';
                map.response.endTime = new Date();

                this.map.set(element, map);
            }, this)
        });
    },

    delayedHide: function(element, override) {
        var map = this.map.get(element);

        if (map.options.timeOut > 0 || map.options.extendedTimeout > 0) {
            map.interval = setTimeout(bind(function() {
                this.hide(element);
            }, this), map.options.extendedTimeout);
            map.progressBar.maxHideTime = parseFloat(map.options.extendedTimeout);
            map.progressBar.hideETA = new Date().getTime() + map.progressBar.maxHideTime;
        }

        this.map.set(element, map);
    },

    updateProgress: function(element, progress) {
        var map = this.map.get(element),
            percentage = ((map.progressBar.hideETA - (new Date().getTime())) / map.progressBar.maxHideTime) * 100;

        this.map.set(element, map);
        progress.style({ width: percentage + '%' });
    },

    getContainer: function(options, create) {
        options = this.mergeOptions(options);

        var container = $('#' + options.containerID);
        if (container) { return container; }

        if (create) { container = this.createContainer(options); }

        return container;
    },

    createContainer: function(options) {
        options = this.mergeOptions(options);

        return zen('div#' + options.containerID + '.' + options.location)[options.targetLocation](options.target);
    },

    remove: function(element) {
        if (!element) { return; }

        var map = this.map.get(element);
        if (!map.container) { map.container = this.getContainer(map.options); }
        /*if ($toastElement.is(':visible')) {
            return;
        }*/

        element.remove();
        if (!map.container.children()) {
            map.container.remove();
            this.previousNotice = null;
        }

        this.map.set(element, map);
    }
});

var toaster = new Toaster();

module.exports = toaster;
},{"../utils/elements.utils.js":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js","mout/object/merge":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime-util/prime/bound":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js","prime-util/prime/options":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js","prime/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/map.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/togglers.js":[function(require,module,exports){
"use strict";
var ready = require('elements/domready'),
    $ = require('elements');

ready(function(){
    var hiddens,
        click = ('ontouchend' in window) ? 'touchend' : 'click';

    $('body').delegate(click, '.enabler .toggle', function(e, element){
        console.log('a');
        element = $(element);
        hiddens = element.find('~~ [type=hidden]');

        if (!hiddens) return true;
        hiddens.value(hiddens.value() == '0' ? '1' : '0');

        hiddens.emit('change');
        $('body').emit('change', {target: hiddens});
    });
});

module.exports = {};
},{"elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/ajaxify-links.js":[function(require,module,exports){
"use strict";

var prime         = require('prime'),
    $             = require('../utils/elements.utils'),
    zen           = require('elements/zen'),
    domready      = require('elements/domready'),
    storage       = require('prime/map')(),
    modal         = require('../ui').modal,

    size          = require('mout/collection/size'),
    merge         = require('mout/object/merge'),
    guid          = require('mout/random/guid'),
    toQueryString = require('mout/queryString/encode'),
    contains      = require('mout/string/contains'),

    request       = require('agent')(),
    History       = require('./history'),
    getAjaxSuffix = require('./get-ajax-suffix'),
    mm            = require('../menu');

require('../ui/popover');

var ERROR = false;

History.Adapter.bind(window, 'statechange', function() {
    if (request.running()) {
        return false;
    }
    var body = $('body'),
        State = History.getState(),
        URI = State.url,
        Data = State.data,
        sidebar = $('#navbar'),
        params = '';

    if (size(Data) && Data.parsed !== false && storage.get(Data.uuid)) {
        Data = storage.get(Data.uuid);
    }

    if (Data.element) {
        body.emit('statechangeBefore', { target: Data.element, Data: Data });
    } else {
        var url = URI.replace(window.location.origin, '');
        Data.element = $('[href="' + url + '"]');
    }

    URI = URI + getAjaxSuffix();

    if (sidebar && Data.element && Data.element.parent('#navbar')) {
        var lis = sidebar.search('li');
        lis.removeClass('active');
        Data.element.parent('li').addClass('active');
    }

    if (Data.params) {
        params = toQueryString(JSON.parse(Data.params));
        if (contains(URI, '?')) { params = params.replace(/^\?/, '&'); }
    }

    if (!ERROR) { modal.closeAll(); }

    request.url(URI + params).data(Data.extras || {}).method(Data.extras ? 'post' : 'get').send(function(error, response) {
        if (!response.body.success) {
            ERROR = true;
            modal.open({
                content: response.body.html || response.body,
                afterOpen: function(container) {
                    if (!response.body.html) { container.style({ width: '90%' }); }
                }
            });

            History.back();

            if (Data.element) {
                Data.element.hideIndicator();
            }

            return false;
        }

        var target = Data.parent ? Data.element.parent(Data.parent) : $(Data.target),
            destination = (target || $('[data-g5-content]') || body);

        if (response.body && response.body.html) {
            var fader;
            destination.html(response.body.html);
            if (fader = (destination.matches('[data-g5-content]') ? destination : destination.find('[data-g5-content]'))) {
                fader.style({opacity: 0}).animate({opacity: 1});
            }
        } else { destination.html(response.body); }

        body.getPopover().hideAll(true).destroy();

        if (Data.element) {
            body.emit('statechangeAfter', { target: Data.element, Data: Data });
        }

        var element = (Data.event && Data.event.activeSpinner) || Data.element;
        if (element) {
            element.hideIndicator();
        }

        var selects = $('[data-selectize]');
        if (selects) { selects.selectize(); }
        selectorChangeEvent();

        body.emit('statechangeEnd');
    });
});

var selectorChangeEvent = function(){
    var selectors = $('[data-selectize-ajaxify]');
    if (!selectors) { return; }

    selectors.forEach(function(selector) {
        selector = $(selector);
        var selectize = selector.selectize().selectizeInstance;
        if (!selectize || selectize.HasChangeEvent) { return; }

        selectize.on('change', function() {
            var value = selectize.getValue(),
                options = selectize.Options;

            if (!options[value]) { return; }

            selectize.input
                .data('g5-ajaxify', '')
                .data('g5-ajaxify-target', selector.data('g5-ajaxify-target') || '[data-g5-content-wrapper]')
                .data('g5-ajaxify-target-parent', selector.data('g5-ajaxify-target-parent') || null)
                .data('g5-ajaxify-href', options[value].url)
                .data('g5-ajaxify-params', options[value].params ? JSON.stringify(options[value].params) : null);


            var active = $('#navbar li.active') || $('#main-header li.active') || $('#navbar li:nth-child(2)');
            if (active) { active.showIndicator(); }

            $('body').emit('click', { target: selectize.input, activeSpinner: active });
        });

        selectize.HasChangeEvent = true;
    });
};


domready(function() {
    var body = $('body');
    body.delegate('click', '[data-g5-ajaxify]', function(event, element) {
        if (event && event.preventDefault) {
            if (event.which === 2 || event.metaKey || event.ctrlKey || event.altKey || event.shiftKey) {
                return true;
            }

            event.preventDefault();
        }

        element.showIndicator();

        var data = element.data('g5-ajaxify'),
            target = element.data('g5-ajaxify-target'),
            parent = element.data('g5-ajaxify-target-parent'),
            url = element.attribute('href') || element.data('g5-ajaxify-href'),
            params = element.data('g5-ajaxify-params') || false,
            title = element.attribute('title') || window.document.title;

        data = data ? JSON.parse(data) : { parsed: false };
        if (data) {
            var uuid = guid(), extras;

            // TODO: The menu needs to be able to receive POST
            if (element.data('mm-id') || element.parent('[data-mm-id]')) {
                extras = {};
                extras.menutype = $('select.menu-select-wrap').value();
                extras.settings = JSON.stringify(mm.menumanager.settings);
                extras.ordering = JSON.stringify(mm.menumanager.ordering);
                extras.items = JSON.stringify(mm.menumanager.items);
            }

            storage.set(uuid, merge({}, data, {
                target: target,
                parent: parent,
                element: element,
                params: params,
                extras: extras,
                event: event
            }));
            data = { uuid: uuid };
        }

        History.pushState(data, title, url);

        var navbar, active, actives = $('#navbar .active, #main-header .active');

        if (navbar = element.parent('#navbar, #main-header')) {
            if (actives) { actives.removeClass('active'); }
            
            active = navbar.search('.active');
            if (active) { active.removeClass('active'); }
            element.parent('li').addClass('active');
        }
    });

    // attach change events to configurations selector
    selectorChangeEvent();
});


module.exports = {};
},{"../menu":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/menu/index.js","../ui":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/index.js","../ui/popover":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/popover.js","../utils/elements.utils":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js","./get-ajax-suffix":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js","./history":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/history.js","agent":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","mout/collection/size":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/size.js","mout/object/merge":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js","mout/queryString/encode":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/queryString/encode.js","mout/random/guid":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/guid.js","mout/string/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/contains.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/map.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.utils.js":[function(require,module,exports){
"use strict";
var $          = require('elements'),
    moofx      = require('moofx'),
    map        = require('mout/array/map'),
    series     = require('mout/function/series'),
    slick      = require('slick'),
    zen        = require('elements/zen'),
    progresser = require('../ui/progresser');

var walk = function(combinator, method) {

    return function(expression) {
        var parts = slick.parse(expression || "*");

        expression = map(parts, function(part) {
            return combinator + " " + part;
        }).join(', ');

        return this[method](expression);
    };

};


$.implement({
    style: function() {
        var moo = moofx(this);
        moo.style.apply(moo, arguments);
        return this;
    },

    animate: function() {
        var moo = moofx(this);
        moo.animate.apply(moo, arguments);
        return this;
    },

    progresser: function(options) {
        var instance;

        this.forEach(function(node) {
            instance = node.ProgresserInstance;

            if (!instance) { instance = new progresser(node, options); }
            else { instance.constructor(node, options); }

            node.ProgresserInstance = instance;
            return instance;
        });
    },

    compute: function() {
        var moo = moofx(this);
        return moo.compute.apply(moo, arguments);
    },

    showIndicator: function(klass, keepIcon) {
        this.forEach(function(node) {
            node = $(node);
            if (typeof klass == 'boolean') {
                keepIcon = klass;
                klass = null;
            }

            var icon = keepIcon ? false : node.find('i');
            node.gHadIcon = !!icon;

            if (!icon) {
                if (!node.find('span') && !node.children()) { zen('span').text(node.text()).top(node.empty()); }

                icon = zen('i');
                icon.top(node);
            }

            if (!node.gIndicator) { node.gIndicator = icon.attribute('class') || true; }
            icon.attribute('class', klass || 'fa fa-fw fa-spin-fast fa-spinner');
        });
    },

    hideIndicator: function() {
        this.forEach(function(node) {
            node = $(node);
            if (!node.gIndicator) { return; }

            var icon = node.find('i');

            if (!node.gHadIcon) { icon.remove(); }
            else { icon.attribute('class', node.gIndicator); }

            node.gIndicator = null;
        });
    },

    slideDown: function(animation, callback) {
        if (this.gSlideCollapsed === false) { return; }

        var element       = this,
            size          = this.getRealSize(),
            callbackStart = function() {
                element.gSlideCollapsed = false;
            },
            callbackEnd   = function() {
                element.attribute('style', element.gSlideStyle);
            };

        callback = typeof animation == 'function' ? animation : (callback || function() {});
        callback = series(callbackStart, callback, callbackEnd);

        animation = typeof animation == 'string' ? animation : {
            duration: '250ms',
            callback: callback
        };
        this.animate({ height: size.height }, animation);
    },

    slideUp: function(animation, callback) {
        if (this.gSlideCollapsed === true) { return; }

        if (typeof this.gSlideCollapsed == 'undefined') {
            this.gSlideStyle = this.attribute('style');
        }

        var element       = this,
            callbackStart = function() {
                element.gSlideCollapsed = true;
            };

        callback = typeof animation == 'function' ? animation : (callback || function() {});
        callback = series(callbackStart, callback);

        animation = typeof animation == 'string' ? animation : {
            duration: '250ms',
            callback: callback
        };
        this.style({ overflow: 'hidden' }).animate({ height: 0 }, animation);
    },

    slideToggle: function(animation, callback) {
        var size = this.getRealSize();
        return this[size.height && !this.gSlideCollapsed ? 'slideUp' : 'slideDown'](animation, callback);
    },

    getRealSize: function() {
        var style = this.attribute('style'), size;
        this.style({
            position: 'relative',
            overflow: 'inherit',
            top: -50000,
            height: 'auto',
            width: 'auto'
        });

        size = {
            width: parseInt(this.compute('width'), 10),
            height: parseInt(this.compute('height'), 10)
        };

        this.attribute('style', style);

        return size;
    },

    sibling: walk('++', 'find'),

    siblings: walk('~~', 'search')
});

module.exports = $;

},{"../ui/progresser":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/ui/progresser.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/zen":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js","moofx":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/index.js","mout/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/map.js","mout/function/series":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/series.js","slick":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/elements.viewport.js":[function(require,module,exports){
"use strict";
var $     = require('elements');

$.implement({
    belowthefold: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var fold = this.position().height + this[0].scrollTop;
        return elements.filter(function(element) {
            return fold <= $(element)[0].offsetTop - treshold;
        });
    },

    abovethetop: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var top = this[0].scrollTop;
        return elements.filter(function(element) {
            return top >= $(element)[0].offsetTop + $(element).position().height - treshold;
        });
    },

    rightofscreen: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var fold = this.position().width + this[0].scrollLeft;
        return elements.filter(function(element) {
            return fold <= $(element)[0].offsetLeft - treshold;
        });
    },

    leftofscreen: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var left = this[0].scrollLeft;
        return elements.filter(function(element) {
            return left >= $(element)[0].offsetLeft + $(element).position().width - treshold;
        });
    },

    inviewport: function(expression, treshold) {
        var elements = this.search(expression);
        treshold = treshold || 0;
        if (!elements) { return false; }

        var position = this.position();
        return elements.filter(function(element) {
            element = $(element);
            return element[0].offsetTop + treshold >= this[0].scrollTop &&
                element[0].offsetTop - treshold <= this[0].scrollTop + position.height;
        }, this);
    }
});

module.exports = $;

},{"elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-suffix.js":[function(require,module,exports){
"use strict";
var getAjaxSuffix = function() {
    return GANTRY_AJAX_SUFFIX;
};

module.exports = getAjaxSuffix;
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/get-ajax-url.js":[function(require,module,exports){
"use strict";
var unescapeHtml = require('mout/string/unescapeHtml');

var getAjaxURL = function(view, search) {
    if (!search) { search = '%ajax%'; }
    var re = new RegExp(search, 'g');

    return unescapeHtml(GANTRY_AJAX_URL.replace(re, view));
};

var getConfAjaxURL = function(view, search) {
    if (!search) { search = '%ajax%'; }
    var re = new RegExp(search, 'g');

    return unescapeHtml(GANTRY_AJAX_CONF_URL.replace(re, view));
};

module.exports = {
    global: getAjaxURL,
    config: getConfAjaxURL
};
},{"mout/string/unescapeHtml":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/unescapeHtml.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/history-adapter.js":[function(require,module,exports){
"use strict";

var $        = require('elements'),
    domready = require('elements/domready');

// Localise Globals
var History = {};

// Check Existence
if (typeof History.Adapter !== 'undefined') {
    throw new Error('History.js Adapter has already been loaded...');
}

// Add the Adapter
History.Adapter = {
    /**
     * History.Adapter.bind(el,event,callback)
     * @param {Element|string} el
     * @param {string} event - custom and standard events
     * @param {function} callback
     * @return {void}
     */
    bind: function(el, event, callback) {
        $(el).on(event, callback);
    },

    /**
     * History.Adapter.trigger(el,event)
     * @param {Element|string} el
     * @param {string} event - custom and standard events
     * @param {Object=} extra - a object of extra event data (optional)
     * @return void
     */
    trigger: function(el, event, extra) {
        $(el).emit(event, extra);
    },

    /**
     * History.Adapter.extractEventData(key,event,extra)
     * @param {string} key - key for the event data to extract
     * @param {string} event - custom and standard events
     */
    extractEventData: function(key, event) {
        // MooTools Native then MooTools Custom
        return (event && event.event && event.event[key]) || (event && event[key]) || undefined;
    },

    /**
     * History.Adapter.onDomLoad(callback)
     * @param {function} callback
     * @return {void}
     */
    onDomLoad: function(callback) {
        domready(callback);
    }
};

// Try and Initialise History
if (typeof History.init !== 'undefined') {
    History.init();
}

module.exports = History;
},{"elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js","elements/domready":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/history.js":[function(require,module,exports){
"use strict";

// ========================================================================
// Initialise

// Localise Globals
var
    console        = window.console || undefined, // Prevent a JSLint complain
    document       = window.document, // Make sure we are using the correct document
    navigator      = window.navigator, // Make sure we are using the correct navigator
    sessionStorage = false, // sessionStorage
    setTimeout     = window.setTimeout,
    clearTimeout   = window.clearTimeout,
    setInterval    = window.setInterval,
    clearInterval  = window.clearInterval,
    JSON           = window.JSON,
    alert          = window.alert,
    History        = window.History = require('./history-adapter') || {}, // Public History Object
    history        = window.history; // Old History Object

try {
    sessionStorage = window.sessionStorage; // This will throw an exception in some browsers when cookies/localStorage are explicitly disabled (i.e. Chrome)
    sessionStorage.setItem('TEST', '1');
    sessionStorage.removeItem('TEST');
} catch (e) {
    sessionStorage = false;
}

// MooTools Compatibility
JSON.stringify = JSON.stringify || JSON.encode;
JSON.parse = JSON.parse || JSON.decode;

// Check Existence
if (typeof History.init === 'undefined') {

    // Initialise History
    History.init = function (options) {
        // Check Load Status of Adapter
        if (typeof History.Adapter === 'undefined') {
            return false;
        }

        // Check Load Status of Core
        if (typeof History.initCore !== 'undefined') {
            History.initCore();
        }

        // Check Load Status of HTML4 Support
        if (typeof History.initHtml4 !== 'undefined') {
            History.initHtml4();
        }

        // Return true
        return true;
    };


    // ========================================================================
    // Initialise Core

    // Initialise Core
    History.initCore = function (options) {
        // Initialise
        if (typeof History.initCore.initialized !== 'undefined') {
            // Already Loaded
            return false;
        }
        else {
            History.initCore.initialized = true;
        }


        // ====================================================================
        // Options

        /**
         * History.options
         * Configurable options
         */
        History.options = History.options || {};

        /**
         * History.options.hashChangeInterval
         * How long should the interval be before hashchange checks
         */
        History.options.hashChangeInterval = History.options.hashChangeInterval || 100;

        /**
         * History.options.safariPollInterval
         * How long should the interval be before safari poll checks
         */
        History.options.safariPollInterval = History.options.safariPollInterval || 500;

        /**
         * History.options.doubleCheckInterval
         * How long should the interval be before we perform a double check
         */
        History.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;

        /**
         * History.options.disableSuid
         * Force History not to append suid
         */
        History.options.disableSuid = History.options.disableSuid || false;

        /**
         * History.options.storeInterval
         * How long should we wait between store calls
         */
        History.options.storeInterval = History.options.storeInterval || 1000;

        /**
         * History.options.busyDelay
         * How long should we wait between busy events
         */
        History.options.busyDelay = History.options.busyDelay || 250;

        /**
         * History.options.debug
         * If true will enable debug messages to be logged
         */
        History.options.debug = History.options.debug || false;

        /**
         * History.options.initialTitle
         * What is the title of the initial state
         */
        History.options.initialTitle = History.options.initialTitle || document.title;

        /**
         * History.options.html4Mode
         * If true, will force HTMl4 mode (hashtags)
         */
        History.options.html4Mode = History.options.html4Mode || false;

        /**
         * History.options.delayInit
         * Want to override default options and call init manually.
         */
        History.options.delayInit = History.options.delayInit || false;


        // ====================================================================
        // Interval record

        /**
         * History.intervalList
         * List of intervals set, to be cleared when document is unloaded.
         */
        History.intervalList = [];

        /**
         * History.clearAllIntervals
         * Clears all setInterval instances.
         */
        History.clearAllIntervals = function () {
            var i, il = History.intervalList;
            if (typeof il !== "undefined" && il !== null) {
                for (i = 0; i < il.length; i++) {
                    clearInterval(il[i]);
                }
                History.intervalList = null;
            }
        };


        // ====================================================================
        // Debug

        /**
         * History.debug(message,...)
         * Logs the passed arguments if debug enabled
         */
        History.debug = function () {
            if ((History.options.debug || false)) {
                History.log.apply(History, arguments);
            }
        };

        /**
         * History.log(message,...)
         * Logs the passed arguments
         */
        History.log = function () {
            // Prepare
            var
                consoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),
                textarea = document.getElementById('log'),
                message,
                i, n,
                args, arg
                ;

            // Write to Console
            if (consoleExists) {
                args = Array.prototype.slice.call(arguments);
                message = args.shift();
                if (typeof console.debug !== 'undefined') {
                    console.debug.apply(console, [message, args]);
                }
                else {
                    console.log.apply(console, [message, args]);
                }
            }
            else {
                message = ("\n" + arguments[0] + "\n");
            }

            // Write to log
            for (i = 1, n = arguments.length; i < n; ++i) {
                arg = arguments[i];
                if (typeof arg === 'object' && typeof JSON !== 'undefined') {
                    try {
                        arg = JSON.stringify(arg);
                    }
                    catch (Exception) {
                        // Recursive Object
                    }
                }
                message += "\n" + arg + "\n";
            }

            // Textarea
            if (textarea) {
                textarea.value += message + "\n-----\n";
                textarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;
            }
            // No Textarea, No Console
            else if (!consoleExists) {
                alert(message);
            }

            // Return true
            return true;
        };


        // ====================================================================
        // Emulated Status

        /**
         * History.getInternetExplorerMajorVersion()
         * Get's the major version of Internet Explorer
         * @return {integer}
         * @license Public Domain
         * @author Benjamin Arthur Lupton <contact@balupton.com>
         * @author James Padolsey <https://gist.github.com/527683>
         */
        History.getInternetExplorerMajorVersion = function () {
            var result = History.getInternetExplorerMajorVersion.cached =
                    (typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')
                        ? History.getInternetExplorerMajorVersion.cached
                        : (function () {
                        var v = 3,
                            div = document.createElement('div'),
                            all = div.getElementsByTagName('i');
                        while ((div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0]) {
                        }
                        return (v > 4) ? v : false;
                    })()
                ;
            return result;
        };

        /**
         * History.isInternetExplorer()
         * Are we using Internet Explorer?
         * @return {boolean}
         * @license Public Domain
         * @author Benjamin Arthur Lupton <contact@balupton.com>
         */
        History.isInternetExplorer = function () {
            var result =
                    History.isInternetExplorer.cached =
                        (typeof History.isInternetExplorer.cached !== 'undefined')
                            ? History.isInternetExplorer.cached
                            : Boolean(History.getInternetExplorerMajorVersion())
                ;
            return result;
        };

        /**
         * History.emulated
         * Which features require emulating?
         */

        if (History.options.html4Mode) {
            History.emulated = {
                pushState: true,
                hashChange: true
            };
        }

        else {

            History.emulated = {
                pushState: !Boolean(
                    window.history && window.history.pushState && window.history.replaceState
                    && !(
                    (/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */
                    || (/AppleWebKit\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */
                    )
                ),
                hashChange: Boolean(
                    !(('onhashchange' in window) || ('onhashchange' in document))
                    ||
                    (History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)
                )
            };
        }

        /**
         * History.enabled
         * Is History enabled?
         */
        History.enabled = !History.emulated.pushState;

        /**
         * History.bugs
         * Which bugs are present
         */
        History.bugs = {
            /**
             * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call
             * https://bugs.webkit.org/show_bug.cgi?id=56249
             */
            setHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

            /**
             * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions
             * https://bugs.webkit.org/show_bug.cgi?id=42940
             */
            safariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

            /**
             * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)
             */
            ieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),

            /**
             * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event
             */
            hashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)
        };

        /**
         * History.isEmptyObject(obj)
         * Checks to see if the Object is Empty
         * @param {Object} obj
         * @return {boolean}
         */
        History.isEmptyObject = function (obj) {
            for (var name in obj) {
                if (obj.hasOwnProperty(name)) {
                    return false;
                }
            }
            return true;
        };

        /**
         * History.cloneObject(obj)
         * Clones a object and eliminate all references to the original contexts
         * @param {Object} obj
         * @return {Object}
         */
        History.cloneObject = function (obj) {
            var hash, newObj;
            if (obj) {
                hash = JSON.stringify(obj);
                newObj = JSON.parse(hash);
            }
            else {
                newObj = {};
            }
            return newObj;
        };


        // ====================================================================
        // URL Helpers

        /**
         * History.getRootUrl()
         * Turns "http://mysite.com/dir/page.html?asd" into "http://mysite.com"
         * @return {String} rootUrl
         */
        History.getRootUrl = function () {
            // Create
            var rootUrl = document.location.protocol + '//' + (document.location.hostname || document.location.host);
            if (document.location.port || false) {
                rootUrl += ':' + document.location.port;
            }
            rootUrl += '/';

            // Return
            return rootUrl;
        };

        /**
         * History.getBaseHref()
         * Fetches the `href` attribute of the `<base href="...">` element if it exists
         * @return {String} baseHref
         */
        History.getBaseHref = function () {
            // Create
            var
                baseElements = document.getElementsByTagName('base'),
                baseElement = null,
                baseHref = '';

            // Test for Base Element
            if (baseElements.length === 1) {
                // Prepare for Base Element
                baseElement = baseElements[0];
                baseHref = baseElement.href.replace(/[^\/]+$/, '');
            }

            // Adjust trailing slash
            baseHref = baseHref.replace(/\/+$/, '');
            if (baseHref) baseHref += '/';

            // Return
            return baseHref;
        };

        /**
         * History.getBaseUrl()
         * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)
         * @return {String} baseUrl
         */
        History.getBaseUrl = function () {
            // Create
            var baseUrl = History.getBaseHref() || History.getBasePageUrl() || History.getRootUrl();

            // Return
            return baseUrl;
        };

        /**
         * History.getPageUrl()
         * Fetches the URL of the current page
         * @return {String} pageUrl
         */
        History.getPageUrl = function () {
            // Fetch
            var
                State = History.getState(false, false),
                stateUrl = (State || {}).url || History.getLocationHref(),
                pageUrl;

            // Create
            pageUrl = stateUrl.replace(/\/+$/, '').replace(/[^\/]+$/, function (part, index, string) {
                return (/\./).test(part) ? part : part + '/';
            });

            // Return
            return pageUrl;
        };

        /**
         * History.getBasePageUrl()
         * Fetches the Url of the directory of the current page
         * @return {String} basePageUrl
         */
        History.getBasePageUrl = function () {
            // Create
            var basePageUrl = (History.getLocationHref()).replace(/[#\?].*/, '').replace(/[^\/]+$/, function (part, index, string) {
                    return (/[^\/]$/).test(part) ? '' : part;
                }).replace(/\/+$/, '') + '/';

            // Return
            return basePageUrl;
        };

        /**
         * History.getFullUrl(url)
         * Ensures that we have an absolute URL and not a relative URL
         * @param {string} url
         * @param {Boolean} allowBaseHref
         * @return {string} fullUrl
         */
        History.getFullUrl = function (url, allowBaseHref) {
            // Prepare
            var fullUrl = url, firstChar = url.substring(0, 1);
            allowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;

            // Check
            if (/[a-z]+\:\/\//.test(url)) {
                // Full URL
            }
            else if (firstChar === '/') {
                // Root URL
                fullUrl = History.getRootUrl() + url.replace(/^\/+/, '');
            }
            else if (firstChar === '#') {
                // Anchor URL
                fullUrl = History.getPageUrl().replace(/#.*/, '') + url;
            }
            else if (firstChar === '?') {
                // Query URL
                fullUrl = History.getPageUrl().replace(/[\?#].*/, '') + url;
            }
            else {
                // Relative URL
                if (allowBaseHref) {
                    fullUrl = History.getBaseUrl() + url.replace(/^(\.\/)+/, '');
                } else {
                    fullUrl = History.getBasePageUrl() + url.replace(/^(\.\/)+/, '');
                }
                // We have an if condition above as we do not want hashes
                // which are relative to the baseHref in our URLs
                // as if the baseHref changes, then all our bookmarks
                // would now point to different locations
                // whereas the basePageUrl will always stay the same
            }

            // Return
            return fullUrl.replace(/\#$/, '');
        };

        /**
         * History.getShortUrl(url)
         * Ensures that we have a relative URL and not a absolute URL
         * @param {string} url
         * @return {string} url
         */
        History.getShortUrl = function (url) {
            // Prepare
            var shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();

            // Trim baseUrl
            if (History.emulated.pushState) {
                // We are in a if statement as when pushState is not emulated
                // The actual url these short urls are relative to can change
                // So within the same session, we the url may end up somewhere different
                shortUrl = shortUrl.replace(baseUrl, '');
            }

            // Trim rootUrl
            shortUrl = shortUrl.replace(rootUrl, '/');

            // Ensure we can still detect it as a state
            if (History.isTraditionalAnchor(shortUrl)) {
                shortUrl = './' + shortUrl;
            }

            // Clean It
            shortUrl = shortUrl.replace(/^(\.\/)+/g, './').replace(/\#$/, '');

            // Return
            return shortUrl;
        };

        /**
         * History.getLocationHref(document)
         * Returns a normalized version of document.location.href
         * accounting for browser inconsistencies, etc.
         *
         * This URL will be URI-encoded and will include the hash
         *
         * @param {object} document
         * @return {string} url
         */
        History.getLocationHref = function (doc) {
            doc = doc || document;

            // most of the time, this will be true
            if (doc.URL === doc.location.href)
                return doc.location.href;

            // some versions of webkit URI-decode document.location.href
            // but they leave document.URL in an encoded state
            if (doc.location.href === decodeURIComponent(doc.URL))
                return doc.URL;

            // FF 3.6 only updates document.URL when a page is reloaded
            // document.location.href is updated correctly
            if (doc.location.hash && decodeURIComponent(doc.location.href.replace(/^[^#]+/, "")) === doc.location.hash)
                return doc.location.href;

            if (doc.URL.indexOf('#') == -1 && doc.location.href.indexOf('#') != -1)
                return doc.location.href;

            return doc.URL || doc.location.href;
        };


        // ====================================================================
        // State Storage

        /**
         * History.store
         * The store for all session specific data
         */
        History.store = {};

        /**
         * History.idToState
         * 1-1: State ID to State Object
         */
        History.idToState = History.idToState || {};

        /**
         * History.stateToId
         * 1-1: State String to State ID
         */
        History.stateToId = History.stateToId || {};

        /**
         * History.urlToId
         * 1-1: State URL to State ID
         */
        History.urlToId = History.urlToId || {};

        /**
         * History.storedStates
         * Store the states in an array
         */
        History.storedStates = History.storedStates || [];

        /**
         * History.savedStates
         * Saved the states in an array
         */
        History.savedStates = History.savedStates || [];

        /**
         * History.noramlizeStore()
         * Noramlize the store by adding necessary values
         */
        History.normalizeStore = function () {
            History.store.idToState = History.store.idToState || {};
            History.store.urlToId = History.store.urlToId || {};
            History.store.stateToId = History.store.stateToId || {};
        };

        /**
         * History.getState()
         * Get an object containing the data, title and url of the current state
         * @param {Boolean} friendly
         * @param {Boolean} create
         * @return {Object} State
         */
        History.getState = function (friendly, create) {
            // Prepare
            if (typeof friendly === 'undefined') {
                friendly = true;
            }
            if (typeof create === 'undefined') {
                create = true;
            }

            // Fetch
            var State = History.getLastSavedState();

            // Create
            if (!State && create) {
                State = History.createStateObject();
            }

            // Adjust
            if (friendly) {
                State = History.cloneObject(State);
                State.url = State.cleanUrl || State.url;
            }

            // Return
            return State;
        };

        /**
         * History.getIdByState(State)
         * Gets a ID for a State
         * @param {State} newState
         * @return {String} id
         */
        History.getIdByState = function (newState) {

            // Fetch ID
            var id = History.extractId(newState.url),
                str;

            if (!id) {
                // Find ID via State String
                str = History.getStateString(newState);
                if (typeof History.stateToId[str] !== 'undefined') {
                    id = History.stateToId[str];
                }
                else if (typeof History.store.stateToId[str] !== 'undefined') {
                    id = History.store.stateToId[str];
                }
                else {
                    // Generate a new ID
                    while (true) {
                        id = (new Date()).getTime() + String(Math.random()).replace(/\D/g, '');
                        if (typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined') {
                            break;
                        }
                    }

                    // Apply the new State to the ID
                    History.stateToId[str] = id;
                    History.idToState[id] = newState;
                }
            }

            // Return ID
            return id;
        };

        /**
         * History.normalizeState(State)
         * Expands a State Object
         * @param {object} State
         * @return {object}
         */
        History.normalizeState = function (oldState) {
            // Variables
            var newState, dataNotEmpty;

            // Prepare
            if (!oldState || (typeof oldState !== 'object')) {
                oldState = {};
            }

            // Check
            if (typeof oldState.normalized !== 'undefined') {
                return oldState;
            }

            // Adjust
            if (!oldState.data || (typeof oldState.data !== 'object')) {
                oldState.data = {};
            }

            // ----------------------------------------------------------------

            // Create
            newState = {};
            newState.normalized = true;
            newState.title = oldState.title || '';
            newState.url = History.getFullUrl(oldState.url ? oldState.url : (History.getLocationHref()));
            newState.hash = History.getShortUrl(newState.url);
            newState.data = History.cloneObject(oldState.data);

            // Fetch ID
            newState.id = History.getIdByState(newState);

            // ----------------------------------------------------------------

            // Clean the URL
            newState.cleanUrl = newState.url.replace(/\??\&_suid.*/, '');
            newState.url = newState.cleanUrl;

            // Check to see if we have more than just a url
            dataNotEmpty = !History.isEmptyObject(newState.data);

            // Apply
            if ((newState.title || dataNotEmpty) && History.options.disableSuid !== true) {
                // Add ID to Hash
                newState.hash = History.getShortUrl(newState.url).replace(/\??\&_suid.*/, '');
                if (!/\?/.test(newState.hash)) {
                    newState.hash += '?';
                }
                newState.hash += '&_suid=' + newState.id;
            }

            // Create the Hashed URL
            newState.hashedUrl = History.getFullUrl(newState.hash);

            // ----------------------------------------------------------------

            // Update the URL if we have a duplicate
            if ((History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState)) {
                newState.url = newState.hashedUrl;
            }

            // ----------------------------------------------------------------

            // Return
            return newState;
        };

        /**
         * History.createStateObject(data,title,url)
         * Creates a object based on the data, title and url state params
         * @param {object} data
         * @param {string} title
         * @param {string} url
         * @return {object}
         */
        History.createStateObject = function (data, title, url) {
            // Hashify
            var State = {
                'data': data,
                'title': title,
                'url': url
            };

            // Expand the State
            State = History.normalizeState(State);

            // Return object
            return State;
        };

        /**
         * History.getStateById(id)
         * Get a state by it's UID
         * @param {String} id
         */
        History.getStateById = function (id) {
            // Prepare
            id = String(id);

            // Retrieve
            var State = History.idToState[id] || History.store.idToState[id] || undefined;

            // Return State
            return State;
        };

        /**
         * Get a State's String
         * @param {State} passedState
         */
        History.getStateString = function (passedState) {
            // Prepare
            var State, cleanedState, str;

            // Fetch
            State = History.normalizeState(passedState);

            // Clean
            cleanedState = {
                data: State.data,
                title: passedState.title,
                url: passedState.url
            };

            // Fetch
            str = JSON.stringify(cleanedState);

            // Return
            return str;
        };

        /**
         * Get a State's ID
         * @param {State} passedState
         * @return {String} id
         */
        History.getStateId = function (passedState) {
            // Prepare
            var State, id;

            // Fetch
            State = History.normalizeState(passedState);

            // Fetch
            id = State.id;

            // Return
            return id;
        };

        /**
         * History.getHashByState(State)
         * Creates a Hash for the State Object
         * @param {State} passedState
         * @return {String} hash
         */
        History.getHashByState = function (passedState) {
            // Prepare
            var State, hash;

            // Fetch
            State = History.normalizeState(passedState);

            // Hash
            hash = State.hash;

            // Return
            return hash;
        };

        /**
         * History.extractId(url_or_hash)
         * Get a State ID by it's URL or Hash
         * @param {string} url_or_hash
         * @return {string} id
         */
        History.extractId = function (url_or_hash) {
            // Prepare
            var id, parts, url, tmp;

            // Extract

            // If the URL has a #, use the id from before the #
            if (url_or_hash.indexOf('#') != -1) {
                tmp = url_or_hash.split("#")[0];
            }
            else {
                tmp = url_or_hash;
            }

            parts = /(.*)\&_suid=([0-9]+)$/.exec(tmp);
            url = parts ? (parts[1] || url_or_hash) : url_or_hash;
            id = parts ? String(parts[2] || '') : '';

            // Return
            return id || false;
        };

        /**
         * History.isTraditionalAnchor
         * Checks to see if the url is a traditional anchor or not
         * @param {String} url_or_hash
         * @return {Boolean}
         */
        History.isTraditionalAnchor = function (url_or_hash) {
            // Check
            var isTraditional = !(/[\/\?\.]/.test(url_or_hash));

            // Return
            return isTraditional;
        };

        /**
         * History.extractState
         * Get a State by it's URL or Hash
         * @param {String} url_or_hash
         * @return {State|null}
         */
        History.extractState = function (url_or_hash, create) {
            // Prepare
            var State = null, id, url;
            create = create || false;

            // Fetch SUID
            id = History.extractId(url_or_hash);
            if (id) {
                State = History.getStateById(id);
            }

            // Fetch SUID returned no State
            if (!State) {
                // Fetch URL
                url = History.getFullUrl(url_or_hash);

                // Check URL
                id = History.getIdByUrl(url) || false;
                if (id) {
                    State = History.getStateById(id);
                }

                // Create State
                if (!State && create && !History.isTraditionalAnchor(url_or_hash)) {
                    State = History.createStateObject(null, null, url);
                }
            }

            // Return
            return State;
        };

        /**
         * History.getIdByUrl()
         * Get a State ID by a State URL
         */
        History.getIdByUrl = function (url) {
            // Fetch
            var id = History.urlToId[url] || History.store.urlToId[url] || undefined;

            // Return
            return id;
        };

        /**
         * History.getLastSavedState()
         * Get an object containing the data, title and url of the current state
         * @return {Object} State
         */
        History.getLastSavedState = function () {
            return History.savedStates[History.savedStates.length - 1] || undefined;
        };

        /**
         * History.getLastStoredState()
         * Get an object containing the data, title and url of the current state
         * @return {Object} State
         */
        History.getLastStoredState = function () {
            return History.storedStates[History.storedStates.length - 1] || undefined;
        };

        /**
         * History.hasUrlDuplicate
         * Checks if a Url will have a url conflict
         * @param {Object} newState
         * @return {Boolean} hasDuplicate
         */
        History.hasUrlDuplicate = function (newState) {
            // Prepare
            var hasDuplicate = false,
                oldState;

            // Fetch
            oldState = History.extractState(newState.url);

            // Check
            hasDuplicate = oldState && oldState.id !== newState.id;

            // Return
            return hasDuplicate;
        };

        /**
         * History.storeState
         * Store a State
         * @param {Object} newState
         * @return {Object} newState
         */
        History.storeState = function (newState) {
            // Store the State
            History.urlToId[newState.url] = newState.id;

            // Push the State
            History.storedStates.push(History.cloneObject(newState));

            // Return newState
            return newState;
        };

        /**
         * History.isLastSavedState(newState)
         * Tests to see if the state is the last state
         * @param {Object} newState
         * @return {boolean} isLast
         */
        History.isLastSavedState = function (newState) {
            // Prepare
            var isLast = false,
                newId, oldState, oldId;

            // Check
            if (History.savedStates.length) {
                newId = newState.id;
                oldState = History.getLastSavedState();
                oldId = oldState.id;

                // Check
                isLast = (newId === oldId);
            }

            // Return
            return isLast;
        };

        /**
         * History.saveState
         * Push a State
         * @param {Object} newState
         * @return {boolean} changed
         */
        History.saveState = function (newState) {
            // Check Hash
            if (History.isLastSavedState(newState)) {
                return false;
            }

            // Push the State
            History.savedStates.push(History.cloneObject(newState));

            // Return true
            return true;
        };

        /**
         * History.getStateByIndex()
         * Gets a state by the index
         * @param {integer} index
         * @return {Object}
         */
        History.getStateByIndex = function (index) {
            // Prepare
            var State = null;

            // Handle
            if (typeof index === 'undefined') {
                // Get the last inserted
                State = History.savedStates[History.savedStates.length - 1];
            }
            else if (index < 0) {
                // Get from the end
                State = History.savedStates[History.savedStates.length + index];
            }
            else {
                // Get from the beginning
                State = History.savedStates[index];
            }

            // Return State
            return State;
        };

        /**
         * History.getCurrentIndex()
         * Gets the current index
         * @return (integer)
         */
        History.getCurrentIndex = function () {
            // Prepare
            var index = null;

            // No states saved
            if (History.savedStates.length < 1) {
                index = 0;
            }
            else {
                index = History.savedStates.length - 1;
            }
            return index;
        };

        // ====================================================================
        // Hash Helpers

        /**
         * History.getHash()
         * @param {Location=} location
         * Gets the current document hash
         * Note: unlike location.hash, this is guaranteed to return the escaped hash in all browsers
         * @return {string}
         */
        History.getHash = function (doc) {
            var url = History.getLocationHref(doc),
                hash;
            hash = History.getHashByUrl(url);
            return hash;
        };

        /**
         * History.unescapeHash()
         * normalize and Unescape a Hash
         * @param {String} hash
         * @return {string}
         */
        History.unescapeHash = function (hash) {
            // Prepare
            var result = History.normalizeHash(hash);

            // Unescape hash
            result = decodeURIComponent(result);

            // Return result
            return result;
        };

        /**
         * History.normalizeHash()
         * normalize a hash across browsers
         * @return {string}
         */
        History.normalizeHash = function (hash) {
            // Prepare
            var result = hash.replace(/[^#]*#/, '').replace(/#.*/, '');

            // Return result
            return result;
        };

        /**
         * History.setHash(hash)
         * Sets the document hash
         * @param {string} hash
         * @return {History}
         */
        History.setHash = function (hash, queue) {
            // Prepare
            var State, pageUrl;

            // Handle Queueing
            if (queue !== false && History.busy()) {
                // Wait + Push to Queue
                //History.debug('History.setHash: we must wait', arguments);
                History.pushQueue({
                    scope: History,
                    callback: History.setHash,
                    args: arguments,
                    queue: queue
                });
                return false;
            }

            // Log
            //History.debug('History.setHash: called',hash);

            // Make Busy + Continue
            History.busy(true);

            // Check if hash is a state
            State = History.extractState(hash, true);
            if (State && !History.emulated.pushState) {
                // Hash is a state so skip the setHash
                //History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);

                // PushState
                History.pushState(State.data, State.title, State.url, false);
            }
            else if (History.getHash() !== hash) {
                // Hash is a proper hash, so apply it

                // Handle browser bugs
                if (History.bugs.setHash) {
                    // Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249

                    // Fetch the base page
                    pageUrl = History.getPageUrl();

                    // Safari hash apply
                    History.pushState(null, null, pageUrl + '#' + hash, false);
                }
                else {
                    // Normal hash apply
                    document.location.hash = hash;
                }
            }

            // Chain
            return History;
        };

        /**
         * History.escape()
         * normalize and Escape a Hash
         * @return {string}
         */
        History.escapeHash = function (hash) {
            // Prepare
            var result = History.normalizeHash(hash);

            // Escape hash
            result = window.encodeURIComponent(result);

            // IE6 Escape Bug
            if (!History.bugs.hashEscape) {
                // Restore common parts
                result = result
                    .replace(/\%21/g, '!')
                    .replace(/\%26/g, '&')
                    .replace(/\%3D/g, '=')
                    .replace(/\%3F/g, '?');
            }

            // Return result
            return result;
        };

        /**
         * History.getHashByUrl(url)
         * Extracts the Hash from a URL
         * @param {string} url
         * @return {string} url
         */
        History.getHashByUrl = function (url) {
            // Extract the hash
            var hash = String(url)
                    .replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')
                ;

            // Unescape hash
            hash = History.unescapeHash(hash);

            // Return hash
            return hash;
        };

        /**
         * History.setTitle(title)
         * Applies the title to the document
         * @param {State} newState
         * @return {Boolean}
         */
        History.setTitle = function (newState) {
            // Prepare
            var title = newState.title,
                firstState;

            // Initial
            if (!title) {
                firstState = History.getStateByIndex(0);
                if (firstState && firstState.url === newState.url) {
                    title = firstState.title || History.options.initialTitle;
                }
            }

            // Apply
            try {
                document.getElementsByTagName('title')[0].innerHTML = title.replace('<', '&lt;').replace('>', '&gt;').replace(' & ', ' &amp; ');
            }
            catch (Exception) {
            }
            document.title = title;

            // Chain
            return History;
        };


        // ====================================================================
        // Queueing

        /**
         * History.queues
         * The list of queues to use
         * First In, First Out
         */
        History.queues = [];

        /**
         * History.busy(value)
         * @param {boolean} value [optional]
         * @return {boolean} busy
         */
        History.busy = function (value) {
            // Apply
            if (typeof value !== 'undefined') {
                //History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);
                History.busy.flag = value;
            }
            // Default
            else if (typeof History.busy.flag === 'undefined') {
                History.busy.flag = false;
            }

            // Queue
            if (!History.busy.flag) {
                // Execute the next item in the queue
                clearTimeout(History.busy.timeout);
                var fireNext = function () {
                    var i, queue, item;
                    if (History.busy.flag) return;
                    for (i = History.queues.length - 1; i >= 0; --i) {
                        queue = History.queues[i];
                        if (queue.length === 0) continue;
                        item = queue.shift();
                        History.fireQueueItem(item);
                        History.busy.timeout = setTimeout(fireNext, History.options.busyDelay);
                    }
                };
                History.busy.timeout = setTimeout(fireNext, History.options.busyDelay);
            }

            // Return
            return History.busy.flag;
        };

        /**
         * History.busy.flag
         */
        History.busy.flag = false;

        /**
         * History.fireQueueItem(item)
         * Fire a Queue Item
         * @param {Object} item
         * @return {Mixed} result
         */
        History.fireQueueItem = function (item) {
            return item.callback.apply(item.scope || History, item.args || []);
        };

        /**
         * History.pushQueue(callback,args)
         * Add an item to the queue
         * @param {Object} item [scope,callback,args,queue]
         */
        History.pushQueue = function (item) {
            // Prepare the queue
            History.queues[item.queue || 0] = History.queues[item.queue || 0] || [];

            // Add to the queue
            History.queues[item.queue || 0].push(item);

            // Chain
            return History;
        };

        /**
         * History.queue (item,queue), (func,queue), (func), (item)
         * Either firs the item now if not busy, or adds it to the queue
         */
        History.queue = function (item, queue) {
            // Prepare
            if (typeof item === 'function') {
                item = {
                    callback: item
                };
            }
            if (typeof queue !== 'undefined') {
                item.queue = queue;
            }

            // Handle
            if (History.busy()) {
                History.pushQueue(item);
            } else {
                History.fireQueueItem(item);
            }

            // Chain
            return History;
        };

        /**
         * History.clearQueue()
         * Clears the Queue
         */
        History.clearQueue = function () {
            History.busy.flag = false;
            History.queues = [];
            return History;
        };


        // ====================================================================
        // IE Bug Fix

        /**
         * History.stateChanged
         * States whether or not the state has changed since the last double check was initialised
         */
        History.stateChanged = false;

        /**
         * History.doubleChecker
         * Contains the timeout used for the double checks
         */
        History.doubleChecker = false;

        /**
         * History.doubleCheckComplete()
         * Complete a double check
         * @return {History}
         */
        History.doubleCheckComplete = function () {
            // Update
            History.stateChanged = true;

            // Clear
            History.doubleCheckClear();

            // Chain
            return History;
        };

        /**
         * History.doubleCheckClear()
         * Clear a double check
         * @return {History}
         */
        History.doubleCheckClear = function () {
            // Clear
            if (History.doubleChecker) {
                clearTimeout(History.doubleChecker);
                History.doubleChecker = false;
            }

            // Chain
            return History;
        };

        /**
         * History.doubleCheck()
         * Create a double check
         * @return {History}
         */
        History.doubleCheck = function (tryAgain) {
            // Reset
            History.stateChanged = false;
            History.doubleCheckClear();

            // Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)
            // Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940
            if (History.bugs.ieDoubleCheck) {
                // Apply Check
                History.doubleChecker = setTimeout(
                    function () {
                        History.doubleCheckClear();
                        if (!History.stateChanged) {
                            //History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);
                            // Re-Attempt
                            tryAgain();
                        }
                        return true;
                    },
                    History.options.doubleCheckInterval
                );
            }

            // Chain
            return History;
        };


        // ====================================================================
        // Safari Bug Fix

        /**
         * History.safariStatePoll()
         * Poll the current state
         * @return {History}
         */
        History.safariStatePoll = function () {
            // Poll the URL

            // Get the Last State which has the new URL
            var
                urlState = History.extractState(History.getLocationHref()),
                newState;

            // Check for a difference
            if (!History.isLastSavedState(urlState)) {
                newState = urlState;
            }
            else {
                return;
            }

            // Check if we have a state with that url
            // If not create it
            if (!newState) {
                //History.debug('History.safariStatePoll: new');
                newState = History.createStateObject();
            }

            // Apply the New State
            //History.debug('History.safariStatePoll: trigger');
            History.Adapter.trigger(window, 'popstate');

            // Chain
            return History;
        };


        // ====================================================================
        // State Aliases

        /**
         * History.back(queue)
         * Send the browser history back one item
         * @param {Integer} queue [optional]
         */
        History.back = function (queue) {
            //History.debug('History.back: called', arguments);

            // Handle Queueing
            if (queue !== false && History.busy()) {
                // Wait + Push to Queue
                //History.debug('History.back: we must wait', arguments);
                History.pushQueue({
                    scope: History,
                    callback: History.back,
                    args: arguments,
                    queue: queue
                });
                return false;
            }

            // Make Busy + Continue
            History.busy(true);

            // Fix certain browser bugs that prevent the state from changing
            History.doubleCheck(function () {
                History.back(false);
            });

            // Go back
            history.go(-1);

            // End back closure
            return true;
        };

        /**
         * History.forward(queue)
         * Send the browser history forward one item
         * @param {Integer} queue [optional]
         */
        History.forward = function (queue) {
            //History.debug('History.forward: called', arguments);

            // Handle Queueing
            if (queue !== false && History.busy()) {
                // Wait + Push to Queue
                //History.debug('History.forward: we must wait', arguments);
                History.pushQueue({
                    scope: History,
                    callback: History.forward,
                    args: arguments,
                    queue: queue
                });
                return false;
            }

            // Make Busy + Continue
            History.busy(true);

            // Fix certain browser bugs that prevent the state from changing
            History.doubleCheck(function () {
                History.forward(false);
            });

            // Go forward
            history.go(1);

            // End forward closure
            return true;
        };

        /**
         * History.go(index,queue)
         * Send the browser history back or forward index times
         * @param {Integer} queue [optional]
         */
        History.go = function (index, queue) {
            //History.debug('History.go: called', arguments);

            // Prepare
            var i;

            // Handle
            if (index > 0) {
                // Forward
                for (i = 1; i <= index; ++i) {
                    History.forward(queue);
                }
            }
            else if (index < 0) {
                // Backward
                for (i = -1; i >= index; --i) {
                    History.back(queue);
                }
            }
            else {
                throw new Error('History.go: History.go requires a positive or negative integer passed.');
            }

            // Chain
            return History;
        };


        // ====================================================================
        // HTML5 State Support

        // Non-Native pushState Implementation
        if (History.emulated.pushState) {
            /*
             * Provide Skeleton for HTML4 Browsers
             */

            // Prepare
            var emptyFunction = function () {};
            History.pushState = History.pushState || emptyFunction;
            History.replaceState = History.replaceState || emptyFunction;
        } // History.emulated.pushState

        // Native pushState Implementation
        else {
            /*
             * Use native HTML5 History API Implementation
             */

            /**
             * History.onPopState(event,extra)
             * Refresh the Current State
             */
            History.onPopState = function (event, extra) {
                // Prepare
                var stateId = false, newState = false, currentHash, currentState;

                // Reset the double check
                History.doubleCheckComplete();

                // Check for a Hash, and handle apporiatly
                currentHash = History.getHash();
                if (currentHash) {
                    // Expand Hash
                    currentState = History.extractState(currentHash || History.getLocationHref(), true);
                    if (currentState) {
                        // We were able to parse it, it must be a State!
                        // Let's forward to replaceState
                        //History.debug('History.onPopState: state anchor', currentHash, currentState);
                        History.replaceState(currentState.data, currentState.title, currentState.url, false);
                    }
                    else {
                        // Traditional Anchor
                        //History.debug('History.onPopState: traditional anchor', currentHash);
                        History.Adapter.trigger(window, 'anchorchange');
                        History.busy(false);
                    }

                    // We don't care for hashes
                    History.expectedStateId = false;
                    return false;
                }

                // Ensure
                stateId = History.Adapter.extractEventData('state', event, extra) || false;

                // Fetch State
                if (stateId) {
                    // Vanilla: Back/forward button was used
                    newState = History.getStateById(stateId);
                }
                else if (History.expectedStateId) {
                    // Vanilla: A new state was pushed, and popstate was called manually
                    newState = History.getStateById(History.expectedStateId);
                }
                else {
                    // Initial State
                    newState = History.extractState(History.getLocationHref());
                }

                // The State did not exist in our store
                if (!newState) {
                    // Regenerate the State
                    newState = History.createStateObject(null, null, History.getLocationHref());
                }

                // Clean
                History.expectedStateId = false;

                // Check if we are the same state
                if (History.isLastSavedState(newState)) {
                    // There has been no change (just the page's hash has finally propagated)
                    //History.debug('History.onPopState: no change', newState, History.savedStates);
                    History.busy(false);
                    return false;
                }

                // Store the State
                History.storeState(newState);
                History.saveState(newState);

                // Force update of the title
                History.setTitle(newState);

                // Fire Our Event
                History.Adapter.trigger(window, 'statechange');
                History.busy(false);

                // Return true
                return true;
            };
            History.Adapter.bind(window, 'popstate', History.onPopState);

            /**
             * History.pushState(data,title,url)
             * Add a new State to the history object, become it, and trigger onpopstate
             * We have to trigger for HTML4 compatibility
             * @param {object} data
             * @param {string} title
             * @param {string} url
             * @return {true}
             */
            History.pushState = function (data, title, url, queue) {
                //History.debug('History.pushState: called', arguments);

                // Check the State
                if (History.getHashByUrl(url) && History.emulated.pushState) {
                    throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
                }

                // Handle Queueing
                if (queue !== false && History.busy()) {
                    // Wait + Push to Queue
                    //History.debug('History.pushState: we must wait', arguments);
                    History.pushQueue({
                        scope: History,
                        callback: History.pushState,
                        args: arguments,
                        queue: queue
                    });
                    return false;
                }

                // Make Busy + Continue
                History.busy(true);

                // Create the newState
                var newState = History.createStateObject(data, title, url);

                // Check it
                if (History.isLastSavedState(newState)) {
                    // Won't be a change
                    History.busy(false);
                }
                else {
                    // Store the newState
                    History.storeState(newState);
                    History.expectedStateId = newState.id;

                    // Push the newState
                    history.pushState(newState.id, newState.title, newState.url);

                    // Fire HTML5 Event
                    History.Adapter.trigger(window, 'popstate');
                }

                // End pushState closure
                return true;
            };

            /**
             * History.replaceState(data,title,url)
             * Replace the State and trigger onpopstate
             * We have to trigger for HTML4 compatibility
             * @param {object} data
             * @param {string} title
             * @param {string} url
             * @return {true}
             */
            History.replaceState = function (data, title, url, queue) {
                //History.debug('History.replaceState: called', arguments);

                // Check the State
                if (History.getHashByUrl(url) && History.emulated.pushState) {
                    throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
                }

                // Handle Queueing
                if (queue !== false && History.busy()) {
                    // Wait + Push to Queue
                    //History.debug('History.replaceState: we must wait', arguments);
                    History.pushQueue({
                        scope: History,
                        callback: History.replaceState,
                        args: arguments,
                        queue: queue
                    });
                    return false;
                }

                // Make Busy + Continue
                History.busy(true);

                // Create the newState
                var newState = History.createStateObject(data, title, url);

                // Check it
                if (History.isLastSavedState(newState)) {
                    // Won't be a change
                    History.busy(false);
                }
                else {
                    // Store the newState
                    History.storeState(newState);
                    History.expectedStateId = newState.id;

                    // Push the newState
                    history.replaceState(newState.id, newState.title, newState.url);

                    // Fire HTML5 Event
                    History.Adapter.trigger(window, 'popstate');
                }

                // End replaceState closure
                return true;
            };

        } // !History.emulated.pushState


        // ====================================================================
        // Initialise

        /**
         * Load the Store
         */
        if (sessionStorage) {
            // Fetch
            try {
                History.store = JSON.parse(sessionStorage.getItem('History.store')) || {};
            }
            catch (err) {
                History.store = {};
            }

            // Normalize
            History.normalizeStore();
        }
        else {
            // Default Load
            History.store = {};
            History.normalizeStore();
        }

        /**
         * Clear Intervals on exit to prevent memory leaks
         */
        History.Adapter.bind(window, "unload", History.clearAllIntervals);

        /**
         * Create the initial State
         */
        History.saveState(History.storeState(History.extractState(History.getLocationHref(), true)));

        /**
         * Bind for Saving Store
         */
        if (sessionStorage) {
            // When the page is closed
            History.onUnload = function () {
                // Prepare
                var currentStore, item, currentStoreString;

                // Fetch
                try {
                    currentStore = JSON.parse(sessionStorage.getItem('History.store')) || {};
                }
                catch (err) {
                    currentStore = {};
                }

                // Ensure
                currentStore.idToState = currentStore.idToState || {};
                currentStore.urlToId = currentStore.urlToId || {};
                currentStore.stateToId = currentStore.stateToId || {};

                // Sync
                for (item in History.idToState) {
                    if (!History.idToState.hasOwnProperty(item)) {
                        continue;
                    }
                    currentStore.idToState[item] = History.idToState[item];
                }
                for (item in History.urlToId) {
                    if (!History.urlToId.hasOwnProperty(item)) {
                        continue;
                    }
                    currentStore.urlToId[item] = History.urlToId[item];
                }
                for (item in History.stateToId) {
                    if (!History.stateToId.hasOwnProperty(item)) {
                        continue;
                    }
                    currentStore.stateToId[item] = History.stateToId[item];
                }

                // Update
                History.store = currentStore;
                History.normalizeStore();

                // In Safari, going into Private Browsing mode causes the
                // Session Storage object to still exist but if you try and use
                // or set any property/function of it it throws the exception
                // "QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to
                // add something to storage that exceeded the quota." infinitely
                // every second.
                currentStoreString = JSON.stringify(currentStore);
                try {
                    // Store
                    sessionStorage.setItem('History.store', currentStoreString);
                }
                catch (e) {
                    if (e.code === DOMException.QUOTA_EXCEEDED_ERR) {
                        if (sessionStorage.length) {
                            // Workaround for a bug seen on iPads. Sometimes the quota exceeded error comes up and simply
                            // removing/resetting the storage can work.
                            sessionStorage.removeItem('History.store');
                            sessionStorage.setItem('History.store', currentStoreString);
                        } else {
                            // Otherwise, we're probably private browsing in Safari, so we'll ignore the exception.
                        }
                    } else {
                        throw e;
                    }
                }
            };

            // For Internet Explorer
            History.isInternetExplorer() && History.intervalList.push(setInterval(History.onUnload, History.options.storeInterval));

            // For Other Browsers
            History.Adapter.bind(window, 'beforeunload', History.onUnload);
            History.Adapter.bind(window, 'unload', History.onUnload);

            // Both are enabled for consistency
        }

        // Non-Native pushState Implementation
        if (!History.emulated.pushState) {
            // Be aware, the following is only for native pushState implementations
            // If you are wanting to include something for all browsers
            // Then include it above this if block

            /**
             * Setup Safari Fix
             */
            if (History.bugs.safariPoll) {
                History.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));
            }

            /**
             * Ensure Cross Browser Compatibility
             */
            if (navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName || '') === 'Mozilla') {
                /**
                 * Fix Safari HashChange Issue
                 */

                    // Setup Alias
                History.Adapter.bind(window, 'hashchange', function () {
                    History.Adapter.trigger(window, 'popstate');
                });

                // Initialise Alias
                if (History.getHash()) {
                    History.Adapter.onDomLoad(function () {
                        History.Adapter.trigger(window, 'hashchange');
                    });
                }
            }

        } // !History.emulated.pushState


    }; // History.initCore

    // Try to Initialise History
    if (!History.options || !History.options.delayInit) {
        History.init();
    }
}

module.exports = History;
},{"./history-adapter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/history-adapter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/utils/save-state.js":[function(require,module,exports){
var prime      = require('prime'),
    deepClone  = require('mout/lang/deepClone'),
    objectDiff = require('objectdiff');

var SaveState = new prime({

    constructor: function(session) {
        session = deepClone(session);
        this.setSession(session);
    },

    setSession: function(session) {
        session = !session ? {}
            : {
            time: +(new Date()),
            data: deepClone(session)
        };

        this.session = session;
        return this.session;
    },

    getTime: function() {
        return this.session.time;
    },

    getData: function() {
        return this.session.data;
    },

    getSession: function() {
        return this.session;
    },

    getDiff: function(data) {
        var diff = objectDiff.diff(this.getData(), data);
        return {
            diff: diff,
            xml: objectDiff.convertToXMLString(diff)
        };
    }
});

module.exports = SaveState;

},{"mout/lang/deepClone":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepClone.js","objectdiff":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/objectdiff/objectDiff.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/index.js":[function(require,module,exports){
/*
Agent
- heavily inspired by superagent by visionmedia https://github.com/visionmedia/superagent, released under the MIT license
- code derived from MooTools 1.4 Request.js && superagent
- MIT-License
*/"use strict";
/* global ActiveXObject */

var prime   = require("prime"),
    Emitter = require("prime/emitter")

var isObject   = require("mout/lang/isObject"),
    isString   = require("mout/lang/isString"),
    isArray    = require("mout/lang/isArray"),
    isFunction = require("mout/lang/isFunction"),
    trim       = require("mout/string/trim"),
    upperCase  = require("mout/string/upperCase"),
    forIn      = require("mout/object/forIn"),
    mixIn      = require("mout/object/mixIn"),
    remove     = require("mout/array/remove"),
    forEach    = require("mout/array/forEach")

var capitalize = function(str){
    return str.replace(/\b[a-z]/g, upperCase)
}

// MooTools

var getRequest = (function(){

    var XMLHTTP = function(){
        return new XMLHttpRequest()
    }, MSXML2 = function(){
        return new ActiveXObject("MSXML2.XMLHTTP")
    }, MSXML = function(){
        return new ActiveXObject("Microsoft.XMLHTTP")
    }

    try {
      XMLHTTP()
      return XMLHTTP
    } catch(e){}
    try {
        MSXML2()
        return MSXML2
    } catch(e){}
    try {
        MSXML()
        return MSXML
    } catch(e){}

    return null

})()

var encodeJSON = function(object){
    if (object == null) return ""
    if (object.toJSON) return object.toJSON()
    return JSON.stringify(object)
}

// MooTools

var encodeQueryString = function(object, base){

    if (object == null) return ""
    if (object.toQueryString) return object.toQueryString()

    var queryString = []

    forIn(object, function(value, key){
        if (base) key = base + "[" + key + "]"
        var result

        if (value == null) return

        if (isArray(value)){
            var qs = {}
            for (var i = 0; i < value.length; i++) qs[i] = value[i]
            result = encodeQueryString(qs, key)
        } else if (isObject(value)){
            result = encodeQueryString(value, key)
        } else {
            result = key + "=" + encodeURIComponent(value)
        }

        queryString.push(result)
    })

    return queryString.join("&")

}

var decodeJSON = JSON.parse

// decodeQueryString by Brian Donovan
// http://stackoverflow.com/users/549363/brian-donovan

var decodeQueryString = function(params){

    var pairs  = params.split('&'),
        result = {}

    for (var i = 0; i < pairs.length; i++){

        var pair      = pairs[i].split('='),
            key       = decodeURIComponent(pair[0]),
            value     = decodeURIComponent(pair[1]),
            isArray   = /\[\]$/.test(key),
            dictMatch = key.match(/^(.+)\[([^\]]+)\]$/)

        if (dictMatch){
            key = dictMatch[1]
            var subkey = dictMatch[2]

            result[key] = result[key] || {}
            result[key][subkey] = value
        } else if (isArray){
            key = key.substring(0, key.length - 2)
            result[key] = result[key] || []
            result[key].push(value)
        } else {
            result[key] = value
        }

    }

    return result

}

var encoders = {
    "application/json" : encodeJSON,
    "application/x-www-form-urlencoded" : encodeQueryString
}

var decoders = {
    "application/json": decodeJSON,
    "application/x-www-form-urlencoded": decodeQueryString
}

// parseHeader from superagent
// https://github.com/visionmedia/superagent
// MIT

var parseHeader = function(str){
    var lines = str.split(/\r?\n/), fields = {}

    lines.pop() // trailing CRLF

    for (var i = 0, l = lines.length; i < l; ++i){
        var line  = lines[i],
            index = line.indexOf(':'),
            field = capitalize(line.slice(0, index)),
            value = trim(line.slice(index + 1))

        fields[field] = value
    }

    return fields
}

var REQUESTS = 0, Q = [] // Queue stuff

var Request = prime({

    constructor: function Request(){
        this._header = {
            "Content-Type": "application/x-www-form-urlencoded"
        }
    },

    header: function(name, value){
        if (isObject(name)) for (var key in name) this.header(key, name[key])
        else if (!arguments.length) return this._header
        else if (arguments.length === 1) return this._header[capitalize(name)]
        else if (arguments.length === 2){
            if (value == null) delete this._header[capitalize(name)]
            else this._header[capitalize(name)] = value
        }
        return this
    },

    running: function(){
        return !!this._running
    },

    abort: function(){

        if (this._queued){
            remove(Q, this._queued)
            delete this._queued
        }

        if (this._xhr){
            this._xhr.abort()
            this._end()
        }

        return this
    },

    method: function(m){
        if (!arguments.length) return this._method
        this._method = m.toUpperCase()
        return this
    },

    data: function(d){
        if (!arguments.length) return this._data
        this._data = d
        return this
    },

    url: function(u){
        if (!arguments.length) return this._url
        this._url = u
        return this
    },

    user: function(u){
        if (!arguments.length) return this._user
        this._user = u
        return this
    },

    password: function(p){
        if (!arguments.length) return this._password
        this._password = p
        return this
    },

    _send: function(method, url, data, header, user, password, callback){
        var self = this

        if (REQUESTS === agent.MAX_REQUESTS) return Q.unshift(this._queued = function(){
            delete self._queued
            self._send(method, url, data, header, user, password, callback)
        })

        REQUESTS++

        var xhr = this._xhr = agent.getRequest()

        if (xhr.addEventListener) forEach(['progress', 'load', 'error' , 'abort', 'loadend'], function(method){
            xhr.addEventListener(method, function(event){
                self.emit(method, event)
            }, false)
        })

        xhr.open(method, url, true, user, password)
        if (user != null && "withCredentials" in xhr) xhr.withCredentials = true

        xhr.onreadystatechange = function(){
            if (xhr.readyState === 4){
                var status = xhr.status
                var response = new Response(xhr.responseText, status, parseHeader(xhr.getAllResponseHeaders()))
                var error = response.error ? new Error(method + " " + url + " " + status) : null
                self._end()
                callback(error, response)
            }
        }

        for (var field in header) xhr.setRequestHeader(field, header[field])
        xhr.send(data || null)
    },

    _end: function(){
        this._xhr.onreadystatechange = function(){}

        delete this._xhr
        delete this._running

        REQUESTS--

        var queued = Q.pop()
        if (queued) queued()
    },

    send: function(callback){
        if (this._running) this.abort()
        this._running = true

        if (!callback) callback = function(){}

        var method   = this._method || "POST",
            data     = this._data || null,
            url      = this._url,
            user     = this._user || null,
            password = this._password || null

        if (data && !isString(data)){
            var contentType = this._header['Content-Type'].split(/ *; */).shift(),
                encode      = encoders[contentType]
            if (encode) data = encode(data)
        }

        if (/GET|HEAD/.test(method) && data) url += (url.indexOf("?") > -1 ? "&" : "?") + data

        var header = mixIn({}, this._header);

        this._send(method, url, data, header, user, password, callback)

        return this

    }

})

Request.implement(new Emitter)

var Response = prime({

    constructor: function Response(text, status, header){

        this.text   = text
        this.status = status

        this.header = header

        // statuses from superagent
        // https://github.com/visionmedia/superagent
        // MIT

        var t = status / 100 | 0

        this.info        = t === 1
        this.ok          = t === 2
        this.clientError = t === 4
        this.serverError = t === 5
        this.error       = t === 4 || t === 5
        var length = '' + header['Content-Length']

        // sugar
        this.accepted      = status === 202
        this.noContent     = length === '0' || status === 204 || status === 1223
        this.badRequest    = status === 400
        this.unauthorized  = status === 401
        this.notAcceptable = status === 406
        this.notFound      = status === 404

        var contentType = header['Content-Type'] ? header['Content-Type'].split(/ *; */).shift() : '',
            decode

        if (!this.noContent) decode = decoders[contentType]

        this.body = decode ? decode(this.text) : this.text

    }

})

var methods  = "get|post|put|delete|head|patch|options",
    rMethods = new RegExp("^" + methods + "$", "i")

var agent = function(method, url, data, callback){
    var request = new Request()

    if (!arguments.length) return request

    if (!rMethods.test(method)){ // shift
        callback = data
        data     = url
        url      = method
        method   = "post"
    }

    if (isFunction(data)){
        callback = data
        data = null
    }

    request.method(method)

    if (url) request.url(url)
    if (data) request.data(data)
    if (callback) request.send(callback)

    return request
}

agent.encoder = function(ct, encode){
    if (arguments.length === 1) return encoders[ct]
    encoders[ct] = encode
    return agent
}

agent.decoder = function(ct, decode){
    if (arguments.length === 1) return decoders[ct]
    decoders[ct] = decode
    return agent
}

forEach(methods.split("|"), function(method){
    agent[method] = function(url, data, callback){
        return agent(method, url, data, callback)
    }
})

agent.MAX_REQUESTS = Infinity
agent.getRequest = getRequest
agent.Request  = Request
agent.Response = Response

module.exports = agent

},{"mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/forEach.js","mout/array/remove":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/remove.js","mout/lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isArray.js","mout/lang/isFunction":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isFunction.js","mout/lang/isObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isObject.js","mout/lang/isString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isString.js","mout/object/forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forIn.js","mout/object/mixIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/mixIn.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/trim.js","mout/string/upperCase":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/upperCase.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/forEach.js":[function(require,module,exports){


    /**
     * Array forEach
     */
    function forEach(arr, callback, thisObj) {
        if (arr == null) {
            return;
        }
        var i = -1,
            len = arr.length;
        while (++i < len) {
            // we iterate over sparse items since there is no way to make it
            // work properly on IE 7-8. see #64
            if ( callback.call(thisObj, arr[i], i, arr) === false ) {
                break;
            }
        }
    }

    module.exports = forEach;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/indexOf.js":[function(require,module,exports){


    /**
     * Array.indexOf
     */
    function indexOf(arr, item, fromIndex) {
        fromIndex = fromIndex || 0;
        if (arr == null) {
            return -1;
        }

        var len = arr.length,
            i = fromIndex < 0 ? len + fromIndex : fromIndex;
        while (i < len) {
            // we iterate over sparse items since there is no way to make it
            // work properly on IE 7-8. see #64
            if (arr[i] === item) {
                return i;
            }

            i++;
        }

        return -1;
    }

    module.exports = indexOf;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/remove.js":[function(require,module,exports){
var indexOf = require('./indexOf');

    /**
     * Remove a single item from the array.
     * (it won't remove duplicates, just a single item)
     */
    function remove(arr, item){
        var idx = indexOf(arr, item);
        if (idx !== -1) arr.splice(idx, 1);
    }

    module.exports = remove;


},{"./indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/indexOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isArray.js":[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    var isArray = Array.isArray || function (val) {
        return isKind(val, 'Array');
    };
    module.exports = isArray;


},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isFunction.js":[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isFunction(val) {
        return isKind(val, 'Function');
    }
    module.exports = isFunction;


},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isKind.js":[function(require,module,exports){
var kindOf = require('./kindOf');
    /**
     * Check if value is from a specific "kind".
     */
    function isKind(val, kind){
        return kindOf(val) === kind;
    }
    module.exports = isKind;


},{"./kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/kindOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isObject.js":[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isObject(val) {
        return isKind(val, 'Object');
    }
    module.exports = isObject;


},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isString.js":[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isString(val) {
        return isKind(val, 'String');
    }
    module.exports = isString;


},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/kindOf.js":[function(require,module,exports){


    var _rKind = /^\[object (.*)\]$/,
        _toString = Object.prototype.toString,
        UNDEF;

    /**
     * Gets the "kind" of value. (e.g. "String", "Number", etc)
     */
    function kindOf(val) {
        if (val === null) {
            return 'Null';
        } else if (val === UNDEF) {
            return 'Undefined';
        } else {
            return _rKind.exec( _toString.call(val) )[1];
        }
    }
    module.exports = kindOf;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/toString.js":[function(require,module,exports){


    /**
     * Typecast a value to a String, using an empty string value for null or
     * undefined.
     */
    function toString(val){
        return val == null ? '' : val.toString();
    }

    module.exports = toString;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forIn.js":[function(require,module,exports){
var hasOwn = require('./hasOwn');

    var _hasDontEnumBug,
        _dontEnums;

    function checkDontEnum(){
        _dontEnums = [
                'toString',
                'toLocaleString',
                'valueOf',
                'hasOwnProperty',
                'isPrototypeOf',
                'propertyIsEnumerable',
                'constructor'
            ];

        _hasDontEnumBug = true;

        for (var key in {'toString': null}) {
            _hasDontEnumBug = false;
        }
    }

    /**
     * Similar to Array/forEach but works over object properties and fixes Don't
     * Enum bug on IE.
     * based on: http://whattheheadsaid.com/2010/10/a-safer-object-keys-compatibility-implementation
     */
    function forIn(obj, fn, thisObj){
        var key, i = 0;
        // no need to check if argument is a real object that way we can use
        // it for arrays, functions, date, etc.

        //post-pone check till needed
        if (_hasDontEnumBug == null) checkDontEnum();

        for (key in obj) {
            if (exec(fn, obj, key, thisObj) === false) {
                break;
            }
        }


        if (_hasDontEnumBug) {
            var ctor = obj.constructor,
                isProto = !!ctor && obj === ctor.prototype;

            while (key = _dontEnums[i++]) {
                // For constructor, if it is a prototype object the constructor
                // is always non-enumerable unless defined otherwise (and
                // enumerated above).  For non-prototype objects, it will have
                // to be defined on this object, since it cannot be defined on
                // any prototype objects.
                //
                // For other [[DontEnum]] properties, check if the value is
                // different than Object prototype value.
                if (
                    (key !== 'constructor' ||
                        (!isProto && hasOwn(obj, key))) &&
                    obj[key] !== Object.prototype[key]
                ) {
                    if (exec(fn, obj, key, thisObj) === false) {
                        break;
                    }
                }
            }
        }
    }

    function exec(fn, obj, key, thisObj){
        return fn.call(thisObj, obj[key], key, obj);
    }

    module.exports = forIn;



},{"./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forOwn.js":[function(require,module,exports){
var hasOwn = require('./hasOwn');
var forIn = require('./forIn');

    /**
     * Similar to Array/forEach but works over object properties and fixes Don't
     * Enum bug on IE.
     * based on: http://whattheheadsaid.com/2010/10/a-safer-object-keys-compatibility-implementation
     */
    function forOwn(obj, fn, thisObj){
        forIn(obj, function(val, key){
            if (hasOwn(obj, key)) {
                return fn.call(thisObj, obj[key], key, obj);
            }
        });
    }

    module.exports = forOwn;



},{"./forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forIn.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/hasOwn.js":[function(require,module,exports){


    /**
     * Safer Object.hasOwnProperty
     */
     function hasOwn(obj, prop){
         return Object.prototype.hasOwnProperty.call(obj, prop);
     }

     module.exports = hasOwn;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/mixIn.js":[function(require,module,exports){
var forOwn = require('./forOwn');

    /**
    * Combine properties from all the objects into first one.
    * - This method affects target object in place, if you want to create a new Object pass an empty object as first param.
    * @param {object} target    Target Object
    * @param {...object} objects    Objects to be combined (0...n objects).
    * @return {object} Target Object.
    */
    function mixIn(target, objects){
        var i = 0,
            n = arguments.length,
            obj;
        while(++i < n){
            obj = arguments[i];
            if (obj != null) {
                forOwn(obj, copyProp, target);
            }
        }
        return target;
    }

    function copyProp(val, key){
        this[key] = val;
    }

    module.exports = mixIn;


},{"./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/WHITE_SPACES.js":[function(require,module,exports){

    /**
     * Contains all Unicode white-spaces. Taken from
     * http://en.wikipedia.org/wiki/Whitespace_character.
     */
    module.exports = [
        ' ', '\n', '\r', '\t', '\f', '\v', '\u00A0', '\u1680', '\u180E',
        '\u2000', '\u2001', '\u2002', '\u2003', '\u2004', '\u2005', '\u2006',
        '\u2007', '\u2008', '\u2009', '\u200A', '\u2028', '\u2029', '\u202F',
        '\u205F', '\u3000'
    ];


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/ltrim.js":[function(require,module,exports){
var toString = require('../lang/toString');
var WHITE_SPACES = require('./WHITE_SPACES');
    /**
     * Remove chars from beginning of string.
     */
    function ltrim(str, chars) {
        str = toString(str);
        chars = chars || WHITE_SPACES;

        var start = 0,
            len = str.length,
            charLen = chars.length,
            found = true,
            i, c;

        while (found && start < len) {
            found = false;
            i = -1;
            c = str.charAt(start);

            while (++i < charLen) {
                if (c === chars[i]) {
                    found = true;
                    start++;
                    break;
                }
            }
        }

        return (start >= len) ? '' : str.substr(start, len);
    }

    module.exports = ltrim;


},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/WHITE_SPACES.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/rtrim.js":[function(require,module,exports){
var toString = require('../lang/toString');
var WHITE_SPACES = require('./WHITE_SPACES');
    /**
     * Remove chars from end of string.
     */
    function rtrim(str, chars) {
        str = toString(str);
        chars = chars || WHITE_SPACES;

        var end = str.length - 1,
            charLen = chars.length,
            found = true,
            i, c;

        while (found && end >= 0) {
            found = false;
            i = -1;
            c = str.charAt(end);

            while (++i < charLen) {
                if (c === chars[i]) {
                    found = true;
                    end--;
                    break;
                }
            }
        }

        return (end >= 0) ? str.substring(0, end + 1) : '';
    }

    module.exports = rtrim;


},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/WHITE_SPACES.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/trim.js":[function(require,module,exports){
var toString = require('../lang/toString');
var WHITE_SPACES = require('./WHITE_SPACES');
var ltrim = require('./ltrim');
var rtrim = require('./rtrim');
    /**
     * Remove white-spaces from beginning and end of string.
     */
    function trim(str, chars) {
        str = toString(str);
        chars = chars || WHITE_SPACES;
        return ltrim(rtrim(str, chars), chars);
    }

    module.exports = trim;


},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/WHITE_SPACES.js","./ltrim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/ltrim.js","./rtrim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/rtrim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/upperCase.js":[function(require,module,exports){
var toString = require('../lang/toString');
    /**
     * "Safer" String.toUpperCase()
     */
    function upperCase(str){
        str = toString(str);
        return str.toUpperCase();
    }
    module.exports = upperCase;


},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/toString.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/async/lib/async.js":[function(require,module,exports){
(function (process){
/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */
/*jshint onevar: false, indent:4 */
/*global setImmediate: false, setTimeout: false, console: false */
(function () {

    var async = {};

    // global on the server, window in the browser
    var root, previous_async;

    root = this;
    if (root != null) {
      previous_async = root.async;
    }

    async.noConflict = function () {
        root.async = previous_async;
        return async;
    };

    function only_once(fn) {
        var called = false;
        return function() {
            if (called) throw new Error("Callback was already called.");
            called = true;
            fn.apply(root, arguments);
        }
    }

    //// cross-browser compatiblity functions ////

    var _toString = Object.prototype.toString;

    var _isArray = Array.isArray || function (obj) {
        return _toString.call(obj) === '[object Array]';
    };

    var _each = function (arr, iterator) {
        if (arr.forEach) {
            return arr.forEach(iterator);
        }
        for (var i = 0; i < arr.length; i += 1) {
            iterator(arr[i], i, arr);
        }
    };

    var _map = function (arr, iterator) {
        if (arr.map) {
            return arr.map(iterator);
        }
        var results = [];
        _each(arr, function (x, i, a) {
            results.push(iterator(x, i, a));
        });
        return results;
    };

    var _reduce = function (arr, iterator, memo) {
        if (arr.reduce) {
            return arr.reduce(iterator, memo);
        }
        _each(arr, function (x, i, a) {
            memo = iterator(memo, x, i, a);
        });
        return memo;
    };

    var _keys = function (obj) {
        if (Object.keys) {
            return Object.keys(obj);
        }
        var keys = [];
        for (var k in obj) {
            if (obj.hasOwnProperty(k)) {
                keys.push(k);
            }
        }
        return keys;
    };

    //// exported async module functions ////

    //// nextTick implementation with browser-compatible fallback ////
    if (typeof process === 'undefined' || !(process.nextTick)) {
        if (typeof setImmediate === 'function') {
            async.nextTick = function (fn) {
                // not a direct alias for IE10 compatibility
                setImmediate(fn);
            };
            async.setImmediate = async.nextTick;
        }
        else {
            async.nextTick = function (fn) {
                setTimeout(fn, 0);
            };
            async.setImmediate = async.nextTick;
        }
    }
    else {
        async.nextTick = process.nextTick;
        if (typeof setImmediate !== 'undefined') {
            async.setImmediate = function (fn) {
              // not a direct alias for IE10 compatibility
              setImmediate(fn);
            };
        }
        else {
            async.setImmediate = async.nextTick;
        }
    }

    async.each = function (arr, iterator, callback) {
        callback = callback || function () {};
        if (!arr.length) {
            return callback();
        }
        var completed = 0;
        _each(arr, function (x) {
            iterator(x, only_once(done) );
        });
        function done(err) {
          if (err) {
              callback(err);
              callback = function () {};
          }
          else {
              completed += 1;
              if (completed >= arr.length) {
                  callback();
              }
          }
        }
    };
    async.forEach = async.each;

    async.eachSeries = function (arr, iterator, callback) {
        callback = callback || function () {};
        if (!arr.length) {
            return callback();
        }
        var completed = 0;
        var iterate = function () {
            iterator(arr[completed], function (err) {
                if (err) {
                    callback(err);
                    callback = function () {};
                }
                else {
                    completed += 1;
                    if (completed >= arr.length) {
                        callback();
                    }
                    else {
                        iterate();
                    }
                }
            });
        };
        iterate();
    };
    async.forEachSeries = async.eachSeries;

    async.eachLimit = function (arr, limit, iterator, callback) {
        var fn = _eachLimit(limit);
        fn.apply(null, [arr, iterator, callback]);
    };
    async.forEachLimit = async.eachLimit;

    var _eachLimit = function (limit) {

        return function (arr, iterator, callback) {
            callback = callback || function () {};
            if (!arr.length || limit <= 0) {
                return callback();
            }
            var completed = 0;
            var started = 0;
            var running = 0;

            (function replenish () {
                if (completed >= arr.length) {
                    return callback();
                }

                while (running < limit && started < arr.length) {
                    started += 1;
                    running += 1;
                    iterator(arr[started - 1], function (err) {
                        if (err) {
                            callback(err);
                            callback = function () {};
                        }
                        else {
                            completed += 1;
                            running -= 1;
                            if (completed >= arr.length) {
                                callback();
                            }
                            else {
                                replenish();
                            }
                        }
                    });
                }
            })();
        };
    };


    var doParallel = function (fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [async.each].concat(args));
        };
    };
    var doParallelLimit = function(limit, fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [_eachLimit(limit)].concat(args));
        };
    };
    var doSeries = function (fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [async.eachSeries].concat(args));
        };
    };


    var _asyncMap = function (eachfn, arr, iterator, callback) {
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        if (!callback) {
            eachfn(arr, function (x, callback) {
                iterator(x.value, function (err) {
                    callback(err);
                });
            });
        } else {
            var results = [];
            eachfn(arr, function (x, callback) {
                iterator(x.value, function (err, v) {
                    results[x.index] = v;
                    callback(err);
                });
            }, function (err) {
                callback(err, results);
            });
        }
    };
    async.map = doParallel(_asyncMap);
    async.mapSeries = doSeries(_asyncMap);
    async.mapLimit = function (arr, limit, iterator, callback) {
        return _mapLimit(limit)(arr, iterator, callback);
    };

    var _mapLimit = function(limit) {
        return doParallelLimit(limit, _asyncMap);
    };

    // reduce only has a series version, as doing reduce in parallel won't
    // work in many situations.
    async.reduce = function (arr, memo, iterator, callback) {
        async.eachSeries(arr, function (x, callback) {
            iterator(memo, x, function (err, v) {
                memo = v;
                callback(err);
            });
        }, function (err) {
            callback(err, memo);
        });
    };
    // inject alias
    async.inject = async.reduce;
    // foldl alias
    async.foldl = async.reduce;

    async.reduceRight = function (arr, memo, iterator, callback) {
        var reversed = _map(arr, function (x) {
            return x;
        }).reverse();
        async.reduce(reversed, memo, iterator, callback);
    };
    // foldr alias
    async.foldr = async.reduceRight;

    var _filter = function (eachfn, arr, iterator, callback) {
        var results = [];
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        eachfn(arr, function (x, callback) {
            iterator(x.value, function (v) {
                if (v) {
                    results.push(x);
                }
                callback();
            });
        }, function (err) {
            callback(_map(results.sort(function (a, b) {
                return a.index - b.index;
            }), function (x) {
                return x.value;
            }));
        });
    };
    async.filter = doParallel(_filter);
    async.filterSeries = doSeries(_filter);
    // select alias
    async.select = async.filter;
    async.selectSeries = async.filterSeries;

    var _reject = function (eachfn, arr, iterator, callback) {
        var results = [];
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        eachfn(arr, function (x, callback) {
            iterator(x.value, function (v) {
                if (!v) {
                    results.push(x);
                }
                callback();
            });
        }, function (err) {
            callback(_map(results.sort(function (a, b) {
                return a.index - b.index;
            }), function (x) {
                return x.value;
            }));
        });
    };
    async.reject = doParallel(_reject);
    async.rejectSeries = doSeries(_reject);

    var _detect = function (eachfn, arr, iterator, main_callback) {
        eachfn(arr, function (x, callback) {
            iterator(x, function (result) {
                if (result) {
                    main_callback(x);
                    main_callback = function () {};
                }
                else {
                    callback();
                }
            });
        }, function (err) {
            main_callback();
        });
    };
    async.detect = doParallel(_detect);
    async.detectSeries = doSeries(_detect);

    async.some = function (arr, iterator, main_callback) {
        async.each(arr, function (x, callback) {
            iterator(x, function (v) {
                if (v) {
                    main_callback(true);
                    main_callback = function () {};
                }
                callback();
            });
        }, function (err) {
            main_callback(false);
        });
    };
    // any alias
    async.any = async.some;

    async.every = function (arr, iterator, main_callback) {
        async.each(arr, function (x, callback) {
            iterator(x, function (v) {
                if (!v) {
                    main_callback(false);
                    main_callback = function () {};
                }
                callback();
            });
        }, function (err) {
            main_callback(true);
        });
    };
    // all alias
    async.all = async.every;

    async.sortBy = function (arr, iterator, callback) {
        async.map(arr, function (x, callback) {
            iterator(x, function (err, criteria) {
                if (err) {
                    callback(err);
                }
                else {
                    callback(null, {value: x, criteria: criteria});
                }
            });
        }, function (err, results) {
            if (err) {
                return callback(err);
            }
            else {
                var fn = function (left, right) {
                    var a = left.criteria, b = right.criteria;
                    return a < b ? -1 : a > b ? 1 : 0;
                };
                callback(null, _map(results.sort(fn), function (x) {
                    return x.value;
                }));
            }
        });
    };

    async.auto = function (tasks, callback) {
        callback = callback || function () {};
        var keys = _keys(tasks);
        var remainingTasks = keys.length
        if (!remainingTasks) {
            return callback();
        }

        var results = {};

        var listeners = [];
        var addListener = function (fn) {
            listeners.unshift(fn);
        };
        var removeListener = function (fn) {
            for (var i = 0; i < listeners.length; i += 1) {
                if (listeners[i] === fn) {
                    listeners.splice(i, 1);
                    return;
                }
            }
        };
        var taskComplete = function () {
            remainingTasks--
            _each(listeners.slice(0), function (fn) {
                fn();
            });
        };

        addListener(function () {
            if (!remainingTasks) {
                var theCallback = callback;
                // prevent final callback from calling itself if it errors
                callback = function () {};

                theCallback(null, results);
            }
        });

        _each(keys, function (k) {
            var task = _isArray(tasks[k]) ? tasks[k]: [tasks[k]];
            var taskCallback = function (err) {
                var args = Array.prototype.slice.call(arguments, 1);
                if (args.length <= 1) {
                    args = args[0];
                }
                if (err) {
                    var safeResults = {};
                    _each(_keys(results), function(rkey) {
                        safeResults[rkey] = results[rkey];
                    });
                    safeResults[k] = args;
                    callback(err, safeResults);
                    // stop subsequent errors hitting callback multiple times
                    callback = function () {};
                }
                else {
                    results[k] = args;
                    async.setImmediate(taskComplete);
                }
            };
            var requires = task.slice(0, Math.abs(task.length - 1)) || [];
            var ready = function () {
                return _reduce(requires, function (a, x) {
                    return (a && results.hasOwnProperty(x));
                }, true) && !results.hasOwnProperty(k);
            };
            if (ready()) {
                task[task.length - 1](taskCallback, results);
            }
            else {
                var listener = function () {
                    if (ready()) {
                        removeListener(listener);
                        task[task.length - 1](taskCallback, results);
                    }
                };
                addListener(listener);
            }
        });
    };

    async.retry = function(times, task, callback) {
        var DEFAULT_TIMES = 5;
        var attempts = [];
        // Use defaults if times not passed
        if (typeof times === 'function') {
            callback = task;
            task = times;
            times = DEFAULT_TIMES;
        }
        // Make sure times is a number
        times = parseInt(times, 10) || DEFAULT_TIMES;
        var wrappedTask = function(wrappedCallback, wrappedResults) {
            var retryAttempt = function(task, finalAttempt) {
                return function(seriesCallback) {
                    task(function(err, result){
                        seriesCallback(!err || finalAttempt, {err: err, result: result});
                    }, wrappedResults);
                };
            };
            while (times) {
                attempts.push(retryAttempt(task, !(times-=1)));
            }
            async.series(attempts, function(done, data){
                data = data[data.length - 1];
                (wrappedCallback || callback)(data.err, data.result);
            });
        }
        // If a callback is passed, run this as a controll flow
        return callback ? wrappedTask() : wrappedTask
    };

    async.waterfall = function (tasks, callback) {
        callback = callback || function () {};
        if (!_isArray(tasks)) {
          var err = new Error('First argument to waterfall must be an array of functions');
          return callback(err);
        }
        if (!tasks.length) {
            return callback();
        }
        var wrapIterator = function (iterator) {
            return function (err) {
                if (err) {
                    callback.apply(null, arguments);
                    callback = function () {};
                }
                else {
                    var args = Array.prototype.slice.call(arguments, 1);
                    var next = iterator.next();
                    if (next) {
                        args.push(wrapIterator(next));
                    }
                    else {
                        args.push(callback);
                    }
                    async.setImmediate(function () {
                        iterator.apply(null, args);
                    });
                }
            };
        };
        wrapIterator(async.iterator(tasks))();
    };

    var _parallel = function(eachfn, tasks, callback) {
        callback = callback || function () {};
        if (_isArray(tasks)) {
            eachfn.map(tasks, function (fn, callback) {
                if (fn) {
                    fn(function (err) {
                        var args = Array.prototype.slice.call(arguments, 1);
                        if (args.length <= 1) {
                            args = args[0];
                        }
                        callback.call(null, err, args);
                    });
                }
            }, callback);
        }
        else {
            var results = {};
            eachfn.each(_keys(tasks), function (k, callback) {
                tasks[k](function (err) {
                    var args = Array.prototype.slice.call(arguments, 1);
                    if (args.length <= 1) {
                        args = args[0];
                    }
                    results[k] = args;
                    callback(err);
                });
            }, function (err) {
                callback(err, results);
            });
        }
    };

    async.parallel = function (tasks, callback) {
        _parallel({ map: async.map, each: async.each }, tasks, callback);
    };

    async.parallelLimit = function(tasks, limit, callback) {
        _parallel({ map: _mapLimit(limit), each: _eachLimit(limit) }, tasks, callback);
    };

    async.series = function (tasks, callback) {
        callback = callback || function () {};
        if (_isArray(tasks)) {
            async.mapSeries(tasks, function (fn, callback) {
                if (fn) {
                    fn(function (err) {
                        var args = Array.prototype.slice.call(arguments, 1);
                        if (args.length <= 1) {
                            args = args[0];
                        }
                        callback.call(null, err, args);
                    });
                }
            }, callback);
        }
        else {
            var results = {};
            async.eachSeries(_keys(tasks), function (k, callback) {
                tasks[k](function (err) {
                    var args = Array.prototype.slice.call(arguments, 1);
                    if (args.length <= 1) {
                        args = args[0];
                    }
                    results[k] = args;
                    callback(err);
                });
            }, function (err) {
                callback(err, results);
            });
        }
    };

    async.iterator = function (tasks) {
        var makeCallback = function (index) {
            var fn = function () {
                if (tasks.length) {
                    tasks[index].apply(null, arguments);
                }
                return fn.next();
            };
            fn.next = function () {
                return (index < tasks.length - 1) ? makeCallback(index + 1): null;
            };
            return fn;
        };
        return makeCallback(0);
    };

    async.apply = function (fn) {
        var args = Array.prototype.slice.call(arguments, 1);
        return function () {
            return fn.apply(
                null, args.concat(Array.prototype.slice.call(arguments))
            );
        };
    };

    var _concat = function (eachfn, arr, fn, callback) {
        var r = [];
        eachfn(arr, function (x, cb) {
            fn(x, function (err, y) {
                r = r.concat(y || []);
                cb(err);
            });
        }, function (err) {
            callback(err, r);
        });
    };
    async.concat = doParallel(_concat);
    async.concatSeries = doSeries(_concat);

    async.whilst = function (test, iterator, callback) {
        if (test()) {
            iterator(function (err) {
                if (err) {
                    return callback(err);
                }
                async.whilst(test, iterator, callback);
            });
        }
        else {
            callback();
        }
    };

    async.doWhilst = function (iterator, test, callback) {
        iterator(function (err) {
            if (err) {
                return callback(err);
            }
            var args = Array.prototype.slice.call(arguments, 1);
            if (test.apply(null, args)) {
                async.doWhilst(iterator, test, callback);
            }
            else {
                callback();
            }
        });
    };

    async.until = function (test, iterator, callback) {
        if (!test()) {
            iterator(function (err) {
                if (err) {
                    return callback(err);
                }
                async.until(test, iterator, callback);
            });
        }
        else {
            callback();
        }
    };

    async.doUntil = function (iterator, test, callback) {
        iterator(function (err) {
            if (err) {
                return callback(err);
            }
            var args = Array.prototype.slice.call(arguments, 1);
            if (!test.apply(null, args)) {
                async.doUntil(iterator, test, callback);
            }
            else {
                callback();
            }
        });
    };

    async.queue = function (worker, concurrency) {
        if (concurrency === undefined) {
            concurrency = 1;
        }
        function _insert(q, data, pos, callback) {
          if (!q.started){
            q.started = true;
          }
          if (!_isArray(data)) {
              data = [data];
          }
          if(data.length == 0) {
             // call drain immediately if there are no tasks
             return async.setImmediate(function() {
                 if (q.drain) {
                     q.drain();
                 }
             });
          }
          _each(data, function(task) {
              var item = {
                  data: task,
                  callback: typeof callback === 'function' ? callback : null
              };

              if (pos) {
                q.tasks.unshift(item);
              } else {
                q.tasks.push(item);
              }

              if (q.saturated && q.tasks.length === q.concurrency) {
                  q.saturated();
              }
              async.setImmediate(q.process);
          });
        }

        var workers = 0;
        var q = {
            tasks: [],
            concurrency: concurrency,
            saturated: null,
            empty: null,
            drain: null,
            started: false,
            paused: false,
            push: function (data, callback) {
              _insert(q, data, false, callback);
            },
            kill: function () {
              q.drain = null;
              q.tasks = [];
            },
            unshift: function (data, callback) {
              _insert(q, data, true, callback);
            },
            process: function () {
                if (!q.paused && workers < q.concurrency && q.tasks.length) {
                    var task = q.tasks.shift();
                    if (q.empty && q.tasks.length === 0) {
                        q.empty();
                    }
                    workers += 1;
                    var next = function () {
                        workers -= 1;
                        if (task.callback) {
                            task.callback.apply(task, arguments);
                        }
                        if (q.drain && q.tasks.length + workers === 0) {
                            q.drain();
                        }
                        q.process();
                    };
                    var cb = only_once(next);
                    worker(task.data, cb);
                }
            },
            length: function () {
                return q.tasks.length;
            },
            running: function () {
                return workers;
            },
            idle: function() {
                return q.tasks.length + workers === 0;
            },
            pause: function () {
                if (q.paused === true) { return; }
                q.paused = true;
                q.process();
            },
            resume: function () {
                if (q.paused === false) { return; }
                q.paused = false;
                q.process();
            }
        };
        return q;
    };
    
    async.priorityQueue = function (worker, concurrency) {
        
        function _compareTasks(a, b){
          return a.priority - b.priority;
        };
        
        function _binarySearch(sequence, item, compare) {
          var beg = -1,
              end = sequence.length - 1;
          while (beg < end) {
            var mid = beg + ((end - beg + 1) >>> 1);
            if (compare(item, sequence[mid]) >= 0) {
              beg = mid;
            } else {
              end = mid - 1;
            }
          }
          return beg;
        }
        
        function _insert(q, data, priority, callback) {
          if (!q.started){
            q.started = true;
          }
          if (!_isArray(data)) {
              data = [data];
          }
          if(data.length == 0) {
             // call drain immediately if there are no tasks
             return async.setImmediate(function() {
                 if (q.drain) {
                     q.drain();
                 }
             });
          }
          _each(data, function(task) {
              var item = {
                  data: task,
                  priority: priority,
                  callback: typeof callback === 'function' ? callback : null
              };
              
              q.tasks.splice(_binarySearch(q.tasks, item, _compareTasks) + 1, 0, item);

              if (q.saturated && q.tasks.length === q.concurrency) {
                  q.saturated();
              }
              async.setImmediate(q.process);
          });
        }
        
        // Start with a normal queue
        var q = async.queue(worker, concurrency);
        
        // Override push to accept second parameter representing priority
        q.push = function (data, priority, callback) {
          _insert(q, data, priority, callback);
        };
        
        // Remove unshift function
        delete q.unshift;

        return q;
    };

    async.cargo = function (worker, payload) {
        var working     = false,
            tasks       = [];

        var cargo = {
            tasks: tasks,
            payload: payload,
            saturated: null,
            empty: null,
            drain: null,
            drained: true,
            push: function (data, callback) {
                if (!_isArray(data)) {
                    data = [data];
                }
                _each(data, function(task) {
                    tasks.push({
                        data: task,
                        callback: typeof callback === 'function' ? callback : null
                    });
                    cargo.drained = false;
                    if (cargo.saturated && tasks.length === payload) {
                        cargo.saturated();
                    }
                });
                async.setImmediate(cargo.process);
            },
            process: function process() {
                if (working) return;
                if (tasks.length === 0) {
                    if(cargo.drain && !cargo.drained) cargo.drain();
                    cargo.drained = true;
                    return;
                }

                var ts = typeof payload === 'number'
                            ? tasks.splice(0, payload)
                            : tasks.splice(0, tasks.length);

                var ds = _map(ts, function (task) {
                    return task.data;
                });

                if(cargo.empty) cargo.empty();
                working = true;
                worker(ds, function () {
                    working = false;

                    var args = arguments;
                    _each(ts, function (data) {
                        if (data.callback) {
                            data.callback.apply(null, args);
                        }
                    });

                    process();
                });
            },
            length: function () {
                return tasks.length;
            },
            running: function () {
                return working;
            }
        };
        return cargo;
    };

    var _console_fn = function (name) {
        return function (fn) {
            var args = Array.prototype.slice.call(arguments, 1);
            fn.apply(null, args.concat([function (err) {
                var args = Array.prototype.slice.call(arguments, 1);
                if (typeof console !== 'undefined') {
                    if (err) {
                        if (console.error) {
                            console.error(err);
                        }
                    }
                    else if (console[name]) {
                        _each(args, function (x) {
                            console[name](x);
                        });
                    }
                }
            }]));
        };
    };
    async.log = _console_fn('log');
    async.dir = _console_fn('dir');
    /*async.info = _console_fn('info');
    async.warn = _console_fn('warn');
    async.error = _console_fn('error');*/

    async.memoize = function (fn, hasher) {
        var memo = {};
        var queues = {};
        hasher = hasher || function (x) {
            return x;
        };
        var memoized = function () {
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            var key = hasher.apply(null, args);
            if (key in memo) {
                async.nextTick(function () {
                    callback.apply(null, memo[key]);
                });
            }
            else if (key in queues) {
                queues[key].push(callback);
            }
            else {
                queues[key] = [callback];
                fn.apply(null, args.concat([function () {
                    memo[key] = arguments;
                    var q = queues[key];
                    delete queues[key];
                    for (var i = 0, l = q.length; i < l; i++) {
                      q[i].apply(null, arguments);
                    }
                }]));
            }
        };
        memoized.memo = memo;
        memoized.unmemoized = fn;
        return memoized;
    };

    async.unmemoize = function (fn) {
      return function () {
        return (fn.unmemoized || fn).apply(null, arguments);
      };
    };

    async.times = function (count, iterator, callback) {
        var counter = [];
        for (var i = 0; i < count; i++) {
            counter.push(i);
        }
        return async.map(counter, iterator, callback);
    };

    async.timesSeries = function (count, iterator, callback) {
        var counter = [];
        for (var i = 0; i < count; i++) {
            counter.push(i);
        }
        return async.mapSeries(counter, iterator, callback);
    };

    async.seq = function (/* functions... */) {
        var fns = arguments;
        return function () {
            var that = this;
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            async.reduce(fns, args, function (newargs, fn, cb) {
                fn.apply(that, newargs.concat([function () {
                    var err = arguments[0];
                    var nextargs = Array.prototype.slice.call(arguments, 1);
                    cb(err, nextargs);
                }]))
            },
            function (err, results) {
                callback.apply(that, [err].concat(results));
            });
        };
    };

    async.compose = function (/* functions... */) {
      return async.seq.apply(null, Array.prototype.reverse.call(arguments));
    };

    var _applyEach = function (eachfn, fns /*args...*/) {
        var go = function () {
            var that = this;
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            return eachfn(fns, function (fn, cb) {
                fn.apply(that, args.concat([cb]));
            },
            callback);
        };
        if (arguments.length > 2) {
            var args = Array.prototype.slice.call(arguments, 2);
            return go.apply(this, args);
        }
        else {
            return go;
        }
    };
    async.applyEach = doParallel(_applyEach);
    async.applyEachSeries = doSeries(_applyEach);

    async.forever = function (fn, callback) {
        function next(err) {
            if (err) {
                if (callback) {
                    return callback(err);
                }
                throw err;
            }
            fn(next);
        }
        next();
    };

    // Node.js
    if (typeof module !== 'undefined' && module.exports) {
        module.exports = async;
    }
    // AMD / RequireJS
    else if (typeof define !== 'undefined' && define.amd) {
        define([], function () {
            return async;
        });
    }
    // included directly via <script> tag
    else {
        root.async = async;
    }

}());

}).call(this,require('_process'))

},{"_process":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/browserify/node_modules/process/browser.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/browserify/node_modules/process/browser.js":[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};
var queue = [];
var draining = false;

function drainQueue() {
    if (draining) {
        return;
    }
    draining = true;
    var currentQueue;
    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        var i = -1;
        while (++i < len) {
            currentQueue[i]();
        }
        len = queue.length;
    }
    draining = false;
}
process.nextTick = function (fun) {
    queue.push(fun);
    if (!draining) {
        setTimeout(drainQueue, 0);
    }
};

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/dropzone/dist/dropzone.js":[function(require,module,exports){

/*
 *
 * More info at [www.dropzonejs.com](http://www.dropzonejs.com)
 *
 * Copyright (c) 2012, Matias Meno
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 */

(function() {
  var Dropzone, Emitter, camelize, contentLoaded, detectVerticalSquash, drawImageIOSFix, noop, without,
    __slice = [].slice,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  noop = function() {};

  Emitter = (function() {
    function Emitter() {}

    Emitter.prototype.addEventListener = Emitter.prototype.on;

    Emitter.prototype.on = function(event, fn) {
      this._callbacks = this._callbacks || {};
      if (!this._callbacks[event]) {
        this._callbacks[event] = [];
      }
      this._callbacks[event].push(fn);
      return this;
    };

    Emitter.prototype.emit = function() {
      var args, callback, callbacks, event, _i, _len;
      event = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      this._callbacks = this._callbacks || {};
      callbacks = this._callbacks[event];
      if (callbacks) {
        for (_i = 0, _len = callbacks.length; _i < _len; _i++) {
          callback = callbacks[_i];
          callback.apply(this, args);
        }
      }
      return this;
    };

    Emitter.prototype.removeListener = Emitter.prototype.off;

    Emitter.prototype.removeAllListeners = Emitter.prototype.off;

    Emitter.prototype.removeEventListener = Emitter.prototype.off;

    Emitter.prototype.off = function(event, fn) {
      var callback, callbacks, i, _i, _len;
      if (!this._callbacks || arguments.length === 0) {
        this._callbacks = {};
        return this;
      }
      callbacks = this._callbacks[event];
      if (!callbacks) {
        return this;
      }
      if (arguments.length === 1) {
        delete this._callbacks[event];
        return this;
      }
      for (i = _i = 0, _len = callbacks.length; _i < _len; i = ++_i) {
        callback = callbacks[i];
        if (callback === fn) {
          callbacks.splice(i, 1);
          break;
        }
      }
      return this;
    };

    return Emitter;

  })();

  Dropzone = (function(_super) {
    var extend, resolveOption;

    __extends(Dropzone, _super);

    Dropzone.prototype.Emitter = Emitter;


    /*
    This is a list of all available events you can register on a dropzone object.
    
    You can register an event handler like this:
    
        dropzone.on("dragEnter", function() { });
     */

    Dropzone.prototype.events = ["drop", "dragstart", "dragend", "dragenter", "dragover", "dragleave", "addedfile", "removedfile", "thumbnail", "error", "errormultiple", "processing", "processingmultiple", "uploadprogress", "totaluploadprogress", "sending", "sendingmultiple", "success", "successmultiple", "canceled", "canceledmultiple", "complete", "completemultiple", "reset", "maxfilesexceeded", "maxfilesreached", "queuecomplete"];

    Dropzone.prototype.defaultOptions = {
      url: null,
      method: "post",
      withCredentials: false,
      parallelUploads: 2,
      uploadMultiple: false,
      maxFilesize: 256,
      paramName: "file",
      createImageThumbnails: true,
      maxThumbnailFilesize: 10,
      thumbnailWidth: 120,
      thumbnailHeight: 120,
      filesizeBase: 1000,
      maxFiles: null,
      filesizeBase: 1000,
      params: {},
      clickable: true,
      ignoreHiddenFiles: true,
      acceptedFiles: null,
      acceptedMimeTypes: null,
      autoProcessQueue: true,
      autoQueue: true,
      addRemoveLinks: false,
      previewsContainer: null,
      capture: null,
      dictDefaultMessage: "Drop files here to upload",
      dictFallbackMessage: "Your browser does not support drag'n'drop file uploads.",
      dictFallbackText: "Please use the fallback form below to upload your files like in the olden days.",
      dictFileTooBig: "File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",
      dictInvalidFileType: "You can't upload files of this type.",
      dictResponseError: "Server responded with {{statusCode}} code.",
      dictCancelUpload: "Cancel upload",
      dictCancelUploadConfirmation: "Are you sure you want to cancel this upload?",
      dictRemoveFile: "Remove file",
      dictRemoveFileConfirmation: null,
      dictMaxFilesExceeded: "You can not upload any more files.",
      accept: function(file, done) {
        return done();
      },
      init: function() {
        return noop;
      },
      forceFallback: false,
      fallback: function() {
        var child, messageElement, span, _i, _len, _ref;
        this.element.className = "" + this.element.className + " dz-browser-not-supported";
        _ref = this.element.getElementsByTagName("div");
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          child = _ref[_i];
          if (/(^| )dz-message($| )/.test(child.className)) {
            messageElement = child;
            child.className = "dz-message";
            continue;
          }
        }
        if (!messageElement) {
          messageElement = Dropzone.createElement("<div class=\"dz-message\"><span></span></div>");
          this.element.appendChild(messageElement);
        }
        span = messageElement.getElementsByTagName("span")[0];
        if (span) {
          span.textContent = this.options.dictFallbackMessage;
        }
        return this.element.appendChild(this.getFallbackForm());
      },
      resize: function(file) {
        var info, srcRatio, trgRatio;
        info = {
          srcX: 0,
          srcY: 0,
          srcWidth: file.width,
          srcHeight: file.height
        };
        srcRatio = file.width / file.height;
        info.optWidth = this.options.thumbnailWidth;
        info.optHeight = this.options.thumbnailHeight;
        if ((info.optWidth == null) && (info.optHeight == null)) {
          info.optWidth = info.srcWidth;
          info.optHeight = info.srcHeight;
        } else if (info.optWidth == null) {
          info.optWidth = srcRatio * info.optHeight;
        } else if (info.optHeight == null) {
          info.optHeight = (1 / srcRatio) * info.optWidth;
        }
        trgRatio = info.optWidth / info.optHeight;
        if (file.height < info.optHeight || file.width < info.optWidth) {
          info.trgHeight = info.srcHeight;
          info.trgWidth = info.srcWidth;
        } else {
          if (srcRatio > trgRatio) {
            info.srcHeight = file.height;
            info.srcWidth = info.srcHeight * trgRatio;
          } else {
            info.srcWidth = file.width;
            info.srcHeight = info.srcWidth / trgRatio;
          }
        }
        info.srcX = (file.width - info.srcWidth) / 2;
        info.srcY = (file.height - info.srcHeight) / 2;
        return info;
      },

      /*
      Those functions register themselves to the events on init and handle all
      the user interface specific stuff. Overwriting them won't break the upload
      but can break the way it's displayed.
      You can overwrite them if you don't like the default behavior. If you just
      want to add an additional event handler, register it on the dropzone object
      and don't overwrite those options.
       */
      drop: function(e) {
        return this.element.classList.remove("dz-drag-hover");
      },
      dragstart: noop,
      dragend: function(e) {
        return this.element.classList.remove("dz-drag-hover");
      },
      dragenter: function(e) {
        return this.element.classList.add("dz-drag-hover");
      },
      dragover: function(e) {
        return this.element.classList.add("dz-drag-hover");
      },
      dragleave: function(e) {
        return this.element.classList.remove("dz-drag-hover");
      },
      paste: noop,
      reset: function() {
        return this.element.classList.remove("dz-started");
      },
      addedfile: function(file) {
        var node, removeFileEvent, removeLink, _i, _j, _k, _len, _len1, _len2, _ref, _ref1, _ref2, _results;
        if (this.element === this.previewsContainer) {
          this.element.classList.add("dz-started");
        }
        if (this.previewsContainer) {
          file.previewElement = Dropzone.createElement(this.options.previewTemplate.trim());
          file.previewTemplate = file.previewElement;
          this.previewsContainer.appendChild(file.previewElement);
          _ref = file.previewElement.querySelectorAll("[data-dz-name]");
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            node = _ref[_i];
            node.textContent = file.name;
          }
          _ref1 = file.previewElement.querySelectorAll("[data-dz-size]");
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            node = _ref1[_j];
            node.innerHTML = this.filesize(file.size);
          }
          if (this.options.addRemoveLinks) {
            file._removeLink = Dropzone.createElement("<a class=\"dz-remove\" href=\"javascript:undefined;\" data-dz-remove>" + this.options.dictRemoveFile + "</a>");
            file.previewElement.appendChild(file._removeLink);
          }
          removeFileEvent = (function(_this) {
            return function(e) {
              e.preventDefault();
              e.stopPropagation();
              if (file.status === Dropzone.UPLOADING) {
                return Dropzone.confirm(_this.options.dictCancelUploadConfirmation, function() {
                  return _this.removeFile(file);
                });
              } else {
                if (_this.options.dictRemoveFileConfirmation) {
                  return Dropzone.confirm(_this.options.dictRemoveFileConfirmation, function() {
                    return _this.removeFile(file);
                  });
                } else {
                  return _this.removeFile(file);
                }
              }
            };
          })(this);
          _ref2 = file.previewElement.querySelectorAll("[data-dz-remove]");
          _results = [];
          for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
            removeLink = _ref2[_k];
            _results.push(removeLink.addEventListener("click", removeFileEvent));
          }
          return _results;
        }
      },
      removedfile: function(file) {
        var _ref;
        if (file.previewElement) {
          if ((_ref = file.previewElement) != null) {
            _ref.parentNode.removeChild(file.previewElement);
          }
        }
        return this._updateMaxFilesReachedClass();
      },
      thumbnail: function(file, dataUrl) {
        var thumbnailElement, _i, _len, _ref;
        if (file.previewElement) {
          file.previewElement.classList.remove("dz-file-preview");
          _ref = file.previewElement.querySelectorAll("[data-dz-thumbnail]");
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            thumbnailElement = _ref[_i];
            thumbnailElement.alt = file.name;
            thumbnailElement.src = dataUrl;
          }
          return setTimeout(((function(_this) {
            return function() {
              return file.previewElement.classList.add("dz-image-preview");
            };
          })(this)), 1);
        }
      },
      error: function(file, message) {
        var node, _i, _len, _ref, _results;
        if (file.previewElement) {
          file.previewElement.classList.add("dz-error");
          if (typeof message !== "String" && message.error) {
            message = message.error;
          }
          _ref = file.previewElement.querySelectorAll("[data-dz-errormessage]");
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            node = _ref[_i];
            _results.push(node.textContent = message);
          }
          return _results;
        }
      },
      errormultiple: noop,
      processing: function(file) {
        if (file.previewElement) {
          file.previewElement.classList.add("dz-processing");
          if (file._removeLink) {
            return file._removeLink.textContent = this.options.dictCancelUpload;
          }
        }
      },
      processingmultiple: noop,
      uploadprogress: function(file, progress, bytesSent) {
        var node, _i, _len, _ref, _results;
        if (file.previewElement) {
          _ref = file.previewElement.querySelectorAll("[data-dz-uploadprogress]");
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            node = _ref[_i];
            if (node.nodeName === 'PROGRESS') {
              _results.push(node.value = progress);
            } else {
              _results.push(node.style.width = "" + progress + "%");
            }
          }
          return _results;
        }
      },
      totaluploadprogress: noop,
      sending: noop,
      sendingmultiple: noop,
      success: function(file) {
        if (file.previewElement) {
          return file.previewElement.classList.add("dz-success");
        }
      },
      successmultiple: noop,
      canceled: function(file) {
        return this.emit("error", file, "Upload canceled.");
      },
      canceledmultiple: noop,
      complete: function(file) {
        if (file._removeLink) {
          file._removeLink.textContent = this.options.dictRemoveFile;
        }
        if (file.previewElement) {
          return file.previewElement.classList.add("dz-complete");
        }
      },
      completemultiple: noop,
      maxfilesexceeded: noop,
      maxfilesreached: noop,
      queuecomplete: noop,
      previewTemplate: "<div class=\"dz-preview dz-file-preview\">\n  <div class=\"dz-image\"><img data-dz-thumbnail /></div>\n  <div class=\"dz-details\">\n    <div class=\"dz-size\"><span data-dz-size></span></div>\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n  </div>\n  <div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div>\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n  <div class=\"dz-success-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Check</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <path d=\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" stroke-opacity=\"0.198794158\" stroke=\"#747474\" fill-opacity=\"0.816519475\" fill=\"#FFFFFF\" sketch:type=\"MSShapeGroup\"></path>\n      </g>\n    </svg>\n  </div>\n  <div class=\"dz-error-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Error</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <g id=\"Check-+-Oval-2\" sketch:type=\"MSLayerGroup\" stroke=\"#747474\" stroke-opacity=\"0.198794158\" fill=\"#FFFFFF\" fill-opacity=\"0.816519475\">\n          <path d=\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" sketch:type=\"MSShapeGroup\"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>"
    };

    extend = function() {
      var key, object, objects, target, val, _i, _len;
      target = arguments[0], objects = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      for (_i = 0, _len = objects.length; _i < _len; _i++) {
        object = objects[_i];
        for (key in object) {
          val = object[key];
          target[key] = val;
        }
      }
      return target;
    };

    function Dropzone(element, options) {
      var elementOptions, fallback, _ref;
      this.element = element;
      this.version = Dropzone.version;
      this.defaultOptions.previewTemplate = this.defaultOptions.previewTemplate.replace(/\n*/g, "");
      this.clickableElements = [];
      this.listeners = [];
      this.files = [];
      if (typeof this.element === "string") {
        this.element = document.querySelector(this.element);
      }
      if (!(this.element && (this.element.nodeType != null))) {
        throw new Error("Invalid dropzone element.");
      }
      if (this.element.dropzone) {
        throw new Error("Dropzone already attached.");
      }
      Dropzone.instances.push(this);
      this.element.dropzone = this;
      elementOptions = (_ref = Dropzone.optionsForElement(this.element)) != null ? _ref : {};
      this.options = extend({}, this.defaultOptions, elementOptions, options != null ? options : {});
      if (this.options.forceFallback || !Dropzone.isBrowserSupported()) {
        return this.options.fallback.call(this);
      }
      if (this.options.url == null) {
        this.options.url = this.element.getAttribute("action");
      }
      if (!this.options.url) {
        throw new Error("No URL provided.");
      }
      if (this.options.acceptedFiles && this.options.acceptedMimeTypes) {
        throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");
      }
      if (this.options.acceptedMimeTypes) {
        this.options.acceptedFiles = this.options.acceptedMimeTypes;
        delete this.options.acceptedMimeTypes;
      }
      this.options.method = this.options.method.toUpperCase();
      if ((fallback = this.getExistingFallback()) && fallback.parentNode) {
        fallback.parentNode.removeChild(fallback);
      }
      if (this.options.previewsContainer !== false) {
        if (this.options.previewsContainer) {
          this.previewsContainer = Dropzone.getElement(this.options.previewsContainer, "previewsContainer");
        } else {
          this.previewsContainer = this.element;
        }
      }
      if (this.options.clickable) {
        if (this.options.clickable === true) {
          this.clickableElements = [this.element];
        } else {
          this.clickableElements = Dropzone.getElements(this.options.clickable, "clickable");
        }
      }
      this.init();
    }

    Dropzone.prototype.getAcceptedFiles = function() {
      var file, _i, _len, _ref, _results;
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (file.accepted) {
          _results.push(file);
        }
      }
      return _results;
    };

    Dropzone.prototype.getRejectedFiles = function() {
      var file, _i, _len, _ref, _results;
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (!file.accepted) {
          _results.push(file);
        }
      }
      return _results;
    };

    Dropzone.prototype.getFilesWithStatus = function(status) {
      var file, _i, _len, _ref, _results;
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (file.status === status) {
          _results.push(file);
        }
      }
      return _results;
    };

    Dropzone.prototype.getQueuedFiles = function() {
      return this.getFilesWithStatus(Dropzone.QUEUED);
    };

    Dropzone.prototype.getUploadingFiles = function() {
      return this.getFilesWithStatus(Dropzone.UPLOADING);
    };

    Dropzone.prototype.getActiveFiles = function() {
      var file, _i, _len, _ref, _results;
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (file.status === Dropzone.UPLOADING || file.status === Dropzone.QUEUED) {
          _results.push(file);
        }
      }
      return _results;
    };

    Dropzone.prototype.init = function() {
      var eventName, noPropagation, setupHiddenFileInput, _i, _len, _ref, _ref1;
      if (this.element.tagName === "form") {
        this.element.setAttribute("enctype", "multipart/form-data");
      }
      if (this.element.classList.contains("dropzone") && !this.element.querySelector(".dz-message")) {
        this.element.appendChild(Dropzone.createElement("<div class=\"dz-default dz-message\"><span>" + this.options.dictDefaultMessage + "</span></div>"));
      }
      if (this.clickableElements.length) {
        setupHiddenFileInput = (function(_this) {
          return function() {
            if (_this.hiddenFileInput) {
              document.body.removeChild(_this.hiddenFileInput);
            }
            _this.hiddenFileInput = document.createElement("input");
            _this.hiddenFileInput.setAttribute("type", "file");
            if ((_this.options.maxFiles == null) || _this.options.maxFiles > 1) {
              _this.hiddenFileInput.setAttribute("multiple", "multiple");
            }
            _this.hiddenFileInput.className = "dz-hidden-input";
            if (_this.options.acceptedFiles != null) {
              _this.hiddenFileInput.setAttribute("accept", _this.options.acceptedFiles);
            }
            if (_this.options.capture != null) {
              _this.hiddenFileInput.setAttribute("capture", _this.options.capture);
            }
            _this.hiddenFileInput.style.visibility = "hidden";
            _this.hiddenFileInput.style.position = "absolute";
            _this.hiddenFileInput.style.top = "0";
            _this.hiddenFileInput.style.left = "0";
            _this.hiddenFileInput.style.height = "0";
            _this.hiddenFileInput.style.width = "0";
            document.body.appendChild(_this.hiddenFileInput);
            return _this.hiddenFileInput.addEventListener("change", function() {
              var file, files, _i, _len;
              files = _this.hiddenFileInput.files;
              if (files.length) {
                for (_i = 0, _len = files.length; _i < _len; _i++) {
                  file = files[_i];
                  _this.addFile(file);
                }
              }
              return setupHiddenFileInput();
            });
          };
        })(this);
        setupHiddenFileInput();
      }
      this.URL = (_ref = window.URL) != null ? _ref : window.webkitURL;
      _ref1 = this.events;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        eventName = _ref1[_i];
        this.on(eventName, this.options[eventName]);
      }
      this.on("uploadprogress", (function(_this) {
        return function() {
          return _this.updateTotalUploadProgress();
        };
      })(this));
      this.on("removedfile", (function(_this) {
        return function() {
          return _this.updateTotalUploadProgress();
        };
      })(this));
      this.on("canceled", (function(_this) {
        return function(file) {
          return _this.emit("complete", file);
        };
      })(this));
      this.on("complete", (function(_this) {
        return function(file) {
          if (_this.getUploadingFiles().length === 0 && _this.getQueuedFiles().length === 0) {
            return setTimeout((function() {
              return _this.emit("queuecomplete");
            }), 0);
          }
        };
      })(this));
      noPropagation = function(e) {
        e.stopPropagation();
        if (e.preventDefault) {
          return e.preventDefault();
        } else {
          return e.returnValue = false;
        }
      };
      this.listeners = [
        {
          element: this.element,
          events: {
            "dragstart": (function(_this) {
              return function(e) {
                return _this.emit("dragstart", e);
              };
            })(this),
            "dragenter": (function(_this) {
              return function(e) {
                noPropagation(e);
                return _this.emit("dragenter", e);
              };
            })(this),
            "dragover": (function(_this) {
              return function(e) {
                var efct;
                try {
                  efct = e.dataTransfer.effectAllowed;
                } catch (_error) {}
                e.dataTransfer.dropEffect = 'move' === efct || 'linkMove' === efct ? 'move' : 'copy';
                noPropagation(e);
                return _this.emit("dragover", e);
              };
            })(this),
            "dragleave": (function(_this) {
              return function(e) {
                return _this.emit("dragleave", e);
              };
            })(this),
            "drop": (function(_this) {
              return function(e) {
                noPropagation(e);
                return _this.drop(e);
              };
            })(this),
            "dragend": (function(_this) {
              return function(e) {
                return _this.emit("dragend", e);
              };
            })(this)
          }
        }
      ];
      this.clickableElements.forEach((function(_this) {
        return function(clickableElement) {
          return _this.listeners.push({
            element: clickableElement,
            events: {
              "click": function(evt) {
                if ((clickableElement !== _this.element) || (evt.target === _this.element || Dropzone.elementInside(evt.target, _this.element.querySelector(".dz-message")))) {
                  return _this.hiddenFileInput.click();
                }
              }
            }
          });
        };
      })(this));
      this.enable();
      return this.options.init.call(this);
    };

    Dropzone.prototype.destroy = function() {
      var _ref;
      this.disable();
      this.removeAllFiles(true);
      if ((_ref = this.hiddenFileInput) != null ? _ref.parentNode : void 0) {
        this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput);
        this.hiddenFileInput = null;
      }
      delete this.element.dropzone;
      return Dropzone.instances.splice(Dropzone.instances.indexOf(this), 1);
    };

    Dropzone.prototype.updateTotalUploadProgress = function() {
      var activeFiles, file, totalBytes, totalBytesSent, totalUploadProgress, _i, _len, _ref;
      totalBytesSent = 0;
      totalBytes = 0;
      activeFiles = this.getActiveFiles();
      if (activeFiles.length) {
        _ref = this.getActiveFiles();
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          file = _ref[_i];
          totalBytesSent += file.upload.bytesSent;
          totalBytes += file.upload.total;
        }
        totalUploadProgress = 100 * totalBytesSent / totalBytes;
      } else {
        totalUploadProgress = 100;
      }
      return this.emit("totaluploadprogress", totalUploadProgress, totalBytes, totalBytesSent);
    };

    Dropzone.prototype._getParamName = function(n) {
      if (typeof this.options.paramName === "function") {
        return this.options.paramName(n);
      } else {
        return "" + this.options.paramName + (this.options.uploadMultiple ? "[" + n + "]" : "");
      }
    };

    Dropzone.prototype.getFallbackForm = function() {
      var existingFallback, fields, fieldsString, form;
      if (existingFallback = this.getExistingFallback()) {
        return existingFallback;
      }
      fieldsString = "<div class=\"dz-fallback\">";
      if (this.options.dictFallbackText) {
        fieldsString += "<p>" + this.options.dictFallbackText + "</p>";
      }
      fieldsString += "<input type=\"file\" name=\"" + (this._getParamName(0)) + "\" " + (this.options.uploadMultiple ? 'multiple="multiple"' : void 0) + " /><input type=\"submit\" value=\"Upload!\"></div>";
      fields = Dropzone.createElement(fieldsString);
      if (this.element.tagName !== "FORM") {
        form = Dropzone.createElement("<form action=\"" + this.options.url + "\" enctype=\"multipart/form-data\" method=\"" + this.options.method + "\"></form>");
        form.appendChild(fields);
      } else {
        this.element.setAttribute("enctype", "multipart/form-data");
        this.element.setAttribute("method", this.options.method);
      }
      return form != null ? form : fields;
    };

    Dropzone.prototype.getExistingFallback = function() {
      var fallback, getFallback, tagName, _i, _len, _ref;
      getFallback = function(elements) {
        var el, _i, _len;
        for (_i = 0, _len = elements.length; _i < _len; _i++) {
          el = elements[_i];
          if (/(^| )fallback($| )/.test(el.className)) {
            return el;
          }
        }
      };
      _ref = ["div", "form"];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        tagName = _ref[_i];
        if (fallback = getFallback(this.element.getElementsByTagName(tagName))) {
          return fallback;
        }
      }
    };

    Dropzone.prototype.setupEventListeners = function() {
      var elementListeners, event, listener, _i, _len, _ref, _results;
      _ref = this.listeners;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        elementListeners = _ref[_i];
        _results.push((function() {
          var _ref1, _results1;
          _ref1 = elementListeners.events;
          _results1 = [];
          for (event in _ref1) {
            listener = _ref1[event];
            _results1.push(elementListeners.element.addEventListener(event, listener, false));
          }
          return _results1;
        })());
      }
      return _results;
    };

    Dropzone.prototype.removeEventListeners = function() {
      var elementListeners, event, listener, _i, _len, _ref, _results;
      _ref = this.listeners;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        elementListeners = _ref[_i];
        _results.push((function() {
          var _ref1, _results1;
          _ref1 = elementListeners.events;
          _results1 = [];
          for (event in _ref1) {
            listener = _ref1[event];
            _results1.push(elementListeners.element.removeEventListener(event, listener, false));
          }
          return _results1;
        })());
      }
      return _results;
    };

    Dropzone.prototype.disable = function() {
      var file, _i, _len, _ref, _results;
      this.clickableElements.forEach(function(element) {
        return element.classList.remove("dz-clickable");
      });
      this.removeEventListeners();
      _ref = this.files;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        _results.push(this.cancelUpload(file));
      }
      return _results;
    };

    Dropzone.prototype.enable = function() {
      this.clickableElements.forEach(function(element) {
        return element.classList.add("dz-clickable");
      });
      return this.setupEventListeners();
    };

    Dropzone.prototype.filesize = function(size) {
      var cutoff, i, selectedSize, selectedUnit, unit, units, _i, _len;
      units = ['TB', 'GB', 'MB', 'KB', 'b'];
      selectedSize = selectedUnit = null;
      for (i = _i = 0, _len = units.length; _i < _len; i = ++_i) {
        unit = units[i];
        cutoff = Math.pow(this.options.filesizeBase, 4 - i) / 10;
        if (size >= cutoff) {
          selectedSize = size / Math.pow(this.options.filesizeBase, 4 - i);
          selectedUnit = unit;
          break;
        }
      }
      selectedSize = Math.round(10 * selectedSize) / 10;
      return "<strong>" + selectedSize + "</strong> " + selectedUnit;
    };

    Dropzone.prototype._updateMaxFilesReachedClass = function() {
      if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {
        if (this.getAcceptedFiles().length === this.options.maxFiles) {
          this.emit('maxfilesreached', this.files);
        }
        return this.element.classList.add("dz-max-files-reached");
      } else {
        return this.element.classList.remove("dz-max-files-reached");
      }
    };

    Dropzone.prototype.drop = function(e) {
      var files, items;
      if (!e.dataTransfer) {
        return;
      }
      this.emit("drop", e);
      files = e.dataTransfer.files;
      if (files.length) {
        items = e.dataTransfer.items;
        if (items && items.length && (items[0].webkitGetAsEntry != null)) {
          this._addFilesFromItems(items);
        } else {
          this.handleFiles(files);
        }
      }
    };

    Dropzone.prototype.paste = function(e) {
      var items, _ref;
      if ((e != null ? (_ref = e.clipboardData) != null ? _ref.items : void 0 : void 0) == null) {
        return;
      }
      this.emit("paste", e);
      items = e.clipboardData.items;
      if (items.length) {
        return this._addFilesFromItems(items);
      }
    };

    Dropzone.prototype.handleFiles = function(files) {
      var file, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        _results.push(this.addFile(file));
      }
      return _results;
    };

    Dropzone.prototype._addFilesFromItems = function(items) {
      var entry, item, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = items.length; _i < _len; _i++) {
        item = items[_i];
        if ((item.webkitGetAsEntry != null) && (entry = item.webkitGetAsEntry())) {
          if (entry.isFile) {
            _results.push(this.addFile(item.getAsFile()));
          } else if (entry.isDirectory) {
            _results.push(this._addFilesFromDirectory(entry, entry.name));
          } else {
            _results.push(void 0);
          }
        } else if (item.getAsFile != null) {
          if ((item.kind == null) || item.kind === "file") {
            _results.push(this.addFile(item.getAsFile()));
          } else {
            _results.push(void 0);
          }
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Dropzone.prototype._addFilesFromDirectory = function(directory, path) {
      var dirReader, entriesReader;
      dirReader = directory.createReader();
      entriesReader = (function(_this) {
        return function(entries) {
          var entry, _i, _len;
          for (_i = 0, _len = entries.length; _i < _len; _i++) {
            entry = entries[_i];
            if (entry.isFile) {
              entry.file(function(file) {
                if (_this.options.ignoreHiddenFiles && file.name.substring(0, 1) === '.') {
                  return;
                }
                file.fullPath = "" + path + "/" + file.name;
                return _this.addFile(file);
              });
            } else if (entry.isDirectory) {
              _this._addFilesFromDirectory(entry, "" + path + "/" + entry.name);
            }
          }
        };
      })(this);
      return dirReader.readEntries(entriesReader, function(error) {
        return typeof console !== "undefined" && console !== null ? typeof console.log === "function" ? console.log(error) : void 0 : void 0;
      });
    };

    Dropzone.prototype.accept = function(file, done) {
      if (file.size > this.options.maxFilesize * 1024 * 1024) {
        return done(this.options.dictFileTooBig.replace("{{filesize}}", Math.round(file.size / 1024 / 10.24) / 100).replace("{{maxFilesize}}", this.options.maxFilesize));
      } else if (!Dropzone.isValidFile(file, this.options.acceptedFiles)) {
        return done(this.options.dictInvalidFileType);
      } else if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {
        done(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}", this.options.maxFiles));
        return this.emit("maxfilesexceeded", file);
      } else {
        return this.options.accept.call(this, file, done);
      }
    };

    Dropzone.prototype.addFile = function(file) {
      file.upload = {
        progress: 0,
        total: file.size,
        bytesSent: 0
      };
      this.files.push(file);
      file.status = Dropzone.ADDED;
      this.emit("addedfile", file);
      this._enqueueThumbnail(file);
      return this.accept(file, (function(_this) {
        return function(error) {
          if (error) {
            file.accepted = false;
            _this._errorProcessing([file], error);
          } else {
            file.accepted = true;
            if (_this.options.autoQueue) {
              _this.enqueueFile(file);
            }
          }
          return _this._updateMaxFilesReachedClass();
        };
      })(this));
    };

    Dropzone.prototype.enqueueFiles = function(files) {
      var file, _i, _len;
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        this.enqueueFile(file);
      }
      return null;
    };

    Dropzone.prototype.enqueueFile = function(file) {
      if (file.status === Dropzone.ADDED && file.accepted === true) {
        file.status = Dropzone.QUEUED;
        if (this.options.autoProcessQueue) {
          return setTimeout(((function(_this) {
            return function() {
              return _this.processQueue();
            };
          })(this)), 0);
        }
      } else {
        throw new Error("This file can't be queued because it has already been processed or was rejected.");
      }
    };

    Dropzone.prototype._thumbnailQueue = [];

    Dropzone.prototype._processingThumbnail = false;

    Dropzone.prototype._enqueueThumbnail = function(file) {
      if (this.options.createImageThumbnails && file.type.match(/image.*/) && file.size <= this.options.maxThumbnailFilesize * 1024 * 1024) {
        this._thumbnailQueue.push(file);
        return setTimeout(((function(_this) {
          return function() {
            return _this._processThumbnailQueue();
          };
        })(this)), 0);
      }
    };

    Dropzone.prototype._processThumbnailQueue = function() {
      if (this._processingThumbnail || this._thumbnailQueue.length === 0) {
        return;
      }
      this._processingThumbnail = true;
      return this.createThumbnail(this._thumbnailQueue.shift(), (function(_this) {
        return function() {
          _this._processingThumbnail = false;
          return _this._processThumbnailQueue();
        };
      })(this));
    };

    Dropzone.prototype.removeFile = function(file) {
      if (file.status === Dropzone.UPLOADING) {
        this.cancelUpload(file);
      }
      this.files = without(this.files, file);
      this.emit("removedfile", file);
      if (this.files.length === 0) {
        return this.emit("reset");
      }
    };

    Dropzone.prototype.removeAllFiles = function(cancelIfNecessary) {
      var file, _i, _len, _ref;
      if (cancelIfNecessary == null) {
        cancelIfNecessary = false;
      }
      _ref = this.files.slice();
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        file = _ref[_i];
        if (file.status !== Dropzone.UPLOADING || cancelIfNecessary) {
          this.removeFile(file);
        }
      }
      return null;
    };

    Dropzone.prototype.createThumbnail = function(file, callback) {
      var fileReader;
      fileReader = new FileReader;
      fileReader.onload = (function(_this) {
        return function() {
          if (file.type === "image/svg+xml") {
            _this.emit("thumbnail", file, fileReader.result);
            if (callback != null) {
              callback();
            }
            return;
          }
          return _this.createThumbnailFromUrl(file, fileReader.result, callback);
        };
      })(this);
      return fileReader.readAsDataURL(file);
    };

    Dropzone.prototype.createThumbnailFromUrl = function(file, imageUrl, callback) {
      var img;
      img = document.createElement("img");
      img.onload = (function(_this) {
        return function() {
          var canvas, ctx, resizeInfo, thumbnail, _ref, _ref1, _ref2, _ref3;
          file.width = img.width;
          file.height = img.height;
          resizeInfo = _this.options.resize.call(_this, file);
          if (resizeInfo.trgWidth == null) {
            resizeInfo.trgWidth = resizeInfo.optWidth;
          }
          if (resizeInfo.trgHeight == null) {
            resizeInfo.trgHeight = resizeInfo.optHeight;
          }
          canvas = document.createElement("canvas");
          ctx = canvas.getContext("2d");
          canvas.width = resizeInfo.trgWidth;
          canvas.height = resizeInfo.trgHeight;
          drawImageIOSFix(ctx, img, (_ref = resizeInfo.srcX) != null ? _ref : 0, (_ref1 = resizeInfo.srcY) != null ? _ref1 : 0, resizeInfo.srcWidth, resizeInfo.srcHeight, (_ref2 = resizeInfo.trgX) != null ? _ref2 : 0, (_ref3 = resizeInfo.trgY) != null ? _ref3 : 0, resizeInfo.trgWidth, resizeInfo.trgHeight);
          thumbnail = canvas.toDataURL("image/png");
          _this.emit("thumbnail", file, thumbnail);
          if (callback != null) {
            return callback();
          }
        };
      })(this);
      if (callback != null) {
        img.onerror = callback;
      }
      return img.src = imageUrl;
    };

    Dropzone.prototype.processQueue = function() {
      var i, parallelUploads, processingLength, queuedFiles;
      parallelUploads = this.options.parallelUploads;
      processingLength = this.getUploadingFiles().length;
      i = processingLength;
      if (processingLength >= parallelUploads) {
        return;
      }
      queuedFiles = this.getQueuedFiles();
      if (!(queuedFiles.length > 0)) {
        return;
      }
      if (this.options.uploadMultiple) {
        return this.processFiles(queuedFiles.slice(0, parallelUploads - processingLength));
      } else {
        while (i < parallelUploads) {
          if (!queuedFiles.length) {
            return;
          }
          this.processFile(queuedFiles.shift());
          i++;
        }
      }
    };

    Dropzone.prototype.processFile = function(file) {
      return this.processFiles([file]);
    };

    Dropzone.prototype.processFiles = function(files) {
      var file, _i, _len;
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        file.processing = true;
        file.status = Dropzone.UPLOADING;
        this.emit("processing", file);
      }
      if (this.options.uploadMultiple) {
        this.emit("processingmultiple", files);
      }
      return this.uploadFiles(files);
    };

    Dropzone.prototype._getFilesWithXhr = function(xhr) {
      var file, files;
      return files = (function() {
        var _i, _len, _ref, _results;
        _ref = this.files;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          file = _ref[_i];
          if (file.xhr === xhr) {
            _results.push(file);
          }
        }
        return _results;
      }).call(this);
    };

    Dropzone.prototype.cancelUpload = function(file) {
      var groupedFile, groupedFiles, _i, _j, _len, _len1, _ref;
      if (file.status === Dropzone.UPLOADING) {
        groupedFiles = this._getFilesWithXhr(file.xhr);
        for (_i = 0, _len = groupedFiles.length; _i < _len; _i++) {
          groupedFile = groupedFiles[_i];
          groupedFile.status = Dropzone.CANCELED;
        }
        file.xhr.abort();
        for (_j = 0, _len1 = groupedFiles.length; _j < _len1; _j++) {
          groupedFile = groupedFiles[_j];
          this.emit("canceled", groupedFile);
        }
        if (this.options.uploadMultiple) {
          this.emit("canceledmultiple", groupedFiles);
        }
      } else if ((_ref = file.status) === Dropzone.ADDED || _ref === Dropzone.QUEUED) {
        file.status = Dropzone.CANCELED;
        this.emit("canceled", file);
        if (this.options.uploadMultiple) {
          this.emit("canceledmultiple", [file]);
        }
      }
      if (this.options.autoProcessQueue) {
        return this.processQueue();
      }
    };

    resolveOption = function() {
      var args, option;
      option = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      if (typeof option === 'function') {
        return option.apply(this, args);
      }
      return option;
    };

    Dropzone.prototype.uploadFile = function(file) {
      return this.uploadFiles([file]);
    };

    Dropzone.prototype.uploadFiles = function(files) {
      var file, formData, handleError, headerName, headerValue, headers, i, input, inputName, inputType, key, method, option, progressObj, response, updateProgress, url, value, xhr, _i, _j, _k, _l, _len, _len1, _len2, _len3, _m, _ref, _ref1, _ref2, _ref3, _ref4, _ref5;
      xhr = new XMLHttpRequest();
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        file.xhr = xhr;
      }
      method = resolveOption(this.options.method, files);
      url = resolveOption(this.options.url, files);
      xhr.open(method, url, true);
      xhr.withCredentials = !!this.options.withCredentials;
      response = null;
      handleError = (function(_this) {
        return function() {
          var _j, _len1, _results;
          _results = [];
          for (_j = 0, _len1 = files.length; _j < _len1; _j++) {
            file = files[_j];
            _results.push(_this._errorProcessing(files, response || _this.options.dictResponseError.replace("{{statusCode}}", xhr.status), xhr));
          }
          return _results;
        };
      })(this);
      updateProgress = (function(_this) {
        return function(e) {
          var allFilesFinished, progress, _j, _k, _l, _len1, _len2, _len3, _results;
          if (e != null) {
            progress = 100 * e.loaded / e.total;
            for (_j = 0, _len1 = files.length; _j < _len1; _j++) {
              file = files[_j];
              file.upload = {
                progress: progress,
                total: e.total,
                bytesSent: e.loaded
              };
            }
          } else {
            allFilesFinished = true;
            progress = 100;
            for (_k = 0, _len2 = files.length; _k < _len2; _k++) {
              file = files[_k];
              if (!(file.upload.progress === 100 && file.upload.bytesSent === file.upload.total)) {
                allFilesFinished = false;
              }
              file.upload.progress = progress;
              file.upload.bytesSent = file.upload.total;
            }
            if (allFilesFinished) {
              return;
            }
          }
          _results = [];
          for (_l = 0, _len3 = files.length; _l < _len3; _l++) {
            file = files[_l];
            _results.push(_this.emit("uploadprogress", file, progress, file.upload.bytesSent));
          }
          return _results;
        };
      })(this);
      xhr.onload = (function(_this) {
        return function(e) {
          var _ref;
          if (files[0].status === Dropzone.CANCELED) {
            return;
          }
          if (xhr.readyState !== 4) {
            return;
          }
          response = xhr.responseText;
          if (xhr.getResponseHeader("content-type") && ~xhr.getResponseHeader("content-type").indexOf("application/json")) {
            try {
              response = JSON.parse(response);
            } catch (_error) {
              e = _error;
              response = "Invalid JSON response from server.";
            }
          }
          updateProgress();
          if (!((200 <= (_ref = xhr.status) && _ref < 300))) {
            return handleError();
          } else {
            return _this._finished(files, response, e);
          }
        };
      })(this);
      xhr.onerror = (function(_this) {
        return function() {
          if (files[0].status === Dropzone.CANCELED) {
            return;
          }
          return handleError();
        };
      })(this);
      progressObj = (_ref = xhr.upload) != null ? _ref : xhr;
      progressObj.onprogress = updateProgress;
      headers = {
        "Accept": "application/json",
        "Cache-Control": "no-cache",
        "X-Requested-With": "XMLHttpRequest"
      };
      if (this.options.headers) {
        extend(headers, this.options.headers);
      }
      for (headerName in headers) {
        headerValue = headers[headerName];
        xhr.setRequestHeader(headerName, headerValue);
      }
      formData = new FormData();
      if (this.options.params) {
        _ref1 = this.options.params;
        for (key in _ref1) {
          value = _ref1[key];
          formData.append(key, value);
        }
      }
      for (_j = 0, _len1 = files.length; _j < _len1; _j++) {
        file = files[_j];
        this.emit("sending", file, xhr, formData);
      }
      if (this.options.uploadMultiple) {
        this.emit("sendingmultiple", files, xhr, formData);
      }
      if (this.element.tagName === "FORM") {
        _ref2 = this.element.querySelectorAll("input, textarea, select, button");
        for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
          input = _ref2[_k];
          inputName = input.getAttribute("name");
          inputType = input.getAttribute("type");
          if (input.tagName === "SELECT" && input.hasAttribute("multiple")) {
            _ref3 = input.options;
            for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {
              option = _ref3[_l];
              if (option.selected) {
                formData.append(inputName, option.value);
              }
            }
          } else if (!inputType || ((_ref4 = inputType.toLowerCase()) !== "checkbox" && _ref4 !== "radio") || input.checked) {
            formData.append(inputName, input.value);
          }
        }
      }
      for (i = _m = 0, _ref5 = files.length - 1; 0 <= _ref5 ? _m <= _ref5 : _m >= _ref5; i = 0 <= _ref5 ? ++_m : --_m) {
        formData.append(this._getParamName(i), files[i], files[i].name);
      }
      return xhr.send(formData);
    };

    Dropzone.prototype._finished = function(files, responseText, e) {
      var file, _i, _len;
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        file.status = Dropzone.SUCCESS;
        this.emit("success", file, responseText, e);
        this.emit("complete", file);
      }
      if (this.options.uploadMultiple) {
        this.emit("successmultiple", files, responseText, e);
        this.emit("completemultiple", files);
      }
      if (this.options.autoProcessQueue) {
        return this.processQueue();
      }
    };

    Dropzone.prototype._errorProcessing = function(files, message, xhr) {
      var file, _i, _len;
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        file.status = Dropzone.ERROR;
        this.emit("error", file, message, xhr);
        this.emit("complete", file);
      }
      if (this.options.uploadMultiple) {
        this.emit("errormultiple", files, message, xhr);
        this.emit("completemultiple", files);
      }
      if (this.options.autoProcessQueue) {
        return this.processQueue();
      }
    };

    return Dropzone;

  })(Emitter);

  Dropzone.version = "4.0.1";

  Dropzone.options = {};

  Dropzone.optionsForElement = function(element) {
    if (element.getAttribute("id")) {
      return Dropzone.options[camelize(element.getAttribute("id"))];
    } else {
      return void 0;
    }
  };

  Dropzone.instances = [];

  Dropzone.forElement = function(element) {
    if (typeof element === "string") {
      element = document.querySelector(element);
    }
    if ((element != null ? element.dropzone : void 0) == null) {
      throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");
    }
    return element.dropzone;
  };

  Dropzone.autoDiscover = true;

  Dropzone.discover = function() {
    var checkElements, dropzone, dropzones, _i, _len, _results;
    if (document.querySelectorAll) {
      dropzones = document.querySelectorAll(".dropzone");
    } else {
      dropzones = [];
      checkElements = function(elements) {
        var el, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = elements.length; _i < _len; _i++) {
          el = elements[_i];
          if (/(^| )dropzone($| )/.test(el.className)) {
            _results.push(dropzones.push(el));
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      };
      checkElements(document.getElementsByTagName("div"));
      checkElements(document.getElementsByTagName("form"));
    }
    _results = [];
    for (_i = 0, _len = dropzones.length; _i < _len; _i++) {
      dropzone = dropzones[_i];
      if (Dropzone.optionsForElement(dropzone) !== false) {
        _results.push(new Dropzone(dropzone));
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  Dropzone.blacklistedBrowsers = [/opera.*Macintosh.*version\/12/i];

  Dropzone.isBrowserSupported = function() {
    var capableBrowser, regex, _i, _len, _ref;
    capableBrowser = true;
    if (window.File && window.FileReader && window.FileList && window.Blob && window.FormData && document.querySelector) {
      if (!("classList" in document.createElement("a"))) {
        capableBrowser = false;
      } else {
        _ref = Dropzone.blacklistedBrowsers;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          regex = _ref[_i];
          if (regex.test(navigator.userAgent)) {
            capableBrowser = false;
            continue;
          }
        }
      }
    } else {
      capableBrowser = false;
    }
    return capableBrowser;
  };

  without = function(list, rejectedItem) {
    var item, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = list.length; _i < _len; _i++) {
      item = list[_i];
      if (item !== rejectedItem) {
        _results.push(item);
      }
    }
    return _results;
  };

  camelize = function(str) {
    return str.replace(/[\-_](\w)/g, function(match) {
      return match.charAt(1).toUpperCase();
    });
  };

  Dropzone.createElement = function(string) {
    var div;
    div = document.createElement("div");
    div.innerHTML = string;
    return div.childNodes[0];
  };

  Dropzone.elementInside = function(element, container) {
    if (element === container) {
      return true;
    }
    while (element = element.parentNode) {
      if (element === container) {
        return true;
      }
    }
    return false;
  };

  Dropzone.getElement = function(el, name) {
    var element;
    if (typeof el === "string") {
      element = document.querySelector(el);
    } else if (el.nodeType != null) {
      element = el;
    }
    if (element == null) {
      throw new Error("Invalid `" + name + "` option provided. Please provide a CSS selector or a plain HTML element.");
    }
    return element;
  };

  Dropzone.getElements = function(els, name) {
    var e, el, elements, _i, _j, _len, _len1, _ref;
    if (els instanceof Array) {
      elements = [];
      try {
        for (_i = 0, _len = els.length; _i < _len; _i++) {
          el = els[_i];
          elements.push(this.getElement(el, name));
        }
      } catch (_error) {
        e = _error;
        elements = null;
      }
    } else if (typeof els === "string") {
      elements = [];
      _ref = document.querySelectorAll(els);
      for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
        el = _ref[_j];
        elements.push(el);
      }
    } else if (els.nodeType != null) {
      elements = [els];
    }
    if (!((elements != null) && elements.length)) {
      throw new Error("Invalid `" + name + "` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");
    }
    return elements;
  };

  Dropzone.confirm = function(question, accepted, rejected) {
    if (window.confirm(question)) {
      return accepted();
    } else if (rejected != null) {
      return rejected();
    }
  };

  Dropzone.isValidFile = function(file, acceptedFiles) {
    var baseMimeType, mimeType, validType, _i, _len;
    if (!acceptedFiles) {
      return true;
    }
    acceptedFiles = acceptedFiles.split(",");
    mimeType = file.type;
    baseMimeType = mimeType.replace(/\/.*$/, "");
    for (_i = 0, _len = acceptedFiles.length; _i < _len; _i++) {
      validType = acceptedFiles[_i];
      validType = validType.trim();
      if (validType.charAt(0) === ".") {
        if (file.name.toLowerCase().indexOf(validType.toLowerCase(), file.name.length - validType.length) !== -1) {
          return true;
        }
      } else if (/\/\*$/.test(validType)) {
        if (baseMimeType === validType.replace(/\/.*$/, "")) {
          return true;
        }
      } else {
        if (mimeType === validType) {
          return true;
        }
      }
    }
    return false;
  };

  if (typeof jQuery !== "undefined" && jQuery !== null) {
    jQuery.fn.dropzone = function(options) {
      return this.each(function() {
        return new Dropzone(this, options);
      });
    };
  }

  if (typeof module !== "undefined" && module !== null) {
    module.exports = Dropzone;
  } else {
    window.Dropzone = Dropzone;
  }

  Dropzone.ADDED = "added";

  Dropzone.QUEUED = "queued";

  Dropzone.ACCEPTED = Dropzone.QUEUED;

  Dropzone.UPLOADING = "uploading";

  Dropzone.PROCESSING = Dropzone.UPLOADING;

  Dropzone.CANCELED = "canceled";

  Dropzone.ERROR = "error";

  Dropzone.SUCCESS = "success";


  /*
  
  Bugfix for iOS 6 and 7
  Source: http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios
  based on the work of https://github.com/stomita/ios-imagefile-megapixel
   */

  detectVerticalSquash = function(img) {
    var alpha, canvas, ctx, data, ey, ih, iw, py, ratio, sy;
    iw = img.naturalWidth;
    ih = img.naturalHeight;
    canvas = document.createElement("canvas");
    canvas.width = 1;
    canvas.height = ih;
    ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    data = ctx.getImageData(0, 0, 1, ih).data;
    sy = 0;
    ey = ih;
    py = ih;
    while (py > sy) {
      alpha = data[(py - 1) * 4 + 3];
      if (alpha === 0) {
        ey = py;
      } else {
        sy = py;
      }
      py = (ey + sy) >> 1;
    }
    ratio = py / ih;
    if (ratio === 0) {
      return 1;
    } else {
      return ratio;
    }
  };

  drawImageIOSFix = function(ctx, img, sx, sy, sw, sh, dx, dy, dw, dh) {
    var vertSquashRatio;
    vertSquashRatio = detectVerticalSquash(img);
    return ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh / vertSquashRatio);
  };


  /*
   * contentloaded.js
   *
   * Author: Diego Perini (diego.perini at gmail.com)
   * Summary: cross-browser wrapper for DOMContentLoaded
   * Updated: 20101020
   * License: MIT
   * Version: 1.2
   *
   * URL:
   * http://javascript.nwbox.com/ContentLoaded/
   * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE
   */

  contentLoaded = function(win, fn) {
    var add, doc, done, init, poll, pre, rem, root, top;
    done = false;
    top = true;
    doc = win.document;
    root = doc.documentElement;
    add = (doc.addEventListener ? "addEventListener" : "attachEvent");
    rem = (doc.addEventListener ? "removeEventListener" : "detachEvent");
    pre = (doc.addEventListener ? "" : "on");
    init = function(e) {
      if (e.type === "readystatechange" && doc.readyState !== "complete") {
        return;
      }
      (e.type === "load" ? win : doc)[rem](pre + e.type, init, false);
      if (!done && (done = true)) {
        return fn.call(win, e.type || e);
      }
    };
    poll = function() {
      var e;
      try {
        root.doScroll("left");
      } catch (_error) {
        e = _error;
        setTimeout(poll, 50);
        return;
      }
      return init("poll");
    };
    if (doc.readyState !== "complete") {
      if (doc.createEventObject && root.doScroll) {
        try {
          top = !win.frameElement;
        } catch (_error) {}
        if (top) {
          poll();
        }
      }
      doc[add](pre + "DOMContentLoaded", init, false);
      doc[add](pre + "readystatechange", init, false);
      return win[add](pre + "load", init, false);
    }
  };

  Dropzone._autoDiscoverFunction = function() {
    if (Dropzone.autoDiscover) {
      return Dropzone.discover();
    }
  };

  contentLoaded(window, Dropzone._autoDiscoverFunction);

}).call(this);

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/attributes.js":[function(require,module,exports){
/*
attributes
*/"use strict"

var $       = require("./base")

var trim    = require("mout/string/trim"),
    forEach = require("mout/array/forEach"),
    filter  = require("mout/array/filter"),
    indexOf = require("mout/array/indexOf")

// attributes

$.implement({

    setAttribute: function(name, value){
        return this.forEach(function(node){
            node.setAttribute(name, value)
        })
    },

    getAttribute: function(name){
        var attr = this[0].getAttributeNode(name)
        return (attr && attr.specified) ? attr.value : null
    },

    hasAttribute: function(name){
        var node = this[0]
        if (node.hasAttribute) return node.hasAttribute(name)
        var attr = node.getAttributeNode(name)
        return !!(attr && attr.specified)
    },

    removeAttribute: function(name){
        return this.forEach(function(node){
            var attr = node.getAttributeNode(name)
            if (attr) node.removeAttributeNode(attr)
        })
    }

})

var accessors = {}

forEach(["type", "value", "name", "href", "title", "id"], function(name){

    accessors[name] = function(value){
        return (value !== undefined) ? this.forEach(function(node){
            node[name] = value
        }) : this[0][name]
    }

})

// booleans

forEach(["checked", "disabled", "selected"], function(name){

    accessors[name] = function(value){
        return (value !== undefined) ? this.forEach(function(node){
            node[name] = !!value
        }) : !!this[0][name]
    }

})

// className

var classes = function(className){
    var classNames = trim(className).replace(/\s+/g, " ").split(" "),
        uniques    = {}

    return filter(classNames, function(className){
        if (className !== "" && !uniques[className]) return uniques[className] = className
    }).sort()
}

accessors.className = function(className){
    return (className !== undefined) ? this.forEach(function(node){
        node.className = classes(className).join(" ")
    }) : classes(this[0].className).join(" ")
}

// attribute

$.implement({

    attribute: function(name, value){
        var accessor = accessors[name]
        if (accessor) return accessor.call(this, value)
        if (value != null) return this.setAttribute(name, value)
        if (value === null) return this.removeAttribute(name)
        if (value === undefined) return this.getAttribute(name)
    }

})

$.implement(accessors)

// shortcuts

$.implement({

    check: function(){
        return this.checked(true)
    },

    uncheck: function(){
        return this.checked(false)
    },

    disable: function(){
        return this.disabled(true)
    },

    enable: function(){
        return this.disabled(false)
    },

    select: function(){
        return this.selected(true)
    },

    deselect: function(){
        return this.selected(false)
    }

})

// classNames, has / add / remove Class

$.implement({

    classNames: function(){
        return classes(this[0].className)
    },

    hasClass: function(className){
        return indexOf(this.classNames(), className) > -1
    },

    addClass: function(className){
        return this.forEach(function(node){
            var nodeClassName = node.className
            var classNames = classes(nodeClassName + " " + className).join(" ")
            if (nodeClassName !== classNames) node.className = classNames
        })
    },

    removeClass: function(className){
        return this.forEach(function(node){
            var classNames = classes(node.className)
            forEach(classes(className), function(className){
                var index = indexOf(classNames, className)
                if (index > -1) classNames.splice(index, 1)
            })
            node.className = classNames.join(" ")
        })
    },

    toggleClass: function(className, force){
        var add = force !== undefined ? force : !this.hasClass(className)
        if (add)
            this.addClass(className)
        else
            this.removeClass(className)
        return !!add
    }

})

// toString

$.prototype.toString = function(){
    var tag     = this.tag(),
        id      = this.id(),
        classes = this.classNames()

    var str = tag
    if (id) str += '#' + id
    if (classes.length) str += '.' + classes.join(".")
    return str
}

var textProperty = (document.createElement('div').textContent == null) ? 'innerText' : 'textContent'

// tag, html, text, data

$.implement({

    tag: function(){
        return this[0].tagName.toLowerCase()
    },

    html: function(html){
        return (html !== undefined) ? this.forEach(function(node){
            node.innerHTML = html
        }) : this[0].innerHTML
    },

    text: function(text){
        return (text !== undefined) ? this.forEach(function(node){
            node[textProperty] = text
        }) : this[0][textProperty]
    },

    data: function(key, value){
        switch(value) {
            case undefined: return this.getAttribute("data-" + key)
            case null: return this.removeAttribute("data-" + key)
            default: return this.setAttribute("data-" + key, value)
        }
    }

})

module.exports = $

},{"./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/base.js","mout/array/filter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/filter.js","mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/forEach.js","mout/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/indexOf.js","mout/string/trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/trim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/base.js":[function(require,module,exports){
/*
elements
*/"use strict"

var prime   = require("prime")

var forEach = require("mout/array/forEach"),
    map     = require("mout/array/map"),
    filter  = require("mout/array/filter"),
    every   = require("mout/array/every"),
    some    = require("mout/array/some")

// uniqueID

var index = 0,
    __dc = document.__counter,
    counter = document.__counter = (__dc ? parseInt(__dc, 36) + 1 : 0).toString(36),
    key = "uid:" + counter

var uniqueID = function(n){
    if (n === window) return "window"
    if (n === document) return "document"
    if (n === document.documentElement) return "html"
    return n[key] || (n[key] = (index++).toString(36))
}

var instances = {}

// elements prime

var $ = prime({constructor: function $(n, context){

    if (n == null) return (this && this.constructor === $) ? new Elements : null

    var self, uid

    if (n.constructor !== Elements){

        self = new Elements

        if (typeof n === "string"){
            if (!self.search) return null
            self[self.length++] = context || document
            return self.search(n)
        }

        if (n.nodeType || n === window){

            self[self.length++] = n

        } else if (n.length){

            // this could be an array, or any object with a length attribute,
            // including another instance of elements from another interface.

            var uniques = {}

            for (var i = 0, l = n.length; i < l; i++){ // perform elements flattening
                var nodes = $(n[i], context)
                if (nodes && nodes.length) for (var j = 0, k = nodes.length; j < k; j++){
                    var node = nodes[j]
                    uid = uniqueID(node)
                    if (!uniques[uid]){
                        self[self.length++] = node
                        uniques[uid] = true
                    }
                }
            }

        }

    } else {
      self = n
    }

    if (!self.length) return null

    // when length is 1 always use the same elements instance

    if (self.length === 1){
        uid = uniqueID(self[0])
        return instances[uid] || (instances[uid] = self)
    }

    return self

}})

var Elements = prime({

    inherits: $,

    constructor: function Elements(){
        this.length = 0
    },

    unlink: function(){
        return this.map(function(node){
            delete instances[uniqueID(node)]
            return node
        })
    },

    // methods

    forEach: function(method, context){
        forEach(this, method, context)
        return this
    },

    map: function(method, context){
        return map(this, method, context)
    },

    filter: function(method, context){
        return filter(this, method, context)
    },

    every: function(method, context){
        return every(this, method, context)
    },

    some: function(method, context){
        return some(this, method, context)
    }

})

module.exports = $

},{"mout/array/every":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/every.js","mout/array/filter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/filter.js","mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/forEach.js","mout/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/map.js","mout/array/some":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/some.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/delegation.js":[function(require,module,exports){
/*
delegation
*/"use strict"

var Map = require("prime/map")

var $ = require("./events")
        require('./traversal')

$.implement({

    delegate: function(event, selector, handle, useCapture){

        return this.forEach(function(node){

            var self = $(node)

            var delegation = self._delegation || (self._delegation = {}),
                events     = delegation[event] || (delegation[event] = {}),
                map        = (events[selector] || (events[selector] = new Map))

            if (map.get(handle)) return

            var action = function(e){
                var target = $(e.target || e.srcElement),
                    match  = target.matches(selector) ? target : target.parent(selector)

                var res

                if (match) res = handle.call(self, e, match)

                return res
            }

            map.set(handle, action)

            self.on(event, action, useCapture)

        })

    },

    undelegate: function(event, selector, handle, useCapture){

        return this.forEach(function(node){

            var self = $(node), delegation, events, map

            if (!(delegation = self._delegation) || !(events = delegation[event]) || !(map = events[selector])) return;

            var action = map.get(handle)

            if (action){
                self.off(event, action, useCapture)
                map.remove(action)

                // if there are no more handles in a given selector, delete it
                if (!map.count()) delete events[selector]
                // var evc = evd = 0, x
                var e1 = true, e2 = true, x
                for (x in events){
                    e1 = false
                    break
                }
                // if no more selectors in a given event type, delete it
                if (e1) delete delegation[event]
                for (x in delegation){
                    e2 = false
                    break
                }
                // if there are no more delegation events in the element, delete the _delegation object
                if (e2) delete self._delegation
            }

        })

    }

})

module.exports = $

},{"./events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/events.js","./traversal":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/traversal.js","prime/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/map.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/domready.js":[function(require,module,exports){
/*
domready
*/"use strict"

var $ = require("./events")

var readystatechange = 'onreadystatechange' in document,
    shouldPoll       = false,
    loaded           = false,
    readys           = [],
    checks           = [],
    ready            = null,
    timer            = null,
    test             = document.createElement('div'),
    doc              = $(document),
    win              = $(window)

var domready = function(){

    if (timer) timer = clearTimeout(timer)

    if (!loaded){

        if (readystatechange) doc.off('readystatechange', check)
        doc.off('DOMContentLoaded', domready)
        win.off('load', domready)

        loaded = true

        for (var i = 0; ready = readys[i++];) ready()
    }

    return loaded

}

var check = function(){
    for (var i = checks.length; i--;) if (checks[i]()) return domready()
    return false
}

var poll = function(){
    clearTimeout(timer)
    if (!check()) timer = setTimeout(poll, 1e3 / 60)
}

if (document.readyState){ // use readyState if available

    var complete = function(){
        return !!(/loaded|complete/).test(document.readyState)
    }

    checks.push(complete)

    if (!complete()){ // unless dom is already loaded
        if (readystatechange) doc.on('readystatechange', check) // onreadystatechange event
        else shouldPoll = true //or poll readyState check
    } else { // dom is already loaded
        domready()
    }

}

if (test.doScroll){ // also use doScroll if available (doscroll comes before readyState "complete")

    // LEGAL DEPT:
    // doScroll technique discovered by, owned by, and copyrighted to Diego Perini http://javascript.nwbox.com/IEContentLoaded/

    // testElement.doScroll() throws when the DOM is not ready, only in the top window

    var scrolls = function(){
        try {
            test.doScroll()
            return true
        } catch (e){}
        return false
    }

    // If doScroll works already, it can't be used to determine domready
    // e.g. in an iframe

    if (!scrolls()){
        checks.push(scrolls)
        shouldPoll = true
    }

}

if (shouldPoll) poll()

// make sure that domready fires before load, also if not onreadystatechange and doScroll and DOMContentLoaded load will fire
doc.on('DOMContentLoaded', domready)
win.on('load', domready)

module.exports = function(ready){
    (loaded) ? ready() : readys.push(ready)
    return null
}

},{"./events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/events.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/events.js":[function(require,module,exports){
/*
events
*/"use strict"

var Emitter = require("prime/emitter")

var $ = require("./base")

var html = document.documentElement

var addEventListener = html.addEventListener ? function(node, event, handle, useCapture){
    node.addEventListener(event, handle, useCapture || false)
    return handle
} : function(node, event, handle){
    node.attachEvent('on' + event, handle)
    return handle
}

var removeEventListener = html.removeEventListener ? function(node, event, handle, useCapture){
    node.removeEventListener(event, handle, useCapture || false)
} : function(node, event, handle){
    node.detachEvent("on" + event, handle)
}

$.implement({

    on: function(event, handle, useCapture){

        return this.forEach(function(node){
            var self = $(node)

            var internalEvent = event + (useCapture ? ":capture" : "")

            Emitter.prototype.on.call(self, internalEvent, handle)

            var domListeners = self._domListeners || (self._domListeners = {})
            if (!domListeners[internalEvent]) domListeners[internalEvent] = addEventListener(node, event, function(e){
                Emitter.prototype.emit.call(self, internalEvent, e || window.event, Emitter.EMIT_SYNC)
            }, useCapture)
        })
    },

    off: function(event, handle, useCapture){

        return this.forEach(function(node){

            var self = $(node)

            var internalEvent = event + (useCapture ? ":capture" : "")

            var domListeners = self._domListeners, domEvent, listeners = self._listeners, events

            if (domListeners && (domEvent = domListeners[internalEvent]) && listeners && (events = listeners[internalEvent])){

                Emitter.prototype.off.call(self, internalEvent, handle)

                if (!self._listeners || !self._listeners[event]){
                    removeEventListener(node, event, domEvent)
                    delete domListeners[event]

                    for (var l in domListeners) return
                    delete self._domListeners
                }

            }
        })
    },

    emit: function(){
        var args = arguments
        return this.forEach(function(node){
            Emitter.prototype.emit.apply($(node), args)
        })
    }

})

module.exports = $

},{"./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/base.js","prime/emitter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/index.js":[function(require,module,exports){
/*
elements
*/"use strict"

var $ = require("./base")
        require("./attributes")
        require("./events")
        require("./insertion")
        require("./traversal")
        require("./delegation")

module.exports = $

},{"./attributes":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/attributes.js","./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/base.js","./delegation":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/delegation.js","./events":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/events.js","./insertion":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/insertion.js","./traversal":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/traversal.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/insertion.js":[function(require,module,exports){
/*
insertion
*/"use strict"

var $ = require("./base")

// base insertion

$.implement({

    appendChild: function(child){
        this[0].appendChild($(child)[0])
        return this
    },

    insertBefore: function(child, ref){
        this[0].insertBefore($(child)[0], $(ref)[0])
        return this
    },

    removeChild: function(child){
        this[0].removeChild($(child)[0])
        return this
    },

    replaceChild: function(child, ref){
        this[0].replaceChild($(child)[0], $(ref)[0])
        return this
    }

})

// before, after, bottom, top

$.implement({

    before: function(element){
        element = $(element)[0]
        var parent = element.parentNode
        if (parent) this.forEach(function(node){
            parent.insertBefore(node, element)
        })
        return this
    },

    after: function(element){
        element = $(element)[0]
        var parent = element.parentNode
        if (parent) this.forEach(function(node){
            parent.insertBefore(node, element.nextSibling)
        })
        return this
    },

    bottom: function(element){
        element = $(element)[0]
        return this.forEach(function(node){
            element.appendChild(node)
        })
    },

    top: function(element){
        element = $(element)[0]
        return this.forEach(function(node){
            element.insertBefore(node, element.firstChild)
        })
    }

})

// insert, replace

$.implement({

    insert: $.prototype.bottom,

    remove: function(){
        return this.forEach(function(node){
            var parent = node.parentNode
            if (parent) parent.removeChild(node)
        })
    },

    replace: function(element){
        element = $(element)[0]
        element.parentNode.replaceChild(this[0], element)
        return this
    }

})

module.exports = $

},{"./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/base.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/every.js":[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Array every
     */
    function every(arr, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result = true;
        if (arr == null) {
            return result;
        }

        var i = -1, len = arr.length;
        while (++i < len) {
            // we iterate over sparse items since there is no way to make it
            // work properly on IE 7-8. see #64
            if (!callback(arr[i], i, arr) ) {
                result = false;
                break;
            }
        }

        return result;
    }

    module.exports = every;


},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/filter.js":[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Array filter
     */
    function filter(arr, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var results = [];
        if (arr == null) {
            return results;
        }

        var i = -1, len = arr.length, value;
        while (++i < len) {
            value = arr[i];
            if (callback(value, i, arr)) {
                results.push(value);
            }
        }

        return results;
    }

    module.exports = filter;



},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/forEach.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/forEach.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/indexOf.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/indexOf.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/map.js":[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Array map
     */
    function map(arr, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var results = [];
        if (arr == null){
            return results;
        }

        var i = -1, len = arr.length;
        while (++i < len) {
            results[i] = callback(arr[i], i, arr);
        }

        return results;
    }

     module.exports = map;


},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/some.js":[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Array some
     */
    function some(arr, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result = false;
        if (arr == null) {
            return result;
        }

        var i = -1, len = arr.length;
        while (++i < len) {
            // we iterate over sparse items since there is no way to make it
            // work properly on IE 7-8. see #64
            if ( callback(arr[i], i, arr) ) {
                result = true;
                break;
            }
        }

        return result;
    }

    module.exports = some;


},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/identity.js":[function(require,module,exports){


    /**
     * Returns the first argument provided to it.
     */
    function identity(val){
        return val;
    }

    module.exports = identity;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/makeIterator_.js":[function(require,module,exports){
var identity = require('./identity');
var prop = require('./prop');
var deepMatches = require('../object/deepMatches');

    /**
     * Converts argument into a valid iterator.
     * Used internally on most array/object/collection methods that receives a
     * callback/iterator providing a shortcut syntax.
     */
    function makeIterator(src, thisObj){
        if (src == null) {
            return identity;
        }
        switch(typeof src) {
            case 'function':
                // function is the first to improve perf (most common case)
                // also avoid using `Function#call` if not needed, which boosts
                // perf a lot in some cases
                return (typeof thisObj !== 'undefined')? function(val, i, arr){
                    return src.call(thisObj, val, i, arr);
                } : src;
            case 'object':
                return function(val){
                    return deepMatches(val, src);
                };
            case 'string':
            case 'number':
                return prop(src);
        }
    }

    module.exports = makeIterator;



},{"../object/deepMatches":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/deepMatches.js","./identity":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/identity.js","./prop":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/prop.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/prop.js":[function(require,module,exports){


    /**
     * Returns a function that gets a property of the passed object
     */
    function prop(name){
        return function(obj){
            return obj[name];
        };
    }

    module.exports = prop;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/isArray.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isArray.js"][0].apply(exports,arguments)
},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/isKind.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isKind.js"][0].apply(exports,arguments)
},{"./kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/kindOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/kindOf.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/kindOf.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/toString.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/toString.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/deepMatches.js":[function(require,module,exports){
var forOwn = require('./forOwn');
var isArray = require('../lang/isArray');

    function containsMatch(array, pattern) {
        var i = -1, length = array.length;
        while (++i < length) {
            if (deepMatches(array[i], pattern)) {
                return true;
            }
        }

        return false;
    }

    function matchArray(target, pattern) {
        var i = -1, patternLength = pattern.length;
        while (++i < patternLength) {
            if (!containsMatch(target, pattern[i])) {
                return false;
            }
        }

        return true;
    }

    function matchObject(target, pattern) {
        var result = true;
        forOwn(pattern, function(val, key) {
            if (!deepMatches(target[key], val)) {
                // Return false to break out of forOwn early
                return (result = false);
            }
        });

        return result;
    }

    /**
     * Recursively check if the objects match.
     */
    function deepMatches(target, pattern){
        if (target && typeof target === 'object') {
            if (isArray(target) && isArray(pattern)) {
                return matchArray(target, pattern);
            } else {
                return matchObject(target, pattern);
            }
        } else {
            return target === pattern;
        }
    }

    module.exports = deepMatches;



},{"../lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/isArray.js","./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/forIn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forIn.js"][0].apply(exports,arguments)
},{"./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/forOwn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forOwn.js"][0].apply(exports,arguments)
},{"./forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/forIn.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/hasOwn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/hasOwn.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/WHITE_SPACES.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/WHITE_SPACES.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/ltrim.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/ltrim.js"][0].apply(exports,arguments)
},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/WHITE_SPACES.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/rtrim.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/rtrim.js"][0].apply(exports,arguments)
},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/WHITE_SPACES.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/trim.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/trim.js"][0].apply(exports,arguments)
},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/WHITE_SPACES.js","./ltrim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/ltrim.js","./rtrim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/string/rtrim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/traversal.js":[function(require,module,exports){
/*
traversal
*/"use strict"

var map = require("mout/array/map")

var slick = require("slick")

var $ = require("./base")

var gen = function(combinator, expression){
    return map(slick.parse(expression || "*"), function(part){
        return combinator + " " + part
    }).join(", ")
}

var push_ = Array.prototype.push

$.implement({

    search: function(expression){
        if (this.length === 1) return $(slick.search(expression, this[0], new $))

        var buffer = []
        for (var i = 0, node; node = this[i]; i++) push_.apply(buffer, slick.search(expression, node))
        buffer = $(buffer)
        return buffer && buffer.sort()
    },

    find: function(expression){
        if (this.length === 1) return $(slick.find(expression, this[0]))

        for (var i = 0, node; node = this[i]; i++) {
            var found = slick.find(expression, node)
            if (found) return $(found)
        }

        return null
    },

    sort: function(){
        return slick.sort(this)
    },

    matches: function(expression){
        return slick.matches(this[0], expression)
    },

    contains: function(node){
        return slick.contains(this[0], node)
    },

    nextSiblings: function(expression){
        return this.search(gen('~', expression))
    },

    nextSibling: function(expression){
        return this.find(gen('+', expression))
    },

    previousSiblings: function(expression){
        return this.search(gen('!~', expression))
    },

    previousSibling: function(expression){
        return this.find(gen('!+', expression))
    },

    children: function(expression){
        return this.search(gen('>', expression))
    },

    firstChild: function(expression){
        return this.find(gen('^', expression))
    },

    lastChild: function(expression){
        return this.find(gen('!^', expression))
    },

    parent: function(expression){
        var buffer = []
        loop: for (var i = 0, node; node = this[i]; i++) while ((node = node.parentNode) && (node !== document)){
            if (!expression || slick.matches(node, expression)){
                buffer.push(node)
                break loop
                break
            }
        }
        return $(buffer)
    },

    parents: function(expression){
        var buffer = []
        for (var i = 0, node; node = this[i]; i++) while ((node = node.parentNode) && (node !== document)){
            if (!expression || slick.matches(node, expression)) buffer.push(node)
        }
        return $(buffer)
    }

})

module.exports = $

},{"./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/base.js","mout/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/map.js","slick":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/zen.js":[function(require,module,exports){
/*
zen
*/"use strict"

var forEach = require("mout/array/forEach"),
    map     = require("mout/array/map")

var parse = require("slick/parser")

var $ = require("./base")

module.exports = function(expression, doc){

    return $(map(parse(expression), function(expression){

        var previous, result

        forEach(expression, function(part, i){

            var node = (doc || document).createElement(part.tag)

            if (part.id) node.id = part.id

            if (part.classList) node.className = part.classList.join(" ")

            if (part.attributes) forEach(part.attributes, function(attribute){
                node.setAttribute(attribute.name, attribute.value || "")
            })

            if (part.pseudos) forEach(part.pseudos, function(pseudo){
                var n = $(node), method = n[pseudo.name]
                if (method) method.call(n, pseudo.value)
            })

            if (i === 0){

                result = node

            } else if (part.combinator === " "){

                previous.appendChild(node)

            } else if (part.combinator === "+"){
                var parentNode = previous.parentNode
                if (parentNode) parentNode.appendChild(node)
            }

            previous = node

        })

        return result

    }))

}

},{"./base":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/base.js","mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/forEach.js","mout/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/map.js","slick/parser":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/parser.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/index.js":[function(require,module,exports){
/*          .-   3
.-.-..-..-.-|-._.
' ' '`-'`-' ' ' '
*/"use strict"

// color and timer
var color = require("./lib/color"),
    frame = require("./lib/frame")

// if we're in a browser we need ./browser, otherwise ./fx
var moofx = (typeof document !== "undefined") ? require("./lib/browser") : require("./lib/fx")

moofx.requestFrame = function(callback){
    frame.request(callback)
    return this
}

moofx.cancelFrame = function(callback){
    frame.cancel(callback)
    return this
}

moofx.color = color

// and export moofx

module.exports = moofx

},{"./lib/browser":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/browser.js","./lib/color":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/color.js","./lib/frame":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/frame.js","./lib/fx":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/fx.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/browser.js":[function(require,module,exports){
(function (global){
/*
MooFx
*/"use strict"

// requires

var color  = require("./color"),
    frame  = require("./frame")

var cancelFrame = frame.cancel,
    requestFrame = frame.request

var prime  = require("prime")

var camelize        = require("prime/string/camelize"),
    clean           = require("prime/string/clean"),
    capitalize      = require("prime/string/capitalize"),
    hyphenateString = require("prime/string/hyphenate")

var map     = require("prime/array/map"),
    forEach = require("prime/array/forEach"),
    indexOf = require("prime/array/indexOf")

var elements = require("elements")

var fx = require("./fx")

// util

var matchString = function(s, r){
    return String.prototype.match.call(s, r);
}

var hyphenated = {}
var hyphenate = function(self){
    return hyphenated[self] || (hyphenated[self] = hyphenateString(self))
}

var round = function(n){
    return Math.round(n * 1e3) / 1e3
}

// compute > node > property

var compute = global.getComputedStyle ? function(node){
    var cts = getComputedStyle(node, null)
    return function(property){
        return cts ? cts.getPropertyValue(hyphenate(property)) : ""
    }
} : /*(css3)?*/function(node){
    var cts = node.currentStyle
    return function(property){
        return cts ? cts[camelize(property)] : ""
    }
}/*:null*/

// pixel ratio retriever

var test = document.createElement("div")

var cssText = "border:none;margin:none;padding:none;visibility:hidden;position:absolute;height:0;";

// returns the amount of pixels that takes to make one of the unit

var pixelRatio = function(element, u){
    var parent = element.parentNode, ratio = 1
    if (parent){
        test.style.cssText = cssText + ("width:100" + u + ";")
        parent.appendChild(test)
        ratio = test.offsetWidth / 100
        parent.removeChild(test)
    }
    return ratio
}

// mirror 4 values

var mirror4 = function(values){
    var length = values.length
    if      (length === 1) values.push(values[0], values[0], values[0])
    else if (length === 2) values.push(values[0], values[1])
    else if (length === 3) values.push(values[1])
    return values
}

// regular expressions strings

var sLength      = "([-.\\d]+)(%|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vm)",
    sLengthNum   = sLength + "?",
    sBorderStyle = "none|hidden|dotted|dashed|solid|double|groove|ridge|inset|outset|inherit"

// regular expressions

var rgLength     = RegExp(sLength, "g"),
    rLengthNum   = RegExp(sLengthNum),
    rgLengthNum  = RegExp(sLengthNum, "g"),
    rBorderStyle = RegExp(sBorderStyle)

// normalize > css

var parseString = function(value){
    return (value == null) ? "" : value + ""
}

var parseOpacity = function(value, normalize){
    if (value == null || value === "") return normalize ? "1" : ""
    return (isFinite((value = +value))) ? (value < 0 ? "0" : value + "") : "1"
}

try {test.style.color = "rgba(0,0,0,0.5)"} catch(e){}
var rgba = /^rgba/.test(test.style.color)

var parseColor = function(value, normalize){
    var black = "rgba(0,0,0,1)", c
    if (!value || !(c = color(value, true))) return normalize ? black : ""
    if (normalize) return "rgba(" + c + ")"

    var alpha = c[3]
    if (alpha === 0) return "transparent"
    return (!rgba || alpha === 1) ? "rgb(" + c.slice(0, 3) + ")" : "rgba(" + c + ")"
}

var parseLength = function(value, normalize){
    if (value == null || value === "") return normalize ? "0px" : ""
    var match = matchString(value, rLengthNum)
    return match ? match[1] + (match[2] || "px") : value // cannot be parsed. probably "auto"
}

var parseBorderStyle = function(value, normalize){
    if (value == null || value === "") return normalize ? "none" : ""
    var match = value.match(rBorderStyle)
    return match ? value : normalize ? "none" : ""
}

var parseBorder = function(value, normalize){
    var normalized = "0px none rgba(0,0,0,1)"
    if (value == null || value === "")     return normalize ? normalized : ""
    if (value === 0   || value === "none") return normalize ? normalized : value + ""

    var c
    value = value.replace(color.x, function(match){
        c = match
        return ""
    })

    var s = value.match(rBorderStyle),
        l = value.match(rgLengthNum)

    return clean([
        parseLength(l ? l[0] : "", normalize),
        parseBorderStyle(s ? s[0] : "", normalize),
        parseColor(c, normalize)
    ].join(" "))
}

var parseShort4 = function(value, normalize){
    if (value == null || value === "") return normalize ? "0px 0px 0px 0px" : ""
    return clean(mirror4(map(clean(value).split(" "), function(v){
        return parseLength(v, normalize)
    })).join(" "))
}

var parseShadow = function(value, normalize, len){
    var transparent = "rgba(0,0,0,0)",
        normalized  = (len === 3) ? transparent + " 0px 0px 0px" : transparent + " 0px 0px 0px 0px"

    if (value ==  null || value === "") return normalize ? normalized : ""
    if (value === "none") return normalize ? normalized : value

    var colors = [], value = clean(value).replace(color.x, function(match){
        colors.push(match)
        return ""
    })

    return map(value.split(","), function(shadow, i){

        var c       = parseColor(colors[i], normalize),
            inset   = /inset/.test(shadow),
            lengths = shadow.match(rgLengthNum) || ["0px"]

        lengths = map(lengths, function(m){
            return parseLength(m, normalize)
        })

        while (lengths.length < len) lengths.push("0px")

        var ret = inset ? ["inset", c] : [c]

        return ret.concat(lengths).join(" ")

    }).join(", ")
}

var parse = function(value, normalize){
    if (value == null || value === "") return "" // cant normalize "" || null
    return value.replace(color.x, function(match){
        return parseColor(match, normalize)
    }).replace(rgLength, function(match){
        return parseLength(match, normalize)
    })
}

// get && set

var getters = {}, setters = {}, parsers = {}, aliases = {}

var getter = function(key){
    return getters[key] || (getters[key] = (function(){
        var alias  = aliases[key] || key,
            parser = parsers[key] || parse

        return function(){
            return parser(compute(this)(alias), true)
        }

    }()))
}

var setter = function(key){
    return setters[key] || (setters[key] = (function(){

        var alias  = aliases[key] || key,
            parser = parsers[key] || parse

        return function(value){
            this.style[alias] = parser(value, false)
        }

    }()))
}

// parsers

var trbl = ["Top", "Right", "Bottom", "Left"], tlbl = ["TopLeft", "TopRight", "BottomRight", "BottomLeft"]

forEach(trbl, function(d){
    var bd = "border" + d
    forEach([ "margin" + d, "padding" + d, bd + "Width", d.toLowerCase()], function(n){
        parsers[n] = parseLength
    })
    parsers[bd + "Color"] = parseColor
    parsers[bd + "Style"] = parseBorderStyle

    // borderDIR
    parsers[bd] = parseBorder
    getters[bd] = function(){
        return [
            getter(bd + "Width").call(this),
            getter(bd + "Style").call(this),
            getter(bd + "Color").call(this)
        ].join(" ")
    }
})

forEach(tlbl, function(d){
    parsers["border" + d + "Radius"] = parseLength
})

parsers.color = parsers.backgroundColor = parseColor
parsers.width = parsers.height = parsers.minWidth = parsers.minHeight = parsers.maxWidth = parsers.maxHeight = parsers.fontSize = parsers.backgroundSize = parseLength

// margin + padding

forEach(["margin", "padding"], function(name){
    parsers[name] = parseShort4
    getters[name] = function(){
        return map(trbl, function(d){
            return getter(name + d).call(this)
        }, this).join(" ")
    }
})

// borders

// borderDIRWidth, borderDIRStyle, borderDIRColor

parsers.borderWidth = parseShort4

parsers.borderStyle = function(value, normalize){
    if (value == null || value === "") return normalize ? mirror4(["none"]).join(" ") : ""
    value = clean(value).split(" ")
    return clean(mirror4(map(value, function(v){
        parseBorderStyle(v, normalize)
    })).join(" "))
}

parsers.borderColor = function(value, normalize){
    if (!value || !(value = matchString(value, color.x))) return normalize ? mirror4(["rgba(0,0,0,1)"]).join(" ") : ""
    return clean(mirror4(map(value, function(v){
        return parseColor(v, normalize)
    })).join(" "))
}

forEach(["Width", "Style", "Color"], function(name){
    getters["border" + name] = function(){
        return map(trbl, function(d){
            return getter("border" + d + name).call(this)
        }, this).join(" ")
    }
})

// borderRadius

parsers.borderRadius = parseShort4

getters.borderRadius = function(){
    return map(tlbl, function(d){
        return getter("border" + d + "Radius").call(this)
    }, this).join(" ")
}

// border

parsers.border = parseBorder

getters.border = function(){
    var pvalue
    for (var i = 0; i < trbl.length; i++){
        var value = getter("border" + trbl[i]).call(this)
        if (pvalue && value !== pvalue) return null
        pvalue = value
    }
    return pvalue
}

// zIndex

parsers.zIndex = parseString

// opacity

parsers.opacity = parseOpacity

/*(css3)?*/

var filterName = (test.style.MsFilter != null && "MsFilter") || (test.style.filter != null && "filter")

if (filterName && test.style.opacity == null){

    var matchOp = /alpha\(opacity=([\d.]+)\)/i

    setters.opacity = function(value){
        value = ((value = parseOpacity(value)) === "1") ? "" : "alpha(opacity=" + Math.round(value * 100) + ")"
        var filter = compute(this)(filterName)
        return this.style[filterName] = matchOp.test(filter) ? filter.replace(matchOp, value) : filter + " " + value
    }

    getters.opacity = function(){
        var match = compute(this)(filterName).match(matchOp)
        return (!match ? 1 : match[1] / 100) + ""
    }

}/*:*/

var parseBoxShadow = parsers.boxShadow = function(value, normalize){
    return parseShadow(value, normalize, 4)
}

var parseTextShadow = parsers.textShadow = function(value, normalize){
    return parseShadow(value, normalize, 3)
}

// Aliases

forEach(['Webkit', "Moz", "ms", "O", null], function(prefix){
    forEach([
        "transition", "transform", "transformOrigin", "transformStyle", "perspective", "perspectiveOrigin", "backfaceVisibility"
    ], function(style){
        var cc = prefix ? prefix + capitalize(style) : style
        if (prefix === "ms") hyphenated[cc] = "-ms-" + hyphenate(style)
        if (test.style[cc] != null) aliases[style] = cc
    })
})

var transitionName = aliases.transition,
    transformName  = aliases.transform

// manually disable css3 transitions in Opera, because they do not work properly.

if (transitionName === "OTransition") transitionName = null


// this takes care of matrix decomposition on browsers that support only 2d transforms but no CSS3 transitions.
// basically, IE9 (and Opera as well, since we disabled CSS3 transitions manually)

var parseTransform2d, Transform2d

/*(css3)?*/

if (!transitionName && transformName) (function(){

    var unmatrix = require("./unmatrix2d")

    var v = "\\s*([-\\d\\w.]+)\\s*"

    var rMatrix = RegExp("matrix\\(" + [v, v, v, v, v, v] + "\\)")

    var decomposeMatrix = function(matrix){

        var d = unmatrix.apply(null, matrix.match(rMatrix).slice(1)) || [[0, 0], 0, 0, [0, 0]]

        return [

            "translate(" + map(d[0], function(v){return round(v) + "px"}) + ")",
            "rotate(" + round(d[1] * 180 / Math.PI) + "deg)",
            "skewX(" + round(d[2] * 180 / Math.PI) + "deg)",
            "scale(" + map(d[3], round) + ")"

        ].join(" ")

    }

    var def0px  = function(value){return value || "0px"},
        def1    = function(value){return value || "1"},
        def0deg = function(value){return value || "0deg"}

    var transforms = {

        translate: function(value){
            if (!value) value = "0px,0px"
            var values = value.split(",")
            if (!values[1]) values[1] = "0px"
            return map(values, clean) + ""
        },
        translateX: def0px,
        translateY: def0px,
        scale: function(value){
            if (!value) value = "1,1"
            var values = value.split(",")
            if (!values[1]) values[1] = values[0]
            return map(values, clean) + ""
        },
        scaleX: def1,
        scaleY: def1,
        rotate: def0deg,
        skewX: def0deg,
        skewY: def0deg

    }

    Transform2d = prime({

        constructor: function(transform){

            var names = this.names = []
            var values = this.values = []

            transform.replace(/(\w+)\(([-.\d\s\w,]+)\)/g, function(match, name, value){
                names.push(name)
                values.push(value)
            })

        },

        identity: function(){
            var functions = []
            forEach(this.names, function(name){
                var fn = transforms[name]
                if (fn) functions.push(name + "(" + fn() + ")")
            })
            return functions.join(" ")
        },

        sameType: function(transformObject){
            return this.names.toString() === transformObject.names.toString()
        },

        // this is, basically, cheating.
        // retrieving the matrix value from the dom, rather than calculating it

        decompose: function(){
            var transform = this.toString()

            test.style.cssText = cssText + hyphenate(transformName) + ":" + transform + ";"
            document.body.appendChild(test)
            var m = compute(test)(transformName)
            if (!m || m === "none") m = "matrix(1, 0, 0, 1, 0, 0)"
            document.body.removeChild(test)
            return decomposeMatrix(m)
        }

    })

    Transform2d.prototype.toString = function(clean){
        var values = this.values, functions = []
        forEach(this.names, function(name, i){
            var fn = transforms[name]
            if (!fn) return
            var value = fn(values[i])
            if (!clean || value !== fn()) functions.push(name + "(" + value + ")")
        })
        return functions.length ? functions.join(" ") : "none"
    }

    Transform2d.union = function(from, to){

        if (from === to) return // nothing to do

        var fromMap, toMap

        if (from === "none"){

            toMap   = new Transform2d(to)
            to      = toMap.toString()
            from    = toMap.identity()
            fromMap = new Transform2d(from)

        } else if (to === "none"){

            fromMap = new Transform2d(from)
            from    = fromMap.toString()
            to      = fromMap.identity()
            toMap   = new Transform2d(to)

        } else {

            fromMap = new Transform2d(from)
            from    = fromMap.toString()
            toMap   = new Transform2d(to)
            to      = toMap.toString()

        }

        if (from === to) return // nothing to do

        if (!fromMap.sameType(toMap)){

            from = fromMap.decompose()
            to   = toMap.decompose()

        }

        if (from === to) return // nothing to do

        return [from, to]

    }

    // this parser makes sure it never gets "matrix"

    parseTransform2d = parsers.transform = function(transform){
        if (!transform || transform === "none") return "none"
        return new Transform2d(rMatrix.test(transform) ? decomposeMatrix(transform) : transform).toString(true)
    }

    // this getter makes sure we read from the dom only the first time
    // this way we save the actual transform and not "matrix"
    // setting matrix() will use parseTransform2d as well, thus setting the decomposed matrix

    getters.transform = function(){
        var s = this.style
        return s[transformName] || (s[transformName] = parseTransform2d(compute(this)(transformName)))
    }


})()/*:*/

// tries to match from and to values

var prepare = function(node, property, to){

    var parser = parsers[property] || parse,
        from   = getter(property).call(node), // "normalized" by the getter
        to     = parser(to, true) // normalize parsed property

    if (from === to) return

    if (parser === parseLength || parser === parseBorder || parser === parseShort4){

        var toAll = to.match(rgLength), i = 0 // this should always match something

        if (toAll) from = from.replace(rgLength, function(fromFull, fromValue, fromUnit){

            var toFull    = toAll[i++],
                toMatched = toFull.match(rLengthNum),
                toUnit    = toMatched[2]

            if (fromUnit !== toUnit){
                var fromPixels = (fromUnit === "px") ? fromValue : pixelRatio(node, fromUnit) * fromValue
                return round(fromPixels / pixelRatio(node, toUnit)) + toUnit
            }

            return fromFull

        })

        if (i > 0) setter(property).call(node, from)

    }/*(css3)?*/else if (parser === parseTransform2d){ // IE9/Opera

        return Transform2d.union(from, to)

    }/*:*/

    return (from !== to) ? [from, to] : null

}

// BrowserAnimation

var BrowserAnimation = prime({

    inherits: fx,

    constructor: function BrowserAnimation(node, property){

        var _getter = getter(property),
            _setter = setter(property)

        this.get = function(){
            return _getter.call(node)
        }

        this.set = function(value){
            return _setter.call(node, value)
        }

        BrowserAnimation.parent.constructor.call(this, this.set)

        this.node = node
        this.property = property

    }

})

var JSAnimation

/*(css3)?*/

JSAnimation = prime({

    inherits: BrowserAnimation,

    constructor: function JSAnimation(){
        return JSAnimation.parent.constructor.apply(this, arguments)
    },

    start: function(to){

        this.stop()

        if (this.duration === 0){
            this.cancel(to)
            return this
        }

        var fromTo = prepare(this.node, this.property, to)

        if (!fromTo){
            this.cancel(to)
            return this
        }

        JSAnimation.parent.start.apply(this, fromTo)

        if (!this.cancelStep) return this

        // the animation would have started but we need additional checks

        var parser = parsers[this.property] || parse

        // complex interpolations JSAnimation can't handle
        // even CSS3 animation gracefully fail with some of those edge cases
        // other "simple" properties, such as `border` can have different templates
        // because of string properties like "solid" and "dashed"

        if ((parser === parseBoxShadow || parser === parseTextShadow || parser === parse) &&
            (this.templateFrom !== this.templateTo)){
                this.cancelStep()
                delete this.cancelStep
                this.cancel(to)
        }

        return this
    },

    parseEquation: function(equation){
        if (typeof equation === "string") return JSAnimation.parent.parseEquation.call(this, equation)
    }


})/*:*/

// CSSAnimation

var remove3 = function(value, a, b, c){
    var index = indexOf(a, value)
    if (index !== -1){
        a.splice(index, 1)
        b.splice(index, 1)
        c.splice(index, 1)
    }
}

var CSSAnimation = prime({

    inherits: BrowserAnimation,

    constructor: function CSSAnimation(node, property){
        CSSAnimation.parent.constructor.call(this, node, property)

        this.hproperty = hyphenate(aliases[property] || property)

        var self = this

        this.bSetTransitionCSS = function(time){
            self.setTransitionCSS(time)
        }

        this.bSetStyleCSS = function(time){
            self.setStyleCSS(time)
        }

        this.bComplete = function(){
            self.complete()
        }
    },

    start: function(to){

        this.stop()

        if (this.duration === 0){
            this.cancel(to)
            return this
        }

        var fromTo = prepare(this.node, this.property, to)

        if (!fromTo){
            this.cancel(to)
            return this
        }

        this.to = fromTo[1]
        // setting transition styles immediately will make good browsers behave weirdly
        // because DOM changes are always deferred, so we requestFrame
        this.cancelSetTransitionCSS = requestFrame(this.bSetTransitionCSS)

        return this
    },

    setTransitionCSS: function(time){
        delete this.cancelSetTransitionCSS
        this.resetCSS(true)
        // firefox flickers if we set css for transition as well as styles at the same time
        // so, other than deferring transition styles we defer actual styles as well on a requestFrame
        this.cancelSetStyleCSS = requestFrame(this.bSetStyleCSS)
    },

    setStyleCSS: function(time){
        delete this.cancelSetStyleCSS
        var duration = this.duration
        // we use setTimeout instead of transitionEnd because some browsers (looking at you foxy)
        // incorrectly set event.propertyName, so we cannot check which animation we are canceling
        this.cancelComplete = setTimeout(this.bComplete, duration)
        this.endTime = time + duration
        this.set(this.to)
    },

    complete: function(){
        delete this.cancelComplete
        this.resetCSS()
        this.callback(this.endTime)
    },

    stop: function(hard){
        if (this.cancelExit){
            this.cancelExit()
            delete this.cancelExit
        } else if (this.cancelSetTransitionCSS){
            // if cancelSetTransitionCSS is set, means nothing is set yet
            this.cancelSetTransitionCSS() //so we cancel and we're good
            delete this.cancelSetTransitionCSS
        } else if (this.cancelSetStyleCSS){
            // if cancelSetStyleCSS is set, means transition css has been set, but no actual styles.
            this.cancelSetStyleCSS()
            delete this.cancelSetStyleCSS
            // if its a hard stop (and not another start on top of the current animation)
            // we need to reset the transition CSS
            if (hard) this.resetCSS()
        } else if (this.cancelComplete){
            // if cancelComplete is set, means style and transition css have been set, not yet completed.
            clearTimeout(this.cancelComplete)
            delete this.cancelComplete
            // if its a hard stop (and not another start on top of the current animation)
            // we need to reset the transition CSS set the current animation styles
            if (hard){
                this.resetCSS()
                this.set(this.get())
            }
        }
        return this
    },

    resetCSS: function(inclusive){
        var rules      = compute(this.node),
            properties = (rules(transitionName + "Property").replace(/\s+/g, "") || "all").split(","),
            durations  = (rules(transitionName + "Duration").replace(/\s+/g, "") || "0s").split(","),
            equations  = (rules(transitionName + "TimingFunction").replace(/\s+/g, "") || "ease").match(/cubic-bezier\([\d-.,]+\)|([a-z-]+)/g)

        remove3("all",          properties, durations, equations)
        remove3(this.hproperty, properties, durations, equations)

        if (inclusive){
            properties.push(this.hproperty)
            durations.push(this.duration + "ms")
            equations.push("cubic-bezier(" + this.equation + ")")
        }

        var nodeStyle = this.node.style

        nodeStyle[transitionName + "Property"]       = properties
        nodeStyle[transitionName + "Duration"]       = durations
        nodeStyle[transitionName + "TimingFunction"] = equations
    },

    parseEquation: function(equation){
        if (typeof equation === "string") return CSSAnimation.parent.parseEquation.call(this, equation, true)
    }

})

// elements methods

var BaseAnimation = transitionName ? CSSAnimation : JSAnimation

var moofx = function(x, y){
    return (typeof x === "function") ? fx(x) : elements(x, y)
}

elements.implement({

    // {properties}, options or
    // property, value options
    animate: function(A, B, C){

        var styles = A, options = B

        if (typeof A === "string"){
            styles = {}
            styles[A] = B
            options = C
        }

        if (options == null) options = {}

        var type = typeof options

        options = type === "function" ? {
            callback: options
        } : (type === "string" || type === "number") ? {
            duration: options
        } : options

        var callback  = options.callback || function(){},
            completed = 0,
            length    = 0

        options.callback = function(t){
            if (++completed === length) callback(t)
        }

        for (var property in styles){

            var value    = styles[property],
                property = camelize(property)

            this.forEach(function(node){
                length++
                var self = elements(node), anims = self._animations || (self._animations = {})
                var anim  = anims[property] || (anims[property] = new BaseAnimation(node, property))
                anim.setOptions(options).start(value)
            })
        }

        return this

    },

    // {properties} or
    // property, value
    style: function(A, B){

        var styles = A

        if (typeof A === "string"){
            styles = {}
            styles[A] = B
        }

        for (var property in styles){
            var value = styles[property],
                set   = setter(property = camelize(property))

            this.forEach(function(node){
                var self = elements(node), anims = self._animations, anim
                if (anims && (anim = anims[property])) anim.stop(true)
                set.call(node, value)
            })
        }

        return this

    },

    compute: function(property){

        property = camelize(property)
        var node = this[0]

        // return default matrix for transform, instead of parsed (for consistency)

        if (property === "transform" && parseTransform2d) return compute(node)(transformName)

        var value = getter(property).call(node)

        // unit conversion to `px`

        return (value != null) ? value.replace(rgLength, function(match, value, unit){
            return (unit === "px") ? match : pixelRatio(node, unit) * value + "px"
        }) : ''

    }

})

moofx.parse = function(property, value, normalize){
    return (parsers[camelize(property)] || parse)(value, normalize)
}

module.exports = moofx

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./color":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/color.js","./frame":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/frame.js","./fx":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/fx.js","./unmatrix2d":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/unmatrix2d.js","elements":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/elements/index.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/index.js","prime/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/forEach.js","prime/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/indexOf.js","prime/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/map.js","prime/string/camelize":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/camelize.js","prime/string/capitalize":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/capitalize.js","prime/string/clean":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/clean.js","prime/string/hyphenate":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/hyphenate.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/color.js":[function(require,module,exports){
/*
color
*/"use strict"

var colors = {
    maroon      : "#800000",
    red         : "#ff0000",
    orange      : "#ffA500",
    yellow      : "#ffff00",
    olive       : "#808000",
    purple      : "#800080",
    fuchsia     : "#ff00ff",
    white       : "#ffffff",
    lime        : "#00ff00",
    green       : "#008000",
    navy        : "#000080",
    blue        : "#0000ff",
    aqua        : "#00ffff",
    teal        : "#008080",
    black       : "#000000",
    silver      : "#c0c0c0",
    gray        : "#808080",
    transparent : "#0000"
}

var RGBtoRGB = function(r, g, b, a){
    if (a == null || a === "") a = 1
    r = parseFloat(r)
    g = parseFloat(g)
    b = parseFloat(b)
    a = parseFloat(a)
    if (!(r <= 255 && r >= 0 && g <= 255 && g >= 0 && b <= 255 && b >= 0 && a <= 1 && a >= 0)) return null

    return [Math.round(r), Math.round(g), Math.round(b), a]
}

var HEXtoRGB = function(hex){
    if (hex.length === 3) hex += "f"
    if (hex.length === 4){
        var h0 = hex.charAt(0),
            h1 = hex.charAt(1),
            h2 = hex.charAt(2),
            h3 = hex.charAt(3)

        hex = h0 + h0 + h1 + h1 + h2 + h2 + h3 + h3
    }
    if (hex.length === 6) hex += "ff"
    var rgb = []
    for (var i = 0, l = hex.length; i < l; i += 2) rgb.push(parseInt(hex.substr(i, 2), 16) / (i === 6 ? 255 : 1))
    return rgb
}

// HSL to RGB conversion from:
// http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript
// thank you!

var HUEtoRGB = function(p, q, t){
    if (t < 0) t += 1
    if (t > 1) t -= 1
    if (t < 1 / 6) return p + (q - p) * 6 * t
    if (t < 1 / 2) return q
    if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6
    return p
}

var HSLtoRGB = function(h, s, l, a){
    var r, b, g
    if (a == null || a === "") a = 1
    h = parseFloat(h) / 360
    s = parseFloat(s) / 100
    l = parseFloat(l) / 100
    a = parseFloat(a) / 1
    if (h > 1 || h < 0 || s > 1 || s < 0 || l > 1 || l < 0 || a > 1 || a < 0) return null
    if (s === 0){
        r = b = g = l
    } else {
        var q = l < 0.5 ? l * (1 + s) : l + s - l * s
        var p = 2 * l - q
        r = HUEtoRGB(p, q, h + 1 / 3)
        g = HUEtoRGB(p, q, h)
        b = HUEtoRGB(p, q, h - 1 / 3)
    }
    return [r * 255, g * 255, b * 255, a]
}

var keys = []
for (var c in colors) keys.push(c)

var shex  = "(?:#([a-f0-9]{3,8}))",
    sval  = "\\s*([.\\d%]+)\\s*",
    sop   = "(?:,\\s*([.\\d]+)\\s*)?",
    slist = "\\(" + [sval, sval, sval] + sop + "\\)",
    srgb  = "(?:rgb)a?",
    shsl  = "(?:hsl)a?",
    skeys = "(" + keys.join("|") + ")"


var xhex   = RegExp(shex, "i"),
    xrgb   = RegExp(srgb + slist, "i"),
    xhsl   = RegExp(shsl + slist, "i")

var color = function(input, array){
    if (input == null) return null
    input = (input + "").replace(/\s+/, "")

    var match = colors[input]
    if (match){
        return color(match, array)
    } else if (match = input.match(xhex)){
        input = HEXtoRGB(match[1])
    } else if (match = input.match(xrgb)){
        input = match.slice(1)
    } else if (match = input.match(xhsl)){
        input = HSLtoRGB.apply(null, match.slice(1))
    } else return null

    if (!(input && (input = RGBtoRGB.apply(null, input)))) return null
    if (array) return input
    if (input[3] === 1) input.splice(3, 1)
    return "rgb" + (input.length === 4 ? "a" : "") + "(" + input + ")"
}

color.x = RegExp([skeys, shex, srgb + slist, shsl + slist].join("|"), "gi")

module.exports = color

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/frame.js":[function(require,module,exports){
(function (global){
/*
requestFrame / cancelFrame
*/"use strict"

var indexOf = require("prime/array/indexOf")

var requestFrame = global.requestAnimationFrame ||
                   global.webkitRequestAnimationFrame ||
                   global.mozRequestAnimationFrame ||
                   global.oRequestAnimationFrame ||
                   global.msRequestAnimationFrame ||
                   function(callback){
                       return setTimeout(function(){
                           callback()
                       }, 1e3 / 60)
                   }

var callbacks = []

var iterator = function(time){
    var split = callbacks.splice(0, callbacks.length)
    for (var i = 0, l = split.length; i < l; i++) split[i](time || (time = +(new Date)))
}

var cancel = function(callback){
    var io = indexOf(callbacks, callback)
    if (io > -1) callbacks.splice(io, 1)
}

var request = function(callback){
    var i = callbacks.push(callback)
    if (i === 1) requestFrame(iterator)
    return function(){
        cancel(callback)
    }
}

exports.request = request
exports.cancel = cancel

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"prime/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/indexOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/fx.js":[function(require,module,exports){
/*
fx
*/"use strict"

var prime        = require("prime"),
    requestFrame = require("./frame").request,
    bezier       = require("cubic-bezier")

var map = require("prime/array/map")

var sDuration    = "([\\d.]+)(s|ms)?",
    sCubicBezier = "cubic-bezier\\(([-.\\d]+),([-.\\d]+),([-.\\d]+),([-.\\d]+)\\)"

var rDuration     = RegExp(sDuration),
    rCubicBezier  = RegExp(sCubicBezier),
    rgCubicBezier = RegExp(sCubicBezier, "g")

    // equations collection

var equations = {
    "default"     : "cubic-bezier(0.25, 0.1, 0.25, 1.0)",
    "linear"      : "cubic-bezier(0, 0, 1, 1)",
    "ease-in"     : "cubic-bezier(0.42, 0, 1.0, 1.0)",
    "ease-out"    : "cubic-bezier(0, 0, 0.58, 1.0)",
    "ease-in-out" : "cubic-bezier(0.42, 0, 0.58, 1.0)"
}

equations.ease = equations["default"]

var compute = function(from, to, delta){
    return (to - from) * delta + from
}

var divide = function(string){
    var numbers = []
    var template = (string + "").replace(/[-.\d]+/g, function(number){
        numbers.push(+number)
        return "@"
    })
    return [numbers, template]
}

var Fx = prime({

    constructor: function Fx(render, options){

        // set options

        this.setOptions(options)

        // renderer

        this.render = render || function(){}

        // bound functions

        var self = this

        this.bStep = function(t){
            return self.step(t)
        }

        this.bExit = function(time){
            self.exit(time)
        }

    },

    setOptions: function(options){
        if (options == null) options = {}

        if (!(this.duration = this.parseDuration(options.duration || "500ms"))) throw new Error("invalid duration")
        if (!(this.equation = this.parseEquation(options.equation || "default"))) throw new Error("invalid equation")
        this.callback = options.callback || function(){}

        return this
    },

    parseDuration: function(duration){
        if (duration = (duration + "").match(rDuration)){
            var time = +duration[1],
                unit = duration[2] || "ms"

            if (unit === "s")  return time * 1e3
            if (unit === "ms") return time
        }
    },

    parseEquation: function(equation, array){
        var type = typeof equation

        if (type === "function"){ // function
            return equation
        } else if (type === "string"){ // cubic-bezier string
            equation = equations[equation] || equation
            var match = equation.replace(/\s+/g, "").match(rCubicBezier)
            if (match){
                equation = map(match.slice(1), function(v){return +v})
                if (array) return equation
                if (equation.toString() === "0,0,1,1") return function(x){return x}
                type = "object"
            }
        }

        if (type === "object"){ // array
            return bezier(equation[0], equation[1], equation[2], equation[3], 1e3 / 60 / this.duration / 4)
        }
    },

    cancel: function(to){
        this.to = to
        this.cancelExit = requestFrame(this.bExit)
    },

    exit: function(time){
        this.render(this.to)
        delete this.cancelExit
        this.callback(time)
    },

    start: function(from, to){

        this.stop()

        if (this.duration === 0){
            this.cancel(to)
            return this
        }

        this.isArray = false
        this.isNumber = false

        var fromType = typeof from,
            toType   = typeof to

        if (fromType === "object" && toType === "object"){
            this.isArray = true
        } else if (fromType === "number" && toType === "number"){
            this.isNumber = true
        }

        var from_ = divide(from),
            to_   = divide(to)

        this.from = from_[0]
        this.to = to_[0]
        this.templateFrom = from_[1]
        this.templateTo = to_[1]

        if (this.from.length !== this.to.length || this.from.toString() === this.to.toString()){
            this.cancel(to)
            return this
        }

        delete this.time
        this.length = this.from.length
        this.cancelStep = requestFrame(this.bStep)

        return this

    },

    stop: function(){

        if (this.cancelExit){
            this.cancelExit()
            delete this.cancelExit
        } else if (this.cancelStep){
            this.cancelStep()
            delete this.cancelStep
        }

        return this
    },

    step: function(now){

        this.time || (this.time = now)

        var factor = (now - this.time) / this.duration

        if (factor > 1) factor = 1

        var delta = this.equation(factor),
            from  = this.from,
            to    = this.to,
            tpl   = this.templateTo

        for (var i = 0, l = this.length; i < l; i++){
            var f = from[i], t = to[i]
            tpl = tpl.replace("@", t !== f ? compute(f, t, delta) : t)
        }

        this.render(this.isArray ? tpl.split(",") : this.isNumber ? +tpl : tpl, factor)

        if (factor !== 1){
            this.cancelStep = requestFrame(this.bStep)
        } else {
            delete this.cancelStep
            this.callback(now)
        }

    }

})

var fx = function(render){

    var ffx = new Fx(render)

    return {

        start: function(from, to, options){
            var type = typeof options
            ffx.setOptions((type === "function") ? {
                callback: options
            } : (type === "string" || type === "number") ? {
                duration: options
            } : options).start(from, to)
            return this
        },

        stop: function(){
            ffx.stop()
            return this
        }

    }

}

fx.prototype = Fx.prototype

module.exports = fx

},{"./frame":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/frame.js","cubic-bezier":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/cubic-bezier/index.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/index.js","prime/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/map.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/lib/unmatrix2d.js":[function(require,module,exports){
/*
Unmatrix 2d
 - a crude implementation of the slightly bugged pseudo code in http://www.w3.org/TR/css3-2d-transforms/#matrix-decomposition
*/"use strict"

// returns the length of the passed vector

var length = function(a){
    return Math.sqrt(a[0] * a[0] + a[1] * a[1])
}

// normalizes the length of the passed point to 1

var normalize = function(a){
    var l = length(a)
    return l ? [a[0] / l, a[1] / l] : [0, 0]
}

// returns the dot product of the passed points

var dot = function(a, b){
    return a[0] * b[0] + a[1] * b[1]
}

// returns the principal value of the arc tangent of
// y/x, using the signs of both arguments to determine
// the quadrant of the return value

var atan2 = Math.atan2

var combine = function(a, b, ascl, bscl){
    return [
        (ascl * a[0]) + (bscl * b[0]),
        (ascl * a[1]) + (bscl * b[1])
    ]
}

module.exports = function(a, b, c, d, tx, ty){

    // Make sure the matrix is invertible

    if ((a * d - b * c) === 0) return false

    // Take care of translation

    var translate = [tx, ty]

    // Put the components into a 2x2 matrix

    var m = [[a, b], [c, d]]

    // Compute X scale factor and normalize first row.

    var scale = [length(m[0])]
    m[0] = normalize(m[0])

    // Compute shear factor and make 2nd row orthogonal to 1st.

    var skew = dot(m[0], m[1])
    m[1] = combine(m[1], m[0], 1, -skew)

    // Now, compute Y scale and normalize 2nd row.

    scale[1] = length(m[1])
    // m[1] = normalize(m[1]) //
    skew /= scale[1]

    // Now, get the rotation out

    var rotate = atan2(m[0][1], m[0][0])

    return [translate, rotate, skew, scale]

}

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/cubic-bezier/index.js":[function(require,module,exports){

module.exports = function(x1, y1, x2, y2, epsilon){

	var curveX = function(t){
		var v = 1 - t;
		return 3 * v * v * t * x1 + 3 * v * t * t * x2 + t * t * t;
	};

	var curveY = function(t){
		var v = 1 - t;
		return 3 * v * v * t * y1 + 3 * v * t * t * y2 + t * t * t;
	};

	var derivativeCurveX = function(t){
		var v = 1 - t;
		return 3 * (2 * (t - 1) * t + v * v) * x1 + 3 * (- t * t * t + 2 * v * t) * x2;
	};

	return function(t){

		var x = t, t0, t1, t2, x2, d2, i;

		// First try a few iterations of Newton's method -- normally very fast.
		for (t2 = x, i = 0; i < 8; i++){
			x2 = curveX(t2) - x;
			if (Math.abs(x2) < epsilon) return curveY(t2);
			d2 = derivativeCurveX(t2);
			if (Math.abs(d2) < 1e-6) break;
			t2 = t2 - x2 / d2;
		}

		t0 = 0, t1 = 1, t2 = x;

		if (t2 < t0) return curveY(t0);
		if (t2 > t1) return curveY(t1);

		// Fallback to the bisection method for reliability.
		while (t0 < t1){
			x2 = curveX(t2);
			if (Math.abs(x2 - x) < epsilon) return curveY(t2);
			if (x > x2) t0 = t2;
			else t1 = t2;
			t2 = (t1 - t0) * .5 + t0;
		}

		// Failure
		return curveY(t2);

	};

};

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/elements/index.js":[function(require,module,exports){
(function (global){
/*
elements
*/"use strict"

var prime   = require("prime"),
    forEach = require("prime/array/forEach"),
    map     = require("prime/array/map"),
    filter  = require("prime/array/filter"),
    every   = require("prime/array/every"),
    some    = require("prime/array/some")

// uniqueID

var uniqueIndex = 0
var uniqueID = function(n){
    return (n === global) ? "global" : n.uniqueNumber || (n.uniqueNumber = "n:" + (uniqueIndex++).toString(36))
}

var instances = {}

// elements prime

var $ = prime({constructor: function $(n, context){

    if (n == null) return (this && this.constructor === $) ? new elements : null

    var self = n

    if (n.constructor !== elements){

        self = new elements

        var uid

        if (typeof n === "string"){
            if (!self.search) return null
            self[self.length++] = context || document
            return self.search(n)
        }

        if (n.nodeType || n === global){

            self[self.length++] = n

        } else if (n.length){

            // this could be an array, or any object with a length attribute,
            // including another instance of elements from another interface.

            var uniques = {}

            for (var i = 0, l = n.length; i < l; i++){ // perform elements flattening
                var nodes = $(n[i], context)
                if (nodes && nodes.length) for (var j = 0, k = nodes.length; j < k; j++){
                    var node = nodes[j]
                    uid = uniqueID(node)
                    if (!uniques[uid]){
                        self[self.length++] = node
                        uniques[uid] = true
                    }
                }
            }

        }

    }

    if (!self.length) return null

    // when length is 1 always use the same elements instance

    if (self.length === 1){
        uid = uniqueID(self[0])
        return instances[uid] || (instances[uid] = self)
    }

    return self

}})

var elements = prime({

    inherits: $,

    constructor: function elements(){
        this.length = 0
    },

    unlink: function(){
        return this.map(function(node, i){
            delete instances[uniqueID(node)]
            return node
        })
    },

    // straight es5 prototypes (or emulated methods)

    forEach: function(method, context){
        return forEach(this, method, context);
    },

    map: function(method, context){
        return map(this, method, context);
    },

    filter: function(method, context){
        return filter(this, method, context);
    },

    every: function(method, context){
        return every(this, method, context);
    },

    some: function(method, context){
        return some(this, method, context);
    }

})

module.exports = $

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/index.js","prime/array/every":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/every.js","prime/array/filter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/filter.js","prime/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/forEach.js","prime/array/map":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/map.js","prime/array/some":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/some.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/every.js":[function(require,module,exports){
/*
array:every
*/"use strict"

var every = function(self, method, context){
    for (var i = 0, l = self.length >>> 0; i < l; i++){
        if (!method.call(context, self[i], i, self)) return false
    }
    return true
}

module.exports = every

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/filter.js":[function(require,module,exports){
/*
array:filter
*/"use strict"

var filter = function(self, method, context){
    var results = []
    for (var i = 0, l = self.length >>> 0; i < l; i++) {
        var value = self[i]
        if (method.call(context, value, i, self)) results.push(value)
    }
    return results
}

module.exports = filter

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/forEach.js":[function(require,module,exports){
/*
array:forEach
*/"use strict"

var forEach = function(self, method, context){
    for (var i = 0, l = self.length >>> 0; i < l; i++){
        if (method.call(context, self[i], i, self) === false) break
    }
    return self
}

module.exports = forEach

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/indexOf.js":[function(require,module,exports){
/*
array:indexOf
*/"use strict"

var indexOf = function(self, item, from){
    for (var l = self.length >>> 0, i = (from < 0) ? Math.max(0, l + from) : from || 0; i < l; i++){
        if (self[i] === item) return i
    }
    return -1
}

module.exports = indexOf

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/map.js":[function(require,module,exports){
/*
array:map
*/"use strict"

var map = function(self, method, context){
    var length = self.length >>> 0, results = Array(length)
    for (var i = 0, l = length; i < l; i++){
        results[i] = method.call(context, self[i], i, self)
    }
    return results
}

module.exports = map

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/array/some.js":[function(require,module,exports){
/*
array:some
*/"use strict"

var some = function(self, method, context){
    for (var i = 0, l = self.length >>> 0; i < l; i++){
        if (method.call(context, self[i], i, self)) return true
    }
    return false
}

module.exports = some

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/index.js":[function(require,module,exports){
/*
prime
 - prototypal inheritance
*/"use strict"

var hasOwn = require("./object/hasOwn"),
    forIn  = require("./object/forIn"),
    mixIn  = require("./object/mixIn"),
    filter = require("./object/filter"),
    create = require("./object/create"),
    type   = require("./type")

var defineProperty           = Object.defineProperty,
    getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor

try {
    defineProperty({}, "~", {})
    getOwnPropertyDescriptor({}, "~")
} catch (e){
    defineProperty = null
    getOwnPropertyDescriptor = null
}

var define = function(value, key, from){
    defineProperty(this, key, getOwnPropertyDescriptor(from, key) || {
        writable: true,
        enumerable: true,
        configurable: true,
        value: value
    })
}

var copy = function(value, key){
    this[key] = value
}

var implement = function(proto){
    forIn(proto, defineProperty ? define : copy, this.prototype)
    return this
}

var verbs = /^constructor|inherits|mixin$/

var prime = function(proto){

    if (type(proto) === "function") proto = {constructor: proto}

    var superprime = proto.inherits

    // if our nice proto object has no own constructor property
    // then we proceed using a ghosting constructor that all it does is
    // call the parent's constructor if it has a superprime, else an empty constructor
    // proto.constructor becomes the effective constructor
    var constructor = (hasOwn(proto, "constructor")) ? proto.constructor : (superprime) ? function(){
        return superprime.apply(this, arguments)
    } : function(){}

    if (superprime){

        mixIn(constructor, superprime)

        var superproto = superprime.prototype
        // inherit from superprime
        var cproto = constructor.prototype = create(superproto)

        // setting constructor.parent to superprime.prototype
        // because it's the shortest possible absolute reference
        constructor.parent = superproto
        cproto.constructor = constructor
    }

    if (!constructor.implement) constructor.implement = implement

    var mixins = proto.mixin
    if (mixins){
        if (type(mixins) !== "array") mixins = [mixins]
        for (var i = 0; i < mixins.length; i++) constructor.implement(create(mixins[i].prototype))
    }

    // implement proto and return constructor
    return constructor.implement(filter(proto, function(value, key){
        return !key.match(verbs)
    }))

}

module.exports = prime

},{"./object/create":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/create.js","./object/filter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/filter.js","./object/forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/forIn.js","./object/hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/hasOwn.js","./object/mixIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/mixIn.js","./type":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/type.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/create.js":[function(require,module,exports){
/*
object:create
*/"use strict"

var create = function(self){
    var constructor = function(){}
    constructor.prototype = self
    return new constructor
}

module.exports = create

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/filter.js":[function(require,module,exports){
/*
object:filter
*/"use strict"

var forIn = require("./forIn")

var filter = function(self, method, context){
    var results = {}
    forIn(self, function(value, key){
        if (method.call(context, value, key, self)) results[key] = value
    })
    return results
}

module.exports = filter

},{"./forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/forIn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/forIn.js":[function(require,module,exports){
/*
object:forIn
*/"use strict"

var has = require("./hasOwn")

var forIn = function(self, method, context){
    for (var key in self) if (method.call(context, self[key], key, self) === false) break
    return self
}

if (!({valueOf: 0}).propertyIsEnumerable("valueOf")){ // fix for stupid IE enumeration bug

    var buggy = "constructor,toString,valueOf,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString".split(",")
    var proto = Object.prototype

    forIn = function(self, method, context){
        for (var key in self) if (method.call(context, self[key], key, self) === false) return self
        for (var i = 0; key = buggy[i]; i++){
            var value = self[key]
            if ((value !== proto[key] || has(self, key)) && method.call(context, value, key, self) === false) break
        }
        return self
    }

}

module.exports = forIn

},{"./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/forOwn.js":[function(require,module,exports){
/*
object:forOwn
*/"use strict"

var forIn  = require("./forIn"),
    hasOwn = require("./hasOwn")

var forOwn = function(self, method, context){
    forIn(self, function(value, key){
        if (hasOwn(self, key)) return method.call(context, value, key, self)
    })
    return self
}

module.exports = forOwn

},{"./forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/forIn.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/hasOwn.js":[function(require,module,exports){
/*
object:hasOwn
*/"use strict"

var hasOwnProperty = Object.hasOwnProperty

var hasOwn = function(self, key){
    return hasOwnProperty.call(self, key)
}

module.exports = hasOwn

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/mixIn.js":[function(require,module,exports){
/*
object:mixIn
*/"use strict"

var forOwn = require("./forOwn")

var copy = function(value, key){
    this[key] = value
}

var mixIn = function(self){
    for (var i = 1, l = arguments.length; i < l; i++) forOwn(arguments[i], copy, self)
    return self
}

module.exports = mixIn

},{"./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/camelize.js":[function(require,module,exports){
/*
string:camelize
*/"use strict"

var camelize = function(self){
    return (self + "").replace(/-\D/g, function(match){
        return match.charAt(1).toUpperCase()
    })
}

module.exports = camelize

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/capitalize.js":[function(require,module,exports){
/*
string:capitalize
*/"use strict"

var capitalize = function(self){
    return (self + "").replace(/\b[a-z]/g, function(match){
        return match.toUpperCase()
    })
}

module.exports = capitalize

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/clean.js":[function(require,module,exports){
/*
string:clean
*/"use strict"

var trim = require("./trim")

var clean = function(self){
    return trim((self + "").replace(/\s+/g, " "))
}

module.exports = clean

},{"./trim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/trim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/hyphenate.js":[function(require,module,exports){
/*
string:hyphenate
*/"use strict"

var hyphenate = function(self){
    return (self + "").replace(/[A-Z]/g, function(match){
        return '-' + match.toLowerCase()
    })
}

module.exports = hyphenate

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/string/trim.js":[function(require,module,exports){
/*
string:trim
*/"use strict"

var trim = function(self){
    return (self + "").replace(/^\s+|\s+$/g, "")
}

module.exports = trim

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/moofx/node_modules/prime/type.js":[function(require,module,exports){
/*
type
*/"use strict"

var toString = Object.prototype.toString,
    types = /number|object|array|string|function|date|regexp|boolean/

var type = function(object){
    if (object == null) return "null"
    var string = toString.call(object).slice(8, -1).toLowerCase()
    if (string === "number" && isNaN(object)) return "null"
    if (types.test(string)) return string
    return "object"
}

module.exports = type

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/append.js":[function(require,module,exports){


    /**
     * Appends an array to the end of another.
     * The first array will be modified.
     */
    function append(arr1, arr2) {
        if (arr2 == null) {
            return arr1;
        }

        var pad = arr1.length,
            i = -1,
            len = arr2.length;
        while (++i < len) {
            arr1[pad + i] = arr2[i];
        }
        return arr1;
    }
    module.exports = append;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/combine.js":[function(require,module,exports){
var indexOf = require('./indexOf');

    /**
     * Combines an array with all the items of another.
     * Does not allow duplicates and is case and type sensitive.
     */
    function combine(arr1, arr2) {
        if (arr2 == null) {
            return arr1;
        }

        var i = -1, len = arr2.length;
        while (++i < len) {
            if (indexOf(arr1, arr2[i]) === -1) {
                arr1.push(arr2[i]);
            }
        }

        return arr1;
    }
    module.exports = combine;


},{"./indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/indexOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js":[function(require,module,exports){
var indexOf = require('./indexOf');

    /**
     * If array contains values.
     */
    function contains(arr, val) {
        return indexOf(arr, val) !== -1;
    }
    module.exports = contains;


},{"./indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/indexOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/difference.js":[function(require,module,exports){
var unique = require('./unique');
var filter = require('./filter');
var some = require('./some');
var contains = require('./contains');
var slice = require('./slice');


    /**
     * Return a new Array with elements that aren't present in the other Arrays.
     */
    function difference(arr) {
        var arrs = slice(arguments, 1),
            result = filter(unique(arr), function(needle){
                return !some(arrs, function(haystack){
                    return contains(haystack, needle);
                });
            });
        return result;
    }

    module.exports = difference;



},{"./contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","./filter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/filter.js","./slice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js","./some":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/some.js","./unique":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/unique.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/equals.js":[function(require,module,exports){
var is = require('../lang/is');
var isArray = require('../lang/isArray');
var every = require('./every');

    /**
     * Compares if both arrays have the same elements
     */
    function equals(a, b, callback){
        callback = callback || is;

        if (!isArray(a) || !isArray(b)) {
            return callback(a, b);
        }

        if (a.length !== b.length) {
            return false;
        }

        return every(a, makeCompare(callback), b);
    }

    function makeCompare(callback) {
        return function(value, i) {
            return i in this && callback(value, this[i]);
        };
    }

    module.exports = equals;



},{"../lang/is":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/is.js","../lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","./every":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/every.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/every.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/every.js"][0].apply(exports,arguments)
},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/filter.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/filter.js"][0].apply(exports,arguments)
},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/find.js":[function(require,module,exports){
var findIndex = require('./findIndex');

    /**
     * Returns first item that matches criteria
     */
    function find(arr, iterator, thisObj){
        var idx = findIndex(arr, iterator, thisObj);
        return idx >= 0? arr[idx] : void(0);
    }

    module.exports = find;



},{"./findIndex":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/findIndex.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/findIndex.js":[function(require,module,exports){
var makeIterator = require('../function/makeIterator_');

    /**
     * Returns the index of the first item that matches criteria
     */
    function findIndex(arr, iterator, thisObj){
        iterator = makeIterator(iterator, thisObj);
        if (arr == null) {
            return -1;
        }

        var i = -1, len = arr.length;
        while (++i < len) {
            if (iterator(arr[i], i, arr)) {
                return i;
            }
        }

        return -1;
    }

    module.exports = findIndex;


},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/flatten.js":[function(require,module,exports){
var isArray = require('../lang/isArray');
var append = require('./append');

    /*
     * Helper function to flatten to a destination array.
     * Used to remove the need to create intermediate arrays while flattening.
     */
    function flattenTo(arr, result, level) {
        if (arr == null) {
            return result;
        } else if (level === 0) {
            append(result, arr);
            return result;
        }

        var value,
            i = -1,
            len = arr.length;
        while (++i < len) {
            value = arr[i];
            if (isArray(value)) {
                flattenTo(value, result, level - 1);
            } else {
                result.push(value);
            }
        }
        return result;
    }

    /**
     * Recursively flattens an array.
     * A new array containing all the elements is returned.
     * If `shallow` is true, it will only flatten one level.
     */
    function flatten(arr, level) {
        level = level == null? -1 : level;
        return flattenTo(arr, [], level);
    }

    module.exports = flatten;




},{"../lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","./append":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/append.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/forEach.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/forEach.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/indexOf.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/indexOf.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/insert.js":[function(require,module,exports){
var difference = require('./difference');
var slice = require('./slice');

    /**
     * Insert item into array if not already present.
     */
    function insert(arr, rest_items) {
        var diff = difference(slice(arguments, 1), arr);
        if (diff.length) {
            Array.prototype.push.apply(arr, diff);
        }
        return arr.length;
    }
    module.exports = insert;


},{"./difference":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/difference.js","./slice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/invoke.js":[function(require,module,exports){
var slice = require('./slice');

    /**
     * Call `methodName` on each item of the array passing custom arguments if
     * needed.
     */
    function invoke(arr, methodName, var_args){
        if (arr == null) {
            return arr;
        }

        var args = slice(arguments, 2);
        var i = -1, len = arr.length, value;
        while (++i < len) {
            value = arr[i];
            value[methodName].apply(value, args);
        }

        return arr;
    }

    module.exports = invoke;


},{"./slice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/last.js":[function(require,module,exports){


    /**
     * Returns last element of array.
     */
    function last(arr){
        if (arr == null || arr.length < 1) {
            return undefined;
        }

        return arr[arr.length - 1];
    }

    module.exports = last;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/map.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/map.js"][0].apply(exports,arguments)
},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/removeAll.js":[function(require,module,exports){
var indexOf = require('./indexOf');

    /**
     * Remove all instances of an item from array.
     */
    function removeAll(arr, item){
        var idx = indexOf(arr, item);
        while (idx !== -1) {
            arr.splice(idx, 1);
            idx = indexOf(arr, item, idx);
        }
    }

    module.exports = removeAll;


},{"./indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/indexOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js":[function(require,module,exports){


    /**
     * Create slice of source array or array-like object
     */
    function slice(arr, start, end){
        var len = arr.length;

        if (start == null) {
            start = 0;
        } else if (start < 0) {
            start = Math.max(len + start, 0);
        } else {
            start = Math.min(start, len);
        }

        if (end == null) {
            end = len;
        } else if (end < 0) {
            end = Math.max(len + end, 0);
        } else {
            end = Math.min(end, len);
        }

        var result = [];
        while (start < end) {
            result.push(arr[start++]);
        }

        return result;
    }

    module.exports = slice;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/some.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/array/some.js"][0].apply(exports,arguments)
},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/split.js":[function(require,module,exports){


    /**
     * Split array into a fixed number of segments.
     */
    function split(array, segments) {
        segments = segments || 2;
        var results = [];
        if (array == null) {
            return results;
        }

        var minLength = Math.floor(array.length / segments),
            remainder = array.length % segments,
            i = 0,
            len = array.length,
            segmentIndex = 0,
            segmentLength;

        while (i < len) {
            segmentLength = minLength;
            if (segmentIndex < remainder) {
                segmentLength++;
            }

            results.push(array.slice(i, i + segmentLength));

            segmentIndex++;
            i += segmentLength;
        }

        return results;
    }
    module.exports = split;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/unique.js":[function(require,module,exports){
var filter = require('./filter');

    /**
     * @return {array} Array of unique items
     */
    function unique(arr, compare){
        compare = compare || isEqual;
        return filter(arr, function(item, i, arr){
            var n = arr.length;
            while (++i < n) {
                if ( compare(item, arr[i]) ) {
                    return false;
                }
            }
            return true;
        });
    }

    function isEqual(a, b){
        return a === b;
    }

    module.exports = unique;



},{"./filter":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/filter.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/find.js":[function(require,module,exports){
var make = require('./make_');
var arrFind = require('../array/find');
var objFind = require('../object/find');

    /**
     * Find value that returns true on iterator check.
     */
    module.exports = make(arrFind, objFind);



},{"../array/find":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/find.js","../object/find":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/find.js","./make_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/make_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/forEach.js":[function(require,module,exports){
var make = require('./make_');
var arrForEach = require('../array/forEach');
var objForEach = require('../object/forOwn');

    /**
     */
    module.exports = make(arrForEach, objForEach);



},{"../array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/forEach.js","../object/forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js","./make_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/make_.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/make_.js":[function(require,module,exports){
var slice = require('../array/slice');

    /**
     * internal method used to create other collection modules.
     */
    function makeCollectionMethod(arrMethod, objMethod, defaultReturn) {
        return function(){
            var args = slice(arguments);
            if (args[0] == null) {
                return defaultReturn;
            }
            // array-like is treated as array
            return (typeof args[0].length === 'number')? arrMethod.apply(null, args) : objMethod.apply(null, args);
        };
    }

    module.exports = makeCollectionMethod;



},{"../array/slice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/collection/size.js":[function(require,module,exports){
var isArray = require('../lang/isArray');
var objSize = require('../object/size');

    /**
     * Get collection size
     */
    function size(list) {
        if (!list) {
            return 0;
        }
        if (isArray(list)) {
            return list.length;
        }
        return objSize(list);
    }

    module.exports = size;



},{"../lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","../object/size":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/size.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js":[function(require,module,exports){
var slice = require('../array/slice');

    /**
     * Return a function that will execute in the given context, optionally adding any additional supplied parameters to the beginning of the arguments collection.
     * @param {Function} fn  Function.
     * @param {object} context   Execution context.
     * @param {rest} args    Arguments (0...n arguments).
     * @return {Function} Wrapped Function.
     */
    function bind(fn, context, args){
        var argsArr = slice(arguments, 2); //curried args
        return function(){
            return fn.apply(context, argsArr.concat(slice(arguments)));
        };
    }

    module.exports = bind;



},{"../array/slice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/debounce.js":[function(require,module,exports){


    /**
     * Debounce callback execution
     */
    function debounce(fn, threshold, isAsap){
        var timeout, result;
        function debounced(){
            var args = arguments, context = this;
            function delayed(){
                if (! isAsap) {
                    result = fn.apply(context, args);
                }
                timeout = null;
            }
            if (timeout) {
                clearTimeout(timeout);
            } else if (isAsap) {
                result = fn.apply(context, args);
            }
            timeout = setTimeout(delayed, threshold);
            return result;
        }
        debounced.cancel = function(){
            clearTimeout(timeout);
        };
        return debounced;
    }

    module.exports = debounce;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/identity.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/identity.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/makeIterator_.js"][0].apply(exports,arguments)
},{"../object/deepMatches":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/deepMatches.js","./identity":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/identity.js","./prop":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/prop.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/prop.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/function/prop.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/series.js":[function(require,module,exports){


    /**
     * Returns a function that will execute a list of functions in sequence
     * passing the same arguments to each one. (useful for batch processing
     * items during a forEach loop)
     */
    function series(){
        var fns = arguments;
        return function(){
            var i = 0,
                n = fns.length;
            while (i < n) {
                fns[i].apply(this, arguments);
                i += 1;
            }
        };
    }

    module.exports = series;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/clone.js":[function(require,module,exports){
var kindOf = require('./kindOf');
var isPlainObject = require('./isPlainObject');
var mixIn = require('../object/mixIn');

    /**
     * Clone native types.
     */
    function clone(val){
        switch (kindOf(val)) {
            case 'Object':
                return cloneObject(val);
            case 'Array':
                return cloneArray(val);
            case 'RegExp':
                return cloneRegExp(val);
            case 'Date':
                return cloneDate(val);
            default:
                return val;
        }
    }

    function cloneObject(source) {
        if (isPlainObject(source)) {
            return mixIn({}, source);
        } else {
            return source;
        }
    }

    function cloneRegExp(r) {
        var flags = '';
        flags += r.multiline ? 'm' : '';
        flags += r.global ? 'g' : '';
        flags += r.ignoreCase ? 'i' : '';
        return new RegExp(r.source, flags);
    }

    function cloneDate(date) {
        return new Date(+date);
    }

    function cloneArray(arr) {
        return arr.slice();
    }

    module.exports = clone;



},{"../object/mixIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/mixIn.js","./isPlainObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isPlainObject.js","./kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/kindOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepClone.js":[function(require,module,exports){
var clone = require('./clone');
var forOwn = require('../object/forOwn');
var kindOf = require('./kindOf');
var isPlainObject = require('./isPlainObject');

    /**
     * Recursively clone native types.
     */
    function deepClone(val, instanceClone) {
        switch ( kindOf(val) ) {
            case 'Object':
                return cloneObject(val, instanceClone);
            case 'Array':
                return cloneArray(val, instanceClone);
            default:
                return clone(val);
        }
    }

    function cloneObject(source, instanceClone) {
        if (isPlainObject(source)) {
            var out = {};
            forOwn(source, function(val, key) {
                this[key] = deepClone(val, instanceClone);
            }, out);
            return out;
        } else if (instanceClone) {
            return instanceClone(source);
        } else {
            return source;
        }
    }

    function cloneArray(arr, instanceClone) {
        var out = [],
            i = -1,
            n = arr.length,
            val;
        while (++i < n) {
            out[i] = deepClone(arr[i], instanceClone);
        }
        return out;
    }

    module.exports = deepClone;




},{"../object/forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js","./clone":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/clone.js","./isPlainObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isPlainObject.js","./kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/kindOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepEquals.js":[function(require,module,exports){
var is = require('./is');
var isObject = require('./isObject');
var isArray = require('./isArray');
var objEquals = require('../object/equals');
var arrEquals = require('../array/equals');

    /**
     * Recursively checks for same properties and values.
     */
    function deepEquals(a, b, callback){
        callback = callback || is;

        var bothObjects = isObject(a) && isObject(b);
        var bothArrays = !bothObjects && isArray(a) && isArray(b);

        if (!bothObjects && !bothArrays) {
            return callback(a, b);
        }

        function compare(a, b){
            return deepEquals(a, b, callback);
        }

        var method = bothObjects ? objEquals : arrEquals;
        return method(a, b, compare);
    }

    module.exports = deepEquals;



},{"../array/equals":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/equals.js","../object/equals":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/equals.js","./is":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/is.js","./isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","./isObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isObject.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/is.js":[function(require,module,exports){


    /**
     * Check if both arguments are egal.
     */
    function is(x, y){
        // implementation borrowed from harmony:egal spec
        if (x === y) {
          // 0 === -0, but they are not identical
          return x !== 0 || 1 / x === 1 / y;
        }

        // NaN !== NaN, but they are identical.
        // NaNs are the only non-reflexive value, i.e., if x !== x,
        // then x is a NaN.
        // isNaN is broken: it converts its argument to number, so
        // isNaN("foo") => true
        return x !== x && y !== y;
    }

    module.exports = is;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isArray.js"][0].apply(exports,arguments)
},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isBoolean.js":[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isBoolean(val) {
        return isKind(val, 'Boolean');
    }
    module.exports = isBoolean;


},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isFunction.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isFunction.js"][0].apply(exports,arguments)
},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isKind.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isKind.js"][0].apply(exports,arguments)
},{"./kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/kindOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isNumber.js":[function(require,module,exports){
var isKind = require('./isKind');
    /**
     */
    function isNumber(val) {
        return isKind(val, 'Number');
    }
    module.exports = isNumber;


},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isObject.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isObject.js"][0].apply(exports,arguments)
},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isPlainObject.js":[function(require,module,exports){


    /**
     * Checks if the value is created by the `Object` constructor.
     */
    function isPlainObject(value) {
        return (!!value && typeof value === 'object' &&
            value.constructor === Object);
    }

    module.exports = isPlainObject;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isPrimitive.js":[function(require,module,exports){


    /**
     * Checks if the object is a primitive
     */
    function isPrimitive(value) {
        // Using switch fallthrough because it's simple to read and is
        // generally fast: http://jsperf.com/testing-value-is-primitive/5
        switch (typeof value) {
            case "string":
            case "number":
            case "boolean":
                return true;
        }

        return value == null;
    }

    module.exports = isPrimitive;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isString.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isString.js"][0].apply(exports,arguments)
},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/kindOf.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/kindOf.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toNumber.js":[function(require,module,exports){
var isArray = require('./isArray');

    /**
     * covert value into number if numeric
     */
    function toNumber(val){
        // numberic values should come first because of -0
        if (typeof val === 'number') return val;
        // we want all falsy values (besides -0) to return zero to avoid
        // headaches
        if (!val) return 0;
        if (typeof val === 'string') return parseFloat(val);
        // arrays are edge cases. `Number([4]) === 4`
        if (isArray(val)) return NaN;
        return Number(val);
    }

    module.exports = toNumber;



},{"./isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/toString.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/clamp.js":[function(require,module,exports){

    /**
     * Clamps value inside range.
     */
    function clamp(val, min, max){
        return val < min? min : (val > max? max : val);
    }
    module.exports = clamp;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/lerp.js":[function(require,module,exports){

    /**
    * Linear interpolation.
    * IMPORTANT:will return `Infinity` if numbers overflow Number.MAX_VALUE
    */
    function lerp(ratio, start, end){
        return start + (end - start) * ratio;
    }

    module.exports = lerp;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/map.js":[function(require,module,exports){
var lerp = require('./lerp');
var norm = require('./norm');
    /**
    * Maps a number from one scale to another.
    * @example map(3, 0, 4, -1, 1) -> 0.5
    */
    function map(val, min1, max1, min2, max2){
        return lerp( norm(val, min1, max1), min2, max2 );
    }
    module.exports = map;


},{"./lerp":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/lerp.js","./norm":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/norm.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/math/norm.js":[function(require,module,exports){

    /**
    * Gets normalized ratio of value inside range.
    */
    function norm(val, min, max){
        if (val < min || val > max) {
            throw new RangeError('value (' + val + ') must be between ' + min + ' and ' + max);
        }

        return val === max ? 1 : (val - min) / (max - min);
    }
    module.exports = norm;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/MAX_INT.js":[function(require,module,exports){
/**
 * @constant Maximum 32-bit signed integer value. (2^31 - 1)
 */

    module.exports = 2147483647;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/MIN_INT.js":[function(require,module,exports){
/**
 * @constant Minimum 32-bit signed integer value (-2^31).
 */

    module.exports = -2147483648;


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/enforcePrecision.js":[function(require,module,exports){
var toNumber = require('../lang/toNumber');
    /**
     * Enforce a specific amount of decimal digits and also fix floating
     * point rounding issues.
     */
    function enforcePrecision(val, nDecimalDigits){
        val = toNumber(val);
        var pow = Math.pow(10, nDecimalDigits);
        return +(Math.round(val * pow) / pow).toFixed(nDecimalDigits);
    }
    module.exports = enforcePrecision;


},{"../lang/toNumber":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toNumber.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/toInt.js":[function(require,module,exports){


    /**
     * "Convert" value into an 32-bit integer.
     * Works like `Math.floor` if val > 0 and `Math.ceil` if val < 0.
     * IMPORTANT: val will wrap at 2^31 and -2^31.
     * Perf tests: http://jsperf.com/vs-vs-parseint-bitwise-operators/7
     */
    function toInt(val){
        // we do not use lang/toNumber because of perf and also because it
        // doesn't break the functionality
        return ~~val;
    }

    module.exports = toInt;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/deepFillIn.js":[function(require,module,exports){
var forOwn = require('./forOwn');
var isPlainObject = require('../lang/isPlainObject');

    /**
     * Deeply copy missing properties in the target from the defaults.
     */
    function deepFillIn(target, defaults){
        var i = 0,
            n = arguments.length,
            obj;

        while(++i < n) {
            obj = arguments[i];
            if (obj) {
                // jshint loopfunc: true
                forOwn(obj, function(newValue, key) {
                    var curValue = target[key];
                    if (curValue == null) {
                        target[key] = newValue;
                    } else if (isPlainObject(curValue) &&
                               isPlainObject(newValue)) {
                        deepFillIn(curValue, newValue);
                    }
                });
            }
        }

        return target;
    }

    module.exports = deepFillIn;



},{"../lang/isPlainObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isPlainObject.js","./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/deepMatches.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/elements/node_modules/mout/object/deepMatches.js"][0].apply(exports,arguments)
},{"../lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/equals.js":[function(require,module,exports){
var hasOwn = require('./hasOwn');
var every = require('./every');
var isObject = require('../lang/isObject');
var is = require('../lang/is');

    // Makes a function to compare the object values from the specified compare
    // operation callback.
    function makeCompare(callback) {
        return function(value, key) {
            return hasOwn(this, key) && callback(value, this[key]);
        };
    }

    function checkProperties(value, key) {
        return hasOwn(this, key);
    }

    /**
     * Checks if two objects have the same keys and values.
     */
    function equals(a, b, callback) {
        callback = callback || is;

        if (!isObject(a) || !isObject(b)) {
            return callback(a, b);
        }

        return (every(a, makeCompare(callback), b) &&
                every(b, checkProperties, a));
    }

    module.exports = equals;


},{"../lang/is":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/is.js","../lang/isObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isObject.js","./every":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/every.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/every.js":[function(require,module,exports){
var forOwn = require('./forOwn');
var makeIterator = require('../function/makeIterator_');

    /**
     * Object every
     */
    function every(obj, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result = true;
        forOwn(obj, function(val, key) {
            // we consider any falsy values as "false" on purpose so shorthand
            // syntax can be used to check property existence
            if (!callback(val, key, obj)) {
                result = false;
                return false; // break
            }
        });
        return result;
    }

    module.exports = every;



},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js","./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/find.js":[function(require,module,exports){
var some = require('./some');
var makeIterator = require('../function/makeIterator_');

    /**
     * Returns first item that matches criteria
     */
    function find(obj, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result;
        some(obj, function(value, key, obj) {
            if (callback(value, key, obj)) {
                result = value;
                return true; //break
            }
        });
        return result;
    }

    module.exports = find;



},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js","./some":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/some.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forIn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forIn.js"][0].apply(exports,arguments)
},{"./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forOwn.js"][0].apply(exports,arguments)
},{"./forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forIn.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js":[function(require,module,exports){
var isPrimitive = require('../lang/isPrimitive');

    /**
     * get "nested" object property
     */
    function get(obj, prop){
        var parts = prop.split('.'),
            last = parts.pop();

        while (prop = parts.shift()) {
            obj = obj[prop];
            if (obj == null) return;
        }

        return obj[last];
    }

    module.exports = get;



},{"../lang/isPrimitive":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isPrimitive.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/has.js":[function(require,module,exports){
var get = require('./get');

    var UNDEF;

    /**
     * Check if object has nested property.
     */
    function has(obj, prop){
        return get(obj, prop) !== UNDEF;
    }

    module.exports = has;




},{"./get":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/hasOwn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/hasOwn.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/keys.js":[function(require,module,exports){
var forOwn = require('./forOwn');

    /**
     * Get object keys
     */
     var keys = Object.keys || function (obj) {
            var keys = [];
            forOwn(obj, function(val, key){
                keys.push(key);
            });
            return keys;
        };

    module.exports = keys;



},{"./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js":[function(require,module,exports){
var hasOwn = require('./hasOwn');
var deepClone = require('../lang/deepClone');
var isObject = require('../lang/isObject');

    /**
     * Deep merge objects.
     */
    function merge() {
        var i = 1,
            key, val, obj, target;

        // make sure we don't modify source element and it's properties
        // objects are passed by reference
        target = deepClone( arguments[0] );

        while (obj = arguments[i++]) {
            for (key in obj) {
                if ( ! hasOwn(obj, key) ) {
                    continue;
                }

                val = obj[key];

                if ( isObject(val) && isObject(target[key]) ){
                    // inception, deep merge objects
                    target[key] = merge(target[key], val);
                } else {
                    // make sure arrays, regexp, date, objects are cloned
                    target[key] = deepClone(val);
                }

            }
        }

        return target;
    }

    module.exports = merge;



},{"../lang/deepClone":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepClone.js","../lang/isObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isObject.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/mixIn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/mixIn.js"][0].apply(exports,arguments)
},{"./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/namespace.js":[function(require,module,exports){
var forEach = require('../array/forEach');

    /**
     * Create nested object if non-existent
     */
    function namespace(obj, path){
        if (!path) return obj;
        forEach(path.split('.'), function(key){
            if (!obj[key]) {
                obj[key] = {};
            }
            obj = obj[key];
        });
        return obj;
    }

    module.exports = namespace;



},{"../array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/forEach.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/omit.js":[function(require,module,exports){
var slice = require('../array/slice');
var contains = require('../array/contains');

    /**
     * Return a copy of the object, filtered to only contain properties except the blacklisted keys.
     */
    function omit(obj, var_keys){
        var keys = typeof arguments[1] !== 'string'? arguments[1] : slice(arguments, 1),
            out = {};

        for (var property in obj) {
            if (obj.hasOwnProperty(property) && !contains(keys, property)) {
                out[property] = obj[property];
            }
        }
        return out;
    }

    module.exports = omit;



},{"../array/contains":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/contains.js","../array/slice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/set.js":[function(require,module,exports){
var namespace = require('./namespace');

    /**
     * set "nested" object property
     */
    function set(obj, prop, val){
        var parts = (/^(.+)\.(.+)$/).exec(prop);
        if (parts){
            namespace(obj, parts[1])[parts[2]] = val;
        } else {
            obj[prop] = val;
        }
    }

    module.exports = set;



},{"./namespace":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/namespace.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/size.js":[function(require,module,exports){
var forOwn = require('./forOwn');

    /**
     * Get object size
     */
    function size(obj) {
        var count = 0;
        forOwn(obj, function(){
            count++;
        });
        return count;
    }

    module.exports = size;



},{"./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/some.js":[function(require,module,exports){
var forOwn = require('./forOwn');
var makeIterator = require('../function/makeIterator_');

    /**
     * Object some
     */
    function some(obj, callback, thisObj) {
        callback = makeIterator(callback, thisObj);
        var result = false;
        forOwn(obj, function(val, key) {
            if (callback(val, key, obj)) {
                result = true;
                return false; // break
            }
        });
        return result;
    }

    module.exports = some;



},{"../function/makeIterator_":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/makeIterator_.js","./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/unset.js":[function(require,module,exports){
var has = require('./has');

    /**
     * Unset object property.
     */
    function unset(obj, prop){
        if (has(obj, prop)) {
            var parts = prop.split('.'),
                last = parts.pop();
            while (prop = parts.shift()) {
                obj = obj[prop];
            }
            return (delete obj[last]);

        } else {
            // if property doesn't exist treat as deleted
            return true;
        }
    }

    module.exports = unset;



},{"./has":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/has.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/values.js":[function(require,module,exports){
var forOwn = require('./forOwn');

    /**
     * Get object values
     */
    function values(obj) {
        var vals = [];
        forOwn(obj, function(val, key){
            vals.push(val);
        });
        return vals;
    }

    module.exports = values;



},{"./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/queryString/encode.js":[function(require,module,exports){
var forOwn = require('../object/forOwn');
var isArray = require('../lang/isArray');
var forEach = require('../array/forEach');

    /**
     * Encode object into a query string.
     */
    function encode(obj){
        var query = [],
            arrValues, reg;
        forOwn(obj, function (val, key) {
            if (isArray(val)) {
                arrValues = key + '=';
                reg = new RegExp('&'+key+'+=$');
                forEach(val, function (aValue) {
                    arrValues += encodeURIComponent(aValue) + '&' + key + '=';
                });
                query.push(arrValues.replace(reg, ''));
            } else {
               query.push(key + '=' + encodeURIComponent(val));
            }
        });
        return (query.length) ? '?' + query.join('&') : '';
    }

    module.exports = encode;


},{"../array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/forEach.js","../lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","../object/forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/queryString/setParam.js":[function(require,module,exports){


    /**
     * Set query string parameter value
     */
    function setParam(url, paramName, value){
        url = url || '';

        var re = new RegExp('(\\?|&)'+ paramName +'=[^&]*' );
        var param = paramName +'='+ encodeURIComponent( value );

        if ( re.test(url) ) {
            return url.replace(re, '$1'+ param);
        } else {
            if (url.indexOf('?') === -1) {
                url += '?';
            }
            if (url.indexOf('=') !== -1) {
                url += '&';
            }
            return url + param;
        }

    }

    module.exports = setParam;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/choice.js":[function(require,module,exports){
var randInt = require('./randInt');
var isArray = require('../lang/isArray');

    /**
     * Returns a random element from the supplied arguments
     * or from the array (if single argument is an array).
     */
    function choice(items) {
        var target = (arguments.length === 1 && isArray(items))? items : arguments;
        return target[ randInt(0, target.length - 1) ];
    }

    module.exports = choice;



},{"../lang/isArray":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isArray.js","./randInt":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/randInt.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/guid.js":[function(require,module,exports){
var randHex = require('./randHex');
var choice = require('./choice');

  /**
   * Returns pseudo-random guid (UUID v4)
   * IMPORTANT: it's not totally "safe" since randHex/choice uses Math.random
   * by default and sequences can be predicted in some cases. See the
   * "random/random" documentation for more info about it and how to replace
   * the default PRNG.
   */
  function guid() {
    return (
        randHex(8)+'-'+
        randHex(4)+'-'+
        // v4 UUID always contain "4" at this position to specify it was
        // randomly generated
        '4' + randHex(3) +'-'+
        // v4 UUID always contain chars [a,b,8,9] at this position
        choice(8, 9, 'a', 'b') + randHex(3)+'-'+
        randHex(12)
    );
  }
  module.exports = guid;


},{"./choice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/choice.js","./randHex":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/randHex.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/rand.js":[function(require,module,exports){
var random = require('./random');
var MIN_INT = require('../number/MIN_INT');
var MAX_INT = require('../number/MAX_INT');

    /**
     * Returns random number inside range
     */
    function rand(min, max){
        min = min == null? MIN_INT : min;
        max = max == null? MAX_INT : max;
        return min + (max - min) * random();
    }

    module.exports = rand;


},{"../number/MAX_INT":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/MAX_INT.js","../number/MIN_INT":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/MIN_INT.js","./random":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/random.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/randHex.js":[function(require,module,exports){
var choice = require('./choice');

    var _chars = '0123456789abcdef'.split('');

    /**
     * Returns a random hexadecimal string
     */
    function randHex(size){
        size = size && size > 0? size : 6;
        var str = '';
        while (size--) {
            str += choice(_chars);
        }
        return str;
    }

    module.exports = randHex;



},{"./choice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/choice.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/randInt.js":[function(require,module,exports){
var MIN_INT = require('../number/MIN_INT');
var MAX_INT = require('../number/MAX_INT');
var rand = require('./rand');

    /**
     * Gets random integer inside range or snap to min/max values.
     */
    function randInt(min, max){
        min = min == null? MIN_INT : ~~min;
        max = max == null? MAX_INT : ~~max;
        // can't be max + 0.5 otherwise it will round up if `rand`
        // returns `max` causing it to overflow range.
        // -0.5 and + 0.49 are required to avoid bias caused by rounding
        return Math.round( rand(min - 0.5, max + 0.499999999999) );
    }

    module.exports = randInt;


},{"../number/MAX_INT":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/MAX_INT.js","../number/MIN_INT":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/MIN_INT.js","./rand":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/rand.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/random/random.js":[function(require,module,exports){


    /**
     * Just a wrapper to Math.random. No methods inside mout/random should call
     * Math.random() directly so we can inject the pseudo-random number
     * generator if needed (ie. in case we need a seeded random or a better
     * algorithm than the native one)
     */
    function random(){
        return random.get();
    }

    // we expose the method so it can be swapped if needed
    random.get = Math.random;

    module.exports = random;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/WHITE_SPACES.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/WHITE_SPACES.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/contains.js":[function(require,module,exports){
var toString = require('../lang/toString');

    /**
     * Searches for a given substring
     */
    function contains(str, substring, fromIndex){
        str = toString(str);
        substring = toString(substring);
        return str.indexOf(substring, fromIndex) !== -1;
    }

    module.exports = contains;



},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/escapeHtml.js":[function(require,module,exports){
var toString = require('../lang/toString');

    /**
     * Escapes a string for insertion into HTML.
     */
    function escapeHtml(str){
        str = toString(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/'/g, '&#39;')
            .replace(/"/g, '&quot;');
        return str;
    }

    module.exports = escapeHtml;



},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/escapeUnicode.js":[function(require,module,exports){
var toString = require('../lang/toString');

    /**
     * Escape string into unicode sequences
     */
    function escapeUnicode(str, shouldEscapePrintable){
        str = toString(str);
        return str.replace(/[\s\S]/g, function(ch){
            // skip printable ASCII chars if we should not escape them
            if (!shouldEscapePrintable && (/[\x20-\x7E]/).test(ch)) {
                return ch;
            }
            // we use "000" and slice(-4) for brevity, need to pad zeros,
            // unicode escape always have 4 chars after "\u"
            return '\\u'+ ('000'+ ch.charCodeAt(0).toString(16)).slice(-4);
        });
    }

    module.exports = escapeUnicode;



},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/interpolate.js":[function(require,module,exports){
var toString = require('../lang/toString');
var get = require('../object/get');

    var stache = /\{\{([^\}]+)\}\}/g; //mustache-like

    /**
     * String interpolation
     */
    function interpolate(template, replacements, syntax){
        template = toString(template);
        var replaceFn = function(match, prop){
            return toString( get(replacements, prop) );
        };
        return template.replace(syntax || stache, replaceFn);
    }

    module.exports = interpolate;



},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js","../object/get":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/get.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/lowerCase.js":[function(require,module,exports){
var toString = require('../lang/toString');
    /**
     * "Safer" String.toLowerCase()
     */
    function lowerCase(str){
        str = toString(str);
        return str.toLowerCase();
    }

    module.exports = lowerCase;


},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/ltrim.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/ltrim.js"][0].apply(exports,arguments)
},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/WHITE_SPACES.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/properCase.js":[function(require,module,exports){
var toString = require('../lang/toString');
var lowerCase = require('./lowerCase');
var upperCase = require('./upperCase');
    /**
     * UPPERCASE first char of each word.
     */
    function properCase(str){
        str = toString(str);
        return lowerCase(str).replace(/^\w|\s\w/g, upperCase);
    }

    module.exports = properCase;


},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js","./lowerCase":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/lowerCase.js","./upperCase":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/upperCase.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/repeat.js":[function(require,module,exports){
var toString = require('../lang/toString');
var toInt = require('../number/toInt');

    /**
     * Repeat string n times
     */
     function repeat(str, n){
         var result = '';
         str = toString(str);
         n = toInt(n);
        if (n < 1) {
            return '';
        }
        while (n > 0) {
            if (n % 2) {
                result += str;
            }
            n = Math.floor(n / 2);
            str += str;
        }
        return result;
     }

     module.exports = repeat;



},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js","../number/toInt":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/number/toInt.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/rpad.js":[function(require,module,exports){
var toString = require('../lang/toString');
var repeat = require('./repeat');

    /**
     * Pad string with `char` if its' length is smaller than `minLen`
     */
    function rpad(str, minLen, ch) {
        str = toString(str);
        ch = ch || ' ';
        return (str.length < minLen)? str + repeat(ch, minLen - str.length) : str;
    }

    module.exports = rpad;



},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js","./repeat":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/repeat.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/rtrim.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/rtrim.js"][0].apply(exports,arguments)
},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/WHITE_SPACES.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/trim.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/trim.js"][0].apply(exports,arguments)
},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js","./WHITE_SPACES":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/WHITE_SPACES.js","./ltrim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/ltrim.js","./rtrim":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/rtrim.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/unescapeHtml.js":[function(require,module,exports){
var toString = require('../lang/toString');

    /**
     * Unescapes HTML special chars
     */
    function unescapeHtml(str){
        str = toString(str)
            .replace(/&amp;/g , '&')
            .replace(/&lt;/g  , '<')
            .replace(/&gt;/g  , '>')
            .replace(/&#0*39;/g , "'")
            .replace(/&quot;/g, '"');
        return str;
    }

    module.exports = unescapeHtml;



},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/unhyphenate.js":[function(require,module,exports){
var toString = require('../lang/toString');
    /**
     * Replaces hyphens with spaces. (only hyphens between word chars)
     */
    function unhyphenate(str){
        str = toString(str);
        return str.replace(/(\w)(-)(\w)/g, '$1 $3');
    }
    module.exports = unhyphenate;


},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/string/upperCase.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/string/upperCase.js"][0].apply(exports,arguments)
},{"../lang/toString":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/toString.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/objectdiff/objectDiff.js":[function(require,module,exports){
var objectDiff = typeof exports != 'undefined' ? exports : {};

/**
 * @param {Object} a
 * @param {Object} b
 * @return {Object}
 */
objectDiff.diff = function diff(a, b) {

    if (a === b) {
        return {
            changed: 'equal',
            value: a
        }
    }

    var value = {};
    var equal = true;

    for (var key in a) {
        if (key in b) {
            if (a[key] === b[key]) {
                value[key] = {
                    changed: 'equal',
                    value: a[key]
                }
            } else {
                var typeA = typeof a[key];
                var typeB = typeof b[key];
                if (a[key] && b[key] && (typeA == 'object' || typeA == 'function') && (typeB == 'object' || typeB == 'function')) {
                    var valueDiff = diff(a[key], b[key]);
                    if (valueDiff.changed == 'equal') {
                        value[key] = {
                            changed: 'equal',
                            value: a[key]
                        }
                    } else {
                        equal = false;
                        value[key] = valueDiff;
                    }
                } else {
                    equal = false;
                    value[key] = {
                        changed: 'primitive change',
                        removed: a[key],
                        added: b[key]
                    }
                }
            }
        } else {
            equal = false;
            value[key] = {
                changed: 'removed',
                value: a[key]
            }
        }
    }

    for (key in b) {
        if (!(key in a)) {
            equal = false;
            value[key] = {
                changed: 'added',
                value: b[key]
            }
        }
    }

    if (equal) {
        return {
            changed: 'equal',
            value: a
        }
    } else {
        return {
            changed: 'object change',
            value: value
        }
    }
};


/**
 * @param {Object} a
 * @param {Object} b
 * @return {Object}
 */
objectDiff.diffOwnProperties = function diffOwnProperties(a, b) {

    if (a === b) {
        return {
            changed: 'equal',
            value: a
        }
    }

    var diff = {};
    var equal = true;
    var keys = Object.keys(a);

    for (var i = 0, length = keys.length; i < length; i++) {
        var key = keys[i];
        if (b.hasOwnProperty(key)) {
            if (a[key] === b[key]) {
                diff[key] = {
                    changed: 'equal',
                    value: a[key]
                }
            } else {
                var typeA = typeof a[key];
                var typeB = typeof b[key];
                if (a[key] && b[key] && (typeA == 'object' || typeA == 'function') && (typeB == 'object' || typeB == 'function')) {
                    var valueDiff = diffOwnProperties(a[key], b[key]);
                    if (valueDiff.changed == 'equal') {
                        diff[key] = {
                            changed: 'equal',
                            value: a[key]
                        }
                    } else {
                        equal = false;
                        diff[key] = valueDiff;
                    }
                } else {
                    equal = false;
                    diff[key] = {
                        changed: 'primitive change',
                        removed: a[key],
                        added: b[key]
                    }
                }
            }
        } else {
            equal = false;
            diff[key] = {
                changed: 'removed',
                value: a[key]
            }
        }
    }

    keys = Object.keys(b);

    for (i = 0, length = keys.length; i < length; i++) {
        key = keys[i];
        if (!a.hasOwnProperty(key)) {
            equal = false;
            diff[key] = {
                changed: 'added',
                value: b[key]
            }
        }
    }

    if (equal) {
        return {
            value: a,
            changed: 'equal'
        }
    } else {
        return {
            changed: 'object change',
            value: diff
        }
    }
};


(function() {

    /**
     * @param {Object} changes
     * @return {string}
     */
    objectDiff.convertToXMLString = function convertToXMLString(changes) {
        var properties = [];

        var diff = changes.value;
        if (changes.changed == 'equal') {
            return inspect(diff);
        }

        for (var key in diff) {
            var changed = diff[key].changed;
            switch (changed) {
                case 'equal':
                    properties.push(stringifyObjectKey(escapeHTML(key)) + '<span>: </span>' + inspect(diff[key].value));
                    break;

                case 'removed':
                    properties.push('<del class="diff">' + stringifyObjectKey(escapeHTML(key)) + '<span>: </span>' + inspect(diff[key].value) + '</del>');
                    break;

                case 'added':
                    properties.push('<ins class="diff">' + stringifyObjectKey(escapeHTML(key)) + '<span>: </span>' + inspect(diff[key].value) + '</ins>');
                    break;

                case 'primitive change':
                    var prefix = stringifyObjectKey(escapeHTML(key)) + '<span>: </span>';
                    properties.push(
                        '<del class="diff diff-key">' + prefix + inspect(diff[key].removed) + '</del><span>,</span>\n' +
                        '<ins class="diff diff-key">' + prefix + inspect(diff[key].added) + '</ins>');
                    break;

                case 'object change':
                    properties.push(stringifyObjectKey(key) + '<span>: </span>' + convertToXMLString(diff[key]));
                    break;
            }
        }

        return '<span>{</span>\n<div class="diff-level">' + properties.join('<span>,</span>\n') + '\n</div><span>}</span>';
    };

    /**
     * @param {string} key
     * @return {string}
     */
    function stringifyObjectKey(key) {
        return /^[a-z0-9_$]*$/i.test(key) ?
            key :
            JSON.stringify(key);
    }

    /**
     * @param {string} string
     * @return {string}
     */
    function escapeHTML(string) {
        return string.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    /**
     * @param {Object} obj
     * @return {string}
     */
    function inspect(obj) {

        return _inspect('', obj);

        /**
         * @param {string} accumulator
         * @param {object} obj
         * @see http://jsperf.com/continuation-passing-style/3
         * @return {string}
         */
        function _inspect(accumulator, obj) {
            switch(typeof obj) {
                case 'object':
                    if (!obj) {
                        accumulator += 'null';
                        break;
                    }
                    var keys = Object.keys(obj);
                    var length = keys.length;
                    if (length === 0) {
                        accumulator += '<span>{}</span>';
                    } else {
                        accumulator += '<span>{</span>\n<div class="diff-level">';
                        for (var i = 0; i < length; i++) {
                            var key = keys[i];
                            accumulator = _inspect(accumulator + stringifyObjectKey(escapeHTML(key)) + '<span>: </span>', obj[key]);
                            if (i < length - 1) {
                                accumulator += '<span>,</span>\n';
                            }
                        }
                        accumulator += '\n</div><span>}</span>'
                    }
                    break;

                case 'string':
                    accumulator += JSON.stringify(escapeHTML(obj));
                    break;

                case 'undefined':
                    accumulator += 'undefined';
                    break;

                default:
                    accumulator += escapeHTML(String(obj));
                    break;
            }
            return accumulator;
        }
    }
})();
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/array/slice.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/array/slice.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/function/bind.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/function/bind.js"][0].apply(exports,arguments)
},{"../array/slice":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/array/slice.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/clone.js":[function(require,module,exports){
var kindOf = require('./kindOf');
var isPlainObject = require('./isPlainObject');
var mixIn = require('../object/mixIn');

    /**
     * Clone native types.
     */
    function clone(val){
        switch (kindOf(val)) {
            case 'Object':
                return cloneObject(val);
            case 'Array':
                return cloneArray(val);
            case 'RegExp':
                return cloneRegExp(val);
            case 'Date':
                return cloneDate(val);
            default:
                return val;
        }
    }

    function cloneObject(source) {
        if (isPlainObject(source)) {
            return mixIn({}, source);
        } else {
            return source;
        }
    }

    function cloneRegExp(r) {
        var flags = '';
        flags += r.multiline ? 'm' : '';
        flags += r.global ? 'g' : '';
        flags += r.ignorecase ? 'i' : '';
        return new RegExp(r.source, flags);
    }

    function cloneDate(date) {
        return new Date(+date);
    }

    function cloneArray(arr) {
        return arr.slice();
    }

    module.exports = clone;



},{"../object/mixIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/mixIn.js","./isPlainObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/isPlainObject.js","./kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/kindOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/deepClone.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/deepClone.js"][0].apply(exports,arguments)
},{"../object/forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/forOwn.js","./clone":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/clone.js","./isPlainObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/isPlainObject.js","./kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/kindOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/isKind.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isKind.js"][0].apply(exports,arguments)
},{"./kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/kindOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/isObject.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/isObject.js"][0].apply(exports,arguments)
},{"./isKind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/isKind.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/isPlainObject.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/lang/isPlainObject.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/kindOf.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/kindOf.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/forIn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forIn.js"][0].apply(exports,arguments)
},{"./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/forOwn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forOwn.js"][0].apply(exports,arguments)
},{"./forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/forIn.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/hasOwn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/hasOwn.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/merge.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/mout/object/merge.js"][0].apply(exports,arguments)
},{"../lang/deepClone":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/deepClone.js","../lang/isObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/lang/isObject.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/mixIn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/mixIn.js"][0].apply(exports,arguments)
},{"./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/bound.js":[function(require,module,exports){
"use strict";

// credits to @cpojer's Class.Binds, released under the MIT license
// https://github.com/cpojer/mootools-class-extras/blob/master/Source/Class.Binds.js

var prime = require("prime")
var bind = require("mout/function/bind")

var bound = prime({

    bound: function(name){
        var bound = this._bound || (this._bound = {})
        return bound[name] || (bound[name] = bind(this[name], this))
    }

})

module.exports = bound

},{"mout/function/bind":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/function/bind.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/prime/options.js":[function(require,module,exports){
"use strict";

var prime = require("prime")
var merge = require("mout/object/merge")

var Options = prime({

    setOptions: function(options){
        var args = [{}, this.options]
        args.push.apply(args, arguments)
        this.options = merge.apply(null, args)
        return this
    }

})

module.exports = Options

},{"mout/object/merge":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime-util/node_modules/mout/object/merge.js","prime":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/defer.js":[function(require,module,exports){
(function (process,global){
/*
defer
*/"use strict"

var kindOf  = require("mout/lang/kindOf"),
    now     = require("mout/time/now"),
    forEach = require("mout/array/forEach"),
    indexOf = require("mout/array/indexOf")

var callbacks = {
    timeout: {},
    frame: [],
    immediate: []
}

var push = function(collection, callback, context, defer){

    var iterator = function(){
        iterate(collection)
    }

    if (!collection.length) defer(iterator)

    var entry = {
        callback: callback,
        context: context
    }

    collection.push(entry)

    return function(){
        var io = indexOf(collection, entry)
        if (io > -1) collection.splice(io, 1)
    }
}

var iterate = function(collection){
    var time = now()

    forEach(collection.splice(0), function(entry) {
        entry.callback.call(entry.context, time)
    })
}

var defer = function(callback, argument, context){
    return (kindOf(argument) === "Number") ? defer.timeout(callback, argument, context) : defer.immediate(callback, argument)
}

if (global.process && process.nextTick){

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, process.nextTick)
    }

} else if (global.setImmediate){

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, setImmediate)
    }

} else if (global.postMessage && global.addEventListener){

    addEventListener("message", function(event){
        if (event.source === global && event.data === "@deferred"){
            event.stopPropagation()
            iterate(callbacks.immediate)
        }
    }, true)

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, function(){
            postMessage("@deferred", "*")
        })
    }

} else {

    defer.immediate = function(callback, context){
        return push(callbacks.immediate, callback, context, function(iterator){
            setTimeout(iterator, 0)
        })
    }

}

var requestAnimationFrame = global.requestAnimationFrame ||
    global.webkitRequestAnimationFrame ||
    global.mozRequestAnimationFrame ||
    global.oRequestAnimationFrame ||
    global.msRequestAnimationFrame ||
    function(callback) {
        setTimeout(callback, 1e3 / 60)
    }

defer.frame = function(callback, context){
    return push(callbacks.frame, callback, context, requestAnimationFrame)
}

var clear

defer.timeout = function(callback, ms, context){
    var ct = callbacks.timeout

    if (!clear) clear = defer.immediate(function(){
        clear = null
        callbacks.timeout = {}
    })

    return push(ct[ms] || (ct[ms] = []), callback, context, function(iterator){
        setTimeout(iterator, ms)
    })
}

module.exports = defer

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"_process":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/browserify/node_modules/process/browser.js","mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/array/forEach.js","mout/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/array/indexOf.js","mout/lang/kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/lang/kindOf.js","mout/time/now":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/time/now.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/emitter.js":[function(require,module,exports){
/*
Emitter
*/"use strict"

var indexOf = require("mout/array/indexOf"),
    forEach = require("mout/array/forEach")

var prime = require("./index"),
    defer = require("./defer")

var slice = Array.prototype.slice;

var Emitter = prime({

    on: function(event, fn){
        var listeners = this._listeners || (this._listeners = {}),
            events = listeners[event] || (listeners[event] = [])

        if (indexOf(events, fn) === -1) events.push(fn)

        return this
    },

    off: function(event, fn){
        var listeners = this._listeners, events, key, length = 0
        if (listeners && (events = listeners[event])){

            var io = indexOf(events, fn)
            if (io > -1) events.splice(io, 1)
            if (!events.length) delete listeners[event];
            for (var l in listeners) return this
            delete this._listeners
        }
        return this
    },

    emit: function(event){
        var self = this,
            args = slice.call(arguments, 1)

        var emit = function(){
            var listeners = self._listeners, events
            if (listeners && (events = listeners[event])){
                forEach(events.slice(0), function(event){
                    return event.apply(self, args)
                })
            }
        }

        if (args[args.length - 1] === Emitter.EMIT_SYNC){
            args.pop()
            emit()
        } else {
            defer(emit)
        }

        return this
    }

})

Emitter.EMIT_SYNC = {}

module.exports = Emitter

},{"./defer":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/defer.js","./index":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","mout/array/forEach":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/array/forEach.js","mout/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/array/indexOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js":[function(require,module,exports){
/*
prime
 - prototypal inheritance
*/"use strict"

var hasOwn = require("mout/object/hasOwn"),
    mixIn  = require("mout/object/mixIn"),
    create = require("mout/lang/createObject"),
    kindOf = require("mout/lang/kindOf")

var hasDescriptors = true

try {
    Object.defineProperty({}, "~", {})
    Object.getOwnPropertyDescriptor({}, "~")
} catch (e){
    hasDescriptors = false
}

// we only need to be able to implement "toString" and "valueOf" in IE < 9
var hasEnumBug = !({valueOf: 0}).propertyIsEnumerable("valueOf"),
    buggy      = ["toString", "valueOf"]

var verbs = /^constructor|inherits|mixin$/

var implement = function(proto){
    var prototype = this.prototype

    for (var key in proto){
        if (key.match(verbs)) continue
        if (hasDescriptors){
            var descriptor = Object.getOwnPropertyDescriptor(proto, key)
            if (descriptor){
                Object.defineProperty(prototype, key, descriptor)
                continue
            }
        }
        prototype[key] = proto[key]
    }

    if (hasEnumBug) for (var i = 0; (key = buggy[i]); i++){
        var value = proto[key]
        if (value !== Object.prototype[key]) prototype[key] = value
    }

    return this
}

var prime = function(proto){

    if (kindOf(proto) === "Function") proto = {constructor: proto}

    var superprime = proto.inherits

    // if our nice proto object has no own constructor property
    // then we proceed using a ghosting constructor that all it does is
    // call the parent's constructor if it has a superprime, else an empty constructor
    // proto.constructor becomes the effective constructor
    var constructor = (hasOwn(proto, "constructor")) ? proto.constructor : (superprime) ? function(){
        return superprime.apply(this, arguments)
    } : function(){}

    if (superprime){

        mixIn(constructor, superprime)

        var superproto = superprime.prototype
        // inherit from superprime
        var cproto = constructor.prototype = create(superproto)

        // setting constructor.parent to superprime.prototype
        // because it's the shortest possible absolute reference
        constructor.parent = superproto
        cproto.constructor = constructor
    }

    if (!constructor.implement) constructor.implement = implement

    var mixins = proto.mixin
    if (mixins){
        if (kindOf(mixins) !== "Array") mixins = [mixins]
        for (var i = 0; i < mixins.length; i++) constructor.implement(create(mixins[i].prototype))
    }

    // implement proto and return constructor
    return constructor.implement(proto)

}

module.exports = prime

},{"mout/lang/createObject":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/lang/createObject.js","mout/lang/kindOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/lang/kindOf.js","mout/object/hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/hasOwn.js","mout/object/mixIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/mixIn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/map.js":[function(require,module,exports){
/*
Map
*/"use strict"

var indexOf = require("mout/array/indexOf")

var prime = require("./index")

var Map = prime({

    constructor: function Map(){
        this.length = 0
        this._values = []
        this._keys = []
    },

    set: function(key, value){
        var index = indexOf(this._keys, key)

        if (index === -1){
            this._keys.push(key)
            this._values.push(value)
            this.length++
        } else {
            this._values[index] = value
        }

        return this
    },

    get: function(key){
        var index = indexOf(this._keys, key)
        return (index === -1) ? null : this._values[index]
    },

    count: function(){
        return this.length
    },

    forEach: function(method, context){
        for (var i = 0, l = this.length; i < l; i++){
            if (method.call(context, this._values[i], this._keys[i], this) === false) break
        }
        return this
    },

    map: function(method, context){
        var results = new Map
        this.forEach(function(value, key){
            results.set(key, method.call(context, value, key, this))
        }, this)
        return results
    },

    filter: function(method, context){
        var results = new Map
        this.forEach(function(value, key){
            if (method.call(context, value, key, this)) results.set(key, value)
        }, this)
        return results
    },

    every: function(method, context){
        var every = true
        this.forEach(function(value, key){
            if (!method.call(context, value, key, this)) return (every = false)
        }, this)
        return every
    },

    some: function(method, context){
        var some = false
        this.forEach(function(value, key){
            if (method.call(context, value, key, this)) return !(some = true)
        }, this)
        return some
    },

    indexOf: function(value){
        var index = indexOf(this._values, value)
        return (index > -1) ? this._keys[index] : null
    },

    remove: function(value){
        var index = indexOf(this._values, value)

        if (index !== -1){
            this._values.splice(index, 1)
            this.length--
            return this._keys.splice(index, 1)[0]
        }

        return null
    },

    unset: function(key){
        var index = indexOf(this._keys, key)

        if (index !== -1){
            this._keys.splice(index, 1)
            this.length--
            return this._values.splice(index, 1)[0]
        }

        return null
    },

    keys: function(){
        return this._keys.slice()
    },

    values: function(){
        return this._values.slice()
    }

})

var map = function(){
    return new Map
}

map.prototype = Map.prototype

module.exports = map

},{"./index":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/index.js","mout/array/indexOf":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/array/indexOf.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/array/forEach.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/forEach.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/array/indexOf.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/array/indexOf.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/lang/createObject.js":[function(require,module,exports){
var mixIn = require('../object/mixIn');

    /**
     * Create Object using prototypal inheritance and setting custom properties.
     * - Mix between Douglas Crockford Prototypal Inheritance <http://javascript.crockford.com/prototypal.html> and the EcmaScript 5 `Object.create()` method.
     * @param {object} parent    Parent Object.
     * @param {object} [props] Object properties.
     * @return {object} Created object.
     */
    function createObject(parent, props){
        function F(){}
        F.prototype = parent;
        return mixIn(new F(), props);

    }
    module.exports = createObject;



},{"../object/mixIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/mixIn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/lang/kindOf.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/lang/kindOf.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/forIn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forIn.js"][0].apply(exports,arguments)
},{"./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/forOwn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/forOwn.js"][0].apply(exports,arguments)
},{"./forIn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/forIn.js","./hasOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/hasOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/hasOwn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/hasOwn.js"][0].apply(exports,arguments)
},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/mixIn.js":[function(require,module,exports){
arguments[4]["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/agent/node_modules/mout/object/mixIn.js"][0].apply(exports,arguments)
},{"./forOwn":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/object/forOwn.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/prime/node_modules/mout/time/now.js":[function(require,module,exports){


    /**
     * Get current time in miliseconds
     */
    function now(){
        // yes, we defer the work to another function to allow mocking it
        // during the tests
        return now.get();
    }

    now.get = (typeof Date.now === 'function')? Date.now : function(){
        return +(new Date());
    };

    module.exports = now;



},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/sifter/sifter.js":[function(require,module,exports){
/**
 * sifter.js
 * Copyright (c) 2013 Brian Reavis & contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain a copy of the License at:
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
 * ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 *
 * @author Brian Reavis <brian@thirdroute.com>
 */

(function(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define(factory);
	} else if (typeof exports === 'object') {
		module.exports = factory();
	} else {
		root.Sifter = factory();
	}
}(this, function() {

	/**
	 * Textually searches arrays and hashes of objects
	 * by property (or multiple properties). Designed
	 * specifically for autocomplete.
	 *
	 * @constructor
	 * @param {array|object} items
	 * @param {object} items
	 */
	var Sifter = function(items, settings) {
		this.items = items;
		this.settings = settings || {diacritics: true};
	};

	/**
	 * Splits a search string into an array of individual
	 * regexps to be used to match results.
	 *
	 * @param {string} query
	 * @returns {array}
	 */
	Sifter.prototype.tokenize = function(query) {
		query = trim(String(query || '').toLowerCase());
		if (!query || !query.length) return [];

		var i, n, regex, letter;
		var tokens = [];
		var words = query.split(/ +/);

		for (i = 0, n = words.length; i < n; i++) {
			regex = escape_regex(words[i]);
			if (this.settings.diacritics) {
				for (letter in DIACRITICS) {
					if (DIACRITICS.hasOwnProperty(letter)) {
						regex = regex.replace(new RegExp(letter, 'g'), DIACRITICS[letter]);
					}
				}
			}
			tokens.push({
				string : words[i],
				regex  : new RegExp(regex, 'i')
			});
		}

		return tokens;
	};

	/**
	 * Iterates over arrays and hashes.
	 *
	 * ```
	 * this.iterator(this.items, function(item, id) {
	 *    // invoked for each item
	 * });
	 * ```
	 *
	 * @param {array|object} object
	 */
	Sifter.prototype.iterator = function(object, callback) {
		var iterator;
		if (is_array(object)) {
			iterator = Array.prototype.forEach || function(callback) {
				for (var i = 0, n = this.length; i < n; i++) {
					callback(this[i], i, this);
				}
			};
		} else {
			iterator = function(callback) {
				for (var key in this) {
					if (this.hasOwnProperty(key)) {
						callback(this[key], key, this);
					}
				}
			};
		}

		iterator.apply(object, [callback]);
	};

	/**
	 * Returns a function to be used to score individual results.
	 *
	 * Good matches will have a higher score than poor matches.
	 * If an item is not a match, 0 will be returned by the function.
	 *
	 * @param {object|string} search
	 * @param {object} options (optional)
	 * @returns {function}
	 */
	Sifter.prototype.getScoreFunction = function(search, options) {
		var self, fields, tokens, token_count;

		self        = this;
		search      = self.prepareSearch(search, options);
		tokens      = search.tokens;
		fields      = search.options.fields;
		token_count = tokens.length;

		/**
		 * Calculates how close of a match the
		 * given value is against a search token.
		 *
		 * @param {mixed} value
		 * @param {object} token
		 * @return {number}
		 */
		var scoreValue = function(value, token) {
			var score, pos;

			if (!value) return 0;
			value = String(value || '');
			pos = value.search(token.regex);
			if (pos === -1) return 0;
			score = token.string.length / value.length;
			if (pos === 0) score += 0.5;
			return score;
		};

		/**
		 * Calculates the score of an object
		 * against the search query.
		 *
		 * @param {object} token
		 * @param {object} data
		 * @return {number}
		 */
		var scoreObject = (function() {
			var field_count = fields.length;
			if (!field_count) {
				return function() { return 0; };
			}
			if (field_count === 1) {
				return function(token, data) {
					return scoreValue(data[fields[0]], token);
				};
			}
			return function(token, data) {
				for (var i = 0, sum = 0; i < field_count; i++) {
					sum += scoreValue(data[fields[i]], token);
				}
				return sum / field_count;
			};
		})();

		if (!token_count) {
			return function() { return 0; };
		}
		if (token_count === 1) {
			return function(data) {
				return scoreObject(tokens[0], data);
			};
		}

		if (search.options.conjunction === 'and') {
			return function(data) {
				var score;
				for (var i = 0, sum = 0; i < token_count; i++) {
					score = scoreObject(tokens[i], data);
					if (score <= 0) return 0;
					sum += score;
				}
				return sum / token_count;
			};
		} else {
			return function(data) {
				for (var i = 0, sum = 0; i < token_count; i++) {
					sum += scoreObject(tokens[i], data);
				}
				return sum / token_count;
			};
		}
	};

	/**
	 * Returns a function that can be used to compare two
	 * results, for sorting purposes. If no sorting should
	 * be performed, `null` will be returned.
	 *
	 * @param {string|object} search
	 * @param {object} options
	 * @return function(a,b)
	 */
	Sifter.prototype.getSortFunction = function(search, options) {
		var i, n, self, field, fields, fields_count, multiplier, multipliers, get_field, implicit_score, sort;

		self   = this;
		search = self.prepareSearch(search, options);
		sort   = (!search.query && options.sort_empty) || options.sort;

		/**
		 * Fetches the specified sort field value
		 * from a search result item.
		 *
		 * @param  {string} name
		 * @param  {object} result
		 * @return {mixed}
		 */
		get_field = function(name, result) {
			if (name === '$score') return result.score;
			return self.items[result.id][name];
		};

		// parse options
		fields = [];
		if (sort) {
			for (i = 0, n = sort.length; i < n; i++) {
				if (search.query || sort[i].field !== '$score') {
					fields.push(sort[i]);
				}
			}
		}

		// the "$score" field is implied to be the primary
		// sort field, unless it's manually specified
		if (search.query) {
			implicit_score = true;
			for (i = 0, n = fields.length; i < n; i++) {
				if (fields[i].field === '$score') {
					implicit_score = false;
					break;
				}
			}
			if (implicit_score) {
				fields.unshift({field: '$score', direction: 'desc'});
			}
		} else {
			for (i = 0, n = fields.length; i < n; i++) {
				if (fields[i].field === '$score') {
					fields.splice(i, 1);
					break;
				}
			}
		}

		multipliers = [];
		for (i = 0, n = fields.length; i < n; i++) {
			multipliers.push(fields[i].direction === 'desc' ? -1 : 1);
		}

		// build function
		fields_count = fields.length;
		if (!fields_count) {
			return null;
		} else if (fields_count === 1) {
			field = fields[0].field;
			multiplier = multipliers[0];
			return function(a, b) {
				return multiplier * cmp(
					get_field(field, a),
					get_field(field, b)
				);
			};
		} else {
			return function(a, b) {
				var i, result, a_value, b_value, field;
				for (i = 0; i < fields_count; i++) {
					field = fields[i].field;
					result = multipliers[i] * cmp(
						get_field(field, a),
						get_field(field, b)
					);
					if (result) return result;
				}
				return 0;
			};
		}
	};

	/**
	 * Parses a search query and returns an object
	 * with tokens and fields ready to be populated
	 * with results.
	 *
	 * @param {string} query
	 * @param {object} options
	 * @returns {object}
	 */
	Sifter.prototype.prepareSearch = function(query, options) {
		if (typeof query === 'object') return query;

		options = extend({}, options);

		var option_fields     = options.fields;
		var option_sort       = options.sort;
		var option_sort_empty = options.sort_empty;

		if (option_fields && !is_array(option_fields)) options.fields = [option_fields];
		if (option_sort && !is_array(option_sort)) options.sort = [option_sort];
		if (option_sort_empty && !is_array(option_sort_empty)) options.sort_empty = [option_sort_empty];

		return {
			options : options,
			query   : String(query || '').toLowerCase(),
			tokens  : this.tokenize(query),
			total   : 0,
			items   : []
		};
	};

	/**
	 * Searches through all items and returns a sorted array of matches.
	 *
	 * The `options` parameter can contain:
	 *
	 *   - fields {string|array}
	 *   - sort {array}
	 *   - score {function}
	 *   - filter {bool}
	 *   - limit {integer}
	 *
	 * Returns an object containing:
	 *
	 *   - options {object}
	 *   - query {string}
	 *   - tokens {array}
	 *   - total {int}
	 *   - items {array}
	 *
	 * @param {string} query
	 * @param {object} options
	 * @returns {object}
	 */
	Sifter.prototype.search = function(query, options) {
		var self = this, value, score, search, calculateScore;
		var fn_sort;
		var fn_score;

		search  = this.prepareSearch(query, options);
		options = search.options;
		query   = search.query;

		// generate result scoring function
		fn_score = options.score || self.getScoreFunction(search);

		// perform search and sort
		if (query.length) {
			self.iterator(self.items, function(item, id) {
				score = fn_score(item);
				if (options.filter === false || score > 0) {
					search.items.push({'score': score, 'id': id});
				}
			});
		} else {
			self.iterator(self.items, function(item, id) {
				search.items.push({'score': 1, 'id': id});
			});
		}

		fn_sort = self.getSortFunction(search, options);
		if (fn_sort) search.items.sort(fn_sort);

		// apply limits
		search.total = search.items.length;
		if (typeof options.limit === 'number') {
			search.items = search.items.slice(0, options.limit);
		}

		return search;
	};

	// utilities
	// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	var cmp = function(a, b) {
		if (typeof a === 'number' && typeof b === 'number') {
			return a > b ? 1 : (a < b ? -1 : 0);
		}
		a = asciifold(String(a || ''));
		b = asciifold(String(b || ''));
		if (a > b) return 1;
		if (b > a) return -1;
		return 0;
	};

	var extend = function(a, b) {
		var i, n, k, object;
		for (i = 1, n = arguments.length; i < n; i++) {
			object = arguments[i];
			if (!object) continue;
			for (k in object) {
				if (object.hasOwnProperty(k)) {
					a[k] = object[k];
				}
			}
		}
		return a;
	};

	var trim = function(str) {
		return (str + '').replace(/^\s+|\s+$|/g, '');
	};

	var escape_regex = function(str) {
		return (str + '').replace(/([.?*+^$[\]\\(){}|-])/g, '\\$1');
	};

	var is_array = Array.isArray || ($ && $.isArray) || function(object) {
		return Object.prototype.toString.call(object) === '[object Array]';
	};

	var DIACRITICS = {
		'a': '[a]',
		'c': '[c]',
		'd': '[d]',
		'e': '[e]',
		'i': '[i]',
		'l': '[l]',
		'n': '[n]',
		'o': '[o]',
		'r': '[r]',
		's': '[s]',
		't': '[t]',
		'u': '[u]',
		'y': '[y]',
		'z': '[z]'
	};

	var asciifold = (function() {
		var i, n, k, chunk;
		var foreignletters = '';
		var lookup = {};
		for (k in DIACRITICS) {
			if (DIACRITICS.hasOwnProperty(k)) {
				chunk = DIACRITICS[k].substring(2, DIACRITICS[k].length - 1);
				foreignletters += chunk;
				for (i = 0, n = chunk.length; i < n; i++) {
					lookup[chunk.charAt(i)] = k;
				}
			}
		}
		var regexp = new RegExp('[' +  foreignletters + ']', 'g');
		return function(str) {
			return str.replace(regexp, function(foreignletter) {
				return lookup[foreignletter];
			}).toLowerCase();
		};
	})();


	// export
	// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	return Sifter;
}));


},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/finder.js":[function(require,module,exports){
/*
Slick Finder
*/"use strict"

// Notable changes from Slick.Finder 1.0.x

// faster bottom -> up expression matching
// prefers mental sanity over *obsessive compulsive* milliseconds savings
// uses prototypes instead of objects
// tries to use matchesSelector smartly, whenever available
// can populate objects as well as arrays
// lots of stuff is broken or not implemented

var parse = require("./parser")

// utilities

var index = 0,
    counter = document.__counter = (parseInt(document.__counter || -1, 36) + 1).toString(36),
    key = "uid:" + counter

var uniqueID = function(n, xml){
    if (n === window) return "window"
    if (n === document) return "document"
    if (n === document.documentElement) return "html"

    if (xml) {
        var uid = n.getAttribute(key)
        if (!uid) {
            uid = (index++).toString(36)
            n.setAttribute(key, uid)
        }
        return uid
    } else {
        return n[key] || (n[key] = (index++).toString(36))
    }
}

var uniqueIDXML = function(n) {
    return uniqueID(n, true)
}

var isArray = Array.isArray || function(object){
    return Object.prototype.toString.call(object) === "[object Array]"
}

// tests

var uniqueIndex = 0;

var HAS = {

    GET_ELEMENT_BY_ID: function(test, id){
        id = "slick_" + (uniqueIndex++);
        // checks if the document has getElementById, and it works
        test.innerHTML = '<a id="' + id + '"></a>'
        return !!this.getElementById(id)
    },

    QUERY_SELECTOR: function(test){
        // this supposedly fixes a webkit bug with matchesSelector / querySelector & nth-child
        test.innerHTML = '_<style>:nth-child(2){}</style>'

        // checks if the document has querySelectorAll, and it works
        test.innerHTML = '<a class="MiX"></a>'

        return test.querySelectorAll('.MiX').length === 1
    },

    EXPANDOS: function(test, id){
        id = "slick_" + (uniqueIndex++);
        // checks if the document has elements that support expandos
        test._custom_property_ = id
        return test._custom_property_ === id
    },

    // TODO: use this ?

    // CHECKED_QUERY_SELECTOR: function(test){
    //
    //     // checks if the document supports the checked query selector
    //     test.innerHTML = '<select><option selected="selected">a</option></select>'
    //     return test.querySelectorAll(':checked').length === 1
    // },

    // TODO: use this ?

    // EMPTY_ATTRIBUTE_QUERY_SELECTOR: function(test){
    //
    //     // checks if the document supports the empty attribute query selector
    //     test.innerHTML = '<a class=""></a>'
    //     return test.querySelectorAll('[class*=""]').length === 1
    // },

    MATCHES_SELECTOR: function(test){

        test.className = "MiX"

        // checks if the document has matchesSelector, and we can use it.

        var matches = test.matchesSelector || test.mozMatchesSelector || test.webkitMatchesSelector

        // if matchesSelector trows errors on incorrect syntax we can use it
        if (matches) try {
            matches.call(test, ':slick')
        } catch(e){
            // just as a safety precaution, also test if it works on mixedcase (like querySelectorAll)
            return matches.call(test, ".MiX") ? matches : false
        }

        return false
    },

    GET_ELEMENTS_BY_CLASS_NAME: function(test){
        test.innerHTML = '<a class="f"></a><a class="b"></a>'
        if (test.getElementsByClassName('b').length !== 1) return false

        test.firstChild.className = 'b'
        if (test.getElementsByClassName('b').length !== 2) return false

        // Opera 9.6 getElementsByClassName doesnt detects the class if its not the first one
        test.innerHTML = '<a class="a"></a><a class="f b a"></a>'
        if (test.getElementsByClassName('a').length !== 2) return false

        // tests passed
        return true
    },

    // no need to know

    // GET_ELEMENT_BY_ID_NOT_NAME: function(test, id){
    //     test.innerHTML = '<a name="'+ id +'"></a><b id="'+ id +'"></b>'
    //     return this.getElementById(id) !== test.firstChild
    // },

    // this is always checked for and fixed

    // STAR_GET_ELEMENTS_BY_TAG_NAME: function(test){
    //
    //     // IE returns comment nodes for getElementsByTagName('*') for some documents
    //     test.appendChild(this.createComment(''))
    //     if (test.getElementsByTagName('*').length > 0) return false
    //
    //     // IE returns closed nodes (EG:"</foo>") for getElementsByTagName('*') for some documents
    //     test.innerHTML = 'foo</foo>'
    //     if (test.getElementsByTagName('*').length) return false
    //
    //     // tests passed
    //     return true
    // },

    // this is always checked for and fixed

    // STAR_QUERY_SELECTOR: function(test){
    //
    //     // returns closed nodes (EG:"</foo>") for querySelector('*') for some documents
    //     test.innerHTML = 'foo</foo>'
    //     return !!(test.querySelectorAll('*').length)
    // },

    GET_ATTRIBUTE: function(test){
        // tests for working getAttribute implementation
        var shout = "fus ro dah"
        test.innerHTML = '<a class="' + shout + '"></a>'
        return test.firstChild.getAttribute('class') === shout
    }

}

// Finder

var Finder = function Finder(document){

    this.document        = document
    var root = this.root = document.documentElement
    this.tested          = {}

    // uniqueID

    this.uniqueID = this.has("EXPANDOS") ? uniqueID : uniqueIDXML

    // getAttribute

    this.getAttribute = (this.has("GET_ATTRIBUTE")) ? function(node, name){

        return node.getAttribute(name)

    } : function(node, name){

        node = node.getAttributeNode(name)
        return (node && node.specified) ? node.value : null

    }

    // hasAttribute

    this.hasAttribute = (root.hasAttribute) ? function(node, attribute){

        return node.hasAttribute(attribute)

    } : function(node, attribute) {

        node = node.getAttributeNode(attribute)
        return !!(node && node.specified)

    }

    // contains

    this.contains = (document.contains && root.contains) ? function(context, node){

        return context.contains(node)

    } : (root.compareDocumentPosition) ? function(context, node){

        return context === node || !!(context.compareDocumentPosition(node) & 16)

    } : function(context, node){

        do {
            if (node === context) return true
        } while ((node = node.parentNode))

        return false
    }

    // sort
    // credits to Sizzle (http://sizzlejs.com/)

    this.sorter = (root.compareDocumentPosition) ? function(a, b){

        if (!a.compareDocumentPosition || !b.compareDocumentPosition) return 0
        return a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1

    } : ('sourceIndex' in root) ? function(a, b){

        if (!a.sourceIndex || !b.sourceIndex) return 0
        return a.sourceIndex - b.sourceIndex

    } : (document.createRange) ? function(a, b){

        if (!a.ownerDocument || !b.ownerDocument) return 0
        var aRange = a.ownerDocument.createRange(),
            bRange = b.ownerDocument.createRange()

        aRange.setStart(a, 0)
        aRange.setEnd(a, 0)
        bRange.setStart(b, 0)
        bRange.setEnd(b, 0)
        return aRange.compareBoundaryPoints(Range.START_TO_END, bRange)

    } : null

    this.failed = {}

    var nativeMatches = this.has("MATCHES_SELECTOR")

    if (nativeMatches) this.matchesSelector = function(node, expression){

        if (this.failed[expression]) return null

        try {
            return nativeMatches.call(node, expression)
        } catch(e){
            if (slick.debug) console.warn("matchesSelector failed on " + expression)
            this.failed[expression] = true
            return null
        }

    }

    if (this.has("QUERY_SELECTOR")){

        this.querySelectorAll = function(node, expression){

            if (this.failed[expression]) return true

            var result, _id, _expression, _combinator, _node


            // non-document rooted QSA
            // credits to Andrew Dupont

            if (node !== this.document){

                _combinator = expression[0].combinator

                _id         = node.getAttribute("id")
                _expression = expression

                if (!_id){
                    _node = node
                    _id = "__slick__"
                    _node.setAttribute("id", _id)
                }

                expression = "#" + _id + " " + _expression


                // these combinators need a parentNode due to how querySelectorAll works, which is:
                // finding all the elements that match the given selector
                // then filtering by the ones that have the specified element as an ancestor
                if (_combinator.indexOf("~") > -1 || _combinator.indexOf("+") > -1){

                    node = node.parentNode
                    if (!node) result = true
                    // if node has no parentNode, we return "true" as if it failed, without polluting the failed cache

                }

            }

            if (!result) try {
                result = node.querySelectorAll(expression.toString())
            } catch(e){
                if (slick.debug) console.warn("querySelectorAll failed on " + (_expression || expression))
                result = this.failed[_expression || expression] = true
            }

            if (_node) _node.removeAttribute("id")

            return result

        }

    }

}

Finder.prototype.has = function(FEATURE){

    var tested        = this.tested,
        testedFEATURE = tested[FEATURE]

    if (testedFEATURE != null) return testedFEATURE

    var root     = this.root,
        document = this.document,
        testNode = document.createElement("div")

    testNode.setAttribute("style", "display: none;")

    root.appendChild(testNode)

    var TEST = HAS[FEATURE], result = false

    if (TEST) try {
        result = TEST.call(document, testNode)
    } catch(e){}

    if (slick.debug && !result) console.warn("document has no " + FEATURE)

    root.removeChild(testNode)

    return tested[FEATURE] = result

}

var combinators = {

    " ": function(node, part, push){

        var item, items

        var noId = !part.id, noTag = !part.tag, noClass = !part.classes

        if (part.id && node.getElementById && this.has("GET_ELEMENT_BY_ID")){
            item = node.getElementById(part.id)

            // return only if id is found, else keep checking
            // might be a tad slower on non-existing ids, but less insane

            if (item && item.getAttribute('id') === part.id){
                items = [item]
                noId = true
                // if tag is star, no need to check it in match()
                if (part.tag === "*") noTag = true
            }
        }

        if (!items){

            if (part.classes && node.getElementsByClassName && this.has("GET_ELEMENTS_BY_CLASS_NAME")){
                items = node.getElementsByClassName(part.classList)
                noClass = true
                // if tag is star, no need to check it in match()
                if (part.tag === "*") noTag = true
            } else {
                items = node.getElementsByTagName(part.tag)
                // if tag is star, need to check it in match because it could select junk, boho
                if (part.tag !== "*") noTag = true
            }

            if (!items || !items.length) return false

        }

        for (var i = 0; item = items[i++];)
            if ((noTag && noId && noClass && !part.attributes && !part.pseudos) || this.match(item, part, noTag, noId, noClass))
                push(item)

        return true

    },

    ">": function(node, part, push){ // direct children
        if ((node = node.firstChild)) do {
            if (node.nodeType == 1 && this.match(node, part)) push(node)
        } while ((node = node.nextSibling))
    },

    "+": function(node, part, push){ // next sibling
        while ((node = node.nextSibling)) if (node.nodeType == 1){
            if (this.match(node, part)) push(node)
            break
        }
    },

    "^": function(node, part, push){ // first child
        node = node.firstChild
        if (node){
            if (node.nodeType === 1){
                if (this.match(node, part)) push(node)
            } else {
                combinators['+'].call(this, node, part, push)
            }
        }
    },

    "~": function(node, part, push){ // next siblings
        while ((node = node.nextSibling)){
            if (node.nodeType === 1 && this.match(node, part)) push(node)
        }
    },

    "++": function(node, part, push){ // next sibling and previous sibling
        combinators['+'].call(this, node, part, push)
        combinators['!+'].call(this, node, part, push)
    },

    "~~": function(node, part, push){ // next siblings and previous siblings
        combinators['~'].call(this, node, part, push)
        combinators['!~'].call(this, node, part, push)
    },

    "!": function(node, part, push){ // all parent nodes up to document
        while ((node = node.parentNode)) if (node !== this.document && this.match(node, part)) push(node)
    },

    "!>": function(node, part, push){ // direct parent (one level)
        node = node.parentNode
        if (node !== this.document && this.match(node, part)) push(node)
    },

    "!+": function(node, part, push){ // previous sibling
        while ((node = node.previousSibling)) if (node.nodeType == 1){
            if (this.match(node, part)) push(node)
            break
        }
    },

    "!^": function(node, part, push){ // last child
        node = node.lastChild
        if (node){
            if (node.nodeType == 1){
                if (this.match(node, part)) push(node)
            } else {
                combinators['!+'].call(this, node, part, push)
            }
        }
    },

    "!~": function(node, part, push){ // previous siblings
        while ((node = node.previousSibling)){
            if (node.nodeType === 1 && this.match(node, part)) push(node)
        }
    }

}

Finder.prototype.search = function(context, expression, found){

    if (!context) context = this.document
    else if (!context.nodeType && context.document) context = context.document

    var expressions = parse(expression)

    // no expressions were parsed. todo: is this really necessary?
    if (!expressions || !expressions.length) throw new Error("invalid expression")

    if (!found) found = []

    var uniques, push = isArray(found) ? function(node){
        found[found.length] = node
    } : function(node){
        found[found.length++] = node
    }

    // if there is more than one expression we need to check for duplicates when we push to found
    // this simply saves the old push and wraps it around an uid dupe check.
    if (expressions.length > 1){
        uniques = {}
        var plush = push
        push = function(node){
            var uid = uniqueID(node)
            if (!uniques[uid]){
                uniques[uid] = true
                plush(node)
            }
        }
    }

    // walker

    var node, nodes, part

    main: for (var i = 0; expression = expressions[i++];){

        // querySelector

        // TODO: more functional tests

        // if there is querySelectorAll (and the expression does not fail) use it.
        if (!slick.noQSA && this.querySelectorAll){

            nodes = this.querySelectorAll(context, expression)
            if (nodes !== true){
                if (nodes && nodes.length) for (var j = 0; node = nodes[j++];) if (node.nodeName > '@'){
                    push(node)
                }
                continue main
            }
        }

        // if there is only one part in the expression we don't need to check each part for duplicates.
        // todo: this might be too naive. while solid, there can be expression sequences that do not
        // produce duplicates. "body div" for instance, can never give you each div more than once.
        // "body div a" on the other hand might.
        if (expression.length === 1){

            part = expression[0]
            combinators[part.combinator].call(this, context, part, push)

        } else {

            var cs = [context], c, f, u, p = function(node){
                var uid = uniqueID(node)
                if (!u[uid]){
                    u[uid] = true
                    f[f.length] = node
                }
            }

            // loop the expression parts
            for (var j = 0; part = expression[j++];){
                f = []; u = {}
                // loop the contexts
                for (var k = 0; c = cs[k++];) combinators[part.combinator].call(this, c, part, p)
                // nothing was found, the expression failed, continue to the next expression.
                if (!f.length) continue main
                cs = f // set the contexts for future parts (if any)
            }

            if (i === 0) found = f // first expression. directly set found.
            else for (var l = 0; l < f.length; l++) push(f[l]) // any other expression needs to push to found.
        }

    }

    if (uniques && found && found.length > 1) this.sort(found)

    return found

}

Finder.prototype.sort = function(nodes){
    return this.sorter ? Array.prototype.sort.call(nodes, this.sorter) : nodes
}

// TODO: most of these pseudo selectors include <html> and qsa doesnt. fixme.

var pseudos = {


    // TODO: returns different results than qsa empty.

    'empty': function(){
        return !(this && this.nodeType === 1) && !(this.innerText || this.textContent || '').length
    },

    'not': function(expression){
        return !slick.match(this, expression)
    },

    'contains': function(text){
        return (this.innerText || this.textContent || '').indexOf(text) > -1
    },

    'first-child': function(){
        var node = this
        while ((node = node.previousSibling)) if (node.nodeType == 1) return false
        return true
    },

    'last-child': function(){
        var node = this
        while ((node = node.nextSibling)) if (node.nodeType == 1) return false
        return true
    },

    'only-child': function(){
        var prev = this
        while ((prev = prev.previousSibling)) if (prev.nodeType == 1) return false

        var next = this
        while ((next = next.nextSibling)) if (next.nodeType == 1) return false

        return true
    },

    'first-of-type': function(){
        var node = this, nodeName = node.nodeName
        while ((node = node.previousSibling)) if (node.nodeName == nodeName) return false
        return true
    },

    'last-of-type': function(){
        var node = this, nodeName = node.nodeName
        while ((node = node.nextSibling)) if (node.nodeName == nodeName) return false
        return true
    },

    'only-of-type': function(){
        var prev = this, nodeName = this.nodeName
        while ((prev = prev.previousSibling)) if (prev.nodeName == nodeName) return false
        var next = this
        while ((next = next.nextSibling)) if (next.nodeName == nodeName) return false
        return true
    },

    'enabled': function(){
        return !this.disabled
    },

    'disabled': function(){
        return this.disabled
    },

    'checked': function(){
        return this.checked || this.selected
    },

    'selected': function(){
        return this.selected
    },

    'focus': function(){
        var doc = this.ownerDocument
        return doc.activeElement === this && (this.href || this.type || slick.hasAttribute(this, 'tabindex'))
    },

    'root': function(){
        return (this === this.ownerDocument.documentElement)
    }

}

Finder.prototype.match = function(node, bit, noTag, noId, noClass){

    // TODO: more functional tests ?

    if (!slick.noQSA && this.matchesSelector){
        var matches = this.matchesSelector(node, bit)
        if (matches !== null) return matches
    }

    // normal matching

    if (!noTag && bit.tag){

        var nodeName = node.nodeName.toLowerCase()
        if (bit.tag === "*"){
            if (nodeName < "@") return false
        } else if (nodeName != bit.tag){
            return false
        }

    }

    if (!noId && bit.id && node.getAttribute('id') !== bit.id) return false

    var i, part

    if (!noClass && bit.classes){

        var className = this.getAttribute(node, "class")
        if (!className) return false

        for (part in bit.classes) if (!RegExp('(^|\\s)' + bit.classes[part] + '(\\s|$)').test(className)) return false
    }

    var name, value

    if (bit.attributes) for (i = 0; part = bit.attributes[i++];){

        var operator  = part.operator,
            escaped   = part.escapedValue

        name  = part.name
        value = part.value

        if (!operator){

            if (!this.hasAttribute(node, name)) return false

        } else {

            var actual = this.getAttribute(node, name)
            if (actual == null) return false

            switch (operator){
                case '^=' : if (!RegExp(      '^' + escaped            ).test(actual)) return false; break
                case '$=' : if (!RegExp(            escaped + '$'      ).test(actual)) return false; break
                case '~=' : if (!RegExp('(^|\\s)' + escaped + '(\\s|$)').test(actual)) return false; break
                case '|=' : if (!RegExp(      '^' + escaped + '(-|$)'  ).test(actual)) return false; break

                case '='  : if (actual !== value) return false; break
                case '*=' : if (actual.indexOf(value) === -1) return false; break
                default   : return false
            }

        }
    }

    if (bit.pseudos) for (i = 0; part = bit.pseudos[i++];){

        name  = part.name
        value = part.value

        if (pseudos[name]) return pseudos[name].call(node, value)

        if (value != null){
            if (this.getAttribute(node, name) !== value) return false
        } else {
            if (!this.hasAttribute(node, name)) return false
        }

    }

    return true

}

Finder.prototype.matches = function(node, expression){

    var expressions = parse(expression)

    if (expressions.length === 1 && expressions[0].length === 1){ // simplest match
        return this.match(node, expressions[0][0])
    }

    // TODO: more functional tests ?

    if (!slick.noQSA && this.matchesSelector){
        var matches = this.matchesSelector(node, expressions)
        if (matches !== null) return matches
    }

    var nodes = this.search(this.document, expression, {length: 0})

    for (var i = 0, res; res = nodes[i++];) if (node === res) return true
    return false

}

var finders = {}

var finder = function(context){
    var doc = context || document
    if (doc.ownerDocument) doc = doc.ownerDocument
    else if (doc.document) doc = doc.document

    if (doc.nodeType !== 9) throw new TypeError("invalid document")

    var uid = uniqueID(doc)
    return finders[uid] || (finders[uid] = new Finder(doc))
}

// ... API ...

var slick = function(expression, context){
    return slick.search(expression, context)
}

slick.search = function(expression, context, found){
    return finder(context).search(context, expression, found)
}

slick.find = function(expression, context){
    return finder(context).search(context, expression)[0] || null
}

slick.getAttribute = function(node, name){
    return finder(node).getAttribute(node, name)
}

slick.hasAttribute = function(node, name){
    return finder(node).hasAttribute(node, name)
}

slick.contains = function(context, node){
    return finder(context).contains(context, node)
}

slick.matches = function(node, expression){
    return finder(node).matches(node, expression)
}

slick.sort = function(nodes){
    if (nodes && nodes.length > 1) finder(nodes[0]).sort(nodes)
    return nodes
}

slick.parse = parse;

// slick.debug = true
// slick.noQSA  = true

module.exports = slick

},{"./parser":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/parser.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/index.js":[function(require,module,exports){
(function (global){
/*
slick
*/"use strict"

module.exports = "document" in global ? require("./finder") : { parse: require("./parser") }

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./finder":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/finder.js","./parser":"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/parser.js"}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/slick/parser.js":[function(require,module,exports){
/*
Slick Parser
 - originally created by the almighty Thomas Aylott <@subtlegradient> (http://subtlegradient.com)
*/"use strict"

// Notable changes from Slick.Parser 1.0.x

// The parser now uses 2 classes: Expressions and Expression
// `new Expressions` produces an array-like object containing a list of Expression objects
// - Expressions::toString() produces a cleaned up expressions string
// `new Expression` produces an array-like object
// - Expression::toString() produces a cleaned up expression string
// The only exposed method is parse, which produces a (cached) `new Expressions` instance
// parsed.raw is no longer present, use .toString()
// parsed.expression is now useless, just use the indices
// parsed.reverse() has been removed for now, due to its apparent uselessness
// Other changes in the Expressions object:
// - classNames are now unique, and save both escaped and unescaped values
// - attributes now save both escaped and unescaped values
// - pseudos now save both escaped and unescaped values

var escapeRe   = /([-.*+?^${}()|[\]\/\\])/g,
    unescapeRe = /\\/g

var escape = function(string){
    // XRegExp v2.0.0-beta-3
    //  https://github.com/slevithan/XRegExp/blob/master/src/xregexp.js
    return (string + "").replace(escapeRe, '\\$1')
}

var unescape = function(string){
    return (string + "").replace(unescapeRe, '')
}

var slickRe = RegExp(
/*
#!/usr/bin/env ruby
puts "\t\t" + DATA.read.gsub(/\(\?x\)|\s+#.*$|\s+|\\$|\\n/,'')
__END__
    "(?x)^(?:\
      \\s* ( , ) \\s*               # Separator          \n\
    | \\s* ( <combinator>+ ) \\s*   # Combinator         \n\
    |      ( \\s+ )                 # CombinatorChildren \n\
    |      ( <unicode>+ | \\* )     # Tag                \n\
    | \\#  ( <unicode>+       )     # ID                 \n\
    | \\.  ( <unicode>+       )     # ClassName          \n\
    |                               # Attribute          \n\
    \\[  \
        \\s* (<unicode1>+)  (?:  \
            \\s* ([*^$!~|]?=)  (?:  \
                \\s* (?:\
                    ([\"']?)(.*?)\\9 \
                )\
            )  \
        )?  \\s*  \
    \\](?!\\]) \n\
    |   :+ ( <unicode>+ )(?:\
    \\( (?:\
        (?:([\"'])([^\\12]*)\\12)|((?:\\([^)]+\\)|[^()]*)+)\
    ) \\)\
    )?\
    )"
*/
"^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)"
    .replace(/<combinator>/, '[' + escape(">+~`!@$%^&={}\\;</") + ']')
    .replace(/<unicode>/g, '(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])')
    .replace(/<unicode1>/g, '(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])')
)

// Part

var Part = function Part(combinator){
    this.combinator = combinator || " "
    this.tag = "*"
}

Part.prototype.toString = function(){

    if (!this.raw){

        var xpr = "", k, part

        xpr += this.tag || "*"
        if (this.id) xpr += "#" + this.id
        if (this.classes) xpr += "." + this.classList.join(".")
        if (this.attributes) for (k = 0; part = this.attributes[k++];){
            xpr += "[" + part.name + (part.operator ? part.operator + '"' + part.value + '"' : '') + "]"
        }
        if (this.pseudos) for (k = 0; part = this.pseudos[k++];){
            xpr += ":" + part.name
            if (part.value) xpr += "(" + part.value + ")"
        }

        this.raw = xpr

    }

    return this.raw
}

// Expression

var Expression = function Expression(){
    this.length = 0
}

Expression.prototype.toString = function(){

    if (!this.raw){

        var xpr = ""

        for (var j = 0, bit; bit = this[j++];){
            if (j !== 1) xpr += " "
            if (bit.combinator !== " ") xpr += bit.combinator + " "
            xpr += bit
        }

        this.raw = xpr

    }

    return this.raw
}

var replacer = function(
    rawMatch,

    separator,
    combinator,
    combinatorChildren,

    tagName,
    id,
    className,

    attributeKey,
    attributeOperator,
    attributeQuote,
    attributeValue,

    pseudoMarker,
    pseudoClass,
    pseudoQuote,
    pseudoClassQuotedValue,
    pseudoClassValue
){

    var expression, current

    if (separator || !this.length){
        expression = this[this.length++] = new Expression
        if (separator) return ''
    }

    if (!expression) expression = this[this.length - 1]

    if (combinator || combinatorChildren || !expression.length){
        current = expression[expression.length++] = new Part(combinator)
    }

    if (!current) current = expression[expression.length - 1]

    if (tagName){

        current.tag = unescape(tagName)

    } else if (id){

        current.id = unescape(id)

    } else if (className){

        var unescaped = unescape(className)

        var classes = current.classes || (current.classes = {})
        if (!classes[unescaped]){
            classes[unescaped] = escape(className)
            var classList = current.classList || (current.classList = [])
            classList.push(unescaped)
            classList.sort()
        }

    } else if (pseudoClass){

        pseudoClassValue = pseudoClassValue || pseudoClassQuotedValue

        ;(current.pseudos || (current.pseudos = [])).push({
            type         : pseudoMarker.length == 1 ? 'class' : 'element',
            name         : unescape(pseudoClass),
            escapedName  : escape(pseudoClass),
            value        : pseudoClassValue ? unescape(pseudoClassValue) : null,
            escapedValue : pseudoClassValue ? escape(pseudoClassValue) : null
        })

    } else if (attributeKey){

        attributeValue = attributeValue ? escape(attributeValue) : null

        ;(current.attributes || (current.attributes = [])).push({
            operator     : attributeOperator,
            name         : unescape(attributeKey),
            escapedName  : escape(attributeKey),
            value        : attributeValue ? unescape(attributeValue) : null,
            escapedValue : attributeValue ? escape(attributeValue) : null
        })

    }

    return ''

}

// Expressions

var Expressions = function Expressions(expression){
    this.length = 0

    var self = this

    var original = expression, replaced

    while (expression){
        replaced = expression.replace(slickRe, function(){
            return replacer.apply(self, arguments)
        })
        if (replaced === expression) throw new Error(original + ' is an invalid expression')
        expression = replaced
    }
}

Expressions.prototype.toString = function(){
    if (!this.raw){
        var expressions = []
        for (var i = 0, expression; expression = this[i++];) expressions.push(expression)
        this.raw = expressions.join(", ")
    }

    return this.raw
}

var cache = {}

var parse = function(expression){
    if (expression == null) return null
    expression = ('' + expression).replace(/^\s+|\s+$/g, '')
    return cache[expression] || (cache[expression] = new Expressions(expression))
}

module.exports = parse

},{}],"/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/node_modules/sortablejs/Sortable.js":[function(require,module,exports){
/**!
 * Sortable
 * @author	RubaXa   <trash@rubaxa.org>
 * @license MIT
 */


(function (factory) {
	"use strict";

	if (typeof define === "function" && define.amd) {
		define(factory);
	}
	else if (typeof module != "undefined" && typeof module.exports != "undefined") {
		module.exports = factory();
	}
	else if (typeof Package !== "undefined") {
		Sortable = factory();  // export for Meteor.js
	}
	else {
		/* jshint sub:true */
		window["Sortable"] = factory();
	}
})(function () {
	"use strict";

	var dragEl,
		ghostEl,
		cloneEl,
		rootEl,
		nextEl,

		scrollEl,
		scrollParentEl,

		lastEl,
		lastCSS,

		oldIndex,
		newIndex,

		activeGroup,
		autoScroll = {},

		tapEvt,
		touchEvt,

		expando = 'Sortable' + (new Date).getTime(),

		win = window,
		document = win.document,
		parseInt = win.parseInt,

		supportDraggable = !!('draggable' in document.createElement('div')),


		_silent = false,

		_dispatchEvent = function (rootEl, name, targetEl, fromEl, startIndex, newIndex) {
			var evt = document.createEvent('Event');

			evt.initEvent(name, true, true);

			evt.item = targetEl || rootEl;
			evt.from = fromEl || rootEl;
			evt.clone = cloneEl;

			evt.oldIndex = startIndex;
			evt.newIndex = newIndex;

			rootEl.dispatchEvent(evt);
		},

		_customEvents = 'onAdd onUpdate onRemove onStart onEnd onFilter onSort'.split(' '),

		noop = function () {},

		abs = Math.abs,
		slice = [].slice,

		touchDragOverListeners = [],

		_autoScroll = _throttle(function (/**Event*/evt, /**Object*/options, /**HTMLElement*/rootEl) {
			// Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=505521
			if (rootEl && options.scroll) {
				var el,
					rect,
					sens = options.scrollSensitivity,
					speed = options.scrollSpeed,

					x = evt.clientX,
					y = evt.clientY,

					winWidth = window.innerWidth,
					winHeight = window.innerHeight,

					vx,
					vy
				;

				// Delect scrollEl
				if (scrollParentEl !== rootEl) {
					scrollEl = options.scroll;
					scrollParentEl = rootEl;

					if (scrollEl === true) {
						scrollEl = rootEl;

						do {
							if ((scrollEl.offsetWidth < scrollEl.scrollWidth) ||
								(scrollEl.offsetHeight < scrollEl.scrollHeight)
							) {
								break;
							}
							/* jshint boss:true */
						} while (scrollEl = scrollEl.parentNode);
					}
				}

				if (scrollEl) {
					el = scrollEl;
					rect = scrollEl.getBoundingClientRect();
					vx = (abs(rect.right - x) <= sens) - (abs(rect.left - x) <= sens);
					vy = (abs(rect.bottom - y) <= sens) - (abs(rect.top - y) <= sens);
				}


				if (!(vx || vy)) {
					vx = (winWidth - x <= sens) - (x <= sens);
					vy = (winHeight - y <= sens) - (y <= sens);

					/* jshint expr:true */
					(vx || vy) && (el = win);
				}


				if (autoScroll.vx !== vx || autoScroll.vy !== vy || autoScroll.el !== el) {
					autoScroll.el = el;
					autoScroll.vx = vx;
					autoScroll.vy = vy;

					clearInterval(autoScroll.pid);

					if (el) {
						autoScroll.pid = setInterval(function () {
							if (el === win) {
								win.scrollTo(win.scrollX + vx * speed, win.scrollY + vy * speed);
							} else {
								vy && (el.scrollTop += vy * speed);
								vx && (el.scrollLeft += vx * speed);
							}
						}, 24);
					}
				}
			}
		}, 30)
	;



	/**
	 * @class  Sortable
	 * @param  {HTMLElement}  el
	 * @param  {Object}       [options]
	 */
	function Sortable(el, options) {
		this.el = el; // root element
		this.options = options = (options || {});


		// Default options
		var defaults = {
			group: Math.random(),
			sort: true,
			disabled: false,
			store: null,
			handle: null,
			scroll: true,
			scrollSensitivity: 30,
			scrollSpeed: 10,
			draggable: /[uo]l/i.test(el.nodeName) ? 'li' : '>*',
			ghostClass: 'sortable-ghost',
			ignore: 'a, img',
			filter: null,
			animation: 0,
			setData: function (dataTransfer, dragEl) {
				dataTransfer.setData('Text', dragEl.textContent);
			},
			dropBubble: false,
			dragoverBubble: false
		};


		// Set default options
		for (var name in defaults) {
			!(name in options) && (options[name] = defaults[name]);
		}


		var group = options.group;

		if (!group || typeof group != 'object') {
			group = options.group = { name: group };
		}


		['pull', 'put'].forEach(function (key) {
			if (!(key in group)) {
				group[key] = true;
			}
		});


		// Define events
		_customEvents.forEach(function (name) {
			options[name] = _bind(this, options[name] || noop);
			_on(el, name.substr(2).toLowerCase(), options[name]);
		}, this);


		// Export options
		options.groups = ' ' + group.name + (group.put.join ? ' ' + group.put.join(' ') : '') + ' ';
		el[expando] = options;


		// Bind all private methods
		for (var fn in this) {
			if (fn.charAt(0) === '_') {
				this[fn] = _bind(this, this[fn]);
			}
		}


		// Bind events
		_on(el, 'mousedown', this._onTapStart);
		_on(el, 'touchstart', this._onTapStart);

		_on(el, 'dragover', this);
		_on(el, 'dragenter', this);

		touchDragOverListeners.push(this._onDragOver);

		// Restore sorting
		options.store && this.sort(options.store.get(this));
	}


	Sortable.prototype = /** @lends Sortable.prototype */ {
		constructor: Sortable,


		_dragStarted: function () {
			if (rootEl && dragEl) {
				// Apply effect
				_toggleClass(dragEl, this.options.ghostClass, true);

				Sortable.active = this;

				// Drag start event
				_dispatchEvent(rootEl, 'start', dragEl, rootEl, oldIndex);
			}
		},


		_onTapStart: function (/**Event|TouchEvent*/evt) {
			var type = evt.type,
				touch = evt.touches && evt.touches[0],
				target = (touch || evt).target,
				originalTarget = target,
				options =  this.options,
				el = this.el,
				filter = options.filter;

			if (type === 'mousedown' && evt.button !== 0 || options.disabled) {
				return; // only left button or enabled
			}

			target = _closest(target, options.draggable, el);

			if (!target) {
				return;
			}

			// get the index of the dragged element within its parent
			oldIndex = _index(target);

			// Check filter
			if (typeof filter === 'function') {
				if (filter.call(this, evt, target, this)) {
					_dispatchEvent(originalTarget, 'filter', target, el, oldIndex);
					evt.preventDefault();
					return; // cancel dnd
				}
			}
			else if (filter) {
				filter = filter.split(',').some(function (criteria) {
					criteria = _closest(originalTarget, criteria.trim(), el);

					if (criteria) {
						_dispatchEvent(criteria, 'filter', target, el, oldIndex);
						return true;
					}
				});

				if (filter) {
					evt.preventDefault();
					return; // cancel dnd
				}
			}


			if (options.handle && !_closest(originalTarget, options.handle, el)) {
				return;
			}


			// Prepare `dragstart`
			if (target && !dragEl && (target.parentNode === el)) {
				tapEvt = evt;

				rootEl = this.el;
				dragEl = target;
				nextEl = dragEl.nextSibling;
				activeGroup = this.options.group;

				dragEl.draggable = true;

				// Disable "draggable"
				options.ignore.split(',').forEach(function (criteria) {
					_find(target, criteria.trim(), _disableDraggable);
				});

				if (touch) {
					// Touch device support
					tapEvt = {
						target: target,
						clientX: touch.clientX,
						clientY: touch.clientY
					};

					this._onDragStart(tapEvt, 'touch');
					evt.preventDefault();
				}

				_on(document, 'mouseup', this._onDrop);
				_on(document, 'touchend', this._onDrop);
				_on(document, 'touchcancel', this._onDrop);

				_on(dragEl, 'dragend', this);
				_on(rootEl, 'dragstart', this._onDragStart);

				if (!supportDraggable) {
					this._onDragStart(tapEvt, true);
				}

				try {
					if (document.selection) {
						document.selection.empty();
					} else {
						window.getSelection().removeAllRanges();
					}
				} catch (err) {
				}
			}
		},

		_emulateDragOver: function () {
			if (touchEvt) {
				_css(ghostEl, 'display', 'none');

				var target = document.elementFromPoint(touchEvt.clientX, touchEvt.clientY),
					parent = target,
					groupName = ' ' + this.options.group.name + '',
					i = touchDragOverListeners.length;

				if (parent) {
					do {
						if (parent[expando] && parent[expando].groups.indexOf(groupName) > -1) {
							while (i--) {
								touchDragOverListeners[i]({
									clientX: touchEvt.clientX,
									clientY: touchEvt.clientY,
									target: target,
									rootEl: parent
								});
							}

							break;
						}

						target = parent; // store last element
					}
					/* jshint boss:true */
					while (parent = parent.parentNode);
				}

				_css(ghostEl, 'display', '');
			}
		},


		_onTouchMove: function (/**TouchEvent*/evt) {
			if (tapEvt) {
				var touch = evt.touches ? evt.touches[0] : evt,
					dx = touch.clientX - tapEvt.clientX,
					dy = touch.clientY - tapEvt.clientY,
					translate3d = evt.touches ? 'translate3d(' + dx + 'px,' + dy + 'px,0)' : 'translate(' + dx + 'px,' + dy + 'px)';

				touchEvt = touch;

				_css(ghostEl, 'webkitTransform', translate3d);
				_css(ghostEl, 'mozTransform', translate3d);
				_css(ghostEl, 'msTransform', translate3d);
				_css(ghostEl, 'transform', translate3d);

				evt.preventDefault();
			}
		},


		_onDragStart: function (/**Event*/evt, /**boolean*/useFallback) {
			var dataTransfer = evt.dataTransfer,
				options = this.options;

			this._offUpEvents();

			if (activeGroup.pull == 'clone') {
				cloneEl = dragEl.cloneNode(true);
				_css(cloneEl, 'display', 'none');
				rootEl.insertBefore(cloneEl, dragEl);
			}

			if (useFallback) {
				var rect = dragEl.getBoundingClientRect(),
					css = _css(dragEl),
					ghostRect;

				ghostEl = dragEl.cloneNode(true);

				_css(ghostEl, 'top', rect.top - parseInt(css.marginTop, 10));
				_css(ghostEl, 'left', rect.left - parseInt(css.marginLeft, 10));
				_css(ghostEl, 'width', rect.width);
				_css(ghostEl, 'height', rect.height);
				_css(ghostEl, 'opacity', '0.8');
				_css(ghostEl, 'position', 'fixed');
				_css(ghostEl, 'zIndex', '100000');

				rootEl.appendChild(ghostEl);

				// Fixing dimensions.
				ghostRect = ghostEl.getBoundingClientRect();
				_css(ghostEl, 'width', rect.width * 2 - ghostRect.width);
				_css(ghostEl, 'height', rect.height * 2 - ghostRect.height);

				if (useFallback === 'touch') {
					// Bind touch events
					_on(document, 'touchmove', this._onTouchMove);
					_on(document, 'touchend', this._onDrop);
					_on(document, 'touchcancel', this._onDrop);
				} else {
					// Old brwoser
					_on(document, 'mousemove', this._onTouchMove);
					_on(document, 'mouseup', this._onDrop);
				}

				this._loopId = setInterval(this._emulateDragOver, 150);
			}
			else {
				if (dataTransfer) {
					dataTransfer.effectAllowed = 'move';
					options.setData && options.setData.call(this, dataTransfer, dragEl);
				}

				_on(document, 'drop', this);
			}

			setTimeout(this._dragStarted, 0);
		},

		_onDragOver: function (/**Event*/evt) {
			var el = this.el,
				target,
				dragRect,
				revert,
				options = this.options,
				group = options.group,
				groupPut = group.put,
				isOwner = (activeGroup === group),
				canSort = options.sort;

			if (!dragEl) {
				return;
			}

			if (evt.preventDefault !== void 0) {
				evt.preventDefault();
				!options.dragoverBubble && evt.stopPropagation();
			}

			if (activeGroup && !options.disabled &&
				(isOwner
					? canSort || (revert = !rootEl.contains(dragEl))
					: activeGroup.pull && groupPut && (
						(activeGroup.name === group.name) || // by Name
						(groupPut.indexOf && ~groupPut.indexOf(activeGroup.name)) // by Array
					)
				) &&
				(evt.rootEl === void 0 || evt.rootEl === this.el)
			) {
				// Smart auto-scrolling
				_autoScroll(evt, options, this.el);

				if (_silent) {
					return;
				}

				target = _closest(evt.target, options.draggable, el);
				dragRect = dragEl.getBoundingClientRect();


				if (revert) {
					_cloneHide(true);

					if (cloneEl || nextEl) {
						rootEl.insertBefore(dragEl, cloneEl || nextEl);
					}
					else if (!canSort) {
						rootEl.appendChild(dragEl);
					}

					return;
				}


				if ((el.children.length === 0) || (el.children[0] === ghostEl) ||
					(el === evt.target) && (target = _ghostInBottom(el, evt))
				) {
					if (target) {
						if (target.animated) {
							return;
						}
						targetRect = target.getBoundingClientRect();
					}

					_cloneHide(isOwner);

					el.appendChild(dragEl);
					this._animate(dragRect, dragEl);
					target && this._animate(targetRect, target);
				}
				else if (target && !target.animated && target !== dragEl && (target.parentNode[expando] !== void 0)) {
					if (lastEl !== target) {
						lastEl = target;
						lastCSS = _css(target);
					}


					var targetRect = target.getBoundingClientRect(),
						width = targetRect.right - targetRect.left,
						height = targetRect.bottom - targetRect.top,
						floating = /left|right|inline/.test(lastCSS.cssFloat + lastCSS.display),
						isWide = (target.offsetWidth > dragEl.offsetWidth),
						isLong = (target.offsetHeight > dragEl.offsetHeight),
						halfway = (floating ? (evt.clientX - targetRect.left) / width : (evt.clientY - targetRect.top) / height) > 0.5,
						nextSibling = target.nextElementSibling,
						after
					;

					_silent = true;
					setTimeout(_unsilent, 30);

					_cloneHide(isOwner);

					if (floating) {
						after = (target.previousElementSibling === dragEl) && !isWide || halfway && isWide;
					} else {
						after = (nextSibling !== dragEl) && !isLong || halfway && isLong;
					}

					if (after && !nextSibling) {
						el.appendChild(dragEl);
					} else {
						target.parentNode.insertBefore(dragEl, after ? nextSibling : target);
					}

					this._animate(dragRect, dragEl);
					this._animate(targetRect, target);
				}
			}
		},

		_animate: function (prevRect, target) {
			var ms = this.options.animation;

			if (ms) {
				var currentRect = target.getBoundingClientRect();

				_css(target, 'transition', 'none');
				_css(target, 'transform', 'translate3d('
					+ (prevRect.left - currentRect.left) + 'px,'
					+ (prevRect.top - currentRect.top) + 'px,0)'
				);

				target.offsetWidth; // repaint

				_css(target, 'transition', 'all ' + ms + 'ms');
				_css(target, 'transform', 'translate3d(0,0,0)');

				clearTimeout(target.animated);
				target.animated = setTimeout(function () {
					_css(target, 'transition', '');
					_css(target, 'transform', '');
					target.animated = false;
				}, ms);
			}
		},

		_offUpEvents: function () {
			_off(document, 'mouseup', this._onDrop);
			_off(document, 'touchmove', this._onTouchMove);
			_off(document, 'touchend', this._onDrop);
			_off(document, 'touchcancel', this._onDrop);
		},

		_onDrop: function (/**Event*/evt) {
			var el = this.el,
				options = this.options;

			clearInterval(this._loopId);
			clearInterval(autoScroll.pid);

			// Unbind events
			_off(document, 'drop', this);
			_off(document, 'mousemove', this._onTouchMove);
			_off(el, 'dragstart', this._onDragStart);

			this._offUpEvents();

			if (evt) {
				evt.preventDefault();
				!options.dropBubble && evt.stopPropagation();

				ghostEl && ghostEl.parentNode.removeChild(ghostEl);

				if (dragEl) {
					_off(dragEl, 'dragend', this);

					_disableDraggable(dragEl);
					_toggleClass(dragEl, this.options.ghostClass, false);

					if (rootEl !== dragEl.parentNode) {
						newIndex = _index(dragEl);

						// drag from one list and drop into another
						_dispatchEvent(dragEl.parentNode, 'sort', dragEl, rootEl, oldIndex, newIndex);
						_dispatchEvent(rootEl, 'sort', dragEl, rootEl, oldIndex, newIndex);

						// Add event
						_dispatchEvent(dragEl, 'add', dragEl, rootEl, oldIndex, newIndex);

						// Remove event
						_dispatchEvent(rootEl, 'remove', dragEl, rootEl, oldIndex, newIndex);
					}
					else {
						// Remove clone
						cloneEl && cloneEl.parentNode.removeChild(cloneEl);

						if (dragEl.nextSibling !== nextEl) {
							// Get the index of the dragged element within its parent
							newIndex = _index(dragEl);

							// drag & drop within the same list
							_dispatchEvent(rootEl, 'update', dragEl, rootEl, oldIndex, newIndex);
							_dispatchEvent(rootEl, 'sort', dragEl, rootEl, oldIndex, newIndex);
						}
					}

					// Drag end event
					Sortable.active && _dispatchEvent(rootEl, 'end', dragEl, rootEl, oldIndex, newIndex);
				}

				// Nulling
				rootEl =
				dragEl =
				ghostEl =
				nextEl =
				cloneEl =

				scrollEl =
				scrollParentEl =

				tapEvt =
				touchEvt =

				lastEl =
				lastCSS =

				activeGroup =
				Sortable.active = null;

				// Save sorting
				this.save();
			}
		},


		handleEvent: function (/**Event*/evt) {
			var type = evt.type;

			if (type === 'dragover' || type === 'dragenter') {
				this._onDragOver(evt);
				_globalDragOver(evt);
			}
			else if (type === 'drop' || type === 'dragend') {
				this._onDrop(evt);
			}
		},


		/**
		 * Serializes the item into an array of string.
		 * @returns {String[]}
		 */
		toArray: function () {
			var order = [],
				el,
				children = this.el.children,
				i = 0,
				n = children.length;

			for (; i < n; i++) {
				el = children[i];
				if (_closest(el, this.options.draggable, this.el)) {
					order.push(el.getAttribute('data-id') || _generateId(el));
				}
			}

			return order;
		},


		/**
		 * Sorts the elements according to the array.
		 * @param  {String[]}  order  order of the items
		 */
		sort: function (order) {
			var items = {}, rootEl = this.el;

			this.toArray().forEach(function (id, i) {
				var el = rootEl.children[i];

				if (_closest(el, this.options.draggable, rootEl)) {
					items[id] = el;
				}
			}, this);

			order.forEach(function (id) {
				if (items[id]) {
					rootEl.removeChild(items[id]);
					rootEl.appendChild(items[id]);
				}
			});
		},


		/**
		 * Save the current sorting
		 */
		save: function () {
			var store = this.options.store;
			store && store.set(this);
		},


		/**
		 * For each element in the set, get the first element that matches the selector by testing the element itself and traversing up through its ancestors in the DOM tree.
		 * @param   {HTMLElement}  el
		 * @param   {String}       [selector]  default: `options.draggable`
		 * @returns {HTMLElement|null}
		 */
		closest: function (el, selector) {
			return _closest(el, selector || this.options.draggable, this.el);
		},


		/**
		 * Set/get option
		 * @param   {string} name
		 * @param   {*}      [value]
		 * @returns {*}
		 */
		option: function (name, value) {
			var options = this.options;

			if (value === void 0) {
				return options[name];
			} else {
				options[name] = value;
			}
		},


		/**
		 * Destroy
		 */
		destroy: function () {
			var el = this.el, options = this.options;

			_customEvents.forEach(function (name) {
				_off(el, name.substr(2).toLowerCase(), options[name]);
			});

			_off(el, 'mousedown', this._onTapStart);
			_off(el, 'touchstart', this._onTapStart);

			_off(el, 'dragover', this);
			_off(el, 'dragenter', this);

			//remove draggable attributes
			Array.prototype.forEach.call(el.querySelectorAll('[draggable]'), function (el) {
				el.removeAttribute('draggable');
			});

			touchDragOverListeners.splice(touchDragOverListeners.indexOf(this._onDragOver), 1);

			this._onDrop();

			this.el = null;
		}
	};


	function _cloneHide(state) {
		if (cloneEl && (cloneEl.state !== state)) {
			_css(cloneEl, 'display', state ? 'none' : '');
			!state && cloneEl.state && rootEl.insertBefore(cloneEl, dragEl);
			cloneEl.state = state;
		}
	}


	function _bind(ctx, fn) {
		var args = slice.call(arguments, 2);
		return	fn.bind ? fn.bind.apply(fn, [ctx].concat(args)) : function () {
			return fn.apply(ctx, args.concat(slice.call(arguments)));
		};
	}


	function _closest(/**HTMLElement*/el, /**String*/selector, /**HTMLElement*/ctx) {
		if (el) {
			ctx = ctx || document;
			selector = selector.split('.');

			var tag = selector.shift().toUpperCase(),
				re = new RegExp('\\s(' + selector.join('|') + ')\\s', 'g');

			do {
				if (
					(tag === '>*' && el.parentNode === ctx) || (
						(tag === '' || el.nodeName.toUpperCase() == tag) &&
						(!selector.length || ((' ' + el.className + ' ').match(re) || []).length == selector.length)
					)
				) {
					return el;
				}
			}
			while (el !== ctx && (el = el.parentNode));
		}

		return null;
	}


	function _globalDragOver(/**Event*/evt) {
		evt.dataTransfer.dropEffect = 'move';
		evt.preventDefault();
	}


	function _on(el, event, fn) {
		el.addEventListener(event, fn, false);
	}


	function _off(el, event, fn) {
		el.removeEventListener(event, fn, false);
	}


	function _toggleClass(el, name, state) {
		if (el) {
			if (el.classList) {
				el.classList[state ? 'add' : 'remove'](name);
			}
			else {
				var className = (' ' + el.className + ' ').replace(/\s+/g, ' ').replace(' ' + name + ' ', '');
				el.className = className + (state ? ' ' + name : '');
			}
		}
	}


	function _css(el, prop, val) {
		var style = el && el.style;

		if (style) {
			if (val === void 0) {
				if (document.defaultView && document.defaultView.getComputedStyle) {
					val = document.defaultView.getComputedStyle(el, '');
				}
				else if (el.currentStyle) {
					val = el.currentStyle;
				}

				return prop === void 0 ? val : val[prop];
			}
			else {
				if (!(prop in style)) {
					prop = '-webkit-' + prop;
				}

				style[prop] = val + (typeof val === 'string' ? '' : 'px');
			}
		}
	}


	function _find(ctx, tagName, iterator) {
		if (ctx) {
			var list = ctx.getElementsByTagName(tagName), i = 0, n = list.length;

			if (iterator) {
				for (; i < n; i++) {
					iterator(list[i], i);
				}
			}

			return list;
		}

		return [];
	}


	function _disableDraggable(el) {
		el.draggable = false;
	}


	function _unsilent() {
		_silent = false;
	}


	/** @returns {HTMLElement|false} */
	function _ghostInBottom(el, evt) {
		var lastEl = el.lastElementChild, rect = lastEl.getBoundingClientRect();
		return (evt.clientY - (rect.top + rect.height) > 5) && lastEl; // min delta
	}


	/**
	 * Generate id
	 * @param   {HTMLElement} el
	 * @returns {String}
	 * @private
	 */
	function _generateId(el) {
		var str = el.tagName + el.className + el.src + el.href + el.textContent,
			i = str.length,
			sum = 0;

		while (i--) {
			sum += str.charCodeAt(i);
		}

		return sum.toString(36);
	}

	/**
	 * Returns the index of an element within its parent
	 * @param el
	 * @returns {number}
	 * @private
	 */
	function _index(/**HTMLElement*/el) {
		var index = 0;
		while (el && (el = el.previousElementSibling)) {
			if (el.nodeName.toUpperCase() !== 'TEMPLATE') {
				index++;
			}
		}
		return index;
	}

	function _throttle(callback, ms) {
		var args, _this;

		return function () {
			if (args === void 0) {
				args = arguments;
				_this = this;

				setTimeout(function () {
					if (args.length === 1) {
						callback.call(_this, args[0]);
					} else {
						callback.apply(_this, args);
					}

					args = void 0;
				}, ms);
			}
		};
	}


	// Export utils
	Sortable.utils = {
		on: _on,
		off: _off,
		css: _css,
		find: _find,
		bind: _bind,
		is: function (el, selector) {
			return !!_closest(el, selector, el);
		},
		throttle: _throttle,
		closest: _closest,
		toggleClass: _toggleClass,
		dispatchEvent: _dispatchEvent,
		index: _index
	};


	Sortable.version = '1.1.1';


	/**
	 * Create sortable instance
	 * @param {HTMLElement}  el
	 * @param {Object}      [options]
	 */
	Sortable.create = function (el, options) {
		return new Sortable(el, options);
	};

	// Export
	return Sortable;
});

},{}]},{},["/Users/w00fz/Projects/git/gantry/gantry5/platforms/common/application/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJmaWVsZHMvaW5kZXguanMiLCJsbS9ibG9ja3MvYXRvbS5qcyIsImxtL2Jsb2Nrcy9hdG9tcy5qcyIsImxtL2Jsb2Nrcy9iYXNlLmpzIiwibG0vYmxvY2tzL2Jsb2NrLmpzIiwibG0vYmxvY2tzL2NvbnRhaW5lci5qcyIsImxtL2Jsb2Nrcy9ncmlkLmpzIiwibG0vYmxvY2tzL2luZGV4LmpzIiwibG0vYmxvY2tzL29mZmNhbnZhcy5qcyIsImxtL2Jsb2Nrcy9wYWdlY29udGVudC5qcyIsImxtL2Jsb2Nrcy9wYXJ0aWNsZS5qcyIsImxtL2Jsb2Nrcy9wb3NpdGlvbi5qcyIsImxtL2Jsb2Nrcy9zZWN0aW9uLmpzIiwibG0vYmxvY2tzL3NwYWNlci5qcyIsImxtL2J1aWxkZXIuanMiLCJsbS9kcmFnLnJlc2l6ZXIuanMiLCJsbS9lcmFzZXIuanMiLCJsbS9oaXN0b3J5LmpzIiwibG0vaW5kZXguanMiLCJsbS9sYXlvdXRtYW5hZ2VyLmpzIiwibWFpbi5qcyIsIm1lbnUvZHJhZy5yZXNpemVyLmpzIiwibWVudS9leHRyYS1pdGVtcy5qcyIsIm1lbnUvaW5kZXguanMiLCJtZW51L21lbnVtYW5hZ2VyLmpzIiwicGFydGljbGVzL2NvbGxlY3Rpb25zL2luZGV4LmpzIiwicGFydGljbGVzL2NvbG9ycGlja2VyL2luZGV4LmpzIiwicGFydGljbGVzL2ZpbGVwaWNrZXIvaW5kZXguanMiLCJwYXJ0aWNsZXMvZm9udHMvaW5kZXguanMiLCJwYXJ0aWNsZXMvZm9udHMvd2ViZm9udC5qcyIsInBhcnRpY2xlcy9pY29ucy9pbmRleC5qcyIsInBhcnRpY2xlcy9pbmRleC5qcyIsInBhcnRpY2xlcy9rZXl2YWx1ZS9pbmRleC5qcyIsInBhcnRpY2xlcy9tZW51L2luZGV4LmpzIiwic3R5bGVzL2luZGV4LmpzIiwidWkvZHJhZy5kcm9wLmpzIiwidWkvZHJhZy5ldmVudHMuanMiLCJ1aS9pbmRleC5qcyIsInVpL21vZGFsLmpzIiwidWkvcG9wb3Zlci5qcyIsInVpL3Byb2dyZXNzZXIuanMiLCJ1aS9zZWxlY3RpemUuanMiLCJ1aS90b2FzdHIuanMiLCJ1aS90b2dnbGVycy5qcyIsInV0aWxzL2FqYXhpZnktbGlua3MuanMiLCJ1dGlscy9lbGVtZW50cy51dGlscy5qcyIsInV0aWxzL2VsZW1lbnRzLnZpZXdwb3J0LmpzIiwidXRpbHMvZ2V0LWFqYXgtc3VmZml4LmpzIiwidXRpbHMvZ2V0LWFqYXgtdXJsLmpzIiwidXRpbHMvaGlzdG9yeS1hZGFwdGVyLmpzIiwidXRpbHMvaGlzdG9yeS5qcyIsInV0aWxzL3NhdmUtc3RhdGUuanMiLCIuLi9ub2RlX21vZHVsZXMvYWdlbnQvaW5kZXguanMiLCIuLi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvZm9yRWFjaC5qcyIsIi4uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9pbmRleE9mLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L3JlbW92ZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9sYW5nL2lzQXJyYXkuanMiLCIuLi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc0Z1bmN0aW9uLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvaXNLaW5kLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvaXNPYmplY3QuanMiLCIuLi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc1N0cmluZy5qcyIsIi4uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9sYW5nL2tpbmRPZi5qcyIsIi4uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9sYW5nL3RvU3RyaW5nLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9mb3JJbi5qcyIsIi4uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvZm9yT3duLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9oYXNPd24uanMiLCIuLi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L21peEluLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9XSElURV9TUEFDRVMuanMiLCIuLi9ub2RlX21vZHVsZXMvYWdlbnQvbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL2x0cmltLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2FnZW50L25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9ydHJpbS5qcyIsIi4uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvdHJpbS5qcyIsIi4uL25vZGVfbW9kdWxlcy9hZ2VudC9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvdXBwZXJDYXNlLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2FzeW5jL2xpYi9hc3luYy5qcyIsIi4uL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanMiLCIuLi9ub2RlX21vZHVsZXMvZHJvcHpvbmUvZGlzdC9kcm9wem9uZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9hdHRyaWJ1dGVzLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL2Jhc2UuanMiLCIuLi9ub2RlX21vZHVsZXMvZWxlbWVudHMvZGVsZWdhdGlvbi5qcyIsIi4uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9kb21yZWFkeS5qcyIsIi4uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9ldmVudHMuanMiLCIuLi9ub2RlX21vZHVsZXMvZWxlbWVudHMvaW5kZXguanMiLCIuLi9ub2RlX21vZHVsZXMvZWxlbWVudHMvaW5zZXJ0aW9uLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2V2ZXJ5LmpzIiwiLi4vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2ZpbHRlci5qcyIsIi4uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9tYXAuanMiLCIuLi9ub2RlX21vZHVsZXMvZWxlbWVudHMvbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvc29tZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9ub2RlX21vZHVsZXMvbW91dC9mdW5jdGlvbi9pZGVudGl0eS5qcyIsIi4uL25vZGVfbW9kdWxlcy9lbGVtZW50cy9ub2RlX21vZHVsZXMvbW91dC9mdW5jdGlvbi9tYWtlSXRlcmF0b3JfLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL25vZGVfbW9kdWxlcy9tb3V0L2Z1bmN0aW9uL3Byb3AuanMiLCIuLi9ub2RlX21vZHVsZXMvZWxlbWVudHMvbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L2RlZXBNYXRjaGVzLmpzIiwiLi4vbm9kZV9tb2R1bGVzL2VsZW1lbnRzL3RyYXZlcnNhbC5qcyIsIi4uL25vZGVfbW9kdWxlcy9lbGVtZW50cy96ZW4uanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvaW5kZXguanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbGliL2Jyb3dzZXIuanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbGliL2NvbG9yLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vb2Z4L2xpYi9mcmFtZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb29meC9saWIvZnguanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbGliL3VubWF0cml4MmQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL2N1YmljLWJlemllci9pbmRleC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvZWxlbWVudHMvaW5kZXguanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL2FycmF5L2V2ZXJ5LmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS9hcnJheS9maWx0ZXIuanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL2FycmF5L2ZvckVhY2guanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL2FycmF5L2luZGV4T2YuanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL2FycmF5L21hcC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvYXJyYXkvc29tZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvaW5kZXguanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL29iamVjdC9jcmVhdGUuanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL29iamVjdC9maWx0ZXIuanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL29iamVjdC9mb3JJbi5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvb2JqZWN0L2Zvck93bi5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvb2JqZWN0L2hhc093bi5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb29meC9ub2RlX21vZHVsZXMvcHJpbWUvb2JqZWN0L21peEluLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS9zdHJpbmcvY2FtZWxpemUuanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL3N0cmluZy9jYXBpdGFsaXplLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS9zdHJpbmcvY2xlYW4uanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL3N0cmluZy9oeXBoZW5hdGUuanMiLCIuLi9ub2RlX21vZHVsZXMvbW9vZngvbm9kZV9tb2R1bGVzL3ByaW1lL3N0cmluZy90cmltLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vb2Z4L25vZGVfbW9kdWxlcy9wcmltZS90eXBlLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvYXBwZW5kLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvY29tYmluZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2NvbnRhaW5zLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvZGlmZmVyZW5jZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2VxdWFscy5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L2ZpbmQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9maW5kSW5kZXguanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9hcnJheS9mbGF0dGVuLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvaW5zZXJ0LmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvaW52b2tlLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvbGFzdC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L3JlbW92ZUFsbC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2FycmF5L3NsaWNlLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvYXJyYXkvc3BsaXQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9hcnJheS91bmlxdWUuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9jb2xsZWN0aW9uL2ZpbmQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9jb2xsZWN0aW9uL2ZvckVhY2guanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9jb2xsZWN0aW9uL21ha2VfLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvY29sbGVjdGlvbi9zaXplLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvZnVuY3Rpb24vYmluZC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2Z1bmN0aW9uL2RlYm91bmNlLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvZnVuY3Rpb24vc2VyaWVzLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9jbG9uZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvZGVlcENsb25lLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9kZWVwRXF1YWxzLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pcy5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvaXNCb29sZWFuLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9pc051bWJlci5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvaXNQbGFpbk9iamVjdC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L2xhbmcvaXNQcmltaXRpdmUuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9sYW5nL3RvTnVtYmVyLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvbWF0aC9jbGFtcC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L21hdGgvbGVycC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L21hdGgvbWFwLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvbWF0aC9ub3JtLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvbnVtYmVyL01BWF9JTlQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9udW1iZXIvTUlOX0lOVC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L251bWJlci9lbmZvcmNlUHJlY2lzaW9uLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvbnVtYmVyL3RvSW50LmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L2RlZXBGaWxsSW4uanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvZXF1YWxzLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L2V2ZXJ5LmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L2ZpbmQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvZ2V0LmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L2hhcy5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9rZXlzLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L21lcmdlLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L25hbWVzcGFjZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9vbWl0LmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L3NldC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L29iamVjdC9zaXplLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvb2JqZWN0L3NvbWUuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvdW5zZXQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9vYmplY3QvdmFsdWVzLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvcXVlcnlTdHJpbmcvZW5jb2RlLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvcXVlcnlTdHJpbmcvc2V0UGFyYW0uanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9yYW5kb20vY2hvaWNlLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvcmFuZG9tL2d1aWQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9yYW5kb20vcmFuZC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L3JhbmRvbS9yYW5kSGV4LmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvcmFuZG9tL3JhbmRJbnQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9yYW5kb20vcmFuZG9tLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL2NvbnRhaW5zLmpzIiwiLi4vbm9kZV9tb2R1bGVzL21vdXQvc3RyaW5nL2VzY2FwZUh0bWwuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvZXNjYXBlVW5pY29kZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9pbnRlcnBvbGF0ZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9sb3dlckNhc2UuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvcHJvcGVyQ2FzZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy9yZXBlYXQuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvcnBhZC5qcyIsIi4uL25vZGVfbW9kdWxlcy9tb3V0L3N0cmluZy91bmVzY2FwZUh0bWwuanMiLCIuLi9ub2RlX21vZHVsZXMvbW91dC9zdHJpbmcvdW5oeXBoZW5hdGUuanMiLCIuLi9ub2RlX21vZHVsZXMvb2JqZWN0ZGlmZi9vYmplY3REaWZmLmpzIiwiLi4vbm9kZV9tb2R1bGVzL3ByaW1lLXV0aWwvbm9kZV9tb2R1bGVzL21vdXQvbGFuZy9jbG9uZS5qcyIsIi4uL25vZGVfbW9kdWxlcy9wcmltZS11dGlsL3ByaW1lL2JvdW5kLmpzIiwiLi4vbm9kZV9tb2R1bGVzL3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucy5qcyIsIi4uL25vZGVfbW9kdWxlcy9wcmltZS9kZWZlci5qcyIsIi4uL25vZGVfbW9kdWxlcy9wcmltZS9lbWl0dGVyLmpzIiwiLi4vbm9kZV9tb2R1bGVzL3ByaW1lL2luZGV4LmpzIiwiLi4vbm9kZV9tb2R1bGVzL3ByaW1lL21hcC5qcyIsIi4uL25vZGVfbW9kdWxlcy9wcmltZS9ub2RlX21vZHVsZXMvbW91dC9sYW5nL2NyZWF0ZU9iamVjdC5qcyIsIi4uL25vZGVfbW9kdWxlcy9wcmltZS9ub2RlX21vZHVsZXMvbW91dC90aW1lL25vdy5qcyIsIi4uL25vZGVfbW9kdWxlcy9zaWZ0ZXIvc2lmdGVyLmpzIiwiLi4vbm9kZV9tb2R1bGVzL3NsaWNrL2ZpbmRlci5qcyIsIi4uL25vZGVfbW9kdWxlcy9zbGljay9pbmRleC5qcyIsIi4uL25vZGVfbW9kdWxlcy9zbGljay9wYXJzZXIuanMiLCIuLi9ub2RlX21vZHVsZXMvc29ydGFibGVqcy9Tb3J0YWJsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDanRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3B0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5V0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwNkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3YvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNubUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNyNkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNuREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUN4SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQzNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FDNUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM3ekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcmVhZHkgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgJCAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2F0dHJpYnV0ZXMnKSxcbiAgICBzdG9yYWdlICAgID0gcmVxdWlyZSgncHJpbWUvbWFwJyksXG4gICAgZGVlcEVxdWFscyA9IHJlcXVpcmUoJ21vdXQvbGFuZy9kZWVwRXF1YWxzJyksXG4gICAgaW52b2tlICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW52b2tlJyksXG4gICAgSGlzdG9yeSAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2hpc3RvcnknKTtcblxuXG52YXIgb3JpZ2luYWxzLCBjb2xsZWN0RmllbGRzVmFsdWVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG1hcCA9IG5ldyBzdG9yYWdlKCk7XG5cbiAgICB2YXIgZmllbGRzID0gJCgnLnNldHRpbmdzLWJsb2NrIFtuYW1lXScpO1xuICAgIGlmICghZmllbGRzKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgZmllbGRzLmZvckVhY2goZnVuY3Rpb24oZmllbGQpIHtcbiAgICAgICAgZmllbGQgPSAkKGZpZWxkKTtcbiAgICAgICAgbWFwLnNldChmaWVsZC5hdHRyaWJ1dGUoJ25hbWUnKSwgZmllbGQudmFsdWUoKSk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICByZXR1cm4gbWFwO1xufTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5JyksIGNvbXBhcmUgPSB7XG4gICAgICAgIHNpbmdsZTogZnVuY3Rpb24oKXt9LFxuICAgICAgICB3aG9sZTogZnVuY3Rpb24oKXt9XG4gICAgfTtcblxuICAgIG9yaWdpbmFscyA9IGNvbGxlY3RGaWVsZHNWYWx1ZXMoKTtcblxuICAgIGNvbXBhcmUuc2luZ2xlID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKSB8fCBlbGVtZW50LnBhcmVudCgnaDQnKSxcbiAgICAgICAgICAgIHRhcmdldCA9IHBhcmVudCA/IChwYXJlbnQubWF0Y2hlcygnaDQnKSA/IHBhcmVudCA6IHBhcmVudC5maW5kKCcuc2V0dGluZ3MtcGFyYW0tdGl0bGUnKSkgOiBudWxsLFxuICAgICAgICAgICAgaXNPdmVycmlkZSA9IHBhcmVudCA/IHBhcmVudC5maW5kKCcuc2V0dGluZ3MtcGFyYW0tdG9nZ2xlJykgOiBmYWxzZTtcblxuICAgICAgICBpZiAoIXBhcmVudCkgeyByZXR1cm47IH1cblxuICAgICAgICBpZiAoIXRhcmdldCB8fCAhb3JpZ2luYWxzIHx8IG9yaWdpbmFscy5nZXQoZWxlbWVudC5hdHRyaWJ1dGUoJ25hbWUnKSkgPT0gbnVsbCkgeyByZXR1cm47IH1cbiAgICAgICAgaWYgKG9yaWdpbmFscy5nZXQoZWxlbWVudC5hdHRyaWJ1dGUoJ25hbWUnKSkgIT09IGVsZW1lbnQudmFsdWUoKSkge1xuICAgICAgICAgICAgaWYgKGlzT3ZlcnJpZGUgJiYgZXZlbnQuZm9yY2VPdmVycmlkZSAmJiAhaXNPdmVycmlkZS5jaGVja2VkKCkpIHsgaXNPdmVycmlkZVswXS5jbGljaygpOyB9XG4gICAgICAgICAgICB0YXJnZXQuc2hvd0luZGljYXRvcignY2hhbmdlcy1pbmRpY2F0b3IgZm9udC1zbWFsbCBmYSBmYS1jaXJjbGUtbyBmYS1mdycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGlzT3ZlcnJpZGUgJiYgZXZlbnQuZm9yY2VPdmVycmlkZSAgJiYgaXNPdmVycmlkZS5jaGVja2VkKCkpIHsgaXNPdmVycmlkZVswXS5jbGljaygpOyB9XG4gICAgICAgICAgICB0YXJnZXQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tcGFyZS53aG9sZSgpO1xuICAgIH07XG5cbiAgICBjb21wYXJlLndob2xlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBlcXVhbHMgPSBkZWVwRXF1YWxzKG9yaWdpbmFscywgY29sbGVjdEZpZWxkc1ZhbHVlcygpKSxcbiAgICAgICAgICAgIHNhdmUgPSAkKCdbZGF0YS1zYXZlXScpO1xuXG4gICAgICAgIGlmICghc2F2ZSkgeyByZXR1cm47IH1cblxuICAgICAgICBzYXZlW2VxdWFscyA/ICdoaWRlSW5kaWNhdG9yJyA6ICdzaG93SW5kaWNhdG9yJ10oJ2NoYW5nZXMtaW5kaWNhdG9yIGZhIGZhLWNpcmNsZS1vIGZhLWZ3Jyk7XG4gICAgfTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2lucHV0JywgJy5zZXR0aW5ncy1ibG9jayBpbnB1dFtuYW1lXVt0eXBlPVwidGV4dFwiXSwgLnNldHRpbmdzLWJsb2NrIHRleHRhcmVhW25hbWVdJywgY29tcGFyZS5zaW5nbGUpO1xuICAgIGJvZHkuZGVsZWdhdGUoJ2NoYW5nZScsICcuc2V0dGluZ3MtYmxvY2sgaW5wdXRbbmFtZV1bdHlwZT1cImhpZGRlblwiXSwgLnNldHRpbmdzLWJsb2NrIGlucHV0W25hbWVdW3R5cGU9XCJjaGVja2JveFwiXSwgLnNldHRpbmdzLWJsb2NrIHNlbGVjdFtuYW1lXScsIGNvbXBhcmUuc2luZ2xlKTtcblxuICAgIGJvZHkub24oJ3N0YXRlY2hhbmdlRW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGUoKTtcbiAgICAgICAgYm9keS5lbWl0KCd1cGRhdGVPcmlnaW5hbEZpZWxkcycpO1xuICAgIH0pO1xuXG4gICAgYm9keS5vbigndXBkYXRlT3JpZ2luYWxGaWVsZHMnLCBmdW5jdGlvbigpe1xuICAgICAgICBvcmlnaW5hbHMgPSBjb2xsZWN0RmllbGRzVmFsdWVzKCk7XG4gICAgfSk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7fTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIEJhc2UgICAgICAgPSByZXF1aXJlKCcuL2Jhc2UnKSxcbiAgICB6ZW4gICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgZ2V0QWpheFVSTCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmNvbmZpZztcblxudmFyIEF0b20gPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBCYXNlLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdHlwZTogJ2F0b20nXG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIEJhc2UuY2FsbCh0aGlzLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLm9uKCdjaGFuZ2VkJywgdGhpcy5oYXNDaGFuZ2VkKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlVGl0bGU6IGZ1bmN0aW9uKHRpdGxlKSB7XG4gICAgICAgIHRoaXMuYmxvY2suZmluZCgnLnRpdGxlJykudGV4dCh0aXRsZSk7XG4gICAgICAgIHRoaXMuc2V0VGl0bGUodGl0bGUpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNldHRpbmdzX3VyaSA9IGdldEFqYXhVUkwodGhpcy5nZXRQYWdlSWQoKSArICcvbGF5b3V0LycgKyB0aGlzLmdldFR5cGUoKSArICcvJyArIHRoaXMuZ2V0SWQoKSksXG4gICAgICAgICAgICBzdWJ0eXBlICAgICAgPSB0aGlzLmdldFN1YlR5cGUoKSA/ICdkYXRhLWxtLWJsb2Nrc3VidHlwZT1cIicgKyB0aGlzLmdldFN1YlR5cGUoKSArICdcIicgOiAnJztcbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiJyArIHRoaXMuZ2V0VHlwZSgpICsgJ1wiIGRhdGEtbG0taWQ9XCInICsgdGhpcy5nZXRJZCgpICsgJ1wiIGRhdGEtbG0tYmxvY2t0eXBlPVwiJyArIHRoaXMuZ2V0VHlwZSgpICsgJ1wiICcgKyBzdWJ0eXBlICsgJz48c3Bhbj48c3BhbiBjbGFzcz1cInRpdGxlXCI+JyArIHRoaXMuZ2V0VGl0bGUoKSArICc8L3NwYW4+PHNwYW4gY2xhc3M9XCJmb250LXNtYWxsXCI+JyArICh0aGlzLmdldFN1YlR5cGUoKSB8fCB0aGlzLmdldEtleSgpIHx8IHRoaXMuZ2V0VHlwZSgpKSArICc8L3NwYW4+PC9zcGFuPjxkaXYgY2xhc3M9XCJmbG9hdC1yaWdodFwiPjxpIGNsYXNzPVwiZmEgZmEtY29nXCIgZGF0YS1sbS1ub2RyYWcgZGF0YS1sbS1ub2RyYWcgZGF0YS1sbS1zZXR0aW5ncz1cIicgKyBzZXR0aW5nc191cmkgKyAnXCI+PC9pPjwvZGl2PjwvZGl2Pic7XG4gICAgfSxcblxuICAgIGhhc0NoYW5nZWQ6IGZ1bmN0aW9uKHN0YXRlLCBwYXJlbnQpIHtcbiAgICAgICAgdmFyIGljb24gPSB0aGlzLmJsb2NrLmZpbmQoJ3NwYW4gPiBpLmNoYW5nZXMtaW5kaWNhdG9yOmZpcnN0LWNoaWxkJyk7XG5cbiAgICAgICAgLy8gaWYgdGhlIHBhcnRpY2xlIGhhcyBjaGFuZ2VzIGJ1dCB0aGUgcGFyZW50IGJsb2NrIGRvZXNuJ3QsIHdlIHdhbnQgdG8ga2VlcCB0aGUgaW5kaWNhdG9yIHNob3dpbmdcbiAgICAgICAgaWYgKGljb24gJiYgcGFyZW50ICYmICFwYXJlbnQuY2hhbmdlU3RhdGUpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5ibG9ja1tzdGF0ZSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnYmxvY2staGFzLWNoYW5nZXMnKTtcblxuICAgICAgICBpZiAoIXN0YXRlICYmIGljb24pIHsgaWNvbi5yZW1vdmUoKTsgfVxuICAgICAgICBpZiAoc3RhdGUgJiYgIWljb24pIHsgemVuKCdpLmZhLmZhLWNpcmNsZS1vLmNoYW5nZXMtaW5kaWNhdG9yJykuYmVmb3JlKHRoaXMuYmxvY2suZmluZCgnLnRpdGxlJykpOyB9XG4gICAgfSxcblxuICAgIG9uUmVuZGVyZWQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHBhcmVudCkge1xuICAgICAgICB2YXIgZ2xvYmFsbHlfZGlzYWJsZWQgPSAkKCdbZGF0YS1sbS1kaXNhYmxlZF1bZGF0YS1sbS1zdWJ0eXBlPVwiJyArIHRoaXMuZ2V0U3ViVHlwZSgpICsgJ1wiXScpO1xuXG4gICAgICAgIGlmIChnbG9iYWxseV9kaXNhYmxlZCB8fCB0aGlzLmdldEF0dHJpYnV0ZSgnZW5hYmxlZCcpID09PSAwKSB7IHRoaXMuZGlzYWJsZSgpOyB9XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQXRvbTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIFNlY3Rpb24gPSByZXF1aXJlKCcuL3NlY3Rpb24nKTtcblxudmFyIEF0b21zID0gbmV3IHByaW1lKHtcbiAgICBpbmhlcml0czogU2VjdGlvbixcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHR5cGU6ICdhdG9tcycsXG4gICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgIG5hbWU6IFwiQXRvbXMgU2VjdGlvblwiXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiYXRvbXMtc2VjdGlvblwiIGRhdGEtbG0taWQ9XCInICsgdGhpcy5nZXRJZCgpICsgJ1wiIGRhdGEtbG0tYmxvY2t0eXBlPVwiJyArIHRoaXMuZ2V0VHlwZSgpICsgJ1wiPjxkaXYgY2xhc3M9XCJzZWN0aW9uLWhlYWRlciBjbGVhcmZpeFwiPjxoNCBjbGFzcz1cImZsb2F0LWxlZnRcIj4nICsgKHRoaXMuZ2V0QXR0cmlidXRlKCduYW1lJykpICsgJzwvaDQ+PC9kaXY+PC9kaXY+JztcbiAgICB9LFxuXG4gICAgZ2V0SWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pZCB8fCAodGhpcy5pZCA9IHRoaXMub3B0aW9ucy50eXBlKTtcbiAgICB9LFxuXG4gICAgb25Eb25lOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAoIXRoaXMuYmxvY2suc2VhcmNoKCdbZGF0YS1sbS1pZF0nKSkge1xuICAgICAgICAgICAgdGhpcy5ncmlkLmluc2VydCh0aGlzLmJsb2NrLCAnYm90dG9tJyk7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuYnVpbGRlci5hZGQodGhpcy5ncmlkKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEF0b21zO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcHJpbWUgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgT3B0aW9ucyA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIEJvdW5kICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9ib3VuZCcpLFxuICAgIEVtaXR0ZXIgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgZ3VpZCAgICA9IHJlcXVpcmUoJ21vdXQvcmFuZG9tL2d1aWQnKSxcbiAgICB6ZW4gICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgJCAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG5cbiAgICBnZXQgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZ2V0JyksXG4gICAgaGFzICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2hhcycpLFxuICAgIHNldCAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9zZXQnKTtcblxucmVxdWlyZSgnZWxlbWVudHMvdHJhdmVyc2FsJyk7XG5cbnZhciBCYXNlID0gbmV3IHByaW1lKHtcbiAgICBtaXhpbjogW0JvdW5kLCBPcHRpb25zXSxcbiAgICBpbmhlcml0czogRW1pdHRlcixcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHN1YnR5cGU6IGZhbHNlLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7fVxuICAgIH0sXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmZyZXNoID0gIXRoaXMub3B0aW9ucy5pZDtcbiAgICAgICAgdGhpcy5pZCA9IHRoaXMub3B0aW9ucy5pZCB8fCB0aGlzLmd1aWQoKTtcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gdGhpcy5vcHRpb25zLmF0dHJpYnV0ZXMgfHwge307XG5cbiAgICAgICAgdGhpcy5ibG9jayA9IHplbignZGl2JykuaHRtbCh0aGlzLmxheW91dCgpKS5maXJzdENoaWxkKCk7XG5cbiAgICAgICAgdGhpcy5vbigncmVuZGVyZWQnLCB0aGlzLmJvdW5kKCdvblJlbmRlcmVkJykpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBndWlkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGd1aWQoKTtcbiAgICB9LFxuXG4gICAgZ2V0SWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pZCB8fCAodGhpcy5pZCA9IHRoaXMuZ3VpZCgpKTtcbiAgICB9LFxuXG4gICAgZ2V0VHlwZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMudHlwZSB8fCAnJztcbiAgICB9LFxuXG4gICAgZ2V0U3ViVHlwZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuc3VidHlwZSB8fCAnJztcbiAgICB9LFxuXG4gICAgZ2V0VGl0bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRpdGxlIHx8ICdVbnRpdGxlZCc7XG4gICAgfSxcblxuICAgIHNldFRpdGxlOiBmdW5jdGlvbih0aXRsZSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMudGl0bGUgPSB0aXRsZSB8fCAnVW50aXRsZWQnO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgZ2V0S2V5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH0sXG5cbiAgICBnZXRQYWdlSWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcm9vdCA9ICQoJ1tkYXRhLWxtLXJvb3RdJyk7XG4gICAgICAgIGlmICghcm9vdCkgcmV0dXJuICdkYXRhLXJvb3Qtbm90LWZvdW5kJztcblxuICAgICAgICByZXR1cm4gcm9vdC5kYXRhKCdsbS1wYWdlJyk7XG4gICAgfSxcblxuICAgIGdldEF0dHJpYnV0ZTogZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIHJldHVybiBnZXQodGhpcy5hdHRyaWJ1dGVzLCBrZXkpO1xuICAgIH0sXG5cbiAgICBnZXRBdHRyaWJ1dGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlcyB8fCB7fTtcbiAgICB9LFxuXG4gICAgdXBkYXRlVGl0bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0QXR0cmlidXRlOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIHNldCh0aGlzLmF0dHJpYnV0ZXMsIGtleSwgdmFsdWUpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0QXR0cmlidXRlczogZnVuY3Rpb24oYXR0cmlidXRlcykge1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBoYXNBdHRyaWJ1dGU6IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICByZXR1cm4gaGFzKHRoaXMuYXR0cmlidXRlcywga2V5KTtcbiAgICB9LFxuXG4gICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYmxvY2suYXR0cmlidXRlKCd0aXRsZScsICdUaGlzIHBhcnRpY2xlIGhhcyBiZWVuIGRpc2FibGVkIGFuZCBpdCB3b25cXCd0IGJlIHJlbmRlcmVkIG9uIGZyb250LWVuZC4gWW91IGNhbiBzdGlsbCBjb25maWd1cmUsIG1vdmUgYW5kIGRlbGV0ZS4nKTtcbiAgICAgICAgdGhpcy5ibG9jay5hZGRDbGFzcygncGFydGljbGUtZGlzYWJsZWQnKTtcbiAgICB9LFxuXG4gICAgZW5hYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5ibG9jay5hdHRyaWJ1dGUoJ3RpdGxlJywgbnVsbCk7XG4gICAgICAgIHRoaXMuYmxvY2sucmVtb3ZlQ2xhc3MoJ3BhcnRpY2xlLWRpc2FibGVkJyk7XG4gICAgfSxcblxuICAgIGluc2VydDogZnVuY3Rpb24odGFyZ2V0LCBsb2NhdGlvbikge1xuICAgICAgICB0aGlzLmJsb2NrW2xvY2F0aW9uIHx8ICdhZnRlciddKHRhcmdldCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBhZG9wdDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50Lmluc2VydCh0aGlzLmJsb2NrKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGlzTmV3OiBmdW5jdGlvbihmcmVzaCkge1xuICAgICAgICBpZiAodHlwZW9mIGZyZXNoICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5mcmVzaCA9ICEhZnJlc2g7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZnJlc2g7XG4gICAgfSxcblxuICAgIGRyb3B6b25lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICdkYXRhLWxtLWRyb3B6b25lJztcbiAgICB9LFxuXG4gICAgYWRkRHJvcHpvbmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuYmxvY2suZGF0YSgnbG0tZHJvcHpvbmUnLCB0cnVlKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlRHJvcHpvbmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuYmxvY2suZGF0YSgnbG0tZHJvcHpvbmUnLCBudWxsKTtcbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHt9LFxuXG4gICAgb25SZW5kZXJlZDogZnVuY3Rpb24oKXt9LFxuXG4gICAgc2V0TGF5b3V0OiBmdW5jdGlvbihsYXlvdXQpIHtcbiAgICAgICAgdGhpcy5ibG9jayA9IGxheW91dDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgQmFzZSAgICAgID0gcmVxdWlyZSgnLi9iYXNlJyksXG4gICAgJCAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICB6ZW4gICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBwcmVjaXNpb24gPSByZXF1aXJlKCdtb3V0L251bWJlci9lbmZvcmNlUHJlY2lzaW9uJyksXG4gICAgYmluZCAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyk7XG5cbnZhciBCbG9jayA9IG5ldyBwcmltZSh7XG4gICAgaW5oZXJpdHM6IEJhc2UsXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0eXBlOiAnYmxvY2snLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBzaXplOiAxMDBcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBCYXNlLmNhbGwodGhpcywgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5vbignY2hhbmdlZCcsIHRoaXMuaGFzQ2hhbmdlZCk7XG4gICAgfSxcblxuICAgIGdldFNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdHRyaWJ1dGUoJ3NpemUnKTtcbiAgICB9LFxuXG4gICAgc2V0U2l6ZTogZnVuY3Rpb24oc2l6ZSwgc3RvcmUpIHtcbiAgICAgICAgc2l6ZSA9IHR5cGVvZiBzaXplID09PSAndW5kZWZpbmVkJyA/IHRoaXMuZ2V0U2l6ZSgpIDogTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBwYXJzZUZsb2F0KHNpemUpKSk7XG4gICAgICAgIGlmIChzdG9yZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoJ3NpemUnLCBzaXplKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQodGhpcy5ibG9jaykuc3R5bGUoe1xuICAgICAgICAgICAgZmxleDogJzAgMSAnICsgc2l6ZSArICclJyxcbiAgICAgICAgICAgICctd2Via2l0LWZsZXgnOiAnMCAxICcgKyBzaXplICsgJyUnLFxuICAgICAgICAgICAgJy1tcy1mbGV4JzogJzAgMSAnICsgc2l6ZSArICclJ1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVtaXQoJ3Jlc2l6ZWQnLCBzaXplLCB0aGlzKTtcbiAgICB9LFxuXG4gICAgc2V0QW5pbWF0ZWRTaXplOiBmdW5jdGlvbihzaXplLCBzdG9yZSkge1xuICAgICAgICBzaXplID0gdHlwZW9mIHNpemUgPT09ICd1bmRlZmluZWQnID8gdGhpcy5nZXRTaXplKCkgOiBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIHBhcnNlRmxvYXQoc2l6ZSkpKTtcbiAgICAgICAgaWYgKHN0b3JlKSB7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgnc2l6ZScsIHNpemUpO1xuICAgICAgICB9XG4gICAgICAgICQodGhpcy5ibG9jaykuYW5pbWF0ZSh7XG4gICAgICAgICAgICBmbGV4OiAnMCAxICcgKyBzaXplICsgJyUnLFxuICAgICAgICAgICAgJy13ZWJraXQtZmxleCc6ICcwIDEgJyArIHNpemUgKyAnJScsXG4gICAgICAgICAgICAnLW1zLWZsZXgnOiAnMCAxICcgKyBzaXplICsgJyUnXG4gICAgICAgIH0sIGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmJsb2NrLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U2l6ZShzaXplKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuZW1pdCgncmVzaXplZCcsIHNpemUsIHRoaXMpO1xuICAgIH0sXG5cbiAgICBzZXRMYWJlbFNpemU6IGZ1bmN0aW9uKHNpemUpIHtcbiAgICAgICAgdmFyIGxhYmVsID0gdGhpcy5ibG9jay5maW5kKCc+IC5wYXJ0aWNsZS1zaXplJyk7XG4gICAgICAgIGlmICghbGFiZWwpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgbGFiZWwudGV4dChwcmVjaXNpb24oc2l6ZSwgMSkgKyAnJScpO1xuICAgIH0sXG5cbiAgICBsYXlvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJnLWJsb2NrXCIgZGF0YS1sbS1pZD1cIicgKyB0aGlzLmdldElkKCkgKyAnXCInICsgdGhpcy5kcm9wem9uZSgpICsgJyBkYXRhLWxtLWJsb2NrdHlwZT1cImJsb2NrXCI+PC9kaXY+JztcbiAgICB9LFxuXG4gICAgb25SZW5kZXJlZDogZnVuY3Rpb24oZWxlbWVudCwgcGFyZW50KSB7XG4gICAgICAgIGlmIChlbGVtZW50LmJsb2NrLmZpbmQoJz4gW2RhdGEtbG0tYmxvY2t0eXBlPVwic2VjdGlvblwiXScpKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZURyb3B6b25lKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXBhcmVudCkgeyByZXR1cm47IH1cblxuICAgICAgICB2YXIgZ3JhbmRwYSA9IHBhcmVudC5ibG9jay5wYXJlbnQoKTtcbiAgICAgICAgaWYgKGdyYW5kcGEuZGF0YSgnbG0tcm9vdCcpIHx8IChncmFuZHBhLmRhdGEoJ2xtLWJsb2NrdHlwZScpID09ICdjb250YWluZXInICYmIGdyYW5kcGEucGFyZW50KCkuZGF0YSgnbG0tcm9vdCcpKSkge1xuICAgICAgICAgICAgemVuKCdzcGFuLnBhcnRpY2xlLXNpemUnKS50ZXh0KHRoaXMuZ2V0U2l6ZSgpICsgJyUnKS50b3AoZWxlbWVudC5ibG9jayk7XG4gICAgICAgICAgICBlbGVtZW50Lm9uKCdyZXNpemVkJywgdGhpcy5ib3VuZCgnb25SZXNpemUnKSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25SZXNpemU6IGZ1bmN0aW9uKHJlc2l6ZSkge1xuICAgICAgICB0aGlzLnNldExhYmVsU2l6ZShyZXNpemUpO1xuICAgIH0sXG5cbiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgICB2YXIgaWNvbixcbiAgICAgICAgICAgIGNoaWxkID0gdGhpcy5ibG9jay5maW5kKCc+IFtkYXRhLWxtLWlkXTpub3QoW2RhdGEtbG0tYmxvY2t0eXBlPVwic2VjdGlvblwiXSk6bm90KFtkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXSknKTtcblxuICAgICAgICB0aGlzLmNoYW5nZVN0YXRlID0gc3RhdGU7XG5cbiAgICAgICAgaWYgKCFjaGlsZCkge1xuICAgICAgICAgICAgY2hpbGQgPSB0aGlzLmJsb2NrLmZpbmQoJz4gLnBhcnRpY2xlLXNpemUnKTtcbiAgICAgICAgICAgIGljb24gPSBjaGlsZC5maW5kKCdpOmZpcnN0LWNoaWxkJyk7XG5cbiAgICAgICAgICAgIGlmICghc3RhdGUgJiYgaWNvbikgeyBpY29uLnJlbW92ZSgpOyB9XG4gICAgICAgICAgICBpZiAoc3RhdGUgJiYgIWljb24pIHsgemVuKCdpLmZhLmZhLWNpcmNsZS1vLmNoYW5nZXMtaW5kaWNhdG9yJykudG9wKGNoaWxkKTsgfVxuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9wdGlvbnMuYnVpbGRlci5nZXQoY2hpbGQuZGF0YSgnbG0taWQnKSkuZW1pdCgnY2hhbmdlZCcsIHN0YXRlLCB0aGlzKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBCbG9jaztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEJhc2UgICAgICAgPSByZXF1aXJlKCcuL2Jhc2UnKSxcbiAgICAkICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKTtcblxudmFyIENvbnRhaW5lciA9IG5ldyBwcmltZSh7XG4gICAgaW5oZXJpdHM6IEJhc2UsXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0eXBlOiAnY29udGFpbmVyJ1xuICAgIH0sXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBCYXNlLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIGxheW91dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImctbG0tY29udGFpbmVyXCIgZGF0YS1sbS1pZD1cIicgKyB0aGlzLmdldElkKCkgKyAnXCIgZGF0YS1sbS1ibG9ja3R5cGU9XCJjb250YWluZXJcIj48L2Rpdj4nO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IENvbnRhaW5lcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEJhc2UgICAgICAgPSByZXF1aXJlKCcuL2Jhc2UnKSxcbiAgICAkICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICBnZXRBamF4VVJMID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuY29uZmlnO1xuXG52YXIgR3JpZCA9IG5ldyBwcmltZSh7XG4gICAgaW5oZXJpdHM6IEJhc2UsXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0eXBlOiAnZ3JpZCdcbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgQmFzZS5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMub24oJ2NoYW5nZWQnLCB0aGlzLmhhc0NoYW5nZWQpO1xuICAgIH0sXG5cbiAgICBsYXlvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJnLWdyaWQgbm93cmFwXCIgZGF0YS1sbS1pZD1cIicgKyB0aGlzLmdldElkKCkgKyAnXCIgJyArIHRoaXMuZHJvcHpvbmUoKSArICcgIGRhdGEtbG0tc2FtZXdpZHRoIGRhdGEtbG0tYmxvY2t0eXBlPVwiZ3JpZFwiPjwvZGl2Pic7XG4gICAgfSxcblxuICAgIG9uUmVuZGVyZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5ibG9jay5wYXJlbnQoKTtcbiAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQuZGF0YSgnbG0tcm9vdCcpIHx8IChwYXJlbnQuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT0gJ2NvbnRhaW5lcicgJiYgcGFyZW50LnBhcmVudCgpLmRhdGEoJ2xtLXJvb3QnKSkpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRHJvcHpvbmUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgICAvLyBHcmlkcyBkb24ndCBoYXZlIHJvb20gZm9yIGFuIGluZGljYXRvciBzbyB3ZSBmb3J3YXJkIGl0IHRvIHRoZSBwYXJlbnQgU2VjdGlvblxuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5ibG9jay5wYXJlbnQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cInNlY3Rpb25cIl0nKSxcbiAgICAgICAgICAgIGlkID0gcGFyZW50ID8gcGFyZW50LmRhdGEoJ2xtLWlkJykgOiBmYWxzZTtcblxuICAgICAgICB0aGlzLmNoYW5nZVN0YXRlID0gc3RhdGU7XG5cbiAgICAgICAgaWYgKCFwYXJlbnQgfHwgIWlkKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYnVpbGRlcikgeyB0aGlzLm9wdGlvbnMuYnVpbGRlci5nZXQoaWQpLmVtaXQoJ2NoYW5nZWQnLCBzdGF0ZSwgdGhpcyk7IH1cbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBHcmlkO1xuIiwibW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgYmFzZTogcmVxdWlyZSgnLi9iYXNlJyksXG4gICAgYXRvbTogcmVxdWlyZSgnLi9hdG9tJyksXG4gICAgc2VjdGlvbjogcmVxdWlyZSgnLi9zZWN0aW9uJyksXG4gICAgb2ZmY2FudmFzOiByZXF1aXJlKCcuL29mZmNhbnZhcycpLFxuICAgIGF0b21zOiByZXF1aXJlKCcuL2F0b21zJyksXG4gICAgZ3JpZDogcmVxdWlyZSgnLi9ncmlkJyksXG4gICAgY29udGFpbmVyOiByZXF1aXJlKCcuL2NvbnRhaW5lcicpLFxuICAgIGJsb2NrOiByZXF1aXJlKCcuL2Jsb2NrJyksXG4gICAgcGFydGljbGU6IHJlcXVpcmUoJy4vcGFydGljbGUnKSxcbiAgICBwb3NpdGlvbjogcmVxdWlyZSgnLi9wb3NpdGlvbicpLFxuICAgIHBhZ2Vjb250ZW50OiByZXF1aXJlKCcuL3BhZ2Vjb250ZW50JyksXG4gICAgc3BhY2VyOiByZXF1aXJlKCcuL3NwYWNlcicpXG59O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcHJpbWUgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgU2VjdGlvbiA9IHJlcXVpcmUoJy4vc2VjdGlvbicpLFxuXG4gICAgZ2V0QWpheFVSTCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXVybCcpLmNvbmZpZztcblxudmFyIE9mZmNhbnZhcyA9IG5ldyBwcmltZSh7XG4gICAgaW5oZXJpdHM6IFNlY3Rpb24sXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0eXBlOiAnb2ZmY2FudmFzJyxcbiAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgbmFtZTogXCJPZmZjYW52YXMgU2VjdGlvblwiXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNldHRpbmdzX3VyaSA9IGdldEFqYXhVUkwodGhpcy5nZXRQYWdlSWQoKSArICcvbGF5b3V0LycgKyB0aGlzLmdldFR5cGUoKSArICcvJyArIHRoaXMuZ2V0SWQoKSk7XG4gICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cIm9mZmNhbnZhcy1zZWN0aW9uXCIgZGF0YS1sbS1pZD1cIicgKyB0aGlzLmdldElkKCkgKyAnXCIgZGF0YS1sbS1ibG9ja3R5cGU9XCInICsgdGhpcy5nZXRUeXBlKCkgKyAnXCI+PGRpdiBjbGFzcz1cInNlY3Rpb24taGVhZGVyIGNsZWFyZml4XCI+PGg0IGNsYXNzPVwiZmxvYXQtbGVmdFwiPicgKyAodGhpcy5nZXRBdHRyaWJ1dGUoJ25hbWUnKSkgKyAnPC9oND48ZGl2IGNsYXNzPVwic2VjdGlvbi1hY3Rpb25zIGZsb2F0LXJpZ2h0XCI+PHNwYW4gY2xhc3M9XCJnLXRvb2x0aXAgZy10b29sdGlwLXJpZ2h0XCIgZGF0YS10aXRsZT1cIkFkZHMgYSBuZXcgcm93IGluIHRoZSBvZmZjYW52YXNcIj48aSBjbGFzcz1cImZhIGZhLXBsdXNcIj48L2k+PC9zcGFuPiA8c3BhbiBjbGFzcz1cImctdG9vbHRpcCBnLXRvb2x0aXAtcmlnaHRcIiBkYXRhLXRpdGxlPVwiT2ZmY2FudmFzIHNldHRpbmdzXCI+PGkgY2xhc3M9XCJmYSBmYS1jb2dcIiBkYXRhLWxtLXNldHRpbmdzPVwiJyArIHNldHRpbmdzX3VyaSArICdcIj48L2k+PC9zcGFuPjwvZGl2PjwvZGl2PjwvZGl2Pic7XG4gICAgfSxcblxuICAgIGdldElkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaWQgfHwgKHRoaXMuaWQgPSB0aGlzLm9wdGlvbnMudHlwZSk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gT2ZmY2FudmFzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcHJpbWUgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIFBhcnRpY2xlID0gcmVxdWlyZSgnLi9wYXJ0aWNsZScpO1xuXG52YXIgUGFnZWNvbnRlbnQgPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBQYXJ0aWNsZSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHR5cGU6ICdwYWdlY29udGVudCcsXG4gICAgICAgIHRpdGxlOiAnUGFnZSBDb250ZW50JyxcbiAgICAgICAgYXR0cmlidXRlczoge31cbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBQYWdlY29udGVudDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIEF0b20gICAgICAgPSByZXF1aXJlKCcuL2F0b20nKSxcbiAgICBiaW5kICAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgcHJlY2lzaW9uICA9IHJlcXVpcmUoJ21vdXQvbnVtYmVyL2VuZm9yY2VQcmVjaXNpb24nKSxcbiAgICBnZXRBamF4VVJMID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuY29uZmlnO1xuXG52YXIgVUlEID0gMDtcblxudmFyIFBhcnRpY2xlID0gbmV3IHByaW1lKHtcbiAgICBpbmhlcml0czogQXRvbSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHR5cGU6ICdwYXJ0aWNsZSdcbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgKytVSUQ7XG4gICAgICAgIEF0b20uY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNldHRpbmdzX3VyaSA9IGdldEFqYXhVUkwodGhpcy5nZXRQYWdlSWQoKSArICcvbGF5b3V0LycgKyB0aGlzLmdldFR5cGUoKSArICcvJyArIHRoaXMuZ2V0SWQoKSksXG4gICAgICAgICAgICBzdWJ0eXBlICAgICAgPSB0aGlzLmdldFN1YlR5cGUoKSA/ICdkYXRhLWxtLWJsb2Nrc3VidHlwZT1cIicgKyB0aGlzLmdldFN1YlR5cGUoKSArICdcIicgOiAnJztcblxuICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCInICsgdGhpcy5nZXRUeXBlKCkgKyAnXCIgZGF0YS1sbS1pZD1cIicgKyB0aGlzLmdldElkKCkgKyAnXCIgZGF0YS1sbS1ibG9ja3R5cGU9XCInICsgdGhpcy5nZXRUeXBlKCkgKyAnXCIgJyArIHN1YnR5cGUgKyAnPjxzcGFuPjxzcGFuIGNsYXNzPVwidGl0bGVcIj4nICsgdGhpcy5nZXRUaXRsZSgpICsgJzwvc3Bhbj48c3BhbiBjbGFzcz1cImZvbnQtc21hbGxcIj4nICsgKHRoaXMuZ2V0S2V5KCkgfHwgdGhpcy5nZXRTdWJUeXBlKCkgfHwgdGhpcy5nZXRUeXBlKCkpICsgJzwvc3Bhbj48L3NwYW4+PGRpdiBjbGFzcz1cImZsb2F0LXJpZ2h0XCI+PHNwYW4gY2xhc3M9XCJwYXJ0aWNsZS1zaXplXCI+PC9zcGFuPiA8aSBjbGFzcz1cImZhIGZhLWNvZ1wiIGRhdGEtbG0tbm9kcmFnIGRhdGEtbG0tc2V0dGluZ3M9XCInICsgc2V0dGluZ3NfdXJpICsgJ1wiPjwvaT48L2Rpdj48L2Rpdj4nO1xuICAgIH0sXG5cbiAgICBzZXRMYWJlbFNpemU6IGZ1bmN0aW9uKHNpemUpIHtcbiAgICAgICAgdmFyIGxhYmVsID0gdGhpcy5ibG9jay5maW5kKCcucGFydGljbGUtc2l6ZScpO1xuICAgICAgICBpZiAoIWxhYmVsKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIGxhYmVsLnRleHQocHJlY2lzaW9uKHNpemUsIDEpICsgJyUnKTtcbiAgICB9LFxuXG4gICAgb25SZW5kZXJlZDogZnVuY3Rpb24oZWxlbWVudCwgcGFyZW50KSB7XG4gICAgICAgIHZhciBzaXplICAgICAgICAgICAgICA9IHBhcmVudC5nZXRTaXplKCkgfHwgMTAwLFxuICAgICAgICAgICAgZ2xvYmFsbHlfZGlzYWJsZWQgPSAkKCdbZGF0YS1sbS1kaXNhYmxlZF1bZGF0YS1sbS1zdWJ0eXBlPVwiJyArIHRoaXMuZ2V0U3ViVHlwZSgpICsgJ1wiXScpO1xuXG4gICAgICAgIGlmIChnbG9iYWxseV9kaXNhYmxlZCB8fCB0aGlzLmdldEF0dHJpYnV0ZSgnZW5hYmxlZCcpID09PSAwKSB7IHRoaXMuZGlzYWJsZSgpOyB9XG5cbiAgICAgICAgdGhpcy5zZXRMYWJlbFNpemUoc2l6ZSk7XG4gICAgICAgIHBhcmVudC5vbigncmVzaXplZCcsIHRoaXMuYm91bmQoJ29uUGFyZW50UmVzaXplJykpO1xuICAgIH0sXG5cbiAgICBvblBhcmVudFJlc2l6ZTogZnVuY3Rpb24ocmVzaXplKSB7XG4gICAgICAgIHRoaXMuc2V0TGFiZWxTaXplKHJlc2l6ZSk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUGFydGljbGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgdHJpbSAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG4gICAgUGFydGljbGUgPSByZXF1aXJlKCcuL3BhcnRpY2xlJyk7XG5cbnZhciBVSUQgPSAwO1xuXG52YXIgUG9zaXRpb24gPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBQYXJ0aWNsZSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHR5cGU6ICdwb3NpdGlvbidcbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgKytVSUQ7XG4gICAgICAgIFBhcnRpY2xlLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCd0aXRsZScsIHRoaXMuZ2V0VGl0bGUoKSk7XG4gICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCdrZXknLCB0aGlzLmdldEtleSgpKTtcblxuICAgICAgICBpZiAodGhpcy5pc05ldygpKSB7IC0tVUlEOyB9XG4gICAgfSxcblxuICAgIGdldFRpdGxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLm9wdGlvbnMudGl0bGUgfHwgJ1Bvc2l0aW9uICcgKyBVSUQpO1xuICAgIH0sXG5cbiAgICBnZXRLZXk6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuZ2V0QXR0cmlidXRlKCdrZXknKSB8fCB0cmltKHRoaXMuZ2V0VGl0bGUoKSkucmVwbGFjZSgvXFxzL2csICctJykudG9Mb3dlckNhc2UoKSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZUtleTogZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5rZXkgPSBrZXkgfHwgdGhpcy5nZXRLZXkoKTtcbiAgICAgICAgdGhpcy5ibG9jay5maW5kKCcuZm9udC1zbWFsbCcpLnRleHQodGhpcy5nZXRLZXkoKSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBQb3NpdGlvbjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBCYXNlICA9IHJlcXVpcmUoJy4vYmFzZScpLFxuICAgIEJvdW5kID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9ib3VuZCcpLFxuICAgIEdyaWQgID0gcmVxdWlyZSgnLi9ncmlkJyksXG4gICAgJCAgICAgPSByZXF1aXJlKCdlbGVtZW50cycpLFxuICAgIHplbiAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG5cbiAgICBiaW5kICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIGdldEFqYXhVUkwgPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC11cmwnKS5jb25maWc7XG5cbnJlcXVpcmUoJ2VsZW1lbnRzL2luc2VydGlvbicpO1xuXG52YXIgVUlEID0gMDtcblxudmFyIFNlY3Rpb24gPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBCYXNlLFxuICAgIG9wdGlvbnM6IHt9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgKytVSUQ7XG4gICAgICAgIHRoaXMuZ3JpZCA9IG5ldyBHcmlkKCk7XG4gICAgICAgIEJhc2UuY2FsbCh0aGlzLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLm9uKCdkb25lJywgdGhpcy5ib3VuZCgnb25Eb25lJykpO1xuICAgICAgICB0aGlzLm9uKCdjaGFuZ2VkJywgdGhpcy5oYXNDaGFuZ2VkKTtcbiAgICB9LFxuXG4gICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNldHRpbmdzX3VyaSA9IGdldEFqYXhVUkwodGhpcy5nZXRQYWdlSWQoKSArICcvbGF5b3V0LycgKyB0aGlzLmdldFR5cGUoKSArICcvJyArIHRoaXMuZ2V0SWQoKSk7XG5cbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwic2VjdGlvblwiIGRhdGEtbG0taWQ9XCInICsgdGhpcy5nZXRJZCgpICsgJ1wiIGRhdGEtbG0tYmxvY2t0eXBlPVwiJyArIHRoaXMuZ2V0VHlwZSgpICsgJ1wiPjxkaXYgY2xhc3M9XCJzZWN0aW9uLWhlYWRlciBjbGVhcmZpeFwiPjxoNCBjbGFzcz1cImZsb2F0LWxlZnRcIj4nICsgKHRoaXMuZ2V0VGl0bGUoKSkgKyAnPC9oND48ZGl2IGNsYXNzPVwic2VjdGlvbi1hY3Rpb25zIGZsb2F0LXJpZ2h0XCI+PHNwYW4gY2xhc3M9XCJnLXRvb2x0aXAgZy10b29sdGlwLXJpZ2h0XCIgZGF0YS10aXRsZT1cIkFkZHMgYSBuZXcgcm93IGluIHRoZSBzZWN0aW9uXCI+PGkgY2xhc3M9XCJmYSBmYS1wbHVzXCI+PC9pPjwvc3Bhbj4gPHNwYW4gY2xhc3M9XCJnLXRvb2x0aXAgZy10b29sdGlwLXJpZ2h0XCIgZGF0YS10aXRsZT1cIlNlY3Rpb24gc2V0dGluZ3NcIj48aSBjbGFzcz1cImZhIGZhLWNvZ1wiIGRhdGEtbG0tc2V0dGluZ3M9XCInICsgc2V0dGluZ3NfdXJpICsgJ1wiPjwvaT48L3NwYW4+PC9kaXY+PC9kaXY+PC9kaXY+JztcbiAgICB9LFxuXG4gICAgYWRvcHQ6IGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgICQoY2hpbGQpLmluc2VydCh0aGlzLmJsb2NrLmZpbmQoJy5nLWdyaWQnKSk7XG4gICAgfSxcblxuICAgIGhhc0NoYW5nZWQ6IGZ1bmN0aW9uKHN0YXRlLCBjaGlsZCkge1xuICAgICAgICB2YXIgaWNvbiA9IHRoaXMuYmxvY2suZmluZCgnaDQgPiBpOmZpcnN0LWNoaWxkJyk7XG5cbiAgICAgICAgLy8gaWYgdGhlIHRoZSBldmVudCBpcyB0cmlnZ2VyZWQgZnJvbSBhIGdyaWQgd2UgbmVlZCB0byBiZSBjYXV0aW91cyBub3QgdG8gb3ZlcnJpZGUgdGhlIHByb3BlciBzdGF0ZVxuICAgICAgICBpZiAoaWNvbiAmJiBjaGlsZCAmJiAhY2hpbGQuY2hhbmdlU3RhdGUpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5ibG9ja1tzdGF0ZSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnYmxvY2staGFzLWNoYW5nZXMnKTtcblxuICAgICAgICBpZiAoIXN0YXRlICYmIGljb24pIHsgaWNvbi5yZW1vdmUoKTsgfVxuICAgICAgICBpZiAoc3RhdGUgJiYgIWljb24pIHsgemVuKCdpLmZhLmZhLWNpcmNsZS1vLmNoYW5nZXMtaW5kaWNhdG9yJykudG9wKHRoaXMuYmxvY2suZmluZCgnaDQnKSk7IH1cbiAgICB9LFxuXG4gICAgb25Eb25lOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAoIXRoaXMuYmxvY2suc2VhcmNoKCdbZGF0YS1sbS1pZF0nKSkge1xuICAgICAgICAgICAgdGhpcy5ncmlkLmluc2VydCh0aGlzLmJsb2NrLCAnYm90dG9tJyk7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuYnVpbGRlci5hZGQodGhpcy5ncmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwbHVzID0gdGhpcy5ibG9jay5maW5kKCcuZmEtcGx1cycpO1xuICAgICAgICBpZiAocGx1cykge1xuICAgICAgICAgICAgcGx1cy5vbignY2xpY2snLCBiaW5kKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSkgeyBlLnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJsb2NrLmZpbmQoJy5nLWdyaWQ6bGFzdC1jaGlsZDplbXB0eScpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkID0gbmV3IEdyaWQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWQuaW5zZXJ0KHRoaXMuYmxvY2suZmluZCgnW2RhdGEtbG0tYmxvY2t0eXBlPVwiY29udGFpbmVyXCJdJykgPyB0aGlzLmJsb2NrLmZpbmQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXScpIDogdGhpcy5ibG9jaywgJ2JvdHRvbScpO1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5idWlsZGVyLmFkZCh0aGlzLmdyaWQpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gU2VjdGlvbjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBQYXJ0aWNsZSA9IHJlcXVpcmUoJy4vcGFydGljbGUnKTtcblxudmFyIFVJRCA9IDA7XG5cbnZhciBTcGFjZXIgPSBuZXcgcHJpbWUoe1xuICAgIGluaGVyaXRzOiBQYXJ0aWNsZSxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHR5cGU6ICdzcGFjZXInLFxuICAgICAgICB0aXRsZTogJ1NwYWNlcicsXG4gICAgICAgIGF0dHJpYnV0ZXM6IHt9XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gU3BhY2VyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcHJpbWUgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgJCAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgRW1pdHRlciA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKTtcblxudmFyIEJsb2NrcyA9IHJlcXVpcmUoJy4vYmxvY2tzLycpO1xuXG52YXIgZm9yT3duICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2Zvck93bicpLFxuICAgIGZvckVhY2ggICAgPSByZXF1aXJlKCdtb3V0L2NvbGxlY3Rpb24vZm9yRWFjaCcpLFxuICAgIHNpemUgICAgICAgPSByZXF1aXJlKCdtb3V0L2NvbGxlY3Rpb24vc2l6ZScpLFxuICAgIGlzQXJyYXkgICAgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNBcnJheScpLFxuICAgIGZsYXR0ZW4gICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2ZsYXR0ZW4nKSxcbiAgICBndWlkICAgICAgID0gcmVxdWlyZSgnbW91dC9yYW5kb20vZ3VpZCcpLFxuXG4gICAgc2V0ICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L3NldCcpLFxuICAgIHVuc2V0ICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC91bnNldCcpLFxuICAgIGdldCAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9nZXQnKSxcbiAgICBkZWVwRmlsbEluID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZGVlcEZpbGxJbicpLFxuICAgIG9taXQgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9vbWl0Jyk7XG5cbnJlcXVpcmUoJ2VsZW1lbnRzL2F0dHJpYnV0ZXMnKTtcbnJlcXVpcmUoJ2VsZW1lbnRzL3RyYXZlcnNhbCcpO1xuXG5cbi8vIHN0YXJ0IERlYnVnXG52YXIgcnBhZCAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvcnBhZCcpLFxuICAgIHJlcGVhdCA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3JlcGVhdCcpO1xuLy8gZW5kICAgRGVidWdcblxuJC5pbXBsZW1lbnQoe1xuICAgIGVtcHR5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKSB7XG4gICAgICAgICAgICB2YXIgZmlyc3Q7XG4gICAgICAgICAgICB3aGlsZSAoKGZpcnN0ID0gbm9kZS5maXJzdENoaWxkKSkge1xuICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2hpbGQoZmlyc3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxudmFyIEJ1aWxkZXIgPSBuZXcgcHJpbWUoe1xuXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oc3RydWN0dXJlKSB7XG4gICAgICAgIGlmIChzdHJ1Y3R1cmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RydWN0dXJlKHN0cnVjdHVyZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tYXAgPSB7fTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0U3RydWN0dXJlOiBmdW5jdGlvbihzdHJ1Y3R1cmUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuc3RydWN0dXJlID0gKHR5cGVvZiBzdHJ1Y3R1cmUgPT09ICdvYmplY3QnKSA/IHN0cnVjdHVyZSA6IEpTT04ucGFyc2Uoc3RydWN0dXJlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlBhcnNpbmcgZXJyb3I6XCIsIGUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkZDogZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgICAgdmFyIGlkID0gdHlwZW9mIGJsb2NrID09PSAnc3RyaW5nJyA/IGJsb2NrIDogYmxvY2suaWQ7XG4gICAgICAgIHNldCh0aGlzLm1hcCwgaWQsIGJsb2NrKTtcbiAgICAgICAgYmxvY2suaXNOZXcoZmFsc2UpO1xuICAgIH0sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKGJsb2NrKSB7XG4gICAgICAgIGJsb2NrID0gdHlwZW9mIGJsb2NrID09PSAnc3RyaW5nJyA/IGJsb2NrIDogYmxvY2suaWQ7XG4gICAgICAgIHVuc2V0KHRoaXMubWFwLCBibG9jayk7XG4gICAgfSxcblxuICAgIGdldDogZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgICAgdmFyIGlkID0gdHlwZW9mIGJsb2NrID09PSAnc3RyaW5nJyA/IGJsb2NrIDogYmxvY2suaWQ7XG4gICAgICAgIHJldHVybiBnZXQodGhpcy5tYXAsIGlkLCBibG9jayk7XG4gICAgfSxcblxuICAgIGxvYWQ6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdGhpcy5yZWN1cnNpdmVMb2FkKGRhdGEpO1xuICAgICAgICB0aGlzLmVtaXQoJ2xvYWRlZCcsIGRhdGEpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKHJvb3QsIGZsYXQpIHtcbiAgICAgICAgdmFyIHNlcmllQ2hpbGRyZW4gPSBbXTtcbiAgICAgICAgcm9vdCA9IHJvb3QgfHwgJCgnW2RhdGEtbG0tcm9vdF0nKTtcblxuICAgICAgICBpZiAoIXJvb3QpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdmFyIGJsb2NrcyA9IHJvb3Quc2VhcmNoKCghZmxhdCA/ICc+ICcgOiAnJykgKyAnW2RhdGEtbG0taWRdJyksXG4gICAgICAgICAgICBpZCwgdHlwZSwgc3VidHlwZSwgc2VyaWFsLCBoYXNDaGlsZHJlbiwgY2hpbGRyZW47XG5cbiAgICAgICAgZm9yRWFjaChibG9ja3MsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgaWQgPSBlbGVtZW50LmRhdGEoJ2xtLWlkJyk7XG4gICAgICAgICAgICB0eXBlID0gZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKTtcbiAgICAgICAgICAgIHN1YnR5cGUgPSBlbGVtZW50LmRhdGEoJ2xtLWJsb2Nrc3VidHlwZScpIHx8IGZhbHNlO1xuICAgICAgICAgICAgaGFzQ2hpbGRyZW4gPSBlbGVtZW50LnNlYXJjaCgnPiBbZGF0YS1sbS1pZF0nKTtcblxuICAgICAgICAgICAgaWYgKGZsYXQpIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IGhhc0NoaWxkcmVuID8gaGFzQ2hpbGRyZW4ubWFwKGZ1bmN0aW9uKGVsZW1lbnQpeyByZXR1cm4gJChlbGVtZW50KS5kYXRhKCdsbS1pZCcpOyB9KSA6IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA9IGhhc0NoaWxkcmVuID8gdGhpcy5zZXJpYWxpemUoZWxlbWVudCkgOiBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VyaWFsID0ge1xuICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgIHN1YnR5cGU6IHN1YnR5cGUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldCh0aGlzLm1hcCwgaWQpID8gZ2V0KHRoaXMubWFwLCBpZCkuZ2V0VGl0bGUoKSA6ICdVbnRpdGxlZCcsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczogZ2V0KHRoaXMubWFwLCBpZCkgPyBnZXQodGhpcy5tYXAsIGlkKS5nZXRBdHRyaWJ1dGVzKCkgOiB7fSxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChmbGF0KSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9OyBvYmpbaWRdID0gc2VyaWFsO1xuICAgICAgICAgICAgICAgIHNlcmlhbCA9IG9iajtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VyaWVDaGlsZHJlbi5wdXNoKHNlcmlhbCk7XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIHJldHVybiBzZXJpZUNoaWxkcmVuO1xuICAgIH0sXG5cbiAgICBpbnNlcnQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUsIHBhcmVudC8qLCBvYmplY3QqLykge1xuICAgICAgICB2YXIgcm9vdCA9ICQoJ1tkYXRhLWxtLXJvb3RdJyk7XG4gICAgICAgIGlmICghcm9vdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFCbG9ja3NbdmFsdWUudHlwZV0pIHtcbiAgICAgICAgICAgIGNvbnNvbGVbY29uc29sZS5lcnJvciA/ICdlcnJvcicgOiAnbG9nJ10odmFsdWUudHlwZSArICcgZG9lcyBub3QgZXhpc3QnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBFbGVtZW50ID0gbmV3IChCbG9ja3NbdmFsdWUudHlwZV0gfHwgQmxvY2tzWydzZWN0aW9uJ10pKGRlZXBGaWxsSW4oe1xuICAgICAgICAgICAgaWQ6IGtleSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9LFxuICAgICAgICAgICAgc3VidHlwZTogdmFsdWUuc3VidHlwZSB8fCBmYWxzZSxcbiAgICAgICAgICAgIGJ1aWxkZXI6IHRoaXNcbiAgICAgICAgfSwgb21pdCh2YWx1ZSwgJ2NoaWxkcmVuJykpKTtcblxuICAgICAgICBpZiAoIXBhcmVudCkge1xuICAgICAgICAgICAgRWxlbWVudC5ibG9jay5pbnNlcnQocm9vdCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBFbGVtZW50LmJsb2NrLmluc2VydCgkKCdbZGF0YS1sbS1pZD1cIicgKyBwYXJlbnQgKyAnXCJdJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEVsZW1lbnQuZ2V0VHlwZSgpID09PSAnYmxvY2snKSB7XG4gICAgICAgICAgICBFbGVtZW50LnNldFNpemUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYWRkKEVsZW1lbnQpO1xuICAgICAgICBFbGVtZW50LmVtaXQoJ3JlbmRlcmVkJywgRWxlbWVudCwgcGFyZW50ID8gZ2V0KHRoaXMubWFwLCBwYXJlbnQpIDogbnVsbCk7XG5cbiAgICAgICAgcmV0dXJuIEVsZW1lbnQ7XG4gICAgfSxcblxuICAgIHJlc2V0OiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHRoaXMubWFwID0ge307XG4gICAgICAgIHRoaXMuc2V0U3RydWN0dXJlKGRhdGEgfHwge30pO1xuICAgICAgICAkKCdbZGF0YS1sbS1yb290XScpLmVtcHR5KCk7XG4gICAgICAgIHRoaXMubG9hZCgpO1xuICAgIH0sXG5cbiAgICBjbGVhbnVwTG9uZWx5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGdob3N0cyA9IFtdLFxuICAgICAgICAgICAgcGFyZW50LCBjaGlsZHJlbiA9ICQoJ1tkYXRhLWxtLXJvb3RdID4gLmctc2VjdGlvbiA+IC5nLWdyaWQgPiAuZy1ibG9jayAuZy1ncmlkID4gLmctYmxvY2ssIFtkYXRhLWxtLXJvb3RdID4gLmctc2VjdGlvbiA+IC5nLWdyaWQgPiAuZy1ibG9jayA+IC5nLWJsb2NrJyk7XG5cbiAgICAgICAgaWYgKCFjaGlsZHJlbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cblxuICAgICAgICB2YXIgaXNHcmlkO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgICAgICBjaGlsZCA9ICQoY2hpbGQpO1xuICAgICAgICAgICAgcGFyZW50ID0gbnVsbDtcbiAgICAgICAgICAgIGlzR3JpZCA9IGNoaWxkLnBhcmVudCgpLmhhc0NsYXNzKCdnLWdyaWQnKTtcblxuICAgICAgICAgICAgaWYgKGlzR3JpZCAmJiBjaGlsZC5zaWJsaW5ncygpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNHcmlkKSB7XG4gICAgICAgICAgICAgICAgZ2hvc3RzLnB1c2goY2hpbGQuZGF0YSgnbG0taWQnKSk7XG4gICAgICAgICAgICAgICAgcGFyZW50ID0gY2hpbGQucGFyZW50KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdob3N0cy5wdXNoKGNoaWxkLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgY2hpbGQuY2hpbGRyZW4oKS5iZWZvcmUocGFyZW50ID8gcGFyZW50IDogY2hpbGQpO1xuICAgICAgICAgICAgKHBhcmVudCA/IHBhcmVudCA6IGNoaWxkKS5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGdob3N0cztcbiAgICB9LFxuXG4gICAgcmVjdXJzaXZlTG9hZDogZnVuY3Rpb24oZGF0YSwgY2FsbGJhY2ssIGRlcHRoLCBwYXJlbnQpIHtcbiAgICAgICAgZGF0YSA9IGRhdGEgfHwgdGhpcy5zdHJ1Y3R1cmU7XG4gICAgICAgIGRlcHRoID0gZGVwdGggfHwgMDtcbiAgICAgICAgcGFyZW50ID0gcGFyZW50IHx8IGZhbHNlO1xuICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IHRoaXMuaW5zZXJ0O1xuXG4gICAgICAgIGZvckVhY2goZGF0YSwgZnVuY3Rpb24odmFsdWUvKiwga2V5LCBvYmplY3QqLykge1xuXG4gICAgICAgICAgICBpZiAoIXZhbHVlLmlkKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUuaWQgPSBndWlkKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGRlYnVnIChmbGF0IHZpZXcgb2YgdGhlIHN0cnVjdHVyZSlcbiAgICAgICAgICAgIGlmIChjb25zb2xlICYmIGNvbnNvbGUubG9nKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocnBhZChyZXBlYXQoJyAgICAnLCBkZXB0aCkgKyAnJyArIHZhbHVlLnR5cGUsIDM1KSArICcgKCcgKyBycGFkKHZhbHVlLmlkLCAzNikgKyAnKSBwYXJlbnQ6ICcgKyBwYXJlbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2xvYWRpbmcnLCBjYWxsYmFjay5jYWxsKHRoaXMsIHZhbHVlLmlkLCB2YWx1ZSwgcGFyZW50LCBkZXB0aCkpO1xuICAgICAgICAgICAgaWYgKHZhbHVlLmNoaWxkcmVuICYmIHNpemUodmFsdWUuY2hpbGRyZW4pKSB7XG4gICAgICAgICAgICAgICAgZGVwdGgrKztcblxuICAgICAgICAgICAgICAgIGZvckVhY2godmFsdWUuY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkVmFsdWUvKiwgY2hpbGRLZXksIGFycmF5Ki8pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWN1cnNpdmVMb2FkKFtjaGlsZFZhbHVlXSwgY2FsbGJhY2ssIGRlcHRoLCB2YWx1ZS5pZCk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZ2V0KHZhbHVlLmlkKS5lbWl0KCdkb25lJywgdGhpcy5nZXQodmFsdWUuaWQpKTtcblxuICAgICAgICAgICAgZGVwdGgtLTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQnVpbGRlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIERyYWdFdmVudHMgPSByZXF1aXJlKCcuLi91aS9kcmFnLmV2ZW50cycpLFxuICAgIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEVtaXR0ZXIgICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgQm91bmQgICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9vcHRpb25zJyksXG4gICAgYmluZCAgICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIGlzU3RyaW5nICAgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNTdHJpbmcnKSxcbiAgICBuTWFwICAgICAgID0gcmVxdWlyZSgnbW91dC9tYXRoL21hcCcpLFxuICAgIGNsYW1wICAgICAgPSByZXF1aXJlKCdtb3V0L21hdGgvY2xhbXAnKSxcbiAgICBwcmVjaXNpb24gID0gcmVxdWlyZSgnbW91dC9udW1iZXIvZW5mb3JjZVByZWNpc2lvbicpLFxuICAgIGdldCAgICAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9nZXQnKSxcbiAgICAkICAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKTtcblxucmVxdWlyZSgnZWxlbWVudHMvZXZlbnRzJyk7XG5yZXF1aXJlKCdlbGVtZW50cy9kZWxlZ2F0aW9uJyk7XG5cbnZhciBSZXNpemVyID0gbmV3IHByaW1lKHtcbiAgICBtaXhpbjogW0JvdW5kLCBPcHRpb25zXSxcbiAgICBEUkFHX0VWRU5UUzogRHJhZ0V2ZW50cyxcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIG1pblNpemU6IDVcbiAgICB9LFxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSB0aGlzLm9wdGlvbnMuaGlzdG9yeSB8fCB7fTtcbiAgICAgICAgdGhpcy5idWlsZGVyID0gdGhpcy5vcHRpb25zLmJ1aWxkZXIgfHwge307XG4gICAgICAgIHRoaXMub3JpZ2luID0ge1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB0cmFuc2Zvcm06IG51bGwsXG4gICAgICAgICAgICBvZmZzZXQ6IHtcbiAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgZ2V0QmxvY2s6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldCh0aGlzLmJ1aWxkZXIubWFwLCBpc1N0cmluZyhlbGVtZW50KSA/IGVsZW1lbnQgOiAkKGVsZW1lbnQpLmRhdGEoJ2xtLWlkJykgfHwgJycpO1xuICAgIH0sXG5cbiAgICBnZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKGVsZW1lbnQsIHByb3ApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxvY2soZWxlbWVudCkuZ2V0QXR0cmlidXRlKHByb3ApO1xuICAgIH0sXG5cbiAgICBnZXRTaXplOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZSgkKGVsZW1lbnQpLCAnc2l6ZScpO1xuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQsIHNpYmxpbmdzLCBvZmZzZXQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUubWF0Y2goL150b3VjaC9pKSkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgIFxuICAgICAgICBpZiAoZWxlbWVudC5MTVRvb2x0aXApIHsgZWxlbWVudC5MTVRvb2x0aXAucmVtb3ZlKCk7IH1cbiAgICAgICAgaWYgKGV2ZW50LndoaWNoICYmIGV2ZW50LndoaWNoICE9PSAxKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgLy8gU3RvcHMgdGV4dCBzZWxlY3Rpb25cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICB0aGlzLnNpYmxpbmdzID0ge1xuICAgICAgICAgICAgb2NjdXBpZWQ6IDAsXG4gICAgICAgICAgICBlbGVtZW50czogc2libGluZ3MsXG4gICAgICAgICAgICBuZXh0OiB0aGlzLmVsZW1lbnQubmV4dFNpYmxpbmcoKSxcbiAgICAgICAgICAgIHByZXZzOiB0aGlzLmVsZW1lbnQucHJldmlvdXNTaWJsaW5ncygpLFxuICAgICAgICAgICAgc2l6ZUJlZm9yZTogMFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLnNpYmxpbmdzLmVsZW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHRoaXMuc2libGluZ3Mub2NjdXBpZWQgLT0gdGhpcy5nZXRTaXplKHRoaXMuc2libGluZ3MubmV4dCk7XG4gICAgICAgICAgICB0aGlzLnNpYmxpbmdzLmVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24oc2libGluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2libGluZ3Mub2NjdXBpZWQgKz0gdGhpcy5nZXRTaXplKHNpYmxpbmcpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zaWJsaW5ncy5wcmV2cykge1xuICAgICAgICAgICAgdGhpcy5zaWJsaW5ncy5wcmV2cy5mb3JFYWNoKGZ1bmN0aW9uKHNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNpYmxpbmdzLnNpemVCZWZvcmUgKz0gdGhpcy5nZXRTaXplKHNpYmxpbmcpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9yaWdpbiA9IHtcbiAgICAgICAgICAgIHNpemU6IHRoaXMuZ2V0U2l6ZSh0aGlzLmVsZW1lbnQpLFxuICAgICAgICAgICAgbWF4U2l6ZTogdGhpcy5nZXRTaXplKHRoaXMuZWxlbWVudCkgKyB0aGlzLmdldFNpemUodGhpcy5zaWJsaW5ncy5uZXh0KSxcbiAgICAgICAgICAgIHg6IGV2ZW50LmNoYW5nZWRUb3VjaGVzID8gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggOiBldmVudC5wYWdlWCArIDYsXG4gICAgICAgICAgICB5OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogZXZlbnQucGFnZVlcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY2xpZW50UmVjdCA9IHRoaXMuZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIHBhcmVudFJlY3QgPSB0aGlzLmVsZW1lbnQucGFyZW50KClbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgdGhpcy5vcmlnaW4ub2Zmc2V0ID0ge1xuICAgICAgICAgICAgY2xpZW50UmVjdDogY2xpZW50UmVjdCxcbiAgICAgICAgICAgIHBhcmVudFJlY3Q6IHtsZWZ0OiBwYXJlbnRSZWN0LmxlZnQsIHJpZ2h0OiBwYXJlbnRSZWN0LnJpZ2h0fSxcbiAgICAgICAgICAgIHg6IHRoaXMub3JpZ2luLnggLSBjbGllbnRSZWN0LnJpZ2h0LFxuICAgICAgICAgICAgeTogY2xpZW50UmVjdC50b3AgLSB0aGlzLm9yaWdpbi55LFxuICAgICAgICAgICAgZG93bjogb2Zmc2V0XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5vcmlnaW4ub2Zmc2V0LnBhcmVudFJlY3QubGVmdCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoKS5maW5kKCc+IFtkYXRhLWxtLWlkXTpmaXJzdC1jaGlsZCcpWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gICAgICAgIHRoaXMub3JpZ2luLm9mZnNldC5wYXJlbnRSZWN0LnJpZ2h0ID0gdGhpcy5lbGVtZW50LnBhcmVudCgpLmZpbmQoJz4gW2RhdGEtbG0taWRdOmxhc3QtY2hpbGQnKVswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5yaWdodDtcblxuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5NT1ZFLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5TVE9QLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oZXZlbnQsIHRoaXMuYm91bmQoJ3N0b3AnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcbiAgICB9LFxuXG4gICAgbW92ZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUubWF0Y2goL150b3VjaC9pKSkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgdmFyIGNsaWVudFggPSBldmVudC5jbGllbnRYIHx8IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCB8fCAwLFxuICAgICAgICAgICAgY2xpZW50WSA9IGV2ZW50LmNsaWVudFkgfHwgZXZlbnQudG91Y2hlc1swXS5jbGllbnRZIHx8IDAsXG4gICAgICAgICAgICBwYXJlbnRSZWN0ID0gdGhpcy5vcmlnaW4ub2Zmc2V0LnBhcmVudFJlY3Q7XG5cbiAgICAgICAgdmFyIGRlbHRhWCA9ICh0aGlzLmxhc3RYIHx8IGNsaWVudFgpIC0gY2xpZW50WCxcbiAgICAgICAgICAgIGRlbHRhWSA9ICh0aGlzLmxhc3RZIHx8IGNsaWVudFkpIC0gY2xpZW50WTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9XG4gICAgICAgICAgICBNYXRoLmFicyhkZWx0YVgpID4gTWF0aC5hYnMoZGVsdGFZKSAmJiBkZWx0YVggPiAwICYmICdsZWZ0JyB8fFxuICAgICAgICAgICAgTWF0aC5hYnMoZGVsdGFYKSA+IE1hdGguYWJzKGRlbHRhWSkgJiYgZGVsdGFYIDwgMCAmJiAncmlnaHQnIHx8XG4gICAgICAgICAgICBNYXRoLmFicyhkZWx0YVkpID4gTWF0aC5hYnMoZGVsdGFYKSAmJiBkZWx0YVkgPiAwICYmICd1cCcgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rvd24nO1xuICAgICAgICB2YXIgc2l6ZSxcbiAgICAgICAgICAgIGRpZmYgPSAxMDAgLSB0aGlzLnNpYmxpbmdzLm9jY3VwaWVkLFxuICAgICAgICAgICAgdmFsdWUgPSBjbGllbnRYICsgKCF0aGlzLnNpYmxpbmdzLnByZXZzID8gdGhpcy5vcmlnaW4ub2Zmc2V0LnggLSB0aGlzLm9yaWdpbi5vZmZzZXQuZG93biA6IHRoaXMuc2libGluZ3MucHJldnMubGVuZ3RoKSxcbiAgICAgICAgICAgIG5vcm1hbGl6ZWQgPSBjbGFtcCh2YWx1ZSwgcGFyZW50UmVjdC5sZWZ0LCBwYXJlbnRSZWN0LnJpZ2h0KTtcblxuICAgICAgICBzaXplID0gbk1hcChub3JtYWxpemVkLCBwYXJlbnRSZWN0LmxlZnQsIHBhcmVudFJlY3QucmlnaHQsIDAsIDEwMCk7XG4gICAgICAgIHNpemUgPSBzaXplIC0gdGhpcy5zaWJsaW5ncy5zaXplQmVmb3JlO1xuICAgICAgICBzaXplID0gcHJlY2lzaW9uKGNsYW1wKHNpemUsIHRoaXMub3B0aW9ucy5taW5TaXplLCB0aGlzLm9yaWdpbi5tYXhTaXplIC0gdGhpcy5vcHRpb25zLm1pblNpemUpLCAwKTtcblxuICAgICAgICAvL2dyaWRzP1xuICAgICAgICAvL2NvbnNvbGUubG9nKChzaXplIC8gMTIpICogKDEwMCAvIDEyKSk7XG5cbiAgICAgICAgZGlmZiA9IHByZWNpc2lvbihkaWZmIC0gc2l6ZSwgMCk7XG5cbiAgICAgICAgdGhpcy5nZXRCbG9jayh0aGlzLmVsZW1lbnQpLnNldFNpemUoc2l6ZSwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuZ2V0QmxvY2sodGhpcy5zaWJsaW5ncy5uZXh0KS5zZXRTaXplKGRpZmYsIHRydWUpO1xuXG4gICAgICAgIC8vIEhhY2sgdG8gaGFuZGxlIGNhc2VzIHdoZXJlIHNpemUgaXMgbm90IGFuIGludGVnZXJcbiAgICAgICAgdmFyIHNpYmxpbmdzID0gdGhpcy5lbGVtZW50LnNpYmxpbmdzKCksXG4gICAgICAgICAgICBhbW91bnQgPSBzaWJsaW5ncyA/IHNpYmxpbmdzLmxlbmd0aCArIDEgOiAxO1xuICAgICAgICBpZiAoYW1vdW50ID09IDMgfHwgYW1vdW50ID09IDYgfHwgYW1vdW50ID09IDcgfHwgYW1vdW50ID09IDggfHwgYW1vdW50ID09IDkgfHwgYW1vdW50ID09IDExIHx8IGFtb3VudCA9PSAxMikge1xuICAgICAgICAgICAgdmFyIHRvdGFsID0gMCwgYmxvY2tzO1xuXG4gICAgICAgICAgICBibG9ja3MgPSAkKFtzaWJsaW5ncywgdGhpcy5lbGVtZW50XSk7XG4gICAgICAgICAgICBibG9ja3MuZm9yRWFjaChmdW5jdGlvbihibG9jaywgaW5kZXgpe1xuICAgICAgICAgICAgICAgIGJsb2NrID0gdGhpcy5nZXRCbG9jayhibG9jayk7XG4gICAgICAgICAgICAgICAgc2l6ZSA9IGJsb2NrLmdldFNpemUoKTtcbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSAlIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IHByZWNpc2lvbigxMDAgLyBhbW91bnQsIDApO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5zZXRTaXplKHNpemUsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRvdGFsICs9IHNpemU7XG5cbiAgICAgICAgICAgICAgICBpZiAoYmxvY2tzLmxlbmd0aCA9PSBpbmRleCArIDEgJiYgdG90YWwgIT0gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpZmYgPSAxMDAgLSB0b3RhbDtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suc2V0U2l6ZShzaXplICsgZGlmZiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubGFzdFggPSBjbGllbnRYO1xuICAgICAgICB0aGlzLmxhc3RZID0gY2xpZW50WTtcbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnR5cGUubWF0Y2goL150b3VjaC9pKSkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihldmVudCwgdGhpcy5ib3VuZCgnbW92ZScpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBpZiAodGhpcy5vcmlnaW4uc2l6ZSAhPT0gdGhpcy5nZXRTaXplKHRoaXMuZWxlbWVudCkpIHsgdGhpcy5oaXN0b3J5LnB1c2godGhpcy5idWlsZGVyLnNlcmlhbGl6ZSgpKTsgfVxuICAgIH0sXG5cbiAgICBldmVuUmVzaXplOiBmdW5jdGlvbihlbGVtZW50cywgYW5pbWF0ZWQpIHtcbiAgICAgICAgdmFyIHRvdGFsID0gZWxlbWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgc2l6ZSA9IHByZWNpc2lvbigxMDAgLyB0b3RhbCwgNCksXG4gICAgICAgICAgICBibG9jaztcblxuICAgICAgICBpZiAodHlwZW9mIGFuaW1hdGVkID09PSAndW5kZWZpbmVkJykgeyBhbmltYXRlZCA9IHRydWU7IH1cblxuICAgICAgICBlbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgYmxvY2sgPSB0aGlzLmdldEJsb2NrKGVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKGJsb2NrICYmIGJsb2NrLmhhc0F0dHJpYnV0ZSgnc2l6ZScpKSB7XG4gICAgICAgICAgICAgICAgYmxvY2tbYW5pbWF0ZWQgPyAnc2V0QW5pbWF0ZWRTaXplJyA6ICdzZXRTaXplJ10oc2l6ZSwgc2l6ZSAhPT0gYmxvY2suZ2V0U2l6ZSgpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHsgZWxlbWVudFthbmltYXRlZCA/ICdhbmltYXRlJyA6ICdzdHlsZSddKHsgZmxleDogJzAgMSAnICsgc2l6ZSArICclJyB9KTsgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXNpemVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcHJpbWUgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICAkICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9lbGVtZW50cy51dGlscycpLFxuICAgIEVtaXR0ZXIgICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9vcHRpb25zJyk7XG5cblxudmFyIEVyYXNlciA9IG5ldyBwcmltZSh7XG4gICAgbWl4aW46IFtPcHRpb25zLCBCb3VuZF0sXG5cbiAgICBpbmhlcml0czogRW1pdHRlcixcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKXtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmVsZW1lbnQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHRoaXMuaGlkZSh0cnVlKTtcbiAgICB9LFxuXG4gICAgc2hvdzogZnVuY3Rpb24oZmFzdCl7XG4gICAgICAgIHRoaXMub3V0KCk7XG4gICAgICAgIHRoaXMuZWxlbWVudFtmYXN0ID8gJ3N0eWxlJyA6ICdhbmltYXRlJ10oe3RvcDogMH0sIHtkdXJhdGlvbjogJzE1MG1zJ30pO1xuICAgIH0sXG5cbiAgICBoaWRlOiBmdW5jdGlvbihmYXN0KXtcbiAgICAgICAgdmFyIHRvcCA9IHt0b3A6IC0odGhpcy5lbGVtZW50WzBdLm9mZnNldEhlaWdodCl9O1xuICAgICAgICB0aGlzLm91dCgpO1xuICAgICAgICB0aGlzLmVsZW1lbnRbZmFzdCA/ICdzdHlsZScgOiAnYW5pbWF0ZSddKHRvcCwge2R1cmF0aW9uOiAnMTUwbXMnfSk7XG4gICAgfSxcblxuICAgIG92ZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuZWxlbWVudC5maW5kKCcudHJhc2gtem9uZScpLmFuaW1hdGUoe3RyYW5zZm9ybTogJ3NjYWxlKDEuMiknfSwge2R1cmF0aW9uOiAnMTUwbXMnLCBlcXVhdGlvbjogJ2N1YmljLWJlemllcigwLjUsMCwwLjUsMSknfSk7XG4gICAgfSxcblxuICAgIG91dDogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoJy50cmFzaC16b25lJykuYW5pbWF0ZSh7dHJhbnNmb3JtOiAnc2NhbGUoMSknfSwge2R1cmF0aW9uOiAnMTUwbXMnLCBlcXVhdGlvbjogJ2N1YmljLWJlemllcigwLjUsMCwwLjUsMSknfSk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gRXJhc2VyO1xuIiwidmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEVtaXR0ZXIgICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgc2xpY2UgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvc2xpY2UnKSxcbiAgICBtZXJnZSAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvbWVyZ2UnKSxcbiAgICBkZWVwRXF1YWxzID0gcmVxdWlyZSgnbW91dC9sYW5nL2RlZXBFcXVhbHMnKTtcblxudmFyIEhpc3RvcnkgPSBuZXcgcHJpbWUoe1xuXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oc2Vzc2lvbikge1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICAgICAgc2Vzc2lvbiA9IG1lcmdlKHt9LCBzZXNzaW9uKTtcbiAgICAgICAgdGhpcy5zZXRTZXNzaW9uKHNlc3Npb24pO1xuICAgIH0sXG5cbiAgICB1bmRvOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLmluZGV4KSByZXR1cm47XG4gICAgICAgIHRoaXMuaW5kZXgtLTtcblxuICAgICAgICB2YXIgc2Vzc2lvbiA9IHRoaXMuZ2V0KCk7XG4gICAgICAgIHRoaXMuZW1pdCgndW5kbycsIHNlc3Npb24sIHRoaXMuaW5kZXgpO1xuICAgICAgICByZXR1cm4gc2Vzc2lvbjtcbiAgICB9LFxuXG4gICAgcmVkbzogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmluZGV4ID09IHRoaXMuc2Vzc2lvbi5sZW5ndGggLSAxKSByZXR1cm47XG4gICAgICAgIHRoaXMuaW5kZXgrKztcblxuICAgICAgICB2YXIgc2Vzc2lvbiA9IHRoaXMuZ2V0KCk7XG4gICAgICAgIHRoaXMuZW1pdCgncmVkbycsIHNlc3Npb24sIHRoaXMuaW5kZXgpO1xuICAgICAgICByZXR1cm4gc2Vzc2lvbjtcbiAgICB9LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcblxuICAgICAgICB2YXIgc2Vzc2lvbiA9IHRoaXMuZ2V0KCk7XG4gICAgICAgIHRoaXMuZW1pdCgncmVzZXQnLCBzZXNzaW9uLCB0aGlzLmluZGV4KTtcbiAgICAgICAgcmV0dXJuIHNlc3Npb247XG4gICAgfSxcblxuICAgIHB1c2g6IGZ1bmN0aW9uKHNlc3Npb24pIHtcbiAgICAgICAgc2Vzc2lvbiA9IG1lcmdlKHt9LCBzZXNzaW9uKTtcbiAgICAgICAgdmFyIHNsaWNlZCA9IHRoaXMuaW5kZXggPCB0aGlzLnNlc3Npb24ubGVuZ3RoIC0gMTtcbiAgICAgICAgaWYgKHRoaXMuaW5kZXggPCB0aGlzLnNlc3Npb24ubGVuZ3RoIC0gMSkgdGhpcy5zZXNzaW9uID0gc2xpY2UodGhpcy5zZXNzaW9uLCAwLCAtKHRoaXMuc2Vzc2lvbi5sZW5ndGggLSAxIC0gdGhpcy5pbmRleCkpO1xuICAgICAgICBzZXNzaW9uID0ge1xuICAgICAgICAgICAgdGltZTogKyhuZXcgRGF0ZSgpKSxcbiAgICAgICAgICAgIGRhdGE6IHNlc3Npb25cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodGhpcy5lcXVhbHMoc2Vzc2lvbi5kYXRhKSkgeyByZXR1cm4gc2Vzc2lvbjsgfVxuXG4gICAgICAgIHRoaXMuc2Vzc2lvbi5wdXNoKHNlc3Npb24pO1xuICAgICAgICB0aGlzLmluZGV4ID0gdGhpcy5zZXNzaW9uLmxlbmd0aCAtIDE7XG5cbiAgICAgICAgdGhpcy5lbWl0KCdwdXNoJywgc2Vzc2lvbiwgdGhpcy5pbmRleCwgc2xpY2VkKTtcbiAgICAgICAgcmV0dXJuIHNlc3Npb247XG4gICAgfSxcblxuICAgIGdldDogZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbltpbmRleCB8fCB0aGlzLmluZGV4XSB8fCBmYWxzZTtcbiAgICB9LFxuXG4gICAgZXF1YWxzOiBmdW5jdGlvbihzZXNzaW9uLCBjb21wYXJlKSB7XG4gICAgICAgIGlmICghY29tcGFyZSkgeyBjb21wYXJlID0gdGhpcy5nZXQoKS5kYXRhOyB9XG5cbiAgICAgICAgcmV0dXJuIGRlZXBFcXVhbHMoc2Vzc2lvbiwgY29tcGFyZSk7XG4gICAgfSxcblxuICAgIHNldFNlc3Npb246IGZ1bmN0aW9uKHNlc3Npb24pIHtcbiAgICAgICAgc2Vzc2lvbiA9ICFzZXNzaW9uID8gW11cbiAgICAgICAgICAgIDogW3tcbiAgICAgICAgICAgIHRpbWU6ICsobmV3IERhdGUoKSksXG4gICAgICAgICAgICBkYXRhOiBtZXJnZSh7fSwgc2Vzc2lvbilcbiAgICAgICAgfV07XG5cbiAgICAgICAgdGhpcy5zZXNzaW9uID0gc2Vzc2lvbjtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb247XG4gICAgfSxcblxuICAgIGltcG9ydDogZnVuY3Rpb24oKSB7fSxcbiAgICBleHBvcnQ6IGZ1bmN0aW9uKCkge31cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEhpc3Rvcnk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciByZWFkeSAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICAvL2pzb24gICAgICAgICAgPSByZXF1aXJlKCcuL2pzb25fdGVzdCcpLCAvLyBkZWJ1Z1xuICAgICQgICAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9hdHRyaWJ1dGVzJyksXG4gICAgbW9kYWwgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykubW9kYWwsXG4gICAgdG9hc3RyICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykudG9hc3RyLFxuICAgIHJlcXVlc3QgICAgICAgPSByZXF1aXJlKCdhZ2VudCcpLFxuICAgIHplbiAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBjb250YWlucyAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9jb250YWlucycpLFxuICAgIHNpemUgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L2NvbGxlY3Rpb24vc2l6ZScpLFxuICAgIHRyaW0gICAgICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG4gICAgZm9yRWFjaCAgICAgICA9IHJlcXVpcmUoJ21vdXQvY29sbGVjdGlvbi9mb3JFYWNoJyksXG5cbiAgICBnZXRBamF4U3VmZml4ID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtc3VmZml4JyksXG5cbiAgICBCdWlsZGVyICAgICAgID0gcmVxdWlyZSgnLi9idWlsZGVyJyksXG4gICAgSGlzdG9yeSAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2hpc3RvcnknKSxcbiAgICBMTUhpc3RvcnkgICAgID0gcmVxdWlyZSgnLi9oaXN0b3J5JyksXG4gICAgTGF5b3V0TWFuYWdlciA9IHJlcXVpcmUoJy4vbGF5b3V0bWFuYWdlcicpLFxuICAgIFNhdmVTdGF0ZSAgICAgPSByZXF1aXJlKCcuLi91dGlscy9zYXZlLXN0YXRlJyk7XG5cbnJlcXVpcmUoJy4uL3VpL3BvcG92ZXInKTtcblxudmFyIGJ1aWxkZXIsIGxheW91dG1hbmFnZXIsIGxtaGlzdG9yeSwgc2F2ZXN0YXRlO1xuXG5cbmJ1aWxkZXIgPSBuZXcgQnVpbGRlcigpO1xubG1oaXN0b3J5ID0gbmV3IExNSGlzdG9yeSgpO1xuc2F2ZXN0YXRlID0gbmV3IFNhdmVTdGF0ZSgpO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWxtLWJhY2tdJywgZnVuY3Rpb24oZSwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZSkgeyBlLnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgaWYgKCQoZWxlbWVudCkuaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIHJldHVybiBmYWxzZTtcbiAgICAgICAgbG1oaXN0b3J5LnVuZG8oKTtcbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWxtLWZvcndhcmRdJywgZnVuY3Rpb24oZSwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZSkgeyBlLnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgaWYgKCQoZWxlbWVudCkuaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIHJldHVybiBmYWxzZTtcbiAgICAgICAgbG1oaXN0b3J5LnJlZG8oKTtcbiAgICB9KTtcblxuICAgIC8qIGxtaGlzdG9yeSBldmVudHMgKi9cbiAgICBsbWhpc3Rvcnkub24oJ3B1c2gnLCBmdW5jdGlvbihzZXNzaW9uLCBpbmRleCwgcmVzZXQpIHtcbiAgICAgICAgdmFyIEhNID0ge1xuICAgICAgICAgICAgYmFjazogJCgnW2RhdGEtbG0tYmFja10nKSxcbiAgICAgICAgICAgIGZvcndhcmQ6ICQoJ1tkYXRhLWxtLWZvcndhcmRdJylcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoaW5kZXggJiYgSE0uYmFjay5oYXNDbGFzcygnZGlzYWJsZWQnKSkgSE0uYmFjay5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgaWYgKHJlc2V0ICYmICFITS5mb3J3YXJkLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSBITS5mb3J3YXJkLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICBsYXlvdXRtYW5hZ2VyLnVwZGF0ZVBlbmRpbmdDaGFuZ2VzKCk7XG4gICAgfSk7XG5cbiAgICBsbWhpc3Rvcnkub24oJ3VuZG8nLCBmdW5jdGlvbihzZXNzaW9uLCBpbmRleCkge1xuICAgICAgICB2YXIgbm90aWNlID0gJCgnI2xtLW5vLWxheW91dCcpLFxuICAgICAgICAgICAgSE0gICAgID0ge1xuICAgICAgICAgICAgICAgIGJhY2s6ICQoJ1tkYXRhLWxtLWJhY2tdJyksXG4gICAgICAgICAgICAgICAgZm9yd2FyZDogJCgnW2RhdGEtbG0tZm9yd2FyZF0nKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICBpZiAobm90aWNlKSB7IG5vdGljZS5zdHlsZSh7IGRpc3BsYXk6ICFzaXplKHNlc3Npb24uZGF0YSkgPyAnYmxvY2snIDogJ25vbmUnIH0pOyB9XG5cbiAgICAgICAgYnVpbGRlci5yZXNldChzZXNzaW9uLmRhdGEpO1xuICAgICAgICBITS5mb3J3YXJkLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICBpZiAoIWluZGV4KSBITS5iYWNrLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICBsYXlvdXRtYW5hZ2VyLnNpbmdsZXMoJ2Rpc2FibGUnKTtcbiAgICAgICAgbGF5b3V0bWFuYWdlci51cGRhdGVQZW5kaW5nQ2hhbmdlcygpO1xuICAgIH0pO1xuICAgIGxtaGlzdG9yeS5vbigncmVkbycsIGZ1bmN0aW9uKHNlc3Npb24sIGluZGV4KSB7XG4gICAgICAgIHZhciBub3RpY2UgPSAkKCcjbG0tbm8tbGF5b3V0JyksXG4gICAgICAgICAgICBITSAgICAgPSB7XG4gICAgICAgICAgICAgICAgYmFjazogJCgnW2RhdGEtbG0tYmFja10nKSxcbiAgICAgICAgICAgICAgICBmb3J3YXJkOiAkKCdbZGF0YS1sbS1mb3J3YXJkXScpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGlmIChub3RpY2UpIHsgbm90aWNlLnN0eWxlKHsgZGlzcGxheTogIXNpemUoc2Vzc2lvbi5kYXRhKSA/ICdibG9jaycgOiAnbm9uZScgfSk7IH1cblxuICAgICAgICBidWlsZGVyLnJlc2V0KHNlc3Npb24uZGF0YSk7XG4gICAgICAgIEhNLmJhY2sucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIGlmIChpbmRleCA9PSB0aGlzLnNlc3Npb24ubGVuZ3RoIC0gMSkgSE0uZm9yd2FyZC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgbGF5b3V0bWFuYWdlci5zaW5nbGVzKCdkaXNhYmxlJyk7XG4gICAgICAgIGxheW91dG1hbmFnZXIudXBkYXRlUGVuZGluZ0NoYW5nZXMoKTtcbiAgICB9KTtcblxufSk7XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBib2R5ID0gJCgnYm9keScpLCByb290ID0gJCgnW2RhdGEtbG0tcm9vdF0nKSwgZGF0YTtcblxuICAgIC8vIExheW91dCBNYW5hZ2VyXG4gICAgbGF5b3V0bWFuYWdlciA9IG5ldyBMYXlvdXRNYW5hZ2VyKCdib2R5Jywge1xuICAgICAgICBkZWxlZ2F0ZTogJ1tkYXRhLWxtLXJvb3RdIC5nLWdyaWQgPiAuZy1ibG9jayA+IFtkYXRhLWxtLWJsb2NrdHlwZV06bm90KFtkYXRhLWxtLW5vZHJhZ10pICE+IC5nLWJsb2NrLCAuZzUtbG0tcGFydGljbGVzLXBpY2tlciBbZGF0YS1sbS1ibG9ja3R5cGVdLCBbZGF0YS1sbS1yb290XSBbZGF0YS1sbS1ibG9ja3R5cGU9XCJzZWN0aW9uXCJdID4gW2RhdGEtbG0tYmxvY2t0eXBlPVwiZ3JpZFwiXTpub3QoOmVtcHR5KTpub3QoLm5vLW1vdmUpOm5vdChbZGF0YS1sbS1ub2RyYWddKSwgW2RhdGEtbG0tcm9vdF0gW2RhdGEtbG0tYmxvY2t0eXBlPVwic2VjdGlvblwiXSA+IFtkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXSA+IFtkYXRhLWxtLWJsb2NrdHlwZT1cImdyaWRcIl06bm90KDplbXB0eSk6bm90KC5uby1tb3ZlKTpub3QoW2RhdGEtbG0tbm9kcmFnXSknLFxuICAgICAgICBkcm9wcGFibGVzOiAnW2RhdGEtbG0tZHJvcHpvbmVdJyxcbiAgICAgICAgZXhjbHVkZTogJy5zZWN0aW9uLWhlYWRlciAuYnV0dG9uLCAubG0tbmV3YmxvY2tzIC5mbG9hdC1yaWdodCAuYnV0dG9uLCBbZGF0YS1sbS1ub2RyYWddJyxcbiAgICAgICAgcmVzaXplX2hhbmRsZXM6ICdbZGF0YS1sbS1yb290XSAuZy1ncmlkID4gLmctYmxvY2s6bm90KDpsYXN0LWNoaWxkKScsXG4gICAgICAgIGJ1aWxkZXI6IGJ1aWxkZXIsXG4gICAgICAgIGhpc3Rvcnk6IGxtaGlzdG9yeSxcbiAgICAgICAgc2F2ZXN0YXRlOiBzYXZlc3RhdGVcbiAgICB9KTtcblxuICAgIG1vZHVsZS5leHBvcnRzLmxheW91dG1hbmFnZXIgPSBsYXlvdXRtYW5hZ2VyO1xuXG4gICAgLy8gbG9hZCBidWlsZGVyIGRhdGFcbiAgICBpZiAocm9vdCkge1xuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyb290LmRhdGEoJ2xtLXJvb3QnKSk7XG4gICAgICAgIGlmIChkYXRhLm5hbWUpIHsgZGF0YSA9IGRhdGEubGF5b3V0OyB9XG4gICAgICAgIGJ1aWxkZXIuc2V0U3RydWN0dXJlKGRhdGEpO1xuICAgICAgICBidWlsZGVyLmxvYWQoKTtcblxuICAgICAgICBsYXlvdXRtYW5hZ2VyLmhpc3Rvcnkuc2V0U2Vzc2lvbihidWlsZGVyLnNlcmlhbGl6ZSgpKTtcbiAgICAgICAgbGF5b3V0bWFuYWdlci5zYXZlc3RhdGUuc2V0U2Vzc2lvbihidWlsZGVyLnNlcmlhbGl6ZShudWxsLCB0cnVlKSk7XG4gICAgfVxuXG4gICAgLy8gYXR0YWNoIGV2ZW50c1xuICAgIC8vIE1vZGFsIFRhYnNcbiAgICBib2R5LmRlbGVnYXRlKCdtb3VzZWRvd24nLCAnLmctdGFicyBhJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdmFyIGluZGV4ICA9IDAsXG4gICAgICAgICAgICBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgnLmctdGFicycpLFxuICAgICAgICAgICAgcGFuZXMgID0gcGFyZW50LnNpYmxpbmdzKCcuZy1wYW5lcycpLFxuICAgICAgICAgICAgbGlua3MgID0gcGFyZW50LnNlYXJjaCgnYScpO1xuXG4gICAgICAgIGxpbmtzLmZvckVhY2goZnVuY3Rpb24obGluaywgaSkge1xuICAgICAgICAgICAgaWYgKGxpbmsgPT0gZWxlbWVudFswXSkgeyBpbmRleCA9IGkgKyAxOyB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHBhbmVzLmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIHBhcmVudC5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICBwYW5lcy5maW5kKCcuZy1wYW5lOm50aC1jaGlsZCgnICsgaW5kZXggKyAnKScpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgcGFyZW50LmZpbmQoJ2xpOm50aC1jaGlsZCgnICsgaW5kZXggKyAnKScpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICB9KTtcblxuICAgIC8vIFBpY2tlclxuICAgIGJvZHkuZGVsZWdhdGUoJ3N0YXRlY2hhbmdlQmVmb3JlJywgJ1tkYXRhLWc1LWxtLXBpY2tlcl0nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIC8vIFN1Yi1uYXZpZ2F0aW9uIGxpbmtzXG4gICAgYm9keS5kZWxlZ2F0ZSgnc3RhdGVjaGFuZ2VBZnRlcicsICcjbmF2YmFyIFtkYXRhLWc1LWFqYXhpZnldJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgcm9vdCA9ICQoJ1tkYXRhLWxtLXJvb3RdJyk7XG4gICAgICAgIGlmICghcm9vdCkgeyByZXR1cm4gdHJ1ZTsgfVxuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyb290LmRhdGEoJ2xtLXJvb3QnKSk7XG4gICAgICAgIGJ1aWxkZXIuc2V0U3RydWN0dXJlKGRhdGEpO1xuICAgICAgICBidWlsZGVyLmxvYWQoKTtcblxuICAgICAgICBsYXlvdXRtYW5hZ2VyLmhpc3Rvcnkuc2V0U2Vzc2lvbihidWlsZGVyLnNlcmlhbGl6ZSgpKTtcbiAgICAgICAgbGF5b3V0bWFuYWdlci5zYXZlc3RhdGUuc2V0U2Vzc2lvbihidWlsZGVyLnNlcmlhbGl6ZShudWxsLCB0cnVlKSk7XG5cbiAgICAgICAgLy8gcmVmcmVzaCBMTSBlcmFzZXJcbiAgICAgICAgbGF5b3V0bWFuYWdlci5lcmFzZXIuZWxlbWVudCA9ICQoJ1tkYXRhLWxtLWVyYXNlYmxvY2tdJyk7XG4gICAgICAgIGxheW91dG1hbmFnZXIuZXJhc2VyLmhpZGUoKTtcbiAgICB9KTtcblxuICAgIC8vIFBhcnRpY2xlcyBmaWx0ZXJpbmdcbiAgICBib2R5LmRlbGVnYXRlKCdpbnB1dCcsICcuc2lkZWJhci1ibG9jayAuc2VhcmNoIGlucHV0JywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gJChlbGVtZW50KS52YWx1ZSgpLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBsaXN0ICA9ICQoJy5zaWRlYmFyLWJsb2NrIFtkYXRhLWxtLWJsb2NrdHlwZV0nKSxcbiAgICAgICAgICAgIHRleHQsIHR5cGU7XG4gICAgICAgIGlmICghbGlzdCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICBsaXN0LnN0eWxlKHsgZGlzcGxheTogJ25vbmUnIH0pLmZvckVhY2goZnVuY3Rpb24oYmxvY2t0eXBlKSB7XG4gICAgICAgICAgICBibG9ja3R5cGUgPSAkKGJsb2NrdHlwZSk7XG4gICAgICAgICAgICB0eXBlID0gYmxvY2t0eXBlLmRhdGEoJ2xtLWJsb2NrdHlwZScpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB0ZXh0ID0gdHJpbShibG9ja3R5cGUudGV4dCgpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgaWYgKHR5cGUuc3Vic3RyKDAsIHZhbHVlLmxlbmd0aCkgPT0gdmFsdWUgfHwgdGV4dC5tYXRjaCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBibG9ja3R5cGUuc3R5bGUoeyBkaXNwbGF5OiAnYmxvY2snIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9KTtcblxuICAgIC8vIFRPRE86IHRoaXMgd2FzIHRoZSArIGhhbmRsZXIgZm9yIG5ldyBsYXlvdXRzIHdoaWNoIGlzIG5vdyBnb25lIGluIGZhdm9yIG9mIENvbmZpZ3VyYXRpb25zXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZzUtbG0tYWRkXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcnLFxuICAgICAgICAgICAgcmVtb3RlOiAkKGVsZW1lbnQpLmF0dHJpYnV0ZSgnaHJlZicpICsgZ2V0QWpheFN1ZmZpeCgpXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gR3JpZCBzYW1lIHdpZHRocyBidXR0b24gKGV2ZW5pemUsIGVxdWFsaXplKVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWxtLXNhbWV3aWR0aF06bm90KDplbXB0eSknLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5MTVRvb2x0aXApIHsgZWxlbWVudC5MTVRvb2x0aXAucmVtb3ZlKCk7IH1cbiAgICAgICAgdmFyIGNsaWVudFJlY3QgPSBlbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBpZiAoZXZlbnQuY2xpZW50WCA8IGNsaWVudFJlY3Qud2lkdGggKyBjbGllbnRSZWN0LmxlZnQpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdmFyIGJsb2NrcyA9IGVsZW1lbnQuc2VhcmNoKCc+IFtkYXRhLWxtLWJsb2NrdHlwZT1cImJsb2NrXCJdJyksIGlkO1xuICAgICAgICBpZiAoIWJsb2NrcyB8fCBibG9ja3MubGVuZ3RoID09IDEpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgYmxvY2tzLmZvckVhY2goZnVuY3Rpb24oYmxvY2spIHtcbiAgICAgICAgICAgIGlkID0gJChibG9jaykuZGF0YSgnbG0taWQnKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuZ2V0KGlkKS5zZXRTaXplKDEwMCAvIGJsb2Nrcy5sZW5ndGgsIHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsbWhpc3RvcnkucHVzaChidWlsZGVyLnNlcmlhbGl6ZSgpKTtcbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlb3ZlcicsICdbZGF0YS1sbS1zYW1ld2lkdGhdOm5vdCg6ZW1wdHkpJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGNsaWVudFJlY3QgPSBlbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgY2xpZW50WCA9IGV2ZW50LmNsaWVudFggfHwgKGV2ZW50LnRvdWNoZXMgJiYgZXZlbnQudG91Y2hlc1swXS5jbGllbnRYKSB8fCAwLFxuICAgICAgICAgICAgdG9vbHRpcHMgPSB7XG4gICAgICAgICAgICAgICAgZXF1YWxpemU6IGNsaWVudFggKyA1ID4gY2xpZW50UmVjdC53aWR0aCArIGNsaWVudFJlY3QubGVmdCxcbiAgICAgICAgICAgICAgICBtb3ZlOiBjbGllbnRYIC0gNSA8IGNsaWVudFJlY3QubGVmdFxuICAgICAgICAgICAgfTtcblxuICAgICAgICBpZiAoIXRvb2x0aXBzLmVxdWFsaXplICYmICF0b29sdGlwcy5tb3ZlKSB7IHJldHVybjsgfVxuXG4gICAgICAgIHZhciBtc2cgPSB0b29sdGlwcy5lcXVhbGl6ZSA/ICdFcXVhbGl6ZSB0aGUgd2lkdGggdGhlIGJsb2NrcyBpbiB0aGlzIGdyaWQnIDogJ1NvcnQgb3IgTW92ZSB0aGUgR3JpZCcsXG4gICAgICAgICAgICB0b29sdGlwID0gemVuKCdzcGFuLmctdG9vbHRpcC5nLXRvb2x0aXAtZm9yY2VbZGF0YS10aXRsZT1cIicgKyBtc2cgKyAnXCJdJykudG9wKGVsZW1lbnQpO1xuXG4gICAgICAgIGlmICh0b29sdGlwcy5lcXVhbGl6ZSkgeyB0b29sdGlwLmFkZENsYXNzKCdnLXRvb2x0aXAtcmlnaHQnKTsgfVxuICAgICAgICB0b29sdGlwLnN0eWxlKHtwb3NpdGlvbjogJ2Fic29sdXRlJywgdG9wOiAyNiB9KS5zdHlsZSh0b29sdGlwcy5lcXVhbGl6ZSA/ICdyaWdodCcgOiAnbGVmdCcsIC0zMCk7XG5cbiAgICAgICAgZWxlbWVudC5MTVRvb2x0aXAgPSB0b29sdGlwO1xuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgnbW91c2VvdXQnLCAnW2RhdGEtbG0tc2FtZXdpZHRoXTpub3QoOmVtcHR5KScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChlbGVtZW50LkxNVG9vbHRpcCkgeyBlbGVtZW50LkxNVG9vbHRpcC5yZW1vdmUoKTsgfVxuICAgIH0pO1xuXG4gICAgLy8gQ2xlYXIgTGF5b3V0XG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtbG0tY2xlYXJdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICB2YXIgdHlwZSwgY2hpbGQ7XG4gICAgICAgIGZvckVhY2goYnVpbGRlci5tYXAsIGZ1bmN0aW9uKG9iaiwgaWQpIHtcbiAgICAgICAgICAgIHR5cGUgPSBvYmouZ2V0VHlwZSgpO1xuICAgICAgICAgICAgY2hpbGQgPSBvYmouYmxvY2suZmluZCgnPiBbZGF0YS1sbS1pZF0nKTtcbiAgICAgICAgICAgIGlmIChjaGlsZCkgeyBjaGlsZCA9IGNoaWxkLmRhdGEoJ2xtLWJsb2NrdHlwZScpOyB9XG4gICAgICAgICAgICBpZiAoY29udGFpbnMoWydwYXJ0aWNsZScsICdncmlkJywgJ2Jsb2NrJ10sIHR5cGUpICYmICh0eXBlID09ICdibG9jaycgJiYgKGNoaWxkICYmIChjaGlsZCAhPT0gJ3NlY3Rpb24nICYmIGNoaWxkICE9PSAnY29udGFpbmVyJykpKSkge1xuICAgICAgICAgICAgICAgIGJ1aWxkZXIucmVtb3ZlKGlkKTtcbiAgICAgICAgICAgICAgICBvYmouYmxvY2sucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIGxheW91dG1hbmFnZXIuc2luZ2xlcygnY2xlYW51cCcsIGJ1aWxkZXIpO1xuXG4gICAgICAgIGxtaGlzdG9yeS5wdXNoKGJ1aWxkZXIuc2VyaWFsaXplKCkpO1xuICAgIH0pO1xuXG4gICAgLy8gU3dpdGNoZXJcbiAgICBib2R5LmRlbGVnYXRlKCdtb3VzZW92ZXInLCAnW2RhdGEtbG0tc3dpdGNoZXJdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICBpZiAoIWVsZW1lbnQuUG9wb3ZlckRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBwb3BvdmVyID0gZWxlbWVudC5nZXRQb3BvdmVyKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnYXN5bmMnLFxuICAgICAgICAgICAgICAgIHVybDogZWxlbWVudC5kYXRhKCdsbS1zd2l0Y2hlcicpICsgZ2V0QWpheFN1ZmZpeCgpLFxuICAgICAgICAgICAgICAgIGFsbG93RWxlbWVudHNDbGljazogJy5nLXRhYnMgYSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBDbGVhciBMYXlvdXRcbiAgICBib2R5LmRlbGVnYXRlKCdtb3VzZWRvd24nLCAnW2RhdGEtc3dpdGNoXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgLy8gaXQncyBhbHJlYWR5IGxvYWRpbmcgc29tZXRoaW5nLlxuICAgICAgICBpZiAoZWxlbWVudC5wYXJlbnQoJy5nNS1wb3BvdmVyLWNvbnRlbnQnKS5maW5kKCdbZGF0YS1zd2l0Y2hdIGknKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC5zaG93SW5kaWNhdG9yKCk7XG5cbiAgICAgICAgcmVxdWVzdCgnZ2V0JywgZWxlbWVudC5kYXRhKCdzd2l0Y2gnKSArIGdldEFqYXhTdWZmaXgoKSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBlbGVtZW50LmhpZGVJbmRpY2F0b3IoKTtcblxuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogcmVzcG9uc2UuYm9keS5odG1sIHx8IHJlc3BvbnNlLmJvZHksXG4gICAgICAgICAgICAgICAgICAgIGFmdGVyT3BlbjogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHN0cnVjdHVyZSA9IHJlc3BvbnNlLmJvZHkuZGF0YSxcbiAgICAgICAgICAgICAgICBub3RpY2UgICAgPSAkKCcjbG0tbm8tbGF5b3V0Jyk7XG5cbiAgICAgICAgICAgIHJvb3QuZGF0YSgnbG0tcm9vdCcsIEpTT04uc3RyaW5naWZ5KHN0cnVjdHVyZSkpLmVtcHR5KCk7XG4gICAgICAgICAgICBpZiAobm90aWNlKSB7IG5vdGljZS5zdHlsZSh7IGRpc3BsYXk6ICdub25lJyB9KTsgfVxuICAgICAgICAgICAgYnVpbGRlci5zZXRTdHJ1Y3R1cmUoc3RydWN0dXJlKTtcbiAgICAgICAgICAgIGJ1aWxkZXIubG9hZCgpO1xuXG4gICAgICAgICAgICBsbWhpc3RvcnkucHVzaChidWlsZGVyLnNlcmlhbGl6ZSgpKTtcblxuICAgICAgICAgICAgJCgnW2RhdGEtbG0tc3dpdGNoZXJdJykuZ2V0UG9wb3ZlcigpLmhpZGUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBQYXJ0aWNsZXMgc2V0dGluZ3NcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1sbS1zZXR0aW5nc10nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICB2YXIgYmxvY2t0eXBlICAgPSBlbGVtZW50LmRhdGEoJ2xtLWJsb2NrdHlwZScpLFxuICAgICAgICAgICAgc2V0dGluZ3NVUkwgPSBlbGVtZW50LmRhdGEoJ2xtLXNldHRpbmdzJyksXG4gICAgICAgICAgICBkYXRhICAgICAgICA9IG51bGwsIHBhcmVudDtcblxuICAgICAgICAvLyBncmlkIGlzIGEgc3BlY2lhbCBjYXNlLCBzaW5jZSByZWxpZXMgb24gcHNldWRvIGVsZW1lbnRzIGZvciBzb3J0aW5nIGFuZCBzYW1lIHdpZHRoIChldmVuaXplKVxuICAgICAgICAvLyB3ZSBuZWVkIHRvIGNoZWNrIHdoZXJlIHRoZSB1c2VyIGNsaWNrZWQuXG4gICAgICAgIGlmIChibG9ja3R5cGUgPT09ICdncmlkJykge1xuICAgICAgICAgICAgdmFyIGNsaWVudFggICA9IGV2ZW50LmNsaWVudFggfHwgKGV2ZW50LnRvdWNoZXMgJiYgZXZlbnQudG91Y2hlc1swXS5jbGllbnRYKSB8fCAwLFxuICAgICAgICAgICAgICAgIGJvdW5kaW5ncyA9IGVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgICAgIGlmIChjbGllbnRYICsgNCAtIGJvdW5kaW5ncy5sZWZ0IDwgYm91bmRpbmdzLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1sbS1ibG9ja3R5cGVdJyk7XG4gICAgICAgIHBhcmVudCA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1sbS1ibG9ja3R5cGVdJyk7XG4gICAgICAgIGJsb2NrdHlwZSA9IGVsZW1lbnQuZGF0YSgnbG0tYmxvY2t0eXBlJyk7XG5cbiAgICAgICAgdmFyIElEICAgICAgID0gZWxlbWVudC5kYXRhKCdsbS1pZCcpLFxuICAgICAgICAgICAgcGFyZW50SUQgPSBwYXJlbnQgPyBwYXJlbnQuZGF0YSgnbG0taWQnKSA6IGZhbHNlO1xuXG4gICAgICAgIGlmICghY29udGFpbnMoWydibG9jaycsICdncmlkJ10sIGJsb2NrdHlwZSkpIHtcbiAgICAgICAgICAgIGRhdGEgPSB7fTtcbiAgICAgICAgICAgIGRhdGEudHlwZSA9IGJ1aWxkZXIuZ2V0KGVsZW1lbnQuZGF0YSgnbG0taWQnKSkuZ2V0VHlwZSgpIHx8IGVsZW1lbnQuZGF0YSgnbG0tYmxvY2t0eXBlJykgfHwgZmFsc2U7XG4gICAgICAgICAgICBkYXRhLnN1YnR5cGUgPSBidWlsZGVyLmdldChlbGVtZW50LmRhdGEoJ2xtLWlkJykpLmdldFN1YlR5cGUoKSB8fCBlbGVtZW50LmRhdGEoJ2xtLWJsb2Nrc3VidHlwZScpIHx8IGZhbHNlO1xuICAgICAgICAgICAgZGF0YS50aXRsZSA9IChlbGVtZW50LmZpbmQoJ2g0JykgfHwgZWxlbWVudC5maW5kKCcudGl0bGUnKSkudGV4dCgpIHx8IGRhdGEudHlwZSB8fCAnVW50aXRsZWQnO1xuICAgICAgICAgICAgZGF0YS5vcHRpb25zID0gYnVpbGRlci5nZXQoZWxlbWVudC5kYXRhKCdsbS1pZCcpKS5nZXRBdHRyaWJ1dGVzKCkgfHwge307XG4gICAgICAgICAgICBkYXRhLmJsb2NrID0gcGFyZW50ID8gYnVpbGRlci5nZXQocGFyZW50LmRhdGEoJ2xtLWlkJykpLmdldEF0dHJpYnV0ZXMoKSB8fCB7fSA6IHt9O1xuXG4gICAgICAgICAgICBpZiAoIWRhdGEudHlwZSkgeyBkZWxldGUgZGF0YS50eXBlOyB9XG4gICAgICAgICAgICBpZiAoIWRhdGEuc3VidHlwZSkgeyBkZWxldGUgZGF0YS5zdWJ0eXBlOyB9XG4gICAgICAgIH1cblxuICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgIGNvbnRlbnQ6ICdMb2FkaW5nJyxcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgIHJlbW90ZTogc2V0dGluZ3NVUkwgKyBnZXRBamF4U3VmZml4KCksXG4gICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGZvcm0gICAgICAgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnZm9ybScpLFxuICAgICAgICAgICAgICAgICAgICBzdWJtaXQgICAgID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2lucHV0W3R5cGU9XCJzdWJtaXRcIl0sIGJ1dHRvblt0eXBlPVwic3VibWl0XCJdJyksXG4gICAgICAgICAgICAgICAgICAgIGRhdGFTdHJpbmcgPSBbXTtcblxuICAgICAgICAgICAgICAgIGlmICghZm9ybSB8fCAhc3VibWl0KSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgICAgICAgICAvLyBQYXJ0aWNsZSBTZXR0aW5ncyBhcHBseVxuICAgICAgICAgICAgICAgIHN1Ym1pdC5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVN0cmluZyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pdC5zaG93SW5kaWNhdG9yKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgJChmb3JtWzBdLmVsZW1lbnRzKS5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dCA9ICQoaW5wdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgICAgID0gaW5wdXQuYXR0cmlidXRlKCduYW1lJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgICAgPSBpbnB1dC52YWx1ZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCAgID0gaW5wdXQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVycmlkZSA9IHBhcmVudCA/IHBhcmVudC5maW5kKCc+IGlucHV0W3R5cGU9XCJjaGVja2JveFwiXScpIDogbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFuYW1lIHx8IGlucHV0LmRpc2FibGVkKCkgfHwgKG92ZXJyaWRlICYmICFvdmVycmlkZS5jaGVja2VkKCkpKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVN0cmluZy5wdXNoKG5hbWUgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ1tkYXRhLXRpdGxlLWVkaXRhYmxlXScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTdHJpbmcucHVzaCgndGl0bGU9JyArIGVuY29kZVVSSUNvbXBvbmVudCh0aXRsZS5kYXRhKCd0aXRsZS1lZGl0YWJsZScpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KGZvcm0uYXR0cmlidXRlKCdtZXRob2QnKSwgZm9ybS5hdHRyaWJ1dGUoJ2FjdGlvbicpICsgZ2V0QWpheFN1ZmZpeCgpLCBkYXRhU3RyaW5nLmpvaW4oJyYnKSB8fCB7fSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0aWNsZSA9IGJ1aWxkZXIuZ2V0KElEKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2sgICAgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFydGljbGUgYXR0cmlidXRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnNldEF0dHJpYnV0ZXMocmVzcG9uc2UuYm9keS5kYXRhLm9wdGlvbnMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLmhhc0F0dHJpYnV0ZSgnZW5hYmxlZCcpKSB7IHBhcnRpY2xlW3BhcnRpY2xlLmdldEF0dHJpYnV0ZSgnZW5hYmxlZCcpID8gJ2VuYWJsZScgOiAnZGlzYWJsZSddKCk7IH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5nZXRUeXBlKCkgIT0gJ3NlY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnNldFRpdGxlKHJlc3BvbnNlLmJvZHkuZGF0YS50aXRsZSB8fCAnVW50aXRsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUudXBkYXRlVGl0bGUocGFydGljbGUuZ2V0VGl0bGUoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLmdldFR5cGUoKSA9PSAncG9zaXRpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnVwZGF0ZUtleSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBhcmVudCBibG9jayBhdHRyaWJ1dGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmJvZHkuZGF0YS5ibG9jayAmJiBzaXplKHJlc3BvbnNlLmJvZHkuZGF0YS5ibG9jaykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2sgPSBidWlsZGVyLmdldChwYXJlbnRJRCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNpYmxpbmcgICAgID0gYmxvY2suYmxvY2submV4dFNpYmxpbmcoKSB8fCBibG9jay5ibG9jay5wcmV2aW91c1NpYmxpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTaXplID0gYmxvY2suZ2V0U2l6ZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZlNpemU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2suc2V0QXR0cmlidXRlcyhyZXNwb25zZS5ib2R5LmRhdGEuYmxvY2spO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZTaXplID0gY3VycmVudFNpemUgLSBibG9jay5nZXRTaXplKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2suc2V0QW5pbWF0ZWRTaXplKGJsb2NrLmdldFNpemUoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpYmxpbmcgPSBidWlsZGVyLmdldChzaWJsaW5nLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2libGluZy5zZXRBbmltYXRlZFNpemUocGFyc2VGbG9hdChzaWJsaW5nLmdldFNpemUoKSkgKyBkaWZmU2l6ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsbWhpc3RvcnkucHVzaChidWlsZGVyLnNlcmlhbGl6ZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoJ1RoZSBwYXJ0aWNsZSBcIicgKyBwYXJ0aWNsZS5nZXRUaXRsZSgpICsgJ1wiIHNldHRpbmdzIGhhdmUgYmVlbiBhcHBsaWVkIHRvIHRoZSBMYXlvdXQuIDxiciAvPlJlbWVtYmVyIHRvIGNsaWNrIHRoZSBTYXZlIGJ1dHRvbiB0byBzdG9yZSB0aGVtLicsICdTZXR0aW5ncyBBcHBsaWVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH0pO1xuXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgJDogJCxcbiAgICBidWlsZGVyOiBidWlsZGVyLFxuICAgIGxheW91dG1hbmFnZXI6IGxheW91dG1hbmFnZXIsXG4gICAgaGlzdG9yeTogbG1oaXN0b3J5LFxuICAgIHNhdmVzdGF0ZTogc2F2ZXN0YXRlXG59OyIsIlwidXNlIHN0cmljdFwiO1xudmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9lbGVtZW50cy51dGlscycpLFxuICAgIHplbiAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBFbWl0dGVyICAgID0gcmVxdWlyZSgncHJpbWUvZW1pdHRlcicpLFxuICAgIEJvdW5kICAgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIEJsb2NrcyAgICAgPSByZXF1aXJlKCcuL2Jsb2NrcycpLFxuICAgIERyYWdEcm9wICAgPSByZXF1aXJlKCcuLi91aS9kcmFnLmRyb3AnKSxcbiAgICBSZXNpemVyICAgID0gcmVxdWlyZSgnLi9kcmFnLnJlc2l6ZXInKSxcbiAgICBFcmFzZXIgICAgID0gcmVxdWlyZSgnLi9lcmFzZXInKSxcbiAgICBnZXQgICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZ2V0JyksXG4gICAga2V5cyAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2tleXMnKSxcblxuICAgIGV2ZXJ5ICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2V2ZXJ5JyksXG4gICAgcHJlY2lzaW9uICA9IHJlcXVpcmUoJ21vdXQvbnVtYmVyL2VuZm9yY2VQcmVjaXNpb24nKSxcbiAgICBpc0FycmF5ICAgID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzQXJyYXknKSxcbiAgICBkZWVwRXF1YWxzID0gcmVxdWlyZSgnbW91dC9sYW5nL2RlZXBFcXVhbHMnKSxcbiAgICBmaW5kICAgICAgID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL2ZpbmQnKSxcbiAgICBpc09iamVjdCAgID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzT2JqZWN0Jyk7XG5cbnZhciBzaW5nbGVzID0ge1xuICAgIGRpc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZ3JpZHMgPSAkKCdbZGF0YS1sbS1yb290XSBbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdJyk7XG4gICAgICAgIGlmIChncmlkcykgeyBncmlkcy5yZW1vdmVDbGFzcygnbm8taG92ZXInKTsgfVxuICAgIH0sXG4gICAgZW5hYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGdyaWRzID0gJCgnW2RhdGEtbG0tcm9vdF0gW2RhdGEtbG0tYmxvY2t0eXBlPVwiZ3JpZFwiXScpO1xuICAgICAgICBpZiAoZ3JpZHMpIHsgZ3JpZHMuYWRkQ2xhc3MoJ25vLWhvdmVyJyk7IH1cbiAgICB9LFxuICAgIGNsZWFudXA6IGZ1bmN0aW9uKGJ1aWxkZXIsIGRyb3BMYXN0KSB7XG4gICAgICAgIHZhciBlbXB0eUdyaWRzID0gJCgnW2RhdGEtbG0tYmxvY2t0eXBlPVwic2VjdGlvblwiXSA+IC5nLWdyaWQ6ZW1wdHksIFtkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXSA+IC5nLWdyaWQ6ZW1wdHknKTtcbiAgICAgICAgaWYgKGVtcHR5R3JpZHMpIHtcbiAgICAgICAgICAgIGVtcHR5R3JpZHMuZm9yRWFjaChmdW5jdGlvbihncmlkKSB7XG4gICAgICAgICAgICAgICAgZ3JpZCA9ICQoZ3JpZCk7XG4gICAgICAgICAgICAgICAgLy8gZW1wdHkgZ3JpZHMgc2hvdWxkIGdvIGF3YXkgdW5sZXNzIHRoZXkgYXJlIGxhc3QgYW5kL29yIGRyb3BMYXN0IGlzIHRydWVcbiAgICAgICAgICAgICAgICBpZiAoZ3JpZC5uZXh0U2libGluZygnW2RhdGEtbG0taWRdJykgfHwgZHJvcExhc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5yZW1vdmUoZ3JpZC5kYXRhKCdsbS1pZCcpKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxufTtcblxudmFyIExheW91dE1hbmFnZXIgPSBuZXcgcHJpbWUoe1xuXG4gICAgbWl4aW46IFtCb3VuZCwgT3B0aW9uc10sXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgICBpZiAoIWVsZW1lbnQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHRoaXMuZHJhZ2Ryb3AgPSBuZXcgRHJhZ0Ryb3AoZWxlbWVudCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMucmVzaXplciA9IG5ldyBSZXNpemVyKGVsZW1lbnQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmVyYXNlciA9IG5ldyBFcmFzZXIoJ1tkYXRhLWxtLWVyYXNlYmxvY2tdJywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuZHJhZ2Ryb3BcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6c3RhcnQnLCB0aGlzLmJvdW5kKCdzdGFydCcpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpsb2NhdGlvbicsIHRoaXMuYm91bmQoJ2xvY2F0aW9uJykpXG4gICAgICAgICAgICAub24oJ2RyYWdkcm9wOm5vbG9jYXRpb24nLCB0aGlzLmJvdW5kKCdub2xvY2F0aW9uJykpXG4gICAgICAgICAgICAub24oJ2RyYWdkcm9wOnJlc2l6ZScsIHRoaXMuYm91bmQoJ3Jlc2l6ZScpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpzdG9wOmVyYXNlJywgdGhpcy5ib3VuZCgncmVtb3ZlRWxlbWVudCcpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpzdG9wJywgdGhpcy5ib3VuZCgnc3RvcCcpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpzdG9wOmFuaW1hdGlvbicsIHRoaXMuYm91bmQoJ3N0b3BBbmltYXRpb24nKSk7XG5cbiAgICAgICAgdGhpcy5idWlsZGVyID0gb3B0aW9ucy5idWlsZGVyO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSBvcHRpb25zLmhpc3Rvcnk7XG4gICAgICAgIHRoaXMuc2F2ZXN0YXRlID0gb3B0aW9ucy5zYXZlc3RhdGUgfHwgbnVsbDtcblxuICAgICAgICBzaW5nbGVzLmRpc2FibGUoKTtcbiAgICB9LFxuXG4gICAgc2luZ2xlczogZnVuY3Rpb24obW9kZSwgYnVpbGRlciwgZHJvcExhc3QpIHtcbiAgICAgICAgc2luZ2xlc1ttb2RlXShidWlsZGVyLCBkcm9wTGFzdCk7XG4gICAgfSxcblxuICAgIHVwZGF0ZVBlbmRpbmdDaGFuZ2VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNhdmVEYXRhID0gdGhpcy5zYXZlc3RhdGUuZ2V0RGF0YSgpLFxuICAgICAgICAgICAgc2VyaWFsRGF0YSA9IHRoaXMuYnVpbGRlci5zZXJpYWxpemUobnVsbCwgdHJ1ZSksXG4gICAgICAgICAgICBkaWZmZXJlbnQgPSBmYWxzZSxcblxuICAgICAgICAgICAgZXF1YWxzID0gZGVlcEVxdWFscyhzYXZlRGF0YSwgc2VyaWFsRGF0YSksXG4gICAgICAgICAgICBzYXZlID0gJCgnW2RhdGEtc2F2ZT1cIkxheW91dFwiXScpLFxuICAgICAgICAgICAgaWNvbiA9IHNhdmUuZmluZCgnaScpLFxuICAgICAgICAgICAgaW5kaWNhdG9yID0gc2F2ZS5maW5kKCcuY2hhbmdlcy1pbmRpY2F0b3InKTtcblxuICAgICAgICBpZiAoZXF1YWxzICYmIGluZGljYXRvcikgeyBzYXZlLmhpZGVJbmRpY2F0b3IoKTsgfVxuICAgICAgICBpZiAoIWVxdWFscyAmJiAhaW5kaWNhdG9yKSB7IHNhdmUuc2hvd0luZGljYXRvcignY2hhbmdlcy1pbmRpY2F0b3IgZmEgZmEtZncgZmEtY2lyY2xlLW8nKSB9XG5cbiAgICAgICAgLy8gRW1pdHMgdGhlIGNoYW5nZWQgZXZlbnQgZm9yIGFsbCBwYXJ0aWNsZXNcbiAgICAgICAgLy8gVXNlZCBmb3IgVUkgdG8gc2hvdyBwYXJ0aWNsZXMgd2hlcmUgdGhlcmUgaGF2ZSBiZWVuIGRpZmZlcmVuY2VzIGFwcGxpZWRcbiAgICAgICAgLy8gQWZ0ZXIgYSBzYXZlZCBzdGF0ZVxuICAgICAgICB2YXIgc2F2ZWQsIGN1cnJlbnQsIGlkO1xuICAgICAgICBzZXJpYWxEYXRhLmZvckVhY2goZnVuY3Rpb24oYmxvY2spe1xuICAgICAgICAgICAgaWQgPSBrZXlzKGJsb2NrKVswXTtcbiAgICAgICAgICAgIHNhdmVkID0gZmluZChzYXZlRGF0YSwgZnVuY3Rpb24oZGF0YSkgeyByZXR1cm4gZGF0YVtpZF07IH0pO1xuICAgICAgICAgICAgY3VycmVudCA9IGZpbmQoc2VyaWFsRGF0YSwgZnVuY3Rpb24oZGF0YSkgeyByZXR1cm4gZGF0YVtpZF07IH0pO1xuICAgICAgICAgICAgZGlmZmVyZW50ID0gIWRlZXBFcXVhbHMoc2F2ZWQsIGN1cnJlbnQpO1xuXG4gICAgICAgICAgICBpZCA9IHRoaXMuYnVpbGRlci5nZXQoaWQpO1xuICAgICAgICAgICAgaWYgKGlkKSB7IGlkLmVtaXQoJ2NoYW5nZWQnLCBkaWZmZXJlbnQpOyB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHJvb3QgPSAkKCdbZGF0YS1sbS1yb290XScpLFxuICAgICAgICAgICAgc2l6ZSA9ICQoZWxlbWVudCkucG9zaXRpb24oKTtcblxuICAgICAgICB0aGlzLmJsb2NrID0gbnVsbDtcbiAgICAgICAgdGhpcy5tb2RlID0gcm9vdC5kYXRhKCdsbS1yb290JykgfHwgJ3BhZ2UnO1xuXG4gICAgICAgIHJvb3QuYWRkQ2xhc3MoJ21vdmluZycpO1xuXG4gICAgICAgIHZhciB0eXBlID0gJChlbGVtZW50KS5kYXRhKCdsbS1ibG9ja3R5cGUnKSxcbiAgICAgICAgICAgIGNsb25lID0gZWxlbWVudFswXS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgICAgICAgaWYgKCF0aGlzLnBsYWNlaG9sZGVyKSB7IHRoaXMucGxhY2Vob2xkZXIgPSB6ZW4oJ2Rpdi5ibG9jay5wbGFjZWhvbGRlcltkYXRhLWxtLXBsYWNlaG9sZGVyXScpOyB9XG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSk7XG5cbiAgICAgICAgdGhpcy5vcmlnaW5hbCA9ICQoY2xvbmUpLmFmdGVyKGVsZW1lbnQpLnN0eWxlKHtcbiAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsXG4gICAgICAgICAgICBvcGFjaXR5OiAwLjVcbiAgICAgICAgfSkuYWRkQ2xhc3MoJ29yaWdpbmFsLXBsYWNlaG9sZGVyJykuZGF0YSgnbG0tZHJvcHpvbmUnLCBudWxsKTtcblxuICAgICAgICBpZiAodHlwZSA9PT0gJ2dyaWQnKSB7IHRoaXMub3JpZ2luYWwuc3R5bGUoeyBkaXNwbGF5OiAnZmxleCcgfSk7IH1cblxuICAgICAgICB0aGlzLm9yaWdpbmFsVHlwZSA9IHR5cGU7XG5cbiAgICAgICAgdGhpcy5ibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBlbGVtZW50LmRhdGEoJ2xtLWlkJykgfHwgJycpIHx8IG5ldyBCbG9ja3NbdHlwZV0oe1xuICAgICAgICAgICAgYnVpbGRlcjogdGhpcy5idWlsZGVyLFxuICAgICAgICAgICAgc3VidHlwZTogZWxlbWVudC5kYXRhKCdsbS1zdWJ0eXBlJyksXG4gICAgICAgICAgICB0aXRsZTogZWxlbWVudC50ZXh0KClcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmJsb2NrLmlzTmV3KCkpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUoe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICAgIHpJbmRleDogMTUwMCxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjUsXG4gICAgICAgICAgICAgICAgd2lkdGg6IE1hdGguY2VpbChzaXplLndpZHRoKSxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGguY2VpbChzaXplLmhlaWdodClcbiAgICAgICAgICAgIH0pLmZpbmQoJ1tkYXRhLWxtLWJsb2NrdHlwZV0nKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuYmxvY2suZ2V0VHlwZSgpID09PSAnZ3JpZCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2libGluZ3MgPSB0aGlzLmJsb2NrLmJsb2NrLnNpYmxpbmdzKCc6bm90KC5vcmlnaW5hbC1wbGFjZWhvbGRlcik6bm90KC5zZWN0aW9uLWhlYWRlcik6bm90KDplbXB0eSknKTtcbiAgICAgICAgICAgICAgICBpZiAoc2libGluZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgc2libGluZ3Muc2VhcmNoKCdbZGF0YS1sbS1pZF0nKS5zdHlsZSh7ICdwb2ludGVyLWV2ZW50cyc6ICdub25lJyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIuYmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5lcmFzZXIuc2hvdygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gZWxlbWVudC5wb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgIHBhcmVudE9mZnNldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBlbGVtZW50LnBhcmVudCgpWzBdLnNjcm9sbFRvcCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogZWxlbWVudC5wYXJlbnQoKVswXS5zY3JvbGxMZWZ0XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWwuc3R5bGUoe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNVxuICAgICAgICAgICAgfSkuc3R5bGUoe1xuICAgICAgICAgICAgICAgIGxlZnQ6IGVsZW1lbnRbMF0ub2Zmc2V0TGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0LFxuICAgICAgICAgICAgICAgIHRvcDogZWxlbWVudFswXS5vZmZzZXRUb3AgLSBwYXJlbnRPZmZzZXQudG9wLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBwb3NpdGlvbi53aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHBvc2l0aW9uLmhlaWdodFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmRyYWdkcm9wLmVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmRyYWdkcm9wLmVsZW1lbnQgPSB0aGlzLm9yaWdpbmFsO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGJsb2NrcztcbiAgICAgICAgaWYgKHR5cGUgPT09ICdncmlkJyAmJiAoYmxvY2tzID0gcm9vdC5zZWFyY2goJ1tkYXRhLWxtLWRyb3B6b25lXTpub3QoW2RhdGEtbG0tYmxvY2t0eXBlPVwiZ3JpZFwiXSknKSkpIHtcbiAgICAgICAgICAgIGJsb2Nrcy5zdHlsZSh7ICdwb2ludGVyLWV2ZW50cyc6ICdub25lJyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNpbmdsZXMuZW5hYmxlKCk7XG4gICAgfSxcblxuICAgIGxvY2F0aW9uOiBmdW5jdGlvbihldmVudCwgbG9jYXRpb24sIHRhcmdldC8qLCBlbGVtZW50Ki8pIHtcbiAgICAgICAgdGFyZ2V0ID0gJCh0YXJnZXQpO1xuICAgICAgICBpZiAoIXRoaXMucGxhY2Vob2xkZXIpIHsgdGhpcy5wbGFjZWhvbGRlciA9IHplbignZGl2LmJsb2NrLnBsYWNlaG9sZGVyW2RhdGEtbG0tcGxhY2Vob2xkZXJdJykuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSk7IH1cblxuICAgICAgICB2YXIgcG9zaXRpb24sXG4gICAgICAgICAgICBkYXRhVHlwZSA9IHRhcmdldC5kYXRhKCdsbS1ibG9ja3R5cGUnKSxcbiAgICAgICAgICAgIG9yaWdpbmFsVHlwZSA9IHRoaXMuYmxvY2suZ2V0VHlwZSgpO1xuXG4gICAgICAgIGlmICghZGF0YVR5cGUgJiYgdGFyZ2V0LmRhdGEoJ2xtLXJvb3QnKSkgeyBkYXRhVHlwZSA9ICdyb290JzsgfVxuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSAncGFnZScgJiYgZGF0YVR5cGUgPT09ICdzZWN0aW9uJykgeyByZXR1cm47IH1cbiAgICAgICAgaWYgKGRhdGFUeXBlID09PSAnZ3JpZCcgJiYgKHRhcmdldC5wYXJlbnQoKS5kYXRhKCdsbS1yb290JykgfHwgKHRhcmdldC5wYXJlbnQoKS5kYXRhKCdsbS1ibG9ja3R5cGUnKSA9PT0gJ2NvbnRhaW5lcicgJiYgdGFyZ2V0LnBhcmVudCgpLnBhcmVudCgpLmRhdGEoJ2xtLXJvb3QnKSkpKSB7IHJldHVybjsgfVxuXG4gICAgICAgIC8vIENoZWNrIGZvciBhZGphY2VudHMgYW5kIGF2b2lkIGluc2VydGluZyBhbnkgcGxhY2Vob2xkZXIgc2luY2UgaXQgd291bGQgYmUgdGhlIHNhbWUgcG9zaXRpb25cbiAgICAgICAgdmFyIGV4Y2x1ZGUgPSAnOm5vdCgucGxhY2Vob2xkZXIpOm5vdChbZGF0YS1sbS1pZD1cIicgKyB0aGlzLm9yaWdpbmFsLmRhdGEoJ2xtLWlkJykgKyAnXCJdKScsXG4gICAgICAgICAgICBhZGphY2VudHMgPSB7XG4gICAgICAgICAgICAgICAgYmVmb3JlOiB0aGlzLm9yaWdpbmFsLnByZXZpb3VzU2libGluZ3MoZXhjbHVkZSksXG4gICAgICAgICAgICAgICAgYWZ0ZXI6IHRoaXMub3JpZ2luYWwubmV4dFNpYmxpbmdzKGV4Y2x1ZGUpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGlmIChhZGphY2VudHMuYmVmb3JlKSB7IGFkamFjZW50cy5iZWZvcmUgPSAkKGFkamFjZW50cy5iZWZvcmVbMF0pOyB9XG4gICAgICAgIGlmIChhZGphY2VudHMuYWZ0ZXIpIHsgYWRqYWNlbnRzLmFmdGVyID0gJChhZGphY2VudHMuYWZ0ZXJbMF0pOyB9XG5cbiAgICAgICAgaWYgKGRhdGFUeXBlID09PSAnYmxvY2snICYmICgoYWRqYWNlbnRzLmJlZm9yZSA9PT0gdGFyZ2V0ICYmIGxvY2F0aW9uLnggPT09ICdhZnRlcicpIHx8IChhZGphY2VudHMuYWZ0ZXIgPT09IHRhcmdldCAmJiBsb2NhdGlvbi54ID09PSAnYmVmb3JlJykpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGFUeXBlID09PSAnZ3JpZCcgJiYgKChhZGphY2VudHMuYmVmb3JlID09PSB0YXJnZXQgJiYgbG9jYXRpb24ueSA9PT0gJ2JlbG93JykgfHwgKGFkamFjZW50cy5hZnRlciA9PT0gdGFyZ2V0ICYmIGxvY2F0aW9uLnkgPT09ICdhYm92ZScpKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5vblZpc2libGUgPSB0YXJnZXQucGFyZW50KCdbZGF0YS1sbS1ibG9ja3R5cGU9XCJhdG9tc1wiXScpLFxuICAgICAgICAgICAgY2hpbGQgPSB0aGlzLmJsb2NrLmJsb2NrLmZpbmQoJ1tkYXRhLWxtLWlkXScpO1xuXG4gICAgICAgIGlmICgoY2hpbGQgPyBjaGlsZC5kYXRhKCdsbS1ibG9ja3R5cGUnKSA6IG9yaWdpbmFsVHlwZSkgPT0gJ2F0b20nKSB7XG4gICAgICAgICAgICBpZiAoIW5vblZpc2libGUpIHsgcmV0dXJuOyB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAobm9uVmlzaWJsZSkgeyByZXR1cm47IH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhhbmRsZXMgdGhlIHR5cGVzIGNhc2VzIGFuZCBub3JtYWxpemVzIHRoZSBsb2NhdGlvbnMgKHggYW5kIHkpXG4gICAgICAgIHZhciBncmlkLCBibG9jaywgbWV0aG9kO1xuXG4gICAgICAgIHN3aXRjaCAoZGF0YVR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3Jvb3QnOlxuICAgICAgICAgICAgY2FzZSAnc2VjdGlvbic6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdncmlkJzpcbiAgICAgICAgICAgICAgICB2YXIgZW1wdHkgPSAhdGFyZ2V0LmNoaWxkcmVuKCc6bm90KC5wbGFjZWhvbGRlciknKTtcbiAgICAgICAgICAgICAgICAvLyBuZXcgcGFydGljbGVzIGNhbm5vdCBiZSBkcm9wcGVkIGluIGV4aXN0aW5nIGdyaWRzLCBvbmx5IGVtcHR5IG9uZXNcbiAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxUeXBlICE9PSAnZ3JpZCcgJiYgIWVtcHR5KSB7IHJldHVybjsgfVxuXG5cbiAgICAgICAgICAgICAgICBpZiAoZW1wdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsVHlwZSA9PT0gJ2dyaWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLmJlZm9yZSh0YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgYXJlIGRyb3BwaW5nIGEgbmV3IHBhcnRpY2xlIGludG8gYW4gZW1wdHkgZ3JpZCwgcGxhY2Vob2xkZXIgZ29lcyBpbnNpZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIuYm90dG9tKHRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBhcmUgc29ydGluZyBncmlkcyBvcmRlcmluZywgcGxhY2Vob2xkZXIgZ29lcyBhYm92ZS9iZWxvd1xuICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSAobG9jYXRpb24ueSA9PT0gJ2Fib3ZlJyA/ICdiZWZvcmUnIDogJ2FmdGVyJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXJbbWV0aG9kXSh0YXJnZXQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYmxvY2snOlxuICAgICAgICAgICAgICAgIG1ldGhvZCA9IChsb2NhdGlvbi55ID09PSAnYWJvdmUnID8gJ3RvcCcgOiAnYm90dG9tJyk7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSAobG9jYXRpb24ueCA9PT0gJ290aGVyJykgPyBtZXRob2QgOiBsb2NhdGlvbi54O1xuICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXJbcG9zaXRpb25dKHRhcmdldCk7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIGl0J3Mgbm90IGEgYmxvY2sgd2UgZG9uJ3Qgd2FudCBhIHNtYWxsIHZlcnNpb24gb2YgdGhlIHBsYWNlaG9sZGVyXG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIucmVtb3ZlQ2xhc3MoJ2luLWJldHdlZW4nKS5yZW1vdmVDbGFzcygnaW4tYmV0d2Vlbi1ncmlkcycpLnJlbW92ZUNsYXNzKCdpbi1iZXR3ZWVuLWdyaWRzLWZpcnN0JykucmVtb3ZlQ2xhc3MoJ2luLWJldHdlZW4tZ3JpZHMtbGFzdCcpO1xuICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnN0eWxlKHsgZGlzcGxheTogJ2Jsb2NrJyB9KVtkYXRhVHlwZSAhPT0gJ2Jsb2NrJyA/ICdyZW1vdmVDbGFzcycgOiAnYWRkQ2xhc3MnXSgnaW4tYmV0d2VlbicpO1xuXG4gICAgICAgIGlmIChvcmlnaW5hbFR5cGUgPT09ICdncmlkJyAmJiBkYXRhVHlwZSA9PT0gJ2dyaWQnKSB7XG4gICAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMucGxhY2Vob2xkZXIubmV4dFNpYmxpbmcoKSxcbiAgICAgICAgICAgICAgICBwcmV2aW91cyA9IHRoaXMucGxhY2Vob2xkZXIucHJldmlvdXNTaWJsaW5nKCk7XG5cbiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIuYWRkQ2xhc3MoJ2luLWJldHdlZW4tZ3JpZHMnKTtcbiAgICAgICAgICAgIGlmIChwcmV2aW91cyAmJiAhcHJldmlvdXMuZGF0YSgnbG0tYmxvY2t0eXBlJykpIHsgdGhpcy5wbGFjZWhvbGRlci5hZGRDbGFzcygnaW4tYmV0d2Vlbi1ncmlkcy1maXJzdCcpOyB9XG4gICAgICAgICAgICBpZiAoIW5leHQgfHwgIW5leHQuZGF0YSgnbG0tYmxvY2t0eXBlJykpIHsgdGhpcy5wbGFjZWhvbGRlci5hZGRDbGFzcygnaW4tYmV0d2Vlbi1ncmlkcy1sYXN0Jyk7IH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBub2xvY2F0aW9uOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgeyB0aGlzLnBsYWNlaG9sZGVyLnJlbW92ZSgpOyB9XG4gICAgICAgIGlmICghdGhpcy5ibG9jaykgeyByZXR1cm47IH1cblxuICAgICAgICBpZiAoIXRoaXMuYmxvY2suaXNOZXcoKSkge1xuICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5tYXRjaGVzKHRoaXMuZXJhc2VyLmVsZW1lbnQpIHx8IHRoaXMuZXJhc2VyLmVsZW1lbnQuZmluZCgkKGV2ZW50LnRhcmdldCkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5yZW1vdmVFbGVtZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmVyYXNlci5vdmVyKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2Ryb3AucmVtb3ZlRWxlbWVudCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZXJhc2VyLm91dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlc2l6ZTogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQsIHNpYmxpbmdzLCBvZmZzZXQpIHtcbiAgICAgICAgdGhpcy5yZXNpemVyLnN0YXJ0KGV2ZW50LCBlbGVtZW50LCBzaWJsaW5ncywgb2Zmc2V0KTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlRWxlbWVudDogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5kcmFnZHJvcC5yZW1vdmVFbGVtZW50ID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIHRyYW5zaXRpb24gPSB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgIH07XG5cbiAgICAgICAgZWxlbWVudC5hbmltYXRlKHRyYW5zaXRpb24sIHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiAnMTUwbXMnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciByb290ID0gJCgnW2RhdGEtbG0tcm9vdF0nKSwgYmxvY2tzO1xuICAgICAgICBpZiAodGhpcy5ibG9jay5nZXRUeXBlKCkgPT09ICdncmlkJyAmJiAoYmxvY2tzID0gcm9vdC5zZWFyY2goJ1tkYXRhLWxtLWRyb3B6b25lXTpub3QoW2RhdGEtbG0tYmxvY2t0eXBlPVwiZ3JpZFwiXSknKSkpIHtcbiAgICAgICAgICAgIGJsb2Nrcy5zdHlsZSh7ICdwb2ludGVyLWV2ZW50cyc6ICdpbmhlcml0JyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzaWJsaW5ncyA9IHRoaXMuYmxvY2suYmxvY2suc2libGluZ3MoJzpub3QoLm9yaWdpbmFsLXBsYWNlaG9sZGVyKScpO1xuXG4gICAgICAgIGlmIChzaWJsaW5ncyAmJiB0aGlzLmJsb2NrLmdldFR5cGUoKSA9PSAnYmxvY2snKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuYmxvY2suZ2V0U2l6ZSgpLFxuICAgICAgICAgICAgICAgIGRpZmYgPSBzaXplIC8gc2libGluZ3MubGVuZ3RoLFxuICAgICAgICAgICAgICAgIG5ld1NpemUsIGJsb2NrLCB0b3RhbCA9IDAsIGxhc3Q7XG4gICAgICAgICAgICBzaWJsaW5ncy5mb3JFYWNoKGZ1bmN0aW9uKHNpYmxpbmcsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgc2libGluZyA9ICQoc2libGluZyk7XG4gICAgICAgICAgICAgICAgYmxvY2sgPSBnZXQodGhpcy5idWlsZGVyLm1hcCwgc2libGluZy5kYXRhKCdsbS1pZCcpKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggKyAxID09IHNpYmxpbmdzLmxlbmd0aCkgeyBsYXN0ID0gYmxvY2s7IH1cbiAgICAgICAgICAgICAgICBuZXdTaXplID0gcHJlY2lzaW9uKGJsb2NrLmdldFNpemUoKSArIGRpZmYsIDApO1xuICAgICAgICAgICAgICAgIHRvdGFsICs9IG5ld1NpemU7XG4gICAgICAgICAgICAgICAgYmxvY2suc2V0U2l6ZShuZXdTaXplLCB0cnVlKTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICAvLyBlbnN1cmluZyBpdCdzIGFsd2F5cyAxMDAlXG4gICAgICAgICAgICBpZiAodG90YWwgIT0gMTAwICYmIGxhc3QpIHtcbiAgICAgICAgICAgICAgICBzaXplID0gbGFzdC5nZXRTaXplKCk7XG4gICAgICAgICAgICAgICAgZGlmZiA9IDEwMCAtIHRvdGFsO1xuICAgICAgICAgICAgICAgIGxhc3Quc2V0U2l6ZShzaXplICsgZGlmZiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVyYXNlci5oaWRlKCk7XG5cbiAgICAgICAgJChkb2N1bWVudCkub2ZmKHRoaXMuZHJhZ2Ryb3AuRVZFTlRTLk1PVkUsIHRoaXMuZHJhZ2Ryb3AuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgICQoZG9jdW1lbnQpLm9mZih0aGlzLmRyYWdkcm9wLkVWRU5UUy5TVE9QLCB0aGlzLmRyYWdkcm9wLmJvdW5kKCdzdG9wJykpO1xuXG4gICAgICAgIHRoaXMuYnVpbGRlci5yZW1vdmUodGhpcy5ibG9jay5nZXRJZCgpKTtcblxuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmJsb2NrLmJsb2NrLnNlYXJjaCgnW2RhdGEtbG0taWRdJyk7XG4gICAgICAgIGlmIChjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkZXIucmVtb3ZlKCQoY2hpbGQpLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJsb2NrLmJsb2NrLnJlbW92ZSgpO1xuXG4gICAgICAgIGlmICh0aGlzLnBsYWNlaG9sZGVyKSB7IHRoaXMucGxhY2Vob2xkZXIucmVtb3ZlKCk7IH1cbiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWwpIHsgdGhpcy5vcmlnaW5hbC5yZW1vdmUoKTsgfVxuICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmJsb2NrID0gbnVsbDtcblxuICAgICAgICBzaW5nbGVzLmRpc2FibGUoKTtcbiAgICAgICAgc2luZ2xlcy5jbGVhbnVwKHRoaXMuYnVpbGRlcik7XG5cbiAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2godGhpcy5idWlsZGVyLnNlcmlhbGl6ZSgpKTtcbiAgICAgICAgcm9vdC5yZW1vdmVDbGFzcygnbW92aW5nJyk7XG5cbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oZXZlbnQsIHRhcmdldC8qLCBlbGVtZW50Ki8pIHtcbiAgICAgICAgLy8gd2UgYXJlIHJlbW92aW5nIHRoZSBibG9ja1xuICAgICAgICB2YXIgbGFzdE92ZXJlZCA9ICQodGhpcy5kcmFnZHJvcC5sYXN0T3ZlcmVkKTtcbiAgICAgICAgaWYgKGxhc3RPdmVyZWQgJiYgbGFzdE92ZXJlZC5tYXRjaGVzKHRoaXMuZXJhc2VyLmVsZW1lbnQuZmluZCgnLnRyYXNoLXpvbmUnKSkpIHtcbiAgICAgICAgICAgIHRoaXMuZXJhc2VyLmhpZGUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmJsb2NrLmdldFR5cGUoKSA9PT0gJ2dyaWQnKSB7XG4gICAgICAgICAgICB2YXIgc2libGluZ3MgPSB0aGlzLmJsb2NrLmJsb2NrLnNpYmxpbmdzKCc6bm90KC5vcmlnaW5hbC1wbGFjZWhvbGRlcik6bm90KC5zZWN0aW9uLWhlYWRlcik6bm90KDplbXB0eSknKTtcbiAgICAgICAgICAgIGlmIChzaWJsaW5ncykge1xuICAgICAgICAgICAgICAgIHNpYmxpbmdzLnNlYXJjaCgnW2RhdGEtbG0taWRdJykuc3R5bGUoeyAncG9pbnRlci1ldmVudHMnOiAnaW5oZXJpdCcgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuYmxvY2suaXNOZXcoKSkgeyB0aGlzLmVyYXNlci5oaWRlKCk7IH1cbiAgICAgICAgaWYgKCF0aGlzLmRyYWdkcm9wLm1hdGNoZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBsYWNlaG9sZGVyKSB7IHRoaXMucGxhY2Vob2xkZXIucmVtb3ZlKCk7IH1cblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGFyZ2V0ID0gJCh0YXJnZXQpO1xuXG4gICAgICAgIHZhciB3cmFwcGVyLCBpbnNpZGVyLFxuICAgICAgICAgICAgbXVsdGlMb2NhdGlvblJlc2l6ZSA9IGZhbHNlLFxuICAgICAgICAgICAgYmxvY2tXYXNOZXcgPSB0aGlzLmJsb2NrLmlzTmV3KCksXG4gICAgICAgICAgICB0eXBlID0gdGhpcy5ibG9jay5nZXRUeXBlKCksXG4gICAgICAgICAgICB0YXJnZXRJZCA9IHRhcmdldC5kYXRhKCdsbS1pZCcpLFxuICAgICAgICAgICAgdGFyZ2V0VHlwZSA9ICF0YXJnZXRJZCA/IGZhbHNlIDogZ2V0KHRoaXMuYnVpbGRlci5tYXAsIHRhcmdldElkKSA/IGdldCh0aGlzLmJ1aWxkZXIubWFwLCB0YXJnZXRJZCkuZ2V0VHlwZSgpIDogdGFyZ2V0LmRhdGEoJ2xtLWJsb2NrdHlwZScpLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXJQYXJlbnQgPSB0aGlzLnBsYWNlaG9sZGVyLnBhcmVudCgpO1xuXG4gICAgICAgIGlmICghcGxhY2Vob2xkZXJQYXJlbnQpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdmFyIHBhcmVudElkID0gcGxhY2Vob2xkZXJQYXJlbnQuZGF0YSgnbG0taWQnKSxcbiAgICAgICAgICAgIHBhcmVudFR5cGUgPSBnZXQodGhpcy5idWlsZGVyLm1hcCwgcGFyZW50SWQgfHwgJycpID8gZ2V0KHRoaXMuYnVpbGRlci5tYXAsIHBhcmVudElkKS5nZXRUeXBlKCkgOiBmYWxzZSxcbiAgICAgICAgICAgIHJlc2l6ZUNhc2UgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLm9yaWdpbmFsLnJlbW92ZSgpO1xuXG4gICAgICAgIC8vIGNhc2UgMTogaXQncyBhIG5ldyBwYXJ0aWNsZSBkcm9wcGVkIGluIHRoZSBMTSwgd2UgbmVlZCB0byB3cmFwIGl0IGluc2lkZSBhIGJsb2NrXG4gICAgICAgIGlmICh0eXBlICE9PSAnYmxvY2snICYmIHR5cGUgIT09ICdncmlkJyAmJiAoKHRhcmdldFR5cGUgPT09ICdzZWN0aW9uJyB8fCB0YXJnZXRUeXBlID09PSAnZ3JpZCcpIHx8ICh0YXJnZXRUeXBlID09PSAnYmxvY2snICYmIHBhcmVudFR5cGUgIT09ICdibG9jaycpKSkge1xuICAgICAgICAgICAgd3JhcHBlciA9IG5ldyBCbG9ja3MuYmxvY2soe1xuICAgICAgICAgICAgICAgIGJ1aWxkZXI6IHRoaXMuYnVpbGRlclxuICAgICAgICAgICAgfSkuYWRvcHQodGhpcy5ibG9jay5ibG9jayk7XG5cbiAgICAgICAgICAgIGluc2lkZXIgPSBuZXcgQmxvY2tzW3R5cGVdKHtcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5ibG9jay5ibG9jay5kYXRhKCdsbS1pZCcpLFxuICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgc3VidHlwZTogdGhpcy5lbGVtZW50LmRhdGEoJ2xtLWJsb2Nrc3VidHlwZScpLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmVsZW1lbnQudGV4dCgpLFxuICAgICAgICAgICAgICAgIGJ1aWxkZXI6IHRoaXMuYnVpbGRlclxuICAgICAgICAgICAgfSkuc2V0TGF5b3V0KHRoaXMuYmxvY2suYmxvY2spO1xuXG4gICAgICAgICAgICB3cmFwcGVyLnNldFNpemUoKTtcblxuICAgICAgICAgICAgdGhpcy5ibG9jayA9IHdyYXBwZXI7XG4gICAgICAgICAgICB0aGlzLmJ1aWxkZXIuYWRkKHdyYXBwZXIpO1xuICAgICAgICAgICAgdGhpcy5idWlsZGVyLmFkZChpbnNpZGVyKTtcblxuICAgICAgICAgICAgaW5zaWRlci5lbWl0KCdyZW5kZXJlZCcsIGluc2lkZXIsIHdyYXBwZXIpO1xuICAgICAgICAgICAgd3JhcHBlci5lbWl0KCdyZW5kZXJlZCcsIHdyYXBwZXIsIG51bGwpO1xuXG4gICAgICAgICAgICByZXNpemVDYXNlID0geyBjYXNlOiAxIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjYXNlIDI6IG1vdmluZyBhIGJsb2NrIGFyb3VuZCwgbmVlZCB0byBmaXggc2l6ZXMgaWYgaXQncyBhIG11bHRpIGxvY2F0aW9uIHJlc2l6ZVxuICAgICAgICBpZiAodGhpcy5vcmlnaW5hbFR5cGUgPT09ICdibG9jaycgJiYgdGhpcy5ibG9jay5nZXRUeXBlKCkgPT09ICdibG9jaycpIHtcbiAgICAgICAgICAgIHJlc2l6ZUNhc2UgPSB7IGNhc2U6IDMgfTtcbiAgICAgICAgICAgIHZhciBwcmV2aW91cyA9IHRoaXMuYmxvY2suYmxvY2sucGFyZW50KCdbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdJyksXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJQcmV2aW91cyA9IHRoaXMucGxhY2Vob2xkZXIucGFyZW50KCdbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdJyk7XG4gICAgICAgICAgICAvL2lmIChwcmV2aW91cy5maW5kKCchPiBbZGF0YS1sbS1ibG9ja3R5cGU9XCJjb250YWluZXJcIl0nKSkgeyBwcmV2aW91cyA9IHByZXZpb3VzLnBhcmVudCgpOyB9XG4gICAgICAgICAgICAvL2lmIChwbGFjZWhvbGRlclByZXZpb3VzLmZpbmQoJyE+IFtkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXScpKSB7IHBsYWNlaG9sZGVyUHJldmlvdXMgPSBwbGFjZWhvbGRlclByZXZpb3VzLnBhcmVudCgpOyB9XG4gICAgICAgICAgICBpZiAocGxhY2Vob2xkZXJQcmV2aW91cyAhPT0gcHJldmlvdXMpIHtcbiAgICAgICAgICAgICAgICBtdWx0aUxvY2F0aW9uUmVzaXplID0ge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiB0aGlzLmJsb2NrLmJsb2NrLnNpYmxpbmdzKCc6bm90KC5wbGFjZWhvbGRlciknKSxcbiAgICAgICAgICAgICAgICAgICAgdG86IHRoaXMucGxhY2Vob2xkZXIuc2libGluZ3MoJzpub3QoLnBsYWNlaG9sZGVyKScpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByZXZpb3VzLmZpbmQoJyE+IFtkYXRhLWxtLWJsb2NrdHlwZT1cImNvbnRhaW5lclwiXScpKSB7IHByZXZpb3VzID0gcHJldmlvdXMucGFyZW50KCk7IH1cbiAgICAgICAgICAgIHByZXZpb3VzID0gcHJldmlvdXMuc2libGluZ3MoJzpub3QoLm9yaWdpbmFsLXBsYWNlaG9sZGVyKScpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmJsb2NrLmlzTmV3KCkgJiYgcHJldmlvdXMubGVuZ3RoKSB7IHRoaXMucmVzaXplci5ldmVuUmVzaXplKHByZXZpb3VzKTsgfVxuXG4gICAgICAgICAgICB0aGlzLmJsb2NrLmJsb2NrLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTtcbiAgICAgICAgICAgIHRoaXMuYmxvY2suc2V0U2l6ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdncmlkJyAmJiAhc2libGluZ3MpIHtcbiAgICAgICAgICAgIHZhciBwbHVzID0gdGhpcy5ibG9jay5ibG9jay5wYXJlbnQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cInNlY3Rpb25cIl0nKS5maW5kKCcuZmEtcGx1cycpO1xuICAgICAgICAgICAgaWYgKHBsdXMpIHsgcGx1cy5lbWl0KCdjbGljaycpOyB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5ibG9jay5oYXNBdHRyaWJ1dGUoJ3NpemUnKSkgeyB0aGlzLmJsb2NrLnNldFNpemUodGhpcy5wbGFjZWhvbGRlci5jb21wdXRlKCdmbGV4JykpOyB9XG5cbiAgICAgICAgdGhpcy5ibG9jay5pbnNlcnQodGhpcy5wbGFjZWhvbGRlcik7XG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIucmVtb3ZlKCk7XG5cbiAgICAgICAgaWYgKGJsb2NrV2FzTmV3KSB7XG4gICAgICAgICAgICBpZiAocmVzaXplQ2FzZSkgeyB0aGlzLnJlc2l6ZXIuZXZlblJlc2l6ZSgkKFt0aGlzLmJsb2NrLmJsb2NrLCB0aGlzLmJsb2NrLmJsb2NrLnNpYmxpbmdzKCldKSk7IH1cblxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKG11bHRpTG9jYXRpb25SZXNpemUuZnJvbSB8fCAobXVsdGlMb2NhdGlvblJlc2l6ZS50byAmJiBtdWx0aUxvY2F0aW9uUmVzaXplLnRvICE9IHRoaXMuYmxvY2suYmxvY2spKSB7XG4gICAgICAgICAgICAvLyBpZiAhZnJvbSAvICF0byBtZWFucyBpdCdzIGVtcHR5IGdyaWQsIHNob3VsZCB3ZSByZW1vdmUgaXQ/XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IHRoaXMuYmxvY2suZ2V0U2l6ZSgpLCBkaWZmLCBibG9jaztcblxuICAgICAgICAgICAgLy8gd2UgYXJlIG1vdmluZyB0aGUgcGFydGljbGUgdG8gYW4gZW1wdHkgZ3JpZCwgcmVzZXR0aW5nIHRoZSBzaXplIHRvIDEwMCVcbiAgICAgICAgICAgIGlmICghbXVsdGlMb2NhdGlvblJlc2l6ZS50bykgeyB0aGlzLmJsb2NrLnNldFNpemUoMTAwLCB0cnVlKTsgfVxuXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGNvbXBlbnNhdGUgdGhlIHJlbWFpbmluZyBibG9ja3Mgb24gdGhlIEZST00gd2l0aCB0aGUgbGVhdmluZyBwYXJ0aWNsZSBzaXplXG4gICAgICAgICAgICBpZiAobXVsdGlMb2NhdGlvblJlc2l6ZS5mcm9tKSB7XG4gICAgICAgICAgICAgICAgZGlmZiA9IHNpemUgLyBtdWx0aUxvY2F0aW9uUmVzaXplLmZyb20ubGVuZ3RoO1xuICAgICAgICAgICAgICAgIG11bHRpTG9jYXRpb25SZXNpemUuZnJvbS5mb3JFYWNoKGZ1bmN0aW9uKHNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgc2libGluZyA9ICQoc2libGluZyk7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrID0gZ2V0KHRoaXMuYnVpbGRlci5tYXAsIHNpYmxpbmcuZGF0YSgnbG0taWQnKSk7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLnNldFNpemUoYmxvY2suZ2V0U2l6ZSgpICsgZGlmZiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHRoZSBUTyBpcyByZWNlaXZpbmcgYSBuZXcgYmxvY2sgc28gd2UgYXJlIGdvaW5nIHRvIGV2ZW5pemVcbiAgICAgICAgICAgIGlmIChtdWx0aUxvY2F0aW9uUmVzaXplLnRvKSB7XG4gICAgICAgICAgICAgICAgc2l6ZSA9IDEwMCAvIChtdWx0aUxvY2F0aW9uUmVzaXplLnRvLmxlbmd0aCArIDEpO1xuICAgICAgICAgICAgICAgIG11bHRpTG9jYXRpb25SZXNpemUudG8uZm9yRWFjaChmdW5jdGlvbihzaWJsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpYmxpbmcgPSAkKHNpYmxpbmcpO1xuICAgICAgICAgICAgICAgICAgICBibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBzaWJsaW5nLmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5zZXRTaXplKHNpemUsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2suc2V0U2l6ZShzaXplLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHNpbmdsZXMuZGlzYWJsZSgpO1xuICAgICAgICBzaW5nbGVzLmNsZWFudXAodGhpcy5idWlsZGVyKTtcblxuICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCh0aGlzLmJ1aWxkZXIuc2VyaWFsaXplKCkpO1xuICAgIH0sXG5cbiAgICBzdG9wQW5pbWF0aW9uOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciByb290ID0gJCgnW2RhdGEtbG0tcm9vdF0nKTtcbiAgICAgICAgcm9vdC5yZW1vdmVDbGFzcygnbW92aW5nJyk7XG5cbiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWwpIHsgdGhpcy5vcmlnaW5hbC5yZW1vdmUoKTsgfVxuICAgICAgICBzaW5nbGVzLmRpc2FibGUoKTtcblxuICAgICAgICBpZiAoIXRoaXMuYmxvY2spIHsgdGhpcy5ibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBlbGVtZW50LmRhdGEoJ2xtLWlkJykpOyB9XG4gICAgICAgIGlmICh0aGlzLmJsb2NrICYmIHRoaXMuYmxvY2suZ2V0VHlwZSgpID09PSAnYmxvY2snKSB7IHRoaXMuYmxvY2suc2V0U2l6ZSgpOyB9XG4gICAgICAgIGlmICh0aGlzLmJsb2NrICYmIHRoaXMuYmxvY2suaXNOZXcoKSAmJiB0aGlzLmVsZW1lbnQpIHsgdGhpcy5lbGVtZW50LmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTsgfVxuXG4gICAgICAgIGlmICh0aGlzLm9yaWdpbmFsVHlwZSA9PT0gJ2dyaWQnKSB7XG4gICAgICAgICAgICB2YXIgYmxvY2tzLCBibG9jaztcbiAgICAgICAgICAgIGlmIChibG9ja3MgPSByb290LnNlYXJjaCgnW2RhdGEtbG0tZHJvcHpvbmVdOm5vdChbZGF0YS1sbS1ibG9ja3R5cGU9XCJncmlkXCJdKScpKSB7XG4gICAgICAgICAgICAgICAgYmxvY2tzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBibG9jayA9IGdldCh0aGlzLmJ1aWxkZXIubWFwLCBlbGVtZW50LmRhdGEoJ2xtLWlkJykpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suc2V0U2l6ZSgpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gTGF5b3V0TWFuYWdlcjtcbiIsInZhciAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICByZWFkeSAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICByZXF1ZXN0ICAgICAgID0gcmVxdWlyZSgnYWdlbnQnKSxcbiAgICB1aSAgICAgICAgICAgID0gcmVxdWlyZSgnLi91aScpLFxuICAgIGludGVycG9sYXRlICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy9pbnRlcnBvbGF0ZScpLFxuICAgIHRyaW0gICAgICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG4gICAgc2V0UGFyYW0gICAgICA9IHJlcXVpcmUoJ21vdXQvcXVlcnlTdHJpbmcvc2V0UGFyYW0nKSxcbiAgICBtb2RhbCAgICAgICAgID0gdWkubW9kYWwsXG4gICAgdG9hc3RyICAgICAgICA9IHVpLnRvYXN0cixcblxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuL3V0aWxzL2dldC1hamF4LXN1ZmZpeCcpLFxuXG4gICAgbG0gICAgICAgICAgICA9IHJlcXVpcmUoJy4vbG0nKSxcbiAgICBtbSAgICAgICAgICAgID0gcmVxdWlyZSgnLi9tZW51Jyk7XG5cbnJlcXVpcmUoJ2VsZW1lbnRzL2F0dHJpYnV0ZXMnKTtcbnJlcXVpcmUoJ2VsZW1lbnRzL2V2ZW50cycpO1xucmVxdWlyZSgnZWxlbWVudHMvZGVsZWdhdGlvbicpO1xucmVxdWlyZSgnZWxlbWVudHMvaW5zZXJ0aW9uJyk7XG5yZXF1aXJlKCdlbGVtZW50cy90cmF2ZXJzYWwnKTtcbnJlcXVpcmUoJy4vZmllbGRzJyk7XG5yZXF1aXJlKCcuL3VpL3BvcG92ZXInKTtcbnJlcXVpcmUoJy4vdXRpbHMvYWpheGlmeS1saW5rcycpO1xuXG52YXIgY3JlYXRlSGFuZGxlciA9IGZ1bmN0aW9uKGRpdmlzb3Isbm91bixyZXN0T2ZTdHJpbmcpe1xuICAgIHJldHVybiBmdW5jdGlvbihkaWZmKXtcbiAgICAgICAgdmFyIG4gPSBNYXRoLmZsb29yKGRpZmYvZGl2aXNvcik7XG4gICAgICAgIHZhciBwbHVyYWxpemVkTm91biA9IG5vdW4gKyAoIG4gPiAxID8gJ3MnIDogJycgKTtcbiAgICAgICAgcmV0dXJuIFwiXCIgKyBuICsgXCIgXCIgKyBwbHVyYWxpemVkTm91biArIFwiIFwiICsgcmVzdE9mU3RyaW5nO1xuICAgIH1cbn07XG5cbnZhciBmb3JtYXR0ZXJzID0gW1xuICAgIHsgdGhyZXNob2xkOiAtMzE1MzU5OTksIGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoLTMxNTM2MDAwLFx0XCJ5ZWFyXCIsICAgICBcImZyb20gbm93XCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiAtMjU5MTk5OSwgXHRoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKC0yNTkyMDAwLCAgXHRcIm1vbnRoXCIsICAgIFwiZnJvbSBub3dcIiApIH0sXG4gICAgeyB0aHJlc2hvbGQ6IC02MDQ3OTksICBcdGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoLTYwNDgwMCwgICBcdFwid2Vla1wiLCAgICAgXCJmcm9tIG5vd1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogLTE3Mjc5OSwgICBoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKC04NjQwMCwgICAgXHRcImRheVwiLCAgICAgIFwiZnJvbSBub3dcIiApIH0sXG4gICAgeyB0aHJlc2hvbGQ6IC04NjM5OSwgICBcdGhhbmRsZXI6IGZ1bmN0aW9uKCl7IHJldHVybiAgICAgIFx0XCJ0b21vcnJvd1wiIH0gfSxcbiAgICB7IHRocmVzaG9sZDogLTM1OTksICAgIFx0aGFuZGxlcjogY3JlYXRlSGFuZGxlcigtMzYwMCwgICAgIFx0XCJob3VyXCIsICAgICBcImZyb20gbm93XCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiAtNTksICAgICBcdGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoLTYwLCAgICAgICBcdFwibWludXRlXCIsICAgXCJmcm9tIG5vd1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogLTAuOTk5OSwgICBoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKC0xLFx0XHRcdFwic2Vjb25kXCIsICAgXCJmcm9tIG5vd1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogMSwgICAgICAgIFx0aGFuZGxlcjogZnVuY3Rpb24oKXsgcmV0dXJuICAgICAgXHRcImp1c3Qgbm93XCIgfSB9LFxuICAgIHsgdGhyZXNob2xkOiA2MCwgICAgICAgXHRoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKDEsICAgICAgICBcdFwic2Vjb25kXCIsXHRcImFnb1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogMzYwMCwgICAgIFx0aGFuZGxlcjogY3JlYXRlSGFuZGxlcig2MCwgICAgICAgXHRcIm1pbnV0ZVwiLFx0XCJhZ29cIiApIH0sXG4gICAgeyB0aHJlc2hvbGQ6IDg2NDAwLCAgICBcdGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoMzYwMCwgICAgIFx0XCJob3VyXCIsICAgICBcImFnb1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogMTcyODAwLCAgIFx0aGFuZGxlcjogZnVuY3Rpb24oKXsgcmV0dXJuICAgICAgXHRcInllc3RlcmRheVwiIH0gfSxcbiAgICB7IHRocmVzaG9sZDogNjA0ODAwLCAgIFx0aGFuZGxlcjogY3JlYXRlSGFuZGxlcig4NjQwMCwgICAgXHRcImRheVwiLCAgICAgIFwiYWdvXCIgKSB9LFxuICAgIHsgdGhyZXNob2xkOiAyNTkyMDAwLCAgXHRoYW5kbGVyOiBjcmVhdGVIYW5kbGVyKDYwNDgwMCwgICBcdFwid2Vla1wiLCAgICAgXCJhZ29cIiApIH0sXG4gICAgeyB0aHJlc2hvbGQ6IDMxNTM2MDAwLCBcdGhhbmRsZXI6IGNyZWF0ZUhhbmRsZXIoMjU5MjAwMCwgIFx0XCJtb250aFwiLCAgICBcImFnb1wiICkgfSxcbiAgICB7IHRocmVzaG9sZDogSW5maW5pdHksIFx0aGFuZGxlcjogY3JlYXRlSGFuZGxlcigzMTUzNjAwMCwgXHRcInllYXJcIiwgICAgIFwiYWdvXCIgKSB9XG5dO1xuXG52YXIgcHJldHR5RGF0ZSA9IHtcbiAgICBmb3JtYXQ6IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgICAgIHZhciBkaWZmID0gKCgobmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gZGF0ZS5nZXRUaW1lKCkpIC8gMTAwMCk7XG4gICAgICAgIGZvciggdmFyIGk9MDsgaTxmb3JtYXR0ZXJzLmxlbmd0aDsgaSsrICl7XG4gICAgICAgICAgICBpZiggZGlmZiA8IGZvcm1hdHRlcnNbaV0udGhyZXNob2xkICl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlcnNbaV0uaGFuZGxlcihkaWZmKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJleGhhdXN0ZWQgYWxsIGZvcm1hdHRlciBvcHRpb25zLCBub25lIGZvdW5kXCIpOyAvL3Nob3VsZCBuZXZlciBiZSByZWFjaGVkXG4gICAgfVxufTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgICAgID0gJCgnYm9keScpLFxuICAgICAgICBzZW50ZW5jZSA9ICdUaGUge3t0eXBlfX0ge3t2ZXJifX0gYmVlbiBzdWNjZXNzZnVsbHkgc2F2ZWQhIHt7ZXh0cmFzfX0nO1xuXG4gICAgLy8gQ2xvc2Ugbm90aWZpY2F0aW9uXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZy1jbG9zZV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5kYXRhKCdnLWNsb3NlJyk7XG4gICAgICAgIHBhcmVudCA9IHBhcmVudCA/IGVsZW1lbnQucGFyZW50KHBhcmVudCkgOiBlbGVtZW50O1xuXG4gICAgICAgIHBhcmVudC5zbGlkZVVwKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcGFyZW50LnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIFBsYXRmb3JtIFNldHRpbmdzIHJlZGlyZWN0XG4gICAgYm9keS5kZWxlZ2F0ZSgnbW91c2Vkb3duJywgJ1tkYXRhLXNldHRpbmdzLWtleV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCl7XG4gICAgICAgIHZhciBrZXkgPSBlbGVtZW50LmRhdGEoJ3NldHRpbmdzLWtleScpO1xuICAgICAgICBpZiAoIWtleSkgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgICAgIHZhciByZWRpcmVjdCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gsXG4gICAgICAgICAgICBzZXR0aW5ncyA9IGVsZW1lbnQuYXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICB1cmkgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnPycpO1xuICAgICAgICBpZiAodXJpLmxlbmd0aCA+IDEgJiYgdXJpWzBdLm1hdGNoKC9pbmRleC5waHAkLykpIHsgcmVkaXJlY3QgPSAnaW5kZXgucGhwJyArIHJlZGlyZWN0OyB9XG5cbiAgICAgICAgcmVkaXJlY3QgPSBzZXRQYXJhbShzZXR0aW5ncywga2V5LCBidG9hKHJlZGlyZWN0KSk7XG4gICAgICAgIGVsZW1lbnQuaHJlZihyZWRpcmVjdCk7XG4gICAgfSk7XG5cbiAgICAvLyBTYXZlIFRvb2x0aXBcbiAgICBib2R5LmRlbGVnYXRlKCdtb3VzZW92ZXInLCAnLmJ1dHRvbi1zYXZlJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpe1xuICAgICAgICBpZiAoIWVsZW1lbnQubGFzdFNhdmVkKSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2ctdG9vbHRpcCcpLmFkZENsYXNzKCdnLXRvb2x0aXAtcmlnaHQnKS5kYXRhKCd0aXRsZScsICdMYXN0IFNhdmVkOiAnICsgcHJldHR5RGF0ZS5mb3JtYXQoZWxlbWVudC5sYXN0U2F2ZWQpKTtcbiAgICB9KTtcblxuICAgIC8vIFNhdmVcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICcuYnV0dG9uLXNhdmUnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICBlbGVtZW50LnNob3dJbmRpY2F0b3IoKTtcblxuICAgICAgICB2YXIgZGF0YSAgICA9IHt9LFxuICAgICAgICAgICAgdHlwZSAgICA9IGVsZW1lbnQuZGF0YSgnc2F2ZScpLFxuICAgICAgICAgICAgZXh0cmFzICA9ICcnLFxuICAgICAgICAgICAgcGFnZSAgICA9ICQoJ1tkYXRhLWxtLXJvb3RdJykgPyAnbGF5b3V0JyA6ICgkKCdbZGF0YS1tbS1pZF0nKSA/ICdtZW51JyA6ICdvdGhlcicpLFxuICAgICAgICAgICAgc2F2ZVVSTCA9IHRyaW0od2luZG93LmxvY2F0aW9uLmhyZWYsICcjJykgKyBnZXRBamF4U3VmZml4KCk7XG5cbiAgICAgICAgc3dpdGNoIChwYWdlKSB7XG4gICAgICAgICAgICBjYXNlICdsYXlvdXQnOlxuICAgICAgICAgICAgICAgIGxtLmxheW91dG1hbmFnZXIuc2luZ2xlcygnY2xlYW51cCcsIGxtLmJ1aWxkZXIsIHRydWUpO1xuICAgICAgICAgICAgICAgIGxtLnNhdmVzdGF0ZS5zZXRTZXNzaW9uKGxtLmJ1aWxkZXIuc2VyaWFsaXplKG51bGwsIHRydWUpKTtcbiAgICAgICAgICAgICAgICBkYXRhLmxheW91dCA9IEpTT04uc3RyaW5naWZ5KGxtLmJ1aWxkZXIuc2VyaWFsaXplKCkpO1xuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdtZW51JzpcbiAgICAgICAgICAgICAgICBkYXRhLm1lbnV0eXBlID0gJCgnc2VsZWN0Lm1lbnUtc2VsZWN0LXdyYXAnKS52YWx1ZSgpO1xuICAgICAgICAgICAgICAgIGRhdGEuc2V0dGluZ3MgPSBKU09OLnN0cmluZ2lmeShtbS5tZW51bWFuYWdlci5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgZGF0YS5vcmRlcmluZyA9IEpTT04uc3RyaW5naWZ5KG1tLm1lbnVtYW5hZ2VyLm9yZGVyaW5nKTtcbiAgICAgICAgICAgICAgICBkYXRhLml0ZW1zID0gSlNPTi5zdHJpbmdpZnkobW0ubWVudW1hbmFnZXIuaXRlbXMpO1xuXG4gICAgICAgICAgICAgICAgc2F2ZVVSTCA9IGVsZW1lbnQucGFyZW50KCdmb3JtJykuYXR0cmlidXRlKCdhY3Rpb24nKSArIGdldEFqYXhTdWZmaXgoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnb3RoZXInOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB2YXIgZm9ybSA9IGVsZW1lbnQucGFyZW50KCdmb3JtJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9ybSAmJiBlbGVtZW50LmF0dHJpYnV0ZSgndHlwZScpID09ICdzdWJtaXQnKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZm9ybVswXS5lbGVtZW50cykuZm9yRWFjaChmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSAkKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lICAgICA9IGlucHV0LmF0dHJpYnV0ZSgnbmFtZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICAgID0gaW5wdXQudmFsdWUoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgICA9IGlucHV0LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGUgPSBwYXJlbnQgPyBwYXJlbnQuZmluZCgnPiBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKSA6IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbmFtZSB8fCBpbnB1dC5kaXNhYmxlZCgpIHx8IChvdmVycmlkZSAmJiAhb3ZlcnJpZGUuY2hlY2tlZCgpKSkgeyByZXR1cm47IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJCgnLnNldHRpbmdzLXBhcmFtLXRpdGxlLCAuY2FyZC5zZXR0aW5ncy1ibG9jayA+IGg0JykuaGlkZUluZGljYXRvcigpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCQoJyNzdHlsZXMnKSkgeyBleHRyYXMgPSAnPGJyIC8+VGhlIENTUyB3YXMgc3VjY2Vzc2Z1bGx5IGNvbXBpbGVkISc7IH1cbiAgICAgICAgfVxuXG4gICAgICAgIGJvZHkuZW1pdCgndXBkYXRlT3JpZ2luYWxGaWVsZHMnKTtcblxuICAgICAgICByZXF1ZXN0KCdwb3N0Jywgc2F2ZVVSTCwgZGF0YSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoaW50ZXJwb2xhdGUoc2VudGVuY2UsIHtcbiAgICAgICAgICAgICAgICAgICAgdmVyYjogdHlwZS5zbGljZSgtMSkgPT0gJ3MnID8gJ2hhdmUnIDogJ2hhcycsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGV4dHJhczogZXh0cmFzXG4gICAgICAgICAgICAgICAgfSksIHR5cGUgKyAnIFNhdmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgZWxlbWVudC5sYXN0U2F2ZWQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgICAgICBpZiAocGFnZSA9PSAnbGF5b3V0JykgeyBsbS5sYXlvdXRtYW5hZ2VyLnVwZGF0ZVBlbmRpbmdDaGFuZ2VzKCk7IH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBFZGl0YWJsZSB0aXRsZXNcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS10aXRsZS1lZGl0XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICB2YXIgJHRpdGxlID0gZWxlbWVudC5zaWJsaW5ncygnW2RhdGEtdGl0bGUtZWRpdGFibGVdJykgfHwgZWxlbWVudC5wcmV2aW91c1NpYmxpbmdzKCkuZmluZCgnW2RhdGEtdGl0bGUtZWRpdGFibGVdJykgfHwgZWxlbWVudC5uZXh0U2libGluZ3MoKS5maW5kKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKSwgdGl0bGU7XG4gICAgICAgIGlmICghJHRpdGxlKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgdGl0bGUgPSAkdGl0bGVbMF07XG5cbiAgICAgICAgJHRpdGxlLmF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJywgdHJ1ZSk7XG4gICAgICAgIHRpdGxlLmZvY3VzKCk7XG5cbiAgICAgICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKSwgc2VsZWN0aW9uO1xuICAgICAgICByYW5nZS5zZWxlY3ROb2RlQ29udGVudHModGl0bGUpO1xuICAgICAgICBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgIHNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgc2VsZWN0aW9uLmFkZFJhbmdlKHJhbmdlKTtcblxuICAgICAgICAkdGl0bGUuc3RvcmVkVGl0bGUgPSB0cmltKCR0aXRsZS50ZXh0KCkpO1xuICAgICAgICAkdGl0bGUuZW1pdCgndGl0bGUtZWRpdC1zdGFydCcsICR0aXRsZS5zdG9yZWRUaXRsZSk7XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdrZXlkb3duJywgJ1tkYXRhLXRpdGxlLWVkaXRhYmxlXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgMTM6IC8vIHJldHVyblxuICAgICAgICAgICAgY2FzZSAyNzogLy8gZXNjXG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMjcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50LnN0b3JlZFRpdGxlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50ZXh0KGVsZW1lbnQuc3RvcmVkVGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsIG51bGwpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50WzBdLmJsdXIoKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZW1pdCgndGl0bGUtZWRpdC1leGl0JywgZWxlbWVudC5kYXRhKCd0aXRsZS1lZGl0YWJsZScpLCBldmVudC5rZXlDb2RlID09IDEzID8gJ2VudGVyJyA6ICdlc2MnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdibHVyJywgJ1tkYXRhLXRpdGxlLWVkaXRhYmxlXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBlbGVtZW50LmF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJywgbnVsbCk7XG4gICAgICAgIGVsZW1lbnQuZGF0YSgndGl0bGUtZWRpdGFibGUnLCB0cmltKGVsZW1lbnQudGV4dCgpKSk7XG4gICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgZWxlbWVudC5lbWl0KCd0aXRsZS1lZGl0LWVuZCcsIGVsZW1lbnQuZGF0YSgndGl0bGUtZWRpdGFibGUnKSk7XG4gICAgfSwgdHJ1ZSk7XG5cbiAgICAvLyBRdWljayBBamF4IENhbGxzIFtkYXRhLWFqYXgtYWN0aW9uXVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWFqYXgtYWN0aW9uXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG5cbiAgICAgICAgdmFyIGhyZWYgICA9IGVsZW1lbnQuYXR0cmlidXRlKCdocmVmJykgfHwgZWxlbWVudC5kYXRhKCdhamF4LWFjdGlvbicpLFxuICAgICAgICAgICAgbWV0aG9kID0gZWxlbWVudC5kYXRhKCdhamF4LWFjdGlvbi1tZXRob2QnKSB8fCAncG9zdCc7XG5cbiAgICAgICAgaWYgKCFocmVmKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIGVsZW1lbnQuc2hvd0luZGljYXRvcigpO1xuICAgICAgICByZXF1ZXN0KG1ldGhvZCwgaHJlZiArIGdldEFqYXhTdWZmaXgoKSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKHJlc3BvbnNlLmJvZHkuaHRtbCB8fCAnQWN0aW9uIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQuJywgcmVzcG9uc2UuYm9keS50aXRsZSB8fCAnJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICB9KVxuICAgIH0pO1xuXG59KTtcblxudmFyIG1vZHVsZXMgPSB7XG4gICAgLyptb3V0ICAgIDogcmVxdWlyZSgnbW91dCcpLFxuICAgICBwcmltZSAgIDogcmVxdWlyZSgncHJpbWUnKSxcbiAgICAgXCIkXCIgICAgIDogZWxlbWVudHMsXG4gICAgIHplbiAgICAgOiB6ZW4sXG4gICAgIGRvbXJlYWR5OiBkb21yZWFkeSxcbiAgICAgYWdlbnQgICA6IHJlcXVpcmUoJ2FnZW50JyksKi9cbiAgICBsbTogbG0sXG4gICAgbW06IG1tLFxuICAgIHVpOiByZXF1aXJlKCcuL3VpJyksXG4gICAgc3R5bGVzOiByZXF1aXJlKCcuL3N0eWxlcycpLFxuICAgIFwiJFwiOiAkLFxuICAgIGRvbXJlYWR5OiByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHBhcnRpY2xlczogcmVxdWlyZSgnLi9wYXJ0aWNsZXMnKSxcbiAgICB6ZW46IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIG1vb2Z4OiByZXF1aXJlKCdtb29meCcpXG59O1xuXG53aW5kb3cuRzUgPSBtb2R1bGVzO1xubW9kdWxlLmV4cG9ydHMgPSBtb2R1bGVzO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgRHJhZ0V2ZW50cyA9IHJlcXVpcmUoJy4uL3VpL2RyYWcuZXZlbnRzJyksXG4gICAgcHJpbWUgICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgRW1pdHRlciAgICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9ib3VuZCcpLFxuICAgIE9wdGlvbnMgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcbiAgICBiaW5kICAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgaXNTdHJpbmcgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pc1N0cmluZycpLFxuICAgIG5NYXAgICAgICAgPSByZXF1aXJlKCdtb3V0L21hdGgvbWFwJyksXG4gICAgY2xhbXAgICAgICA9IHJlcXVpcmUoJ21vdXQvbWF0aC9jbGFtcCcpLFxuICAgIHByZWNpc2lvbiAgPSByZXF1aXJlKCdtb3V0L251bWJlci9lbmZvcmNlUHJlY2lzaW9uJyksXG4gICAgZ2V0ICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2dldCcpLFxuICAgICQgICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9lbGVtZW50cy51dGlscycpO1xuXG5yZXF1aXJlKCdlbGVtZW50cy9ldmVudHMnKTtcbnJlcXVpcmUoJ2VsZW1lbnRzL2RlbGVnYXRpb24nKTtcblxudmFyIFJlc2l6ZXIgPSBuZXcgcHJpbWUoe1xuICAgIG1peGluOiBbQm91bmQsIE9wdGlvbnNdLFxuICAgIERSQUdfRVZFTlRTOiBEcmFnRXZlbnRzLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgbWluU2l6ZTogNVxuICAgIH0sXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucywgbWVudW1hbmFnZXIpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmhpc3RvcnkgPSB0aGlzLm9wdGlvbnMuaGlzdG9yeSB8fCB7fTtcbiAgICAgICAgdGhpcy5idWlsZGVyID0gdGhpcy5vcHRpb25zLmJ1aWxkZXIgfHwge307XG4gICAgICAgIHRoaXMubWFwID0gdGhpcy5idWlsZGVyLm1hcDtcbiAgICAgICAgdGhpcy5tZW51bWFuYWdlciA9IG1lbnVtYW5hZ2VyO1xuICAgICAgICB0aGlzLm9yaWdpbiA9IHtcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgdHJhbnNmb3JtOiBudWxsLFxuICAgICAgICAgICAgb2Zmc2V0OiB7XG4gICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICB5OiAwXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIGdldEJsb2NrOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXQodGhpcy5tYXAsIGlzU3RyaW5nKGVsZW1lbnQpID8gZWxlbWVudCA6ICQoZWxlbWVudCkuZGF0YSgnbG0taWQnKSB8fCAnJyk7XG4gICAgfSxcblxuICAgIGdldEF0dHJpYnV0ZTogZnVuY3Rpb24oZWxlbWVudCwgcHJvcCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRCbG9jayhlbGVtZW50KS5nZXRBdHRyaWJ1dGUocHJvcCk7XG4gICAgfSxcblxuICAgIGdldFNpemU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50Lm1hdGNoZXMoJ1tkYXRhLW1tLWlkXScpID8gZWxlbWVudCA6IGVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKSxcbiAgICAgICAgICAgIHNpemUgPSBwYXJlbnQuZmluZCgnLnBlcmNlbnRhZ2UgaW5wdXQnKTtcblxuICAgICAgICByZXR1cm4gTnVtYmVyKHNpemUudmFsdWUoKSk7XG4gICAgfSxcblxuICAgIHNldFNpemU6IGZ1bmN0aW9uKGVsZW1lbnQsIHNpemUsIGFuaW1hdGVkKSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBhbmltYXRlZCA9IHR5cGVvZiBhbmltYXRlZCA9PT0gJ3VuZGVmaW5lZCcgPyBmYWxzZSA6IGFuaW1hdGVkO1xuXG4gICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50Lm1hdGNoZXMoJ1tkYXRhLW1tLWlkXScpID8gZWxlbWVudCA6IGVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKSxcbiAgICAgICAgICAgIHBjID0gcGFyZW50LmZpbmQoJy5wZXJjZW50YWdlIGlucHV0Jyk7XG5cbiAgICAgICAgcGFyZW50W2FuaW1hdGVkID8gJ2FuaW1hdGUnIDogJ3N0eWxlJ10oeydmbGV4JzogJzAgMSAnK3NpemUrJyUnfSk7XG4gICAgICAgIHBjLnZhbHVlKHByZWNpc2lvbihzaXplLCAxKSk7XG4gICAgfSxcblxuICAgIHN0YXJ0OiBmdW5jdGlvbihldmVudCwgZWxlbWVudCwgc2libGluZ3MsIG9mZnNldCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudHlwZS5tYXRjaCgvXnRvdWNoL2kpKSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgaWYgKGV2ZW50LndoaWNoICYmIGV2ZW50LndoaWNoICE9PSAxKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgLy8gU3RvcHMgdGV4dCBzZWxlY3Rpb25cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmVsZW1lbnQucGFyZW50KCcuc3VibWVudS1zZWxlY3RvcicpO1xuICAgICAgICBpZiAoIXBhcmVudCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICBwYXJlbnQuYWRkQ2xhc3MoJ21vdmluZycpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5zaWJsaW5ncyA9IHtcbiAgICAgICAgICAgIG9jY3VwaWVkOiAwLFxuICAgICAgICAgICAgZWxlbWVudHM6IHNpYmxpbmdzLFxuICAgICAgICAgICAgbmV4dDogdGhpcy5lbGVtZW50LnBhcmVudCgnW2RhdGEtbW0taWRdJykubmV4dFNpYmxpbmcoKS5maW5kKCc+IC5zdWJtZW51LWNvbHVtbicpLFxuICAgICAgICAgICAgcHJldnM6IHRoaXMuZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpLnByZXZpb3VzU2libGluZ3MoKSxcbiAgICAgICAgICAgIHNpemVCZWZvcmU6IDBcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodGhpcy5zaWJsaW5ncy5lbGVtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnNpYmxpbmdzLm9jY3VwaWVkIC09IHRoaXMuZ2V0U2l6ZSh0aGlzLnNpYmxpbmdzLm5leHQpO1xuICAgICAgICAgICAgdGhpcy5zaWJsaW5ncy5lbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKHNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNpYmxpbmdzLm9jY3VwaWVkICs9IHRoaXMuZ2V0U2l6ZShzaWJsaW5nKTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc2libGluZ3MucHJldnMpIHtcbiAgICAgICAgICAgIHRoaXMuc2libGluZ3MucHJldnMuZm9yRWFjaChmdW5jdGlvbihzaWJsaW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaWJsaW5ncy5zaXplQmVmb3JlICs9IHRoaXMuZ2V0U2l6ZShzaWJsaW5nKTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vcmlnaW4gPSB7XG4gICAgICAgICAgICBzaXplOiB0aGlzLmdldFNpemUodGhpcy5lbGVtZW50KSxcbiAgICAgICAgICAgIG1heFNpemU6IHRoaXMuZ2V0U2l6ZSh0aGlzLmVsZW1lbnQpICsgdGhpcy5nZXRTaXplKHRoaXMuc2libGluZ3MubmV4dCksXG4gICAgICAgICAgICB4OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYIDogZXZlbnQucGFnZVggKyA2LFxuICAgICAgICAgICAgeTogZXZlbnQuY2hhbmdlZFRvdWNoZXMgPyBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSA6IGV2ZW50LnBhZ2VZXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNsaWVudFJlY3QgPSB0aGlzLmVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICBwYXJlbnRSZWN0ID0gdGhpcy5lbGVtZW50LnBhcmVudCgpWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgIHRoaXMub3JpZ2luLm9mZnNldCA9IHtcbiAgICAgICAgICAgIGNsaWVudFJlY3Q6IGNsaWVudFJlY3QsXG4gICAgICAgICAgICBwYXJlbnRSZWN0OiB7bGVmdDogcGFyZW50UmVjdC5sZWZ0LCByaWdodDogcGFyZW50UmVjdC5yaWdodH0sXG4gICAgICAgICAgICB4OiB0aGlzLm9yaWdpbi54IC0gY2xpZW50UmVjdC5yaWdodCxcbiAgICAgICAgICAgIHk6IGNsaWVudFJlY3QudG9wIC0gdGhpcy5vcmlnaW4ueSxcbiAgICAgICAgICAgIGRvd246IG9mZnNldFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMub3JpZ2luLm9mZnNldC5wYXJlbnRSZWN0LmxlZnQgPSB0aGlzLmVsZW1lbnQucGFyZW50KCcuc3VibWVudS1zZWxlY3RvcicpLmZpbmQoJz4gW2RhdGEtbW0taWRdOmZpcnN0LWNoaWxkJylbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcbiAgICAgICAgdGhpcy5vcmlnaW4ub2Zmc2V0LnBhcmVudFJlY3QucmlnaHQgPSB0aGlzLmVsZW1lbnQucGFyZW50KCcuc3VibWVudS1zZWxlY3RvcicpLmZpbmQoJz4gW2RhdGEtbW0taWRdOmxhc3QtY2hpbGQnKVswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5yaWdodDtcblxuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLk1PVkUuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5TVE9QLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKGV2ZW50LCB0aGlzLmJvdW5kKCdzdG9wJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIG1vdmU6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC50eXBlLm1hdGNoKC9edG91Y2gvaSkpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuXG4gICAgICAgIHZhciBjbGllbnRYID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC50b3VjaGVzWzBdLmNsaWVudFggfHwgMCxcbiAgICAgICAgICAgIGNsaWVudFkgPSBldmVudC5jbGllbnRZIHx8IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WSB8fCAwLFxuICAgICAgICAgICAgcGFyZW50UmVjdCA9IHRoaXMub3JpZ2luLm9mZnNldC5wYXJlbnRSZWN0O1xuXG4gICAgICAgIHZhciBkZWx0YVggPSAodGhpcy5sYXN0WCB8fCBjbGllbnRYKSAtIGNsaWVudFgsXG4gICAgICAgICAgICBkZWx0YVkgPSAodGhpcy5sYXN0WSB8fCBjbGllbnRZKSAtIGNsaWVudFk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPVxuICAgICAgICAgICAgTWF0aC5hYnMoZGVsdGFYKSA+IE1hdGguYWJzKGRlbHRhWSkgJiYgZGVsdGFYID4gMCAmJiAnbGVmdCcgfHxcbiAgICAgICAgICAgIE1hdGguYWJzKGRlbHRhWCkgPiBNYXRoLmFicyhkZWx0YVkpICYmIGRlbHRhWCA8IDAgJiYgJ3JpZ2h0JyB8fFxuICAgICAgICAgICAgTWF0aC5hYnMoZGVsdGFZKSA+IE1hdGguYWJzKGRlbHRhWCkgJiYgZGVsdGFZID4gMCAmJiAndXAnIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkb3duJztcbiAgICAgICAgdmFyIHNpemUsXG4gICAgICAgICAgICBkaWZmID0gMTAwIC0gdGhpcy5zaWJsaW5ncy5vY2N1cGllZCxcbiAgICAgICAgICAgIHZhbHVlID0gY2xpZW50WCArICghdGhpcy5zaWJsaW5ncy5wcmV2cyA/IHRoaXMub3JpZ2luLm9mZnNldC54IC0gdGhpcy5vcmlnaW4ub2Zmc2V0LmRvd24gOiB0aGlzLnNpYmxpbmdzLnByZXZzLmxlbmd0aCksXG4gICAgICAgICAgICBub3JtYWxpemVkID0gY2xhbXAodmFsdWUsIHBhcmVudFJlY3QubGVmdCwgcGFyZW50UmVjdC5yaWdodCk7XG5cbiAgICAgICAgc2l6ZSA9IG5NYXAobm9ybWFsaXplZCwgcGFyZW50UmVjdC5sZWZ0LCBwYXJlbnRSZWN0LnJpZ2h0LCAwLCAxMDApO1xuICAgICAgICBzaXplID0gc2l6ZSAtIHRoaXMuc2libGluZ3Muc2l6ZUJlZm9yZTtcbiAgICAgICAgc2l6ZSA9IHByZWNpc2lvbihjbGFtcChzaXplLCB0aGlzLm9wdGlvbnMubWluU2l6ZSwgdGhpcy5vcmlnaW4ubWF4U2l6ZSAtIHRoaXMub3B0aW9ucy5taW5TaXplKSwgMCk7XG5cbiAgICAgICAgZGlmZiA9IHByZWNpc2lvbihkaWZmIC0gc2l6ZSwgMCk7XG5cbiAgICAgICAgdGhpcy5zZXRTaXplKHRoaXMuZWxlbWVudCwgc2l6ZSk7XG4gICAgICAgIHRoaXMuc2V0U2l6ZSh0aGlzLnNpYmxpbmdzLm5leHQsIGRpZmYpO1xuXG4gICAgICAgIC8vIEhhY2sgdG8gaGFuZGxlIGNhc2VzIHdoZXJlIHNpemUgaXMgbm90IGFuIGludGVnZXJcbiAgICAgICAgdmFyIHNpYmxpbmdzID0gdGhpcy5zaWJsaW5ncy5lbGVtZW50cyxcbiAgICAgICAgICAgIGFtb3VudCA9IHNpYmxpbmdzID8gc2libGluZ3MubGVuZ3RoICsgMSA6IDE7XG4gICAgICAgIGlmIChhbW91bnQgPT0gMyB8fCBhbW91bnQgPT0gNiB8fCBhbW91bnQgPT0gNyB8fCBhbW91bnQgPT0gOCB8fCBhbW91bnQgPT0gOSB8fCBhbW91bnQgPT0gMTEgfHwgYW1vdW50ID09IDEyKSB7XG4gICAgICAgICAgICB2YXIgdG90YWwgPSAwLCBibG9ja3M7XG5cbiAgICAgICAgICAgIGJsb2NrcyA9ICQoW3NpYmxpbmdzLCB0aGlzLmVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKV0pO1xuICAgICAgICAgICAgYmxvY2tzLmZvckVhY2goZnVuY3Rpb24oYmxvY2ssIGluZGV4KXtcbiAgICAgICAgICAgICAgICBibG9jayA9ICQoYmxvY2spO1xuICAgICAgICAgICAgICAgIHNpemUgPSB0aGlzLmdldFNpemUoYmxvY2spO1xuICAgICAgICAgICAgICAgIGlmIChzaXplICUgMSkge1xuICAgICAgICAgICAgICAgICAgICBzaXplID0gcHJlY2lzaW9uKDEwMCAvIGFtb3VudCwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U2l6ZShibG9jaywgc2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdG90YWwgKz0gc2l6ZTtcblxuICAgICAgICAgICAgICAgIGlmIChibG9ja3MubGVuZ3RoID09IGluZGV4ICsgMSAmJiB0b3RhbCAhPSAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IDEwMCAtIHRvdGFsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFNpemUoYmxvY2ssIChzaXplICsgZGlmZikpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmxhc3RYID0gY2xpZW50WDtcbiAgICAgICAgdGhpcy5sYXN0WSA9IGNsaWVudFk7XG4gICAgfSxcblxuICAgIHN0b3A6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC50eXBlLm1hdGNoKC9edG91Y2gvaSkpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLk1PVkUuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB0aGlzLkRSQUdfRVZFTlRTLkVWRU5UUy5TVE9QLmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKGV2ZW50LCB0aGlzLmJvdW5kKCdzdG9wJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKS5yZW1vdmVDbGFzcygnbW92aW5nJyk7XG5cbiAgICAgICAgdGhpcy5tZW51bWFuYWdlci5lbWl0KCdkcmFnRW5kJywgdGhpcy5tZW51bWFuYWdlci5tYXAsICdyZXNpemUnKTtcbiAgICAgICAgLy9pZiAodGhpcy5vcmlnaW4uc2l6ZSAhPT0gdGhpcy5nZXRTaXplKHRoaXMuZWxlbWVudCkpIHsgdGhpcy5oaXN0b3J5LnB1c2godGhpcy5idWlsZGVyLnNlcmlhbGl6ZSgpKTsgfVxuICAgIH0sXG5cbiAgICB1cGRhdGVJdGVtU2l6ZXM6IGZ1bmN0aW9uKGVsZW1lbnRzKSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmVsZW1lbnQgPyB0aGlzLmVsZW1lbnQucGFyZW50KCcuc3VibWVudS1zZWxlY3RvcicpIDogbnVsbDtcbiAgICAgICAgaWYgKCFwYXJlbnQgJiYgIWVsZW1lbnRzKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBibG9ja3MgPSBlbGVtZW50cyB8fCBwYXJlbnQuc2VhcmNoKCc+IFtkYXRhLW1tLWlkXScpLFxuICAgICAgICAgICAgc2l6ZXMgPSBbXSxcbiAgICAgICAgICAgIGFjdGl2ZSA9ICQoJy5tZW51LXNlbGVjdG9yIC5hY3RpdmUnKSxcbiAgICAgICAgICAgIHBhdGggPSBhY3RpdmUgPyBhY3RpdmUuZGF0YSgnbW0taWQnKSA6IG51bGw7XG5cbiAgICAgICAgYmxvY2tzLmZvckVhY2goZnVuY3Rpb24oYmxvY2spe1xuICAgICAgICAgICAgc2l6ZXMucHVzaCh0aGlzLmdldFNpemUoYmxvY2spKTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgLy8gdXBkYXRlIGFjdGl2ZSBwYXRoIHdpdGggbmV3IGNvbHVtbnMgc2l6ZXNcbiAgICAgICAgdGhpcy5tZW51bWFuYWdlci5pdGVtc1twYXRoXS5jb2x1bW5zID0gc2l6ZXM7XG5cbiAgICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZXMoZWxlbWVudHMpO1xuXG4gICAgICAgIHJldHVybiBzaXplcztcbiAgICB9LFxuXG4gICAgdXBkYXRlTWF4VmFsdWVzOiBmdW5jdGlvbihlbGVtZW50cykge1xuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5lbGVtZW50ID8gdGhpcy5lbGVtZW50LnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKSA6IG51bGw7XG4gICAgICAgIGlmICghcGFyZW50ICYmICFlbGVtZW50cykgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgYmxvY2tzID0gZWxlbWVudHMgfHwgcGFyZW50LnNlYXJjaCgnPiBbZGF0YS1tbS1pZF0nKSwgc2l6ZXMsIGlucHV0cztcblxuICAgICAgICBibG9ja3MuZm9yRWFjaChmdW5jdGlvbihibG9jayl7XG4gICAgICAgICAgICBibG9jayA9ICQoYmxvY2spO1xuICAgICAgICAgICAgdmFyIHNpYmxpbmcgPSBibG9jay5uZXh0U2libGluZygpIHx8IGJsb2NrLnByZXZpb3VzU2libGluZygpO1xuICAgICAgICAgICAgaWYgKCFzaWJsaW5nKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICBpbnB1dHMgPSB7XG4gICAgICAgICAgICAgICAgYmxvY2s6IGJsb2NrLmZpbmQoJ2lucHV0LmNvbHVtbi1wYycpLFxuICAgICAgICAgICAgICAgIHNpYmxpbmc6IHNpYmxpbmcuZmluZCgnaW5wdXQuY29sdW1uLXBjJylcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNpemVzID0ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHRoaXMuZ2V0U2l6ZShibG9jayksXG4gICAgICAgICAgICAgICAgc2libGluZzogdGhpcy5nZXRTaXplKHNpYmxpbmcpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzaXplcy50b3RhbCA9IHNpemVzLmN1cnJlbnQgKyBzaXplcy5zaWJsaW5nO1xuICAgICAgICAgICAgaW5wdXRzLmJsb2NrLmF0dHJpYnV0ZSgnbWF4Jywgc2l6ZXMudG90YWwgLSBOdW1iZXIoaW5wdXRzLmJsb2NrLmF0dHJpYnV0ZSgnbWluJykpKTtcbiAgICAgICAgICAgIGlucHV0cy5zaWJsaW5nLmF0dHJpYnV0ZSgnbWF4Jywgc2l6ZXMudG90YWwgLSBOdW1iZXIoaW5wdXRzLnNpYmxpbmcuYXR0cmlidXRlKCdtaW4nKSkpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9LFxuXG4gICAgZXZlblJlc2l6ZTogZnVuY3Rpb24oZWxlbWVudHMsIGFuaW1hdGVkKSB7XG4gICAgICAgIHZhciB0b3RhbCA9IGVsZW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICAgIHNpemUgPSBwcmVjaXNpb24oMTAwIC8gdG90YWwsIDQpO1xuXG4gICAgICAgIGVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLnNldFNpemUoZWxlbWVudCwgc2l6ZSwgKHR5cGVvZiBhbmltYXRlZCA9PSAndW5kZWZpbmVkJyA/IGZhbHNlIDogYW5pbWF0ZWQpKTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVJdGVtU2l6ZXMoZWxlbWVudHMpO1xuICAgICAgICB0aGlzLm1lbnVtYW5hZ2VyLmVtaXQoJ2RyYWdFbmQnLCB0aGlzLm1lbnVtYW5hZ2VyLm1hcCwgJ2V2ZW5SZXNpemUnKTtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZXNpemVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgemVuICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHJlYWR5ICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi91aScpLm1vZGFsLFxuICAgIHJlcXVlc3QgICAgICAgPSByZXF1aXJlKCdhZ2VudCcpLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICBkZWVwRXF1YWxzICAgID0gcmVxdWlyZSgnbW91dC9sYW5nL2RlZXBFcXVhbHMnKTtcblxudmFyIFN0ZXBPbmUgPSBmdW5jdGlvbihtYXAsIG1vZGUpIHsgLy8gbW9kZSBbcmVvcmRlciwgcmVzaXplLCBldmVuUmVzaXplXVxuICAgIGlmIChtb2RlICE9PSAncmVvcmRlcicpIHsgcmV0dXJuOyB9XG4gICAgdGhpcy5yZXNpemVyLnVwZGF0ZUl0ZW1TaXplcygpO1xuXG4gICAgdmFyIHNhdmUgICAgPSAkKCdbZGF0YS1zYXZlXScpLFxuICAgICAgICBjdXJyZW50ID0ge1xuICAgICAgICAgICAgc2V0dGluZ3M6IHRoaXMuc2V0dGluZ3MsXG4gICAgICAgICAgICBvcmRlcmluZzogdGhpcy5vcmRlcmluZyxcbiAgICAgICAgICAgIGl0ZW1zOiB0aGlzLml0ZW1zXG4gICAgICAgIH07XG5cbiAgICBpZiAoIWRlZXBFcXVhbHMobWFwLCBjdXJyZW50KSkge1xuICAgICAgICBzYXZlLnNob3dJbmRpY2F0b3IoJ2ZhIGZhLWZ3IGNoYW5nZXMtaW5kaWNhdG9yIGZhLWNpcmNsZS1vJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc2F2ZS5oaWRlSW5kaWNhdG9yKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNQYXJ0aWNsZSAmJiB0aGlzLmlzTmV3UGFydGljbGUpIHtcbiAgICAgICAgdmFyIGJsb2NrdHlwZSA9IHRoaXMuYmxvY2suZGF0YSgnbW0tYmxvY2t0eXBlJyk7XG4gICAgICAgIHRoaXMuYmxvY2suYXR0cmlidXRlKCdkYXRhLW1tLWJsb2NrdHlwZScsIG51bGwpLmFkZENsYXNzKCdnLW1lbnUtaXRlbS0nICsgYmxvY2t0eXBlKS5kYXRhKCdtbS1vcmlnaW5hbC10eXBlJywgYmxvY2t0eXBlKTtcbiAgICAgICAgemVuKCdzcGFuLm1lbnUtaXRlbS10eXBlLmJhZGdlJykudGV4dChibG9ja3R5cGUpLmFmdGVyKHRoaXMuYmxvY2suZmluZCgnLm1lbnUtaXRlbSAudGl0bGUnKSk7XG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcnLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICAvL2RhdGE6IGRhdGEsXG4gICAgICAgICAgICByZW1vdGU6ICQodGhpcy5ibG9jaykuZmluZCgnLmNvbmZpZy1jb2cnKS5hdHRyaWJ1dGUoJ2hyZWYnKSArIGdldEFqYXhTdWZmaXgoKSxcbiAgICAgICAgICAgIHJlbW90ZUxvYWRlZDogZnVuY3Rpb24ocmVzcG9uc2UsIGNvbnRlbnQpIHtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLnR5cGUgPSB1bmRlZmluZWQ7XG59O1xuXG52YXIgU3RlcFR3byA9IGZ1bmN0aW9uKGRhdGEsIGNvbnRlbnQsIGJ1dHRvbikge1xuICAgIHZhciB1cmkgPSBjb250ZW50LmZpbmQoJ1tkYXRhLW1tLXBhcnRpY2xlLXN0ZXBvbmVdJykuZGF0YSgnbW0tcGFydGljbGUtc3RlcG9uZScpO1xuXG4gICAgcmVxdWVzdCgncG9zdCcsIHVyaSArIGdldEFqYXhTdWZmaXgoKSwgZGF0YSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYnV0dG9uLmhpZGVJbmRpY2F0b3IoKTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29udGVudC5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCk7XG4gICAgfSk7XG59O1xuXG5cbnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICcubWVudS1lZGl0b3ItZXh0cmFzIFtkYXRhLWxtLWJsb2NrdHlwZV0sIC5tZW51LWVkaXRvci1leHRyYXMgW2RhdGEtbW0tbW9kdWxlXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBjb250YWluZXIgICAgPSBlbGVtZW50LnBhcmVudCgnLm1lbnUtZWRpdG9yLWV4dHJhcycpLFxuICAgICAgICAgICAgZWxlbWVudHMgICAgID0gY29udGFpbmVyLnNlYXJjaCgnW2RhdGEtbG0tYmxvY2t0eXBlXSwgW2RhdGEtbW0tbW9kdWxlXScpLFxuICAgICAgICAgICAgc2VsZWN0QnV0dG9uID0gY29udGFpbmVyLmZpbmQoJ1tkYXRhLW1tLXNlbGVjdF0nKTtcblxuICAgICAgICBlbGVtZW50cy5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICBzZWxlY3RCdXR0b24uYXR0cmlidXRlKCdkaXNhYmxlZCcsIG51bGwpO1xuICAgIH0pO1xuXG4gICAgLy8gc2Vjb25kIHN0ZXBcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICcubWVudS1lZGl0b3ItZXh0cmFzIFtkYXRhLW1tLXNlbGVjdF0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKCdkaXNhYmxlZCcpIHx8IGVsZW1lbnQuYXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBjb250YWluZXIgPSBlbGVtZW50LnBhcmVudCgnLm1lbnUtZWRpdG9yLWV4dHJhcycpLFxuICAgICAgICAgICAgc2VsZWN0ZWQgID0gY29udGFpbmVyLmZpbmQoJ1tkYXRhLWxtLWJsb2NrdHlwZV0uc2VsZWN0ZWQsIFtkYXRhLW1tLW1vZHVsZV0uc2VsZWN0ZWQnKSxcbiAgICAgICAgICAgIHR5cGUgICAgICA9IHNlbGVjdGVkLmRhdGEoJ21tLXR5cGUnKSxcbiAgICAgICAgICAgIGRhdGEgICAgICA9IHt0eXBlOiB0eXBlfTtcblxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3BhcnRpY2xlJzpcbiAgICAgICAgICAgICAgICBkYXRhWydwYXJ0aWNsZSddID0gc2VsZWN0ZWQuZGF0YSgnbG0tc3VidHlwZScpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdtb2R1bGUnOlxuICAgICAgICAgICAgICAgIGRhdGFbJ21vZHVsZV9pZCddID0gc2VsZWN0ZWQuZGF0YSgnbW0tbW9kdWxlJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50LnNob3dJbmRpY2F0b3IoKTtcblxuICAgICAgICBTdGVwVHdvKGRhdGEsIGVsZW1lbnQucGFyZW50KCcuZzUtY29udGVudCcpLCBlbGVtZW50KTtcbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFN0ZXBPbmU7IiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgcmVhZHkgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgTWVudU1hbmFnZXIgICA9IHJlcXVpcmUoJy4vbWVudW1hbmFnZXInKSxcbiAgICAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICB6ZW4gICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgbW9kYWwgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykubW9kYWwsXG4gICAgdG9hc3RyICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykudG9hc3RyLFxuICAgIGV4dHJhSXRlbXMgICAgPSByZXF1aXJlKCcuL2V4dHJhLWl0ZW1zJyksXG4gICAgcmVxdWVzdCAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgZGVlcEVxdWFscyAgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9kZWVwRXF1YWxzJyksXG4gICAgdHJpbSAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICBjbGFtcCAgICAgICAgID0gcmVxdWlyZSgnbW91dC9tYXRoL2NsYW1wJyksXG4gICAgY29udGFpbnMgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvY29udGFpbnMnKSxcbiAgICBnZXRBamF4U3VmZml4ID0gcmVxdWlyZSgnLi4vdXRpbHMvZ2V0LWFqYXgtc3VmZml4Jyk7XG5cbnZhciBtZW51bWFuYWdlciwgbWFwO1xuXG52YXIgaXNGaXJlZm94ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2ZpcmVmb3gnKSA+IC0xO1xuXG52YXIgRk9DVVNJTiAgID0gaXNGaXJlZm94ID8gJ2ZvY3VzJyA6ICdmb2N1c2luJyxcbiAgICBGT0NVU09VVCAgPSBpc0ZpcmVmb3ggPyAnYmx1cicgOiAnZm9jdXNvdXQnO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIG1lbnVtYW5hZ2VyID0gbmV3IE1lbnVNYW5hZ2VyKCdib2R5Jywge1xuICAgICAgICBkZWxlZ2F0ZTogJy5nNS1tbS1wYXJ0aWNsZXMtcGlja2VyIHVsIGxpLCAjbWVudS1lZGl0b3IgPiBzZWN0aW9uIHVsIGxpLCAuc3VibWVudS1jb2x1bW4sIC5zdWJtZW51LWNvbHVtbiBsaSwgLmNvbHVtbi1jb250YWluZXIgLmctYmxvY2snLFxuICAgICAgICBkcm9wcGFibGVzOiAnI21lbnUtZWRpdG9yIFtkYXRhLW1tLWlkXScsXG4gICAgICAgIGV4Y2x1ZGU6ICdbZGF0YS1sbS1ub2RyYWddLCAuZmEtY29nLCAuY29uZmlnLWNvZycsXG4gICAgICAgIHJlc2l6ZV9oYW5kbGVzOiAnLnN1Ym1lbnUtY29sdW1uOm5vdCg6bGFzdC1jaGlsZCknLFxuICAgICAgICBjYXRjaENsaWNrOiB0cnVlXG4gICAgfSk7XG5cblxuICAgIC8vIEhhbmRsZXMgTW9kdWxlcyAvIFBhcnRpY2xlcyBpdGVtcyBpbiB0aGUgTWVudVxuICAgIG1lbnVtYW5hZ2VyLm9uKCdkcmFnRW5kJywgZXh0cmFJdGVtcyk7XG5cbiAgICBtb2R1bGUuZXhwb3J0cy5tZW51bWFuYWdlciA9IG1lbnVtYW5hZ2VyO1xuXG4gICAgLy8gTWVudSBNYW5hZ2VyXG4gICAgbWVudW1hbmFnZXIuc2V0Um9vdCgpO1xuXG4gICAgLy8gUmVmcmVzaCBvcmRlcmluZy9pdGVtcyBvbiBtZW51IHR5cGUgY2hhbmdlIG9yIE1lbnUgbmF2aWdhdGlvbiBsaW5rXG4gICAgYm9keS5kZWxlZ2F0ZSgnc3RhdGVjaGFuZ2VBZnRlcicsICcjbWFpbi1oZWFkZXIgW2RhdGEtZzUtYWpheGlmeV0sIHNlbGVjdC5tZW51LXNlbGVjdC13cmFwJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgbWVudW1hbmFnZXIuc2V0Um9vdCgpO1xuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZShGT0NVU0lOLCAnLnBlcmNlbnRhZ2UgaW5wdXQnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgZWxlbWVudC5jdXJyZW50U2l6ZSA9IE51bWJlcihlbGVtZW50LnZhbHVlKCkpO1xuXG4gICAgICAgIGVsZW1lbnRbMF0uZm9jdXMoKTtcbiAgICAgICAgZWxlbWVudFswXS5zZWxlY3QoKTtcbiAgICB9LCB0cnVlKTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2tleWRvd24nLCAnLnBlcmNlbnRhZ2UgaW5wdXQnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoY29udGFpbnMoWzQ2LCA4LCA5LCAyNywgMTMsIDExMCwgMTkwXSwgZXZlbnQua2V5Q29kZSkgfHxcbiAgICAgICAgICAgICAgICAvLyBBbGxvdzogW0N0cmx8Q21kXStBIHwgW0N0cmx8Q21kXStSXG4gICAgICAgICAgICAoZXZlbnQua2V5Q29kZSA9PSA2NSAmJiAoZXZlbnQuY3RybEtleSA9PT0gdHJ1ZSB8fCBldmVudC5jdHJsS2V5ID09PSB0cnVlKSkgfHxcbiAgICAgICAgICAgIChldmVudC5rZXlDb2RlID09IDgyICYmIChldmVudC5jdHJsS2V5ID09PSB0cnVlIHx8IGV2ZW50Lm1ldGFLZXkgPT09IHRydWUpKSB8fFxuICAgICAgICAgICAgICAgIC8vIEFsbG93OiBob21lLCBlbmQsIGxlZnQsIHJpZ2h0LCBkb3duLCB1cFxuICAgICAgICAgICAgKGV2ZW50LmtleUNvZGUgPj0gMzUgJiYgZXZlbnQua2V5Q29kZSA8PSA0MCkpIHtcbiAgICAgICAgICAgIC8vIGxldCBpdCBoYXBwZW4sIGRvbid0IGRvIGFueXRoaW5nXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gRW5zdXJlIHRoYXQgaXQgaXMgYSBudW1iZXIgYW5kIHN0b3AgdGhlIGtleXByZXNzXG4gICAgICAgIGlmICgoZXZlbnQuc2hpZnRLZXkgfHwgKGV2ZW50LmtleUNvZGUgPCA0OCB8fCBldmVudC5rZXlDb2RlID4gNTcpKSAmJiAoZXZlbnQua2V5Q29kZSA8IDk2IHx8IGV2ZW50LmtleUNvZGUgPiAxMDUpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdrZXlkb3duJywgJy5wZXJjZW50YWdlIGlucHV0JywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciB2YWx1ZSA9IE51bWJlcihlbGVtZW50LnZhbHVlKCkpLFxuICAgICAgICAgICAgbWluID0gTnVtYmVyKGVsZW1lbnQuYXR0cmlidXRlKCdtaW4nKSksXG4gICAgICAgICAgICBtYXggPSBOdW1iZXIoZWxlbWVudC5hdHRyaWJ1dGUoJ21heCcpKSxcbiAgICAgICAgICAgIHVwRG93biA9IGV2ZW50LmtleUNvZGUgPT0gMzggfHwgZXZlbnQua2V5Q29kZSA9PSA0MDtcblxuICAgICAgICBpZiAodXBEb3duKSB7XG4gICAgICAgICAgICB2YWx1ZSArPSBldmVudC5rZXlDb2RlID09IDM4ID8gKzEgOiAtMTtcbiAgICAgICAgICAgIHZhbHVlID0gY2xhbXAodmFsdWUsIG1pbiwgbWF4KTtcbiAgICAgICAgICAgIGVsZW1lbnQudmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgYm9keS5lbWl0KCdrZXl1cCcsIHt0YXJnZXQ6IGVsZW1lbnR9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYm9keS5kZWxlZ2F0ZSgna2V5dXAnLCAnLnBlcmNlbnRhZ2UgaW5wdXQnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIHZhbHVlID0gTnVtYmVyKGVsZW1lbnQudmFsdWUoKSksXG4gICAgICAgICAgICBtaW4gPSBOdW1iZXIoZWxlbWVudC5hdHRyaWJ1dGUoJ21pbicpKSxcbiAgICAgICAgICAgIG1heCA9IE51bWJlcihlbGVtZW50LmF0dHJpYnV0ZSgnbWF4JykpO1xuXG4gICAgICAgIHZhciByZXNpemVyID0gbWVudW1hbmFnZXIucmVzaXplcixcbiAgICAgICAgICAgIHBhcmVudCA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1tbS1pZF0nKSxcbiAgICAgICAgICAgIHNpYmxpbmcgPSBwYXJlbnQubmV4dFNpYmxpbmcoJ1tkYXRhLW1tLWlkXScpIHx8IHBhcmVudC5wcmV2aW91c1NpYmxpbmcoJ1tkYXRhLW1tLWlkXScpO1xuXG4gICAgICAgIGlmICghdmFsdWUgfHwgdmFsdWUgPCBtaW4gfHwgdmFsdWUgPiBtYXgpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdmFyIHNpemVzID0ge1xuICAgICAgICAgICAgY3VycmVudDogTnVtYmVyKGVsZW1lbnQuY3VycmVudFNpemUpLFxuICAgICAgICAgICAgc2libGluZzogTnVtYmVyKHJlc2l6ZXIuZ2V0U2l6ZShzaWJsaW5nKSlcbiAgICAgICAgfTtcblxuICAgICAgICBlbGVtZW50LmN1cnJlbnRTaXplID0gdmFsdWU7XG5cbiAgICAgICAgc2l6ZXMudG90YWwgPSBzaXplcy5jdXJyZW50ICsgc2l6ZXMuc2libGluZztcbiAgICAgICAgc2l6ZXMuZGlmZiA9IHNpemVzLnRvdGFsIC0gdmFsdWU7XG5cbiAgICAgICAgcmVzaXplci5zZXRTaXplKHBhcmVudCwgdmFsdWUpO1xuICAgICAgICByZXNpemVyLnNldFNpemUoc2libGluZywgc2l6ZXMuZGlmZik7XG5cbiAgICAgICAgbWVudW1hbmFnZXIucmVzaXplci51cGRhdGVJdGVtU2l6ZXMocGFyZW50LnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKS5zZWFyY2goJz4gW2RhdGEtbW0taWRdJykpO1xuICAgICAgICBtZW51bWFuYWdlci5lbWl0KCdkcmFnRW5kJywgbWVudW1hbmFnZXIubWFwLCAnaW5wdXRDaGFuZ2UnKTtcbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoRk9DVVNPVVQsICcucGVyY2VudGFnZSBpbnB1dCcsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICB2YXIgdmFsdWUgPSBOdW1iZXIoZWxlbWVudC52YWx1ZSgpKTtcbiAgICAgICAgaWYgKHZhbHVlIDwgTnVtYmVyKGVsZW1lbnQuYXR0cmlidXRlKCdtaW4nKSkgfHwgdmFsdWUgPiBOdW1iZXIoZWxlbWVudC5hdHRyaWJ1dGUoJ21heCcpKSkge1xuICAgICAgICAgICAgZWxlbWVudC52YWx1ZShlbGVtZW50LmN1cnJlbnRTaXplKTtcbiAgICAgICAgfVxuICAgIH0sIHRydWUpO1xuXG4gICAgLy8gQWRkIG5ldyBjb2x1bW5zXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnLmFkZC1jb2x1bW4nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICB2YXIgY29udGFpbmVyID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWc1LW1lbnUtY29sdW1uc10nKS5maW5kKCcuc3VibWVudS1zZWxlY3RvcicpLFxuICAgICAgICAgICAgY2hpbGRyZW4gPSBjb250YWluZXIuY2hpbGRyZW4oKSxcbiAgICAgICAgICAgIGxhc3QgPSBjb250YWluZXIuZmluZCgnPiA6bGFzdC1jaGlsZCcpLFxuICAgICAgICAgICAgY291bnQgPSBjaGlsZHJlbiA/IGNoaWxkcmVuLmxlbmd0aCA6IDAsXG4gICAgICAgICAgICBhY3RpdmUgPSAkKCcubWVudS1zZWxlY3RvciAuYWN0aXZlJyksXG4gICAgICAgICAgICBwYXRoID0gYWN0aXZlID8gYWN0aXZlLmRhdGEoJ21tLWlkJykgOiBudWxsO1xuXG4gICAgICAgIHZhciBibG9jayA9ICQobGFzdFswXS5jbG9uZU5vZGUodHJ1ZSkpO1xuICAgICAgICBibG9jay5kYXRhKCdtbS1pZCcsICdsaXN0LScgKyBjb3VudCk7XG4gICAgICAgIGJsb2NrLmZpbmQoJy5zdWJtZW51LWl0ZW1zJykuZW1wdHkoKTtcbiAgICAgICAgYmxvY2suYWZ0ZXIobGFzdCk7XG5cbiAgICAgICAgbWVudW1hbmFnZXIub3JkZXJpbmdbcGF0aF0ucHVzaChbXSk7XG4gICAgICAgIG1lbnVtYW5hZ2VyLnJlc2l6ZXIuZXZlblJlc2l6ZSgkKCcuc3VibWVudS1zZWxlY3RvciA+IFtkYXRhLW1tLWlkXScpKTtcbiAgICB9KTtcblxuICAgIC8vIEF0dGFjaCBldmVudHMgdG8gcHNldWRvICh4KSBmb3IgZGVsZXRpbmcgYSBjb2x1bW5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nNS1tZW51LWNvbHVtbnNdIC5zdWJtZW51LWl0ZW1zOmVtcHR5JywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGJvdW5kaW5nID0gZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIHggPSBldmVudC5wYWdlWCwgeSA9IGV2ZW50LnBhZ2VZLFxuICAgICAgICAgICAgZGVsZXRlciA9IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogMzYsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAzNlxuICAgICAgICAgICAgfTtcblxuICAgICAgICBpZiAoeCA+PSBib3VuZGluZy5sZWZ0ICsgYm91bmRpbmcud2lkdGggLSBkZWxldGVyLndpZHRoICYmIHggPD0gYm91bmRpbmcubGVmdCArIGJvdW5kaW5nLndpZHRoICYmXG4gICAgICAgICAgICBNYXRoLmFicyh3aW5kb3cuc2Nyb2xsWSAtIHkpIC0gYm91bmRpbmcudG9wIDwgZGVsZXRlci5oZWlnaHQpIHtcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtbW0taWRdJyksXG4gICAgICAgICAgICAgICAgaW5kZXggPSBwYXJlbnQuZGF0YSgnbW0taWQnKS5tYXRjaCgvXFxkKyQvKVswXSxcbiAgICAgICAgICAgICAgICBhY3RpdmUgPSAkKCcubWVudS1zZWxlY3RvciAuYWN0aXZlJyksXG4gICAgICAgICAgICAgICAgcGF0aCA9IGFjdGl2ZSA/IGFjdGl2ZS5kYXRhKCdtbS1pZCcpIDogbnVsbDtcblxuICAgICAgICAgICAgcGFyZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgbWVudW1hbmFnZXIub3JkZXJpbmdbcGF0aF0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIG1lbnVtYW5hZ2VyLnJlc2l6ZXIuZXZlblJlc2l6ZSgkKCcuc3VibWVudS1zZWxlY3RvciA+IFtkYXRhLW1tLWlkXScpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gTWVudSBJdGVtcyBzZXR0aW5nc1xuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJyNtZW51LWVkaXRvciAuY29uZmlnLWNvZywgI21lbnUtZWRpdG9yIC5nbG9iYWwtbWVudS1zZXR0aW5ncycsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdmFyIGRhdGEgPSB7fSwgaXNSb290ID0gZWxlbWVudC5oYXNDbGFzcygnZ2xvYmFsLW1lbnUtc2V0dGluZ3MnKTtcblxuICAgICAgICBpZiAoaXNSb290KSB7XG4gICAgICAgICAgICBkYXRhLnNldHRpbmdzID0gSlNPTi5zdHJpbmdpZnkobWVudW1hbmFnZXIuc2V0dGluZ3MpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF0YS5pdGVtID0gSlNPTi5zdHJpbmdpZnkobWVudW1hbmFnZXIuaXRlbXNbZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpLmRhdGEoJ21tLWlkJyldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcnLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgcmVtb3RlOiAkKGVsZW1lbnQpLmF0dHJpYnV0ZSgnaHJlZicpICsgZ2V0QWpheFN1ZmZpeCgpLFxuICAgICAgICAgICAgcmVtb3RlTG9hZGVkOiBmdW5jdGlvbihyZXNwb25zZSwgY29udGVudCkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWl0ID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2lucHV0W3R5cGU9XCJzdWJtaXRcIl0sIGJ1dHRvblt0eXBlPVwic3VibWl0XCJdJyksXG4gICAgICAgICAgICAgICAgICAgIGRhdGFTdHJpbmcgPSBbXTtcblxuICAgICAgICAgICAgICAgIGlmICghZm9ybSB8fCAhc3VibWl0KSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgICAgICAgICAvLyBNZW51aXRlbXMgU2V0dGluZ3MgYXBwbHlcbiAgICAgICAgICAgICAgICBzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFTdHJpbmcgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICBzdWJtaXQuc2hvd0luZGljYXRvcigpO1xuXG4gICAgICAgICAgICAgICAgICAgICQoZm9ybVswXS5lbGVtZW50cykuZm9yRWFjaChmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSAkKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gaW5wdXQuYXR0cmlidXRlKCduYW1lJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBpbnB1dC52YWx1ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5hbWUpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhU3RyaW5nLnB1c2gobmFtZSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuZmluZCgnW2RhdGEtdGl0bGUtZWRpdGFibGVdJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aXRsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVN0cmluZy5wdXNoKChpc1Jvb3QgPyAnc2V0dGluZ3NbdGl0bGVdJyA6ICd0aXRsZScpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRpdGxlLmRhdGEoJ3RpdGxlLWVkaXRhYmxlJykpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QoZm9ybS5hdHRyaWJ1dGUoJ21ldGhvZCcpLCBmb3JtLmF0dHJpYnV0ZSgnYWN0aW9uJykgKyBnZXRBamF4U3VmZml4KCksIGRhdGFTdHJpbmcuam9pbignJicpLCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmJvZHkucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51bWFuYWdlci5pdGVtc1tyZXNwb25zZS5ib2R5LnBhdGhdID0gcmVzcG9uc2UuYm9keS5pdGVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVtYW5hZ2VyLnNldHRpbmdzID0gcmVzcG9uc2UuYm9keS5zZXR0aW5ncztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuYm9keS5odG1sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtbW0taWRdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpIHsgcGFyZW50Lmh0bWwocmVzcG9uc2UuYm9keS5odG1sKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVtYW5hZ2VyLmVtaXQoJ2RyYWdFbmQnLCBtZW51bWFuYWdlci5tYXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoJ1RoZSBNZW51IEl0ZW0gc2V0dGluZ3MgaGF2ZSBiZWVuIGFwcGxpZWQgdG8gdGhlIE1haW4gTWVudS4gPGJyIC8+UmVtZW1iZXIgdG8gY2xpY2sgdGhlIFNhdmUgYnV0dG9uIHRvIHN0b3JlIHRoZW0uJywgJ1NldHRpbmdzIEFwcGxpZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIG1lbnVtYW5hZ2VyOiBtZW51bWFuYWdlclxufTsiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBwcmltZSAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzJyksXG4gICAgemVuICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgRW1pdHRlciAgID0gcmVxdWlyZSgncHJpbWUvZW1pdHRlcicpLFxuICAgIEJvdW5kICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcbiAgICBEcmFnRHJvcCAgPSByZXF1aXJlKCcuLi91aS9kcmFnLmRyb3AnKSxcbiAgICBSZXNpemVyICAgPSByZXF1aXJlKCcuL2RyYWcucmVzaXplcicpLFxuICAgIGdldCAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2dldCcpLFxuXG4gICAgZXZlcnkgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9ldmVyeScpLFxuICAgIGxhc3QgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvbGFzdCcpLFxuICAgIGluZGV4T2YgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW5kZXhPZicpLFxuICAgIGlzQXJyYXkgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pc0FycmF5JyksXG4gICAgaXNPYmplY3QgID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzT2JqZWN0JyksXG4gICAgZGVlcENsb25lID0gcmVxdWlyZSgnbW91dC9sYW5nL2RlZXBDbG9uZScpLFxuICAgIGVxdWFscyAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2VxdWFscycpO1xuXG5cbnZhciBNZW51TWFuYWdlciA9IG5ldyBwcmltZSh7XG5cbiAgICBtaXhpbjogW0JvdW5kLCBPcHRpb25zXSxcblxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5tYXAgPSB7fTtcbiAgICAgICAgdGhpcy5zZXRSb290KCk7XG5cbiAgICAgICAgdGhpcy5kcmFnZHJvcCA9IG5ldyBEcmFnRHJvcChlbGVtZW50LCBvcHRpb25zLCB0aGlzKTtcbiAgICAgICAgdGhpcy5yZXNpemVyID0gbmV3IFJlc2l6ZXIoZWxlbWVudCwgb3B0aW9ucywgdGhpcyk7XG4gICAgICAgIHRoaXMuZHJhZ2Ryb3BcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6Y2xpY2snLCB0aGlzLmJvdW5kKCdjbGljaycpKVxuICAgICAgICAgICAgLm9uKCdkcmFnZHJvcDpzdGFydCcsIHRoaXMuYm91bmQoJ3N0YXJ0JykpXG4gICAgICAgICAgICAub24oJ2RyYWdkcm9wOm1vdmU6b25jZScsIHRoaXMuYm91bmQoJ21vdmVPbmNlJykpXG4gICAgICAgICAgICAub24oJ2RyYWdkcm9wOmxvY2F0aW9uJywgdGhpcy5ib3VuZCgnbG9jYXRpb24nKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6bm9sb2NhdGlvbicsIHRoaXMuYm91bmQoJ25vbG9jYXRpb24nKSlcbiAgICAgICAgICAgIC5vbignZHJhZ2Ryb3A6cmVzaXplJywgdGhpcy5ib3VuZCgncmVzaXplJykpXG4gICAgICAgICAgICAub24oJ2RyYWdkcm9wOnN0b3AnLCB0aGlzLmJvdW5kKCdzdG9wJykpXG4gICAgICAgICAgICAub24oJ2RyYWdkcm9wOnN0b3A6YW5pbWF0aW9uJywgdGhpcy5ib3VuZCgnc3RvcEFuaW1hdGlvbicpKTtcblxuICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMub3JkZXJpbmcsIHRoaXMuaXRlbXMpO1xuICAgIH0sXG5cbiAgICBzZXRSb290OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5yb290ID0gJCgnI21lbnUtZWRpdG9yJyk7XG5cbiAgICAgICAgaWYgKHRoaXMucm9vdCkge1xuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncyA9IEpTT04ucGFyc2UodGhpcy5yb290LmRhdGEoJ21lbnUtc2V0dGluZ3MnKSk7XG4gICAgICAgICAgICB0aGlzLm9yZGVyaW5nID0gSlNPTi5wYXJzZSh0aGlzLnJvb3QuZGF0YSgnbWVudS1vcmRlcmluZycpKTtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBKU09OLnBhcnNlKHRoaXMucm9vdC5kYXRhKCdtZW51LWl0ZW1zJykpO1xuXG4gICAgICAgICAgICB0aGlzLm1hcCA9IHtcbiAgICAgICAgICAgICAgICBzZXR0aW5nczogZGVlcENsb25lKHRoaXMuc2V0dGluZ3MpLFxuICAgICAgICAgICAgICAgIG9yZGVyaW5nOiBkZWVwQ2xvbmUodGhpcy5vcmRlcmluZyksXG4gICAgICAgICAgICAgICAgaXRlbXM6IGRlZXBDbG9uZSh0aGlzLml0ZW1zKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHN1Ym1lbnVzID0gJCgnW2RhdGEtZzUtbWVudS1jb2x1bW5zXSAuc3VibWVudS1zZWxlY3RvcicpLCBjb2x1bW5zO1xuICAgICAgICAgICAgaWYgKHRoaXMucmVzaXplciAmJiBzdWJtZW51cyAmJiAoY29sdW1ucyA9IHN1Ym1lbnVzLnNlYXJjaCgnPiBbZGF0YS1tbS1pZF0nKSkpIHsgdGhpcy5yZXNpemVyLnVwZGF0ZU1heFZhbHVlcyhjb2x1bW5zKTsgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNsaWNrOiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5oYXNDbGFzcygnZy1ibG9jaycpKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BBbmltYXRpb24oKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG1lbnVJdGVtID0gZWxlbWVudC5maW5kKCc+IC5tZW51LWl0ZW0nKTtcbiAgICAgICAgaWYgKG1lbnVJdGVtICYmIG1lbnVJdGVtLnRhZygpID09ICdzcGFuJykge1xuICAgICAgICAgICAgdGhpcy5zdG9wQW5pbWF0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzaWJsaW5ncyA9IGVsZW1lbnQuc2libGluZ3MoKTtcbiAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIGlmIChzaWJsaW5ncykgeyBzaWJsaW5ncy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7IH1cbiAgICAgICAgZWxlbWVudC5lbWl0KCdjbGljaycpO1xuXG4gICAgICAgIHZhciBsaW5rID0gZWxlbWVudC5maW5kKCdhJyk7XG4gICAgICAgIGlmIChsaW5rKSB7IGxpbmtbMF0uY2xpY2soKTsgfVxuICAgIH0sXG5cbiAgICByZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50LCBzaWJsaW5ncywgb2Zmc2V0KSB7XG4gICAgICAgIHRoaXMucmVzaXplci5zdGFydChldmVudCwgZWxlbWVudCwgc2libGluZ3MsIG9mZnNldCk7XG4gICAgfSxcblxuICAgIHN0YXJ0OiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgcm9vdCA9IGVsZW1lbnQucGFyZW50KCcubWVudS1zZWxlY3RvcicpIHx8IGVsZW1lbnQucGFyZW50KCcuc3VibWVudS1jb2x1bW4nKSB8fCBlbGVtZW50LnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKSB8fCBlbGVtZW50LnBhcmVudCgnLmc1LW1tLXBhcnRpY2xlcy1waWNrZXInKSxcbiAgICAgICAgICAgIHNpemUgPSAkKGVsZW1lbnQpLnBvc2l0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5ibG9jayA9IG51bGw7XG4gICAgICAgIHRoaXMudGFyZ2V0TGV2ZWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYWRkTmV3SXRlbSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnR5cGUgPSAgZWxlbWVudC5wYXJlbnQoJy5nLXRvcGxldmVsJykgfHwgZWxlbWVudC5tYXRjaGVzKCcuZy10b3BsZXZlbCcpID8gJ21haW4nIDogKGVsZW1lbnQubWF0Y2hlcygnLmctYmxvY2snKSA/ICdjb2x1bW4nIDogJ2NvbHVtbnNfaXRlbXMnKTtcbiAgICAgICAgdGhpcy5pc1BhcnRpY2xlID0gZWxlbWVudC5tYXRjaGVzKCdbZGF0YS1tbS1ibG9ja3R5cGVdJykgfHwgZWxlbWVudC5tYXRjaGVzKCdbZGF0YS1tbS1vcmlnaW5hbC10eXBlXScpO1xuICAgICAgICB0aGlzLndhc0FjdGl2ZSA9IGVsZW1lbnQuaGFzQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICB0aGlzLmlzTmV3UGFydGljbGUgPSBlbGVtZW50LnBhcmVudCgnLmc1LW1tLXBhcnRpY2xlcy1waWNrZXInKTtcbiAgICAgICAgdGhpcy5QYXJ0aWNsZUluZGV4ID0gLTE7XG4gICAgICAgIHRoaXMucm9vdCA9IHJvb3Q7XG5cbiAgICAgICAgdGhpcy5pdGVtSUQgPSBlbGVtZW50LmRhdGEoJ21tLWlkJyk7XG4gICAgICAgIHRoaXMuaXRlbUxldmVsID0gZWxlbWVudC5kYXRhKCdtbS1sZXZlbCcpO1xuICAgICAgICB0aGlzLml0ZW1Gcm9tID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpO1xuICAgICAgICB0aGlzLml0ZW1UbyA9IG51bGw7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNQYXJ0aWNsZSAmJiAhdGhpcy5pc05ld1BhcnRpY2xlKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBlbGVtZW50LnBhcmVudCgpLmNoaWxkcmVuKCdbZGF0YS1tbS1pZF0nKTtcbiAgICAgICAgICAgIHRoaXMuUGFydGljbGVJbmRleCA9IGluZGV4T2YoY2hpbGRyZW4sIGVsZW1lbnRbMF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcm9vdC5hZGRDbGFzcygnbW92aW5nJyk7XG5cbiAgICAgICAgdmFyIHR5cGUgPSAkKGVsZW1lbnQpLmRhdGEoJ21tLWlkJyksXG4gICAgICAgICAgICBjbG9uZSA9IGVsZW1lbnRbMF0uY2xvbmVOb2RlKHRydWUpO1xuXG4gICAgICAgIGlmICghdGhpcy5wbGFjZWhvbGRlcikgeyB0aGlzLnBsYWNlaG9sZGVyID0gemVuKCh0aGlzLnR5cGUgPT0gJ2NvbHVtbicgPyAnZGl2JyA6ICdsaScpICsgJy5ibG9jay5wbGFjZWhvbGRlcltkYXRhLW1tLXBsYWNlaG9sZGVyXScpOyB9XG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSk7XG4gICAgICAgIHRoaXMub3JpZ2luYWwgPSAkKGNsb25lKS5hZnRlcihlbGVtZW50KS5zdHlsZSh7XG4gICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgfSkuYWRkQ2xhc3MoJ29yaWdpbmFsLXBsYWNlaG9sZGVyJykuZGF0YSgnbG0tZHJvcHpvbmUnLCBudWxsKTtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLmJsb2NrID0gZWxlbWVudDtcblxuICAgICAgICBpZiAoIXRoaXMuaXNOZXdQYXJ0aWNsZSkge1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZSh7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgICAgekluZGV4OiAxMDAwLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwoc2l6ZS53aWR0aCksXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwoc2l6ZS5oZWlnaHQpXG4gICAgICAgICAgICB9KS5hZGRDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIuYmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gZWxlbWVudC5wb3NpdGlvbigpLFxuICAgICAgICAgICAgICAgIHBhcmVudE9mZnNldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBlbGVtZW50LnBhcmVudCgpWzBdLnNjcm9sbFRvcCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogZWxlbWVudC5wYXJlbnQoKVswXS5zY3JvbGxMZWZ0XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWwuc3R5bGUoe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNVxuICAgICAgICAgICAgfSkuc3R5bGUoe1xuICAgICAgICAgICAgICAgIGxlZnQ6IGVsZW1lbnRbMF0ub2Zmc2V0TGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0LFxuICAgICAgICAgICAgICAgIHRvcDogZWxlbWVudFswXS5vZmZzZXRUb3AgLSBwYXJlbnRPZmZzZXQudG9wLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBwb3NpdGlvbi53aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHBvc2l0aW9uLmhlaWdodFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmRyYWdkcm9wLmVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmJsb2NrID0gdGhpcy5kcmFnZHJvcC5lbGVtZW50O1xuICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5lbGVtZW50ID0gdGhpcy5vcmlnaW5hbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT0gJ2NvbHVtbicpIHtcbiAgICAgICAgICAgIHJvb3Quc2VhcmNoKCcuZy1ibG9jayA+IConKS5zdHlsZSh7ICdwb2ludGVyLWV2ZW50cyc6ICdub25lJyB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBtb3ZlT25jZTogZnVuY3Rpb24oLyplbGVtZW50Ki8pIHtcbiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWwpIHsgdGhpcy5vcmlnaW5hbC5zdHlsZSh7IG9wYWNpdHk6IDAuNSB9KTsgfVxuICAgIH0sXG5cbiAgICBsb2NhdGlvbjogZnVuY3Rpb24oZXZlbnQsIGxvY2F0aW9uLCB0YXJnZXQvKiwgZWxlbWVudCovKSB7XG4gICAgICAgIHRhcmdldCA9ICQodGFyZ2V0KTtcbiAgICAgICAgaWYgKCF0aGlzLnBsYWNlaG9sZGVyKSB7IHRoaXMucGxhY2Vob2xkZXIgPSB6ZW4oKHRoaXMudHlwZSA9PSAnY29sdW1uJyA/ICdkaXYnIDogJ2xpJykgKyAnLmJsb2NrLnBsYWNlaG9sZGVyW2RhdGEtbW0tcGxhY2Vob2xkZXJdJykuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSk7IH1cblxuICAgICAgICB2YXIgdGFyZ2V0VHlwZSA9IHRhcmdldC5wYXJlbnQoJy5nLXRvcGxldmVsJykgfHwgdGFyZ2V0Lm1hdGNoZXMoJy5nLXRvcGxldmVsJykgPyAnbWFpbicgOiAodGFyZ2V0Lm1hdGNoZXMoJy5nLWJsb2NrJykgPyAnY29sdW1uJyA6ICdjb2x1bW5zX2l0ZW1zJyksXG4gICAgICAgICAgICBkYXRhTGV2ZWwgPSB0YXJnZXQuZGF0YSgnbW0tbGV2ZWwnKSxcbiAgICAgICAgICAgIG9yaWdpbmFsTGV2ZWwgPSB0aGlzLmJsb2NrLmRhdGEoJ21tLWxldmVsJyk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNQYXJ0aWNsZSAmJiAodGFyZ2V0VHlwZSA9PT0gJ21haW4nICYmICFkYXRhTGV2ZWwpKSB7XG4gICAgICAgICAgICB0aGlzLmRyYWdkcm9wLm1hdGNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdvcmthcm91bmQgZm9yIGxheW91dCBhbmQgc3R5bGUgb2YgY29sdW1uc1xuICAgICAgICBpZiAoZGF0YUxldmVsID09PSBudWxsICYmICh0aGlzLnR5cGUgPT09ICdjb2x1bW5zX2l0ZW1zJyB8fCB0aGlzLmlzUGFydGljbGUpKSB7XG4gICAgICAgICAgICB2YXIgc3VibWVudV9pdGVtcyA9IHRhcmdldC5maW5kKCcuc3VibWVudS1pdGVtcycpO1xuICAgICAgICAgICAgaWYgKCFzdWJtZW51X2l0ZW1zIHx8IHN1Ym1lbnVfaXRlbXMuY2hpbGRyZW4oKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2Ryb3AubWF0Y2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlci5zdHlsZSh7IGRpc3BsYXk6ICdibG9jaycgfSkuYm90dG9tKHN1Ym1lbnVfaXRlbXMpO1xuICAgICAgICAgICAgdGhpcy5hZGROZXdJdGVtID0gc3VibWVudV9pdGVtcztcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0TGV2ZWwgPSAyO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAoIXRoaXMuaXNQYXJ0aWNsZSkge1xuXG4gICAgICAgICAgICAvLyBXZSBvbmx5IGFsbG93IHNvcnRpbmcgYmV0d2VlbiBzYW1lIGxldmVsIGl0ZW1zXG4gICAgICAgICAgICBpZiAodGhpcy50eXBlICE9PSAnY29sdW1uJyAmJiBvcmlnaW5hbExldmVsICE9PSBkYXRhTGV2ZWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdkcm9wLm1hdGNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEVuc3VyaW5nIGNvbHVtbnMgY2FuIG9ubHkgYmUgZHJhZ2dlZCBiZWZvcmUvYWZ0ZXIgb3RoZXIgY29sdW1uc1xuICAgICAgICAgICAgaWYgKHRoaXMudHlwZSA9PSAnY29sdW1uJyAmJiBkYXRhTGV2ZWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdkcm9wLm1hdGNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZvciBsZXZlbHMgPiAyIHdlIG9ubHkgYWxsb3cgc29ydGluZyB3aXRoaW4gdGhlIHNhbWUgY29sdW1uXG4gICAgICAgICAgICBpZiAoZGF0YUxldmVsID4gMiAmJiB0YXJnZXQucGFyZW50KCd1bCcpICE9IHRoaXMuYmxvY2sucGFyZW50KCd1bCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnZHJvcC5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgZm9yIGFkamFjZW50cyBhbmQgYXZvaWQgaW5zZXJ0aW5nIGFueSBwbGFjZWhvbGRlciBzaW5jZSBpdCB3b3VsZCBiZSB0aGUgc2FtZSBwb3NpdGlvblxuICAgICAgICB2YXIgZXhjbHVkZSA9ICc6bm90KC5wbGFjZWhvbGRlcik6bm90KFtkYXRhLW1tLWlkPVwiJyArIHRoaXMub3JpZ2luYWwuZGF0YSgnbW0taWQnKSArICdcIl0pJyxcbiAgICAgICAgICAgIGFkamFjZW50cyA9IHtcbiAgICAgICAgICAgICAgICBiZWZvcmU6IHRoaXMub3JpZ2luYWwucHJldmlvdXNTaWJsaW5ncyhleGNsdWRlKSxcbiAgICAgICAgICAgICAgICBhZnRlcjogdGhpcy5vcmlnaW5hbC5uZXh0U2libGluZ3MoZXhjbHVkZSlcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgaWYgKGFkamFjZW50cy5iZWZvcmUpIHsgYWRqYWNlbnRzLmJlZm9yZSA9ICQoYWRqYWNlbnRzLmJlZm9yZVswXSk7IH1cbiAgICAgICAgaWYgKGFkamFjZW50cy5hZnRlcikgeyBhZGphY2VudHMuYWZ0ZXIgPSAkKGFkamFjZW50cy5hZnRlclswXSk7IH1cblxuXG4gICAgICAgIGlmICh0YXJnZXRUeXBlID09PSAnbWFpbicgJiYgKChhZGphY2VudHMuYmVmb3JlID09PSB0YXJnZXQgJiYgbG9jYXRpb24ueCA9PT0gJ2FmdGVyJykgfHwgKGFkamFjZW50cy5hZnRlciA9PT0gdGFyZ2V0ICYmIGxvY2F0aW9uLnggPT09ICdiZWZvcmUnKSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PT0gJ2NvbHVtbicgJiYgKChhZGphY2VudHMuYmVmb3JlID09PSB0YXJnZXQgJiYgbG9jYXRpb24ueCA9PT0gJ2FmdGVyJykgfHwgKGFkamFjZW50cy5hZnRlciA9PT0gdGFyZ2V0ICYmIGxvY2F0aW9uLnggPT09ICdiZWZvcmUnKSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PT0gJ2NvbHVtbnNfaXRlbXMnICYmICgoYWRqYWNlbnRzLmJlZm9yZSA9PT0gdGFyZ2V0ICYmIGxvY2F0aW9uLnkgPT09ICdiZWxvdycpIHx8IChhZGphY2VudHMuYWZ0ZXIgPT09IHRhcmdldCAmJiBsb2NhdGlvbi55ID09PSAnYWJvdmUnKSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZXMgdGhlIHR5cGVzIGNhc2VzIGFuZCBub3JtYWxpemVzIHRoZSBsb2NhdGlvbnMgKHggYW5kIHkpXG4gICAgICAgIHN3aXRjaCAodGFyZ2V0VHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnbWFpbic6XG4gICAgICAgICAgICBjYXNlICdjb2x1bW4nOlxuICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXJbbG9jYXRpb24ueF0odGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2NvbHVtbnNfaXRlbXMnOlxuICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXJbbG9jYXRpb24ueSA9PT0gJ2Fib3ZlJyA/ICdiZWZvcmUnIDogJ2FmdGVyJ10odGFyZ2V0KTtcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50YXJnZXRMZXZlbCA9IGRhdGFMZXZlbDtcblxuICAgICAgICAvLyBJZiBpdCdzIG5vdCBhIGJsb2NrIHdlIGRvbid0IHdhbnQgYSBzbWFsbCB2ZXJzaW9uIG9mIHRoZSBwbGFjZWhvbGRlclxuICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnN0eWxlKHsgZGlzcGxheTogJ2Jsb2NrJyB9KVt0YXJnZXRUeXBlICE9PSAnbWFpbicgPyAncmVtb3ZlQ2xhc3MnIDogJ2FkZENsYXNzJ10oJ2luLWJldHdlZW4nKTtcblxuICAgIH0sXG5cbiAgICBub2xvY2F0aW9uOiBmdW5jdGlvbigvKmV2ZW50Ki8pIHtcbiAgICAgICAgaWYgKHRoaXMucGxhY2Vob2xkZXIpIHsgdGhpcy5wbGFjZWhvbGRlci5yZW1vdmUoKTsgfVxuICAgICAgICB0aGlzLnRhcmdldExldmVsID0gdW5kZWZpbmVkO1xuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbihldmVudCwgdGFyZ2V0LCBlbGVtZW50KSB7XG4gICAgICAgIHRhcmdldCA9ICQodGFyZ2V0KTtcbiAgICAgICAgaWYgKHRhcmdldCkgeyBlbGVtZW50LnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsgfVxuICAgICAgICBpZiAodGhpcy50eXBlID09ICdjb2x1bW4nKSB7XG4gICAgICAgICAgICB0aGlzLnJvb3Quc2VhcmNoKCcuZy1ibG9jayA+IConKS5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuZHJhZ2Ryb3AubWF0Y2hlZCAmJiAhdGhpcy5hZGROZXdJdGVtKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgeyB0aGlzLnBsYWNlaG9sZGVyLnJlbW92ZSgpOyB9XG5cbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0TGV2ZWwgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNQYXJ0aWNsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwbGFjZWhvbGRlclBhcmVudCA9IHRoaXMucGxhY2Vob2xkZXIucGFyZW50KCk7XG4gICAgICAgIGlmICghcGxhY2Vob2xkZXJQYXJlbnQpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0TGV2ZWwgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNQYXJ0aWNsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmFkZE5ld0l0ZW0pIHsgdGhpcy5ibG9jay5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOyB9XG5cbiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuYmxvY2sucGFyZW50KCk7XG5cbiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWwpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc05ld1BhcnRpY2xlKSB7IHRoaXMub3JpZ2luYWwucmVtb3ZlKCk7IH1cbiAgICAgICAgICAgIGVsc2UgeyB0aGlzLm9yaWdpbmFsLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKS5yZW1vdmVDbGFzcygnb3JpZ2luYWwtcGxhY2Vob2xkZXInKTsgfVxuICAgICAgICB9XG5cblxuICAgICAgICB0aGlzLmJsb2NrLmFmdGVyKHRoaXMucGxhY2Vob2xkZXIpO1xuICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLml0ZW1UbyA9IHRoaXMuYmxvY2sucGFyZW50KCdbZGF0YS1tbS1pZF0nKTtcbiAgICAgICAgdGhpcy5jdXJyZW50TGV2ZWwgPSB0aGlzLml0ZW1MZXZlbDtcbiAgICAgICAgaWYgKHRoaXMud2FzQWN0aXZlKSB7IGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpOyB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNQYXJ0aWNsZSkge1xuICAgICAgICAgICAgdmFyIGlkID0gbGFzdCh0aGlzLml0ZW1JRC5zcGxpdCgnLycpKSxcbiAgICAgICAgICAgICAgICB0YXJnZXRJdGVtID0gKHRhcmdldCB8fCB0aGlzLml0ZW1UbyksXG4gICAgICAgICAgICAgICAgYmFzZSA9IHRhcmdldEl0ZW1bdGFyZ2V0ID8gJ3BhcmVudCcgOiAnZmluZCddKCdbZGF0YS1tbS1iYXNlXScpLmRhdGEoJ21tLWJhc2UnKTtcblxuICAgICAgICAgICAgdGhpcy5pdGVtSUQgPSBiYXNlID8gYmFzZSArICcvJyArIGlkIDogaWQ7XG4gICAgICAgICAgICB0aGlzLml0ZW1MZXZlbCA9IHRoaXMudGFyZ2V0TGV2ZWw7XG4gICAgICAgICAgICB0aGlzLmJsb2NrLmRhdGEoJ21tLWlkJywgdGhpcy5pdGVtSUQpLmRhdGEoJ21tLWxldmVsJywgdGhpcy50YXJnZXRMZXZlbCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcGF0aCA9IHRoaXMuaXRlbUlELnNwbGl0KCcvJyksXG4gICAgICAgICAgICBpdGVtcywgY29sdW1uO1xuXG4gICAgICAgIHBhdGguc3BsaWNlKHRoaXMuaXRlbUxldmVsIC0gMSk7XG4gICAgICAgIHBhdGggPSBwYXRoLmpvaW4oJy8nKTtcblxuICAgICAgICAvLyBJdGVtcyByZW9yZGVyIGZvciByb290IG9yIHN1YmxldmVscyB3aXRoIGxvZ2ljIHRvIHJlb3JkZXIgRlJPTSBhbmQgVE8gc3VibGV2ZWwgY29sdW1uIGlmIG5lZWRlZFxuICAgICAgICBpZiAodGhpcy5pdGVtRnJvbSB8fCB0aGlzLml0ZW1Ubykge1xuICAgICAgICAgICAgdmFyIHNvdXJjZXMgPSB0aGlzLml0ZW1Gcm9tID09IHRoaXMuaXRlbVRvID8gW3RoaXMuaXRlbUZyb21dIDogW3RoaXMuaXRlbUZyb20sIHRoaXMuaXRlbVRvXTtcbiAgICAgICAgICAgIHNvdXJjZXMuZm9yRWFjaChmdW5jdGlvbihzb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXNvdXJjZSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgICAgIGl0ZW1zID0gc291cmNlLnNlYXJjaCgnW2RhdGEtbW0taWRdJyk7XG4gICAgICAgICAgICAgICAgY29sdW1uID0gTnVtYmVyKHRoaXMuYmxvY2suZGF0YSgnbW0tbGV2ZWwnKSA+IDIgPyAwIDogKHNvdXJjZS5kYXRhKCdtbS1pZCcpLm1hdGNoKC9cXGQrJC8pIHx8IFswXSlbMF0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9yZGVyaW5nW3BhdGhdW2NvbHVtbl0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGl0ZW1zID0gaXRlbXMubWFwKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQoZWxlbWVudCkuZGF0YSgnbW0taWQnKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMub3JkZXJpbmdbcGF0aF1bY29sdW1uXSA9IGl0ZW1zO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIC8vIFJlZnJlc2ggdGhlIG9yaWdpbiBpZiBpdCdzIGEgcGFydGljbGVcbiAgICAgICAgICAgIGJhc2UgPSB0aGlzLml0ZW1Gcm9tID8gKHRoaXMuaXRlbUZyb20uYXR0cmlidXRlKCdkYXRhLW1tLWJhc2UnKSAhPT0gbnVsbCA/IHRoaXMuaXRlbUZyb20gOiB0aGlzLml0ZW1Gcm9tLmZpbmQoJ1tkYXRhLW1tLWJhc2VdJykpIDogbnVsbDtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzUGFydGljbGUgJiYgYmFzZSAmJiB0aGlzLnRhcmdldExldmVsICE9IHRoaXMuY3VycmVudExldmVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxpc3QgPSAodGhpcy5pdGVtRnJvbS5kYXRhKCdtbS1pZCcpLm1hdGNoKC9cXGQrJC8pIHx8IFswXSlbMF07XG4gICAgICAgICAgICAgICAgdGhpcy5vcmRlcmluZ1tiYXNlLmRhdGEoJ21tLWJhc2UnKSB8fCAnJ11bbGlzdF0uc3BsaWNlKHRoaXMuUGFydGljbGVJbmRleCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDb2x1bW4gcmVvcmRlcmluZywgd2UganVzdCBuZWVkIHRvIHN3YXAgdGhlIGFycmF5IGluZGV4ZXNcbiAgICAgICAgaWYgKCF0aGlzLml0ZW1Gcm9tICYmICF0aGlzLml0ZW1UbyAmJiAhdGhpcy5pc1BhcnRpY2xlKSB7XG4gICAgICAgICAgICB2YXIgY29sc09yZGVyID0gW10sXG4gICAgICAgICAgICAgICAgYWN0aXZlID0gJCgnLmctdG9wbGV2ZWwgW2RhdGEtbW0taWRdLmFjdGl2ZScpLmRhdGEoJ21tLWlkJyk7XG4gICAgICAgICAgICBpdGVtcyA9IHBhcmVudC5zZWFyY2goJz4gW2RhdGEtbW0taWRdJyk7XG5cbiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICAgICAgICAgIHZhciBpZCA9IGVsZW1lbnQuZGF0YSgnbW0taWQnKSxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uID0gTnVtYmVyKChpZC5tYXRjaCgvXFxkKyQvKSB8fCBbMF0pWzBdKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YSgnbW0taWQnLCBpZC5yZXBsYWNlKC9cXGQrJC8sIGluZGV4KSk7XG4gICAgICAgICAgICAgICAgY29sc09yZGVyLnB1c2godGhpcy5vcmRlcmluZ1thY3RpdmVdW2NvbHVtbl0pO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIHRoaXMub3JkZXJpbmdbYWN0aXZlXSA9IGNvbHNPcmRlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghcGFyZW50LmNoaWxkcmVuKCkpIHsgcGFyZW50LmVtcHR5KCk7IH1cblxuICAgICAgICAvKmlmIChjb25zb2xlICYmIGNvbnNvbGUuZ3JvdXAgJiYgY29uc29sZS5pbmZvICYmIGNvbnNvbGUudGFibGUgJiYgY29uc29sZS5ncm91cEVuZCkge1xuICAgICAgICAgY29uc29sZS5ncm91cCgpO1xuICAgICAgICAgY29uc29sZS5pbmZvKCdOZXcgT3JkZXJpbmcnKTtcbiAgICAgICAgIGNvbnNvbGUudGFibGUodGhpcy5vcmRlcmluZyk7XG4gICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICB9Ki9cblxuICAgICAgICB2YXIgc2VsZWN0b3IgPSB0aGlzLmJsb2NrLnBhcmVudCgnLnN1Ym1lbnUtc2VsZWN0b3InKTtcbiAgICAgICAgaWYgKHNlbGVjdG9yKSB7IHRoaXMucmVzaXplci51cGRhdGVJdGVtU2l6ZXMoc2VsZWN0b3Iuc2VhcmNoKCc+IFtkYXRhLW1tLWlkXScpKTsgfVxuXG4gICAgICAgIHRoaXMuZW1pdCgnZHJhZ0VuZCcsIHRoaXMubWFwLCAncmVvcmRlcicpO1xuICAgIH0sXG5cbiAgICBzdG9wQW5pbWF0aW9uOiBmdW5jdGlvbigvKmVsZW1lbnQqLykge1xuICAgICAgICB2YXIgZmxleCA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT0gJ2NvbHVtbicpIHsgZmxleCA9IHRoaXMucmVzaXplci5nZXRTaXplKHRoaXMuYmxvY2spOyB9XG4gICAgICAgIGlmICh0aGlzLnJvb3QpIHsgdGhpcy5yb290LnJlbW92ZUNsYXNzKCdtb3ZpbmcnKTsgfVxuICAgICAgICBpZiAodGhpcy5ibG9jaykge1xuICAgICAgICAgICAgdGhpcy5ibG9jay5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCk7XG4gICAgICAgICAgICBpZiAoZmxleCkgeyB0aGlzLmJsb2NrLnN0eWxlKCdmbGV4JywgJzAgMSAnICsgZmxleCArICcgJScpOyB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vcmlnaW5hbCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzTmV3UGFydGljbGUgfHwgKCF0aGlzLmRyYWdkcm9wLm1hdGNoZWQgJiYgIXRoaXMudGFyZ2V0TGV2ZWwpKSB7IHRoaXMub3JpZ2luYWwucmVtb3ZlKCk7IH1cbiAgICAgICAgICAgIGVsc2UgeyB0aGlzLm9yaWdpbmFsLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKS5yZW1vdmVDbGFzcygnb3JpZ2luYWwtcGxhY2Vob2xkZXInKTsgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLndhc0FjdGl2ZSAmJiB0aGlzLmJsb2NrKSB7IHRoaXMuYmxvY2sucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOyB9XG4gICAgfVxufSk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSBNZW51TWFuYWdlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcmVhZHkgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgJCAgICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgemVuICAgICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91aScpLm1vZGFsLFxuICAgIHRvYXN0ciAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91aScpLnRvYXN0cixcbiAgICByZXF1ZXN0ICAgICAgID0gcmVxdWlyZSgnYWdlbnQnKSxcbiAgICBsYXN0SXRlbSAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9sYXN0JyksXG4gICAgaW5kZXhPZiAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW5kZXhPZicpLFxuICAgIHNpbXBsZVNvcnQgICAgPSByZXF1aXJlKCdzb3J0YWJsZWpzJyksXG5cbiAgICB0cmltICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvdHJpbScpLFxuXG4gICAgZ2V0QWpheFN1ZmZpeCA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2dldC1hamF4LXN1ZmZpeCcpO1xuXG5yZXF1aXJlKCdlbGVtZW50cy9pbnNlcnRpb24nKTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICB2YXIgYWRkTmV3QnlFbnRlciA9IGZ1bmN0aW9uKHRpdGxlLCBrZXkpIHtcbiAgICAgICAgaWYgKGtleSA9PSAnZW50ZXInICYmIHRoaXMuQ29sbGVjdGlvbk5ldykge1xuICAgICAgICAgICAgdGhpcy5Db2xsZWN0aW9uTmV3ID0gZmFsc2U7XG4gICAgICAgICAgICBib2R5LmVtaXQoJ2NsaWNrJywgeyB0YXJnZXQ6IHRoaXMucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWFkZG5ld10nKSB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChrZXkgPT0gJ2VzYycgJiYgdGhpcy5Db2xsZWN0aW9uTmV3KSB7XG4gICAgICAgICAgICB0aGlzLkNvbGxlY3Rpb25OZXcgPSBmYWxzZTtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogdGhpcy5wYXJlbnQoJ1tkYXRhLWNvbGxlY3Rpb24taXRlbV0nKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLXJlbW92ZV0nKSB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgY3JlYXRlU29ydGFibGVzID0gZnVuY3Rpb24obGlzdCkge1xuICAgICAgICB2YXIgbGlzdHMgPSBsaXN0IHx8ICQoJy5jb2xsZWN0aW9uLWxpc3QgdWwnKTtcbiAgICAgICAgaWYgKCFsaXN0cykgeyByZXR1cm47IH1cbiAgICAgICAgbGlzdHMuZm9yRWFjaChmdW5jdGlvbihsaXN0KSB7XG4gICAgICAgICAgICBsaXN0ID0gJChsaXN0KTtcbiAgICAgICAgICAgIGxpc3QuU2ltcGxlU29ydCA9IHNpbXBsZVNvcnQuY3JlYXRlKGxpc3RbMF0sIHtcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICcuZmEtcmVvcmRlcicsXG4gICAgICAgICAgICAgICAgZmlsdGVyOiAnW2RhdGEtY29sbGVjdGlvbi1ub3NvcnRdJyxcbiAgICAgICAgICAgICAgICBzY3JvbGw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogMTUwLFxuICAgICAgICAgICAgICAgIG9uU3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMuZWwpLmFkZENsYXNzKCdjb2xsZWN0aW9uLXNvcnRpbmcnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uRW5kOiBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKHRoaXMuZWwpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdjb2xsZWN0aW9uLXNvcnRpbmcnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZ0Lm9sZEluZGV4ID09PSBldnQubmV3SW5kZXgpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFGaWVsZCA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWRhdGFdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhICAgICAgPSBkYXRhRmllbGQudmFsdWUoKTtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNwbGljZShldnQubmV3SW5kZXgsIDAsIGRhdGEuc3BsaWNlKGV2dC5vbGRJbmRleCwgMSlbMF0pO1xuICAgICAgICAgICAgICAgICAgICBkYXRhRmllbGQudmFsdWUoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjcmVhdGVTb3J0YWJsZXMoKTtcblxuICAgIC8vIGRlbGVnYXRlIHNvcnRhYmxlcyBjb2xsZWN0aW9ucyBmb3IgYWpheCBzdXBwb3J0XG4gICAgYm9keS5kZWxlZ2F0ZSgnbW91c2VvdmVyJywgJy5jb2xsZWN0aW9uLWxpc3QgdWwnLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoIWVsZW1lbnQuU2ltcGxlU29ydCkgeyBjcmVhdGVTb3J0YWJsZXMoZWxlbWVudCk7IH1cbiAgICB9KTtcblxuICAgIC8vIEFkZCBuZXcgaXRlbVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWNvbGxlY3Rpb24tYWRkbmV3XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBwYXJhbSAgICAgPSBlbGVtZW50LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtJyksXG4gICAgICAgICAgICBsaXN0ICAgICAgPSBwYXJhbS5maW5kKCd1bCcpLFxuICAgICAgICAgICAgZWRpdGFsbCAgID0gbGlzdC5wYXJlbnQoKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWVkaXRhbGxdJyksXG4gICAgICAgICAgICBkYXRhRmllbGQgPSBwYXJhbS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWRhdGFdJyksXG4gICAgICAgICAgICB0bXBsICAgICAgPSBwYXJhbS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLXRlbXBsYXRlXScpLFxuICAgICAgICAgICAgaXRlbXMgICAgID0gbGlzdC5zZWFyY2goJz4gW2RhdGEtY29sbGVjdGlvbi1pdGVtXScpIHx8IFtdLFxuICAgICAgICAgICAgbGFzdCAgICAgID0gJChsYXN0SXRlbShpdGVtcykpO1xuXG4gICAgICAgIHZhciBjbG9uZSA9ICQodG1wbFswXS5jbG9uZU5vZGUodHJ1ZSkpLCB0aXRsZSwgZWRpdGFibGU7XG5cbiAgICAgICAgaWYgKGxhc3QpIHsgY2xvbmUuYWZ0ZXIobGFzdCk7IH1cbiAgICAgICAgZWxzZSB7IGNsb25lLnRvcChsaXN0KTsgfVxuXG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggJiYgZWRpdGFsbCkgeyBlZGl0YWxsLnN0eWxlKCdkaXNwbGF5JywgJ2lubGluZS1ibG9jaycpOyB9XG5cbiAgICAgICAgdGl0bGUgPSBjbG9uZS5maW5kKCdhJyk7XG4gICAgICAgIGVkaXRhYmxlID0gdGl0bGUuZmluZCgnW2RhdGEtdGl0bGUtZWRpdGFibGVdJyk7XG5cbiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgnJWlkJScsICdnJyk7XG4gICAgICAgIHRpdGxlLmhyZWYodGl0bGUuaHJlZigpLnJlcGxhY2UocmUsIGl0ZW1zLmxlbmd0aCkpO1xuXG4gICAgICAgIGNsb25lLmF0dHJpYnV0ZSgnc3R5bGUnLCBudWxsKS5kYXRhKCdjb2xsZWN0aW9uLWl0ZW0nLCBjbG9uZS5kYXRhKCdjb2xsZWN0aW9uLXRlbXBsYXRlJykpO1xuICAgICAgICBjbG9uZS5hdHRyaWJ1dGUoJ2RhdGEtY29sbGVjdGlvbi10ZW1wbGF0ZScsIG51bGwpO1xuICAgICAgICBjbG9uZS5hdHRyaWJ1dGUoJ2RhdGEtY29sbGVjdGlvbi1ub3NvcnQnLCBudWxsKTtcbiAgICAgICAgZWRpdGFibGUuQ29sbGVjdGlvbk5ldyA9IHRydWU7XG4gICAgICAgIGJvZHkuZW1pdCgnY2xpY2snLCB7IHRhcmdldDogdGl0bGUuc2libGluZ3MoJ1tkYXRhLXRpdGxlLWVkaXRdJykgfSk7XG5cbiAgICAgICAgZWRpdGFibGUub24oJ3RpdGxlLWVkaXQtZXhpdCcsIGFkZE5ld0J5RW50ZXIpO1xuICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBFZGl0IFRpdGxlXG4gICAgYm9keS5kZWxlZ2F0ZSgnYmx1cicsICdbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dIFtkYXRhLXRpdGxlLWVkaXRhYmxlXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciB0ZXh0ICAgICAgPSB0cmltKGVsZW1lbnQudGV4dCgpKSxcbiAgICAgICAgICAgIGl0ZW0gICAgICA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dJyksXG4gICAgICAgICAgICBrZXkgICAgICAgPSBpdGVtLmRhdGEoJ2NvbGxlY3Rpb24taXRlbScpLFxuICAgICAgICAgICAgaXRlbXMgICAgID0gZWxlbWVudC5wYXJlbnQoJ3VsJykuc2VhcmNoKCc+IFtkYXRhLWNvbGxlY3Rpb24taXRlbV0nKSxcbiAgICAgICAgICAgIGRhdGFGaWVsZCA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWRhdGFdJyksXG4gICAgICAgICAgICBkYXRhICAgICAgPSBkYXRhRmllbGQudmFsdWUoKSxcbiAgICAgICAgICAgIGluZGV4ICAgICA9IGluZGV4T2YoaXRlbXMsIGl0ZW1bMF0pO1xuXG4gICAgICAgIGlmIChpbmRleCA9PSAtMSkgeyByZXR1cm47IH1cblxuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgaWYgKCFkYXRhW2luZGV4XSkgeyBkYXRhLnNwbGljZShpbmRleCwgMCwge30pOyB9XG4gICAgICAgIGRhdGFbaW5kZXhdW2tleV0gPSB0ZXh0O1xuICAgICAgICBkYXRhRmllbGQudmFsdWUoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG4gICAgfSwgdHJ1ZSk7XG5cbiAgICAvLyBSZW1vdmUgaXRlbVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWNvbGxlY3Rpb24tcmVtb3ZlXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgIHZhciBpdGVtICAgICAgPSBlbGVtZW50LnBhcmVudCgnW2RhdGEtY29sbGVjdGlvbi1pdGVtXScpLFxuICAgICAgICAgICAgbGlzdCAgICAgID0gZWxlbWVudC5wYXJlbnQoJ3VsJyksXG4gICAgICAgICAgICBpdGVtcyAgICAgPSBsaXN0LnNlYXJjaCgnPiBbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dJyksXG4gICAgICAgICAgICBpbmRleCAgICAgPSBpbmRleE9mKGl0ZW1zLCBpdGVtWzBdKSxcbiAgICAgICAgICAgIGRhdGFGaWVsZCA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWRhdGFdJyksXG4gICAgICAgICAgICBkYXRhICAgICAgPSBkYXRhRmllbGQudmFsdWUoKTtcblxuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgZGF0YS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICBkYXRhRmllbGQudmFsdWUoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICBpdGVtLnJlbW92ZSgpO1xuICAgICAgICBpZiAoaXRlbXMubGVuZ3RoKSB7IGxpc3QucGFyZW50KCkuZmluZCgnW2RhdGEtY29sbGVjdGlvbi1lZGl0YWxsXScpLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTsgfVxuICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBQcmV2ZW50aW5nIGNsaWNrIG9mIGxpbmtzIHdoZW4gdGl0bGUgaXMgYmVpbmcgZWRpdGVkXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtY29sbGVjdGlvbi1pdGVtXSBhJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuZmluZCgnW2NvbnRlbnRlZGl0YWJsZV0nKSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBMb2FkIGl0ZW0gc2V0dGluZ3NcbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dIC5jb25maWctY29nLCBbZGF0YS1jb2xsZWN0aW9uLWVkaXRhbGxdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICB2YXIgZWRpdGFibGUgPSBlbGVtZW50LmZpbmQoJ1tkYXRhLXRpdGxlLWVkaXRhYmxlXScpO1xuICAgICAgICBpZiAoZWRpdGFibGUgJiYgZWRpdGFibGUuYXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnKSkge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaXNFZGl0QWxsID0gZWxlbWVudC5kYXRhKCdjb2xsZWN0aW9uLWVkaXRhbGwnKSAhPT0gbnVsbCxcbiAgICAgICAgICAgIHBhcmVudCAgICA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKSxcbiAgICAgICAgICAgIGRhdGFGaWVsZCA9IHBhcmVudC5maW5kKCdbZGF0YS1jb2xsZWN0aW9uLWRhdGFdJyksXG4gICAgICAgICAgICBkYXRhICAgICAgPSBkYXRhRmllbGQudmFsdWUoKSxcbiAgICAgICAgICAgIGl0ZW0gICAgICA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1jb2xsZWN0aW9uLWl0ZW1dJyksXG4gICAgICAgICAgICBpdGVtcyAgICAgPSBwYXJlbnQuc2VhcmNoKCd1bCA+IFtkYXRhLWNvbGxlY3Rpb24taXRlbV0nKTtcblxuICAgICAgICB2YXIgZGF0YVBvc3QgPSB7IGRhdGE6IGlzRWRpdEFsbCA/IGRhdGEgOiBKU09OLnN0cmluZ2lmeShKU09OLnBhcnNlKGRhdGEpW2luZGV4T2YoaXRlbXMsIGl0ZW1bMF0pXSkgfTtcbiAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICBjb250ZW50OiAnTG9hZGluZycsXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2c1LWRpYWxvZy10aGVtZS1kZWZhdWx0IGc1LW1vZGFsLWNvbGxlY3Rpb24gZzUtbW9kYWwtY29sbGVjdGlvbi0nICsgKGlzRWRpdEFsbCA/ICdlZGl0YWxsJyA6ICdzaW5nbGUnKSxcbiAgICAgICAgICAgIGRhdGE6IGRhdGFQb3N0LFxuICAgICAgICAgICAgcmVtb3RlOiBlbGVtZW50LmF0dHJpYnV0ZSgnaHJlZicpICsgZ2V0QWpheFN1ZmZpeCgpLFxuICAgICAgICAgICAgcmVtb3RlTG9hZGVkOiBmdW5jdGlvbihyZXNwb25zZSwgY29udGVudCkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtICAgICAgID0gY29udGVudC5lbGVtZW50cy5jb250ZW50LmZpbmQoJ2Zvcm0nKSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWl0ICAgICA9IGNvbnRlbnQuZWxlbWVudHMuY29udGVudC5maW5kKCdpbnB1dFt0eXBlPVwic3VibWl0XCJdLCBidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpLFxuICAgICAgICAgICAgICAgICAgICBkYXRhU3RyaW5nID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZSAgPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGFWYWx1ZS5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuc3R5bGUoeyB3aWR0aDogNDUwIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghZm9ybSB8fCAhc3VibWl0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIENvbGxlY3Rpb24gU2V0dGluZ3MgYXBwbHlcbiAgICAgICAgICAgICAgICBzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFTdHJpbmcgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICBzdWJtaXQuc2hvd0luZGljYXRvcigpO1xuXG4gICAgICAgICAgICAgICAgICAgICQoZm9ybVswXS5lbGVtZW50cykuZm9yRWFjaChmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSAkKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lICAgICA9IGlucHV0LmF0dHJpYnV0ZSgnbmFtZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICAgID0gaW5wdXQudmFsdWUoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgICA9IGlucHV0LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGUgPSBwYXJlbnQgPyBwYXJlbnQuZmluZCgnPiBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKSA6IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbmFtZSB8fCBpbnB1dC5kaXNhYmxlZCgpIHx8IChvdmVycmlkZSAmJiAhb3ZlcnJpZGUuY2hlY2tlZCgpKSkgeyByZXR1cm47IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTdHJpbmcucHVzaChuYW1lICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0aXRsZXMgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQuc2VhcmNoKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKSwga2V5O1xuICAgICAgICAgICAgICAgICAgICBpZiAodGl0bGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZXMuZm9yRWFjaChmdW5jdGlvbih0aXRsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gJCh0aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5ID0gdGl0bGUuZGF0YSgnY29sbGVjdGlvbi1rZXknKSB8fCAndGl0bGUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTdHJpbmcucHVzaChrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodGl0bGUuZGF0YSgndGl0bGUtZWRpdGFibGUnKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KGZvcm0uYXR0cmlidXRlKCdtZXRob2QnKSwgZm9ybS5hdHRyaWJ1dGUoJ2FjdGlvbicpICsgZ2V0QWpheFN1ZmZpeCgpLCBkYXRhU3RyaW5nLmpvaW4oJyYnKSB8fCB7fSwgZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGNvbnRhaW5lci5zdHlsZSh7IHdpZHRoOiAnOTAlJyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7IC8vIHNpbmdsZSBlZGl0aW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZVtpbmRleE9mKGl0ZW1zLCBpdGVtWzBdKV0gPSByZXNwb25zZS5ib2R5LmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gbXVsdGkgZWRpdGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWUgPSByZXNwb25zZS5ib2R5LmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUZpZWxkLnZhbHVlKEpTT04uc3RyaW5naWZ5KGRhdGFWYWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkuZW1pdCgnY2hhbmdlJywgeyB0YXJnZXQ6IGRhdGFGaWVsZCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0tZmllbGQnKS5zZWFyY2goJ3VsID4gW2RhdGEtY29sbGVjdGlvbi1pdGVtXScpLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaW5kZXgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gJChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gaXRlbS5maW5kKCdbZGF0YS10aXRsZS1lZGl0YWJsZV0nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBkYXRhVmFsdWVbaW5kZXhdW2l0ZW0uZGF0YSgnY29sbGVjdGlvbi1pdGVtJyldO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLmRhdGEoJ3RpdGxlLWVkaXRhYmxlJywgdGV4dCkudGV4dCh0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoJ0NvbGxlY3Rpb24gSXRlbSB1cGRhdGVkJywgJ0l0ZW0gVXBkYXRlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7fTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcHJpbWUgICAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgRW1pdHRlciAgICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9ib3VuZCcpLFxuICAgIE9wdGlvbnMgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcbiAgICAkICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICByZWFkeSAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICB6ZW4gICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG5cbiAgICBEcmFnRXZlbnRzID0gcmVxdWlyZSgnLi4vLi4vdWkvZHJhZy5ldmVudHMnKSxcblxuICAgIGZvckVhY2ggICAgPSByZXF1aXJlKCdtb3V0L2NvbGxlY3Rpb24vZm9yRWFjaCcpLFxuICAgIGJpbmQgICAgICAgPSByZXF1aXJlKCdtb3V0L2Z1bmN0aW9uL2JpbmQnKSxcbiAgICBjbGFtcCAgICAgID0gcmVxdWlyZSgnbW91dC9tYXRoL2NsYW1wJyk7XG5cbnZhciBpc0ZpcmVmb3ggPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignZmlyZWZveCcpID4gLTE7XG5cbnZhciBNT1VTRURPV04gPSBEcmFnRXZlbnRzLkVWRU5UUy5TVEFSVCxcbiAgICBNT1VTRU1PVkUgPSBEcmFnRXZlbnRzLkVWRU5UUy5NT1ZFLFxuICAgIE1PVVNFVVAgICA9IERyYWdFdmVudHMuRVZFTlRTLlNUT1AsXG4gICAgRk9DVVNJTiAgID0gaXNGaXJlZm94ID8gJ2ZvY3VzJyA6ICdmb2N1c2luJztcblxudmFyIENvbG9yUGlja2VyID0gbmV3IHByaW1lKHtcbiAgICBtaXhpbjogW09wdGlvbnMsIEJvdW5kXSxcbiAgICBpbmhlcml0czogRW1pdHRlcixcbiAgICBvcHRpb25zOiB7fSxcbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIHRoaXMuYnVpbHQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hdHRhY2goKTtcbiAgICB9LFxuXG4gICAgYXR0YWNoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICAgICAgTU9VU0VET1dOLmZvckVhY2goYmluZChmdW5jdGlvbihtb3VzZWRvd24pIHtcbiAgICAgICAgICAgIGJvZHkuZGVsZWdhdGUobW91c2Vkb3duLCAnLmNvbG9ycGlja2VyIGknLCB0aGlzLmJvdW5kKCdpY29uQ2xpY2snKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBib2R5LmRlbGVnYXRlKEZPQ1VTSU4sICcuY29sb3JwaWNrZXIgaW5wdXQnLCB0aGlzLmJvdW5kKCdzaG93JyksIHRydWUpO1xuXG5cbiAgICAgICAgYm9keS5kZWxlZ2F0ZSgna2V5ZG93bicsICcuY29sb3JwaWNrZXIgaW5wdXQnLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDk6IC8vIHRhYlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMzogLy8gZW50ZXJcbiAgICAgICAgICAgICAgICBjYXNlIDI3OiAvLyBlc2NcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIG9uIGtleXVwXG4gICAgICAgIGJvZHkuZGVsZWdhdGUoJ2tleXVwJywgJy5jb2xvcnBpY2tlciBpbnB1dCcsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRnJvbUlucHV0KHRydWUsIGVsZW1lbnQpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAvLyBVcGRhdGUgb24gcGFzdGVcbiAgICAgICAgYm9keS5kZWxlZ2F0ZSgncGFzdGUnLCAnLmNvbG9ycGlja2VyIGlucHV0JywgYmluZChmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRnJvbUlucHV0KHRydWUsIGVsZW1lbnQpO1xuICAgICAgICAgICAgfSwgdGhpcyksIDEpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIHNob3c6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBib2R5ID0gJCgnYm9keScpO1xuXG4gICAgICAgIGlmICghdGhpcy5idWlsdCkge1xuICAgICAgICAgICAgdGhpcy5idWlsZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgICAgdGhpcy5yZXBvc2l0aW9uKCk7XG4gICAgICAgIHRoaXMud3JhcHBlci5hZGRDbGFzcygnY3AtdmlzaWJsZScpO1xuICAgICAgICB0aGlzLnVwZGF0ZUZyb21JbnB1dCgpO1xuXG4gICAgICAgIE1PVVNFTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24obW91c2Vtb3ZlKSB7XG4gICAgICAgICAgICBib2R5Lm9uKG1vdXNlbW92ZSwgdGhpcy5ib3VuZCgnYm9keU1vdmUnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBNT1VTRURPV04uZm9yRWFjaChiaW5kKGZ1bmN0aW9uKG1vdXNlZG93bikge1xuICAgICAgICAgICAgdGhpcy53cmFwcGVyLmRlbGVnYXRlKG1vdXNlZG93biwgJy5jcC1ncmlkLCAuY3Atc2xpZGVyLCAuY3Atb3BhY2l0eS1zbGlkZXInLCB0aGlzLmJvdW5kKCdib2R5RG93bicpKTtcbiAgICAgICAgICAgIGJvZHkub24obW91c2Vkb3duLCB0aGlzLmJvdW5kKCdib2R5Q2xpY2snKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBNT1VTRVVQLmZvckVhY2goYmluZChmdW5jdGlvbihtb3VzZXVwKSB7XG4gICAgICAgICAgICBib2R5Lm9uKG1vdXNldXAsIHRoaXMuYm91bmQoJ3RhcmdldFJlc2V0JykpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgICAgICBpZiAoIXRoaXMuYnVpbHQpIHsgcmV0dXJuOyB9XG4gICAgICAgIHRoaXMud3JhcHBlci5yZW1vdmVDbGFzcygnY3AtdmlzaWJsZScpO1xuXG4gICAgICAgIE1PVVNFTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24obW91c2Vtb3ZlKSB7XG4gICAgICAgICAgICBib2R5Lm9mZihtb3VzZW1vdmUsIHRoaXMuYm91bmQoJ2JvZHlNb3ZlJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgTU9VU0VET1dOLmZvckVhY2goYmluZChmdW5jdGlvbihtb3VzZWRvd24pIHtcbiAgICAgICAgICAgIHRoaXMud3JhcHBlci51bmRlbGVnYXRlKG1vdXNlZG93biwgJy5jcC1ncmlkLCAuY3Atc2xpZGVyLCAuY3Atb3BhY2l0eS1zbGlkZXInLCB0aGlzLmJvdW5kKCdib2R5RG93bicpKTtcbiAgICAgICAgICAgIGJvZHkub2ZmKG1vdXNlZG93biwgdGhpcy5ib3VuZCgnYm9keUNsaWNrJykpO1xuICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgTU9VU0VVUC5mb3JFYWNoKGJpbmQoZnVuY3Rpb24obW91c2V1cCkge1xuICAgICAgICAgICAgYm9keS5vZmYobW91c2V1cCwgdGhpcy5ib3VuZCgndGFyZ2V0UmVzZXQnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcbiAgICB9LFxuXG4gICAgaWNvbkNsaWNrOiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHZhciBpbnB1dCA9ICQoZWxlbWVudCkuc2libGluZygnaW5wdXQnKTtcbiAgICAgICAgaW5wdXRbMF0uZm9jdXMoKTtcblxuICAgICAgICB0aGlzLnNob3coZXZlbnQsIGlucHV0KTtcbiAgICB9LFxuXG4gICAgYm9keU1vdmU6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0KSB7IHRoaXMubW92ZSh0aGlzLnRhcmdldCwgZXZlbnQpOyB9XG4gICAgfSxcblxuICAgIGJvZHlDbGljazogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgaWYgKCF0YXJnZXQucGFyZW50KCcuY3Atd3JhcHBlcicpICYmICF0YXJnZXQucGFyZW50KCcuY29sb3JwaWNrZXInKSkge1xuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYm9keURvd246IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdGhpcy50YXJnZXQgPSBlbGVtZW50O1xuICAgICAgICB0aGlzLm1vdmUodGhpcy50YXJnZXQsIGV2ZW50LCB0cnVlKTtcbiAgICB9LFxuXG4gICAgdGFyZ2V0UmVzZXQ6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgIH0sXG5cbiAgICBtb3ZlOiBmdW5jdGlvbih0YXJnZXQsIGV2ZW50KSB7XG4gICAgICAgIHZhciBpbnB1dCAgICAgID0gdGhpcy5lbGVtZW50LFxuICAgICAgICAgICAgcGlja2VyICAgICA9IHRhcmdldC5maW5kKCcuY3AtcGlja2VyJyksXG4gICAgICAgICAgICBjbGllbnRSZWN0ID0gdGFyZ2V0WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgb2Zmc2V0WCAgICA9IGNsaWVudFJlY3QubGVmdCArIHdpbmRvdy5zY3JvbGxYLFxuICAgICAgICAgICAgb2Zmc2V0WSAgICA9IGNsaWVudFJlY3QudG9wICsgd2luZG93LnNjcm9sbFksXG4gICAgICAgICAgICB4ICAgICAgICAgID0gTWF0aC5yb3VuZChldmVudC5wYWdlWCAtIG9mZnNldFgpLFxuICAgICAgICAgICAgeSAgICAgICAgICA9IE1hdGgucm91bmQoZXZlbnQucGFnZVkgLSBvZmZzZXRZKSxcbiAgICAgICAgICAgIHd4LCB3eSwgciwgcGhpO1xuXG4gICAgICAgIC8vIFRvdWNoIHN1cHBvcnRcbiAgICAgICAgaWYgKGV2ZW50LmNoYW5nZWRUb3VjaGVzKSB7XG4gICAgICAgICAgICB4ID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggLSBvZmZzZXRYO1xuICAgICAgICAgICAgeSA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIC0gb2Zmc2V0WTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENvbnN0cmFpbiBwaWNrZXIgdG8gaXRzIGNvbnRhaW5lclxuICAgICAgICBpZiAoeCA8IDApIHggPSAwO1xuICAgICAgICBpZiAoeSA8IDApIHkgPSAwO1xuICAgICAgICBpZiAoeCA+IGNsaWVudFJlY3Qud2lkdGgpIHggPSBjbGllbnRSZWN0LndpZHRoO1xuICAgICAgICBpZiAoeSA+IGNsaWVudFJlY3QuaGVpZ2h0KSB5ID0gY2xpZW50UmVjdC5oZWlnaHQ7XG5cbiAgICAgICAgLy8gQ29uc3RyYWluIGNvbG9yIHdoZWVsIHZhbHVlcyB0byB0aGUgd2hlZWxcbiAgICAgICAgaWYgKHRhcmdldC5wYXJlbnQoJy5jcC1tb2RlLXdoZWVsJykgJiYgcGlja2VyLnBhcmVudCgnLmNwLWdyaWQnKSkge1xuICAgICAgICAgICAgd3ggPSA3NSAtIHg7XG4gICAgICAgICAgICB3eSA9IDc1IC0geTtcbiAgICAgICAgICAgIHIgPSBNYXRoLnNxcnQod3ggKiB3eCArIHd5ICogd3kpO1xuICAgICAgICAgICAgcGhpID0gTWF0aC5hdGFuMih3eSwgd3gpO1xuXG4gICAgICAgICAgICBpZiAocGhpIDwgMCkgcGhpICs9IE1hdGguUEkgKiAyO1xuICAgICAgICAgICAgaWYgKHIgPiA3NSkge1xuICAgICAgICAgICAgICAgIHggPSA3NSAtICg3NSAqIE1hdGguY29zKHBoaSkpO1xuICAgICAgICAgICAgICAgIHkgPSA3NSAtICg3NSAqIE1hdGguc2luKHBoaSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB4ID0gTWF0aC5yb3VuZCh4KTtcbiAgICAgICAgICAgIHkgPSBNYXRoLnJvdW5kKHkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTW92ZSB0aGUgcGlja2VyXG4gICAgICAgIGlmICh0YXJnZXQuaGFzQ2xhc3MoJ2NwLWdyaWQnKSkge1xuICAgICAgICAgICAgcGlja2VyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICB0b3A6IHksXG4gICAgICAgICAgICAgICAgbGVmdDogeFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlRnJvbVBpY2tlcihpbnB1dCwgdGFyZ2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBpY2tlci5zdHlsZSh7XG4gICAgICAgICAgICAgICAgdG9wOiB5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRnJvbVBpY2tlcihpbnB1dCwgdGFyZ2V0KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBidWlsZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMud3JhcHBlciA9IHplbignZGl2LmNwLXdyYXBwZXIuY3Atd2l0aC1vcGFjaXR5LmNwLW1vZGUtaHVlJyk7XG4gICAgICAgIHRoaXMuc2xpZGVyID0gemVuKCdkaXYuY3Atc2xpZGVyLmNwLXNwcml0ZScpLmJvdHRvbSh0aGlzLndyYXBwZXIpLmFwcGVuZENoaWxkKHplbignZGl2LmNwLXBpY2tlcicpKTtcbiAgICAgICAgdGhpcy5vcGFjaXR5U2xpZGVyID0gemVuKCdkaXYuY3Atb3BhY2l0eS1zbGlkZXIuY3Atc3ByaXRlJykuYm90dG9tKHRoaXMud3JhcHBlcikuYXBwZW5kQ2hpbGQoemVuKCdkaXYuY3AtcGlja2VyJykpO1xuICAgICAgICB0aGlzLmdyaWQgPSB6ZW4oJ2Rpdi5jcC1ncmlkLmNwLXNwcml0ZScpLmJvdHRvbSh0aGlzLndyYXBwZXIpLmFwcGVuZENoaWxkKHplbignZGl2LmNwLWdyaWQtaW5uZXInKSkuYXBwZW5kQ2hpbGQoemVuKCdkaXYuY3AtcGlja2VyJykpO1xuXG4gICAgICAgIHplbignZGl2JykuYm90dG9tKHRoaXMuZ3JpZC5maW5kKCcuY3AtcGlja2VyJykpO1xuXG4gICAgICAgIHZhciB0YWJzID0gemVuKCdkaXYuY3AtdGFicycpLmJvdHRvbSh0aGlzLndyYXBwZXIpO1xuXG4gICAgICAgIHRoaXMudGFicyA9IHtcbiAgICAgICAgICAgIGh1ZTogemVuKCdkaXYuY3AtdGFiLWh1ZS5hY3RpdmUnKS50ZXh0KCdIVUUnKS5ib3R0b20odGFicyksXG4gICAgICAgICAgICBicmlnaHRuZXNzOiB6ZW4oJ2Rpdi5jcC10YWItYnJpZ2h0bmVzcycpLnRleHQoJ0JSSScpLmJvdHRvbSh0YWJzKSxcbiAgICAgICAgICAgIHNhdHVyYXRpb246IHplbignZGl2LmNwLXRhYi1zYXR1cmF0aW9uJykudGV4dCgnU0FUJykuYm90dG9tKHRhYnMpLFxuICAgICAgICAgICAgd2hlZWw6IHplbignZGl2LmNwLXRhYi13aGVlbCcpLnRleHQoJ1dIRUVMJykuYm90dG9tKHRhYnMpXG4gICAgICAgIH07XG5cbiAgICAgICAgdGFicy5kZWxlZ2F0ZSgnY2xpY2snLCAnPiBkaXYnLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgYWN0aXZlICA9IHRhYnMuZmluZCgnLmFjdGl2ZScpLFxuICAgICAgICAgICAgICAgIG1vZGUgICAgPSBhY3RpdmUuYXR0cmlidXRlKCdjbGFzcycpLnJlcGxhY2UoL1xcc3xhY3RpdmV8Y3AtdGFiLS9nLCAnJyksXG4gICAgICAgICAgICAgICAgbmV3TW9kZSA9IGVsZW1lbnQuYXR0cmlidXRlKCdjbGFzcycpLnJlcGxhY2UoL1xcc3xhY3RpdmV8Y3AtdGFiLS9nLCAnJyk7XG5cbiAgICAgICAgICAgIHRoaXMud3JhcHBlci5yZW1vdmVDbGFzcygnY3AtbW9kZS0nICsgbW9kZSkuYWRkQ2xhc3MoJ2NwLW1vZGUtJyArIG5ld01vZGUpO1xuICAgICAgICAgICAgYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICB0aGlzLm1vZGUgPSBuZXdNb2RlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVGcm9tSW5wdXQoKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMud3JhcHBlci5ib3R0b20oJ2JvZHknKTtcblxuICAgICAgICB0aGlzLmJ1aWx0ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5tb2RlID0gJ2h1ZSc7XG4gICAgfSxcblxuICAgIHVwZGF0ZUZyb21JbnB1dDogZnVuY3Rpb24oZG9udEZpcmVFdmVudCwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gdGhpcy5lbGVtZW50IHx8IGVsZW1lbnQ7XG4gICAgICAgIHZhciB2YWx1ZSAgID0gZWxlbWVudC52YWx1ZSgpLFxuICAgICAgICAgICAgb3BhY2l0eSA9IHZhbHVlLnJlcGxhY2UoL1xccy9nLCAnJykubWF0Y2goL15yZ2JhP1xcKFswLTldezEsM30sWzAtOV17MSwzfSxbMC05XXsxLDN9LCguKylcXCkvKSxcbiAgICAgICAgICAgIGhleCwgaHNiO1xuXG4gICAgICAgIHZhbHVlID0gcmdic3RyMmhleCh2YWx1ZSkgfHwgdmFsdWU7XG4gICAgICAgIG9wYWNpdHkgPSBvcGFjaXR5ID8gY2xhbXAob3BhY2l0eVsxXSwgMCwgMSkgOiAxO1xuXG4gICAgICAgIGlmICghKGhleCA9IHBhcnNlSGV4KHZhbHVlKSkpIHsgaGV4ID0gJyNmZmZmMDAnOyB9XG4gICAgICAgIGhzYiA9IGhleDJoc2IoaGV4KTtcblxuICAgICAgICBpZiAodGhpcy5idWlsdCkge1xuICAgICAgICAgICAgLy8gb3BhY2l0eVxuICAgICAgICAgICAgdGhpcy5vcGFjaXR5ID0gb3BhY2l0eTtcbiAgICAgICAgICAgIHZhciBzbGlkZXJIZWlnaHQgPSB0aGlzLm9wYWNpdHlTbGlkZXIucG9zaXRpb24oKS5oZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLm9wYWNpdHlTbGlkZXIuZmluZCgnLmNwLXBpY2tlcicpLnN0eWxlKHsgJ3RvcCc6IGNsYW1wKHNsaWRlckhlaWdodCAtIChzbGlkZXJIZWlnaHQgKiB0aGlzLm9wYWNpdHkpLCAwLCBzbGlkZXJIZWlnaHQpIH0pO1xuXG4gICAgICAgICAgICAvLyBiZyBjb2xvclxuICAgICAgICAgICAgdmFyIGdyaWRIZWlnaHQgPSB0aGlzLmdyaWQucG9zaXRpb24oKS5oZWlnaHQsXG4gICAgICAgICAgICAgICAgZ3JpZFdpZHRoICA9IHRoaXMuZ3JpZC5wb3NpdGlvbigpLndpZHRoLFxuICAgICAgICAgICAgICAgIHIsIHBoaSwgeCwgeTtcblxuICAgICAgICAgICAgc2xpZGVySGVpZ2h0ID0gdGhpcy5zbGlkZXIucG9zaXRpb24oKS5oZWlnaHQ7XG5cbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnd2hlZWwnOlxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICByID0gY2xhbXAoTWF0aC5jZWlsKGhzYi5zICogMC43NSksIDAsIGdyaWRIZWlnaHQgLyAyKTtcbiAgICAgICAgICAgICAgICAgICAgcGhpID0gaHNiLmggKiBNYXRoLlBJIC8gMTgwO1xuICAgICAgICAgICAgICAgICAgICB4ID0gY2xhbXAoNzUgLSBNYXRoLmNvcyhwaGkpICogciwgMCwgZ3JpZFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgeSA9IGNsYW1wKDc1IC0gTWF0aC5zaW4ocGhpKSAqIHIsIDAsIGdyaWRIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQuc3R5bGUoeyBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcgfSkuZmluZCgnLmNwLXBpY2tlcicpLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICB5ID0gMTUwIC0gKGhzYi5iIC8gKDEwMCAvIGdyaWRIZWlnaHQpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhleCA9PT0gJycpIHkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlci5maW5kKCcuY3AtcGlja2VyJykuc3R5bGUoeyB0b3A6IHkgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaHNiMmhleCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDogaHNiLmgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczogaHNiLnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYjogMTAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdzYXR1cmF0aW9uJzpcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgeCA9IGNsYW1wKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgICAgICAgICAgIHkgPSBjbGFtcChncmlkSGVpZ2h0IC0gTWF0aC5jZWlsKGhzYi5iIC8gKDEwMCAvIGdyaWRIZWlnaHQpKSwgMCwgZ3JpZEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5maW5kKCcuY3AtcGlja2VyJykuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB5LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogeFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgc2xpZGVyIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgIHkgPSBjbGFtcChzbGlkZXJIZWlnaHQgLSAoaHNiLnMgKiAoc2xpZGVySGVpZ2h0IC8gMTAwKSksIDAsIHNsaWRlckhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVyLmZpbmQoJy5jcC1waWNrZXInKS5zdHlsZSh7IHRvcDogeSB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXIuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoOiBoc2IuaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYjogaHNiLmJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQuZmluZCgnLmNwLWdyaWQtaW5uZXInKS5zdHlsZSh7IG9wYWNpdHk6IGhzYi5zIC8gMTAwIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2JyaWdodG5lc3MnOlxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICB4ID0gY2xhbXAoKDUgKiBoc2IuaCkgLyAxMiwgMCwgMTUwKTtcbiAgICAgICAgICAgICAgICAgICAgeSA9IGNsYW1wKGdyaWRIZWlnaHQgLSBNYXRoLmNlaWwoaHNiLnMgLyAoMTAwIC8gZ3JpZEhlaWdodCkpLCAwLCBncmlkSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkLmZpbmQoJy5jcC1waWNrZXInKS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHksXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB4XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgeSA9IGNsYW1wKHNsaWRlckhlaWdodCAtIChoc2IuYiAqIChzbGlkZXJIZWlnaHQgLyAxMDApKSwgMCwgc2xpZGVySGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXIuZmluZCgnLmNwLXBpY2tlcicpLnN0eWxlKHsgdG9wOiB5IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlci5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGhzYjJoZXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IGhzYi5oLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHM6IGhzYi5zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IDEwMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5maW5kKCcuY3AtZ3JpZC1pbm5lcicpLnN0eWxlKHsgb3BhY2l0eTogMSAtIChoc2IuYiAvIDEwMCkgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2h1ZSc6XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgeCA9IGNsYW1wKE1hdGguY2VpbChoc2IucyAvICgxMDAgLyBncmlkV2lkdGgpKSwgMCwgZ3JpZFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgeSA9IGNsYW1wKGdyaWRIZWlnaHQgLSBNYXRoLmNlaWwoaHNiLmIgLyAoMTAwIC8gZ3JpZEhlaWdodCkpLCAwLCBncmlkSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkLmZpbmQoJy5jcC1waWNrZXInKS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHksXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiB4XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgeSA9IGNsYW1wKHNsaWRlckhlaWdodCAtIChoc2IuaCAvICgzNjAgLyBzbGlkZXJIZWlnaHQpKSwgMCwgc2xpZGVySGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXIuZmluZCgnLmNwLXBpY2tlcicpLnN0eWxlKHsgdG9wOiB5IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBwYW5lbCBjb2xvclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoOiBoc2IuaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYjogMTAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRvbnRGaXJlRXZlbnQpIHsgZWxlbWVudC52YWx1ZSh0aGlzLmdldFZhbHVlKGhleCkpOyB9XG5cbiAgICAgICAgdGhpcy5lbWl0KCdjaGFuZ2UnLCBlbGVtZW50LCBoZXgsIG9wYWNpdHkpO1xuXG4gICAgfSxcblxuICAgIHVwZGF0ZUZyb21QaWNrZXI6IGZ1bmN0aW9uKGlucHV0LCB0YXJnZXQpIHtcbiAgICAgICAgdmFyIGdldENvb3JkcyA9IGZ1bmN0aW9uKHBpY2tlciwgY29udGFpbmVyKSB7XG5cbiAgICAgICAgICAgIHZhciBsZWZ0LCB0b3A7XG4gICAgICAgICAgICBpZiAoIXBpY2tlci5sZW5ndGggfHwgIWNvbnRhaW5lcikgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBsZWZ0ID0gcGlja2VyWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gICAgICAgICAgICB0b3AgPSBwaWNrZXJbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHg6IGxlZnQgLSBjb250YWluZXJbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCArIChwaWNrZXJbMF0ub2Zmc2V0V2lkdGggLyAyKSxcbiAgICAgICAgICAgICAgICB5OiB0b3AgLSBjb250YWluZXJbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgKHBpY2tlclswXS5vZmZzZXRIZWlnaHQgLyAyKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBoZXgsIGh1ZSwgc2F0dXJhdGlvbiwgYnJpZ2h0bmVzcywgeCwgeSwgciwgcGhpLFxuXG4gICAgICAgICAgICAvLyBQYW5lbCBvYmplY3RzXG4gICAgICAgICAgICBncmlkICAgICAgICAgICAgICAgID0gdGhpcy53cmFwcGVyLmZpbmQoJy5jcC1ncmlkJyksXG4gICAgICAgICAgICBzbGlkZXIgICAgICAgICAgICAgID0gdGhpcy53cmFwcGVyLmZpbmQoJy5jcC1zbGlkZXInKSxcbiAgICAgICAgICAgIG9wYWNpdHlTbGlkZXIgICAgICAgPSB0aGlzLndyYXBwZXIuZmluZCgnLmNwLW9wYWNpdHktc2xpZGVyJyksXG5cbiAgICAgICAgICAgIC8vIFBpY2tlciBvYmplY3RzXG4gICAgICAgICAgICBncmlkUGlja2VyICAgICAgICAgID0gZ3JpZC5maW5kKCcuY3AtcGlja2VyJyksXG4gICAgICAgICAgICBzbGlkZXJQaWNrZXIgICAgICAgID0gc2xpZGVyLmZpbmQoJy5jcC1waWNrZXInKSxcbiAgICAgICAgICAgIG9wYWNpdHlQaWNrZXIgICAgICAgPSBvcGFjaXR5U2xpZGVyLmZpbmQoJy5jcC1waWNrZXInKSxcblxuICAgICAgICAgICAgLy8gUGlja2VyIHBvc2l0aW9uc1xuICAgICAgICAgICAgZ3JpZFBvcyAgICAgICAgICAgICA9IGdldENvb3JkcyhncmlkUGlja2VyLCBncmlkKSxcbiAgICAgICAgICAgIHNsaWRlclBvcyAgICAgICAgICAgPSBnZXRDb29yZHMoc2xpZGVyUGlja2VyLCBzbGlkZXIpLFxuICAgICAgICAgICAgb3BhY2l0eVBvcyAgICAgICAgICA9IGdldENvb3JkcyhvcGFjaXR5UGlja2VyLCBvcGFjaXR5U2xpZGVyKSxcblxuICAgICAgICAgICAgLy8gU2l6ZXNcbiAgICAgICAgICAgIGdyaWRXaWR0aCAgICAgICAgICAgPSBncmlkWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoLFxuICAgICAgICAgICAgZ3JpZEhlaWdodCAgICAgICAgICA9IGdyaWRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0LFxuICAgICAgICAgICAgc2xpZGVySGVpZ2h0ICAgICAgICA9IHNsaWRlclswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQsXG4gICAgICAgICAgICBvcGFjaXR5U2xpZGVySGVpZ2h0ID0gb3BhY2l0eVNsaWRlclswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG5cbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5lbGVtZW50LnZhbHVlKCk7XG4gICAgICAgIHZhbHVlID0gcmdic3RyMmhleCh2YWx1ZSkgfHwgdmFsdWU7XG4gICAgICAgIGlmICghKGhleCA9IHBhcnNlSGV4KHZhbHVlKSkpIHsgaGV4ID0gJyNmZmZmMDAnOyB9XG5cbiAgICAgICAgLy8gSGFuZGxlIGNvbG9yc1xuICAgICAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKCdjcC1ncmlkJykgfHwgdGFyZ2V0Lmhhc0NsYXNzKCdjcC1zbGlkZXInKSkge1xuXG4gICAgICAgICAgICAvLyBEZXRlcm1pbmUgSFNCIHZhbHVlc1xuICAgICAgICAgICAgc3dpdGNoICh0aGlzLm1vZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBodWUsIHNhdHVyYXRpb24sIGFuZCBicmlnaHRuZXNzXG4gICAgICAgICAgICAgICAgICAgIHggPSAoZ3JpZFdpZHRoIC8gMikgLSBncmlkUG9zLng7XG4gICAgICAgICAgICAgICAgICAgIHkgPSAoZ3JpZEhlaWdodCAvIDIpIC0gZ3JpZFBvcy55O1xuICAgICAgICAgICAgICAgICAgICByID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpO1xuICAgICAgICAgICAgICAgICAgICBwaGkgPSBNYXRoLmF0YW4yKHksIHgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGhpIDwgMCkgcGhpICs9IE1hdGguUEkgKiAyO1xuICAgICAgICAgICAgICAgICAgICBpZiAociA+IDc1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByID0gNzU7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkUG9zLnggPSA2OSAtICg3NSAqIE1hdGguY29zKHBoaSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFBvcy55ID0gNjkgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzYXR1cmF0aW9uID0gY2xhbXAociAvIDAuNzUsIDAsIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGh1ZSA9IGNsYW1wKHBoaSAqIDE4MCAvIE1hdGguUEksIDAsIDM2MCk7XG4gICAgICAgICAgICAgICAgICAgIGJyaWdodG5lc3MgPSBjbGFtcCgxMDAgLSBNYXRoLmZsb29yKHNsaWRlclBvcy55ICogKDEwMCAvIHNsaWRlckhlaWdodCkpLCAwLCAxMDApO1xuICAgICAgICAgICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGg6IGh1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSVxuICAgICAgICAgICAgICAgICAgICBzbGlkZXIuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczogc2F0dXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiOiAxMDBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ3NhdHVyYXRpb24nOlxuICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgICAgICAgICBodWUgPSBjbGFtcChwYXJzZUludChncmlkUG9zLnggKiAoMzYwIC8gZ3JpZFdpZHRoKSwgMTApLCAwLCAzNjApO1xuICAgICAgICAgICAgICAgICAgICBzYXR1cmF0aW9uID0gY2xhbXAoMTAwIC0gTWF0aC5mbG9vcihzbGlkZXJQb3MueSAqICgxMDAgLyBzbGlkZXJIZWlnaHQpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGNsYW1wKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWRIZWlnaHQpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgaGV4ID0gaHNiMmhleCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgYjogYnJpZ2h0bmVzc1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaHNiMmhleCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHM6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC5maW5kKCcuY3AtZ3JpZC1pbm5lcicpLnN0eWxlKHsgb3BhY2l0eTogc2F0dXJhdGlvbiAvIDEwMCB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdicmlnaHRuZXNzJzpcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgICAgICAgICAgaHVlID0gY2xhbXAocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWRXaWR0aCksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgICAgICAgICAgc2F0dXJhdGlvbiA9IGNsYW1wKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWRIZWlnaHQpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGNsYW1wKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVySGVpZ2h0KSksIDAsIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgczogc2F0dXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlci5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGhzYjJoZXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IGh1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IDEwMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWQuZmluZCgnLmNwLWdyaWQtaW5uZXInKS5zdHlsZSh7IG9wYWNpdHk6IDEgLSAoYnJpZ2h0bmVzcyAvIDEwMCkgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgICAgICAgICAgaHVlID0gY2xhbXAoMzYwIC0gcGFyc2VJbnQoc2xpZGVyUG9zLnkgKiAoMzYwIC8gc2xpZGVySGVpZ2h0KSwgMTApLCAwLCAzNjApO1xuICAgICAgICAgICAgICAgICAgICBzYXR1cmF0aW9uID0gY2xhbXAoTWF0aC5mbG9vcihncmlkUG9zLnggKiAoMTAwIC8gZ3JpZFdpZHRoKSksIDAsIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGJyaWdodG5lc3MgPSBjbGFtcCgxMDAgLSBNYXRoLmZsb29yKGdyaWRQb3MueSAqICgxMDAgLyBncmlkSGVpZ2h0KSksIDAsIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgczogc2F0dXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICAgICAgICAgIGdyaWQuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgczogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IDEwMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIYW5kbGUgb3BhY2l0eVxuICAgICAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKCdjcC1vcGFjaXR5LXNsaWRlcicpKSB7XG4gICAgICAgICAgICB0aGlzLm9wYWNpdHkgPSBwYXJzZUZsb2F0KDEgLSAob3BhY2l0eVBvcy55IC8gb3BhY2l0eVNsaWRlckhlaWdodCkpLnRvRml4ZWQoMik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGp1c3QgY2FzZVxuICAgICAgICBpbnB1dC52YWx1ZSh0aGlzLmdldFZhbHVlKGhleCkpO1xuXG4gICAgICAgIC8vIEhhbmRsZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgdGhpcy5lbWl0KCdjaGFuZ2UnLCB0aGlzLmVsZW1lbnQsIGhleCwgdGhpcy5vcGFjaXR5KTtcblxuICAgIH0sXG5cbiAgICByZXBvc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMuZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgdGhpcy53cmFwcGVyLnN0eWxlKHtcbiAgICAgICAgICAgIHRvcDogb2Zmc2V0LnRvcCArIG9mZnNldC5oZWlnaHQgKyB3aW5kb3cuc2Nyb2xsWSxcbiAgICAgICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0ICsgd2luZG93LnNjcm9sbFhcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGdldFZhbHVlOiBmdW5jdGlvbihoZXgpIHtcbiAgICAgICAgaWYgKHRoaXMub3BhY2l0eSA9PSAxKSB7IHJldHVybiBoZXg7IH1cbiAgICAgICAgdmFyIHJnYiA9IGhleDJyZ2IoaGV4KTtcbiAgICAgICAgcmV0dXJuICdyZ2JhKCcgKyByZ2IuciArICcsICcgKyByZ2IuZyArICcsICcgKyByZ2IuYiArICcsICcgKyB0aGlzLm9wYWNpdHkgKyAnKSc7XG4gICAgfVxufSk7XG5cbi8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIGhleCBzdHJpbmcgd2hlbiBwb3NzaWJsZVxudmFyIHBhcnNlSGV4ID0gZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1teQS1GMC05XS9pZywgJycpO1xuICAgIGlmIChzdHJpbmcubGVuZ3RoICE9PSAzICYmIHN0cmluZy5sZW5ndGggIT09IDYpIHJldHVybiAnJztcbiAgICBpZiAoc3RyaW5nLmxlbmd0aCA9PT0gMykge1xuICAgICAgICBzdHJpbmcgPSBzdHJpbmdbMF0gKyBzdHJpbmdbMF0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMl0gKyBzdHJpbmdbMl07XG4gICAgfVxuXG4gICAgcmV0dXJuICcjJyArIHN0cmluZy50b0xvd2VyQ2FzZSgpO1xufTtcblxuLy8gQ29udmVydHMgYW4gSFNCIG9iamVjdCB0byBhbiBSR0Igb2JqZWN0XG52YXIgaHNiMnJnYiA9IGZ1bmN0aW9uKGhzYikge1xuICAgIHZhciByZ2IgPSB7fTtcbiAgICB2YXIgaCA9IE1hdGgucm91bmQoaHNiLmgpO1xuICAgIHZhciBzID0gTWF0aC5yb3VuZChoc2IucyAqIDI1NSAvIDEwMCk7XG4gICAgdmFyIHYgPSBNYXRoLnJvdW5kKGhzYi5iICogMjU1IC8gMTAwKTtcbiAgICBpZiAocyA9PT0gMCkge1xuICAgICAgICByZ2IuciA9IHJnYi5nID0gcmdiLmIgPSB2O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB0MSA9IHY7XG4gICAgICAgIHZhciB0MiA9ICgyNTUgLSBzKSAqIHYgLyAyNTU7XG4gICAgICAgIHZhciB0MyA9ICh0MSAtIHQyKSAqIChoICUgNjApIC8gNjA7XG4gICAgICAgIGlmIChoID09PSAzNjApIGggPSAwO1xuICAgICAgICBpZiAoaCA8IDYwKSB7XG4gICAgICAgICAgICByZ2IuciA9IHQxO1xuICAgICAgICAgICAgcmdiLmIgPSB0MjtcbiAgICAgICAgICAgIHJnYi5nID0gdDIgKyB0MztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoIDwgMTIwKSB7XG4gICAgICAgICAgICByZ2IuZyA9IHQxO1xuICAgICAgICAgICAgcmdiLmIgPSB0MjtcbiAgICAgICAgICAgIHJnYi5yID0gdDEgLSB0MztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoIDwgMTgwKSB7XG4gICAgICAgICAgICByZ2IuZyA9IHQxO1xuICAgICAgICAgICAgcmdiLnIgPSB0MjtcbiAgICAgICAgICAgIHJnYi5iID0gdDIgKyB0MztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoIDwgMjQwKSB7XG4gICAgICAgICAgICByZ2IuYiA9IHQxO1xuICAgICAgICAgICAgcmdiLnIgPSB0MjtcbiAgICAgICAgICAgIHJnYi5nID0gdDEgLSB0MztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoIDwgMzAwKSB7XG4gICAgICAgICAgICByZ2IuYiA9IHQxO1xuICAgICAgICAgICAgcmdiLmcgPSB0MjtcbiAgICAgICAgICAgIHJnYi5yID0gdDIgKyB0MztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChoIDwgMzYwKSB7XG4gICAgICAgICAgICByZ2IuciA9IHQxO1xuICAgICAgICAgICAgcmdiLmcgPSB0MjtcbiAgICAgICAgICAgIHJnYi5iID0gdDEgLSB0MztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJnYi5yID0gMDtcbiAgICAgICAgICAgIHJnYi5nID0gMDtcbiAgICAgICAgICAgIHJnYi5iID0gMDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICByOiBNYXRoLnJvdW5kKHJnYi5yKSxcbiAgICAgICAgZzogTWF0aC5yb3VuZChyZ2IuZyksXG4gICAgICAgIGI6IE1hdGgucm91bmQocmdiLmIpXG4gICAgfTtcbn07XG5cbi8vIENvbnZlcnRzIGFuIFJHQiBvYmplY3QgdG8gYSBoZXggc3RyaW5nXG52YXIgcmdiMmhleCA9IGZ1bmN0aW9uKHJnYikge1xuICAgIHZhciBoZXggPSBbXG4gICAgICAgIHJnYi5yLnRvU3RyaW5nKDE2KSxcbiAgICAgICAgcmdiLmcudG9TdHJpbmcoMTYpLFxuICAgICAgICByZ2IuYi50b1N0cmluZygxNilcbiAgICBdO1xuXG4gICAgZm9yRWFjaChoZXgsIGZ1bmN0aW9uKHZhbCwgbnIpIHtcbiAgICAgICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIGhleFtucl0gPSAnMCcgKyB2YWw7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gJyMnICsgaGV4LmpvaW4oJycpO1xufTtcblxudmFyIHJnYnN0cjJoZXggPSBmdW5jdGlvbihyZ2IpIHtcbiAgICByZ2IgPSByZ2IubWF0Y2goL15yZ2JhP1tcXHMrXT9cXChbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPy9pKTtcbiAgICByZXR1cm4gKHJnYiAmJiByZ2IubGVuZ3RoID09PSA0KSA/IFwiI1wiICtcbiAgICAoXCIwXCIgKyBwYXJzZUludChyZ2JbMV0sIDEwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKSArXG4gICAgKFwiMFwiICsgcGFyc2VJbnQocmdiWzJdLCAxMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtMikgK1xuICAgIChcIjBcIiArIHBhcnNlSW50KHJnYlszXSwgMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpIDogJyc7XG59O1xuXG4vLyBDb252ZXJ0cyBhbiBIU0Igb2JqZWN0IHRvIGEgaGV4IHN0cmluZ1xudmFyIGhzYjJoZXggPSBmdW5jdGlvbihoc2IpIHtcbiAgICByZXR1cm4gcmdiMmhleChoc2IycmdiKGhzYikpO1xufTtcblxuLy8gQ29udmVydHMgYSBoZXggc3RyaW5nIHRvIGFuIEhTQiBvYmplY3RcbnZhciBoZXgyaHNiID0gZnVuY3Rpb24oaGV4KSB7XG4gICAgdmFyIGhzYiA9IHJnYjJoc2IoaGV4MnJnYihoZXgpKTtcbiAgICBpZiAoaHNiLnMgPT09IDApIGhzYi5oID0gMzYwO1xuICAgIHJldHVybiBoc2I7XG59O1xuXG4vLyBDb252ZXJ0cyBhbiBSR0Igb2JqZWN0IHRvIGFuIEhTQiBvYmplY3RcbnZhciByZ2IyaHNiID0gZnVuY3Rpb24ocmdiKSB7XG4gICAgdmFyIGhzYiA9IHtcbiAgICAgICAgaDogMCxcbiAgICAgICAgczogMCxcbiAgICAgICAgYjogMFxuICAgIH07XG4gICAgdmFyIG1pbiA9IE1hdGgubWluKHJnYi5yLCByZ2IuZywgcmdiLmIpO1xuICAgIHZhciBtYXggPSBNYXRoLm1heChyZ2IuciwgcmdiLmcsIHJnYi5iKTtcbiAgICB2YXIgZGVsdGEgPSBtYXggLSBtaW47XG4gICAgaHNiLmIgPSBtYXg7XG4gICAgaHNiLnMgPSBtYXggIT09IDAgPyAyNTUgKiBkZWx0YSAvIG1heCA6IDA7XG4gICAgaWYgKGhzYi5zICE9PSAwKSB7XG4gICAgICAgIGlmIChyZ2IuciA9PT0gbWF4KSB7XG4gICAgICAgICAgICBoc2IuaCA9IChyZ2IuZyAtIHJnYi5iKSAvIGRlbHRhO1xuICAgICAgICB9IGVsc2UgaWYgKHJnYi5nID09PSBtYXgpIHtcbiAgICAgICAgICAgIGhzYi5oID0gMiArIChyZ2IuYiAtIHJnYi5yKSAvIGRlbHRhO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaHNiLmggPSA0ICsgKHJnYi5yIC0gcmdiLmcpIC8gZGVsdGE7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBoc2IuaCA9IC0xO1xuICAgIH1cbiAgICBoc2IuaCAqPSA2MDtcbiAgICBpZiAoaHNiLmggPCAwKSB7XG4gICAgICAgIGhzYi5oICs9IDM2MDtcbiAgICB9XG4gICAgaHNiLnMgKj0gMTAwIC8gMjU1O1xuICAgIGhzYi5iICo9IDEwMCAvIDI1NTtcbiAgICByZXR1cm4gaHNiO1xufTtcblxuLy8gQ29udmVydHMgYSBoZXggc3RyaW5nIHRvIGFuIFJHQiBvYmplY3RcbnZhciBoZXgycmdiID0gZnVuY3Rpb24oaGV4KSB7XG4gICAgaGV4ID0gcGFyc2VJbnQoKChoZXguaW5kZXhPZignIycpID4gLTEpID8gaGV4LnN1YnN0cmluZygxKSA6IGhleCksIDE2KTtcbiAgICByZXR1cm4ge1xuICAgICAgICAvKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG4gICAgICAgIHI6IGhleCA+PiAxNixcbiAgICAgICAgZzogKGhleCAmIDB4MDBGRjAwKSA+PiA4LFxuICAgICAgICBiOiAoaGV4ICYgMHgwMDAwRkYpXG4gICAgICAgIC8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4gICAgfTtcbn07XG5cblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHggPSBuZXcgQ29sb3JQaWNrZXIoKSwgYm9keSA9ICQoJ2JvZHknKTtcbiAgICB4Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlbGVtZW50LCBoZXgsIG9wYWNpdHkpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXIpO1xuICAgICAgICB2YXIgcmdiICAgPSBoZXgycmdiKGhleCksXG4gICAgICAgICAgICB5aXEgICA9ICgoKHJnYi5yICogMjk5KSArIChyZ2IuZyAqIDU4NykgKyAocmdiLmIgKiAxMTQpKSAvIDEwMDApID49IDEyOCA/ICdkYXJrJyA6ICdsaWdodCcsXG4gICAgICAgICAgICBjaGVjayA9IHlpcSA9PSAnZGFyaycgfHwgKCFvcGFjaXR5IHx8IG9wYWNpdHkgPCAwLjM1KTtcblxuICAgICAgICBpZiAob3BhY2l0eSA8IDEpIHtcbiAgICAgICAgICAgIHZhciBzdHIgPSAncmdiYSgnICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnLCAnICsgb3BhY2l0eSArICcpJztcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUoeyBiYWNrZ3JvdW5kQ29sb3I6IHN0ciB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUoeyBiYWNrZ3JvdW5kQ29sb3I6IGhleCB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsZW1lbnQucGFyZW50KCcuY29sb3JwaWNrZXInKVshY2hlY2sgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2xpZ2h0LXRleHQnKTtcblxuICAgICAgICB0aGlzLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuZW1pdCgnaW5wdXQnKTtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgnaW5wdXQnLCB7IHRhcmdldDogZWxlbWVudCB9KTtcbiAgICAgICAgfSwgMTUwKTtcblxuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQ29sb3JQaWNrZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyICQgICAgICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9lbGVtZW50cy51dGlscycpLFxuICAgIHByaW1lICAgICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIHJlcXVlc3QgICAgICAgPSByZXF1aXJlKCdhZ2VudCcpLFxuICAgIHplbiAgICAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBkb21yZWFkeSAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICBiaW5kICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgcnRyaW0gICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3J0cmltJyksXG4gICAgZGVlcENsb25lICAgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9kZWVwQ2xvbmUnKSxcbiAgICBkZWVwRmlsbEluICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvZGVlcEZpbGxJbicpLFxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91aScpLm1vZGFsLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICBnZXRBamF4VVJMICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuZ2xvYmFsLFxuICAgIGRyb3B6b25lICAgICAgPSByZXF1aXJlKCdkcm9wem9uZScpO1xuXG52YXIgRmlsZVBpY2tlciA9IG5ldyBwcmltZSh7XG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBlbGVtZW50LmRhdGEoJ2c1LWZpbGVwaWNrZXInKTtcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YSA/IEpTT04ucGFyc2UoZGF0YSkgOiBmYWxzZTtcblxuICAgICAgICB0aGlzLmNvbG9ycyA9IHtcbiAgICAgICAgICAgIGVycm9yOiAnI0Q4NDc0NycsXG4gICAgICAgICAgICBzdWNjZXNzOiAnIzlBREY4NycsXG4gICAgICAgICAgICBzbWFsbDogJyNhYWFhYWEnLFxuICAgICAgICAgICAgZ3JhZGllbnQ6IFsnIzllMzhlYicsICcjNGU2OGZjJ11cbiAgICAgICAgfTtcblxuICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMuZGF0YSk7XG4gICAgfSxcblxuICAgIG9wZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgZGF0YTogdGhpcy5kYXRhLFxuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcnLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZzUtZGlhbG9nLXRoZW1lLWRlZmF1bHQgZzUtbW9kYWwtZmlsZXBpY2tlcicsXG4gICAgICAgICAgICByZW1vdGU6IGdldEFqYXhVUkwoJ2ZpbGVwaWNrZXInKSArIGdldEFqYXhTdWZmaXgoKSxcbiAgICAgICAgICAgIHJlbW90ZUxvYWRlZDogYmluZCh0aGlzLmxvYWRlZCwgdGhpcyksXG4gICAgICAgICAgICBhZnRlckNsb3NlOiBiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRyb3B6b25lKSB7IHRoaXMuZHJvcHpvbmUuZGVzdHJveSgpOyB9XG4gICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgZ2V0UGF0aDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhY3RpdmVzID0gdGhpcy5jb250ZW50LnNlYXJjaCgnLmctZm9sZGVycyAuYWN0aXZlJyksIGFjdGl2ZSwgcGF0aDtcbiAgICAgICAgaWYgKCFhY3RpdmVzKSB7IHJldHVybiBudWxsOyB9XG5cbiAgICAgICAgYWN0aXZlID0gJChhY3RpdmVzW2FjdGl2ZXMubGVuZ3RoIC0gMV0pO1xuICAgICAgICBwYXRoID0gSlNPTi5wYXJzZShhY3RpdmUuZGF0YSgnZm9sZGVyJykpLnBhdGhuYW1lO1xuICAgICAgICByZXR1cm4gcnRyaW0ocGF0aCwgJy8nKSArICcvJztcbiAgICB9LFxuXG4gICAgZ2V0UHJldmlld1RlbXBsYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGxpICAgID0gemVuKCdsaVtkYXRhLWZpbGVdJyksXG4gICAgICAgICAgICB0aHVtYiA9IHplbignZGl2LmctdGh1bWJbZGF0YS1kei10aHVtYm5haWxdJykuYm90dG9tKGxpKSxcbiAgICAgICAgICAgIG5hbWUgID0gemVuKCdzcGFuLmctZmlsZS1uYW1lW2RhdGEtZHotbmFtZV0nKS5ib3R0b20obGkpLFxuICAgICAgICAgICAgc2l6ZSAgPSB6ZW4oJ3NwYW4uZy1maWxlLXNpemVbZGF0YS1kei1zaXplXScpLmJvdHRvbShsaSksXG4gICAgICAgICAgICBtdGltZSA9IHplbignc3Bhbi5nLWZpbGUtbXRpbWVbZGF0YS1kei1tdGltZV0nKS5ib3R0b20obGkpO1xuXG4gICAgICAgIHplbignc3Bhbi5nLWZpbGUtcHJvZ3Jlc3NbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpLmh0bWwoJzxzcGFuIGNsYXNzPVwiZy1maWxlLXByb2dyZXNzLXRleHRcIj48L3NwYW4+JykuYm90dG9tKGxpKTtcblxuICAgICAgICBsaS5ib3R0b20oJ2JvZHknKTtcbiAgICAgICAgdmFyIGh0bWwgPSBsaVswXS5vdXRlckhUTUw7XG4gICAgICAgIGxpLnJlbW92ZSgpO1xuXG4gICAgICAgIHJldHVybiBodG1sO1xuICAgIH0sXG5cbiAgICBsb2FkZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBtb2RhbEluc3RhbmNlKSB7XG4gICAgICAgIHZhciBjb250ZW50ICAgPSBtb2RhbEluc3RhbmNlLmVsZW1lbnRzLmNvbnRlbnQsXG4gICAgICAgICAgICBib29rbWFya3MgPSBjb250ZW50LnNlYXJjaCgnLmctYm9va21hcmsnKSxcbiAgICAgICAgICAgIGZpbGVzICAgICA9IGNvbnRlbnQuZmluZCgnLmctZmlsZXMnKSxcbiAgICAgICAgICAgIGZpZWxkRGF0YSA9IGRlZXBDbG9uZSh0aGlzLmRhdGEpLFxuICAgICAgICAgICAgY29sb3JzICAgID0gdGhpcy5jb2xvcnM7XG5cbiAgICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcblxuICAgICAgICBpZiAoZmlsZXMpIHtcbiAgICAgICAgICAgIHRoaXMuZHJvcHpvbmUgPSBuZXcgZHJvcHpvbmUoJ2JvZHknLCB7XG4gICAgICAgICAgICAgICAgcHJldmlld1RlbXBsYXRlOiB0aGlzLmdldFByZXZpZXdUZW1wbGF0ZSgpLFxuICAgICAgICAgICAgICAgIHByZXZpZXdzQ29udGFpbmVyOiBmaWxlcy5maW5kKCd1bDpub3QoLmctbGlzdC1sYWJlbHMpJylbMF0sXG4gICAgICAgICAgICAgICAgdGh1bWJuYWlsV2lkdGg6IDEwMCxcbiAgICAgICAgICAgICAgICB0aHVtYm5haWxIZWlnaHQ6IDEwMCxcbiAgICAgICAgICAgICAgICB1cmw6IGJpbmQoZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0QWpheFVSTCgnZmlsZXBpY2tlci91cGxvYWQvJyArIHRoaXMuZ2V0UGF0aCgpICsgZmlsZVswXS5uYW1lKSArIGdldEFqYXhTdWZmaXgoKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgdGhpcy5kcm9wem9uZS5vbigndGh1bWJuYWlsJywgZnVuY3Rpb24oZmlsZSwgZGF0YVVybCkge1xuICAgICAgICAgICAgICAgICQoZmlsZS5wcmV2aWV3RWxlbWVudCkuZmluZCgnW2RhdGEtZHotdGh1bWJuYWlsXScpLmF0dHJpYnV0ZSgnc3R5bGUnLCAnYmFja2dyb3VuZC1pbWFnZTogdXJsKCcgKyBkYXRhVXJsICsgJyk7Jyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5kcm9wem9uZS5vbignYWRkZWRmaWxlJywgZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ICAgICAgPSAkKGZpbGUucHJldmlld0VsZW1lbnQpLFxuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlciAgICAgPSBlbGVtZW50LmZpbmQoJ1tkYXRhLWZpbGUtdXBsb2FkcHJvZ3Jlc3NdJyksXG4gICAgICAgICAgICAgICAgICAgIGlzTGlzdCAgICAgICA9IGZpbGVzLmhhc0NsYXNzKCdnLWZpbGVtb2RlLWxpc3QnKSxcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NDb25mID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0TG9jYXRpb246ICdib3R0b20nXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBpZiAoIWZpbGUudHlwZS5tYXRjaCgvaW1hZ2UuKi8pKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBleHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICAgICAgZXh0ID0gKCFleHQubGVuZ3RoIHx8IGV4dC5sZW5ndGggPT0gMSkgPyAnLScgOiBleHQucmV2ZXJzZSgpWzBdO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5nLXRodW1iJykudGV4dChleHQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHByb2dyZXNzQ29uZiA9IGRlZXBGaWxsSW4oKGlzTGlzdCA/IHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogMjAsXG4gICAgICAgICAgICAgICAgICAgIHRoaWNrbmVzczogMTAsXG4gICAgICAgICAgICAgICAgICAgIGZpbGw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvcnMuc21hbGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBncmFkaWVudDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICAgICAgICAgIHNpemU6IDUwLFxuICAgICAgICAgICAgICAgICAgICB0aGlja25lc3M6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQ6IGNvbG9ycy5ncmFkaWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSksIHByb2dyZXNzQ29uZik7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdnLWZpbGUtdXBsb2FkaW5nJyk7XG4gICAgICAgICAgICAgICAgdXBsb2FkZXIucHJvZ3Jlc3Nlcihwcm9ncmVzc0NvbmYpO1xuICAgICAgICAgICAgICAgIHVwbG9hZGVyLmF0dHJpYnV0ZSgndGl0bGUnLCAncHJvY2Vzc2luZy4uLicpLmZpbmQoJy5nLWZpbGUtcHJvZ3Jlc3MtdGV4dCcpLmh0bWwoJyZidWxsOyZidWxsOyZidWxsOycpLmF0dHJpYnV0ZSgndGl0bGUnLCAncHJvY2Vzc2luZy4uLicpO1xuXG4gICAgICAgICAgICB9KS5vbigncHJvY2Vzc2luZycsIGZ1bmN0aW9uKGZpbGUpIHtcblxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChmaWxlLnByZXZpZXdFbGVtZW50KS5maW5kKCdbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmctZmlsZS1wcm9ncmVzcy10ZXh0JykudGV4dCgnMCUnKS5hdHRyaWJ1dGUoJ3RpdGxlJywgJzAlJyk7XG5cbiAgICAgICAgICAgIH0pLm9uKCdzZW5kaW5nJywgZnVuY3Rpb24oZmlsZSwgeGhyLCBmb3JtRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGZpbGUucHJldmlld0VsZW1lbnQpLmZpbmQoJ1tkYXRhLWZpbGUtdXBsb2FkcHJvZ3Jlc3NdJyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyaWJ1dGUoJ3RpdGxlJywgJzAlJykuZmluZCgnLmctZmlsZS1wcm9ncmVzcy10ZXh0JykudGV4dCgnMCUnKS5hdHRyaWJ1dGUoJ3RpdGxlJywgJzAlJyk7XG5cbiAgICAgICAgICAgIH0pLm9uKCd1cGxvYWRwcm9ncmVzcycsIGZ1bmN0aW9uKGZpbGUsIHByb2dyZXNzLCBieXRlc1NlbnQpIHtcblxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChmaWxlLnByZXZpZXdFbGVtZW50KS5maW5kKCdbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucHJvZ3Jlc3Nlcih7IHZhbHVlOiBwcm9ncmVzcyAvIDEwMCB9KTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmF0dHJpYnV0ZSgndGl0bGUnLCBNYXRoLnJvdW5kKHByb2dyZXNzKSArICclJykuZmluZCgnLmctZmlsZS1wcm9ncmVzcy10ZXh0JykudGV4dChNYXRoLnJvdW5kKHByb2dyZXNzKSArICclJykuYXR0cmlidXRlKCd0aXRsZScsIE1hdGgucm91bmQocHJvZ3Jlc3MpICsgJyUnKTtcblxuICAgICAgICAgICAgfSkub24oJ2NvbXBsZXRlJywgZnVuY3Rpb24oZmlsZSkge1xuXG4gICAgICAgICAgICB9KS5vbignZXJyb3InLCBmdW5jdGlvbihmaWxlLCBlcnJvcikge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ICA9ICQoZmlsZS5wcmV2aWV3RWxlbWVudCksXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyID0gZWxlbWVudC5maW5kKCdbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICAgICA9IGVsZW1lbnQuZmluZCgnLmctZmlsZS1wcm9ncmVzcy10ZXh0JyksXG4gICAgICAgICAgICAgICAgICAgIGlzTGlzdCAgID0gZmlsZXMuaGFzQ2xhc3MoJ2ctZmlsZW1vZGUtbGlzdCcpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnZy1maWxlLWVycm9yJyk7XG5cbiAgICAgICAgICAgICAgICB1cGxvYWRlci50aXRsZSgnRXJyb3InKS5wcm9ncmVzc2VyKHtcbiAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGNvbG9ycy5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMSxcbiAgICAgICAgICAgICAgICAgICAgdGhpY2tuZXNzOiBpc0xpc3QgPyAxMCA6IDI1XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0ZXh0LnRpdGxlKCdFcnJvcicpLmh0bWwoJzxpIGNsYXNzPVwiZmEgZmEtZXhjbGFtYXRpb25cIj48L2k+JykucGFyZW50KCdbZGF0YS1maWxlLXVwbG9hZHByb2dyZXNzXScpLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBlcnJvci5odG1sID8gZXJyb3IuaHRtbCA6IGVycm9yLFxuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ21vdXNlJyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6ICdhYm92ZS1tb2RhbCcsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldEV2ZW50czogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSkub24oJ3N1Y2Nlc3MnLCBmdW5jdGlvbihmaWxlLCByZXNwb25zZSwgeGhyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgID0gJChmaWxlLnByZXZpZXdFbGVtZW50KSxcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkZXIgPSBlbGVtZW50LmZpbmQoJ1tkYXRhLWZpbGUtdXBsb2FkcHJvZ3Jlc3NdJyksXG4gICAgICAgICAgICAgICAgICAgIG10aW1lICAgID0gZWxlbWVudC5maW5kKCcuZy1maWxlLW10aW1lJyksXG4gICAgICAgICAgICAgICAgICAgIHRleHQgICAgID0gZWxlbWVudC5maW5kKCcuZy1maWxlLXByb2dyZXNzLXRleHQnKSxcbiAgICAgICAgICAgICAgICAgICAgdGh1bWIgICAgPSBlbGVtZW50LmZpbmQoJy5nLXRodW1iJyksXG4gICAgICAgICAgICAgICAgICAgIGlzTGlzdCAgID0gZmlsZXMuaGFzQ2xhc3MoJ2ctZmlsZW1vZGUtbGlzdCcpO1xuXG4gICAgICAgICAgICAgICAgdXBsb2FkZXIucHJvZ3Jlc3Nlcih7XG4gICAgICAgICAgICAgICAgICAgIGZpbGw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvcnMuc3VjY2VzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMSxcbiAgICAgICAgICAgICAgICAgICAgdGhpY2tuZXNzOiBpc0xpc3QgPyAxMCA6IDI1XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0ZXh0Lmh0bWwoJzxpIGNsYXNzPVwiZmEgZmEtY2hlY2tcIj48L2k+Jyk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIHsgZHVyYXRpb246IDUwMCB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGh1bWIuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdnLWZpbGUtdXBsb2FkaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkZXIucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXRpbWUudGV4dCgnanVzdCBub3cnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIDUwMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJy5nLWJvb2ttYXJrLXRpdGxlJywgZnVuY3Rpb24oZSwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgICAgIHZhciBzaWJsaW5nID0gZWxlbWVudC5uZXh0U2libGluZygnLmctZm9sZGVycycpLFxuICAgICAgICAgICAgICAgIHBhcmVudCAgPSBlbGVtZW50LnBhcmVudCgnLmctYm9va21hcmsnKTtcblxuICAgICAgICAgICAgaWYgKCFzaWJsaW5nKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgc2libGluZy5zbGlkZVRvZ2dsZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwYXJlbnQudG9nZ2xlQ2xhc3MoJ2NvbGxhcHNlZCcsIHNpYmxpbmcuZ1NsaWRlQ29sbGFwc2VkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb250ZW50LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1mb2xkZXJdJywgYmluZChmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShlbGVtZW50LmRhdGEoJ2ZvbGRlcicpKTtcblxuICAgICAgICAgICAgZmllbGREYXRhLnJvb3QgPSBkYXRhLnBhdGhuYW1lO1xuICAgICAgICAgICAgZmllbGREYXRhLnN1YmZvbGRlciA9IHRydWU7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuc2hvd0luZGljYXRvcignZmEgZmEtbGkgZmEtZncgZmEtc3Bpbi1mYXN0IGZhLXNwaW5uZXInKTtcbiAgICAgICAgICAgIHJlcXVlc3QoZ2V0QWpheFVSTCgnZmlsZXBpY2tlcicpICsgZ2V0QWpheFN1ZmZpeCgpLCBmaWVsZERhdGEpLnNlbmQoYmluZChmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmhpZGVJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEFjdGl2ZVN0YXRlKGVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyT3BlbjogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5ib2R5Lmh0bWwpIHsgY29udGFpbmVyLnN0eWxlKHsgd2lkdGg6ICc5MCUnIH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkdW1teSwgbmV4dDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmJvZHkuc3ViZm9sZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdW1teSA9IHplbignZGl2JykuaHRtbChyZXNwb25zZS5ib2R5LnN1YmZvbGRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0ID0gZWxlbWVudC5uZXh0U2libGluZygpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dCAmJiAhbmV4dC5hdHRyaWJ1dGUoJ2RhdGEtZm9sZGVyJykpIHsgbmV4dC5yZW1vdmUoKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZHVtbXkuY2hpbGRyZW4oKS5hZnRlcihlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5ib2R5LmZpbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlcy5lbXB0eSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVtbXkgPSB6ZW4oJ2RpdicpLmh0bWwocmVzcG9uc2UuYm9keS5maWxlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdW1teS5jaGlsZHJlbigpLmJvdHRvbShmaWxlcykuc3R5bGUoeyBvcGFjaXR5OiAwIH0pLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIHsgZHVyYXRpb246ICcyNTBtcycgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlcy5maW5kKCc+IHVsOm5vdCguZy1saXN0LWxhYmVscyknKS5lbXB0eSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcm9wem9uZS5wcmV2aWV3c0NvbnRhaW5lciA9IGZpbGVzLmZpbmQoJ3VsOm5vdCguZy1saXN0LWxhYmVscyknKVswXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBjb250ZW50LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1maWxlXScsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5oYXNDbGFzcygnZy1maWxlLWVycm9yJykgfHwgZWxlbWVudC5oYXNDbGFzcygnZy1maWxlLXVwbG9hZGluZycpKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGVsZW1lbnQuZGF0YSgnZmlsZScpKTtcblxuICAgICAgICAgICAgZmlsZXMuc2VhcmNoKCdbZGF0YS1maWxlXScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLXNlbGVjdF0nLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gZmlsZXMuZmluZCgnW2RhdGEtZmlsZV0uc2VsZWN0ZWQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHNlbGVjdGVkID8gc2VsZWN0ZWQuZGF0YSgnZmlsZS11cmwnKSA6ICcnO1xuXG4gICAgICAgICAgICAkKHRoaXMuZGF0YS5maWVsZCkudmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWZpbGVzLW1vZGVdJywgYmluZChmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0NsYXNzKCdhY3RpdmUnKSkgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgdmFyIG1vZGVzID0gJCgnW2RhdGEtZmlsZXMtbW9kZV0nKTtcbiAgICAgICAgICAgIG1vZGVzLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICBmaWxlcy5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCB7XG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMCxcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RlICAgICAgICAgICA9IGVsZW1lbnQuZGF0YSgnZmlsZXMtbW9kZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkUHJvZ3Jlc3MgPSBmaWxlcy5zZWFyY2goJ1tkYXRhLWZpbGUtdXBsb2FkcHJvZ3Jlc3NdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0NvbmYgICA9IChtb2RlID09ICdsaXN0JykgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpY2tuZXNzOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvcnMuc21hbGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50OiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogNTAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpY2tuZXNzOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFkaWVudDogY29sb3JzLmdyYWRpZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgICAgICAgICAgZmlsZXMuYXR0cmlidXRlKCdjbGFzcycsICdnLWZpbGVzIGctYmxvY2sgZy1maWxlbW9kZS0nICsgbW9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWRQcm9ncmVzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkUHJvZ3Jlc3MuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGRlZXBDbG9uZShwcm9ncmVzc0NvbmYpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50KCcuZy1maWxlLWVycm9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmZpbGwgPSB7IGNvbG9yOiBjb2xvcnMuZXJyb3IgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLnZhbHVlID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLnRoaWNrbmVzcyA9IG1vZGUgPT0gJ2xpc3QnID8gMTAgOiAyNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnByb2dyZXNzZXIoY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIHsgZHVyYXRpb246IDIwMCB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIGFkZEFjdGl2ZVN0YXRlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBvcGVuZWQgPSB0aGlzLmNvbnRlbnQuc2VhcmNoKCdbZGF0YS1mb2xkZXJdLmFjdGl2ZSwgLmctZm9sZGVycyA+IC5hY3RpdmUnKSwgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQoKTtcbiAgICAgICAgaWYgKG9wZW5lZCkgeyBvcGVuZWQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOyB9XG5cbiAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgICAgd2hpbGUgKHBhcmVudC50YWcoKSA9PSAndWwnICYmICFwYXJlbnQuaGFzQ2xhc3MoJ2ctZm9sZGVycycpKSB7XG4gICAgICAgICAgICBwYXJlbnQucHJldmlvdXNTaWJsaW5nKCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudCgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbmRvbXJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIHZhciBib2R5ID0gJCgnYm9keScpO1xuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWc1LWZpbGVwaWNrZXJdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGlmICghZWxlbWVudC5HYW50cnlGaWxlUGlja2VyKSB7XG4gICAgICAgICAgICBlbGVtZW50LkdhbnRyeUZpbGVQaWNrZXIgPSBuZXcgRmlsZVBpY2tlcihlbGVtZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsZW1lbnQuR2FudHJ5RmlsZVBpY2tlci5vcGVuKCk7XG4gICAgfSk7XG59KTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IEZpbGVQaWNrZXI7IiwiXCJ1c2Ugc3RyaWN0XCI7XG4vLyBmb250cyBsaXN0OiBodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS93ZWJmb250cy92MS93ZWJmb250cz9rZXk9QUl6YVN5QjJ5Sk04REJ3dDY2dTJNVlJnYjZNNHQ5Q3FrVzdfSVJZXG52YXIgcHJpbWUgICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICB6ZW4gICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHN0b3JhZ2UgICAgID0gcmVxdWlyZSgncHJpbWUvbWFwJykoKSxcbiAgICBFbWl0dGVyICAgICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIGRvbXJlYWR5ICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcblxuICAgIGJpbmQgICAgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgbWFwICAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L21hcCcpLFxuICAgIGZvckVhY2ggICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9mb3JFYWNoJyksXG4gICAgY29udGFpbnMgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2NvbnRhaW5zJyksXG4gICAgbGFzdCAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2xhc3QnKSxcbiAgICBzcGxpdCAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvc3BsaXQnKSxcbiAgICByZW1vdmVBbGwgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvcmVtb3ZlQWxsJyksXG4gICAgaW5zZXJ0ICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2luc2VydCcpLFxuICAgIGZpbmQgICAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9maW5kJyksXG4gICAgY29tYmluZSAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2NvbWJpbmUnKSxcbiAgICBtZXJnZSAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L21lcmdlJyksXG5cbiAgICB1bmh5cGhlbmF0ZSA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3VuaHlwaGVuYXRlJyksXG4gICAgcHJvcGVyQ2FzZSAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy9wcm9wZXJDYXNlJyksXG4gICAgdHJpbSAgICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG5cbiAgICBtb2RhbCAgICAgICA9IHJlcXVpcmUoJy4uLy4uL3VpJykubW9kYWwsXG4gICAgYXN5bmMgICAgICAgPSByZXF1aXJlKCdhc3luYycpLFxuXG4gICAgcmVxdWVzdCAgICAgPSByZXF1aXJlKCdhZ2VudCcpLFxuXG4gICAgd2YgICAgICAgICAgPSByZXF1aXJlKCcuL3dlYmZvbnQnKTtcblxucmVxdWlyZSgnLi4vLi4vdXRpbHMvZWxlbWVudHMudmlld3BvcnQnKTtcblxudmFyIEZvbnRzID0gbmV3IHByaW1lKHtcblxuICAgIG1peGluOiBCb3VuZCxcblxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgcHJldmlld1NlbnRlbmNlOiB7XG4gICAgICAgICdsYXRpbic6ICdXaXphcmQgYm95IEphY2sgbG92ZXMgdGhlIGdydW1weSBRdWVlblxcJ3MgZm94LicsXG4gICAgICAgICdsYXRpbi1leHQnOiAnV2l6YXJkIGJveSBKYWNrIGxvdmVzIHRoZSBncnVtcHkgUXVlZW5cXCdzIGZveC4nLFxuICAgICAgICAnY3lyaWxsaWMnOiAn0JIg0YfQsNGJ0LDRhSDRjtCz0LAg0LbQuNC7INCx0Ysg0YbQuNGC0YDRg9GBPyDQlNCwLCDQvdC+INGE0LDQu9GM0YjQuNCy0YvQuSDRjdC60LfQtdC80L/Qu9GP0YAhJyxcbiAgICAgICAgJ2N5cmlsbGljLWV4dCc6ICfQkiDRh9Cw0YnQsNGFINGO0LPQsCDQttC40Lsg0LHRiyDRhtC40YLRgNGD0YE/INCU0LAsINC90L4g0YTQsNC70YzRiNC40LLRi9C5INGN0LrQt9C10LzQv9C70Y/RgCEnLFxuICAgICAgICAnZGV2YW5hZ2FyaSc6ICfgpI/gpJUg4KSq4KSyIOCkleCkviDgpJXgpY3gpLDgpYvgpKcg4KSG4KSq4KSV4KS+IOCkreCkteCkv+Ckt+CljeCkryDgpKzgpL/gpJfgpL7gpKEg4KS44KSV4KSk4KS+IOCkueCliCcsXG4gICAgICAgICdncmVlayc6ICfOpM6sz4fOuc+Dz4TOtyDOsc67z47PgM63zr4gzrLOsc+Gzq7PgiDPiM63zrzOrc69zrcgzrPOtywgzrTPgc6xz4POus61zrvOr862zrXOuSDPhc+Azq3PgSDOvc+JzrjPgc6/z40gzrrPhc69z4zPgicsXG4gICAgICAgICdncmVlay1leHQnOiAnzqTOrM+HzrnPg8+EzrcgzrHOu8+Oz4DOt86+IM6yzrHPhs6uz4Igz4jOt868zq3Ovc63IM6zzrcsIM60z4HOsc+DzrrOtc67zq/Ots61zrkgz4XPgM6tz4Egzr3Pic64z4HOv8+NIM66z4XOvc+Mz4InLFxuICAgICAgICAna2htZXInOiAn4Z6B4Z+S4Z6J4Z674Z+G4Z6i4Z624Z6F4Z6J4Z+J4Z624Z+G4Z6A4Z6J4Z+S4Z6F4Z6A4Z+L4Z6U4Z624Z6TIOGeiuGfhOGemeGeguGfkuGemOGetuGek+GelOGeieGfkuGeoOGeticsXG4gICAgICAgICd0ZWx1Z3UnOiAn4LCm4LGH4LC2IOCwreCwvuCwt+CwsuCwguCwpuCxgSDgsKTgsYbgsLLgsYHgsJfgsYEg4LCy4LGG4LC44LGN4LC4JyxcbiAgICAgICAgJ3ZpZXRuYW1lc2UnOiAnVMO0aSBjw7MgdGjhu4MgxINuIHRo4buneSB0aW5oIG3DoCBraMO0bmcgaOG6oWkgZ8OsLidcbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLndmID0gd2Y7XG4gICAgICAgIHRoaXMuZGF0YSA9IG51bGw7XG4gICAgICAgIHRoaXMuZmllbGQgPSBudWxsO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICAgICAgICB0aGlzLnRocm90dGxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgICB0aGlzLmxvYWRlZEZvbnRzID0gW107XG4gICAgICAgIHRoaXMuZmlsdGVycyA9IHtcbiAgICAgICAgICAgIHNlYXJjaDogJycsXG4gICAgICAgICAgICBzY3JpcHQ6ICdsYXRpbicsXG4gICAgICAgICAgICBjYXRlZ29yaWVzOiBbXVxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBvcGVuOiBmdW5jdGlvbihldmVudCwgZWxlbWVudCwgY29udGFpbmVyKSB7XG4gICAgICAgIGlmICghdGhpcy5kYXRhIHx8ICF0aGlzLmZpZWxkKSB7IHJldHVybiB0aGlzLmdldERhdGEoZWxlbWVudCk7IH1cblxuICAgICAgICB2YXIgbGlzdCA9IFtdO1xuICAgICAgICBmb3JFYWNoKHRoaXMuZGF0YSwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGxpc3QucHVzaCh2YWx1ZS5mYW1pbHkpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb250YWluZXIuZW1wdHkoKS5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCkuYXBwZW5kQ2hpbGQodGhpcy5idWlsZExheW91dCgpKTtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsKGNvbnRhaW5lci5maW5kKCd1bC5nLWZvbnRzLWxpc3QnKSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRvdGFsKCk7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdEZyb21WYWx1ZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICBjb250ZW50OiAnTG9hZGluZy4uLicsXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdnNS1kaWFsb2ctdGhlbWUtZGVmYXVsdCBnNS1tb2RhbC1mb250cycsXG4gICAgICAgICAgICBhZnRlck9wZW46IGJpbmQoZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZW1wdHkoKS5hcHBlbmRDaGlsZCh0aGlzLmJ1aWxkTGF5b3V0KCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbChjb250YWluZXIuZmluZCgndWwuZy1mb250cy1saXN0JykpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVRvdGFsKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0RnJvbVZhbHVlKCk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyksIDEpO1xuICAgICAgICAgICAgfSwgdGhpcylcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGdldERhdGE6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBlbGVtZW50LmRhdGEoJ2c1LWZvbnRwaWNrZXInKTtcbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGZvbnRwaWNrZXIgZGF0YSBmb3VuZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgIHRoaXMuZmllbGQgPSAkKGRhdGEuZmllbGQpO1xuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcuLi4nLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZzUtZGlhbG9nLXRoZW1lLWRlZmF1bHQgZzUtbW9kYWwtZm9udHMnLFxuICAgICAgICAgICAgcmVtb3RlOiBkYXRhLmRhdGEsXG4gICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGJpbmQoZnVuY3Rpb24ocmVzcG9uc2UsIGluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLmVsZW1lbnRzLmNvbnRlbnQuaHRtbChyZXNwb25zZS5ib2R5Lmh0bWwgKyAnWycgKyBkYXRhLmRhdGEgKyAnXScpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gcmVzcG9uc2UuYm9keS5pdGVtcztcblxuICAgICAgICAgICAgICAgIHRoaXMub3BlbihudWxsLCBlbGVtZW50LCBpbnN0YW5jZS5lbGVtZW50cy5jb250ZW50KTtcbiAgICAgICAgICAgIH0sIHRoaXMpXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzY3JvbGw6IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aHJvdHRsZSk7XG4gICAgICAgIHRoaXMudGhyb3R0bGUgPSBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudHMgPSAoY29udGFpbmVyLmZpbmQoJ3VsLmctZm9udHMtbGlzdCcpIHx8IGNvbnRhaW5lcikuaW52aWV3cG9ydCgnID4gbGk6bm90KC5nLWZvbnQtaGlkZSknLCA1MDAwKSxcbiAgICAgICAgICAgICAgICBsaXN0ID0gW107XG5cbiAgICAgICAgICAgIGlmICghZWxlbWVudHMpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICQoZWxlbWVudHMpLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhRm9udCA9IGVsZW1lbnQuZGF0YSgnZm9udCcpLFxuICAgICAgICAgICAgICAgICAgICB2YXJpYW50ID0gZWxlbWVudC5kYXRhKCd2YXJpYW50Jyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhaW5zKHRoaXMubG9hZGVkRm9udHMsIGRhdGFGb250KSkgeyBsaXN0LnB1c2goZGF0YUZvbnQgKyAodmFyaWFudCAhPSAncmVndWxhcicgPyAnOicgKyB2YXJpYW50IDogJycpKTsgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJ1tkYXRhLXZhcmlhbnQ9XCInICsgdmFyaWFudCArICdcIl0gLnByZXZpZXcnKS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb250RmFtaWx5OiBkYXRhRm9udCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6IHZhcmlhbnQgPT0gJ3JlZ3VsYXInID8gJ25vcm1hbCcgOiB2YXJpYW50XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICBpZiAoIWxpc3QgfHwgIWxpc3QubGVuZ3RoKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICB0aGlzLndmLmxvYWQoe1xuICAgICAgICAgICAgICAgIGNsYXNzZXM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGdvb2dsZToge1xuICAgICAgICAgICAgICAgICAgICBmYW1pbGllczogbGlzdFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZm9udGFjdGl2ZTogYmluZChmdW5jdGlvbihmYW1pbHksIGZ2ZCkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuZmluZCgnbGlbZGF0YS1mb250PVwiJyArIGZhbWlseSArICdcIl06bm90KC5nLXZhcmlhbnQtaGlkZSkgPiAucHJldmlldycpLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6IGZhbWlseSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6IGZ2ZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkZWRGb250cy5wdXNoKGZhbWlseSk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCB0aGlzKSwgMjUwKTtcbiAgICB9LFxuXG4gICAgdW5zZWxlY3Q6IGZ1bmN0aW9uKHNlbGVjdGVkKSB7XG4gICAgICAgIHNlbGVjdGVkID0gc2VsZWN0ZWQgfHwgdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgaWYgKCFzZWxlY3RlZCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgYmFzZVZhcmlhbnQgPSBzZWxlY3RlZC5lbGVtZW50LmRhdGEoJ3ZhcmlhbnQnKTtcbiAgICAgICAgc2VsZWN0ZWQuZWxlbWVudC5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgc2VsZWN0ZWQuZWxlbWVudC5zZWFyY2goJ2lucHV0W3R5cGU9Y2hlY2tib3hdJykuY2hlY2tlZChmYWxzZSk7XG4gICAgICAgIHNlbGVjdGVkLmVsZW1lbnQuc2VhcmNoKCdbZGF0YS1mb250XScpLmFkZENsYXNzKCdnLXZhcmlhbnQtaGlkZScpO1xuICAgICAgICBzZWxlY3RlZC5lbGVtZW50LmZpbmQoJ1tkYXRhLXZhcmlhbnQ9XCInICsgYmFzZVZhcmlhbnQgKyAnXCJdJykucmVtb3ZlQ2xhc3MoJ2ctdmFyaWFudC1oaWRlJyk7XG4gICAgICAgIHNlbGVjdGVkLnZhcmlhbnRzID0gW3NlbGVjdGVkLmJhc2VWYXJpYW50XTtcbiAgICAgICAgc2VsZWN0ZWQuc2VsZWN0ZWQgPSBbXTtcbiAgICB9LFxuXG4gICAgc2VsZWN0RnJvbVZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5maWVsZC52YWx1ZSgpO1xuXG4gICAgICAgIGlmICghdmFsdWUubWF0Y2goJ2ZhbWlseT0nKSkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgc3BsaXQgPSB2YWx1ZS5zcGxpdCgnJicpLFxuICAgICAgICAgICAgZmFtaWx5ID0gc3BsaXRbMF0sXG4gICAgICAgICAgICBzcGxpdDIgPSBmYW1pbHkuc3BsaXQoJzonKSxcbiAgICAgICAgICAgIG5hbWUgPSBzcGxpdDJbMF0ucmVwbGFjZSgnZmFtaWx5PScsICcnKS5yZXBsYWNlKC9cXCsvZywgJyAnKSxcbiAgICAgICAgICAgIHZhcmlhbnRzID0gc3BsaXQyWzFdID8gc3BsaXQyWzFdLnNwbGl0KCcsJykgOiBbJ3JlZ3VsYXInXSxcbiAgICAgICAgICAgIHN1YnNldCA9IHNwbGl0WzFdID8gc3BsaXRbMV0ucmVwbGFjZSgnc3Vic2V0PScsICcnKS5zcGxpdCgnLCcpIDogWydsYXRpbiddO1xuXG4gICAgICAgIGlmIChjb250YWlucyh2YXJpYW50cywgJzQwMCcpKSB7XG4gICAgICAgICAgICByZW1vdmVBbGwodmFyaWFudHMsICc0MDAnKTtcbiAgICAgICAgICAgIGluc2VydCh2YXJpYW50cywgJ3JlZ3VsYXInKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGFpbnModmFyaWFudHMsICc0MDBpdGFsaWMnKSkge1xuICAgICAgICAgICAgcmVtb3ZlQWxsKHZhcmlhbnRzLCAnNDAwaXRhbGljJyk7XG4gICAgICAgICAgICBpbnNlcnQodmFyaWFudHMsICdpdGFsaWMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBlbGVtZW50ID0gJCgndWwuZy1mb250cy1saXN0ID4gW2RhdGEtZm9udD1cIicgKyBuYW1lICsgJ1wiXScpO1xuXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB7XG4gICAgICAgICAgICBmb250OiBuYW1lLFxuICAgICAgICAgICAgYmFzZVZhcmlhbnQ6IGVsZW1lbnQuZGF0YSgndmFyaWFudCcpLFxuICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgICAgIHZhcmlhbnRzOiB2YXJpYW50cyxcbiAgICAgICAgICAgIHNlbGVjdGVkOiBbXSxcbiAgICAgICAgICAgIGNoYXJzZXRzOiBzdWJzZXQsXG4gICAgICAgICAgICBhdmFpbGFibGVWYXJpYW50czogZWxlbWVudC5kYXRhKCd2YXJpYW50cycpLnNwbGl0KCcsJyksXG4gICAgICAgICAgICBleHBhbmRlZDogZmFsc2UsXG4gICAgICAgICAgICBsb2FkZWQ6IGZhbHNlXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyaWFudHMuZm9yRWFjaChmdW5jdGlvbih2YXJpYW50KSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdChlbGVtZW50LCB2YXJpYW50KTtcbiAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnPiB1bCA+IFtkYXRhLXZhcmlhbnQ9XCInICsgdmFyaWFudCArICdcIl0nKS5yZW1vdmVDbGFzcygnZy12YXJpYW50LWhpZGUnKTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgdmFyIGNoYXJzZXRTZWxlY3RlZCA9IGVsZW1lbnQuZmluZCgnLmZvbnQtY2hhcnNldHMtc2VsZWN0ZWQnKTtcbiAgICAgICAgaWYgKGNoYXJzZXRTZWxlY3RlZCkgeyBjaGFyc2V0U2VsZWN0ZWQudGV4dCgnKCcgKyBzdWJzZXQubGVuZ3RoICsgJyBzZWxlY3RlZCknKTsgfVxuXG4gICAgICAgICQoJ3VsLmctZm9udHMtbGlzdCcpWzBdLnNjcm9sbFRvcCA9IGVsZW1lbnRbMF0ub2Zmc2V0VG9wO1xuICAgICAgICB0aGlzLnRvZ2dsZUV4cGFuc2lvbigpO1xuICAgICAgICBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7IHRoaXMudG9nZ2xlRXhwYW5zaW9uKCk7IH0sIHRoaXMpLCA1MCk7XG4gICAgfSxcblxuICAgIHNlbGVjdDogZnVuY3Rpb24oZWxlbWVudCwgdmFyaWFudC8qLCB0YXJnZXQqLykge1xuICAgICAgICB2YXIgYmFzZVZhcmlhbnQgPSBlbGVtZW50LmRhdGEoJ3ZhcmlhbnQnKTtcblxuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWQgfHwgdGhpcy5zZWxlY3RlZC5lbGVtZW50ICE9IGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmICh2YXJpYW50ICYmIHRoaXMuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2hhcnNldFNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZC5lbGVtZW50LmZpbmQoJy5mb250LWNoYXJzZXRzLXNlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgaWYgKGNoYXJzZXRTZWxlY3RlZCkgeyBjaGFyc2V0U2VsZWN0ZWQudGV4dCgnKDEgc2VsZWN0ZWQpJyk7IH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB7XG4gICAgICAgICAgICAgICAgZm9udDogZWxlbWVudC5kYXRhKCdmb250JyksXG4gICAgICAgICAgICAgICAgYmFzZVZhcmlhbnQ6IGJhc2VWYXJpYW50LFxuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgdmFyaWFudHM6IFtiYXNlVmFyaWFudF0sXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IFtdLFxuICAgICAgICAgICAgICAgIGNoYXJzZXRzOiBbJ2xhdGluJ10sXG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlVmFyaWFudHM6IGVsZW1lbnQuZGF0YSgndmFyaWFudHMnKS5zcGxpdCgnLCcpLFxuICAgICAgICAgICAgICAgIGV4cGFuZGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBsb2FkZWQ6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF2YXJpYW50KSB7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZUV4cGFuc2lvbigpO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAodmFyaWFudCkge1xuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gKCQoJ3VsLmctZm9udHMtbGlzdCA+IFtkYXRhLWZvbnRdOm5vdChbZGF0YS1mb250PVwiJyArIHRoaXMuc2VsZWN0ZWQuZm9udCArICdcIl0pIGlucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJykpO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQuY2hlY2tlZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQucGFyZW50KCdbZGF0YS12YXJpYW50c10nKS5yZW1vdmVDbGFzcygnZm9udC1zZWxlY3RlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNoZWNrYm94ID0gdGhpcy5zZWxlY3RlZC5lbGVtZW50LmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXVt2YWx1ZT1cIicgKyB2YXJpYW50ICsgJ1wiXScpLFxuICAgICAgICAgICAgICAgIGNoZWNrZWQgPSBjaGVja2JveC5jaGVja2VkKCk7XG4gICAgICAgICAgICBpZiAoY2hlY2tib3gpIHtcbiAgICAgICAgICAgICAgICBjaGVja2JveC5jaGVja2VkKCFjaGVja2VkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFjaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgaW5zZXJ0KHRoaXMuc2VsZWN0ZWQudmFyaWFudHMsIHZhcmlhbnQpO1xuICAgICAgICAgICAgICAgIGluc2VydCh0aGlzLnNlbGVjdGVkLnNlbGVjdGVkLCB2YXJpYW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhcmlhbnQgIT0gdGhpcy5zZWxlY3RlZC5iYXNlVmFyaWFudCkgeyByZW1vdmVBbGwodGhpcy5zZWxlY3RlZC52YXJpYW50cywgdmFyaWFudCk7IH1cbiAgICAgICAgICAgICAgICByZW1vdmVBbGwodGhpcy5zZWxlY3RlZC5zZWxlY3RlZCwgdmFyaWFudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdG9nZ2xlRXhwYW5zaW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQuYXZhaWxhYmxlVmFyaWFudHMubGVuZ3RoIDw9IDEpIHsgcmV0dXJuOyB9XG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZC5leHBhbmRlZCkge1xuICAgICAgICAgICAgdmFyIHZhcmlhbnRzID0gdGhpcy5zZWxlY3RlZC5lbGVtZW50LmRhdGEoJ3ZhcmlhbnRzJyksIHZhcmlhbnQ7XG4gICAgICAgICAgICBpZiAodmFyaWFudHMuc3BsaXQoJywnKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYW5pcHVsYXRlTGluayh0aGlzLnNlbGVjdGVkLmZvbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuZWxlbWVudC5zZWFyY2goJ1tkYXRhLWZvbnRdJykucmVtb3ZlQ2xhc3MoJ2ctdmFyaWFudC1oaWRlJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWQubG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud2YubG9hZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc2VzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdvb2dsZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbWlsaWVzOiBbdGhpcy5zZWxlY3RlZC5mb250LnJlcGxhY2UoL1xccy9nLCAnKycpICsgJzonICsgdmFyaWFudHNdXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udGFjdGl2ZTogYmluZChmdW5jdGlvbihmYW1pbHksIGZ2ZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHlsZSA9IHRoaXMuZnZkVG9TdHlsZShmYW1pbHksIGZ2ZCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaCA9IHN0eWxlLmZvbnRXZWlnaHQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VhcmNoID09ICc0MDAnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaCA9IHN0eWxlLmZvbnRTdHlsZSA9PSAnbm9ybWFsJyA/ICdyZWd1bGFyJyA6ICdpdGFsaWMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3R5bGUuZm9udFN0eWxlID09ICdpdGFsaWMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaCArPSAnaXRhbGljJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVsZW1lbnQuZmluZCgnbGlbZGF0YS12YXJpYW50PVwiJyArIHNlYXJjaCArICdcIl0gLnByZXZpZXcnKS5zdHlsZShzdHlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5sb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcylcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGV4Y2x1ZGUgPSAnOm5vdChbZGF0YS12YXJpYW50PVwiJyArIHRoaXMuc2VsZWN0ZWQudmFyaWFudHMuam9pbignXCJdKTpub3QoW2RhdGEtdmFyaWFudD1cIicpICsgJ1wiXSknO1xuICAgICAgICAgICAgZXhjbHVkZSA9IHRoaXMuc2VsZWN0ZWQuZWxlbWVudC5zZWFyY2goJ1tkYXRhLWZvbnRdJyArIGV4Y2x1ZGUpO1xuICAgICAgICAgICAgaWYgKGV4Y2x1ZGUpIHsgZXhjbHVkZS5hZGRDbGFzcygnZy12YXJpYW50LWhpZGUnKTsgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZWxlY3RlZC5leHBhbmRlZCA9ICF0aGlzLnNlbGVjdGVkLmV4cGFuZGVkO1xuICAgIH0sXG5cbiAgICBtYW5pcHVsYXRlTGluazogZnVuY3Rpb24oZmFtaWx5KSB7XG4gICAgICAgIGZhbWlseSA9IGZhbWlseS5yZXBsYWNlKC9cXHMvZywgJysnKTtcbiAgICAgICAgdmFyIGxpbmsgPSAkKCdoZWFkIGxpbmtbaHJlZio9XCInICsgZmFtaWx5ICsgJ1wiXScpO1xuICAgICAgICBpZiAoIWxpbmspIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdmFyIHBhcnRzID0gZGVjb2RlVVJJQ29tcG9uZW50KGxpbmsuaHJlZigpKS5zcGxpdCgnfCcpO1xuICAgICAgICBpZiAoIXBhcnRzIHx8IHBhcnRzLmxlbmd0aCA8PSAxKSB7IHJldHVybjsgfVxuXG4gICAgICAgIHJlbW92ZUFsbChwYXJ0cywgZmFtaWx5KTtcblxuICAgICAgICBsaW5rLmF0dHJpYnV0ZSgnaHJlZicsIGVuY29kZVVSSShwYXJ0cy5qb2luKCd8JykpKTtcbiAgICB9LFxuXG4gICAgdG9nZ2xlOiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KTtcblxuICAgICAgICBpZiAodGFyZ2V0LmF0dHJpYnV0ZSgndHlwZScpID09ICdjaGVja2JveCcpIHtcbiAgICAgICAgICAgIHRhcmdldC5jaGVja2VkKCF0YXJnZXQuY2hlY2tlZCgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2VsZWN0KGVsZW1lbnQucGFyZW50KCdbZGF0YS1mb250XScpIHx8IGVsZW1lbnQsIGVsZW1lbnQucGFyZW50KCdbZGF0YS1mb250XScpID8gZWxlbWVudC5kYXRhKCd2YXJpYW50JykgOiBmYWxzZSwgZWxlbWVudCk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICB1cGRhdGVTZWxlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcHJldmlldyA9ICQoJy5nLXBhcnRpY2xlcy1mb290ZXIgLmZvbnQtc2VsZWN0ZWQnKSwgc2VsZWN0ZWQ7XG4gICAgICAgIGlmICghcHJldmlldykgeyByZXR1cm47IH1cblxuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWQuc2VsZWN0ZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICBwcmV2aWV3LmVtcHR5KCk7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZvbnQtc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZC5zZWxlY3RlZC5zb3J0KCk7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQuZWxlbWVudC5hZGRDbGFzcygnZm9udC1zZWxlY3RlZCcpO1xuICAgICAgICBwcmV2aWV3Lmh0bWwoJzxzdHJvbmc+JyArIHRoaXMuc2VsZWN0ZWQuZm9udCArICc8L3N0cm9uZz4gKDxzbWFsbD4nICsgc2VsZWN0ZWQuam9pbignLCAnKS5yZXBsYWNlKCdyZWd1bGFyJywgJ25vcm1hbCcpICsgJzwvc21hbGw+KScpO1xuICAgIH0sXG5cbiAgICB1cGRhdGVUb3RhbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0b3RhbHMgPSAkKCcuZy1wYXJ0aWNsZXMtaGVhZGVyIC5wYXJ0aWNsZS1zZWFyY2gtdG90YWwnKSxcbiAgICAgICAgICAgIGNvdW50ID0gJCgnLmctZm9udHMtbGlzdCA+IFtkYXRhLWZvbnRdOm5vdCguZy1mb250LWhpZGUpJyk7XG5cbiAgICAgICAgdG90YWxzLnRleHQoY291bnQgPyBjb3VudC5sZW5ndGggOiAwKTtcbiAgICB9LFxuXG4gICAgYnVpbGRMYXlvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmZpbHRlcnMuc2NyaXB0ID0gJ2xhdGluJztcbiAgICAgICAgdmFyIHByZXZpZXdTZW50ZW5jZSA9IHRoaXMucHJldmlld1NlbnRlbmNlW3RoaXMuZmlsdGVycy5zY3JpcHRdLFxuICAgICAgICAgICAgaHRtbCA9IHplbignZGl2I2ctZm9udHMuZy1ncmlkJyksXG4gICAgICAgICAgICBtYWluID0gemVuKCdkaXYuZy1wYXJ0aWNsZXMtbWFpbicpLmJvdHRvbShodG1sKSxcbiAgICAgICAgICAgIHVsID0gemVuKCd1bC5nLWZvbnRzLWxpc3QnKS5ib3R0b20obWFpbiksXG4gICAgICAgICAgICBmYW1pbGllcyA9IFtdLCBsaXN0LCBjYXRlZ29yaWVzID0gW10sIHN1YnNldHMgPSBbXTtcblxuXG4gICAgICAgIHRoaXMuYnVpbGRIZWFkZXIoaHRtbCkudG9wKGh0bWwpO1xuICAgICAgICB0aGlzLmJ1aWxkRm9vdGVyKGh0bWwpLmJvdHRvbShodG1sKTtcblxuICAgICAgICB1bC5vbignc2Nyb2xsJywgYmluZCh0aGlzLnNjcm9sbCwgdGhpcywgdWwpKTtcblxuICAgICAgICBodG1sLmRlbGVnYXRlKCdjbGljaycsICcuZy1mb250cy1saXN0IGxpW2RhdGEtZm9udF0nLCBiaW5kKHRoaXMudG9nZ2xlLCB0aGlzKSk7XG5cbiAgICAgICAgYXN5bmMuZWFjaFNlcmllcyh0aGlzLmRhdGEsIGJpbmQoZnVuY3Rpb24oZm9udCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNvbWJpbmUoc3Vic2V0cywgZm9udC5zdWJzZXRzKTtcbiAgICAgICAgICAgIGluc2VydChjYXRlZ29yaWVzLCBmb250LmNhdGVnb3J5KTtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVycy5jYXRlZ29yaWVzLnB1c2goZm9udC5jYXRlZ29yeSk7XG4gICAgICAgICAgICB2YXIgdmFyaWFudHMgPSBmb250LnZhcmlhbnRzLmpvaW4oJywnKS5yZXBsYWNlKCdyZWd1bGFyJywgJ25vcm1hbCcpLFxuICAgICAgICAgICAgICAgIHZhcmlhbnQgPSBjb250YWlucyhmb250LnZhcmlhbnRzLCAncmVndWxhcicpID8gJycgOiAnOicgKyBmb250LnZhcmlhbnRzWzBdLFxuICAgICAgICAgICAgICAgIGxpID0gemVuKCdsaVtkYXRhLWZvbnQ9XCInICsgZm9udC5mYW1pbHkgKyAnXCJdW2RhdGEtdmFyaWFudD1cIicgKyAodmFyaWFudC5yZXBsYWNlKCc6JywgJycpIHx8ICdyZWd1bGFyJykgKyAnXCJdW2RhdGEtdmFyaWFudHM9XCInICsgdmFyaWFudHMgKyAnXCJdJykuYm90dG9tKHVsKSxcbiAgICAgICAgICAgICAgICB0b3RhbCA9IGZvbnQudmFyaWFudHMubGVuZ3RoICsgJyBzdHlsZScgKyAoZm9udC52YXJpYW50cy5sZW5ndGggPiAxID8gJ3MnIDogJycpLFxuICAgICAgICAgICAgICAgIGNoYXJzZXRzID0gZm9udC5zdWJzZXRzLmxlbmd0aCA+IDEgPyAnLCA8c3BhbiBjbGFzcz1cImZvbnQtY2hhcnNldHNcIj4nICsgZm9udC5zdWJzZXRzLmxlbmd0aCArICcgY2hhcnNldHMgPHNwYW4gY2xhc3M9XCJmb250LWNoYXJzZXRzLXNlbGVjdGVkXCI+KDEgc2VsZWN0ZWQpPC9zcGFuPjwvc3Bhbj4nIDogJyc7XG5cbiAgICAgICAgICAgIHZhciBmYW1pbHkgPSB6ZW4oJ2Rpdi5mYW1pbHknKS5odG1sKCc8c3Ryb25nPicgKyBmb250LmZhbWlseSArICc8L3N0cm9uZz4sICcgKyB0b3RhbCArIGNoYXJzZXRzKS5ib3R0b20obGkpLFxuICAgICAgICAgICAgICAgIGNoYXJzZXQgPSBmYW1pbHkuZmluZCgnLmZvbnQtY2hhcnNldHMtc2VsZWN0ZWQnKTtcblxuICAgICAgICAgICAgaWYgKGNoYXJzZXQpIHtcbiAgICAgICAgICAgICAgICBjaGFyc2V0LnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICcyMDAnLFxuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnbW91c2UnLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogJ2ZvbnQtY2F0ZWdvcmllcywgYWJvdmUtbW9kYWwnXG4gICAgICAgICAgICAgICAgfSkub24oJ2JlZm9yZXNob3cucG9wb3ZlcicsIGJpbmQoZnVuY3Rpb24ocG9wb3Zlcikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3Vic2V0cyA9IGZvbnQuc3Vic2V0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBwb3BvdmVyLiR0YXJnZXQuZmluZCgnLmc1LXBvcG92ZXItY29udGVudCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZDtcblxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LmVtcHR5KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpdiwgY3VycmVudDtcbiAgICAgICAgICAgICAgICAgICAgc3Vic2V0cy5mb3JFYWNoKGZ1bmN0aW9uKGNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gY29udGFpbnModGhpcy5zZWxlY3RlZC5jaGFyc2V0cywgY3MpID8gKGNzID09ICdsYXRpbicgPyAnY2hlY2tlZCBkaXNhYmxlZCcgOiAnY2hlY2tlZCcpIDogJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB6ZW4oJ2RpdicpLmh0bWwoJzxsYWJlbD48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgJyArIGN1cnJlbnQgKyAnIHZhbHVlPVwiJyArIGNzICsgJ1wiLz4gJyArIHByb3BlckNhc2UodW5oeXBoZW5hdGUoY3MucmVwbGFjZSgnZXh0JywgJ2V4dGVuZGVkJykpKSArICc8L2xhYmVsPicpLmJvdHRvbShjb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGVudC5kZWxlZ2F0ZSgnY2xpY2snLCAnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJywgYmluZChmdW5jdGlvbihldmVudCwgaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0ID0gJChpbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkID0gY29udGVudC5zZWFyY2goJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmNoYXJzZXRzID0gY2hlY2tlZCA/IGNoZWNrZWQubWFwKCd2YWx1ZScpIDogW107XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFyc2V0LnRleHQoJygnICsgdGhpcy5zZWxlY3RlZC5jaGFyc2V0cy5sZW5ndGggKyAnIHNlbGVjdGVkKScpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcG9wb3Zlci5kaXNwbGF5Q29udGVudCgpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHZhcmlhbnRDb250YWluZXIgPSB6ZW4oJ3VsJykuYm90dG9tKGxpKSwgdmFyaWFudEZvbnQsIGxhYmVsO1xuICAgICAgICAgICAgYXN5bmMuZWFjaChmb250LnZhcmlhbnRzLCBiaW5kKGZ1bmN0aW9uKGN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXJpYW50Rm9udCA9IHplbignbGlbZGF0YS1mb250PVwiJyArIGZvbnQuZmFtaWx5ICsgJ1wiXVtkYXRhLXZhcmlhbnQ9XCInICsgY3VycmVudCArICdcIl0nKS5ib3R0b20odmFyaWFudENvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgemVuKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl1bdmFsdWU9XCInICsgY3VycmVudCArICdcIl0nKS5ib3R0b20odmFyaWFudEZvbnQpO1xuICAgICAgICAgICAgICAgIHplbignZGl2LnZhcmlhbnQnKS5odG1sKCc8c21hbGw+JyArIHRoaXMubWFwVmFyaWFudChjdXJyZW50KSArICc8L3NtYWxsPicpLmJvdHRvbSh2YXJpYW50Rm9udCk7XG4gICAgICAgICAgICAgICAgemVuKCdkaXYucHJldmlldycpLnRleHQocHJldmlld1NlbnRlbmNlKS5ib3R0b20odmFyaWFudEZvbnQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCc6JyArIGN1cnJlbnQgIT09IHZhcmlhbnQgJiYgY3VycmVudCAhPT0gKHZhcmlhbnQgfHwgJ3JlZ3VsYXInKSkgeyB2YXJpYW50Rm9udC5hZGRDbGFzcygnZy12YXJpYW50LWhpZGUnKTsgfVxuICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICBpZiAoIWNvbnRhaW5zKGZvbnQuc3Vic2V0cywgJ2xhdGluJykpIHtcbiAgICAgICAgICAgICAgICBsaS5hZGRDbGFzcygnZy1mb250LWhpZGUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZmFtaWxpZXMucHVzaChmb250LmZhbWlseSArIHZhcmlhbnQpO1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHZhciBjYXRDb250YWluZXIgPSBodG1sLmZpbmQoJ2EuZm9udC1jYXRlZ29yeScpLCBzdWJDb250YWluZXIgPSBodG1sLmZpbmQoJ2EuZm9udC1zdWJzZXRzJyk7XG5cbiAgICAgICAgY2F0Q29udGFpbmVyLmRhdGEoJ2ZvbnQtY2F0ZWdvcmllcycsIGNhdGVnb3JpZXMuam9pbignLCcpKS5odG1sKCdDYXRlZ29yaWVzICg8c21hbGw+JyArIGNhdGVnb3JpZXMubGVuZ3RoICsgJzwvc21hbGw+KSA8aSBjbGFzcz1cImZhIGZhLWNhcmV0LWRvd25cIj48L2k+Jyk7XG4gICAgICAgIHN1YkNvbnRhaW5lci5kYXRhKCdmb250LXN1YnNldHMnLCBzdWJzZXRzLmpvaW4oJywnKSkuaHRtbCgnU3Vic2V0cyAoPHNtYWxsPicgKyBwcm9wZXJDYXNlKHVuaHlwaGVuYXRlKHRoaXMuZmlsdGVycy5zY3JpcHQucmVwbGFjZSgnZXh0JywgJ2V4dGVuZGVkJykpKSArICc8L3NtYWxsPikgPGkgY2xhc3M9XCJmYSBmYS1jYXJldC1kb3duXCI+PC9pPicpO1xuXG4gICAgICAgIHJldHVybiBodG1sO1xuICAgIH0sXG5cbiAgICBidWlsZEhlYWRlcjogZnVuY3Rpb24oaHRtbCkge1xuICAgICAgICB2YXIgY29udGFpbmVyID0gemVuKCdkaXYuc2V0dGluZ3MtYmxvY2suZy1wYXJ0aWNsZXMtaGVhZGVyJykuYm90dG9tKGh0bWwpLFxuICAgICAgICAgICAgcHJldmlldyA9IHplbignaW5wdXQuZmxvYXQtbGVmdC5mb250LXByZXZpZXdbdHlwZT1cInRleHRcIl1bZGF0YS1mb250LXByZXZpZXddW3BsYWNlaG9sZGVyPVwiRm9udCBQcmV2aWV3Li4uXCJdW3ZhbHVlPVwiJyArIHRoaXMucHJldmlld1NlbnRlbmNlW3RoaXMuZmlsdGVycy5zY3JpcHRdICsgJ1wiXScpLmJvdHRvbShjb250YWluZXIpLFxuICAgICAgICAgICAgc2VhcmNoV3JhcHBlciA9IHplbignc3Bhbi5wYXJ0aWNsZS1zZWFyY2gtd3JhcHBlci5mbG9hdC1yaWdodCcpLmJvdHRvbShjb250YWluZXIpLFxuICAgICAgICAgICAgc2VhcmNoID0gemVuKCdpbnB1dC5mb250LXNlYXJjaFt0eXBlPVwidGV4dFwiXVtkYXRhLWZvbnQtc2VhcmNoXVtwbGFjZWhvbGRlcj1cIlNlYXJjaCBGb250Li4uXCJdJykuYm90dG9tKHNlYXJjaFdyYXBwZXIpO1xuICAgICAgICB6ZW4oJ3NwYW4ucGFydGljbGUtc2VhcmNoLXRvdGFsJykuYm90dG9tKHNlYXJjaFdyYXBwZXIpO1xuXG4gICAgICAgIHNlYXJjaC5vbigna2V5dXAnLCBiaW5kKHRoaXMuc2VhcmNoLCB0aGlzLCBzZWFyY2gpKTtcbiAgICAgICAgcHJldmlldy5vbigna2V5dXAnLCBiaW5kKHRoaXMudXBkYXRlUHJldmlldywgdGhpcywgcHJldmlldykpO1xuXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgfSxcblxuICAgIGJ1aWxkRm9vdGVyOiBmdW5jdGlvbihodG1sKSB7XG4gICAgICAgIHZhciBjb250YWluZXIgPSB6ZW4oJ2Rpdi5zZXR0aW5ncy1ibG9jay5nLXBhcnRpY2xlcy1mb290ZXInKS5ib3R0b20oaHRtbCksXG4gICAgICAgICAgICBsZWZ0Q29udGFpbmVyID0gemVuKCdkaXYuZmxvYXQtbGVmdC5mb250LWxlZnQtY29udGFpbmVyJykuYm90dG9tKGNvbnRhaW5lciksXG4gICAgICAgICAgICByaWdodENvbnRhaW5lciA9IHplbignZGl2LmZsb2F0LXJpZ2h0LmZvbnQtcmlnaHQtY29udGFpbmVyJykuYm90dG9tKGNvbnRhaW5lciksXG4gICAgICAgICAgICBjYXRlZ29yeSA9IHplbignYS5mb250LWNhdGVnb3J5LmJ1dHRvbicpLmJvdHRvbShsZWZ0Q29udGFpbmVyKSxcbiAgICAgICAgICAgIHN1YnNldHMgPSB6ZW4oJ2EuZm9udC1zdWJzZXRzLmJ1dHRvbicpLmJvdHRvbShsZWZ0Q29udGFpbmVyKSxcbiAgICAgICAgICAgIHNlbGVjdGVkID0gemVuKCdzcGFuLmZvbnQtc2VsZWN0ZWQnKS5ib3R0b20ocmlnaHRDb250YWluZXIpLFxuICAgICAgICAgICAgc2VsZWN0ID0gemVuKCdidXR0b24uYnV0dG9uLmJ1dHRvbi1wcmltYXJ5JykudGV4dCgnU2VsZWN0JykuYm90dG9tKHJpZ2h0Q29udGFpbmVyKSxcbiAgICAgICAgICAgIGN1cnJlbnQ7XG5cbiAgICAgICAgemVuKCdzcGFuJykuaHRtbCgnJm5ic3A7JykuYm90dG9tKHJpZ2h0Q29udGFpbmVyKTtcbiAgICAgICAgemVuKCdidXR0b24uYnV0dG9uLmc1LWRpYWxvZy1jbG9zZScpLnRleHQoJ0NhbmNlbCcpLmJvdHRvbShyaWdodENvbnRhaW5lcik7XG5cbiAgICAgICAgc2VsZWN0Lm9uKCdjbGljaycsIGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoISQoJ3VsLmctZm9udHMtbGlzdCA+IFtkYXRhLWZvbnRdIGlucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpZWxkLnZhbHVlKCcnKTtcbiAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGlzLnNlbGVjdGVkLmZvbnQucmVwbGFjZSgvXFxzL2csICcrJyksXG4gICAgICAgICAgICAgICAgdmFyaWF0aW9uID0gdGhpcy5zZWxlY3RlZC5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgICBjaGFyc2V0ID0gdGhpcy5zZWxlY3RlZC5jaGFyc2V0cztcblxuICAgICAgICAgICAgaWYgKHZhcmlhdGlvbi5sZW5ndGggPT0gMSAmJiB2YXJpYXRpb25bMF0gPT0gJ3JlZ3VsYXInKSB7IHZhcmlhdGlvbiA9IFtdOyB9XG4gICAgICAgICAgICBpZiAoY2hhcnNldC5sZW5ndGggPT0gMSAmJiBjaGFyc2V0WzBdID09ICdsYXRpbicpIHsgY2hhcnNldCA9IFtdOyB9XG5cbiAgICAgICAgICAgIGlmIChjb250YWlucyh2YXJpYXRpb24sICdyZWd1bGFyJykpIHtcbiAgICAgICAgICAgICAgICByZW1vdmVBbGwodmFyaWF0aW9uLCAncmVndWxhcicpO1xuICAgICAgICAgICAgICAgIGluc2VydCh2YXJpYXRpb24sICc0MDAnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb250YWlucyh2YXJpYXRpb24sICdpdGFsaWMnKSkge1xuICAgICAgICAgICAgICAgIHJlbW92ZUFsbCh2YXJpYXRpb24sICdpdGFsaWMnKTtcbiAgICAgICAgICAgICAgICBpbnNlcnQodmFyaWF0aW9uLCAnNDAwaXRhbGljJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZmllbGQudmFsdWUoJ2ZhbWlseT0nICsgbmFtZSArICh2YXJpYXRpb24ubGVuZ3RoID8gJzonICsgdmFyaWF0aW9uLmpvaW4oJywnKSA6ICcnKSArIChjaGFyc2V0Lmxlbmd0aCA/ICcmc3Vic2V0PScgKyBjaGFyc2V0LmpvaW4oJywnKSA6ICcnKSk7XG5cbiAgICAgICAgICAgIHRoaXMuZmllbGQuZW1pdCgnaW5wdXQnKTtcbiAgICAgICAgICAgICQoJ2JvZHknKS5lbWl0KCdpbnB1dCcsIHt0YXJnZXQ6IHRoaXMuZmllbGR9KTtcblxuICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIGNhdGVnb3J5LnBvcG92ZXIoe1xuICAgICAgICAgICAgcGxhY2VtZW50OiAndG9wJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMjAwJyxcbiAgICAgICAgICAgIHRyaWdnZXI6ICdtb3VzZScsXG4gICAgICAgICAgICBzdHlsZTogJ2ZvbnQtY2F0ZWdvcmllcywgYWJvdmUtbW9kYWwnXG4gICAgICAgIH0pLm9uKCdiZWZvcmVzaG93LnBvcG92ZXInLCBiaW5kKGZ1bmN0aW9uKHBvcG92ZXIpIHtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yaWVzID0gY2F0ZWdvcnkuZGF0YSgnZm9udC1jYXRlZ29yaWVzJykuc3BsaXQoJywnKSxcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gcG9wb3Zlci4kdGFyZ2V0LmZpbmQoJy5nNS1wb3BvdmVyLWNvbnRlbnQnKSxcbiAgICAgICAgICAgICAgICBjaGVja2VkO1xuXG4gICAgICAgICAgICBjb250ZW50LmVtcHR5KCk7XG5cbiAgICAgICAgICAgIHZhciBkaXY7XG4gICAgICAgICAgICBjYXRlZ29yaWVzLmZvckVhY2goZnVuY3Rpb24oY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50ID0gY29udGFpbnModGhpcy5maWx0ZXJzLmNhdGVnb3JpZXMsIGNhdGVnb3J5KSA/ICdjaGVja2VkJyA6ICcnO1xuICAgICAgICAgICAgICAgIHplbignZGl2JykuaHRtbCgnPGxhYmVsPjxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiAnICsgY3VycmVudCArICcgdmFsdWU9XCInICsgY2F0ZWdvcnkgKyAnXCIvPiAnICsgcHJvcGVyQ2FzZSh1bmh5cGhlbmF0ZShjYXRlZ29yeSkpICsgJzwvbGFiZWw+JykuYm90dG9tKGNvbnRlbnQpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NsaWNrJywgJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGlucHV0KSB7XG4gICAgICAgICAgICAgICAgaW5wdXQgPSAkKGlucHV0KTtcbiAgICAgICAgICAgICAgICBjaGVja2VkID0gY29udGVudC5zZWFyY2goJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJzLmNhdGVnb3JpZXMgPSBjaGVja2VkID8gY2hlY2tlZC5tYXAoJ3ZhbHVlJykgOiBbXTtcbiAgICAgICAgICAgICAgICBjYXRlZ29yeS5maW5kKCdzbWFsbCcpLnRleHQodGhpcy5maWx0ZXJzLmNhdGVnb3JpZXMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaCgpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICBwb3BvdmVyLmRpc3BsYXlDb250ZW50KCk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICBzdWJzZXRzLnBvcG92ZXIoe1xuICAgICAgICAgICAgcGxhY2VtZW50OiAndG9wJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMjAwJyxcbiAgICAgICAgICAgIHRyaWdnZXI6ICdtb3VzZScsXG4gICAgICAgICAgICBzdHlsZTogJ2ZvbnQtc3Vic2V0cywgYWJvdmUtbW9kYWwnXG4gICAgICAgIH0pLm9uKCdiZWZvcmVzaG93LnBvcG92ZXInLCBiaW5kKGZ1bmN0aW9uKHBvcG92ZXIpIHtcbiAgICAgICAgICAgIHZhciBzdWJzID0gc3Vic2V0cy5kYXRhKCdmb250LXN1YnNldHMnKS5zcGxpdCgnLCcpLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBwb3BvdmVyLiR0YXJnZXQuZmluZCgnLmc1LXBvcG92ZXItY29udGVudCcpO1xuXG4gICAgICAgICAgICBjb250ZW50LmVtcHR5KCk7XG5cbiAgICAgICAgICAgIHZhciBkaXY7XG4gICAgICAgICAgICBzdWJzLmZvckVhY2goZnVuY3Rpb24oc3ViKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudCA9IHN1YiA9PSB0aGlzLmZpbHRlcnMuc2NyaXB0ID8gJ2NoZWNrZWQnIDogJyc7XG4gICAgICAgICAgICAgICAgemVuKCdkaXYnKS5odG1sKCc8bGFiZWw+PGlucHV0IG5hbWU9XCJmb250LXN1YnNldFtdXCIgdHlwZT1cInJhZGlvXCIgJyArIGN1cnJlbnQgKyAnIHZhbHVlPVwiJyArIHN1YiArICdcIi8+ICcgKyBwcm9wZXJDYXNlKHVuaHlwaGVuYXRlKHN1Yi5yZXBsYWNlKCdleHQnLCAnZXh0ZW5kZWQnKSkpICsgJzwvbGFiZWw+JykuYm90dG9tKGNvbnRlbnQpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIGNvbnRlbnQuZGVsZWdhdGUoJ2NoYW5nZScsICdpbnB1dFt0eXBlPVwicmFkaW9cIl0nLCBiaW5kKGZ1bmN0aW9uKGV2ZW50LCBpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlucHV0ID0gJChpbnB1dCk7XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJzLnNjcmlwdCA9IGlucHV0LnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgJCgnLmctcGFydGljbGVzLWhlYWRlciBpbnB1dC5mb250LXByZXZpZXcnKS52YWx1ZSh0aGlzLnByZXZpZXdTZW50ZW5jZVt0aGlzLmZpbHRlcnMuc2NyaXB0XSk7XG4gICAgICAgICAgICAgICAgc3Vic2V0cy5maW5kKCdzbWFsbCcpLnRleHQocHJvcGVyQ2FzZSh1bmh5cGhlbmF0ZShpbnB1dC52YWx1ZSgpLnJlcGxhY2UoJ2V4dCcsICdleHRlbmRlZCcpKSkpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcmV2aWV3KCk7XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgIHBvcG92ZXIuZGlzcGxheUNvbnRlbnQoKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgfSxcblxuICAgIHNlYXJjaDogZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgaW5wdXQgPSBpbnB1dCB8fCAkKCcuZy1wYXJ0aWNsZXMtaGVhZGVyIGlucHV0LmZvbnQtc2VhcmNoJyk7XG4gICAgICAgIHZhciBsaXN0ID0gJCgnLmctZm9udHMtbGlzdCcpLFxuICAgICAgICAgICAgdmFsdWUgPSBpbnB1dC52YWx1ZSgpLFxuICAgICAgICAgICAgbmFtZSwgZGF0YTtcblxuICAgICAgICBsaXN0LnNlYXJjaCgnPiBbZGF0YS1mb250XScpLmZvckVhY2goZnVuY3Rpb24oZm9udCkge1xuICAgICAgICAgICAgZm9udCA9ICQoZm9udCk7XG4gICAgICAgICAgICBuYW1lID0gZm9udC5kYXRhKCdmb250Jyk7XG4gICAgICAgICAgICBkYXRhID0gZmluZCh0aGlzLmRhdGEsIHsgZmFtaWx5OiBuYW1lIH0pO1xuICAgICAgICAgICAgZm9udC5yZW1vdmVDbGFzcygnZy1mb250LWhpZGUnKTtcblxuICAgICAgICAgICAgLy8gV2UgZG9udCB3YW50IHRvIGhpZGUgc2VsZWN0ZWQgZm9udHNcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkICYmIHRoaXMuc2VsZWN0ZWQuZm9udCA9PSBuYW1lICYmIHRoaXMuc2VsZWN0ZWQuc2VsZWN0ZWQubGVuZ3RoKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICAvLyBGaWx0ZXIgYnkgU3Vic2V0XG4gICAgICAgICAgICBpZiAoIWNvbnRhaW5zKGRhdGEuc3Vic2V0cywgdGhpcy5maWx0ZXJzLnNjcmlwdCkpIHtcbiAgICAgICAgICAgICAgICBmb250LmFkZENsYXNzKCdnLWZvbnQtaGlkZScpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmlsdGVyIGJ5IENhdGVnb3J5XG4gICAgICAgICAgICBpZiAoIWNvbnRhaW5zKHRoaXMuZmlsdGVycy5jYXRlZ29yaWVzLCBkYXRhLmNhdGVnb3J5KSkge1xuICAgICAgICAgICAgICAgIGZvbnQuYWRkQ2xhc3MoJ2ctZm9udC1oaWRlJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGaWx0ZXIgYnkgTmFtZVxuICAgICAgICAgICAgaWYgKCFuYW1lLm1hdGNoKG5ldyBSZWdFeHAoXCJeXCIgKyB2YWx1ZSArICd8XFxcXHMnICsgdmFsdWUsICdnaScpKSkge1xuICAgICAgICAgICAgICAgIGZvbnQuYWRkQ2xhc3MoJ2ctZm9udC1oaWRlJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvbnQucmVtb3ZlQ2xhc3MoJ2ctZm9udC1oaWRlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIHRoaXMudXBkYXRlVG90YWwoKTtcblxuICAgICAgICBjbGVhclRpbWVvdXQoaW5wdXQucmVmcmVzaFRpbWVyKTtcblxuICAgICAgICBpbnB1dC5yZWZyZXNoVGltZXIgPSBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbCgkKCd1bC5nLWZvbnRzLWxpc3QnKSk7XG4gICAgICAgIH0sIHRoaXMpLCA0MDApO1xuXG4gICAgICAgIGlucHV0LnByZXZpb3VzVmFsdWUgPSB2YWx1ZTtcbiAgICB9LFxuXG4gICAgdXBkYXRlUHJldmlldzogZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgaW5wdXQgPSBpbnB1dCB8fCAkKCcuZy1wYXJ0aWNsZXMtaGVhZGVyIGlucHV0LmZvbnQtcHJldmlldycpO1xuXG4gICAgICAgIGNsZWFyVGltZW91dChpbnB1dC5yZWZyZXNoVGltZXIpO1xuXG4gICAgICAgIHZhciB2YWx1ZSA9IGlucHV0LnZhbHVlKCksXG4gICAgICAgICAgICBsaXN0ID0gJCgnLmctZm9udHMtbGlzdCcpO1xuXG4gICAgICAgIHZhbHVlID0gdHJpbSh2YWx1ZSkgPyB0cmltKHZhbHVlKSA6IHRoaXMucHJldmlld1NlbnRlbmNlW3RoaXMuZmlsdGVycy5zY3JpcHRdO1xuXG4gICAgICAgIGlmIChpbnB1dC5wcmV2aW91c1ZhbHVlID09IHZhbHVlKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgbGlzdC5zZWFyY2goJ1tkYXRhLWZvbnRdIC5wcmV2aWV3JykudGV4dCh2YWx1ZSk7XG5cbiAgICAgICAgaW5wdXQucHJldmlvdXNWYWx1ZSA9IHZhbHVlO1xuICAgIH0sXG5cbiAgICBmdmRUb1N0eWxlOiBmdW5jdGlvbihmYW1pbHksIGZ2ZCkge1xuICAgICAgICB2YXIgbWF0Y2ggPSBmdmQubWF0Y2goLyhbYS16XSkoWzAtOV0pLyk7XG4gICAgICAgIGlmICghbWF0Y2gpIHJldHVybiAnJztcblxuICAgICAgICB2YXIgc3R5bGVNYXAgPSB7XG4gICAgICAgICAgICBuOiAnbm9ybWFsJyxcbiAgICAgICAgICAgIGk6ICdpdGFsaWMnLFxuICAgICAgICAgICAgbzogJ29ibGlxdWUnXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmb250RmFtaWx5OiBmYW1pbHksXG4gICAgICAgICAgICBmb250U3R5bGU6IHN0eWxlTWFwW21hdGNoWzFdXSxcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6IChtYXRjaFsyXSAqIDEwMCkudG9TdHJpbmcoKVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG1hcFZhcmlhbnQ6IGZ1bmN0aW9uKHZhcmlhbnQpIHtcbiAgICAgICAgc3dpdGNoICh2YXJpYW50KSB7XG4gICAgICAgICAgICBjYXNlICcxMDAnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnVGhpbiAxMDAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnMTAwaXRhbGljJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1RoaW4gMTAwIEl0YWxpYyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICcyMDAnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnRXh0cmEtTGlnaHQgMjAwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzIwMGl0YWxpYyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdFeHRyYS1MaWdodCAyMDAgSXRhbGljJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzMwMCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdMaWdodCAzMDAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnMzAwaXRhbGljJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0xpZ2h0IDMwMCBJdGFsaWMnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnNDAwJzpcbiAgICAgICAgICAgIGNhc2UgJ3JlZ3VsYXInOlxuICAgICAgICAgICAgICAgIHJldHVybiAnTm9ybWFsIDQwMCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICc0MDBpdGFsaWMnOlxuICAgICAgICAgICAgY2FzZSAnaXRhbGljJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ05vcm1hbCA0MDAgSXRhbGljJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzUwMCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdNZWRpdW0gNTAwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzUwMGl0YWxpYyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdNZWRpdW0gNTAwIEl0YWxpYyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICc2MDAnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnU2VtaS1Cb2xkIDYwMCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICc2MDBpdGFsaWMnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnU2VtaS1Cb2xkIDYwMCBJdGFsaWMnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnNzAwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0JvbGQgNzAwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzcwMGl0YWxpYyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdCb2xkIDcwMCBJdGFsaWMnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnODAwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0V4dHJhLUJvbGQgODAwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzgwMGl0YWxpYyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdFeHRyYS1Cb2xkIDgwMCBJdGFsaWMnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnOTAwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1VsdHJhLUJvbGQgOTAwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJzkwMGl0YWxpYyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdVbHRyYS1Cb2xkIDkwMCBJdGFsaWMnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1Vua25vd24gVmFyaWFudCc7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuZG9tcmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZzUtZm9udHBpY2tlcl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICB2YXIgRm9udFBpY2tlciA9IHN0b3JhZ2UuZ2V0KGVsZW1lbnQpO1xuICAgICAgICBpZiAoIUZvbnRQaWNrZXIpIHtcbiAgICAgICAgICAgIEZvbnRQaWNrZXIgPSBuZXcgRm9udHMoKTtcbiAgICAgICAgICAgIHN0b3JhZ2Uuc2V0KGVsZW1lbnQsIEZvbnRQaWNrZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgRm9udFBpY2tlci5vcGVuKGV2ZW50LCBlbGVtZW50KTtcbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEZvbnRzOyIsIi8qIFdlYiBGb250IExvYWRlciB2MS41LjE0IC0gKGMpIEFkb2JlIFN5c3RlbXMsIEdvb2dsZS4gTGljZW5zZTogQXBhY2hlIDIuMCAqL1xuOyhmdW5jdGlvbih3aW5kb3csZG9jdW1lbnQsdW5kZWZpbmVkKXtmdW5jdGlvbiBhYShhLGIsYyl7cmV0dXJuIGEuY2FsbC5hcHBseShhLmJpbmQsYXJndW1lbnRzKX1mdW5jdGlvbiBiYShhLGIsYyl7aWYoIWEpdGhyb3cgRXJyb3IoKTtpZigyPGFyZ3VtZW50cy5sZW5ndGgpe3ZhciBkPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywyKTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO0FycmF5LnByb3RvdHlwZS51bnNoaWZ0LmFwcGx5KGMsZCk7cmV0dXJuIGEuYXBwbHkoYixjKX19cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGEuYXBwbHkoYixhcmd1bWVudHMpfX1mdW5jdGlvbiBrKGEsYixjKXtrPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kJiYtMSE9RnVuY3Rpb24ucHJvdG90eXBlLmJpbmQudG9TdHJpbmcoKS5pbmRleE9mKFwibmF0aXZlIGNvZGVcIik/YWE6YmE7cmV0dXJuIGsuYXBwbHkobnVsbCxhcmd1bWVudHMpfXZhciBuPURhdGUubm93fHxmdW5jdGlvbigpe3JldHVybituZXcgRGF0ZX07ZnVuY3Rpb24gcShhLGIpe3RoaXMuSj1hO3RoaXMudD1ifHxhO3RoaXMuQz10aGlzLnQuZG9jdW1lbnR9cS5wcm90b3R5cGUuY3JlYXRlRWxlbWVudD1mdW5jdGlvbihhLGIsYyl7YT10aGlzLkMuY3JlYXRlRWxlbWVudChhKTtpZihiKWZvcih2YXIgZCBpbiBiKWIuaGFzT3duUHJvcGVydHkoZCkmJihcInN0eWxlXCI9PWQ/YS5zdHlsZS5jc3NUZXh0PWJbZF06YS5zZXRBdHRyaWJ1dGUoZCxiW2RdKSk7YyYmYS5hcHBlbmRDaGlsZCh0aGlzLkMuY3JlYXRlVGV4dE5vZGUoYykpO3JldHVybiBhfTtmdW5jdGlvbiByKGEsYixjKXthPWEuQy5nZXRFbGVtZW50c0J5VGFnTmFtZShiKVswXTthfHwoYT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpO2EmJmEubGFzdENoaWxkJiZhLmluc2VydEJlZm9yZShjLGEubGFzdENoaWxkKX1mdW5jdGlvbiBjYShhLGIpe2Z1bmN0aW9uIGMoKXthLkMuYm9keT9iKCk6c2V0VGltZW91dChjLDApfWMoKX1cbiAgICBmdW5jdGlvbiBzKGEsYixjKXtiPWJ8fFtdO2M9Y3x8W107Zm9yKHZhciBkPWEuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLyksZT0wO2U8Yi5sZW5ndGg7ZSs9MSl7Zm9yKHZhciBmPSExLGc9MDtnPGQubGVuZ3RoO2crPTEpaWYoYltlXT09PWRbZ10pe2Y9ITA7YnJlYWt9Znx8ZC5wdXNoKGJbZV0pfWI9W107Zm9yKGU9MDtlPGQubGVuZ3RoO2UrPTEpe2Y9ITE7Zm9yKGc9MDtnPGMubGVuZ3RoO2crPTEpaWYoZFtlXT09PWNbZ10pe2Y9ITA7YnJlYWt9Znx8Yi5wdXNoKGRbZV0pfWEuY2xhc3NOYW1lPWIuam9pbihcIiBcIikucmVwbGFjZSgvXFxzKy9nLFwiIFwiKS5yZXBsYWNlKC9eXFxzK3xcXHMrJC8sXCJcIil9ZnVuY3Rpb24gdChhLGIpe2Zvcih2YXIgYz1hLmNsYXNzTmFtZS5zcGxpdCgvXFxzKy8pLGQ9MCxlPWMubGVuZ3RoO2Q8ZTtkKyspaWYoY1tkXT09YilyZXR1cm4hMDtyZXR1cm4hMX1cbiAgICBmdW5jdGlvbiB1KGEpe2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYS5tYSlyZXR1cm4gYS5tYTt2YXIgYj1hLnQubG9jYXRpb24ucHJvdG9jb2w7XCJhYm91dDpcIj09YiYmKGI9YS5KLmxvY2F0aW9uLnByb3RvY29sKTtyZXR1cm5cImh0dHBzOlwiPT1iP1wiaHR0cHM6XCI6XCJodHRwOlwifWZ1bmN0aW9uIHYoYSxiKXt2YXIgYz1hLmNyZWF0ZUVsZW1lbnQoXCJsaW5rXCIse3JlbDpcInN0eWxlc2hlZXRcIixocmVmOmJ9KSxkPSExO2Mub25sb2FkPWZ1bmN0aW9uKCl7ZHx8KGQ9ITApfTtjLm9uZXJyb3I9ZnVuY3Rpb24oKXtkfHwoZD0hMCl9O3IoYSxcImhlYWRcIixjKX1cbiAgICBmdW5jdGlvbiB3KGEsYixjLGQpe3ZhciBlPWEuQy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF07aWYoZSl7dmFyIGY9YS5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIse3NyYzpifSksZz0hMTtmLm9ubG9hZD1mLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2d8fHRoaXMucmVhZHlTdGF0ZSYmXCJsb2FkZWRcIiE9dGhpcy5yZWFkeVN0YXRlJiZcImNvbXBsZXRlXCIhPXRoaXMucmVhZHlTdGF0ZXx8KGc9ITAsYyYmYyhudWxsKSxmLm9ubG9hZD1mLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLFwiSEVBRFwiPT1mLnBhcmVudE5vZGUudGFnTmFtZSYmZS5yZW1vdmVDaGlsZChmKSl9O2UuYXBwZW5kQ2hpbGQoZik7d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtnfHwoZz0hMCxjJiZjKEVycm9yKFwiU2NyaXB0IGxvYWQgdGltZW91dFwiKSkpfSxkfHw1RTMpO3JldHVybiBmfXJldHVybiBudWxsfTtmdW5jdGlvbiB4KGEsYil7dGhpcy5YPWE7dGhpcy5mYT1ifTtmdW5jdGlvbiB5KGEsYixjLGQpe3RoaXMuYz1udWxsIT1hP2E6bnVsbDt0aGlzLmc9bnVsbCE9Yj9iOm51bGw7dGhpcy5BPW51bGwhPWM/YzpudWxsO3RoaXMuZT1udWxsIT1kP2Q6bnVsbH12YXIgZGE9L14oWzAtOV0rKSg/OltcXC5fLV0oWzAtOV0rKSk/KD86W1xcLl8tXShbMC05XSspKT8oPzpbXFwuXystXT8oLiopKT8kLzt5LnByb3RvdHlwZS5jb21wYXJlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmM+YS5jfHx0aGlzLmM9PT1hLmMmJnRoaXMuZz5hLmd8fHRoaXMuYz09PWEuYyYmdGhpcy5nPT09YS5nJiZ0aGlzLkE+YS5BPzE6dGhpcy5jPGEuY3x8dGhpcy5jPT09YS5jJiZ0aGlzLmc8YS5nfHx0aGlzLmM9PT1hLmMmJnRoaXMuZz09PWEuZyYmdGhpcy5BPGEuQT8tMTowfTt5LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVyblt0aGlzLmMsdGhpcy5nfHxcIlwiLHRoaXMuQXx8XCJcIix0aGlzLmV8fFwiXCJdLmpvaW4oXCJcIil9O1xuICAgIGZ1bmN0aW9uIHooYSl7YT1kYS5leGVjKGEpO3ZhciBiPW51bGwsYz1udWxsLGQ9bnVsbCxlPW51bGw7YSYmKG51bGwhPT1hWzFdJiZhWzFdJiYoYj1wYXJzZUludChhWzFdLDEwKSksbnVsbCE9PWFbMl0mJmFbMl0mJihjPXBhcnNlSW50KGFbMl0sMTApKSxudWxsIT09YVszXSYmYVszXSYmKGQ9cGFyc2VJbnQoYVszXSwxMCkpLG51bGwhPT1hWzRdJiZhWzRdJiYoZT0vXlswLTldKyQvLnRlc3QoYVs0XSk/cGFyc2VJbnQoYVs0XSwxMCk6YVs0XSkpO3JldHVybiBuZXcgeShiLGMsZCxlKX07ZnVuY3Rpb24gQShhLGIsYyxkLGUsZixnLGgpe3RoaXMuTT1hO3RoaXMuaz1ofUEucHJvdG90eXBlLmdldE5hbWU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5NfTtmdW5jdGlvbiBCKGEpe3RoaXMuYT1hfXZhciBlYT1uZXcgQShcIlVua25vd25cIiwwLDAsMCwwLDAsMCxuZXcgeCghMSwhMSkpO1xuICAgIEIucHJvdG90eXBlLnBhcnNlPWZ1bmN0aW9uKCl7dmFyIGE7aWYoLTEhPXRoaXMuYS5pbmRleE9mKFwiTVNJRVwiKXx8LTEhPXRoaXMuYS5pbmRleE9mKFwiVHJpZGVudC9cIikpe2E9Qyh0aGlzKTt2YXIgYj16KEQodGhpcykpLGM9bnVsbCxkPUUodGhpcy5hLC9UcmlkZW50XFwvKFtcXGRcXHdcXC5dKykvLDEpLGM9LTEhPXRoaXMuYS5pbmRleE9mKFwiTVNJRVwiKT96KEUodGhpcy5hLC9NU0lFIChbXFxkXFx3XFwuXSspLywxKSk6eihFKHRoaXMuYSwvcnY6KFtcXGRcXHdcXC5dKykvLDEpKTtcIlwiIT1kJiZ6KGQpO2E9bmV3IEEoXCJNU0lFXCIsMCwwLDAsMCwwLDAsbmV3IHgoXCJXaW5kb3dzXCI9PWEmJjY8PWMuY3x8XCJXaW5kb3dzIFBob25lXCI9PWEmJjg8PWIuYywhMSkpfWVsc2UgaWYoLTEhPXRoaXMuYS5pbmRleE9mKFwiT3BlcmFcIikpYTppZihhPXooRSh0aGlzLmEsL1ByZXN0b1xcLyhbXFxkXFx3XFwuXSspLywxKSkseihEKHRoaXMpKSxudWxsIT09YS5jfHx6KEUodGhpcy5hLC9ydjooW15cXCldKykvLDEpKSwtMSE9dGhpcy5hLmluZGV4T2YoXCJPcGVyYSBNaW5pL1wiKSlhPVxuICAgICAgICB6KEUodGhpcy5hLC9PcGVyYSBNaW5pXFwvKFtcXGRcXC5dKykvLDEpKSxhPW5ldyBBKFwiT3BlcmFNaW5pXCIsMCwwLDAsQyh0aGlzKSwwLDAsbmV3IHgoITEsITEpKTtlbHNle2lmKC0xIT10aGlzLmEuaW5kZXhPZihcIlZlcnNpb24vXCIpJiYoYT16KEUodGhpcy5hLC9WZXJzaW9uXFwvKFtcXGRcXC5dKykvLDEpKSxudWxsIT09YS5jKSl7YT1uZXcgQShcIk9wZXJhXCIsMCwwLDAsQyh0aGlzKSwwLDAsbmV3IHgoMTA8PWEuYywhMSkpO2JyZWFrIGF9YT16KEUodGhpcy5hLC9PcGVyYVtcXC8gXShbXFxkXFwuXSspLywxKSk7YT1udWxsIT09YS5jP25ldyBBKFwiT3BlcmFcIiwwLDAsMCxDKHRoaXMpLDAsMCxuZXcgeCgxMDw9YS5jLCExKSk6bmV3IEEoXCJPcGVyYVwiLDAsMCwwLEModGhpcyksMCwwLG5ldyB4KCExLCExKSl9ZWxzZS9PUFJcXC9bXFxkLl0rLy50ZXN0KHRoaXMuYSk/YT1GKHRoaXMpOi9BcHBsZVdlYihLfGspaXQvLnRlc3QodGhpcy5hKT9hPUYodGhpcyk6LTEhPXRoaXMuYS5pbmRleE9mKFwiR2Vja29cIik/XG4gICAgICAgIChhPVwiVW5rbm93blwiLGI9bmV3IHkseihEKHRoaXMpKSxiPSExLC0xIT10aGlzLmEuaW5kZXhPZihcIkZpcmVmb3hcIik/KGE9XCJGaXJlZm94XCIsYj16KEUodGhpcy5hLC9GaXJlZm94XFwvKFtcXGRcXHdcXC5dKykvLDEpKSxiPTM8PWIuYyYmNTw9Yi5nKTotMSE9dGhpcy5hLmluZGV4T2YoXCJNb3ppbGxhXCIpJiYoYT1cIk1vemlsbGFcIiksYz16KEUodGhpcy5hLC9ydjooW15cXCldKykvLDEpKSxifHwoYj0xPGMuY3x8MT09Yy5jJiY5PGMuZ3x8MT09Yy5jJiY5PT1jLmcmJjI8PWMuQSksYT1uZXcgQShhLDAsMCwwLEModGhpcyksMCwwLG5ldyB4KGIsITEpKSk6YT1lYTtyZXR1cm4gYX07XG4gICAgZnVuY3Rpb24gQyhhKXt2YXIgYj1FKGEuYSwvKGlQb2R8aVBhZHxpUGhvbmV8QW5kcm9pZHxXaW5kb3dzIFBob25lfEJCXFxkezJ9fEJsYWNrQmVycnkpLywxKTtpZihcIlwiIT1iKXJldHVybi9CQlxcZHsyfS8udGVzdChiKSYmKGI9XCJCbGFja0JlcnJ5XCIpLGI7YT1FKGEuYSwvKExpbnV4fE1hY19Qb3dlclBDfE1hY2ludG9zaHxXaW5kb3dzfENyT1N8UGxheVN0YXRpb258Q3JLZXkpLywxKTtyZXR1cm5cIlwiIT1hPyhcIk1hY19Qb3dlclBDXCI9PWE/YT1cIk1hY2ludG9zaFwiOlwiUGxheVN0YXRpb25cIj09YSYmKGE9XCJMaW51eFwiKSxhKTpcIlVua25vd25cIn1cbiAgICBmdW5jdGlvbiBEKGEpe3ZhciBiPUUoYS5hLC8oT1MgWHxXaW5kb3dzIE5UfEFuZHJvaWQpIChbXjspXSspLywyKTtpZihifHwoYj1FKGEuYSwvV2luZG93cyBQaG9uZSggT1MpPyAoW147KV0rKS8sMikpfHwoYj1FKGEuYSwvKGlQaG9uZSApP09TIChbXFxkX10rKS8sMikpKXJldHVybiBiO2lmKGI9RShhLmEsLyg/OkxpbnV4fENyT1N8Q3JLZXkpIChbXjspXSspLywxKSlmb3IodmFyIGI9Yi5zcGxpdCgvXFxzLyksYz0wO2M8Yi5sZW5ndGg7Yys9MSlpZigvXltcXGRcXC5fXSskLy50ZXN0KGJbY10pKXJldHVybiBiW2NdO3JldHVybihhPUUoYS5hLC8oQkJcXGR7Mn18QmxhY2tCZXJyeSkuKj9WZXJzaW9uXFwvKFteXFxzXSopLywyKSk/YTpcIlVua25vd25cIn1cbiAgICBmdW5jdGlvbiBGKGEpe3ZhciBiPUMoYSksYz16KEQoYSkpLGQ9eihFKGEuYSwvQXBwbGVXZWIoPzpLfGspaXRcXC8oW1xcZFxcLlxcK10rKS8sMSkpLGU9XCJVbmtub3duXCIsZj1uZXcgeSxmPVwiVW5rbm93blwiLGc9ITE7L09QUlxcL1tcXGQuXSsvLnRlc3QoYS5hKT9lPVwiT3BlcmFcIjotMSE9YS5hLmluZGV4T2YoXCJDaHJvbWVcIil8fC0xIT1hLmEuaW5kZXhPZihcIkNyTW9cIil8fC0xIT1hLmEuaW5kZXhPZihcIkNyaU9TXCIpP2U9XCJDaHJvbWVcIjovU2lsa1xcL1xcZC8udGVzdChhLmEpP2U9XCJTaWxrXCI6XCJCbGFja0JlcnJ5XCI9PWJ8fFwiQW5kcm9pZFwiPT1iP2U9XCJCdWlsdGluQnJvd3NlclwiOi0xIT1hLmEuaW5kZXhPZihcIlBoYW50b21KU1wiKT9lPVwiUGhhbnRvbUpTXCI6LTEhPWEuYS5pbmRleE9mKFwiU2FmYXJpXCIpP2U9XCJTYWZhcmlcIjotMSE9YS5hLmluZGV4T2YoXCJBZG9iZUFJUlwiKT9lPVwiQWRvYmVBSVJcIjotMSE9YS5hLmluZGV4T2YoXCJQbGF5U3RhdGlvblwiKSYmKGU9XCJCdWlsdGluQnJvd3NlclwiKTtcIkJ1aWx0aW5Ccm93c2VyXCI9PVxuICAgIGU/Zj1cIlVua25vd25cIjpcIlNpbGtcIj09ZT9mPUUoYS5hLC9TaWxrXFwvKFtcXGRcXC5fXSspLywxKTpcIkNocm9tZVwiPT1lP2Y9RShhLmEsLyhDaHJvbWV8Q3JNb3xDcmlPUylcXC8oW1xcZFxcLl0rKS8sMik6LTEhPWEuYS5pbmRleE9mKFwiVmVyc2lvbi9cIik/Zj1FKGEuYSwvVmVyc2lvblxcLyhbXFxkXFwuXFx3XSspLywxKTpcIkFkb2JlQUlSXCI9PWU/Zj1FKGEuYSwvQWRvYmVBSVJcXC8oW1xcZFxcLl0rKS8sMSk6XCJPcGVyYVwiPT1lP2Y9RShhLmEsL09QUlxcLyhbXFxkLl0rKS8sMSk6XCJQaGFudG9tSlNcIj09ZSYmKGY9RShhLmEsL1BoYW50b21KU1xcLyhbXFxkLl0rKS8sMSkpO2Y9eihmKTtnPVwiQWRvYmVBSVJcIj09ZT8yPGYuY3x8Mj09Zi5jJiY1PD1mLmc6XCJCbGFja0JlcnJ5XCI9PWI/MTA8PWMuYzpcIkFuZHJvaWRcIj09Yj8yPGMuY3x8Mj09Yy5jJiYxPGMuZzo1MjY8PWQuY3x8NTI1PD1kLmMmJjEzPD1kLmc7cmV0dXJuIG5ldyBBKGUsMCwwLDAsMCwwLDAsbmV3IHgoZyw1MzY+ZC5jfHw1MzY9PWQuYyYmMTE+ZC5nKSl9XG4gICAgZnVuY3Rpb24gRShhLGIsYyl7cmV0dXJuKGE9YS5tYXRjaChiKSkmJmFbY10/YVtjXTpcIlwifTtmdW5jdGlvbiBHKGEpe3RoaXMubGE9YXx8XCItXCJ9Ry5wcm90b3R5cGUuZT1mdW5jdGlvbihhKXtmb3IodmFyIGI9W10sYz0wO2M8YXJndW1lbnRzLmxlbmd0aDtjKyspYi5wdXNoKGFyZ3VtZW50c1tjXS5yZXBsYWNlKC9bXFxXX10rL2csXCJcIikudG9Mb3dlckNhc2UoKSk7cmV0dXJuIGIuam9pbih0aGlzLmxhKX07ZnVuY3Rpb24gSChhLGIpe3RoaXMuTT1hO3RoaXMuWT00O3RoaXMuTj1cIm5cIjt2YXIgYz0oYnx8XCJuNFwiKS5tYXRjaCgvXihbbmlvXSkoWzEtOV0pJC9pKTtjJiYodGhpcy5OPWNbMV0sdGhpcy5ZPXBhcnNlSW50KGNbMl0sMTApKX1ILnByb3RvdHlwZS5nZXROYW1lPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuTX07ZnVuY3Rpb24gSShhKXtyZXR1cm4gYS5OK2EuWX1mdW5jdGlvbiBnYShhKXt2YXIgYj00LGM9XCJuXCIsZD1udWxsO2EmJigoZD1hLm1hdGNoKC8obm9ybWFsfG9ibGlxdWV8aXRhbGljKS9pKSkmJmRbMV0mJihjPWRbMV0uc3Vic3RyKDAsMSkudG9Mb3dlckNhc2UoKSksKGQ9YS5tYXRjaCgvKFsxLTldMDB8bm9ybWFsfGJvbGQpL2kpKSYmZFsxXSYmKC9ib2xkL2kudGVzdChkWzFdKT9iPTc6L1sxLTldMDAvLnRlc3QoZFsxXSkmJihiPXBhcnNlSW50KGRbMV0uc3Vic3RyKDAsMSksMTApKSkpO3JldHVybiBjK2J9O2Z1bmN0aW9uIGhhKGEsYil7dGhpcy5kPWE7dGhpcy5wPWEudC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7dGhpcy5QPWI7dGhpcy5qPVwid2ZcIjt0aGlzLmg9bmV3IEcoXCItXCIpO3RoaXMuZ2E9ITEhPT1iLmV2ZW50czt0aGlzLkI9ITEhPT1iLmNsYXNzZXN9ZnVuY3Rpb24gSihhKXtpZihhLkIpe3ZhciBiPXQoYS5wLGEuaC5lKGEuaixcImFjdGl2ZVwiKSksYz1bXSxkPVthLmguZShhLmosXCJsb2FkaW5nXCIpXTtifHxjLnB1c2goYS5oLmUoYS5qLFwiaW5hY3RpdmVcIikpO3MoYS5wLGMsZCl9SyhhLFwiaW5hY3RpdmVcIil9ZnVuY3Rpb24gSyhhLGIsYyl7aWYoYS5nYSYmYS5QW2JdKWlmKGMpYS5QW2JdKGMuZ2V0TmFtZSgpLEkoYykpO2Vsc2UgYS5QW2JdKCl9O2Z1bmN0aW9uIGlhKCl7dGhpcy53PXt9fTtmdW5jdGlvbiBMKGEsYil7dGhpcy5kPWE7dGhpcy5HPWI7dGhpcy5tPXRoaXMuZC5jcmVhdGVFbGVtZW50KFwic3BhblwiLHtcImFyaWEtaGlkZGVuXCI6XCJ0cnVlXCJ9LHRoaXMuRyl9ZnVuY3Rpb24gTShhKXtyKGEuZCxcImJvZHlcIixhLm0pfVxuICAgIGZ1bmN0aW9uIE4oYSl7dmFyIGI7Yj1bXTtmb3IodmFyIGM9YS5NLnNwbGl0KC8sXFxzKi8pLGQ9MDtkPGMubGVuZ3RoO2QrKyl7dmFyIGU9Y1tkXS5yZXBsYWNlKC9bJ1wiXS9nLFwiXCIpOy0xPT1lLmluZGV4T2YoXCIgXCIpP2IucHVzaChlKTpiLnB1c2goXCInXCIrZStcIidcIil9Yj1iLmpvaW4oXCIsXCIpO2M9XCJub3JtYWxcIjtcIm9cIj09PWEuTj9jPVwib2JsaXF1ZVwiOlwiaVwiPT09YS5OJiYoYz1cIml0YWxpY1wiKTtyZXR1cm5cImRpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7dG9wOi05OTlweDtsZWZ0Oi05OTlweDtmb250LXNpemU6MzAwcHg7d2lkdGg6YXV0bztoZWlnaHQ6YXV0bztsaW5lLWhlaWdodDpub3JtYWw7bWFyZ2luOjA7cGFkZGluZzowO2ZvbnQtdmFyaWFudDpub3JtYWw7d2hpdGUtc3BhY2U6bm93cmFwO2ZvbnQtZmFtaWx5OlwiK2IrXCI7XCIrKFwiZm9udC1zdHlsZTpcIitjK1wiO2ZvbnQtd2VpZ2h0OlwiKyhhLlkrXCIwMFwiKStcIjtcIil9XG4gICAgTC5wcm90b3R5cGUucmVtb3ZlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5tO2EucGFyZW50Tm9kZSYmYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGEpfTtmdW5jdGlvbiBPKGEsYixjLGQsZSxmLGcsaCl7dGhpcy5aPWE7dGhpcy5qYT1iO3RoaXMuZD1jO3RoaXMucz1kO3RoaXMuRz1ofHxcIkJFU2Jzd3lcIjt0aGlzLms9ZTt0aGlzLkk9e307dGhpcy5XPWZ8fDNFMzt0aGlzLmJhPWd8fG51bGw7dGhpcy5GPXRoaXMuRD1udWxsO2E9bmV3IEwodGhpcy5kLHRoaXMuRyk7TShhKTtmb3IodmFyIG0gaW4gUClQLmhhc093blByb3BlcnR5KG0pJiYoYj1uZXcgSChQW21dLEkodGhpcy5zKSksYj1OKGIpLGEubS5zdHlsZS5jc3NUZXh0PWIsdGhpcy5JW1BbbV1dPWEubS5vZmZzZXRXaWR0aCk7YS5yZW1vdmUoKX12YXIgUD17cmE6XCJzZXJpZlwiLHFhOlwic2Fucy1zZXJpZlwiLHBhOlwibW9ub3NwYWNlXCJ9O1xuICAgIE8ucHJvdG90eXBlLnN0YXJ0PWZ1bmN0aW9uKCl7dGhpcy5EPW5ldyBMKHRoaXMuZCx0aGlzLkcpO00odGhpcy5EKTt0aGlzLkY9bmV3IEwodGhpcy5kLHRoaXMuRyk7TSh0aGlzLkYpO3RoaXMubmE9bigpO3ZhciBhPW5ldyBIKHRoaXMucy5nZXROYW1lKCkrXCIsc2VyaWZcIixJKHRoaXMucykpLGE9TihhKTt0aGlzLkQubS5zdHlsZS5jc3NUZXh0PWE7YT1uZXcgSCh0aGlzLnMuZ2V0TmFtZSgpK1wiLHNhbnMtc2VyaWZcIixJKHRoaXMucykpO2E9TihhKTt0aGlzLkYubS5zdHlsZS5jc3NUZXh0PWE7USh0aGlzKX07ZnVuY3Rpb24gUihhLGIsYyl7Zm9yKHZhciBkIGluIFApaWYoUC5oYXNPd25Qcm9wZXJ0eShkKSYmYj09PWEuSVtQW2RdXSYmYz09PWEuSVtQW2RdXSlyZXR1cm4hMDtyZXR1cm4hMX1cbiAgICBmdW5jdGlvbiBRKGEpe3ZhciBiPWEuRC5tLm9mZnNldFdpZHRoLGM9YS5GLm0ub2Zmc2V0V2lkdGg7Yj09PWEuSS5zZXJpZiYmYz09PWEuSVtcInNhbnMtc2VyaWZcIl18fGEuay5mYSYmUihhLGIsYyk/bigpLWEubmE+PWEuVz9hLmsuZmEmJlIoYSxiLGMpJiYobnVsbD09PWEuYmF8fGEuYmEuaGFzT3duUHJvcGVydHkoYS5zLmdldE5hbWUoKSkpP1MoYSxhLlopOlMoYSxhLmphKTpqYShhKTpTKGEsYS5aKX1mdW5jdGlvbiBqYShhKXtzZXRUaW1lb3V0KGsoZnVuY3Rpb24oKXtRKHRoaXMpfSxhKSwyNSl9ZnVuY3Rpb24gUyhhLGIpe2EuRC5yZW1vdmUoKTthLkYucmVtb3ZlKCk7YihhLnMpfTtmdW5jdGlvbiBUKGEsYixjLGQpe3RoaXMuZD1iO3RoaXMudT1jO3RoaXMuUj0wO3RoaXMuZGE9dGhpcy5hYT0hMTt0aGlzLlc9ZDt0aGlzLms9YS5rfWZ1bmN0aW9uIGthKGEsYixjLGQsZSl7Yz1jfHx7fTtpZigwPT09Yi5sZW5ndGgmJmUpSihhLnUpO2Vsc2UgZm9yKGEuUis9Yi5sZW5ndGgsZSYmKGEuYWE9ZSksZT0wO2U8Yi5sZW5ndGg7ZSsrKXt2YXIgZj1iW2VdLGc9Y1tmLmdldE5hbWUoKV0saD1hLnUsbT1mO2guQiYmcyhoLnAsW2guaC5lKGguaixtLmdldE5hbWUoKSxJKG0pLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpXSk7SyhoLFwiZm9udGxvYWRpbmdcIixtKTtoPW51bGw7aD1uZXcgTyhrKGEuaGEsYSksayhhLmlhLGEpLGEuZCxmLGEuayxhLlcsZCxnKTtoLnN0YXJ0KCl9fVxuICAgIFQucHJvdG90eXBlLmhhPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMudTtiLkImJnMoYi5wLFtiLmguZShiLmosYS5nZXROYW1lKCksSShhKS50b1N0cmluZygpLFwiYWN0aXZlXCIpXSxbYi5oLmUoYi5qLGEuZ2V0TmFtZSgpLEkoYSkudG9TdHJpbmcoKSxcImxvYWRpbmdcIiksYi5oLmUoYi5qLGEuZ2V0TmFtZSgpLEkoYSkudG9TdHJpbmcoKSxcImluYWN0aXZlXCIpXSk7SyhiLFwiZm9udGFjdGl2ZVwiLGEpO3RoaXMuZGE9ITA7bGEodGhpcyl9O1xuICAgIFQucHJvdG90eXBlLmlhPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMudTtpZihiLkIpe3ZhciBjPXQoYi5wLGIuaC5lKGIuaixhLmdldE5hbWUoKSxJKGEpLnRvU3RyaW5nKCksXCJhY3RpdmVcIikpLGQ9W10sZT1bYi5oLmUoYi5qLGEuZ2V0TmFtZSgpLEkoYSkudG9TdHJpbmcoKSxcImxvYWRpbmdcIildO2N8fGQucHVzaChiLmguZShiLmosYS5nZXROYW1lKCksSShhKS50b1N0cmluZygpLFwiaW5hY3RpdmVcIikpO3MoYi5wLGQsZSl9SyhiLFwiZm9udGluYWN0aXZlXCIsYSk7bGEodGhpcyl9O2Z1bmN0aW9uIGxhKGEpezA9PS0tYS5SJiZhLmFhJiYoYS5kYT8oYT1hLnUsYS5CJiZzKGEucCxbYS5oLmUoYS5qLFwiYWN0aXZlXCIpXSxbYS5oLmUoYS5qLFwibG9hZGluZ1wiKSxhLmguZShhLmosXCJpbmFjdGl2ZVwiKV0pLEsoYSxcImFjdGl2ZVwiKSk6SihhLnUpKX07ZnVuY3Rpb24gVShhKXt0aGlzLko9YTt0aGlzLnY9bmV3IGlhO3RoaXMub2E9bmV3IEIoYS5uYXZpZ2F0b3IudXNlckFnZW50KTt0aGlzLmE9dGhpcy5vYS5wYXJzZSgpO3RoaXMuVD10aGlzLlU9MDt0aGlzLlE9dGhpcy5TPSEwfVxuICAgIFUucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dGhpcy5kPW5ldyBxKHRoaXMuSixhLmNvbnRleHR8fHRoaXMuSik7dGhpcy5TPSExIT09YS5ldmVudHM7dGhpcy5RPSExIT09YS5jbGFzc2VzO3ZhciBiPW5ldyBoYSh0aGlzLmQsYSksYz1bXSxkPWEudGltZW91dDtiLkImJnMoYi5wLFtiLmguZShiLmosXCJsb2FkaW5nXCIpXSk7SyhiLFwibG9hZGluZ1wiKTt2YXIgYz10aGlzLnYsZT10aGlzLmQsZj1bXSxnO2ZvcihnIGluIGEpaWYoYS5oYXNPd25Qcm9wZXJ0eShnKSl7dmFyIGg9Yy53W2ddO2gmJmYucHVzaChoKGFbZ10sZSkpfWM9Zjt0aGlzLlQ9dGhpcy5VPWMubGVuZ3RoO2E9bmV3IFQodGhpcy5hLHRoaXMuZCxiLGQpO2Q9MDtmb3IoZz1jLmxlbmd0aDtkPGc7ZCsrKWU9Y1tkXSxlLksodGhpcy5hLGsodGhpcy5rYSx0aGlzLGUsYixhKSl9O1xuICAgIFUucHJvdG90eXBlLmthPWZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPXRoaXM7ZD9hLmxvYWQoZnVuY3Rpb24oYSxiLGQpe21hKGUsYyxhLGIsZCl9KTooYT0wPT0tLXRoaXMuVSx0aGlzLlQtLSxhJiYwPT10aGlzLlQ/SihiKToodGhpcy5RfHx0aGlzLlMpJiZrYShjLFtdLHt9LG51bGwsYSkpfTtmdW5jdGlvbiBtYShhLGIsYyxkLGUpe3ZhciBmPTA9PS0tYS5VOyhhLlF8fGEuUykmJnNldFRpbWVvdXQoZnVuY3Rpb24oKXtrYShiLGMsZHx8bnVsbCxlfHxudWxsLGYpfSwwKX07ZnVuY3Rpb24gbmEoYSxiLGMpe3RoaXMuTz1hP2E6YitvYTt0aGlzLnE9W107dGhpcy5WPVtdO3RoaXMuZWE9Y3x8XCJcIn12YXIgb2E9XCIvL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzc1wiO25hLnByb3RvdHlwZS5lPWZ1bmN0aW9uKCl7aWYoMD09dGhpcy5xLmxlbmd0aCl0aHJvdyBFcnJvcihcIk5vIGZvbnRzIHRvIGxvYWQhXCIpO2lmKC0xIT10aGlzLk8uaW5kZXhPZihcImtpdD1cIikpcmV0dXJuIHRoaXMuTztmb3IodmFyIGE9dGhpcy5xLmxlbmd0aCxiPVtdLGM9MDtjPGE7YysrKWIucHVzaCh0aGlzLnFbY10ucmVwbGFjZSgvIC9nLFwiK1wiKSk7YT10aGlzLk8rXCI/ZmFtaWx5PVwiK2Iuam9pbihcIiU3Q1wiKTswPHRoaXMuVi5sZW5ndGgmJihhKz1cIiZzdWJzZXQ9XCIrdGhpcy5WLmpvaW4oXCIsXCIpKTswPHRoaXMuZWEubGVuZ3RoJiYoYSs9XCImdGV4dD1cIitlbmNvZGVVUklDb21wb25lbnQodGhpcy5lYSkpO3JldHVybiBhfTtmdW5jdGlvbiBwYShhKXt0aGlzLnE9YTt0aGlzLmNhPVtdO3RoaXMuTD17fX1cbiAgICB2YXIgcWE9e2xhdGluOlwiQkVTYnN3eVwiLGN5cmlsbGljOlwiJiMxMDgxOyYjMTEwMzsmIzEwNDY7XCIsZ3JlZWs6XCImIzk0NTsmIzk0NjsmIzkzMTtcIixraG1lcjpcIiYjeDE3ODA7JiN4MTc4MTsmI3gxNzgyO1wiLEhhbnVtYW46XCImI3gxNzgwOyYjeDE3ODE7JiN4MTc4MjtcIn0scmE9e3RoaW46XCIxXCIsZXh0cmFsaWdodDpcIjJcIixcImV4dHJhLWxpZ2h0XCI6XCIyXCIsdWx0cmFsaWdodDpcIjJcIixcInVsdHJhLWxpZ2h0XCI6XCIyXCIsbGlnaHQ6XCIzXCIscmVndWxhcjpcIjRcIixib29rOlwiNFwiLG1lZGl1bTpcIjVcIixcInNlbWktYm9sZFwiOlwiNlwiLHNlbWlib2xkOlwiNlwiLFwiZGVtaS1ib2xkXCI6XCI2XCIsZGVtaWJvbGQ6XCI2XCIsYm9sZDpcIjdcIixcImV4dHJhLWJvbGRcIjpcIjhcIixleHRyYWJvbGQ6XCI4XCIsXCJ1bHRyYS1ib2xkXCI6XCI4XCIsdWx0cmFib2xkOlwiOFwiLGJsYWNrOlwiOVwiLGhlYXZ5OlwiOVwiLGw6XCIzXCIscjpcIjRcIixiOlwiN1wifSxzYT17aTpcImlcIixpdGFsaWM6XCJpXCIsbjpcIm5cIixub3JtYWw6XCJuXCJ9LHRhPS9eKHRoaW58KD86KD86ZXh0cmF8dWx0cmEpLT8pP2xpZ2h0fHJlZ3VsYXJ8Ym9va3xtZWRpdW18KD86KD86c2VtaXxkZW1pfGV4dHJhfHVsdHJhKS0/KT9ib2xkfGJsYWNrfGhlYXZ5fGx8cnxifFsxLTldMDApPyhufGl8bm9ybWFsfGl0YWxpYyk/JC87XG4gICAgcGEucHJvdG90eXBlLnBhcnNlPWZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXMucS5sZW5ndGgsYj0wO2I8YTtiKyspe3ZhciBjPXRoaXMucVtiXS5zcGxpdChcIjpcIiksZD1jWzBdLnJlcGxhY2UoL1xcKy9nLFwiIFwiKSxlPVtcIm40XCJdO2lmKDI8PWMubGVuZ3RoKXt2YXIgZjt2YXIgZz1jWzFdO2Y9W107aWYoZylmb3IodmFyIGc9Zy5zcGxpdChcIixcIiksaD1nLmxlbmd0aCxtPTA7bTxoO20rKyl7dmFyIGw7bD1nW21dO2lmKGwubWF0Y2goL15bXFx3LV0rJC8pKXtsPXRhLmV4ZWMobC50b0xvd2VyQ2FzZSgpKTt2YXIgcD12b2lkIDA7aWYobnVsbD09bClwPVwiXCI7ZWxzZXtwPXZvaWQgMDtwPWxbMV07aWYobnVsbD09cHx8XCJcIj09cClwPVwiNFwiO2Vsc2UgdmFyIGZhPXJhW3BdLHA9ZmE/ZmE6aXNOYU4ocCk/XCI0XCI6cC5zdWJzdHIoMCwxKTtsPWxbMl07cD1bbnVsbD09bHx8XCJcIj09bD9cIm5cIjpzYVtsXSxwXS5qb2luKFwiXCIpfWw9cH1lbHNlIGw9XCJcIjtsJiZmLnB1c2gobCl9MDxmLmxlbmd0aCYmKGU9Zik7XG4gICAgICAgIDM9PWMubGVuZ3RoJiYoYz1jWzJdLGY9W10sYz1jP2Muc3BsaXQoXCIsXCIpOmYsMDxjLmxlbmd0aCYmKGM9cWFbY1swXV0pJiYodGhpcy5MW2RdPWMpKX10aGlzLkxbZF18fChjPXFhW2RdKSYmKHRoaXMuTFtkXT1jKTtmb3IoYz0wO2M8ZS5sZW5ndGg7Yys9MSl0aGlzLmNhLnB1c2gobmV3IEgoZCxlW2NdKSl9fTtmdW5jdGlvbiBWKGEsYil7dGhpcy5hPShuZXcgQihuYXZpZ2F0b3IudXNlckFnZW50KSkucGFyc2UoKTt0aGlzLmQ9YTt0aGlzLmY9Yn12YXIgdWE9e0FyaW1vOiEwLENvdXNpbmU6ITAsVGlub3M6ITB9O1YucHJvdG90eXBlLks9ZnVuY3Rpb24oYSxiKXtiKGEuay5YKX07Vi5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmQ7XCJNU0lFXCI9PXRoaXMuYS5nZXROYW1lKCkmJjEhPXRoaXMuZi5ibG9ja2luZz9jYShiLGsodGhpcy4kLHRoaXMsYSkpOnRoaXMuJChhKX07XG4gICAgVi5wcm90b3R5cGUuJD1mdW5jdGlvbihhKXtmb3IodmFyIGI9dGhpcy5kLGM9bmV3IG5hKHRoaXMuZi5hcGksdShiKSx0aGlzLmYudGV4dCksZD10aGlzLmYuZmFtaWxpZXMsZT1kLmxlbmd0aCxmPTA7ZjxlO2YrKyl7dmFyIGc9ZFtmXS5zcGxpdChcIjpcIik7Mz09Zy5sZW5ndGgmJmMuVi5wdXNoKGcucG9wKCkpO3ZhciBoPVwiXCI7Mj09Zy5sZW5ndGgmJlwiXCIhPWdbMV0mJihoPVwiOlwiKTtjLnEucHVzaChnLmpvaW4oaCkpfWQ9bmV3IHBhKGQpO2QucGFyc2UoKTt2KGIsYy5lKCkpO2EoZC5jYSxkLkwsdWEpfTtmdW5jdGlvbiBXKGEsYil7dGhpcy5kPWE7dGhpcy5mPWI7dGhpcy5vPVtdfVcucHJvdG90eXBlLkg9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5kO3JldHVybiB1KHRoaXMuZCkrKHRoaXMuZi5hcGl8fFwiLy9mLmZvbnRkZWNrLmNvbS9zL2Nzcy9qcy9cIikrKGIudC5sb2NhdGlvbi5ob3N0bmFtZXx8Yi5KLmxvY2F0aW9uLmhvc3RuYW1lKStcIi9cIithK1wiLmpzXCJ9O1xuICAgIFcucHJvdG90eXBlLks9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmYuaWQsZD10aGlzLmQudCxlPXRoaXM7Yz8oZC5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9ffHwoZC5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9fPXt9KSxkLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX19bY109ZnVuY3Rpb24oYSxjKXtmb3IodmFyIGQ9MCxtPWMuZm9udHMubGVuZ3RoO2Q8bTsrK2Qpe3ZhciBsPWMuZm9udHNbZF07ZS5vLnB1c2gobmV3IEgobC5uYW1lLGdhKFwiZm9udC13ZWlnaHQ6XCIrbC53ZWlnaHQrXCI7Zm9udC1zdHlsZTpcIitsLnN0eWxlKSkpfWIoYSl9LHcodGhpcy5kLHRoaXMuSChjKSxmdW5jdGlvbihhKXthJiZiKCExKX0pKTpiKCExKX07Vy5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXthKHRoaXMubyl9O2Z1bmN0aW9uIFgoYSxiKXt0aGlzLmQ9YTt0aGlzLmY9Yjt0aGlzLm89W119WC5wcm90b3R5cGUuSD1mdW5jdGlvbihhKXt2YXIgYj11KHRoaXMuZCk7cmV0dXJuKHRoaXMuZi5hcGl8fGIrXCIvL3VzZS50eXBla2l0Lm5ldFwiKStcIi9cIithK1wiLmpzXCJ9O1gucHJvdG90eXBlLks9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmYuaWQsZD10aGlzLmQudCxlPXRoaXM7Yz93KHRoaXMuZCx0aGlzLkgoYyksZnVuY3Rpb24oYSl7aWYoYSliKCExKTtlbHNle2lmKGQuVHlwZWtpdCYmZC5UeXBla2l0LmNvbmZpZyYmZC5UeXBla2l0LmNvbmZpZy5mbil7YT1kLlR5cGVraXQuY29uZmlnLmZuO2Zvcih2YXIgYz0wO2M8YS5sZW5ndGg7Yys9Milmb3IodmFyIGg9YVtjXSxtPWFbYysxXSxsPTA7bDxtLmxlbmd0aDtsKyspZS5vLnB1c2gobmV3IEgoaCxtW2xdKSk7dHJ5e2QuVHlwZWtpdC5sb2FkKHtldmVudHM6ITEsY2xhc3NlczohMX0pfWNhdGNoKHApe319YighMCl9fSwyRTMpOmIoITEpfTtcbiAgICBYLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe2EodGhpcy5vKX07ZnVuY3Rpb24gWShhLGIpe3RoaXMuZD1hO3RoaXMuZj1iO3RoaXMubz1bXX1ZLnByb3RvdHlwZS5LPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcyxkPWMuZi5wcm9qZWN0SWQsZT1jLmYudmVyc2lvbjtpZihkKXt2YXIgZj1jLmQudDt3KHRoaXMuZCxjLkgoZCxlKSxmdW5jdGlvbihlKXtpZihlKWIoITEpO2Vsc2V7aWYoZltcIl9fbXRpX2ZudExzdFwiK2RdJiYoZT1mW1wiX19tdGlfZm50THN0XCIrZF0oKSkpZm9yKHZhciBoPTA7aDxlLmxlbmd0aDtoKyspYy5vLnB1c2gobmV3IEgoZVtoXS5mb250ZmFtaWx5KSk7YihhLmsuWCl9fSkuaWQ9XCJfX01vbm90eXBlQVBJU2NyaXB0X19cIitkfWVsc2UgYighMSl9O1kucHJvdG90eXBlLkg9ZnVuY3Rpb24oYSxiKXt2YXIgYz11KHRoaXMuZCksZD0odGhpcy5mLmFwaXx8XCJmYXN0LmZvbnRzLm5ldC9qc2FwaVwiKS5yZXBsYWNlKC9eLipodHRwKHM/KTooXFwvXFwvKT8vLFwiXCIpO3JldHVybiBjK1wiLy9cIitkK1wiL1wiK2ErXCIuanNcIisoYj9cIj92PVwiK2I6XCJcIil9O1xuICAgIFkucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7YSh0aGlzLm8pfTtmdW5jdGlvbiBaKGEsYil7dGhpcy5kPWE7dGhpcy5mPWJ9Wi5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYixjLGQ9dGhpcy5mLnVybHN8fFtdLGU9dGhpcy5mLmZhbWlsaWVzfHxbXSxmPXRoaXMuZi50ZXN0U3RyaW5nc3x8e307Yj0wO2ZvcihjPWQubGVuZ3RoO2I8YztiKyspdih0aGlzLmQsZFtiXSk7ZD1bXTtiPTA7Zm9yKGM9ZS5sZW5ndGg7YjxjO2IrKyl7dmFyIGc9ZVtiXS5zcGxpdChcIjpcIik7aWYoZ1sxXSlmb3IodmFyIGg9Z1sxXS5zcGxpdChcIixcIiksbT0wO208aC5sZW5ndGg7bSs9MSlkLnB1c2gobmV3IEgoZ1swXSxoW21dKSk7ZWxzZSBkLnB1c2gobmV3IEgoZ1swXSkpfWEoZCxmKX07Wi5wcm90b3R5cGUuSz1mdW5jdGlvbihhLGIpe3JldHVybiBiKGEuay5YKX07dmFyICQ9bmV3IFUodGhpcyk7JC52LncuY3VzdG9tPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBaKGIsYSl9OyQudi53LmZvbnRkZWNrPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBXKGIsYSl9OyQudi53Lm1vbm90eXBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBZKGIsYSl9OyQudi53LnR5cGVraXQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IFgoYixhKX07JC52LncuZ29vZ2xlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBWKGIsYSl9O3RoaXMuV2ViRm9udHx8KHRoaXMuV2ViRm9udD17fSx0aGlzLldlYkZvbnQubG9hZD1rKCQubG9hZCwkKSx0aGlzLldlYkZvbnRDb25maWcmJiQubG9hZCh0aGlzLldlYkZvbnRDb25maWcpKTt9KSh0aGlzLGRvY3VtZW50KTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IHdpbmRvdy5XZWJGb250OyIsIlwidXNlIHN0cmljdFwiO1xudmFyICQgICAgICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91dGlscy9lbGVtZW50cy51dGlscycpLFxuICAgIGRvbXJlYWR5ICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIG1vZGFsICAgICAgICAgPSByZXF1aXJlKCcuLi8uLi91aScpLm1vZGFsLFxuICAgIGdldEFqYXhTdWZmaXggPSByZXF1aXJlKCcuLi8uLi91dGlscy9nZXQtYWpheC1zdWZmaXgnKSxcbiAgICBnZXRBamF4VVJMICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtdXJsJykuZ2xvYmFsLFxuXG4gICAgdHJpbSAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL3RyaW0nKSxcbiAgICBjb250YWlucyAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9jb250YWlucycpO1xuXG5kb21yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcbiAgICBib2R5LmRlbGVnYXRlKCdrZXl1cCcsICcuZy1pY29ucyBpbnB1dFt0eXBlPVwidGV4dFwiXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KXtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciBwcmV2aWV3ID0gZWxlbWVudC5zaWJsaW5nKCdbZGF0YS1nNS1pY29ucGlja2VyXScpLFxuICAgICAgICAgICAgdmFsdWUgPSBlbGVtZW50LnZhbHVlKCksXG4gICAgICAgICAgICBzaXplO1xuXG4gICAgICAgIHByZXZpZXcuYXR0cmlidXRlKCdjbGFzcycsIHZhbHVlIHx8ICdmYSBmYS1oYW5kLW8tdXAgcGlja2VyJyk7XG5cbiAgICAgICAgc2l6ZSA9IHByZXZpZXdbMF0ub2Zmc2V0V2lkdGg7XG5cbiAgICAgICAgaWYgKCFzaXplKSB7IHByZXZpZXcuYXR0cmlidXRlKCdjbGFzcycsICdmYSBmYS1oYW5kLW8tdXAgcGlja2VyJyk7IH1cbiAgICB9KTtcblxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWc1LWljb25waWNrZXJdJywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnByZXZlbnREZWZhdWx0KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciBmaWVsZCA9ICQoZWxlbWVudC5kYXRhKCdnNS1pY29ucGlja2VyJykpLFxuICAgICAgICAgICAgcmVhbFByZXZpZXcgPSBlbGVtZW50LFxuICAgICAgICAgICAgdmFsdWUgPSB0cmltKGZpZWxkLnZhbHVlKCkpLnJlcGxhY2UoL1xcc3syLH0vZywgJyAnKS5zcGxpdCgnICcpO1xuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogJ0xvYWRpbmcnLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZzUtZGlhbG9nLXRoZW1lLWRlZmF1bHQgZzUtbW9kYWwtaWNvbnMnLFxuICAgICAgICAgICAgcmVtb3RlOiBnZXRBamF4VVJMKCdpY29ucycpICsgZ2V0QWpheFN1ZmZpeCgpLFxuICAgICAgICAgICAgYWZ0ZXJDbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBvcG92ZXJzID0gJCgnLmc1LXBvcG92ZXInKTtcbiAgICAgICAgICAgICAgICBpZiAocG9wb3ZlcnMpIHsgcG9wb3ZlcnMucmVtb3ZlKCk7IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW1vdGVMb2FkZWQ6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGh0bWwsIGxhcmdlLFxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIgPSBjb250ZW50LmVsZW1lbnRzLmNvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgIGljb25zID0gY29udGFpbmVyLnNlYXJjaCgnW2RhdGEtZy1pY29uXScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFpY29ucyB8fCAhcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVQcmV2aWV3ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmUgPSBjb250YWluZXIuZmluZCgnW2RhdGEtZy1pY29uXS5hY3RpdmUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBjb250YWluZXIuc2VhcmNoKCcuZy1wYXJ0aWNsZXMtaGVhZGVyIC5mbG9hdC1yaWdodCBpbnB1dDpjaGVja2VkLCAuZy1wYXJ0aWNsZXMtaGVhZGVyIC5mbG9hdC1yaWdodCBzZWxlY3QnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlKSB7IGRhdGEucHVzaChhY3RpdmUuZGF0YSgnZy1pY29uJykpOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmZvckVhY2goZnVuY3Rpb24ob3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSAkKG9wdGlvbikudmFsdWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodiAmJiB2ICE9PSAnZmEtJykgeyBkYXRhLnB1c2godik7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5nLWljb24tcHJldmlldycpLmh0bWwoJzxpIGNsYXNzPVwiZmEgJyArIGRhdGEuam9pbignICcpICsgJ1wiPjwvaT4gPHNwYW4+JyArIGRhdGFbMF0gKyAnPC9zcGFuPicpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlVG90YWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gY29udGFpbmVyLnNlYXJjaCgnW2RhdGEtZy1pY29uXTpub3QoLmhpZGUtaWNvbiknKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmZpbmQoJy5wYXJ0aWNsZS1zZWFyY2gtdG90YWwnKS50ZXh0KHRvdGFsID8gdG90YWwubGVuZ3RoIDogMCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZy1pY29uXScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3RpdmUgPSBjb250YWluZXIuZmluZCgnW2RhdGEtZy1pY29uXS5hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZSkgeyBhY3RpdmUucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUHJldmlldygpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nLXNlbGVjdF0nLCBmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG91dHB1dCA9IGNvbnRhaW5lci5maW5kKCcuZy1pY29uLXByZXZpZXcgaScpO1xuICAgICAgICAgICAgICAgICAgICBmaWVsZC52YWx1ZShvdXRwdXQuYXR0cmlidXRlKCdjbGFzcycpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVhbFByZXZpZXcuZmluZCgnaScpLmF0dHJpYnV0ZSgnY2xhc3MnLCBvdXRwdXQuYXR0cmlidXRlKCdjbGFzcycpKTtcblxuICAgICAgICAgICAgICAgICAgICBmaWVsZC5lbWl0KCdpbnB1dCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5lbWl0KCdpbnB1dCcsIHt0YXJnZXQ6IGZpZWxkfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgbW9kYWwuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5kZWxlZ2F0ZSgnY2hhbmdlJywgJy5nLXBhcnRpY2xlcy1oZWFkZXIgLmZsb2F0LXJpZ2h0IGlucHV0W3R5cGU9XCJjaGVja2JveFwiXSwgLmctcGFydGljbGVzLWhlYWRlciAuZmxvYXQtcmlnaHQgc2VsZWN0JywgZnVuY3Rpb24oLyplLCBpbnB1dCovKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5kZWxlZ2F0ZSgna2V5dXAnLCAnLnBhcnRpY2xlLXNlYXJjaC13cmFwcGVyIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJywgZnVuY3Rpb24oZSwgaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSAkKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaW5wdXQudmFsdWUoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGRlbiA9IGNvbnRhaW5lci5zZWFyY2goJ1tkYXRhLWctaWNvbl0uaGlkZS1pY29uJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpZGRlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGRlbi5yZW1vdmVDbGFzcygnaGlkZS1pY29uJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlVG90YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gY29udGFpbmVyLnNlYXJjaCgnW2RhdGEtZy1pY29uKj1cIicgKyB2YWx1ZSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnNlYXJjaCgnW2RhdGEtZy1pY29uXScpLmFkZENsYXNzKCdoaWRlLWljb24nKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZC5yZW1vdmVDbGFzcygnaGlkZS1pY29uJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVUb3RhbCgpO1xuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpY29ucy5mb3JFYWNoKGZ1bmN0aW9uKGljb24pIHtcbiAgICAgICAgICAgICAgICAgICAgaWNvbiA9ICQoaWNvbik7XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDUsIGwgPSAwOyBpID4gbDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXJnZSA9ICghaSkgPyAnbGcnIDogaSArICd4JztcbiAgICAgICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxpIGNsYXNzPVwiZmEgJyArIGljb24uZGF0YSgnZy1pY29uJykgKyAnIGZhLScgKyBsYXJnZSArICdcIj48L2k+ICc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpY29uLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogaHRtbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ21vdXNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiAnYWJvdmUtbW9kYWwsIGljb25zLXByZXZpZXcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldEV2ZW50czogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogMVxuICAgICAgICAgICAgICAgICAgICB9KS5vbignaGlkZGVuLnBvcG92ZXInLCBmdW5jdGlvbihpbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLiR0YXJnZXQpIHsgaW5zdGFuY2UuJHRhcmdldC5yZW1vdmUoKTsgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFpbnModmFsdWUsIGljb24uZGF0YSgnZy1pY29uJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgYWN0aXZlIGljb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGljb24uYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0b2dnbGUgb3B0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gY29udGFpbmVyLmZpbmQoJ1tuYW1lPVwiJyArIG5hbWUgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkKSB7IGZpZWxkLmNoZWNrZWQodHJ1ZSk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBjb250YWluZXIuZmluZCgnb3B0aW9uW3ZhbHVlPVwiJyArIG5hbWUgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZCkgeyBmaWVsZC5wYXJlbnQoKS52YWx1ZShuYW1lKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzY3JvbGwgaW50byBwbGFjZSBvZiBhY3RpdmUgaWNvblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdyYXAgPSBpY29uLnBhcmVudCgnLmljb25zLXdyYXBwZXInKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cmFwSGVpZ2h0ID0gd3JhcFswXS5vZmZzZXRIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cmFwWzBdLnNjcm9sbFRvcCA9IGljb25bMF0ub2Zmc2V0VG9wIC0gKHdyYXBIZWlnaHQgLyAyKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHByZXZpZXdcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHt9OyIsIlwidXNlIHN0cmljdFwiO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBjb2xvcnBpY2tlcjogcmVxdWlyZSgnLi9jb2xvcnBpY2tlcicpLFxuICAgIGZvbnRzOiByZXF1aXJlKCcuL2ZvbnRzJyksXG4gICAgbWVudTogcmVxdWlyZSgnLi9tZW51JyksXG4gICAgaWNvbnM6IHJlcXVpcmUoJy4vaWNvbnMnKSxcbiAgICBmaWxlcGlja2VyOiByZXF1aXJlKCcuL2ZpbGVwaWNrZXInKSxcbiAgICBjb2xsZWN0aW9uczogcmVxdWlyZSgnLi9jb2xsZWN0aW9ucycpLFxuICAgIGtleXZhbHVlOiByZXF1aXJlKCcuL2tleXZhbHVlJylcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciByZWFkeSAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICAkICAgICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICB6ZW4gICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgaGFzICAgICAgICAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L2hhcycpLFxuICAgIHNvbWUgICAgICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L3NvbWUnKSxcbiAgICBtb2RhbCAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdWknKS5tb2RhbCxcbiAgICB0b2FzdHIgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdWknKS50b2FzdHIsXG4gICAgcmVxdWVzdCAgICAgICA9IHJlcXVpcmUoJ2FnZW50JyksXG4gICAgaW5kZXhPZiAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvaW5kZXhPZicpLFxuICAgIGNvbnRhaW5zICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2NvbnRhaW5zJyksXG4gICAgbGFzdEl0ZW0gICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvbGFzdCcpLFxuICAgIHNpbXBsZVNvcnQgICAgPSByZXF1aXJlKCdzb3J0YWJsZWpzJyksXG4gICAgZXNjYXBlVW5pY29kZSA9IHJlcXVpcmUoJ21vdXQvc3RyaW5nL2VzY2FwZVVuaWNvZGUnKSxcblxuICAgIHRyaW0gICAgICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyksXG5cbiAgICBnZXRBamF4U3VmZml4ID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZ2V0LWFqYXgtc3VmZml4Jyk7XG5cbnJlcXVpcmUoJ2VsZW1lbnRzL2luc2VydGlvbicpO1xuXG5yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKTtcblxuICAgIHZhciBjcmVhdGVTb3J0YWJsZXMgPSBmdW5jdGlvbihsaXN0KSB7XG4gICAgICAgIHZhciBsaXN0cyA9IGxpc3QgfHwgJCgnLmcta2V5dmFsdWUtZmllbGQgdWwnKTtcbiAgICAgICAgaWYgKCFsaXN0cykgeyByZXR1cm47IH1cbiAgICAgICAgbGlzdHMuZm9yRWFjaChmdW5jdGlvbihsaXN0KSB7XG4gICAgICAgICAgICBsaXN0ID0gJChsaXN0KTtcbiAgICAgICAgICAgIGxpc3QuU2ltcGxlU29ydCA9IHNpbXBsZVNvcnQuY3JlYXRlKGxpc3RbMF0sIHtcbiAgICAgICAgICAgICAgICBoYW5kbGU6ICcuZmEtcmVvcmRlcicsXG4gICAgICAgICAgICAgICAgZmlsdGVyOiAnW2RhdGEta2V5dmFsdWUtbm9zb3J0XScsXG4gICAgICAgICAgICAgICAgc2Nyb2xsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IDE1MCxcbiAgICAgICAgICAgICAgICBvblN0YXJ0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzLmVsKS5hZGRDbGFzcygna2V5dmFsdWUtc29ydGluZycpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25FbmQ6IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQodGhpcy5lbCk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2tleXZhbHVlLXNvcnRpbmcnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZ0Lm9sZEluZGV4ID09PSBldnQubmV3SW5kZXgpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFGaWVsZCA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKS5maW5kKCdbZGF0YS1rZXl2YWx1ZS1kYXRhXScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSAgICAgID0gZGF0YUZpZWxkLnZhbHVlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zcGxpY2UoZXZ0Lm5ld0luZGV4LCAwLCBkYXRhLnNwbGljZShldnQub2xkSW5kZXgsIDEpWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUZpZWxkLnZhbHVlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZGF0YUZpZWxkIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgY3JlYXRlU29ydGFibGVzKCk7XG5cbiAgICAvLyBkZWxlZ2F0ZSBzb3J0YWJsZXMgY29sbGVjdGlvbnMgZm9yIGFqYXggc3VwcG9ydFxuICAgIGJvZHkuZGVsZWdhdGUoJ21vdXNlb3ZlcicsICcuZy1rZXl2YWx1ZS1maWVsZCB1bCcsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGlmICghZWxlbWVudC5TaW1wbGVTb3J0KSB7IGNyZWF0ZVNvcnRhYmxlcyhlbGVtZW50KTsgfVxuICAgIH0pO1xuXG4gICAgLy8gQWRkIG5ldyBpdGVtXG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEta2V5dmFsdWUtYWRkbmV3XScsIGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBwYXJhbSA9IGVsZW1lbnQucGFyZW50KCcuc2V0dGluZ3MtcGFyYW0nKSxcbiAgICAgICAgICAgIGxpc3QgID0gcGFyYW0uZmluZCgndWwnKSxcbiAgICAgICAgICAgIHRtcGwgID0gcGFyYW0uZmluZCgnW2RhdGEta2V5dmFsdWUtdGVtcGxhdGVdJyksXG4gICAgICAgICAgICBpdGVtcyA9IGxpc3Quc2VhcmNoKCc+IFtkYXRhLWtleXZhbHVlLWl0ZW1dJykgfHwgW10sXG4gICAgICAgICAgICBsYXN0ICA9ICQobGFzdEl0ZW0oaXRlbXMpKTtcblxuICAgICAgICB2YXIgY2xvbmUgPSAkKHRtcGxbMF0uY2xvbmVOb2RlKHRydWUpKTtcblxuICAgICAgICBpZiAobGFzdCkgeyBjbG9uZS5hZnRlcihsYXN0KTsgfVxuICAgICAgICBlbHNlIHsgY2xvbmUudG9wKGxpc3QpOyB9XG5cbiAgICAgICAgY2xvbmUuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpLmRhdGEoJ2tleXZhbHVlLWl0ZW0nLCBjbG9uZS5kYXRhKCdrZXl2YWx1ZS10ZW1wbGF0ZScpKTtcbiAgICAgICAgY2xvbmUuYXR0cmlidXRlKCdkYXRhLWtleXZhbHVlLXRlbXBsYXRlJywgbnVsbCk7XG4gICAgICAgIGNsb25lLmF0dHJpYnV0ZSgnZGF0YS1rZXl2YWx1ZS1ub3NvcnQnLCBudWxsKTtcbiAgICAgICAgY2xvbmUuZmluZCgnW2RhdGEta2V5dmFsdWUta2V5XScpWzBdLmZvY3VzKCk7XG5cbiAgICAgICAgLy9ib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBSZW1vdmUgaXRlbVxuICAgIGJvZHkuZGVsZWdhdGUoJ2NsaWNrJywgJ1tkYXRhLWtleXZhbHVlLXJlbW92ZV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICB2YXIgaXRlbSAgICAgID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWtleXZhbHVlLWl0ZW1dJyksXG4gICAgICAgICAgICBrZXkgICAgICAgPSBpdGVtLmZpbmQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykuZGF0YSgna2V5dmFsdWUta2V5JyksXG4gICAgICAgICAgICBkYXRhRmllbGQgPSBlbGVtZW50LnBhcmVudCgnLnNldHRpbmdzLXBhcmFtJykuZmluZCgnW2RhdGEta2V5dmFsdWUtZGF0YV0nKSxcbiAgICAgICAgICAgIGl0ZW1zICAgICA9IGVsZW1lbnQucGFyZW50KCd1bCcpLnNlYXJjaCgnPiBbZGF0YS1rZXl2YWx1ZS1pdGVtXScpLFxuICAgICAgICAgICAgaW5kZXggICAgID0gaW5kZXhPZihpdGVtcywgaXRlbVswXSksXG4gICAgICAgICAgICBkYXRhICAgICAgPSBKU09OLnBhcnNlKGRhdGFGaWVsZC52YWx1ZSgpKTtcblxuICAgICAgICBkYXRhLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIGRhdGFGaWVsZC52YWx1ZShlc2NhcGVVbmljb2RlKEpTT04uc3RyaW5naWZ5KGRhdGEpKSk7XG4gICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG5cbiAgICAgICAgYm9keS5lbWl0KCdjaGFuZ2UnLCB7IHRhcmdldDogZGF0YUZpZWxkIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gQ2hhbmdlIHZhbHVlc1xuICAgIGJvZHkuZGVsZWdhdGUoJ2JsdXInLCAnW2RhdGEta2V5dmFsdWUtaXRlbV0gaW5wdXRbdHlwZT1cInRleHRcIl0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgcGFyZW50ICAgICA9IGVsZW1lbnQucGFyZW50KCdbZGF0YS1rZXl2YWx1ZS1pdGVtXScpLFxuICAgICAgICAgICAgd3JhcHBlciAgICA9IHBhcmVudC5maW5kKCcuZy1rZXl2YWx1ZS13cmFwcGVyJyksXG4gICAgICAgICAgICBrZXlFbGVtZW50ID0gcGFyZW50LmZpbmQoJ1tkYXRhLWtleXZhbHVlLWtleV0nKSxcbiAgICAgICAgICAgIHZhbEVsZW1lbnQgPSBwYXJlbnQuZmluZCgnW2RhdGEta2V5dmFsdWUtdmFsdWVdJyksXG4gICAgICAgICAgICBrZXkgICAgICAgID0ga2V5RWxlbWVudC5kYXRhKCdrZXl2YWx1ZS1rZXknKSxcbiAgICAgICAgICAgIGtleVZhbHVlICAgPSB0cmltKGtleUVsZW1lbnQudmFsdWUoKSksXG4gICAgICAgICAgICB2YWxWYWx1ZSAgID0gdHJpbSh2YWxFbGVtZW50LnZhbHVlKCkpLFxuICAgICAgICAgICAgaXRlbXMgICAgID0gZWxlbWVudC5wYXJlbnQoJ3VsJykuc2VhcmNoKCc+IFtkYXRhLWtleXZhbHVlLWl0ZW1dOm5vdCguZy1rZXl2YWx1ZS13YXJuaW5nKTpub3QoLmcta2V5dmFsdWUtZXhjbHVkZWQpJyksXG4gICAgICAgICAgICBpbmRleCAgICAgPSBpbmRleE9mKGl0ZW1zLCBwYXJlbnRbMF0pLFxuXG4gICAgICAgICAgICBkYXRhRmllbGQgID0gZWxlbWVudC5wYXJlbnQoJy5zZXR0aW5ncy1wYXJhbScpLmZpbmQoJ1tkYXRhLWtleXZhbHVlLWRhdGFdJyksXG4gICAgICAgICAgICBkYXRhICAgICAgID0gSlNPTi5wYXJzZShkYXRhRmllbGQudmFsdWUoKSksXG4gICAgICAgICAgICBleGNsdWRlICAgID0gSlNPTi5wYXJzZShkYXRhRmllbGQuZGF0YSgna2V5dmFsdWUtZXhjbHVkZScpKSxcbiAgICAgICAgICAgIGV4Y2x1ZGVkICAgPSBjb250YWlucyhleGNsdWRlLCBrZXlWYWx1ZSksXG4gICAgICAgICAgICBkdXBsaWNhdGUgID0gc29tZShkYXRhLCBmdW5jdGlvbihvYmopIHsgcmV0dXJuIGhhcyhvYmosIGtleVZhbHVlKTsgfSkgJiYga2V5ICE9PSBrZXlWYWx1ZTtcblxuICAgICAgICBpZiAoa2V5RWxlbWVudCA9PSBlbGVtZW50KSB7XG4gICAgICAgICAgICAvLyByZW5hbWVkIG9yIGNsZWFyZWQga2V5LCBuZWVkIHRvIGNsZWFudXAgSlNPTlxuICAgICAgICAgICAgaWYgKGtleSAhPT0ga2V5VmFsdWUgJiYgIWR1cGxpY2F0ZSkge1xuICAgICAgICAgICAgICAgIGRhdGEuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICBrZXlFbGVtZW50LmRhdGEoJ2tleXZhbHVlLWtleScsIGtleVZhbHVlIHx8ICcnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFyZW50W2R1cGxpY2F0ZSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnZy1rZXl2YWx1ZS13YXJuaW5nJyk7XG4gICAgICAgICAgICBwYXJlbnRbZXhjbHVkZWQgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2cta2V5dmFsdWUtZXhjbHVkZWQnKTtcblxuICAgICAgICAgICAgd3JhcHBlcltleGNsdWRlZCB8fCBkdXBsaWNhdGUgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJ10oJ2ctdG9vbHRpcCcpO1xuICAgICAgICAgICAgd3JhcHBlci5kYXRhKCd0aXRsZScsIGR1cGxpY2F0ZSA/ICdUaGUga2V5IFwiJyArIGtleVZhbHVlICsgJ1wiIGlzIGEgZHVwbGljYXRlJyA6IChleGNsdWRlZCA/ICdUaGUga2V5IFwiJyArIGtleVZhbHVlICsgJ1wiIGhhcyBiZWVuIGV4Y2x1ZGVkIGFuZCBjYW5ub3QgYmUgdXNlZCcgOiBudWxsKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoa2V5VmFsdWUgJiYgIWV4Y2x1ZGVkICYmICFkdXBsaWNhdGUpIHtcbiAgICAgICAgICAgIGlmICghZGF0YVtpbmRleF0pIHsgZGF0YS5zcGxpY2UoaW5kZXgsIDAsIHt9KTsgfVxuICAgICAgICAgICAgZGF0YVtpbmRleF1ba2V5VmFsdWVdID0gdmFsVmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBkYXRhRmllbGQudmFsdWUoZXNjYXBlVW5pY29kZShKU09OLnN0cmluZ2lmeShkYXRhKSkpO1xuICAgICAgICBib2R5LmVtaXQoJ2NoYW5nZScsIHsgdGFyZ2V0OiBkYXRhRmllbGQgfSk7XG5cbiAgICB9LCB0cnVlKTtcblxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge307XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciAkICAgICAgICAgICAgID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICBkb21yZWFkeSAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKTtcblxuZG9tcmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZzUtY29udGVudF0gLmctbWFpbi1uYXYgLmctdG9wbGV2ZWwgW2RhdGEtZzUtYWpheGlmeV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICB2YXIgaXRlbXMgPSAkKCdbZGF0YS1nNS1jb250ZW50XSAuZy1tYWluLW5hdiAuZy10b3BsZXZlbCBbZGF0YS1nNS1hamF4aWZ5XSAhPiBsaScpO1xuICAgICAgICBpZiAoaXRlbXMpIHsgaXRlbXMucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOyB9XG4gICAgICAgIGVsZW1lbnQucGFyZW50KCdsaScpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICB9KTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHt9OyIsIlwidXNlIHN0cmljdFwiO1xudmFyIHJlYWR5ID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcbiAgICAkID0gcmVxdWlyZSgnZWxlbWVudHMvYXR0cmlidXRlcycpLFxuICAgIG1vZGFsID0gcmVxdWlyZSgnLi4vdWknKS5tb2RhbCxcbiAgICBjb250YWlucyA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvY29udGFpbnMnKSxcbiAgICBmb3JFYWNoID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL2ZvckVhY2gnKTtcblxucmVxdWlyZSgnLi4vdWkvcG9wb3ZlcicpO1xuXG52YXIgaXNGaXJlZm94ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2ZpcmVmb3gnKSA+IC0xLFxuICAgIEZPQ1VTSU4gICA9IGlzRmlyZWZveCA/ICdmb2N1cycgOiAnZm9jdXNpbic7XG5cbnJlYWR5KGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nLXN0eWxlc10nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChldmVudC50YXJnZXQpO1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfVxuICAgICAgICBpZiAodGFyZ2V0Lmhhc0NsYXNzKCdzd2F0Y2gtcHJldmlldycpIHx8IHRhcmdldC5wYXJlbnQoJy5zd2F0Y2gtcHJldmlldycpKSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgIDtcbiAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGVsZW1lbnQuZGF0YSgnZy1zdHlsZXMnKSksIGlucHV0LCB2YWx1ZSwgdHlwZSwgZXZ0O1xuICAgICAgICBmb3JFYWNoKGRhdGEsIGZ1bmN0aW9uKHByZXNldCwgbmFtZSkge1xuICAgICAgICAgICAgaW5wdXQgPSAkKCdbbmFtZT1cIicgKyBuYW1lICsgJ1wiXScpO1xuICAgICAgICAgICAgdmFsdWUgPSBpbnB1dCA/IGlucHV0LnZhbHVlKCkgOiBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKCFpbnB1dCB8fCB2YWx1ZSA9PT0gcHJlc2V0KSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICBldnQgPSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBpbnB1dCxcbiAgICAgICAgICAgICAgICBmb3JjZU92ZXJyaWRlOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0eXBlID0gKGlucHV0LnRhZygpID09ICdzZWxlY3QnIHx8IGNvbnRhaW5zKFsnaGlkZGVuJywgJ2NoZWNrYm94J10sIGlucHV0LnR5cGUoKSkpID8gJ2NoYW5nZScgOiAnaW5wdXQnO1xuXG4gICAgICAgICAgICBpbnB1dC52YWx1ZShwcmVzZXQpO1xuICAgICAgICAgICAgYm9keS5lbWl0KHR5cGUsIGV2dCk7XG4gICAgICAgICAgICBib2R5LmVtaXQoJ2tleXVwJywgZXZ0KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBib2R5LmRlbGVnYXRlKCdjbGljaycsICdbZGF0YS1nLXN0eWxlc10gLnN3YXRjaC1wcmV2aWV3JywgZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGltYWdlID0gZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWctc3R5bGVzXScpLmZpbmQoJ2ltZycpO1xuICAgICAgICBpZiAoIWltYWdlKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgY29udGVudDogaW1hZ2VbMF0ub3V0ZXJIVE1MLFxuICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFkZGluZyA9IHBhcnNlSW50KGNvbnRhaW5lci5jb21wdXRlKCdwYWRkaW5nLWxlZnQnKSwgMTApICsgcGFyc2VJbnQoY29udGFpbmVyLmNvbXB1dGUoJ3BhZGRpbmctcmlnaHQnKSwgMTApO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiAnODAlJyxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHBhZGRpbmcgKyAoaW1hZ2VbMF0ubmF0dXJhbFdpZHRoIHx8IGltYWdlWzBdLndpZHRoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge307XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIEVtaXR0ZXIgICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgQm91bmQgICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9vcHRpb25zJyksXG4gICAgYmluZCAgICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIGNvbnRhaW5zICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2NvbnRhaW5zJyksXG4gICAgRHJhZ0V2ZW50cyA9IHJlcXVpcmUoJy4vZHJhZy5ldmVudHMnKSxcbiAgICAkICAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKTtcblxuLy8gJCB1dGlsc1xucmVxdWlyZSgnZWxlbWVudHMvZXZlbnRzJyk7XG5yZXF1aXJlKCdlbGVtZW50cy9kZWxlZ2F0aW9uJyk7XG5cbnZhciBpc0lFID0gKG5hdmlnYXRvci5hcHBOYW1lID09PSBcIk1pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlclwiKTtcblxudmFyIERyYWdEcm9wID0gbmV3IHByaW1lKHtcblxuICAgIG1peGluOiBbQm91bmQsIE9wdGlvbnNdLFxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgb3B0aW9uczoge1xuICAgICAgICBkZWxlZ2F0ZTogbnVsbCxcbiAgICAgICAgZHJvcHBhYmxlczogZmFsc2UsXG4gICAgICAgIGNhdGNoQ2xpY2s6IGZhbHNlXG4gICAgfSxcblxuICAgIERSQUdfRVZFTlRTOiBEcmFnRXZlbnRzLFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9ICQoY29udGFpbmVyKTtcbiAgICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lcikgeyByZXR1cm47IH1cbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gICAgICAgIHRoaXMub3JpZ2luID0ge1xuICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICB0cmFuc2Zvcm06IG51bGwsXG4gICAgICAgICAgICBvZmZzZXQ6IHtcbiAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm1hdGNoZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sYXN0TWF0Y2hlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxhc3RPdmVyZWQgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuYXR0YWNoKCk7XG4gICAgfSxcblxuICAgIGF0dGFjaDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUQVJULmZvckVhY2goYmluZChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZGVsZWdhdGUoZXZlbnQsIHRoaXMub3B0aW9ucy5kZWxlZ2F0ZSwgdGhpcy5ib3VuZCgnc3RhcnQnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcbiAgICB9LFxuXG4gICAgZGV0YWNoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuU1RBUlQuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci51bmRlbGVnYXRlKGV2ZW50LCB0aGlzLm9wdGlvbnMuZGVsZWdhdGUsIHRoaXMuYm91bmQoJ3N0YXJ0JykpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIHN0YXJ0OiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudHlwZS5tYXRjaCgvXnRvdWNoL2kpKSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxJbnRlcnZhbCk7XG4gICAgICAgIGlmIChlbGVtZW50LkxNVG9vbHRpcCkgeyBlbGVtZW50LkxNVG9vbHRpcC5yZW1vdmUoKTsgfVxuICAgICAgICAkKCdodG1sJykuYXR0cmlidXRlKCdzdHlsZScsICdoZWlnaHQ6IDEwMCUgIWltcG9ydGFudCcpO1xuICAgICAgICB0aGlzLnNjcm9sbEhlaWdodCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0O1xuXG4gICAgICAgIC8vIFByZXZlbnRzIGRyYWdnaW5nIGEgY29sdW1uIGZyb20gaXRzZWxmIGFuZCBsaW1pdGluZyB0byBpdHMgaGFuZGxlXG4gICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIGlmICghZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWxtLXJvb3RdJykgJiYgZWxlbWVudC5oYXNDbGFzcygnZy1ibG9jaycpICYmICghdGFyZ2V0Lm1hdGNoZXMoJy5zdWJtZW51LXJlb3JkZXInKSAmJiAhdGFyZ2V0LnBhcmVudCgnLnN1Ym1lbnUtcmVvcmRlcicpKSkgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgICAgIGlmIChldmVudC53aGljaCAmJiBldmVudC53aGljaCAhPT0gMSB8fCAkKGV2ZW50LnRhcmdldCkubWF0Y2hlcyh0aGlzLm9wdGlvbnMuZXhjbHVkZSkpIHsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdGhpcy5tYXRjaGVkID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2F0Y2hDbGljaykgeyB0aGlzLm1vdmVkID0gZmFsc2U7IH1cblxuICAgICAgICAvLyB3ZSBmb3JjZSB0aGUgbWVudSBjb2x1bW4gcmVvcmRlciBoYW5kbGUgdG8gdGhlIGctYmxvY2sgcGFyZW50XG4gICAgICAgIGlmICh0YXJnZXQubWF0Y2hlcygnLnN1Ym1lbnUtcmVvcmRlcicpIHx8IHRhcmdldC5wYXJlbnQoJy5zdWJtZW51LXJlb3JkZXInKSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gdGFyZ2V0LnBhcmVudCgnW2RhdGEtbW0taWRdJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOmJlZm9yZXN0YXJ0JywgZXZlbnQsIHRoaXMuZWxlbWVudCk7XG5cbiAgICAgICAgLy8gU3RvcHMgZGVmYXVsdCBNUyB0b3VjaCBhY3Rpb25zIHNpbmNlIHByZXZlbnREZWZhdWx0IGRvZXNuJ3Qgd29ya1xuICAgICAgICBpZiAoaXNJRSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlKHtcbiAgICAgICAgICAgICAgICAnLW1zLXRvdWNoLWFjdGlvbic6ICdub25lJyxcbiAgICAgICAgICAgICAgICAndG91Y2gtYWN0aW9uJzogJ25vbmUnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0b3BzIHRleHQgc2VsZWN0aW9uXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdGhpcy5vcmlnaW4gPSB7XG4gICAgICAgICAgICB4OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYIDogZXZlbnQucGFnZVgsXG4gICAgICAgICAgICB5OiBldmVudC5jaGFuZ2VkVG91Y2hlcyA/IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogZXZlbnQucGFnZVksXG4gICAgICAgICAgICB0cmFuc2Zvcm06IHRoaXMuZWxlbWVudC5jb21wdXRlKCd0cmFuc2Zvcm0nKVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjbGllbnRSZWN0ID0gdGhpcy5lbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICB0aGlzLm9yaWdpbi5vZmZzZXQgPSB7XG4gICAgICAgICAgICBjbGllbnRSZWN0OiBjbGllbnRSZWN0LFxuICAgICAgICAgICAgeDogdGhpcy5vcmlnaW4ueCAtIGNsaWVudFJlY3QucmlnaHQsXG4gICAgICAgICAgICB5OiBjbGllbnRSZWN0LnRvcCAtIHRoaXMub3JpZ2luLnlcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBPbmx5IGFsbG93IHRvIHNvcnQgZ3JpZHMgd2hlbiB0YXJnZXRpbmcgdGhlIGxlZnQgaGFuZGxlXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnQuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT09ICdncmlkJyAmJiBNYXRoLmFicyh0aGlzLm9yaWdpbi5vZmZzZXQueCkgPCBjbGllbnRSZWN0LndpZHRoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgb2Zmc2V0ICA9IE1hdGguYWJzKHRoaXMub3JpZ2luLm9mZnNldC54KSxcbiAgICAgICAgICAgIGNvbHVtbnMgPSAodGhpcy5lbGVtZW50LnBhcmVudCgpLmRhdGEoJ2xtLWJsb2NrdHlwZScpID09PSAnZ3JpZCcgJiYgdGhpcy5lbGVtZW50LnBhcmVudCgpLnBhcmVudCgpLmRhdGEoJ2xtLXJvb3QnKSkgfHxcbiAgICAgICAgICAgICAgICAodGhpcy5lbGVtZW50LnBhcmVudCgpLnBhcmVudCgpLmRhdGEoJ2xtLWJsb2NrdHlwZScpID09ICdjb250YWluZXInICYmIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5kYXRhKCdsbS1yb290JykpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKSA9PSAnZ3JpZCcgJiZcbiAgICAgICAgICAgICh0aGlzLmVsZW1lbnQucGFyZW50KCkuZGF0YSgnbG0tYmxvY2t0eXBlJykgPT09ICdjb250YWluZXInICYmIHRoaXMuZWxlbWVudC5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5kYXRhKCdsbS1yb290JykpIHx8XG4gICAgICAgICAgICAodGhpcy5lbGVtZW50LnBhcmVudCgpLmRhdGEoJ2xtLWJsb2NrdHlwZScpID09PSAnc2VjdGlvbicgJiYgdGhpcy5lbGVtZW50LnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLmRhdGEoJ2xtLXJvb3QnKSlcbiAgICAgICAgKSB7IGNvbHVtbnMgPSBmYWxzZTsgfVxuXG4gICAgICAgIC8vIFJlc2l6aW5nIGFuZCBvbmx5IGlmIGl0J3Mgbm90IGEgbm9uLXZpc2libGUgKGF0b21zKSBzZWN0aW9uXG4gICAgICAgIGlmICgob2Zmc2V0IDwgNiAmJiB0aGlzLmVsZW1lbnQucGFyZW50KCkuZmluZCgnOmxhc3QtY2hpbGQnKSAhPT0gdGhpcy5lbGVtZW50KSB8fCAoY29sdW1ucyAmJiBvZmZzZXQgPiAzICYmIG9mZnNldCA8IDEwKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5wYXJlbnQoJ1tkYXRhLWxtLWJsb2NrdHlwZT1cImF0b21zXCJdJykpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6cmVzaXplJywgZXZlbnQsIHRoaXMuZWxlbWVudCwgKHRoaXMuZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpIHx8IHRoaXMuZWxlbWVudCkuc2libGluZ3MoJzpub3QoLnBsYWNlaG9sZGVyKScpLCB0aGlzLm9yaWdpbi5vZmZzZXQueCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29sdW1ucyB8fCAoZWxlbWVudC5oYXNDbGFzcygnc3VibWVudS1jb2x1bW4nKSAmJiAoIXRhcmdldC5tYXRjaGVzKCcuc3VibWVudS1yZW9yZGVyJykgJiYgIXRhcmdldC5wYXJlbnQoJy5zdWJtZW51LXJlb3JkZXInKSkpKSB7IHJldHVybiB0cnVlOyB9XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlKHtcbiAgICAgICAgICAgICdwb2ludGVyLWV2ZW50cyc6ICdub25lJyxcbiAgICAgICAgICAgIHpJbmRleDogMTAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLk1PVkUuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbihldmVudCwgdGhpcy5ib3VuZCgnbW92ZScpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbihldmVudCwgdGhpcy5ib3VuZCgnc3RvcCcpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6c3RhcnQnLCBldmVudCwgdGhpcy5lbGVtZW50KTtcblxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudHlwZS5tYXRjaCgvXnRvdWNoL2kpKSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxJbnRlcnZhbCk7XG4gICAgICAgICQoJ2h0bWwnKS5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCk7XG4gICAgICAgIGlmICghdGhpcy5tb3ZlZCAmJiB0aGlzLm9wdGlvbnMuY2F0Y2hDbGljaykge1xuICAgICAgICAgICAgLy8gdGhpcyBpcyBqdXN0IGEgY2xpY2tcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZSh7IHRyYW5zZm9ybTogdGhpcy5vcmlnaW4udHJhbnNmb3JtIHx8ICd0cmFuc2xhdGUoMCwgMCknIH0pO1xuICAgICAgICAgICAgdGhpcy5lbWl0KCdkcmFnZHJvcDpzdG9wJywgZXZlbnQsIHRoaXMubWF0Y2hlZCwgdGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMuX3JlbW92ZVN0eWxlQXR0cmlidXRlKHRoaXMuZWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOnN0b3A6YW5pbWF0aW9uJywgdGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6Y2xpY2snLCBldmVudCwgdGhpcy5lbGVtZW50KTtcblxuICAgICAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKGV2ZW50LCB0aGlzLmJvdW5kKCdzdG9wJykpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2V0dGluZ3MgPSB7IGR1cmF0aW9uOiAnMjUwbXMnIH07XG5cbiAgICAgICAgaWYgKHRoaXMucmVtb3ZlRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ21vdmUnKSk7XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG5cbiAgICAgICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKGV2ZW50LCB0aGlzLmJvdW5kKCdzdG9wJykpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbWl0KCdkcmFnZHJvcDpzdG9wOmVyYXNlJywgZXZlbnQsIHRoaXMuZWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5lbGVtZW50KSB7XG5cbiAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6c3RvcCcsIGV2ZW50LCB0aGlzLm1hdGNoZWQsIHRoaXMuZWxlbWVudCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUoMCwgMCknXG4gICAgICAgICAgICAgICAgfSkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMubWF0Y2hlZCkge1xuXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2sgPSBiaW5kKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlU3R5bGVBdHRyaWJ1dGUoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6c3RvcDphbmltYXRpb24nLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyksIDEpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMsIHRoaXMuZWxlbWVudCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdGhpcy5vcmlnaW4udHJhbnNmb3JtIHx8ICd0cmFuc2xhdGUoMCwgMCknLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgfSwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdGhpcy5vcmlnaW4udHJhbnNmb3JtIHx8ICd0cmFuc2xhdGUoMCwgMCknLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVTdHlsZUF0dHJpYnV0ZSh0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6c3RvcDphbmltYXRpb24nLCB0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5EUkFHX0VWRU5UUy5FVkVOVFMuTU9WRS5mb3JFYWNoKGJpbmQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihldmVudCwgdGhpcy5ib3VuZCgnbW92ZScpKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIHRoaXMuRFJBR19FVkVOVFMuRVZFTlRTLlNUT1AuZm9yRWFjaChiaW5kKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoZXZlbnQsIHRoaXMuYm91bmQoJ3N0b3AnKSk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICAgIH0sXG5cbiAgICBtb3ZlOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudHlwZS5tYXRjaCgvXnRvdWNoL2kpKSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH1cblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNhdGNoQ2xpY2spIHtcbiAgICAgICAgICAgIHZhciBkaWRJdE1vdmUgPSB7XG4gICAgICAgICAgICAgICAgeDogZXZlbnQuY2hhbmdlZFRvdWNoZXMgPyBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCA6IGV2ZW50LnBhZ2VYLFxuICAgICAgICAgICAgICAgIHk6IGV2ZW50LmNoYW5nZWRUb3VjaGVzID8gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVkgOiBldmVudC5wYWdlWVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRpZEl0TW92ZS54IC0gdGhpcy5vcmlnaW4ueCkgPD0gMyAmJiBNYXRoLmFicyhkaWRJdE1vdmUueSAtIHRoaXMub3JpZ2luLnkpIDw9IDMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5tb3ZlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZSh7IG9wYWNpdHk6IDAuNSB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ2RyYWdkcm9wOm1vdmU6b25jZScsIHRoaXMuZWxlbWVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubW92ZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGNsaWVudFggPSBldmVudC5jbGllbnRYIHx8IChldmVudC50b3VjaGVzICYmIGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCkgfHwgMCxcbiAgICAgICAgICAgIGNsaWVudFkgPSBldmVudC5jbGllbnRZIHx8IChldmVudC50b3VjaGVzICYmIGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WSkgfHwgMCxcbiAgICAgICAgICAgIG92ZXJpbmcgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGNsaWVudFgsIGNsaWVudFkpLFxuICAgICAgICAgICAgaXNHcmlkICA9IHRoaXMuZWxlbWVudC5kYXRhKCdsbS1ibG9ja3R5cGUnKSA9PT0gJ2dyaWQnO1xuXG5cbiAgICAgICAgLy8gTG9naWMgdG8gYXV0by1zY3JvbGwgb24gZHJhZ1xuICAgICAgICB2YXIgc2Nyb2xsSGVpZ2h0ID0gdGhpcy5zY3JvbGxIZWlnaHQsXG4gICAgICAgICAgICBIZWlnaHQgICAgICAgPSBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCxcbiAgICAgICAgICAgIFNjcm9sbCAgICAgICA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuXG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNjcm9sbEludGVydmFsKTtcbiAgICAgICAgaWYgKCFvdmVyaW5nKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGlmICghJChvdmVyaW5nKS5tYXRjaGVzKCcjdHJhc2gnKSAmJiAhJChvdmVyaW5nKS5wYXJlbnQoJyN0cmFzaCcpKSB7XG4gICAgICAgICAgICB2YXIgc3QsIHNsLCB0cmFzaCA9ICQoJyNnNS1jb250YWluZXIgI3RyYXNoJyk7XG4gICAgICAgICAgICBpZiAoY2xpZW50WSArIDUwID49IEhlaWdodCAmJiBTY3JvbGwgKyBIZWlnaHQgPCBzY3JvbGxIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbEludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsID0gKHdpbmRvdy5wYWdlWE9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCkgLSAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudExlZnQgfHwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHN0ID0gKHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wKSAtIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50VG9wIHx8IDApO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oc2wsIE1hdGgubWluKHNjcm9sbEhlaWdodCwgc3QgKyA0KSk7XG4gICAgICAgICAgICAgICAgfSwgOCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNsaWVudFkgLSA1MCA8PSAodHJhc2ggPyB0cmFzaFswXS5vZmZzZXRIZWlnaHQgOiAwKSAmJiBzY3JvbGxIZWlnaHQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzbCA9ICh3aW5kb3cucGFnZVhPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQpIC0gKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRMZWZ0IHx8IDApO1xuICAgICAgICAgICAgICAgICAgICBzdCA9ICh3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCkgLSAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFRvcCB8fCAwKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKHNsLCBNYXRoLm1heCgwLCBzdCAtIDQpKTtcbiAgICAgICAgICAgICAgICB9LCA4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdlIHR3ZWFrIHRoZSBvdmVyaW5nIHRvIHRha2UgaW50byBhY2NvdW50IHRoZSBuZWdhdGl2ZSBvZmZzZXQgZm9yIHRoZSBoYW5kbGVcbiAgICAgICAgaWYgKGlzR3JpZCkge1xuICAgICAgICAgICAgLy8gTW9yZSBhY2N1cmF0ZSBpczogY2xpZW50WCArICh0aGlzLmVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtIGNsaWVudFgpXG4gICAgICAgICAgICBvdmVyaW5nID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChjbGllbnRYICsgMzAsIGNsaWVudFkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFvdmVyaW5nKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHRoaXMubWF0Y2hlZCA9ICQob3ZlcmluZykubWF0Y2hlcyh0aGlzLm9wdGlvbnMuZHJvcHBhYmxlcykgPyBvdmVyaW5nIDogKCQob3ZlcmluZykucGFyZW50KHRoaXMub3B0aW9ucy5kcm9wcGFibGVzKSB8fCBbZmFsc2VdKVswXTtcbiAgICAgICAgdGhpcy5pc1BsYWNlSG9sZGVyID0gJChvdmVyaW5nKS5tYXRjaGVzKCdbZGF0YS1sbS1wbGFjZWhvbGRlcl0nKSA/IHRydWUgOiAoJChvdmVyaW5nKS5wYXJlbnQoJ1tkYXRhLWxtLXBsYWNlaG9sZGVyXScpID8gdHJ1ZSA6IGZhbHNlKTtcblxuICAgICAgICB2YXIgZGVsdGFYICAgID0gdGhpcy5sYXN0WCAtIGNsaWVudFgsXG4gICAgICAgICAgICBkZWx0YVkgICAgPSB0aGlzLmxhc3RZIC0gY2xpZW50WSxcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IE1hdGguYWJzKGRlbHRhWCkgPiBNYXRoLmFicyhkZWx0YVkpICYmIGRlbHRhWCA+IDAgJiYgJ2xlZnQnIHx8XG4gICAgICAgICAgICAgICAgTWF0aC5hYnMoZGVsdGFYKSA+IE1hdGguYWJzKGRlbHRhWSkgJiYgZGVsdGFYIDwgMCAmJiAncmlnaHQnIHx8XG4gICAgICAgICAgICAgICAgTWF0aC5hYnMoZGVsdGFZKSA+IE1hdGguYWJzKGRlbHRhWCkgJiYgZGVsdGFZID4gMCAmJiAndXAnIHx8XG4gICAgICAgICAgICAgICAgJ2Rvd24nO1xuXG5cbiAgICAgICAgZGVsdGFYID0gKGV2ZW50LmNoYW5nZWRUb3VjaGVzID8gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggOiBldmVudC5wYWdlWCkgLSB0aGlzLm9yaWdpbi54O1xuICAgICAgICBkZWx0YVkgPSAoZXZlbnQuY2hhbmdlZFRvdWNoZXMgPyBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSA6IGV2ZW50LnBhZ2VZKSAtIHRoaXMub3JpZ2luLnk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XG4gICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZSh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgnICsgZGVsdGFYICsgJ3B4LCAnICsgZGVsdGFZICsgJ3B4KScgfSk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzUGxhY2VIb2xkZXIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxhc3RNYXRjaGVkICYmIHRoaXMubWF0Y2hlZCAhPT0gdGhpcy5sYXN0TWF0Y2hlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6bGVhdmUnLCBldmVudCwgdGhpcy5sYXN0TWF0Y2hlZCwgdGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RNYXRjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoZWQgJiYgdGhpcy5tYXRjaGVkICE9PSB0aGlzLmxhc3RNYXRjaGVkICYmIG92ZXJpbmcgIT09IHRoaXMubGFzdE92ZXJlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6ZW50ZXInLCBldmVudCwgdGhpcy5tYXRjaGVkLCB0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdE1hdGNoZWQgPSB0aGlzLm1hdGNoZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoZWQgJiYgdGhpcy5sYXN0TWF0Y2hlZCkge1xuICAgICAgICAgICAgICAgIHZhciByZWN0ID0gdGhpcy5tYXRjaGVkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgICAgIC8vIE5vdGU6IHlvdSBjYW4gZGl2aWRlIHggYXhpcyBieSAzIHJhdGhlciB0aGFuIDIgZm9yIDQgZGlyZWN0aW9uc1xuICAgICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgeDogTWF0aC5hYnMoKGNsaWVudFggLSByZWN0LmxlZnQpKSA8IChyZWN0LndpZHRoIC8gMikgJiYgJ2JlZm9yZScgfHxcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoKGNsaWVudFggLSByZWN0LmxlZnQpKSA+PSAocmVjdC53aWR0aCAtIChyZWN0LndpZHRoIC8gMikpICYmICdhZnRlcicgfHxcbiAgICAgICAgICAgICAgICAgICAgJ290aGVyJyxcbiAgICAgICAgICAgICAgICAgICAgeTogTWF0aC5hYnMoKGNsaWVudFkgLSByZWN0LnRvcCkpIDwgKHJlY3QuaGVpZ2h0IC8gMikgJiYgJ2Fib3ZlJyB8fFxuICAgICAgICAgICAgICAgICAgICBNYXRoLmFicygoY2xpZW50WSAtIHJlY3QudG9wKSkgPj0gKHJlY3QuaGVpZ2h0IC8gMikgJiYgJ2JlbG93JyB8fFxuICAgICAgICAgICAgICAgICAgICAnb3RoZXInXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6bG9jYXRpb24nLCBldmVudCwgbG9jYXRpb24sIHRoaXMubWF0Y2hlZCwgdGhpcy5lbGVtZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdkcmFnZHJvcDpub2xvY2F0aW9uJywgZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sYXN0T3ZlcmVkID0gb3ZlcmluZztcbiAgICAgICAgdGhpcy5sYXN0WCA9IGNsaWVudFg7XG4gICAgICAgIHRoaXMubGFzdFkgPSBjbGllbnRZO1xuXG4gICAgICAgIHRoaXMuZW1pdCgnZHJhZ2Ryb3A6bW92ZScsIGV2ZW50LCB0aGlzLmVsZW1lbnQpO1xuICAgIH0sXG5cbiAgICBfcmVtb3ZlU3R5bGVBdHRyaWJ1dGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCB8fCB0aGlzLmVsZW1lbnQpO1xuICAgICAgICBpZiAoZWxlbWVudC5kYXRhKCdtbS1pZCcpKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGVsZW1lbnQuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpOy8vLnN0eWxlKHtmbGV4OiBmbGV4fSk7XG4gICAgfVxuXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBEcmFnRHJvcDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIGdldFN1cHBvcnRlZEV2ZW50ID0gZnVuY3Rpb24oZXZlbnRzKSB7XG4gICAgZXZlbnRzID0gZXZlbnRzLnNwbGl0KCcgJyk7XG5cbiAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLCBldmVudDtcbiAgICB2YXIgaXNTdXBwb3J0ZWQgPSBmYWxzZTtcblxuICAgIGZvciAodmFyIGkgPSBldmVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgZXZlbnQgPSAnb24nICsgZXZlbnRzW2ldO1xuICAgICAgICBpc1N1cHBvcnRlZCA9IChldmVudCBpbiBlbGVtZW50KTtcblxuICAgICAgICBpZiAoIWlzU3VwcG9ydGVkKSB7XG4gICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShldmVudCwgJ3JldHVybjsnKTtcbiAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gdHlwZW9mIGVsZW1lbnRbZXZlbnRdID09PSAnZnVuY3Rpb24nO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzU3VwcG9ydGVkKSB7XG4gICAgICAgICAgICBpc1N1cHBvcnRlZCA9IGV2ZW50c1tpXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZWxlbWVudCA9IG51bGw7XG4gICAgcmV0dXJuIGlzU3VwcG9ydGVkO1xufTtcblxudmFyIGdldFN1cHBvcnRlZEV2ZW50cyA9IGZ1bmN0aW9uKGV2ZW50cykge1xuICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdCgnICcpO1xuXG4gICAgdmFyIGlzU3VwcG9ydGVkID0gZmFsc2UsIHN1cHBvcnRlZCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSBldmVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgaXNTdXBwb3J0ZWQgPSBnZXRTdXBwb3J0ZWRFdmVudChldmVudHNbaV0pO1xuICAgICAgICBpZiAoaXNTdXBwb3J0ZWQpIHsgc3VwcG9ydGVkLnB1c2goaXNTdXBwb3J0ZWQpOyB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1cHBvcnRlZDtcbn07XG5cbnZhciBFVkVOVCA9IHtcbiAgICAgICAgU1RBUlQ6IGdldFN1cHBvcnRlZEV2ZW50KCdtb3VzZWRvd24gdG91Y2hzdGFydCBNU1BvaW50ZXJEb3duIHBvaW50ZXJkb3duJyksXG4gICAgICAgIE1PVkU6IGdldFN1cHBvcnRlZEV2ZW50KCdtb3VzZW1vdmUgdG91Y2htb3ZlIE1TUG9pbnRlck1vdmUgcG9pbnRlcm1vdmUnKSxcbiAgICAgICAgU1RPUDogZ2V0U3VwcG9ydGVkRXZlbnQoJ21vdXNldXAgdG91Y2hlbmQgTVNQb2ludGVyVXAgcG9pbnRlcnVwJylcbiAgICB9LFxuICAgIEVWRU5UUyA9IHtcbiAgICAgICAgU1RBUlQ6IGdldFN1cHBvcnRlZEV2ZW50cygnbW91c2Vkb3duIHRvdWNoc3RhcnQgTVNQb2ludGVyRG93biBwb2ludGVyZG93bicpLFxuICAgICAgICBNT1ZFOiBnZXRTdXBwb3J0ZWRFdmVudHMoJ21vdXNlbW92ZSB0b3VjaG1vdmUgTVNQb2ludGVyTW92ZSBwb2ludGVybW92ZScpLFxuICAgICAgICBTVE9QOiBnZXRTdXBwb3J0ZWRFdmVudHMoJ21vdXNldXAgdG91Y2hlbmQgTVNQb2ludGVyVXAgcG9pbnRlcnVwJylcbiAgICB9O1xuXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIEVWRU5UOiBFVkVOVCxcbiAgICBFVkVOVFM6IEVWRU5UU1xufTtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgTW9kYWwgPSByZXF1aXJlKCcuL21vZGFsJyksXG4gICAgU2VsZWN0aXplID0gcmVxdWlyZSgnLi9zZWxlY3RpemUnKTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgbW9kYWw6IG5ldyBNb2RhbCgpLFxuICAgIHRvZ2dsZXJzOiByZXF1aXJlKCcuL3RvZ2dsZXJzJyksXG4gICAgc2VsZWN0aXplOiBTZWxlY3RpemUsXG4gICAgdG9hc3RyOiByZXF1aXJlKCcuL3RvYXN0cicpXG59O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG4vLyBCYXNlZCBvbiBWZXggKGh0dHBzOi8vZ2l0aHViLmNvbS9odWJzcG90L3ZleClcblxudmFyIHByaW1lICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICAkICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzJyksXG4gICAgemVuICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcbiAgICBzdG9yYWdlICA9IHJlcXVpcmUoJ3ByaW1lL21hcCcpKCksXG4gICAgRW1pdHRlciAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgQm91bmQgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcbiAgICBkb21yZWFkeSA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG5cbiAgICBiaW5kICAgICA9IHJlcXVpcmUoJ21vdXQvZnVuY3Rpb24vYmluZCcpLFxuICAgIG1hcCAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9tYXAnKSxcbiAgICBmb3JFYWNoICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvZm9yRWFjaCcpLFxuICAgIGxhc3QgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9sYXN0JyksXG4gICAgbWVyZ2UgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC9tZXJnZScpLFxuXG4gICAgcmVxdWVzdCAgPSByZXF1aXJlKCdhZ2VudCcpO1xuXG52YXIgYW5pbWF0aW9uRW5kU3VwcG9ydCA9IGZhbHNlO1xuXG5kb21yZWFkeShmdW5jdGlvbigpIHtcbiAgICB2YXIgc3R5bGUgPSAoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLnN0eWxlO1xuXG4gICAgZm9yRWFjaChbJ2FuaW1hdGlvbicsICdXZWJraXRBbmltYXRpb24nLCAnTW96QW5pbWF0aW9uJywgJ01zQW5pbWF0aW9uJywgJ09BbmltYXRpb24nXSwgZnVuY3Rpb24oYW5pbWF0aW9uLCBpbmRleCkge1xuICAgICAgICBpZiAoYW5pbWF0aW9uRW5kU3VwcG9ydCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFuaW1hdGlvbkVuZFN1cHBvcnQgPSBzdHlsZVthbmltYXRpb25dICE9PSB1bmRlZmluZWQgPyBNb2RhbC5wcm90b3R5cGUuYW5pbWF0aW9uRW5kRXZlbnRbaW5kZXhdIDogZmFsc2U7XG4gICAgfSk7XG59KTtcblxudmFyIE1vZGFsID0gbmV3IHByaW1lKHtcbiAgICBtaXhpbjogW0JvdW5kLCBPcHRpb25zXSxcblxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgYW5pbWF0aW9uRW5kRXZlbnQ6IFsnYW5pbWF0aW9uZW5kJywgJ3dlYmtpdEFuaW1hdGlvbkVuZCcsICdtb3pBbmltYXRpb25FbmQnLCAnTVNBbmltYXRpb25FbmQnLCAnb2FuaW1hdGlvbmVuZCddLFxuXG4gICAgZ2xvYmFsSUQ6IDEsXG5cbiAgICBvcHRpb25zOiB7XG4gICAgICAgIGJhc2VDbGFzc05hbWVzOiB7XG4gICAgICAgICAgICBjb250YWluZXI6ICdnNS1kaWFsb2cnLFxuICAgICAgICAgICAgY29udGVudDogJ2c1LWNvbnRlbnQnLFxuICAgICAgICAgICAgb3ZlcmxheTogJ2c1LW92ZXJsYXknLFxuICAgICAgICAgICAgY2xvc2U6ICdnNS1jbG9zZScsXG4gICAgICAgICAgICBjbG9zaW5nOiAnZzUtY2xvc2luZycsXG4gICAgICAgICAgICBvcGVuOiAnZzUtZGlhbG9nLW9wZW4nXG4gICAgICAgIH0sXG5cbiAgICAgICAgY29udGVudDogJycsXG4gICAgICAgIHJlbW90ZTogJycsXG4gICAgICAgIHNob3dDbG9zZUJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgZXNjYXBlVG9DbG9zZTogdHJ1ZSxcbiAgICAgICAgb3ZlcmxheUNsaWNrVG9DbG9zZTogdHJ1ZSxcbiAgICAgICAgYXBwZW5kTm9kZTogJyNnNS1jb250YWluZXInLFxuICAgICAgICBjbGFzc05hbWU6ICdnNS1kaWFsb2ctdGhlbWUtZGVmYXVsdCcsXG4gICAgICAgIGNzczoge30sXG4gICAgICAgIG92ZXJsYXlDbGFzc05hbWU6ICcnLFxuICAgICAgICBvdmVybGF5Q1NTOiAnJyxcbiAgICAgICAgY29udGVudENsYXNzTmFtZTogJycsXG4gICAgICAgIGNvbnRlbnRDU1M6ICcnLFxuICAgICAgICBjbG9zZUNsYXNzTmFtZTogJ2c1LWRpYWxvZy1jbG9zZScsXG4gICAgICAgIGNsb3NlQ1NTOiAnJyxcblxuICAgICAgICBhZnRlck9wZW46IG51bGwsXG4gICAgICAgIGFmdGVyQ2xvc2U6IG51bGxcbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmRlZmF1bHRzID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgZG9tcmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKHdpbmRvdykub24oJ2tleWRvd24nLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAyNykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jbG9zZUJ5RXNjYXBlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGYuYW5pbWF0aW9uRW5kRXZlbnQgPSBhbmltYXRpb25FbmRTdXBwb3J0O1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzXG4gICAgICAgICAgICAub24oJ2RpYWxvZ09wZW4nLCBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMub3Blbik7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLmFkZENsYXNzKG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMub3Blbik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKCdkaWFsb2dBZnRlckNsb3NlJywgYmluZChmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFsbCA9IHRoaXMuZ2V0QWxsKCk7XG4gICAgICAgICAgICAgICAgaWYgKCFhbGwgfHwgIWFsbC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMub3Blbik7XG4gICAgICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5yZW1vdmVDbGFzcyhvcHRpb25zLmJhc2VDbGFzc05hbWVzLm9wZW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICB9LFxuXG4gICAgc3RvcmFnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBzdG9yYWdlO1xuICAgIH0sXG5cbiAgICBvcGVuOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBtZXJnZSh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICBvcHRpb25zLmlkID0gdGhpcy5nbG9iYWxJRCsrO1xuXG4gICAgICAgIHZhciBlbGVtZW50cyA9IHt9O1xuXG4gICAgICAgIC8vIGNvbnRhaW5lclxuICAgICAgICBlbGVtZW50cy5jb250YWluZXIgPSB6ZW4oJ2RpdicpXG4gICAgICAgICAgICAuYWRkQ2xhc3Mob3B0aW9ucy5iYXNlQ2xhc3NOYW1lcy5jb250YWluZXIpXG4gICAgICAgICAgICAuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc05hbWUpXG4gICAgICAgICAgICAuc3R5bGUob3B0aW9ucy5jc3MpO1xuXG4gICAgICAgIHN0b3JhZ2Uuc2V0KGVsZW1lbnRzLmNvbnRhaW5lciwgeyBkaWFsb2c6IG9wdGlvbnMgfSk7XG5cbiAgICAgICAgLy8gb3ZlcmxheVxuICAgICAgICBlbGVtZW50cy5vdmVybGF5ID0gemVuKCdkaXYnKVxuICAgICAgICAgICAgLmFkZENsYXNzKG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMub3ZlcmxheSlcbiAgICAgICAgICAgIC5hZGRDbGFzcyhvcHRpb25zLm92ZXJsYXlDbGFzc05hbWUpXG4gICAgICAgICAgICAuc3R5bGUob3B0aW9ucy5vdmVybGF5Q1NTKTtcblxuICAgICAgICBzdG9yYWdlLnNldChlbGVtZW50cy5vdmVybGF5LCB7IGRpYWxvZzogb3B0aW9ucyB9KTtcblxuICAgICAgICBpZiAob3B0aW9ucy5vdmVybGF5Q2xpY2tUb0Nsb3NlKSB7XG4gICAgICAgICAgICBlbGVtZW50cy5jb250YWluZXIub24oJ2NsaWNrJywgYmluZCh0aGlzLl9vdmVybGF5Q2xpY2ssIHRoaXMsIGVsZW1lbnRzLmNvbnRhaW5lclswXSkpO1xuICAgICAgICAgICAgZWxlbWVudHMub3ZlcmxheS5vbignY2xpY2snLCBiaW5kKHRoaXMuX292ZXJsYXlDbGljaywgdGhpcywgZWxlbWVudHMub3ZlcmxheVswXSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudHMuY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnRzLm92ZXJsYXkpO1xuXG4gICAgICAgIC8vIGNvbnRlbnRcbiAgICAgICAgZWxlbWVudHMuY29udGVudCA9IHplbignZGl2JylcbiAgICAgICAgICAgIC5hZGRDbGFzcyhvcHRpb25zLmJhc2VDbGFzc05hbWVzLmNvbnRlbnQpXG4gICAgICAgICAgICAuYWRkQ2xhc3Mob3B0aW9ucy5jb250ZW50Q2xhc3NOYW1lKVxuICAgICAgICAgICAgLnN0eWxlKG9wdGlvbnMuY29udGVudENTUylcbiAgICAgICAgICAgIC5odG1sKG9wdGlvbnMuY29udGVudCk7XG5cbiAgICAgICAgc3RvcmFnZS5zZXQoZWxlbWVudHMuY29udGVudCwgeyBkaWFsb2c6IG9wdGlvbnMgfSk7XG4gICAgICAgIGVsZW1lbnRzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGVtZW50cy5jb250ZW50KTtcblxuICAgICAgICBpZiAob3B0aW9ucy5vdmVybGF5Q2xpY2tUb0Nsb3NlKSB7XG4gICAgICAgICAgICBlbGVtZW50cy5jb250ZW50Lm9uKCdjbGljaycsIGZ1bmN0aW9uKC8qZSovKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmVtb3RlXG4gICAgICAgIGlmIChvcHRpb25zLnJlbW90ZSAmJiBvcHRpb25zLnJlbW90ZS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nKCk7XG5cbiAgICAgICAgICAgIG9wdGlvbnMubWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgJ2dldCc7XG4gICAgICAgICAgICB2YXIgYWdlbnQgPSByZXF1ZXN0KCk7XG4gICAgICAgICAgICBhZ2VudC5tZXRob2Qob3B0aW9ucy5tZXRob2QpO1xuICAgICAgICAgICAgYWdlbnQudXJsKG9wdGlvbnMucmVtb3RlKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmRhdGEpIHsgYWdlbnQuZGF0YShvcHRpb25zLmRhdGEpOyB9XG4gICAgICAgICAgICBhZ2VudC5zZW5kKGJpbmQoZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudHMuY29udGVudC5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCB8fCByZXNwb25zZS5ib2R5KTtcblxuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5odG1sKSB7IGVsZW1lbnRzLmNvbnRlbnQuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLmhpZGVMb2FkaW5nKCk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVtb3RlTG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucmVtb3RlTG9hZGVkKHJlc3BvbnNlLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0cyA9ICQoJ1tkYXRhLXNlbGVjdGl6ZV0nKTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0cykgeyBzZWxlY3RzLnNlbGVjdGl6ZSgpOyB9XG4gICAgICAgICAgICB9LCB0aGlzKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjbG9zZSBidXR0b25cbiAgICAgICAgaWYgKG9wdGlvbnMuc2hvd0Nsb3NlQnV0dG9uKSB7XG4gICAgICAgICAgICBlbGVtZW50cy5jbG9zZUJ1dHRvbiA9IHplbignZGl2JylcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3Mob3B0aW9ucy5iYXNlQ2xhc3NOYW1lcy5jbG9zZSlcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3Mob3B0aW9ucy5jbG9zZUNsYXNzTmFtZSlcbiAgICAgICAgICAgICAgICAuc3R5bGUob3B0aW9ucy5jbG9zZUNTUyk7XG5cbiAgICAgICAgICAgIHN0b3JhZ2Uuc2V0KGVsZW1lbnRzLmNsb3NlQnV0dG9uLCB7IGRpYWxvZzogb3B0aW9ucyB9KTtcbiAgICAgICAgICAgIGVsZW1lbnRzLmNvbnRlbnQuYXBwZW5kQ2hpbGQoZWxlbWVudHMuY2xvc2VCdXR0b24pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZGVsZWdhdGUgY29udGFpbmVyIHRvIHBpY2sgZzUtY2xvc2UgY2xpY2tzXG4gICAgICAgIGVsZW1lbnRzLmNvbnRhaW5lci5kZWxlZ2F0ZSgnY2xpY2snLCAnLmc1LWRpYWxvZy1jbG9zZScsIGJpbmQoZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuX2Nsb3NlQnV0dG9uQ2xpY2soZWxlbWVudHMuY29udGFpbmVyKTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIC8vIGluamVjdCB0aGUgZGlhbG9nIGluIHRoZSBET01cbiAgICAgICAgJChvcHRpb25zLmFwcGVuZE5vZGUpLmFwcGVuZENoaWxkKGVsZW1lbnRzLmNvbnRhaW5lcik7XG5cbiAgICAgICAgb3B0aW9ucy5lbGVtZW50cyA9IGVsZW1lbnRzO1xuXG4gICAgICAgIGlmIChvcHRpb25zLmFmdGVyT3Blbikge1xuICAgICAgICAgICAgb3B0aW9ucy5hZnRlck9wZW4oZWxlbWVudHMuY29udGVudCwgb3B0aW9ucyk7XG4gICAgICAgIH1cblxuICAgICAgICBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbWl0KCdkaWFsb2dPcGVuJywgb3B0aW9ucyk7XG4gICAgICAgIH0sIHRoaXMpLCAwKTtcblxuICAgICAgICByZXR1cm4gZWxlbWVudHMuY29udGVudDtcbiAgICB9LFxuXG4gICAgZ2V0QWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIHJldHVybiAkKFwiLlwiICsgb3B0aW9ucy5iYXNlQ2xhc3NOYW1lcy5jb250YWluZXIgKyBcIjpub3QoLlwiICsgb3B0aW9ucy5iYXNlQ2xhc3NOYW1lcy5jbG9zaW5nICsgXCIpIC5cIiArIG9wdGlvbnMuYmFzZUNsYXNzTmFtZXMuY29udGVudCk7XG4gICAgfSxcblxuICAgIGdldEJ5SUQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIHZhciBhbGwgPSB0aGlzLmdldEFsbCgpO1xuICAgICAgICBpZiAoIWFsbCkgeyByZXR1cm4gW107IH1cblxuICAgICAgICByZXR1cm4gJChhbGwuZmlsdGVyKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgcmV0dXJuIHN0b3JhZ2UuZ2V0KGVsZW1lbnQpLmRpYWxvZy5pZCA9PT0gaWQ7XG4gICAgICAgIH0pKTtcbiAgICB9LFxuXG4gICAgY2xvc2U6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIGlmICghaWQpIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChsYXN0KHRoaXMuZ2V0QWxsKCkpKTtcbiAgICAgICAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWQgPSBzdG9yYWdlLmdldChlbGVtZW50KS5kaWFsb2cuaWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZUJ5SUQoaWQpO1xuICAgIH0sXG5cbiAgICBjbG9zZUFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpZHM7XG5cbiAgICAgICAgaWRzID0gbWFwKHRoaXMuZ2V0QWxsKCksIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXG4gICAgICAgICAgICByZXR1cm4gc3RvcmFnZS5nZXQoZWxlbWVudCkuZGlhbG9nLmlkO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWlkcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvckVhY2goaWRzLnJldmVyc2UoKSwgZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb3NlQnlJRChpZCk7XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBjbG9zZUJ5SUQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIHZhciBjb250ZW50ID0gdGhpcy5nZXRCeUlEKGlkKTtcbiAgICAgICAgaWYgKCFjb250ZW50IHx8ICFjb250ZW50Lmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGNvbnRhaW5lciwgb3B0aW9ucztcblxuICAgICAgICBjb250YWluZXIgPSBzdG9yYWdlLmdldChjb250ZW50KS5kaWFsb2cuZWxlbWVudHMuY29udGFpbmVyO1xuICAgICAgICBvcHRpb25zID0gbWVyZ2Uoe30sIHN0b3JhZ2UuZ2V0KGNvbnRlbnQpLmRpYWxvZyk7XG5cbiAgICAgICAgdmFyIGJlZm9yZUNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYmVmb3JlQ2xvc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuYmVmb3JlQ2xvc2UoY29udGVudCwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsb3NlID0gYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb250ZW50LmVtaXQoJ2RpYWxvZ0Nsb3NlJywgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnZGlhbG9nQWZ0ZXJDbG9zZScsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmFmdGVyQ2xvc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuYWZ0ZXJDbG9zZShjb250ZW50LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICBpZiAoYW5pbWF0aW9uRW5kU3VwcG9ydCkge1xuICAgICAgICAgICAgYmVmb3JlQ2xvc2UoKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5vZmYodGhpcy5hbmltYXRpb25FbmRFdmVudCkub24odGhpcy5hbmltYXRpb25FbmRFdmVudCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb3NlKCk7XG4gICAgICAgICAgICB9KS5hZGRDbGFzcyhvcHRpb25zLmJhc2VDbGFzc05hbWVzLmNsb3NpbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYmVmb3JlQ2xvc2UoKTtcbiAgICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgY2xvc2VCeUVzY2FwZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpZHMsIGlkO1xuXG4gICAgICAgIGlkcyA9IG1hcCh0aGlzLmdldEFsbCgpLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICAgICAgcmV0dXJuIHN0b3JhZ2UuZ2V0KGVsZW1lbnQpLmRpYWxvZy5pZDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFpZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIGlkcyk7XG5cbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmdldEJ5SUQoaWQpO1xuXG4gICAgICAgIGlmICghc3RvcmFnZS5nZXQoZWxlbWVudCkuZGlhbG9nLmVzY2FwZVRvQ2xvc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmNsb3NlQnlJRChpZCk7XG5cbiAgICB9LFxuXG4gICAgc2hvd0xvYWRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmhpZGVMb2FkaW5nKCk7XG4gICAgICAgIHJldHVybiAkKCdib2R5JykuYXBwZW5kQ2hpbGQoemVuKCdkaXYuZzUtZGlhbG9nLWxvYWRpbmctc3Bpbm5lci4nICsgdGhpcy5vcHRpb25zLmNsYXNzTmFtZSkpO1xuICAgIH0sXG5cbiAgICBoaWRlTG9hZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzcGlubmVyID0gJCgnLmc1LWRpYWxvZy1sb2FkaW5nLXNwaW5uZXInKTtcbiAgICAgICAgcmV0dXJuIHNwaW5uZXIgPyBzcGlubmVyLnJlbW92ZSgpIDogZmFsc2U7XG4gICAgfSxcblxuICAgIC8vIHByaXZhdGVcbiAgICBfb3ZlcmxheUNsaWNrOiBmdW5jdGlvbihlbGVtZW50LCBldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ICE9PSBlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZShzdG9yYWdlLmdldCgkKGVsZW1lbnQpKS5kaWFsb2cuaWQpO1xuICAgIH0sXG5cbiAgICBfY2xvc2VCdXR0b25DbGljazogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZShzdG9yYWdlLmdldCgkKGVsZW1lbnQpKS5kaWFsb2cuaWQpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1vZGFsOyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcHJpbWUgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgICQgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICB6ZW4gICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIHN0b3JhZ2UgID0gcmVxdWlyZSgncHJpbWUvbWFwJykoKSxcbiAgICBFbWl0dGVyICA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvb3B0aW9ucycpLFxuICAgIGRvbXJlYWR5ID0gcmVxdWlyZSgnZWxlbWVudHMvZG9tcmVhZHknKSxcblxuICAgIGJpbmQgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgbWFwICAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L21hcCcpLFxuICAgIGZvckVhY2ggID0gcmVxdWlyZSgnbW91dC9hcnJheS9mb3JFYWNoJyksXG4gICAgbGFzdCAgICAgPSByZXF1aXJlKCdtb3V0L2FycmF5L2xhc3QnKSxcbiAgICBtZXJnZSAgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L21lcmdlJyksXG4gICAgaXNGdW5jdCAgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNGdW5jdGlvbicpLFxuXG4gICAgcmVxdWVzdCAgPSByZXF1aXJlKCdhZ2VudCcpO1xuXG52YXIgUG9wb3ZlciA9IG5ldyBwcmltZSh7XG4gICAgbWl4aW46IFtCb3VuZCwgT3B0aW9uc10sXG5cbiAgICBpbmhlcml0czogRW1pdHRlcixcblxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgbWFpbkNsYXNzOiAnZzUtcG9wb3ZlcicsXG4gICAgICAgIHBsYWNlbWVudDogJ2F1dG8nLFxuICAgICAgICB3aWR0aDogJ2F1dG8nLFxuICAgICAgICBoZWlnaHQ6ICdhdXRvJyxcbiAgICAgICAgdHJpZ2dlcjogJ2NsaWNrJyxcbiAgICAgICAgc3R5bGU6ICcnLFxuICAgICAgICBkZWxheTogMzAwLFxuICAgICAgICBjYWNoZTogdHJ1ZSxcbiAgICAgICAgbXVsdGk6IGZhbHNlLFxuICAgICAgICBhcnJvdzogdHJ1ZSxcbiAgICAgICAgdGl0bGU6ICcnLFxuICAgICAgICBjb250ZW50OiAnJyxcbiAgICAgICAgY2xvc2VhYmxlOiBmYWxzZSxcbiAgICAgICAgcGFkZGluZzogdHJ1ZSxcbiAgICAgICAgdGFyZ2V0RXZlbnRzOiB0cnVlLFxuICAgICAgICBhbGxvd0VsZW1lbnRzQ2xpY2s6IGZhbHNlLFxuICAgICAgICB1cmw6ICcnLFxuICAgICAgICB0eXBlOiAnaHRtbCcsXG4gICAgICAgIHdoZXJlOiAnI2c1LWNvbnRhaW5lcicsXG4gICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cImc1LXBvcG92ZXJcIj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJhcnJvd1wiPjwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cImc1LXBvcG92ZXItaW5uZXJcIj4nICtcbiAgICAgICAgJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJjbG9zZVwiPng8L2E+JyArXG4gICAgICAgICc8aDMgY2xhc3M9XCJnNS1wb3BvdmVyLXRpdGxlXCI+PC9oMz4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJnNS1wb3BvdmVyLWNvbnRlbnRcIj48aSBjbGFzcz1cImljb24tcmVmcmVzaFwiPjwvaT4gPHA+Jm5ic3A7PC9wPjwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICc8L2Rpdj4nXG4gICAgfSxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gJChlbGVtZW50KTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnRyaWdnZXIgPT09ICdjbGljaycpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5vZmYoJ2NsaWNrJywgdGhpcy5ib3VuZCgndG9nZ2xlJykpLm9uKCdjbGljaycsIHRoaXMuYm91bmQoJ3RvZ2dsZScpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5vZmYoJ21vdXNlZW50ZXInLCB0aGlzLmJvdW5kKCdtb3VzZWVudGVySGFuZGxlcicpKS5vZmYoJ21vdXNlbGVhdmUnLCB0aGlzLmJvdW5kKCdtb3VzZWxlYXZlSGFuZGxlcicpKVxuICAgICAgICAgICAgICAgIC5vbignbW91c2VlbnRlcicsIHRoaXMuYm91bmQoJ21vdXNlZW50ZXJIYW5kbGVyJykpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJywgdGhpcy5ib3VuZCgnbW91c2VsZWF2ZUhhbmRsZXInKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9wb3BlZCA9IGZhbHNlO1xuICAgICAgICAvL3RoaXMuX2luaXRlZCA9IHRydWU7XG4gICAgfSxcblxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgc3RvcmFnZS5zZXQodGhpcy5lbGVtZW50WzBdLCBudWxsKTtcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9mZignY2xpY2snLCB0aGlzLmJvdW5kKCd0b2dnbGUnKSkub2ZmKCdtb3VzZWVudGVyJywgdGhpcy5ib3VuZCgnbW91c2VlbnRlckhhbmRsZXInKSkub2ZmKCdtb3VzZWxlYXZlJywgdGhpcy5ib3VuZCgnbW91c2VsZWF2ZUhhbmRsZXInKSk7XG5cbiAgICAgICAgaWYgKHRoaXMuJHRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGhpZGU6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIC8vdmFyIGUgPSAkLkV2ZW50KCdoaWRlLicgKyBwbHVnaW5UeXBlKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmVtaXQoJ2hpZGUucG9wb3ZlcicsIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy4kdGFyZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXQucmVtb3ZlQ2xhc3MoJ2luJykuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSk7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXQucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbGVtZW50LmVtaXQoJ2hpZGRlbi5wb3BvdmVyJywgdGhpcyk7XG4gICAgfSxcblxuICAgIHRvZ2dsZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzW3RoaXMuZ2V0VGFyZ2V0KCkuaGFzQ2xhc3MoJ2luJykgPyAnaGlkZScgOiAnc2hvdyddKCk7XG4gICAgfSxcblxuICAgIGhpZGVBbGw6IGZ1bmN0aW9uKGZvcmNlKSB7XG4gICAgICAgIHZhciBjc3MgPSAnJztcbiAgICAgICAgaWYgKGZvcmNlKSB7IGNzcyA9ICdkaXYuJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3M7IH1cbiAgICAgICAgZWxzZSB7IGNzcyA9ICdkaXYuJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3MgKyAnOm5vdCguJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3MgKyAnLWZpeGVkKSc7IH1cblxuICAgICAgICB2YXIgZWxlbWVudHMgPSAkKGNzcyk7XG4gICAgICAgIGlmICghZWxlbWVudHMpIHsgcmV0dXJuIHRoaXM7IH1cbiAgICAgICAgZWxlbWVudHMucmVtb3ZlQ2xhc3MoJ2luJykuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKS5hdHRyaWJ1dGUoJ2NsYXNzJywgbnVsbCkuYWRkQ2xhc3ModGhpcy5vcHRpb25zLm1haW5DbGFzcyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMubXVsdGkpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZUFsbCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXNlIGNhY2hlIGJ5IGRlZmF1bHQsIGlmIG5vdCBjYWNoZSBzZXR0ZWQgICwgcmVJbml0IHRoZSBjb250ZW50c1xuICAgICAgICB0aGlzLmVsZW1lbnQuZW1pdCgnYmVmb3Jlc2hvdy5wb3BvdmVyJywgdGhpcyk7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmNhY2hlIHx8ICF0aGlzLl9wb3BlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRUaXRsZSh0aGlzLmdldFRpdGxlKCkpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5jbG9zZWFibGUpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQuZmluZCgnLmNsb3NlJykub2ZmKCdjbGljaycpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNBc3luYygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb250ZW50KHRoaXMuZ2V0Q29udGVudCgpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb250ZW50QVN5bmModGhpcy5vcHRpb25zLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheUNvbnRlbnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRhcmdldC5zdHlsZSh7IGRpc3BsYXk6ICdibG9jaycgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRpc3BsYXlDb250ZW50KCk7XG4gICAgICAgIHRoaXMuYmluZEJvZHlFdmVudHMoKTtcbiAgICB9LFxuXG4gICAgZGlzcGxheUNvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZWxlbWVudFBvcyAgICA9IHRoaXMuZWxlbWVudC5wb3NpdGlvbigpLFxuICAgICAgICAgICAgdGFyZ2V0ICAgICAgICA9IHRoaXMuZ2V0VGFyZ2V0KCkuYXR0cmlidXRlKCdjbGFzcycsIG51bGwpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5tYWluQ2xhc3MpLFxuICAgICAgICAgICAgdGFyZ2V0Q29udGVudCA9IHRoaXMuZ2V0Q29udGVudEVsZW1lbnQoKSxcbiAgICAgICAgICAgIHRhcmdldFdpZHRoLCB0YXJnZXRIZWlnaHQsIHBsYWNlbWVudDtcblxuICAgICAgICB0aGlzLmVsZW1lbnQuZW1pdCgnc2hvdy5wb3BvdmVyJywgdGhpcyk7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy53aWR0aCAhPT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICB0YXJnZXQuc3R5bGUoeyB3aWR0aDogdGhpcy5vcHRpb25zLndpZHRoIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGVpZ2h0ICE9PSAnYXV0bycpIHtcbiAgICAgICAgICAgIHRhcmdldENvbnRlbnQuc3R5bGUoeyBoZWlnaHQ6IHRoaXMub3B0aW9ucy5oZWlnaHQgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpbml0IHRoZSBwb3BvdmVyIGFuZCBpbnNlcnQgaW50byB0aGUgZG9jdW1lbnQgYm9keVxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5hcnJvdyAmJiB0YXJnZXQuZmluZCgnLmFycm93JykpIHtcbiAgICAgICAgICAgIHRhcmdldC5maW5kKCcuYXJyb3cnKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXQucmVtb3ZlKCkuc3R5bGUoe1xuICAgICAgICAgICAgdG9wOiAtMTAwMCxcbiAgICAgICAgICAgIGxlZnQ6IC0xMDAwLFxuICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJ1xuICAgICAgICB9KS5ib3R0b20odGhpcy5vcHRpb25zLndoZXJlKTtcbiAgICAgICAgdGFyZ2V0V2lkdGggPSB0YXJnZXRbMF0ub2Zmc2V0V2lkdGg7XG4gICAgICAgIHRhcmdldEhlaWdodCA9IHRhcmdldFswXS5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIHBsYWNlbWVudCA9IHRoaXMuZ2V0UGxhY2VtZW50KGVsZW1lbnRQb3MsIHRhcmdldEhlaWdodCk7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudGFyZ2V0RXZlbnRzKSB7IHRoaXMuaW5pdFRhcmdldEV2ZW50cygpOyB9XG4gICAgICAgIHZhciBwb3NpdGlvbkluZm8gPSB0aGlzLmdldFRhcmdldFBvc2l0aW4oZWxlbWVudFBvcywgcGxhY2VtZW50LCB0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0KTtcbiAgICAgICAgdGhpcy4kdGFyZ2V0LnN0eWxlKHBvc2l0aW9uSW5mby5wb3NpdGlvbikuYWRkQ2xhc3MocGxhY2VtZW50KS5hZGRDbGFzcygnaW4nKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnR5cGUgPT09ICdpZnJhbWUnKSB7XG4gICAgICAgICAgICB2YXIgaWZyYW1lID0gdGFyZ2V0LmZpbmQoJ2lmcmFtZScpO1xuICAgICAgICAgICAgaWZyYW1lLnN0eWxlKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogdGFyZ2V0LnBvc2l0aW9uKCkud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBpZnJhbWUucGFyZW50KCkucG9zaXRpb24uaGVpZ2h0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3R5bGUpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLnN0eWxlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zdHlsZSA9IHRoaXMub3B0aW9ucy5zdHlsZS5zcGxpdCgnLCcpLm1hcChGdW5jdGlvbi5wcm90b3R5cGUuY2FsbCwgU3RyaW5nLnByb3RvdHlwZS50cmltKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnN0eWxlLmZvckVhY2goZnVuY3Rpb24oc3R5bGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR0YXJnZXQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLm1haW5DbGFzcyArICctJyArIHN0eWxlKTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucGFkZGluZykge1xuICAgICAgICAgICAgdGFyZ2V0Q29udGVudC5jc3MoJ2hlaWdodCcsIHRhcmdldENvbnRlbnQucG9zaXRpb24oKS5oZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LmFkZENsYXNzKCdnNS1wb3BvdmVyLW5vLXBhZGRpbmcnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5hcnJvdykge1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LnN0eWxlKHsgJ21hcmdpbic6IDAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hcnJvdykge1xuICAgICAgICAgICAgdmFyIGFycm93ID0gdGhpcy4kdGFyZ2V0LmZpbmQoJy5hcnJvdycpO1xuICAgICAgICAgICAgYXJyb3cuYXR0cmlidXRlKCdzdHlsZScsIG51bGwpO1xuICAgICAgICAgICAgaWYgKHBvc2l0aW9uSW5mby5hcnJvd09mZnNldCkge1xuICAgICAgICAgICAgICAgIGFycm93LnN0eWxlKHBvc2l0aW9uSW5mby5hcnJvd09mZnNldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcG9wZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmVsZW1lbnQuZW1pdCgnc2hvd24ucG9wb3ZlcicsIHRoaXMpO1xuXG4gICAgfSxcblxuXG4gICAgLypnZXR0ZXIgc2V0dGVycyAqL1xuICAgIGdldFRhcmdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy4kdGFyZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLiR0YXJnZXQgPSAkKHplbignZGl2JykuaHRtbCh0aGlzLm9wdGlvbnMudGVtcGxhdGUpLmNoaWxkcmVuKClbMF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLiR0YXJnZXQ7XG4gICAgfSxcblxuICAgIGdldFRpdGxlRWxlbWVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFRhcmdldCgpLmZpbmQoJy4nICsgdGhpcy5vcHRpb25zLm1haW5DbGFzcyArICctdGl0bGUnKTtcbiAgICB9LFxuXG4gICAgZ2V0Q29udGVudEVsZW1lbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRUYXJnZXQoKS5maW5kKCcuJyArIHRoaXMub3B0aW9ucy5tYWluQ2xhc3MgKyAnLWNvbnRlbnQnKTtcbiAgICB9LFxuXG4gICAgZ2V0VGl0bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRpdGxlIHx8IHRoaXMuZWxlbWVudC5kYXRhKCdnNS1wb3BvdmVyLXRpdGxlJykgfHwgdGhpcy5lbGVtZW50LmF0dHJpYnV0ZSgndGl0bGUnKTtcbiAgICB9LFxuXG4gICAgc2V0VGl0bGU6IGZ1bmN0aW9uKHRpdGxlKSB7XG4gICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5nZXRUaXRsZUVsZW1lbnQoKTtcbiAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgICBlbGVtZW50Lmh0bWwodGl0bGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBoYXNDb250ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29udGVudCgpO1xuICAgIH0sXG5cbiAgICBnZXRDb250ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy51cmwpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudHlwZSA9PT0gJ2lmcmFtZScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSAkKCc8aWZyYW1lIGZyYW1lYm9yZGVyPVwiMFwiPjwvaWZyYW1lPicpLmF0dHJpYnV0ZSgnc3JjJywgdGhpcy5vcHRpb25zLnVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuY29udGVudCkge1xuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSAnJztcbiAgICAgICAgICAgIGlmIChpc0Z1bmN0KHRoaXMub3B0aW9ucy5jb250ZW50KSkge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLm9wdGlvbnMuY29udGVudC5hcHBseSh0aGlzLmVsZW1lbnRbMF0sIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLm9wdGlvbnMuY29udGVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuZWxlbWVudC5kYXRhKCdnNS1wb3BvdmVyLWNvbnRlbnQnKSB8fCBjb250ZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRlbnQ7XG4gICAgfSxcblxuICAgIHNldENvbnRlbnQ6IGZ1bmN0aW9uKGNvbnRlbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7XG4gICAgICAgIHRoaXMuZ2V0Q29udGVudEVsZW1lbnQoKS5odG1sKGNvbnRlbnQpO1xuICAgICAgICB0aGlzLiR0YXJnZXQgPSB0YXJnZXQ7XG4gICAgfSxcblxuICAgIGlzQXN5bmM6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnR5cGUgPT09ICdhc3luYyc7XG4gICAgfSxcblxuICAgIHNldENvbnRlbnRBU3luYzogZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgICByZXF1ZXN0KCdnZXQnLCB0aGlzLm9wdGlvbnMudXJsLCBiaW5kKGZ1bmN0aW9uKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKGNvbnRlbnQgJiYgaXNGdW5jdChjb250ZW50KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudCA9IGNvbnRlbnQuYXBwbHkodGhpcy5lbGVtZW50WzBdLCBbcmVzcG9uc2VdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50ID0gcmVzcG9uc2UuYm9keS5odG1sO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnNldENvbnRlbnQodGhpcy5jb250ZW50KTtcblxuICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0Q29udGVudEVsZW1lbnQoKTtcbiAgICAgICAgICAgIHRhcmdldC5hdHRyaWJ1dGUoJ3N0eWxlJywgbnVsbCk7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlDb250ZW50KCk7XG4gICAgICAgICAgICB0aGlzLmJpbmRCb2R5RXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHZhciBzZWxlY3RzID0gJCgnW2RhdGEtc2VsZWN0aXplXScpO1xuICAgICAgICAgICAgaWYgKHNlbGVjdHMpIHsgc2VsZWN0cy5zZWxlY3RpemUoKTsgfVxuICAgICAgICB9LCB0aGlzKSk7XG4gICAgfSxcblxuICAgIGJpbmRCb2R5RXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG4gICAgICAgIGJvZHkub2ZmKCdrZXl1cCcsIHRoaXMuYm91bmQoJ2VzY2FwZUhhbmRsZXInKSkub24oJ2tleXVwJywgdGhpcy5ib3VuZCgnZXNjYXBlSGFuZGxlcicpKTtcbiAgICAgICAgYm9keS5vZmYoJ2NsaWNrJywgdGhpcy5ib3VuZCgnYm9keUNsaWNrSGFuZGxlcicpKS5vbignY2xpY2snLCB0aGlzLmJvdW5kKCdib2R5Q2xpY2tIYW5kbGVyJykpO1xuICAgIH0sXG5cblxuICAgIC8qIGV2ZW50IGhhbmRsZXJzICovXG4gICAgbW91c2VlbnRlckhhbmRsZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5fdGltZW91dCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVvdXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKHRoaXMuZ2V0VGFyZ2V0KClbMF0ub2Zmc2V0V2lkdGggPiAwIHx8IHRoaXMuZ2V0VGFyZ2V0KClbMF0ub2Zmc2V0SGVpZ2h0ID4gMCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvdygpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBtb3VzZWxlYXZlSGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGtleSBwb2ludCwgc2V0IHRoZSBfdGltZW91dCAgdGhlbiB1c2UgY2xlYXJUaW1lb3V0IHdoZW4gbW91c2UgbGVhdmVcbiAgICAgICAgdGhpcy5fdGltZW91dCA9IHNldFRpbWVvdXQoYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICB9LCB0aGlzKSwgdGhpcy5vcHRpb25zLmRlbGF5KTtcbiAgICB9LFxuXG4gICAgZXNjYXBlSGFuZGxlcjogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAyNykge1xuICAgICAgICAgICAgdGhpcy5oaWRlQWxsKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYm9keUNsaWNrSGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaGlkZUFsbCgpO1xuICAgIH0sXG5cbiAgICB0YXJnZXRDbGlja0hhbmRsZXI6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9LFxuXG4gICAgaW5pdFRhcmdldEV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudHJpZ2dlciAhPT0gJ2NsaWNrJykge1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0XG4gICAgICAgICAgICAgICAgLm9mZignbW91c2VlbnRlcicsIHRoaXMuYm91bmQoJ21vdXNlZW50ZXInKSlcbiAgICAgICAgICAgICAgICAub2ZmKCdtb3VzZWxlYXZlJywgdGhpcy5ib3VuZCgnbW91c2VsZWF2ZScpKVxuICAgICAgICAgICAgICAgIC5vbignbW91c2VlbnRlcicsIHRoaXMuYm91bmQoJ21vdXNlZW50ZXJIYW5kbGVyJykpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJywgdGhpcy5ib3VuZCgnbW91c2VsZWF2ZUhhbmRsZXInKSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY2xvc2UgPSB0aGlzLiR0YXJnZXQuZmluZCgnLmNsb3NlJyk7XG4gICAgICAgIGlmIChjbG9zZSkge1xuICAgICAgICAgICAgY2xvc2Uub2ZmKCdjbGljaycsIHRoaXMuYm91bmQoJ2hpZGUnKSkub24oJ2NsaWNrJywgdGhpcy5ib3VuZCgnaGlkZScpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuJHRhcmdldC5vZmYoJ2NsaWNrJywgdGhpcy5ib3VuZCgndGFyZ2V0Q2xpY2tIYW5kbGVyJykpLm9uKCdjbGljaycsIHRoaXMuYm91bmQoJ3RhcmdldENsaWNrSGFuZGxlcicpKTtcbiAgICB9LFxuXG4gICAgLyogdXRpbHMgbWV0aG9kcyAqL1xuICAgIGdldFBsYWNlbWVudDogZnVuY3Rpb24ocG9zLCB0YXJnZXRIZWlnaHQpIHtcbiAgICAgICAgdmFyXG4gICAgICAgICAgICBwbGFjZW1lbnQsXG4gICAgICAgICAgICBkZSAgICAgICAgICAgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsXG4gICAgICAgICAgICBkYiAgICAgICAgICAgPSBkb2N1bWVudC5ib2R5LFxuICAgICAgICAgICAgY2xpZW50V2lkdGggID0gZGUuY2xpZW50V2lkdGgsXG4gICAgICAgICAgICBjbGllbnRIZWlnaHQgPSBkZS5jbGllbnRIZWlnaHQsXG4gICAgICAgICAgICBzY3JvbGxUb3AgICAgPSBNYXRoLm1heChkYi5zY3JvbGxUb3AsIGRlLnNjcm9sbFRvcCksXG4gICAgICAgICAgICBzY3JvbGxMZWZ0ICAgPSBNYXRoLm1heChkYi5zY3JvbGxMZWZ0LCBkZS5zY3JvbGxMZWZ0KSxcbiAgICAgICAgICAgIHBhZ2VYICAgICAgICA9IE1hdGgubWF4KDAsIHBvcy5sZWZ0IC0gc2Nyb2xsTGVmdCksXG4gICAgICAgICAgICBwYWdlWSAgICAgICAgPSBNYXRoLm1heCgwLCBwb3MudG9wIC0gc2Nyb2xsVG9wKSxcbiAgICAgICAgICAgIGFycm93U2l6ZSAgICA9IDIwO1xuXG4gICAgICAgIC8vIGlmIHBsYWNlbWVudCBlcXVhbHMgYXV0b++8jGNhY3VsYXRlIHRoZSBwbGFjZW1lbnQgYnkgZWxlbWVudCBpbmZvcm1hdGlvbjtcbiAgICAgICAgaWYgKHR5cGVvZih0aGlzLm9wdGlvbnMucGxhY2VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcGxhY2VtZW50ID0gdGhpcy5vcHRpb25zLnBsYWNlbWVudC5jYWxsKHRoaXMsIHRoaXMuZ2V0VGFyZ2V0KClbMF0sIHRoaXMuZWxlbWVudFswXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwbGFjZW1lbnQgPSB0aGlzLmVsZW1lbnQuZGF0YSgnZzUtcG9wb3Zlci1wbGFjZW1lbnQnKSB8fCB0aGlzLm9wdGlvbnMucGxhY2VtZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBsYWNlbWVudCA9PT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICBpZiAocGFnZVggPCBjbGllbnRXaWR0aCAvIDMpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFnZVkgPCBjbGllbnRIZWlnaHQgLyAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICdib3R0b20tcmlnaHQnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFnZVkgPCBjbGllbnRIZWlnaHQgKiAyIC8gMykge1xuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSAncmlnaHQnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICd0b3AtcmlnaHQnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL3BsYWNlbWVudD0gcGFnZVk+dGFyZ2V0SGVpZ2h0K2Fycm93U2l6ZT8ndG9wLXJpZ2h0JzonYm90dG9tLXJpZ2h0JztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFnZVggPCBjbGllbnRXaWR0aCAqIDIgLyAzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VZIDwgY2xpZW50SGVpZ2h0IC8gMykge1xuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSAnYm90dG9tJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VZIDwgY2xpZW50SGVpZ2h0ICogMiAvIDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ2JvdHRvbSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ3RvcCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwbGFjZW1lbnQgPSBwYWdlWSA+IHRhcmdldEhlaWdodCArIGFycm93U2l6ZSA/ICd0b3AtbGVmdCcgOiAnYm90dG9tLWxlZnQnO1xuICAgICAgICAgICAgICAgIGlmIChwYWdlWSA8IGNsaWVudEhlaWdodCAvIDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ2JvdHRvbS1sZWZ0JztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VZIDwgY2xpZW50SGVpZ2h0ICogMiAvIDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcGxhY2VtZW50ID0gJ2xlZnQnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9ICd0b3AtbGVmdCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwbGFjZW1lbnQ7XG4gICAgfSxcblxuICAgIGdldFRhcmdldFBvc2l0aW46IGZ1bmN0aW9uKGVsZW1lbnRQb3MsIHBsYWNlbWVudCwgdGFyZ2V0V2lkdGgsIHRhcmdldEhlaWdodCkge1xuICAgICAgICB2YXIgcG9zICAgICAgICAgPSBlbGVtZW50UG9zLFxuICAgICAgICAgICAgZWxlbWVudFcgICAgPSB0aGlzLmVsZW1lbnQucG9zaXRpb24oKS53aWR0aCxcbiAgICAgICAgICAgIGVsZW1lbnRIICAgID0gdGhpcy5lbGVtZW50LnBvc2l0aW9uKCkuaGVpZ2h0LFxuICAgICAgICAgICAgcG9zaXRpb24gICAgPSB7fSxcbiAgICAgICAgICAgIGFycm93T2Zmc2V0ID0gbnVsbCxcbiAgICAgICAgICAgIGFycm93U2l6ZSAgID0gdGhpcy5vcHRpb25zLmFycm93ID8gMjggOiAwLFxuICAgICAgICAgICAgZml4ZWRXICAgICAgPSBlbGVtZW50VyA8IGFycm93U2l6ZSArIDEwID8gYXJyb3dTaXplIDogMCxcbiAgICAgICAgICAgIGZpeGVkSCAgICAgID0gZWxlbWVudEggPCBhcnJvd1NpemUgKyAxMCA/IGFycm93U2l6ZSA6IDA7XG4gICAgICAgIHN3aXRjaCAocGxhY2VtZW50KSB7XG4gICAgICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aCAvIDIgLSB0YXJnZXRXaWR0aCAvIDJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wIC0gdGFyZ2V0SGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aCAvIDIgLSB0YXJnZXRXaWR0aCAvIDJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQgLyAyIC0gdGFyZ2V0SGVpZ2h0IC8gMixcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgLSB0YXJnZXRXaWR0aFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQgLyAyIC0gdGFyZ2V0SGVpZ2h0IC8gMixcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGhcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wIC0gdGFyZ2V0SGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBwb3MubGVmdCAtIGZpeGVkV1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYXJyb3dPZmZzZXQgPSB7IGxlZnQ6IGVsZW1lbnRXIC8gMiArIGZpeGVkVyB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndG9wLWxlZnQnOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHBvcy50b3AgLSB0YXJnZXRIZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0IC0gdGFyZ2V0V2lkdGggKyBwb3Mud2lkdGggKyBmaXhlZFdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGFycm93T2Zmc2V0ID0geyBsZWZ0OiB0YXJnZXRXaWR0aCAtIGVsZW1lbnRXIC8gMiAtIGZpeGVkVyB9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYm90dG9tLXJpZ2h0JzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wICsgcG9zLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgLSBmaXhlZFdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGFycm93T2Zmc2V0ID0geyBsZWZ0OiBlbGVtZW50VyAvIDIgKyBmaXhlZFcgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbS1sZWZ0JzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wICsgcG9zLmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgLSB0YXJnZXRXaWR0aCArIHBvcy53aWR0aCArIGZpeGVkV1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYXJyb3dPZmZzZXQgPSB7IGxlZnQ6IHRhcmdldFdpZHRoIC0gZWxlbWVudFcgLyAyIC0gZml4ZWRXIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyaWdodC10b3AnOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHBvcy50b3AgLSB0YXJnZXRIZWlnaHQgKyBwb3MuaGVpZ2h0ICsgZml4ZWRILFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYXJyb3dPZmZzZXQgPSB7IHRvcDogdGFyZ2V0SGVpZ2h0IC0gZWxlbWVudEggLyAyIC0gZml4ZWRIIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyaWdodC1ib3R0b20nOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHBvcy50b3AgLSBmaXhlZEgsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhcnJvd09mZnNldCA9IHsgdG9wOiBlbGVtZW50SCAvIDIgKyBmaXhlZEggfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQtdG9wJzpcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBwb3MudG9wIC0gdGFyZ2V0SGVpZ2h0ICsgcG9zLmhlaWdodCArIGZpeGVkSCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgLSB0YXJnZXRXaWR0aFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYXJyb3dPZmZzZXQgPSB7IHRvcDogdGFyZ2V0SGVpZ2h0IC0gZWxlbWVudEggLyAyIC0gZml4ZWRIIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsZWZ0LWJvdHRvbSc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogcG9zLmxlZnQgLSB0YXJnZXRXaWR0aFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYXJyb3dPZmZzZXQgPSB7IHRvcDogZWxlbWVudEggLyAyIH07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXG4gICAgICAgICAgICBhcnJvd09mZnNldDogYXJyb3dPZmZzZXRcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pO1xuXG4kLmltcGxlbWVudCh7XG4gICAgZ2V0UG9wb3ZlcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB2YXIgcG9wb3ZlciA9IHN0b3JhZ2UuZ2V0KHRoaXMpO1xuXG4gICAgICAgIGlmICghcG9wb3ZlciAmJiBvcHRpb25zICE9PSAnZGVzdHJveScpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgcG9wb3ZlciA9IG5ldyBQb3BvdmVyKHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgc3RvcmFnZS5zZXQodGhpcywgcG9wb3Zlcik7XG4gICAgICAgICAgICB0aGlzLlBvcG92ZXJEZWZpbmVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwb3BvdmVyO1xuICAgIH0sXG5cbiAgICBwb3BvdmVyOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHBvcG92ZXIgPSBzdG9yYWdlLmdldChlbGVtZW50KTtcblxuICAgICAgICAgICAgaWYgKCFwb3BvdmVyICYmIG9wdGlvbnMgIT09ICdkZXN0cm95Jykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgIHBvcG92ZXIgPSBuZXcgUG9wb3ZlcihlbGVtZW50LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBzdG9yYWdlLnNldChlbGVtZW50LCBwb3BvdmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHBvc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG5vZGUgICAgPSB0aGlzWzBdLCBib3ggPSB7XG4gICAgICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgICAgICByaWdodDogMCxcbiAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgYm90dG9tOiAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd2luICAgICA9IHdpbmRvdywgZG9jID0gbm9kZS5vd25lckRvY3VtZW50LFxuICAgICAgICAgICAgZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQsXG4gICAgICAgICAgICBib2R5ICAgID0gZG9jLmJvZHk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgYm94ID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjbGllbnRUb3AgID0gZG9jRWxlbS5jbGllbnRUb3AgfHwgYm9keS5jbGllbnRUb3AgfHwgMCxcbiAgICAgICAgICAgIGNsaWVudExlZnQgPSBkb2NFbGVtLmNsaWVudExlZnQgfHwgYm9keS5jbGllbnRMZWZ0IHx8IDAsXG4gICAgICAgICAgICBzY3JvbGxUb3AgID0gd2luLnBhZ2VZT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsVG9wLFxuICAgICAgICAgICAgc2Nyb2xsTGVmdCA9IHdpbi5wYWdlWE9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbExlZnQsXG4gICAgICAgICAgICBkeCAgICAgICAgID0gc2Nyb2xsTGVmdCAtIGNsaWVudExlZnQsXG4gICAgICAgICAgICBkeSAgICAgICAgID0gc2Nyb2xsVG9wIC0gY2xpZW50VG9wO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB4OiBib3gubGVmdCArIGR4LFxuICAgICAgICAgICAgbGVmdDogYm94LmxlZnQgKyBkeCxcbiAgICAgICAgICAgIHk6IGJveC50b3AgKyBkeSxcbiAgICAgICAgICAgIHRvcDogYm94LnRvcCArIGR5LFxuICAgICAgICAgICAgcmlnaHQ6IGJveC5yaWdodCArIGR4LFxuICAgICAgICAgICAgYm90dG9tOiBib3guYm90dG9tICsgZHksXG4gICAgICAgICAgICB3aWR0aDogYm94LnJpZ2h0IC0gYm94LmxlZnQsXG4gICAgICAgICAgICBoZWlnaHQ6IGJveC5ib3R0b20gLSBib3gudG9wXG4gICAgICAgIH07XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gJDsiLCJcInVzZSBzdHJpY3RcIjtcblxudmFyICQgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICBwcmltZSAgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgRW1pdHRlciAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgQm91bmQgICAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL2JvdW5kJyksXG4gICAgT3B0aW9ucyAgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcbiAgICB6ZW4gICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL3plbicpLFxuICAgIG1vb2Z4ICAgID0gcmVxdWlyZSgnbW9vZngnKSxcblxuICAgIGJpbmQgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgaXNBcnJheSAgPSByZXF1aXJlKCdtb3V0L2xhbmcvaXNBcnJheScpLFxuICAgIGlzTnVtYmVyID0gcmVxdWlyZSgnbW91dC9sYW5nL2lzTnVtYmVyJyk7XG5cbnZhciBQcm9ncmVzc2VyID0gbmV3IHByaW1lKHtcblxuICAgIG1peGluOiBbQm91bmQsIE9wdGlvbnNdLFxuXG4gICAgaW5oZXJpdHM6IEVtaXR0ZXIsXG5cbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHZhbHVlOiAwLjAsXG4gICAgICAgIHNpemU6IDUwLjAsXG4gICAgICAgIHN0YXJ0QW5nbGU6IC1NYXRoLlBJIC8gMixcbiAgICAgICAgdGhpY2tuZXNzOiAnYXV0bycsXG4gICAgICAgIGZpbGw6IHsgLy8geyBjb2xvcjogJ2hleHxyZ2JhJyB9IHx8IHsgZ3JhZGllbnQ6IFtmcm9tLCB0b10sIGdyYWRpZW50QW5nbGU6IE1hdGguUEkgLyA0LCBncmFkaWVudERpcmVjdGlvbjogW3gwLCB5MCwgeDEsIHkxXSB9XG4gICAgICAgICAgICBncmFkaWVudDogWycjOWUzOGViJywgJyM0ZTY4ZmMnXS8vWycjM2FlYWJiJywgJyNmZGQyNTAnXVxuICAgICAgICB9LFxuICAgICAgICBlbXB0eUZpbGw6ICdyZ2JhKDAsIDAsIDAsIC4xKScsXG4gICAgICAgIGFuaW1hdGlvbjoge1xuICAgICAgICAgICAgZHVyYXRpb246IDEyMDAsXG4gICAgICAgICAgICBlcXVhdGlvbjogJ2N1YmljLWJlemllcigwLjY0NSwgMC4wNDUsIDAuMzU1LCAxKSdcbiAgICAgICAgfSxcbiAgICAgICAgYW5pbWF0aW9uU3RhcnRWYWx1ZTogMC4wLFxuICAgICAgICByZXZlcnNlOiBmYWxzZSxcbiAgICAgICAgbGluZUNhcDogJ2J1dHQnLCAvLyBidXR0LCByb3VuZCwgc3F1YXJlXG4gICAgICAgIGluc2VydEVsZW1lbnQ6IG51bGwsXG4gICAgICAgIGluc2VydExvY2F0aW9uOiAnYmVmb3JlJ1xuICAgIH0sXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50ID0gdGhpcy5lbGVtZW50IHx8ICQoZWxlbWVudCk7XG4gICAgICAgIHRoaXMuY2FudmFzID0gdGhpcy5jYW52YXMgfHwgemVuKCdjYW52YXMnKVt0aGlzLm9wdGlvbnMuaW5zZXJ0TG9jYXRpb24gfHwgJ2JlZm9yZSddKHRoaXMub3B0aW9ucy5pbnNlcnRFbGVtZW50IHx8IHRoaXMuZWxlbWVudClbMF07XG4gICAgICAgIHRoaXMucmFkaXVzID0gdGhpcy5vcHRpb25zLnNpemUgLyAyO1xuICAgICAgICB0aGlzLmFyY0ZpbGwgPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3RGcmFtZVZhbHVlID0gMC4wO1xuXG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy5vcHRpb25zLnNpemU7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMub3B0aW9ucy5zaXplO1xuICAgICAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgdGhpcy5pbml0RmlsbCgpO1xuICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICB9LFxuXG4gICAgaW5pdEZpbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZmlsbCA9IHRoaXMub3B0aW9ucy5maWxsLFxuICAgICAgICAgICAgc2l6ZSA9IHRoaXMub3B0aW9ucy5zaXplLFxuICAgICAgICAgICAgY3R4ICA9IHRoaXMuY3R4O1xuXG4gICAgICAgIGlmICghZmlsbCkgeyB0aHJvdyBFcnJvcignVGhlIGZpbGwgaXMgbm90IHNwZWNpZmllZC4nKTsgfVxuXG4gICAgICAgIGlmIChmaWxsLmNvbG9yKSB7XG4gICAgICAgICAgICB0aGlzLmFyY0ZpbGwgPSBmaWxsLmNvbG9yO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGZpbGwuZ3JhZGllbnQpIHtcbiAgICAgICAgICAgIHZhciBnciA9IGZpbGwuZ3JhZGllbnQ7XG5cbiAgICAgICAgICAgIGlmIChnci5sZW5ndGggPT0gMSkgeyB0aGlzLmFyY0ZpbGwgPSBnclswXTsgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGdhID0gZmlsbC5ncmFkaWVudEFuZ2xlIHx8IDAsICAvLyBncmFkaWVudCBkaXJlY3Rpb24gYW5nbGU7IDAgYnkgZGVmYXVsdFxuICAgICAgICAgICAgICAgICAgICBnZCA9IGZpbGwuZ3JhZGllbnREaXJlY3Rpb24gfHwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgLyAyICogKDEgLSBNYXRoLmNvcyhnYSkpLCAvLyB4MFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgLyAyICogKDEgKyBNYXRoLnNpbihnYSkpLCAvLyB5MFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgLyAyICogKDEgKyBNYXRoLmNvcyhnYSkpLCAvLyB4MVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgLyAyICogKDEgLSBNYXRoLnNpbihnYSkpICAvLyB5MVxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgbGcgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQuYXBwbHkoY3R4LCBnZCk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IGdyW2ldLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zICAgPSBpIC8gKGdyLmxlbmd0aCAtIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0FycmF5KGNvbG9yKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gY29sb3JbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IGNvbG9yWzBdO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbGcuYWRkQ29sb3JTdG9wKHBvcywgY29sb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuYXJjRmlsbCA9IGxnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGRyYXc6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzW3RoaXMub3B0aW9ucy5hbmltYXRpb24gPyAnZHJhd0FuaW1hdGVkJyA6ICdkcmF3RnJhbWUnXSh0aGlzLm9wdGlvbnMudmFsdWUpO1xuICAgIH0sXG5cbiAgICBkcmF3RnJhbWU6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdGhpcy5sYXN0RnJhbWVWYWx1ZSA9IHY7XG4gICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLm9wdGlvbnMuc2l6ZSwgdGhpcy5vcHRpb25zLnNpemUpO1xuICAgICAgICB0aGlzLmRyYXdFbXB0eUFyYyh2KTtcbiAgICAgICAgdGhpcy5kcmF3QXJjKHYpO1xuICAgIH0sXG5cbiAgICBkcmF3QXJjOiBmdW5jdGlvbih2KSB7XG4gICAgICAgIHZhciBjdHggPSB0aGlzLmN0eCxcbiAgICAgICAgICAgIHIgICA9IHRoaXMucmFkaXVzLFxuICAgICAgICAgICAgdCAgID0gdGhpcy5nZXRUaGlja25lc3MoKSxcbiAgICAgICAgICAgIGEgICA9IHRoaXMub3B0aW9ucy5zdGFydEFuZ2xlO1xuXG4gICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcblxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5yZXZlcnNlKSB7XG4gICAgICAgICAgICBjdHguYXJjKHIsIHIsIHIgLSB0IC8gMiwgYSwgYSArIE1hdGguUEkgKiAyICogdik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjdHguYXJjKHIsIHIsIHIgLSB0IC8gMiwgYSAtIE1hdGguUEkgKiAyICogdiwgYSk7XG4gICAgICAgIH1cblxuICAgICAgICBjdHgubGluZVdpZHRoID0gdDtcbiAgICAgICAgY3R4LmxpbmVDYXAgPSB0aGlzLm9wdGlvbnMubGluZUNhcDtcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5hcmNGaWxsO1xuICAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfSxcblxuICAgIGRyYXdFbXB0eUFyYzogZnVuY3Rpb24odikge1xuICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHgsXG4gICAgICAgICAgICByICAgPSB0aGlzLnJhZGl1cyxcbiAgICAgICAgICAgIHQgICA9IHRoaXMuZ2V0VGhpY2tuZXNzKCksXG4gICAgICAgICAgICBhICAgPSB0aGlzLm9wdGlvbnMuc3RhcnRBbmdsZTtcblxuICAgICAgICBpZiAodiA8IDEpIHtcbiAgICAgICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG5cbiAgICAgICAgICAgIGlmICh2IDw9IDApIHtcbiAgICAgICAgICAgICAgICBjdHguYXJjKHIsIHIsIHIgLSB0IC8gMiwgMCwgTWF0aC5QSSAqIDIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmV2ZXJzZSkge1xuICAgICAgICAgICAgICAgICAgICBjdHguYXJjKHIsIHIsIHIgLSB0IC8gMiwgYSArIE1hdGguUEkgKiAyICogdiwgYSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhyLCByLCByIC0gdCAvIDIsIGEsIGEgLSBNYXRoLlBJICogMiAqIHYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IHQ7XG4gICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLm9wdGlvbnMuZW1wdHlGaWxsO1xuICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBkcmF3QW5pbWF0ZWQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LmVtaXQoJ3Byb2dyZXNzLWFuaW1hdGlvbi1zdGFydCcpO1xuXG4gICAgICAgIG1vb2Z4KGJpbmQoZnVuY3Rpb24obm93KSB7XG4gICAgICAgICAgICB2YXIgc3RlcFZhbHVlID0gdGhpcy5vcHRpb25zLmFuaW1hdGlvblN0YXJ0VmFsdWUgKiAoMSAtIG5vdykgKyB2ICogbm93O1xuICAgICAgICAgICAgdGhpcy5kcmF3RnJhbWUoc3RlcFZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5lbWl0KCdwcm9ncmVzcy1hbmltYXRpb24tY2hhbmdlJywgbm93LCBzdGVwVmFsdWUpO1xuICAgICAgICB9LCB0aGlzKSwge1xuICAgICAgICAgICAgZHVyYXRpb246IHRoaXMub3B0aW9ucy5hbmltYXRpb24uZHVyYXRpb24gfHwgJzEyMDAnLFxuICAgICAgICAgICAgZXF1YXRpb246IHRoaXMub3B0aW9ucy5hbmltYXRpb24uZXF1YXRpb24gfHwgJ2xpbmVhcicsXG4gICAgICAgICAgICBjYWxsYmFjazogYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmFuaW1hdGlvbi5jYWxsYmFjaykgeyB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLmNhbGxiYWNrKCk7IH1cbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuZW1pdCgncHJvZ3Jlc3MtYW5pbWF0aW9uLWVuZCcpO1xuICAgICAgICAgICAgfSwgdGhpcylcbiAgICAgICAgfSkuc3RhcnQoMCwgMSk7XG4gICAgfSxcblxuICAgIGdldFRoaWNrbmVzczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBpc051bWJlcih0aGlzLm9wdGlvbnMudGhpY2tuZXNzKSA/IHRoaXMub3B0aW9ucy50aGlja25lc3MgOiB0aGlzLm9wdGlvbnMuc2l6ZSAvIDE0O1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByb2dyZXNzZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHByaW1lICAgICAgPSByZXF1aXJlKCdwcmltZScpLFxuICAgIHJlYWR5ICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpLFxuICAgIHplbiAgICAgICAgPSByZXF1aXJlKCdlbGVtZW50cy96ZW4nKSxcblxuICAgIHNpZnRlciAgICAgPSByZXF1aXJlKCdzaWZ0ZXInKSxcblxuICAgIEVtaXR0ZXIgICAgPSByZXF1aXJlKCdwcmltZS9lbWl0dGVyJyksXG4gICAgQm91bmQgICAgICA9IHJlcXVpcmUoJ3ByaW1lLXV0aWwvcHJpbWUvYm91bmQnKSxcbiAgICBPcHRpb25zICAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9vcHRpb25zJyksXG5cbiAgICAkICAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICBtb29meCAgICAgID0gcmVxdWlyZSgnbW9vZngnKSxcblxuICAgIGJpbmQgICAgICAgPSByZXF1aXJlKCdtb3V0L2Z1bmN0aW9uL2JpbmQnKSxcbiAgICBmb3JFYWNoICAgID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL2ZvckVhY2gnKSxcbiAgICBpbmRleE9mICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9pbmRleE9mJyksXG4gICAgbGFzdCAgICAgICA9IHJlcXVpcmUoJ21vdXQvYXJyYXkvbGFzdCcpLFxuICAgIGRlYm91bmNlICAgPSByZXF1aXJlKCdtb3V0L2Z1bmN0aW9uL2RlYm91bmNlJyksXG4gICAgaXNBcnJheSAgICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pc0FycmF5JyksXG4gICAgaXNCb29sZWFuICA9IHJlcXVpcmUoJ21vdXQvbGFuZy9pc0Jvb2xlYW4nKSxcbiAgICBtZXJnZSAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvbWVyZ2UnKSxcbiAgICB1bnNldCAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvdW5zZXQnKSxcbiAgICBzaXplICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3Qvc2l6ZScpLFxuICAgIHZhbHVlcyAgICAgPSByZXF1aXJlKCdtb3V0L29iamVjdC92YWx1ZXMnKSxcbiAgICBlc2NhcGVIVE1MID0gcmVxdWlyZSgnbW91dC9zdHJpbmcvZXNjYXBlSHRtbCcpLFxuICAgIHRyaW0gICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy90cmltJyk7XG5cblxudmFyIElTX01BQyAgICAgICAgPSAvTWFjLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLFxuICAgIENPVU5UICAgICAgICAgPSAwLFxuXG4gICAgS0VZX0EgICAgICAgICA9IDY1LFxuICAgIEtFWV9DT01NQSAgICAgPSAxODgsXG4gICAgS0VZX1JFVFVSTiAgICA9IDEzLFxuICAgIEtFWV9FU0MgICAgICAgPSAyNyxcbiAgICBLRVlfTEVGVCAgICAgID0gMzcsXG4gICAgS0VZX1VQICAgICAgICA9IDM4LFxuICAgIEtFWV9QICAgICAgICAgPSA4MCxcbiAgICBLRVlfUklHSFQgICAgID0gMzksXG4gICAgS0VZX0RPV04gICAgICA9IDQwLFxuICAgIEtFWV9OICAgICAgICAgPSA3OCxcbiAgICBLRVlfQkFDS1NQQUNFID0gOCxcbiAgICBLRVlfREVMRVRFICAgID0gNDYsXG4gICAgS0VZX1NISUZUICAgICA9IDE2LFxuICAgIEtFWV9DTUQgICAgICAgPSBJU19NQUMgPyA5MSA6IDE3LFxuICAgIEtFWV9DVFJMICAgICAgPSBJU19NQUMgPyAxOCA6IDE3LFxuICAgIEtFWV9UQUIgICAgICAgPSA5LFxuXG4gICAgVEFHX1NFTEVDVCAgICA9IDEsXG4gICAgVEFHX0lOUFVUICAgICA9IDI7XG5cbnZhciBoYXNoX2tleSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgdmFsdWUgPT09IG51bGwpIHJldHVybiBudWxsO1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykgcmV0dXJuIHZhbHVlID8gJzEnIDogJzAnO1xuICAgIHJldHVybiB2YWx1ZSArICcnO1xufTtcblxudmFyIGlzc2V0ID0gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgcmV0dXJuIHR5cGVvZiBvYmplY3QgIT09ICd1bmRlZmluZWQnO1xufTtcblxudmFyIGVzY2FwZV9yZXBsYWNlID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgcmV0dXJuIChzdHIgKyAnJykucmVwbGFjZSgvXFwkL2csICckJCQkJyk7XG59O1xuXG52YXIgb25jZSA9IGZ1bmN0aW9uKGZuKSB7XG4gICAgdmFyIGNhbGxlZCA9IGZhbHNlO1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGNhbGxlZCkgcmV0dXJuO1xuICAgICAgICBjYWxsZWQgPSB0cnVlO1xuICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH07XG59O1xuXG52YXIgZGVib3VuY2VfZXZlbnRzID0gZnVuY3Rpb24oc2VsZiwgdHlwZXMsIGZuKSB7XG4gICAgdmFyIHR5cGU7XG4gICAgdmFyIHRyaWdnZXIgPSBzZWxmLmVtaXQ7XG4gICAgdmFyIGV2ZW50X2FyZ3MgPSB7fTtcblxuICAgIC8vIG92ZXJyaWRlIHRyaWdnZXIgbWV0aG9kXG4gICAgc2VsZi5lbWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0eXBlID0gYXJndW1lbnRzWzBdO1xuICAgICAgICBpZiAodHlwZXMuaW5kZXhPZih0eXBlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGV2ZW50X2FyZ3NbdHlwZV0gPSBhcmd1bWVudHM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJpZ2dlci5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIGludm9rZSBwcm92aWRlZCBmdW5jdGlvblxuICAgIGZuLmFwcGx5KHNlbGYsIFtdKTtcbiAgICBzZWxmLmVtaXQgPSB0cmlnZ2VyO1xuXG4gICAgLy8gdHJpZ2dlciBxdWV1ZWQgZXZlbnRzXG4gICAgZm9yICh0eXBlIGluIGV2ZW50X2FyZ3MpIHtcbiAgICAgICAgaWYgKGV2ZW50X2FyZ3MuaGFzT3duUHJvcGVydHkodHlwZSkpIHtcbiAgICAgICAgICAgIHRyaWdnZXIuYXBwbHkoc2VsZiwgZXZlbnRfYXJnc1t0eXBlXSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG52YXIgYnVpbGRfaGFzaF90YWJsZSA9IGZ1bmN0aW9uKGtleSwgb2JqZWN0cykge1xuICAgIGlmICghaXNBcnJheShvYmplY3RzKSkgcmV0dXJuIG9iamVjdHM7XG4gICAgdmFyIGksIG4sIHRhYmxlID0ge307XG4gICAgZm9yIChpID0gMCwgbiA9IG9iamVjdHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIGlmIChvYmplY3RzW2ldLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgIHRhYmxlW29iamVjdHNbaV1ba2V5XV0gPSBvYmplY3RzW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YWJsZTtcbn07XG5cbnZhciBnZXRTZWxlY3Rpb24gPSBmdW5jdGlvbihpbnB1dCkge1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAoJ3NlbGVjdGlvblN0YXJ0JyBpbiBpbnB1dCkge1xuICAgICAgICByZXN1bHQuc3RhcnQgPSBpbnB1dC5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgcmVzdWx0Lmxlbmd0aCA9IGlucHV0LnNlbGVjdGlvbkVuZCAtIHJlc3VsdC5zdGFydDtcbiAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikge1xuICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICB2YXIgc2VsID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgIHZhciBzZWxMZW4gPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgc2VsLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgLWlucHV0LnZhbHVlLmxlbmd0aCk7XG4gICAgICAgIHJlc3VsdC5zdGFydCA9IHNlbC50ZXh0Lmxlbmd0aCAtIHNlbExlbjtcbiAgICAgICAgcmVzdWx0Lmxlbmd0aCA9IHNlbExlbjtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbnZhciB0cmFuc2ZlclN0eWxlcyA9IGZ1bmN0aW9uKCRmcm9tLCAkdG8sIHByb3BlcnRpZXMpIHtcbiAgICB2YXIgaSwgbiwgc3R5bGVzID0ge307XG4gICAgaWYgKHByb3BlcnRpZXMpIHtcbiAgICAgICAgZm9yIChpID0gMCwgbiA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICBzdHlsZXNbcHJvcGVydGllc1tpXV0gPSAkZnJvbS5jb21wdXRlKHByb3BlcnRpZXNbaV0pO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc3R5bGVzID0gJGZyb20uY29tcHV0ZSgpO1xuICAgIH1cbiAgICAkdG8uc3R5bGUoc3R5bGVzKTtcbn07XG5cbnZhciBtZWFzdXJlU3RyaW5nID0gZnVuY3Rpb24oc3RyLCAkcGFyZW50KSB7XG4gICAgaWYgKCFzdHIpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgdmFyICR0ZXN0ID0gemVuKCd0ZXN0Jykuc3R5bGUoe1xuICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgdG9wOiAtOTk5OTksXG4gICAgICAgIGxlZnQ6IC05OTk5OSxcbiAgICAgICAgd2lkdGg6ICdhdXRvJyxcbiAgICAgICAgcGFkZGluZzogMCxcbiAgICAgICAgd2hpdGVTcGFjZTogJ3ByZSdcbiAgICB9KS50ZXh0KHN0cikuYm90dG9tKCdib2R5Jyk7XG5cbiAgICB0cmFuc2ZlclN0eWxlcygkcGFyZW50LCAkdGVzdCwgW1xuICAgICAgICAnbGV0dGVyU3BhY2luZycsXG4gICAgICAgICdmb250U2l6ZScsXG4gICAgICAgICdmb250RmFtaWx5JyxcbiAgICAgICAgJ2ZvbnRXZWlnaHQnLFxuICAgICAgICAndGV4dFRyYW5zZm9ybSdcbiAgICBdKTtcblxuICAgIHZhciB3aWR0aCA9ICR0ZXN0WzBdLm9mZnNldFdpZHRoO1xuICAgICR0ZXN0LnJlbW92ZSgpO1xuXG4gICAgcmV0dXJuIHdpZHRoO1xufTtcblxudmFyIGhpZ2hsaWdodCA9IGZ1bmN0aW9uKCRlbGVtZW50LCBwYXR0ZXJuKSB7XG4gICAgaWYgKHR5cGVvZiBwYXR0ZXJuID09PSAnc3RyaW5nJyAmJiAhcGF0dGVybi5sZW5ndGgpIHJldHVybjtcbiAgICB2YXIgcmVnZXggPSAodHlwZW9mIHBhdHRlcm4gPT09ICdzdHJpbmcnKSA/IG5ldyBSZWdFeHAocGF0dGVybiwgJ2knKSA6IHBhdHRlcm47XG5cbiAgICB2YXIgaGlnaGxpZ2h0ID0gZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB2YXIgc2tpcCA9IDA7XG4gICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7XG4gICAgICAgICAgICB2YXIgcG9zID0gbm9kZS5kYXRhLnNlYXJjaChyZWdleCk7XG4gICAgICAgICAgICBpZiAocG9zID49IDAgJiYgbm9kZS5kYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBub2RlLmRhdGEubWF0Y2gocmVnZXgpO1xuICAgICAgICAgICAgICAgIHZhciBzcGFubm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgICAgICAgICBzcGFubm9kZS5jbGFzc05hbWUgPSAnaGlnaGxpZ2h0JztcbiAgICAgICAgICAgICAgICB2YXIgbWlkZGxlYml0ID0gbm9kZS5zcGxpdFRleHQocG9zKTtcbiAgICAgICAgICAgICAgICB2YXIgZW5kYml0ID0gbWlkZGxlYml0LnNwbGl0VGV4dChtYXRjaFswXS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHZhciBtaWRkbGVjbG9uZSA9IG1pZGRsZWJpdC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgc3Bhbm5vZGUuYXBwZW5kQ2hpbGQobWlkZGxlY2xvbmUpO1xuICAgICAgICAgICAgICAgIG1pZGRsZWJpdC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChzcGFubm9kZSwgbWlkZGxlYml0KTtcbiAgICAgICAgICAgICAgICBza2lwID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09PSAxICYmIG5vZGUuY2hpbGROb2RlcyAmJiAhLyhzY3JpcHR8c3R5bGUpL2kudGVzdChub2RlLnRhZ05hbWUpKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIGkgKz0gaGlnaGxpZ2h0KG5vZGUuY2hpbGROb2Rlc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNraXA7XG4gICAgfTtcblxuICAgIHJldHVybiBmb3JFYWNoKCRlbGVtZW50LCBmdW5jdGlvbihlbCkge1xuICAgICAgICBoaWdobGlnaHQoZWwpO1xuICAgIH0pO1xufTtcblxudmFyIGF1dG9Hcm93ID0gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICBpbnB1dCA9ICQoaW5wdXQpO1xuICAgIHZhciBjdXJyZW50V2lkdGggPSBudWxsO1xuXG4gICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKG9wdGlvbnMsIGUpIHtcbiAgICAgICAgdmFyIHZhbHVlLCBrZXlDb2RlLCBwcmludGFibGUsIHBsYWNlaG9sZGVyLCB3aWR0aDtcbiAgICAgICAgdmFyIHNoaWZ0LCBjaGFyYWN0ZXIsIHNlbGVjdGlvbjtcbiAgICAgICAgZSA9IGUgfHwgd2luZG93LmV2ZW50IHx8IHt9O1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgICBpZiAoZS5tZXRhS2V5IHx8IGUuYWx0S2V5KSByZXR1cm47XG4gICAgICAgIGlmICghb3B0aW9ucy5mb3JjZSAmJiBpbnB1dC5zZWxlY3RpemVHcm93ID09PSBmYWxzZSkgcmV0dXJuO1xuXG4gICAgICAgIHZhbHVlID0gaW5wdXQudmFsdWUoKTtcbiAgICAgICAgaWYgKGUudHlwZSAmJiBlLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ2tleWRvd24nKSB7XG4gICAgICAgICAgICBrZXlDb2RlID0gZS5rZXlDb2RlO1xuICAgICAgICAgICAgcHJpbnRhYmxlID0gKFxuICAgICAgICAgICAgKGtleUNvZGUgPj0gOTcgJiYga2V5Q29kZSA8PSAxMjIpIHx8IC8vIGEtelxuICAgICAgICAgICAgKGtleUNvZGUgPj0gNjUgJiYga2V5Q29kZSA8PSA5MCkgfHwgLy8gQS1aXG4gICAgICAgICAgICAoa2V5Q29kZSA+PSA0OCAmJiBrZXlDb2RlIDw9IDU3KSB8fCAvLyAwLTlcbiAgICAgICAgICAgIGtleUNvZGUgPT09IDMyIC8vIHNwYWNlXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gS0VZX0RFTEVURSB8fCBrZXlDb2RlID09PSBLRVlfQkFDS1NQQUNFKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uID0gZ2V0U2VsZWN0aW9uKGlucHV0WzBdKTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0aW9uLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnN1YnN0cmluZygwLCBzZWxlY3Rpb24uc3RhcnQpICsgdmFsdWUuc3Vic3RyaW5nKHNlbGVjdGlvbi5zdGFydCArIHNlbGVjdGlvbi5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5Q29kZSA9PT0gS0VZX0JBQ0tTUEFDRSAmJiBzZWxlY3Rpb24uc3RhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgc2VsZWN0aW9uLnN0YXJ0IC0gMSkgKyB2YWx1ZS5zdWJzdHJpbmcoc2VsZWN0aW9uLnN0YXJ0ICsgMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID09PSBLRVlfREVMRVRFICYmIHR5cGVvZiBzZWxlY3Rpb24uc3RhcnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuc3Vic3RyaW5nKDAsIHNlbGVjdGlvbi5zdGFydCkgKyB2YWx1ZS5zdWJzdHJpbmcoc2VsZWN0aW9uLnN0YXJ0ICsgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChwcmludGFibGUpIHtcbiAgICAgICAgICAgICAgICBzaGlmdCA9IGUuc2hpZnRLZXk7XG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZShlLmtleUNvZGUpO1xuICAgICAgICAgICAgICAgIGlmIChzaGlmdCkgY2hhcmFjdGVyID0gY2hhcmFjdGVyLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgZWxzZSBjaGFyYWN0ZXIgPSBjaGFyYWN0ZXIudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB2YWx1ZSArPSBjaGFyYWN0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBwbGFjZWhvbGRlciA9IGlucHV0LmF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKTtcbiAgICAgICAgaWYgKCF2YWx1ZSAmJiBwbGFjZWhvbGRlcikge1xuICAgICAgICAgICAgdmFsdWUgPSBwbGFjZWhvbGRlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHdpZHRoID0gbWVhc3VyZVN0cmluZyh2YWx1ZSwgaW5wdXQpICsgNDtcbiAgICAgICAgaWYgKHdpZHRoICE9PSBjdXJyZW50V2lkdGgpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgaW5wdXQuc3R5bGUoeyB3aWR0aDogd2lkdGggfSk7XG4gICAgICAgICAgICBpbnB1dC5lbWl0KCdyZXNpemUnKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBpbnB1dC5vbigna2V5ZG93bicsIHVwZGF0ZSk7XG4gICAgaW5wdXQub24oJ2tleXVwJywgdXBkYXRlKTtcbiAgICBpbnB1dC5vbigndXBkYXRlJywgdXBkYXRlKTtcbiAgICBpbnB1dC5vbignYmx1cicsIHVwZGF0ZSk7XG5cbiAgICB1cGRhdGUoKTtcbn07XG5cbnZhciBTZWxlY3RpemUgPSBuZXcgcHJpbWUoe1xuXG4gICAgbWl4aW46IFtCb3VuZCwgT3B0aW9uc10sXG5cbiAgICBpbmhlcml0czogRW1pdHRlcixcblxuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgcGx1Z2luczogW10sXG4gICAgICAgIGRlbGltaXRlcjogJyAnLFxuICAgICAgICBwZXJzaXN0OiB0cnVlLFxuICAgICAgICBkaWFjcml0aWNzOiB0cnVlLFxuICAgICAgICBjcmVhdGU6IGZhbHNlLFxuICAgICAgICBjcmVhdGVPbkJsdXI6IGZhbHNlLFxuICAgICAgICBjcmVhdGVGaWx0ZXI6IG51bGwsXG4gICAgICAgIGhpZ2hsaWdodDogdHJ1ZSxcbiAgICAgICAgb3Blbk9uRm9jdXM6IHRydWUsXG4gICAgICAgIG1heE9wdGlvbnM6IDEwMDAsXG4gICAgICAgIG1heEl0ZW1zOiBudWxsLFxuICAgICAgICBoaWRlU2VsZWN0ZWQ6IG51bGwsXG4gICAgICAgIGFkZFByZWNlZGVuY2U6IGZhbHNlLFxuICAgICAgICBzZWxlY3RPblRhYjogZmFsc2UsXG4gICAgICAgIHByZWxvYWQ6IGZhbHNlLFxuICAgICAgICBhbGxvd0VtcHR5T3B0aW9uOiBmYWxzZSxcblxuICAgICAgICBzY3JvbGxEdXJhdGlvbjogNjAsXG4gICAgICAgIGxvYWRUaHJvdHRsZTogMzAwLFxuXG4gICAgICAgIGRhdGFBdHRyOiAnZGF0YS1kYXRhJyxcbiAgICAgICAgb3B0Z3JvdXBGaWVsZDogJ29wdGdyb3VwJyxcbiAgICAgICAgdmFsdWVGaWVsZDogJ3ZhbHVlJyxcbiAgICAgICAgbGFiZWxGaWVsZDogJ3RleHQnLFxuICAgICAgICBvcHRncm91cExhYmVsRmllbGQ6ICdsYWJlbCcsXG4gICAgICAgIG9wdGdyb3VwVmFsdWVGaWVsZDogJ3ZhbHVlJyxcbiAgICAgICAgb3B0Z3JvdXBPcmRlcjogbnVsbCxcblxuICAgICAgICBzb3J0RmllbGQ6ICckb3JkZXInLFxuICAgICAgICBzZWFyY2hGaWVsZDogWyd0ZXh0J10sXG4gICAgICAgIHNlYXJjaENvbmp1bmN0aW9uOiAnYW5kJyxcblxuICAgICAgICBtb2RlOiBudWxsLFxuICAgICAgICB3cmFwcGVyQ2xhc3M6ICdzZWxlY3RpemUtY29udHJvbCcsXG4gICAgICAgIGlucHV0Q2xhc3M6ICdzZWxlY3RpemUtaW5wdXQnLFxuICAgICAgICBkcm9wZG93bkNsYXNzOiAnc2VsZWN0aXplLWRyb3Bkb3duJyxcbiAgICAgICAgZHJvcGRvd25Db250ZW50Q2xhc3M6ICdzZWxlY3RpemUtZHJvcGRvd24tY29udGVudCcsXG5cbiAgICAgICAgZHJvcGRvd25QYXJlbnQ6IG51bGwsXG5cbiAgICAgICAgY29weUNsYXNzZXNUb0Ryb3Bkb3duOiB0cnVlLFxuXG4gICAgICAgIC8qXG4gICAgICAgICBsb2FkICAgICAgICAgICAgOiBudWxsLCAvLyBmdW5jdGlvbihxdWVyeSwgY2FsbGJhY2spIHsgLi4uIH1cbiAgICAgICAgIHNjb3JlICAgICAgICAgICA6IG51bGwsIC8vIGZ1bmN0aW9uKHNlYXJjaCkgeyAuLi4gfVxuICAgICAgICAgb25Jbml0aWFsaXplICAgIDogbnVsbCwgLy8gZnVuY3Rpb24oKSB7IC4uLiB9XG4gICAgICAgICBvbkNoYW5nZSAgICAgICAgOiBudWxsLCAvLyBmdW5jdGlvbih2YWx1ZSkgeyAuLi4gfVxuICAgICAgICAgb25JdGVtQWRkICAgICAgIDogbnVsbCwgLy8gZnVuY3Rpb24odmFsdWUsICRpdGVtKSB7IC4uLiB9XG4gICAgICAgICBvbkl0ZW1SZW1vdmUgICAgOiBudWxsLCAvLyBmdW5jdGlvbih2YWx1ZSkgeyAuLi4gfVxuICAgICAgICAgb25DbGVhciAgICAgICAgIDogbnVsbCwgLy8gZnVuY3Rpb24oKSB7IC4uLiB9XG4gICAgICAgICBvbk9wdGlvbkFkZCAgICAgOiBudWxsLCAvLyBmdW5jdGlvbih2YWx1ZSwgZGF0YSkgeyAuLi4gfVxuICAgICAgICAgb25PcHRpb25SZW1vdmUgIDogbnVsbCwgLy8gZnVuY3Rpb24odmFsdWUpIHsgLi4uIH1cbiAgICAgICAgIG9uT3B0aW9uQ2xlYXIgICA6IG51bGwsIC8vIGZ1bmN0aW9uKCkgeyAuLi4gfVxuICAgICAgICAgb25Ecm9wZG93bk9wZW4gIDogbnVsbCwgLy8gZnVuY3Rpb24oJGRyb3Bkb3duKSB7IC4uLiB9XG4gICAgICAgICBvbkRyb3Bkb3duQ2xvc2UgOiBudWxsLCAvLyBmdW5jdGlvbigkZHJvcGRvd24pIHsgLi4uIH1cbiAgICAgICAgIG9uVHlwZSAgICAgICAgICA6IG51bGwsIC8vIGZ1bmN0aW9uKHN0cikgeyAuLi4gfVxuICAgICAgICAgb25EZWxldGUgICAgICAgIDogbnVsbCwgLy8gZnVuY3Rpb24odmFsdWVzKSB7IC4uLiB9XG4gICAgICAgICAqL1xuXG4gICAgICAgIHJlbmRlcjoge1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICBpdGVtOiBudWxsLFxuICAgICAgICAgICAgIG9wdGdyb3VwOiBudWxsLFxuICAgICAgICAgICAgIG9wdGdyb3VwX2hlYWRlcjogbnVsbCxcbiAgICAgICAgICAgICBvcHRpb246IG51bGwsXG4gICAgICAgICAgICAgb3B0aW9uX2NyZWF0ZTogbnVsbFxuICAgICAgICAgICAgICovXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKGlucHV0LCBvcHRpb25zKSB7XG4gICAgICAgIGlucHV0ID0gJChpbnB1dCk7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gICAgICAgIHRoaXMuaW5wdXQuc2VsZWN0aXplSW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMudGFnVHlwZSA9IGlucHV0LnRhZygpID09ICdzZWxlY3QnID8gVEFHX1NFTEVDVCA6IFRBR19JTlBVVDtcbiAgICAgICAgdGhpcy5oaWdobGlnaHRlZFZhbHVlID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc1JlcXVpcmVkID0gaW5wdXQuYXR0cmlidXRlKCdyZXF1aXJlZCcpO1xuICAgICAgICBmb3JFYWNoKFsnaXNPcGVuJywgJ2lzRGlzYWJsZWQnLCAnaXNJbnZhbGlkJywgJ2lzTG9ja2VkJywgJ2lzRm9jdXNlZCcsICdpc0lucHV0SGlkZGVuJywgJ2lzU2V1cCcsICdpc1NoaWZ0RG93bicsICdpc0NtZERvd24nLCAnaXNDdHJsRG93bicsICdpZ25vcmVGb2N1cycsICdpZ25vcmVCbHVyJywgJ2lnbm9yZUhvdmVyJywgJ2hhc09wdGlvbnMnXSwgZnVuY3Rpb24ob3B0aW9uKSB7XG4gICAgICAgICAgICB0aGlzW29wdGlvbl0gPSBmYWxzZTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIHRoaXMuY3VycmVudFJlc3VsdHMgPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3RWYWx1ZSA9ICcnO1xuICAgICAgICB0aGlzLmNhcmV0UG9zID0gMDtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gMDtcbiAgICAgICAgdGhpcy5sb2FkZWRTZWFyY2hlcyA9IHt9O1xuXG4gICAgICAgIHRoaXMuJGFjdGl2ZU9wdGlvbiA9IG51bGw7XG4gICAgICAgIHRoaXMuJGFjdGl2ZUl0ZW1zID0gW107XG5cbiAgICAgICAgdGhpcy5PcHRncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy5PcHRpb25zID0ge307XG4gICAgICAgIHRoaXMuVXNlck9wdGlvbnMgPSB7fTtcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLnJlbmRlckNhY2hlID0ge307XG4gICAgICAgIHRoaXMub25TZWFyY2hDaGFuZ2UgPSB0aGlzLm9wdGlvbnMubG9hZFRocm90dGxlID09PSBudWxsID8gdGhpcy5vblNlYXJjaENoYW5nZSA6IGRlYm91bmNlKHRoaXMub25TZWFyY2hDaGFuZ2UsIHRoaXMub3B0aW9ucy5sb2FkVGhyb3R0bGUpO1xuXG4gICAgICAgIHRoaXMuT3B0aW9ucyA9IG1lcmdlKHRoaXMuT3B0aW9ucywgYnVpbGRfaGFzaF90YWJsZSh0aGlzLm9wdGlvbnMudmFsdWVGaWVsZCwgdGhpcy5vcHRpb25zLk9wdGlvbnMpKTtcbiAgICAgICAgdGhpcy5PcHRncm91cHMgPSBtZXJnZSh0aGlzLk9wdGdyb3VwcywgYnVpbGRfaGFzaF90YWJsZSh0aGlzLm9wdGlvbnMub3B0Z3JvdXBWYWx1ZUZpZWxkLCB0aGlzLm9wdGlvbnMuT3B0Z3JvdXBzKSk7XG5cbiAgICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy5PcHRpb25zO1xuICAgICAgICBkZWxldGUgdGhpcy5vcHRpb25zLk9wdGdyb3VwcztcblxuICAgICAgICB0aGlzLnNpZnRlciA9IG5ldyBzaWZ0ZXIodGhpcy5PcHRpb25zLCB7IGRpYWNyaXRpY3M6IHRoaXMub3B0aW9ucy5kaWFjcml0aWNzIH0pO1xuXG4gICAgICAgIHRoaXMub3B0aW9ucy5tb2RlID0gdGhpcy5vcHRpb25zLm1vZGUgfHwgKHRoaXMub3B0aW9ucy5tYXhJdGVtcyA9PT0gMSA/ICdzaW5nbGUnIDogJ211bHRpJyk7XG4gICAgICAgIGlmICghaXNCb29sZWFuKHRoaXMub3B0aW9ucy5oaWRlU2VsZWN0ZWQpKSB7IHRoaXMub3B0aW9ucy5oaWRlU2VsZWN0ZWQgPSAodGhpcy5vcHRpb25zLm1vZGUgPT09ICdtdWx0aScpOyB9XG5cbiAgICAgICAgdGhpcy5zZXR1cENhbGxiYWNrcygpO1xuICAgICAgICB0aGlzLnNldHVwVGVtcGxhdGVzKCk7XG4gICAgICAgIHRoaXMuc2V0dXAoKTtcblxuICAgIH0sXG5cbiAgICBzZXR1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkaW5wdXQgPSB0aGlzLmlucHV0LFxuICAgICAgICAgICAgJHdyYXBwZXIsXG4gICAgICAgICAgICAkY29udHJvbCxcbiAgICAgICAgICAgICRjb250cm9sX2lucHV0LFxuICAgICAgICAgICAgJGRyb3Bkb3duLFxuICAgICAgICAgICAgJGRyb3Bkb3duX2NvbnRlbnQsXG4gICAgICAgICAgICAkZHJvcGRvd25fcGFyZW50LFxuICAgICAgICAgICAgaW5wdXRNb2RlLFxuICAgICAgICAgICAgdGFiX2luZGV4LFxuICAgICAgICAgICAgY2xhc3NlcztcblxuICAgICAgICBpbnB1dE1vZGUgPSB0aGlzLm9wdGlvbnMubW9kZTtcbiAgICAgICAgdGFiX2luZGV4ID0gJGlucHV0LmF0dHJpYnV0ZSgndGFiaW5kZXgnKSB8fCAnJztcbiAgICAgICAgY2xhc3NlcyA9ICRpbnB1dC5hdHRyaWJ1dGUoJ2NsYXNzJykgfHwgJyc7XG5cbiAgICAgICAgJHdyYXBwZXIgPSB6ZW4oJ2RpdicpLmFkZENsYXNzKHRoaXMub3B0aW9ucy53cmFwcGVyQ2xhc3MpLmFkZENsYXNzKGNsYXNzZXMpLmFkZENsYXNzKGlucHV0TW9kZSkuYWZ0ZXIodGhpcy5pbnB1dCk7XG4gICAgICAgICRjb250cm9sID0gemVuKCdkaXYnKS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuaW5wdXRDbGFzcykuYWRkQ2xhc3MoJ2l0ZW1zJykuYm90dG9tKCR3cmFwcGVyKTtcbiAgICAgICAgJGNvbnRyb2xfaW5wdXQgPSB6ZW4oJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdW2F1dG9jb21wbGV0ZT1cIm9mZlwiXScpLmJvdHRvbSgkY29udHJvbCkuYXR0cmlidXRlKCd0YWJpbmRleCcsIHRhYl9pbmRleCk7XG4gICAgICAgICRkcm9wZG93bl9wYXJlbnQgPSAkKHRoaXMub3B0aW9ucy5kcm9wZG93blBhcmVudCB8fCAkd3JhcHBlcik7XG4gICAgICAgICRkcm9wZG93biA9IHplbignZGl2JykuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmRyb3Bkb3duQ2xhc3MpLmFkZENsYXNzKGlucHV0TW9kZSkuc3R5bGUoeyBkaXNwbGF5OiAnbm9uZScgfSkuYm90dG9tKCRkcm9wZG93bl9wYXJlbnQpO1xuICAgICAgICAkZHJvcGRvd25fY29udGVudCA9IHplbignZGl2JykuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmRyb3Bkb3duQ29udGVudENsYXNzKS5ib3R0b20oJGRyb3Bkb3duKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNvcHlDbGFzc2VzVG9Ecm9wZG93bikge1xuICAgICAgICAgICAgZm9yRWFjaChjbGFzc2VzLnNwbGl0KCcgJyksIGZ1bmN0aW9uKGNscykge1xuICAgICAgICAgICAgICAgICRkcm9wZG93bi5hZGRDbGFzcyhjbHMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmIChpbnB1dE1vZGUgPT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICAgICR3cmFwcGVyLnN0eWxlKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogcGFyc2VJbnQoJGlucHV0LmNvbXB1dGUoJ3dpZHRoJykpICsgMTIgKyAoMjQpIC8vIHBhZGRpbmcgY29tcGVuc2F0aW9uXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgodGhpcy5vcHRpb25zLm1heEl0ZW1zID09PSBudWxsIHx8IHRoaXMub3B0aW9ucy5tYXhJdGVtcyA+IDEpICYmIHRoaXMudGFnVHlwZSA9PT0gVEFHX1NFTEVDVCkge1xuICAgICAgICAgICAgJGlucHV0LmF0dHJpYnV0ZSgnbXVsdGlwbGUnLCAnbXVsdGlwbGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpIHtcbiAgICAgICAgICAgICRjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCRpbnB1dC5hdHRyaWJ1dGUoJ2F1dG9jb3JyZWN0JykpIHtcbiAgICAgICAgICAgICRjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgnYXV0b2NvcnJlY3QnLCAkaW5wdXQuYXR0cmlidXRlKCdhdXRvY29ycmVjdCcpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkaW5wdXQuYXR0cmlidXRlKCdhdXRvY2FwaXRhbGl6ZScpKSB7XG4gICAgICAgICAgICAkY29udHJvbF9pbnB1dC5hdHRyaWJ1dGUoJ2F1dG9jYXBpdGFsaXplJywgJGlucHV0LmF0dHJpYnV0ZSgnYXV0b2NhcGl0YWxpemUnKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLiR3cmFwcGVyID0gJHdyYXBwZXI7XG4gICAgICAgIHRoaXMuJGNvbnRyb2wgPSAkY29udHJvbDtcbiAgICAgICAgdGhpcy4kY29udHJvbF9pbnB1dCA9ICRjb250cm9sX2lucHV0O1xuICAgICAgICB0aGlzLiRkcm9wZG93biA9ICRkcm9wZG93bjtcbiAgICAgICAgdGhpcy4kZHJvcGRvd25fY29udGVudCA9ICRkcm9wZG93bl9jb250ZW50O1xuXG4gICAgICAgICRkcm9wZG93bi5kZWxlZ2F0ZSgnbW91c2VvdmVyJywgJ1tkYXRhLXNlbGVjdGFibGVdJywgYmluZChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMub25PcHRpb25Ib3Zlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LCB0aGlzKSk7XG4gICAgICAgICRkcm9wZG93bi5kZWxlZ2F0ZSgnbW91c2Vkb3duJywgJ1tkYXRhLXNlbGVjdGFibGVdJywgYmluZChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMub25PcHRpb25TZWxlY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSwgdGhpcykpO1xuXG4gICAgICAgIGF1dG9Hcm93KCRjb250cm9sX2lucHV0KTtcblxuICAgICAgICAkY29udHJvbC5kZWxlZ2F0ZSgnbW91c2Vkb3duJywgJyo6bm90KGlucHV0KScsIGJpbmQoZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50ID09ICRjb250cm9sKSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgICAgICB0aGlzLm9uSXRlbVNlbGVjdChldmVudCwgZWxlbWVudCk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAkY29udHJvbC5vbignbW91c2Vkb3duJywgYmluZChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMub25Nb3VzZURvd24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSwgdGhpcykpO1xuICAgICAgICAkY29udHJvbC5vbignY2xpY2snLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbkNsaWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHRoaXMpKTtcblxuICAgICAgICAkY29udHJvbF9pbnB1dC5vbignbW91c2Vkb3duJywgZnVuY3Rpb24oZSkgeyBlLnN0b3BQcm9wYWdhdGlvbigpOyB9KTtcbiAgICAgICAgJGNvbnRyb2xfaW5wdXQub24oJ2tleWRvd24nLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbktleURvd24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSwgdGhpcykpO1xuICAgICAgICAkY29udHJvbF9pbnB1dC5vbigna2V5dXAnLCBiaW5kKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5vbktleVVwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHRoaXMpKTtcbiAgICAgICAgJGNvbnRyb2xfaW5wdXQub24oJ2tleXByZXNzJywgYmluZChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMub25LZXlQcmVzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9LCB0aGlzKSk7XG4gICAgICAgICRjb250cm9sX2lucHV0Lm9uKCdyZXNpemUnLCBiaW5kKGZ1bmN0aW9uKCkgeyB0aGlzLnBvc2l0aW9uRHJvcGRvd24uYXBwbHkodGhpcywgW10pOyB9LCB0aGlzKSk7XG4gICAgICAgICRjb250cm9sX2lucHV0Lm9uKCdibHVyJywgYmluZChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMub25CbHVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHRoaXMpKTtcbiAgICAgICAgJGNvbnRyb2xfaW5wdXQub24oJ2ZvY3VzJywgYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuaWdub3JlQmx1ciA9IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub25Gb2N1cyhhcmd1bWVudHMpO1xuICAgICAgICB9LCB0aGlzKSk7XG4gICAgICAgICRjb250cm9sX2lucHV0Lm9uKCdwYXN0ZScsIGJpbmQoZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLm9uUGFzdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSwgdGhpcykpO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdrZXlkb3duJywgYmluZChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLmlzQ21kRG93biA9IGVbSVNfTUFDID8gJ21ldGFLZXknIDogJ2N0cmxLZXknXTtcbiAgICAgICAgICAgIHRoaXMuaXNDdHJsRG93biA9IGVbSVNfTUFDID8gJ2FsdEtleScgOiAnY3RybEtleSddO1xuICAgICAgICAgICAgdGhpcy5pc1NoaWZ0RG93biA9IGUuc2hpZnRLZXk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICAkKGRvY3VtZW50KS5vbigna2V5dXAnLCBiaW5kKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtFWV9DVFJMKSB0aGlzLmlzQ3RybERvd24gPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtFWV9TSElGVCkgdGhpcy5pc1NoaWZ0RG93biA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gS0VZX0NNRCkgdGhpcy5pc0NtZERvd24gPSBmYWxzZTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZWRvd24nLCBiaW5kKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzRm9jdXNlZCkge1xuICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgZXZlbnRzIG9uIHRoZSBkcm9wZG93biBzY3JvbGxiYXIgZnJvbSBjYXVzaW5nIHRoZSBjb250cm9sIHRvIGJsdXJcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuJGRyb3Bkb3duWzBdIHx8IGUudGFyZ2V0LnBhcmVudE5vZGUgPT09IHRoaXMuJGRyb3Bkb3duWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gYmx1ciBvbiBjbGljayBvdXRzaWRlXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRjb250cm9sLmZpbmQoJChlLnRhcmdldCkpICYmIGUudGFyZ2V0ICE9PSB0aGlzLiRjb250cm9sWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmx1cigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgICQod2luZG93KS5vbignc2Nyb2xsJywgYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT3Blbikge1xuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25Ecm9wZG93bi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKSk7XG4gICAgICAgICQod2luZG93KS5vbigncmVzaXplJywgYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT3Blbikge1xuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25Ecm9wZG93bi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKSk7XG4gICAgICAgICQod2luZG93KS5vbignbW91c2Vtb3ZlJywgYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuaWdub3JlSG92ZXIgPSBmYWxzZTtcbiAgICAgICAgfSwgdGhpcykpO1xuXG4gICAgICAgIC8vIHN0b3JlIG9yaWdpbmFsIGNoaWxkcmVuIGFuZCB0YWIgaW5kZXggc28gdGhhdCB0aGV5IGNhbiBiZVxuICAgICAgICAvLyByZXN0b3JlZCB3aGVuIHRoZSBkZXN0cm95KCkgbWV0aG9kIGlzIGNhbGxlZC5cbiAgICAgICAgdGhpcy5yZXZlcnRTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICRjaGlsZHJlbjogdGhpcy5pbnB1dC5jaGlsZHJlbigpLC8vLmRldGFjaCgpLFxuICAgICAgICAgICAgdGFiaW5kZXg6IHRoaXMuaW5wdXQuYXR0cmlidXRlKCd0YWJpbmRleCcpXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5pbnB1dC5hdHRyaWJ1dGUoJ3RhYmluZGV4JywgLTEpLnN0eWxlKHsgZGlzcGxheTogJ25vbmUnIH0pLmFmdGVyKCR3cmFwcGVyKTtcblxuICAgICAgICBpZiAoaXNBcnJheSh0aGlzLm9wdGlvbnMuaXRlbXMpKSB7XG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHRoaXMub3B0aW9ucy5pdGVtcyk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5vcHRpb25zLml0ZW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZmVhdHVyZSBkZXRlY3QgZm9yIHRoZSB2YWxpZGF0aW9uIEFQSVxuICAgICAgICBpZiAodGhpcy5pbnB1dFswXS52YWxpZGl0eSkge1xuICAgICAgICAgICAgdGhpcy5pbnB1dC5vbignaW52YWxpZCcsIGJpbmQoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzSW52YWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoU3RhdGUoKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBkYXRlT3JpZ2luYWxJbnB1dCgpO1xuICAgICAgICB0aGlzLnJlZnJlc2hJdGVtcygpO1xuICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgICAgICB0aGlzLnVwZGF0ZVBsYWNlaG9sZGVyKCk7XG4gICAgICAgIHRoaXMuaXNTZXR1cCA9IHRydWU7XG5cbiAgICAgICAgaWYgKHRoaXMuaW5wdXQubWF0Y2hlcygnOmRpc2FibGVkJykpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vbignY2hhbmdlJywgdGhpcy5vbkNoYW5nZSk7XG5cbiAgICAgICAgdGhpcy5pbnB1dC5zZWxlY3RpemVJbnN0YW5jZSA9IHRoaXM7XG4gICAgICAgIHRoaXMuaW5wdXQuYWRkQ2xhc3MoJ3NlbGVjdGl6ZWQnKTtcbiAgICAgICAgdGhpcy5lbWl0KCdpbml0aWFsaXplJyk7XG5cbiAgICAgICAgLy8gcHJlbG9hZCBvcHRpb25zXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucHJlbG9hZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5vblNlYXJjaENoYW5nZSgnJyk7XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICBzZXR1cFRlbXBsYXRlczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBmaWVsZF9sYWJlbCA9IHRoaXMub3B0aW9ucy5sYWJlbEZpZWxkLFxuICAgICAgICAgICAgZmllbGRfb3B0Z3JvdXAgPSB0aGlzLm9wdGlvbnMub3B0Z3JvdXBMYWJlbEZpZWxkO1xuXG4gICAgICAgIHZhciB0ZW1wbGF0ZXMgPSB7XG4gICAgICAgICAgICAnb3B0Z3JvdXAnOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwib3B0Z3JvdXBcIj4nICsgZGF0YS5odG1sICsgJzwvZGl2Pic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ29wdGdyb3VwX2hlYWRlcic6IGZ1bmN0aW9uKGRhdGEsIGVzY2FwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cIm9wdGdyb3VwLWhlYWRlclwiPicgKyBlc2NhcGUoZGF0YVtmaWVsZF9vcHRncm91cF0pICsgJzwvZGl2Pic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ29wdGlvbic6IGZ1bmN0aW9uKGRhdGEsIGVzY2FwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cIm9wdGlvblwiPicgKyBlc2NhcGUoZGF0YVtmaWVsZF9sYWJlbF0pICsgJzwvZGl2Pic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ2l0ZW0nOiBmdW5jdGlvbihkYXRhLCBlc2NhcGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJpdGVtXCI+JyArIGVzY2FwZShkYXRhW2ZpZWxkX2xhYmVsXSkgKyAnPC9kaXY+JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnb3B0aW9uX2NyZWF0ZSc6IGZ1bmN0aW9uKGRhdGEsIGVzY2FwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImNyZWF0ZVwiPkFkZCA8c3Ryb25nPicgKyBlc2NhcGUoZGF0YS5pbnB1dCkgKyAnPC9zdHJvbmc+JmhlbGxpcDs8L2Rpdj4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXIgPSBtZXJnZSh7fSwgdGVtcGxhdGVzLCB0aGlzLm9wdGlvbnMucmVuZGVyKTtcbiAgICB9LFxuXG4gICAgc2V0dXBDYWxsYmFja3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY2FsbGJhY2tzID0ge1xuICAgICAgICAgICAgJ2luaXRpYWxpemUnOiAnb25Jbml0aWFsaXplJyxcbiAgICAgICAgICAgICdjaGFuZ2UnOiAnb25DaGFuZ2UnLFxuICAgICAgICAgICAgJ2l0ZW1fYWRkJzogJ29uSXRlbUFkZCcsXG4gICAgICAgICAgICAnaXRlbV9yZW1vdmUnOiAnb25JdGVtUmVtb3ZlJyxcbiAgICAgICAgICAgICdjbGVhcic6ICdvbkNsZWFyJyxcbiAgICAgICAgICAgICdvcHRpb25fYWRkJzogJ29uT3B0aW9uQWRkJyxcbiAgICAgICAgICAgICdvcHRpb25fcmVtb3ZlJzogJ29uT3B0aW9uUmVtb3ZlJyxcbiAgICAgICAgICAgICdvcHRpb25fY2xlYXInOiAnb25PcHRpb25DbGVhcicsXG4gICAgICAgICAgICAnZHJvcGRvd25fb3Blbic6ICdvbkRyb3Bkb3duT3BlbicsXG4gICAgICAgICAgICAnZHJvcGRvd25fY2xvc2UnOiAnb25Ecm9wZG93bkNsb3NlJyxcbiAgICAgICAgICAgICd0eXBlJzogJ29uVHlwZScsXG4gICAgICAgICAgICAnbG9hZCc6ICdvbkxvYWQnXG4gICAgICAgIH07XG5cbiAgICAgICAgZm9yRWFjaChjYWxsYmFja3MsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgIHZhciBmbiA9IHRoaXMub3B0aW9uc1tjYWxsYmFja3Nba2V5XV07XG4gICAgICAgICAgICBpZiAoZm4pIHsgdGhpcy5vbihrZXksIGZuKTsgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlT3JpZ2luYWxJbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBvcHRpb25zO1xuXG4gICAgICAgIGlmICh0aGlzLnRhZ1R5cGUgPT09IFRBR19TRUxFQ1QpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gdGhpcy5pdGVtcy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goJzxvcHRpb24gdmFsdWU9XCInICsgZXNjYXBlSFRNTCh0aGlzLml0ZW1zW2ldKSArICdcIiBzZWxlY3RlZD1cInNlbGVjdGVkXCI+PC9vcHRpb24+Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMubGVuZ3RoICYmICF0aGlzLmlucHV0LmF0dHJpYnV0ZSgnbXVsdGlwbGUnKSkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucHVzaCgnPG9wdGlvbiB2YWx1ZT1cIlwiIHNlbGVjdGVkPVwic2VsZWN0ZWRcIj48L29wdGlvbj4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaW5wdXQuaHRtbChvcHRpb25zLmpvaW4oJycpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQudmFsdWUodGhpcy5nZXRWYWx1ZSgpKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuYXR0cmlidXRlKCd2YWx1ZScsIHRoaXMuaW5wdXQudmFsdWUoKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc1NldHVwKSB7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2NoYW5nZScsIHRoaXMuaW5wdXQudmFsdWUoKSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0QWRqYWNlbnRPcHRpb246IGZ1bmN0aW9uKCRvcHRpb24sIGRpcmVjdGlvbikge1xuICAgICAgICB2YXIgJG9wdGlvbnMgPSB0aGlzLiRkcm9wZG93bi5zZWFyY2goJ1tkYXRhLXNlbGVjdGFibGVdJyk7XG4gICAgICAgIHZhciBpbmRleCA9IGluZGV4T2YoJG9wdGlvbnMsICgkb3B0aW9uID8gJG9wdGlvblswXSA6IG51bGwpKSArIGRpcmVjdGlvbjtcblxuICAgICAgICByZXR1cm4gaW5kZXggPj0gMCAmJiBpbmRleCA8ICgkb3B0aW9ucyA/ICRvcHRpb25zLmxlbmd0aCA6IDApID8gJCgkb3B0aW9uc1tpbmRleF0pIDogJCgpO1xuICAgIH0sXG5cbiAgICBnZXRPcHRpb246IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEVsZW1lbnRXaXRoVmFsdWUodmFsdWUsIHRoaXMuJGRyb3Bkb3duX2NvbnRlbnQuc2VhcmNoKCdbZGF0YS1zZWxlY3RhYmxlXScpKTtcbiAgICB9LFxuXG4gICAgZ2V0RWxlbWVudFdpdGhWYWx1ZTogZnVuY3Rpb24odmFsdWUsICRlbHMpIHtcbiAgICAgICAgdmFsdWUgPSBoYXNoX2tleSh2YWx1ZSk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gKCRlbHMgPyAkZWxzLmxlbmd0aCA6IDApOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRlbHNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJykgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkKCRlbHNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAkKCk7XG4gICAgfSxcblxuICAgIGdldEl0ZW06IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEVsZW1lbnRXaXRoVmFsdWUodmFsdWUsIHRoaXMuJGNvbnRyb2wuY2hpbGRyZW4oKSk7XG4gICAgfSxcblxuICAgIGFkZEl0ZW1zOiBmdW5jdGlvbih2YWx1ZXMpIHtcbiAgICAgICAgdmFyIGl0ZW1zID0gaXNBcnJheSh2YWx1ZXMpID8gdmFsdWVzIDogW3ZhbHVlc107XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gaXRlbXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmlzUGVuZGluZyA9IChpIDwgbiAtIDEpO1xuICAgICAgICAgICAgdGhpcy5hZGRJdGVtKGl0ZW1zW2ldKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRJdGVtOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICBkZWJvdW5jZV9ldmVudHModGhpcywgWydjaGFuZ2UnXSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJGl0ZW0sICRvcHRpb24sICRvcHRpb25zO1xuICAgICAgICAgICAgdmFyIGlucHV0TW9kZSA9IHRoaXMub3B0aW9ucy5tb2RlO1xuICAgICAgICAgICAgdmFyIGksIGFjdGl2ZSwgdmFsdWVfbmV4dCwgd2FzRnVsbDtcbiAgICAgICAgICAgIHZhbHVlID0gaGFzaF9rZXkodmFsdWUpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5pbmRleE9mKHZhbHVlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRNb2RlID09PSAnc2luZ2xlJyAmJiB0aGlzLmlzT3BlbikgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0aGlzLk9wdGlvbnMuaGFzT3duUHJvcGVydHkodmFsdWUpKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoaW5wdXRNb2RlID09PSAnc2luZ2xlJykgdGhpcy5jbGVhcigpO1xuICAgICAgICAgICAgaWYgKGlucHV0TW9kZSA9PT0gJ211bHRpJyAmJiAodGhpcy5pc0Z1bGwoKSB8fCAhdmFsdWUpKSByZXR1cm47XG5cbiAgICAgICAgICAgIHZhciBkdW1teSA9IHplbignZGl2JykuaHRtbCh0aGlzLnJlbmRlcignaXRlbScsIHRoaXMuT3B0aW9uc1t2YWx1ZV0pKTtcbiAgICAgICAgICAgICRpdGVtID0gZHVtbXkuZmlyc3RDaGlsZCgpO1xuICAgICAgICAgICAgd2FzRnVsbCA9IHRoaXMuaXNGdWxsKCk7XG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZSh0aGlzLmNhcmV0UG9zLCAwLCB2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLmluc2VydEF0Q2FyZXQoJGl0ZW0pO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzUGVuZGluZyB8fCAoIXdhc0Z1bGwgJiYgdGhpcy5pc0Z1bGwoKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc1NldHVwKSB7XG4gICAgICAgICAgICAgICAgJG9wdGlvbnMgPSB0aGlzLiRkcm9wZG93bl9jb250ZW50LnNlYXJjaCgnW2RhdGEtc2VsZWN0YWJsZV0nKTtcblxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBtZW51IC8gcmVtb3ZlIHRoZSBvcHRpb24gKGlmIHRoaXMgaXMgbm90IG9uZSBpdGVtIGJlaW5nIGFkZGVkIGFzIHBhcnQgb2Ygc2VyaWVzKVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1BlbmRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgJG9wdGlvbiA9IHRoaXMuZ2V0T3B0aW9uKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkaiA9IHRoaXMuZ2V0QWRqYWNlbnRPcHRpb24oJG9wdGlvbiwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlX25leHQgPSAoYWRqKSA/IGFkai5hdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaE9wdGlvbnModGhpcy5pc0ZvY3VzZWQgJiYgaW5wdXRNb2RlICE9PSAnc2luZ2xlJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZV9uZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZU9wdGlvbih0aGlzLmdldE9wdGlvbih2YWx1ZV9uZXh0KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBoaWRlIHRoZSBtZW51IGlmIHRoZSBtYXhpbXVtIG51bWJlciBvZiBpdGVtcyBoYXZlIGJlZW4gc2VsZWN0ZWQgb3Igbm8gb3B0aW9ucyBhcmUgbGVmdFxuICAgICAgICAgICAgICAgIGlmICghJG9wdGlvbnMgfHwgdGhpcy5pc0Z1bGwoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkRyb3Bkb3duKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQbGFjZWhvbGRlcigpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnaXRlbV9hZGQnLCB2YWx1ZSwgJGl0ZW0pO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3JpZ2luYWxJbnB1dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlSXRlbTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgdmFyICRpdGVtLCBpLCBpZHg7XG5cbiAgICAgICAgJGl0ZW0gPSAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JykgPyB2YWx1ZSA6IHRoaXMuZ2V0SXRlbSh2YWx1ZSk7XG4gICAgICAgIHZhbHVlID0gaGFzaF9rZXkoJGl0ZW0uYXR0cmlidXRlKCdkYXRhLXZhbHVlJykpO1xuICAgICAgICBpID0gdGhpcy5pdGVtcy5pbmRleE9mKHZhbHVlKTtcblxuICAgICAgICBpZiAoaSAhPT0gLTEpIHtcbiAgICAgICAgICAgICRpdGVtLnJlbW92ZSgpO1xuICAgICAgICAgICAgaWYgKCRpdGVtLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgIGlkeCA9IHRoaXMuJGFjdGl2ZUl0ZW1zLmluZGV4T2YoJGl0ZW1bMF0pO1xuICAgICAgICAgICAgICAgIHRoaXMuJGFjdGl2ZUl0ZW1zLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gbnVsbDtcbiAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnBlcnNpc3QgJiYgdGhpcy5Vc2VyT3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU9wdGlvbih2YWx1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpIDwgdGhpcy5jYXJldFBvcykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2FyZXQodGhpcy5jYXJldFBvcyAtIDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQbGFjZWhvbGRlcigpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVPcmlnaW5hbElucHV0KCk7XG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uRHJvcGRvd24oKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnaXRlbV9yZW1vdmUnLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY3JlYXRlSXRlbTogZnVuY3Rpb24odHJpZ2dlckRyb3Bkb3duKSB7XG4gICAgICAgIHZhciBpbnB1dCA9IHRyaW0odGhpcy4kY29udHJvbF9pbnB1dC52YWx1ZSgpIHx8ICcnKTtcbiAgICAgICAgdmFyIGNhcmV0ID0gdGhpcy5jYXJldFBvcztcbiAgICAgICAgaWYgKCF0aGlzLmNhbkNyZWF0ZShpbnB1dCkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgdGhpcy5sb2NrKCk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiB0cmlnZ2VyRHJvcGRvd24gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0cmlnZ2VyRHJvcGRvd24gPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNldHVwID0gKHR5cGVvZiB0aGlzLm9wdGlvbnMuY3JlYXRlID09PSAnZnVuY3Rpb24nKSA/IHRoaXMub3B0aW9ucy5jcmVhdGUgOiBiaW5kKGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgICAgICAgZGF0YVt0aGlzLm9wdGlvbnMubGFiZWxGaWVsZF0gPSBpbnB1dDtcbiAgICAgICAgICAgIGRhdGFbdGhpcy5vcHRpb25zLnZhbHVlRmllbGRdID0gaW5wdXQ7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgdmFyIGNyZWF0ZSA9IG9uY2UoYmluZChmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnVubG9jaygpO1xuXG4gICAgICAgICAgICBpZiAoIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICdvYmplY3QnKSByZXR1cm47XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBoYXNoX2tleShkYXRhW3RoaXMub3B0aW9ucy52YWx1ZUZpZWxkXSk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgcmV0dXJuO1xuXG4gICAgICAgICAgICB0aGlzLnNldFRleHRib3hWYWx1ZSgnJyk7XG4gICAgICAgICAgICB0aGlzLmFkZE9wdGlvbihkYXRhKTtcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FyZXQoY2FyZXQpO1xuICAgICAgICAgICAgdGhpcy5hZGRJdGVtKHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaE9wdGlvbnModHJpZ2dlckRyb3Bkb3duICYmIHRoaXMub3B0aW9ucy5tb2RlICE9PSAnc2luZ2xlJyk7XG4gICAgICAgIH0sIHRoaXMpKTtcblxuICAgICAgICB2YXIgb3V0cHV0ID0gc2V0dXAuYXBwbHkodGhpcywgW2lucHV0LCBjcmVhdGVdKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvdXRwdXQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBjcmVhdGUob3V0cHV0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICByZWZyZXNoSXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IG51bGw7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNTZXR1cCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLml0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRJdGVtKHRoaXMuaXRlbXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWZyZXNoU3RhdGUoKTtcbiAgICAgICAgdGhpcy51cGRhdGVPcmlnaW5hbElucHV0KCk7XG4gICAgfSxcblxuICAgIHJlZnJlc2hTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpbnZhbGlkO1xuICAgICAgICBpZiAodGhpcy5pc1JlcXVpcmVkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGgpIHRoaXMuaXNJbnZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLiRjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgncmVxdWlyZWQnLCBpbnZhbGlkKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZnJlc2hDbGFzc2VzKCk7XG4gICAgfSxcblxuICAgIHJlZnJlc2hDbGFzc2VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlzRnVsbCA9IHRoaXMuaXNGdWxsKCksXG4gICAgICAgICAgICBpc0xvY2tlZCA9IHRoaXMuaXNMb2NrZWQ7XG5cbiAgICAgICAgLypzZWxmLiR3cmFwcGVyXG4gICAgICAgICAudG9nZ2xlQ2xhc3MoJ3J0bCcsIHNlbGYucnRsKTsqL1xuXG4gICAgICAgIHRoaXMuJGNvbnRyb2wudG9nZ2xlQ2xhc3MoJ2ZvY3VzJywgdGhpcy5pc0ZvY3VzZWQpO1xuICAgICAgICB0aGlzLiRjb250cm9sLnRvZ2dsZUNsYXNzKCdkaXNhYmxlZCcsIHRoaXMuaXNEaXNhYmxlZCk7XG4gICAgICAgIHRoaXMuJGNvbnRyb2wudG9nZ2xlQ2xhc3MoJ3JlcXVpcmVkJywgdGhpcy5pc1JlcXVpcmVkKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnaW52YWxpZCcsIHRoaXMuaXNJbnZhbGlkKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnbG9ja2VkJywgaXNMb2NrZWQpO1xuICAgICAgICB0aGlzLiRjb250cm9sLnRvZ2dsZUNsYXNzKCdmdWxsJywgaXNGdWxsKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnbm90LWZ1bGwnLCAhaXNGdWxsKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnaW5wdXQtYWN0aXZlJywgdGhpcy5pc0ZvY3VzZWQgJiYgIXRoaXMuaXNJbnB1dEhpZGRlbik7XG4gICAgICAgIHRoaXMuJGNvbnRyb2wudG9nZ2xlQ2xhc3MoJ2Ryb3Bkb3duLWFjdGl2ZScsIHRoaXMuaXNPcGVuKTtcbiAgICAgICAgdGhpcy4kY29udHJvbC50b2dnbGVDbGFzcygnaGFzLW9wdGlvbnMnLCAhc2l6ZSh0aGlzLm9wdGlvbnMuT3B0aW9ucykpO1xuICAgICAgICB0aGlzLiRjb250cm9sLnRvZ2dsZUNsYXNzKCdoYXMtaXRlbXMnLCB0aGlzLml0ZW1zLmxlbmd0aCA+IDApO1xuXG4gICAgICAgIHRoaXMuJGNvbnRyb2xfaW5wdXQuc2VsZWN0aXplR3JvdyA9ICFpc0Z1bGwgJiYgIWlzTG9ja2VkO1xuICAgIH0sXG5cbiAgICBpc0Z1bGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1heEl0ZW1zICE9PSBudWxsICYmIHRoaXMuaXRlbXMubGVuZ3RoID49IHRoaXMub3B0aW9ucy5tYXhJdGVtcztcbiAgICB9LFxuXG4gICAgdXBkYXRlUGxhY2Vob2xkZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5wbGFjZWhvbGRlcikgcmV0dXJuO1xuICAgICAgICB2YXIgY29udHJvbF9pbnB1dCA9IHRoaXMuJGNvbnRyb2xfaW5wdXQ7XG5cbiAgICAgICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb250cm9sX2lucHV0LmF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRyb2xfaW5wdXQuYXR0cmlidXRlKCdwbGFjZWhvbGRlcicsIHRoaXMub3B0aW9ucy5wbGFjZWhvbGRlcik7XG4gICAgICAgIH1cbiAgICAgICAgY29udHJvbF9pbnB1dC5lbWl0KCd1cGRhdGUnLCB7IGZvcmNlOiB0cnVlIH0pO1xuICAgIH0sXG5cbiAgICBvcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNMb2NrZWQgfHwgdGhpcy5pc09wZW4gfHwgKHRoaXMub3B0aW9ucy5tb2RlID09PSAnbXVsdGknICYmIHRoaXMuaXNGdWxsKCkpKSByZXR1cm47XG4gICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgICAgICB0aGlzLiRkcm9wZG93bi5zdHlsZSh7XG4gICAgICAgICAgICB2aXNpYmlsaXR5OiAnaGlkZGVuJyxcbiAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaydcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9zaXRpb25Ecm9wZG93bigpO1xuICAgICAgICB0aGlzLiRkcm9wZG93bi5zdHlsZSh7IHZpc2liaWxpdHk6ICd2aXNpYmxlJyB9KTtcbiAgICAgICAgdGhpcy5lbWl0KCdkcm9wZG93bl9vcGVuJywgdGhpcy4kZHJvcGRvd24pO1xuICAgIH0sXG5cbiAgICBjbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0cmlnZ2VyID0gdGhpcy5pc09wZW47XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tb2RlID09PSAnc2luZ2xlJyAmJiB0aGlzLml0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5oaWRlSW5wdXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJGRyb3Bkb3duLnN0eWxlKHsgZGlzcGxheTogJ25vbmUnIH0pO1xuICAgICAgICB0aGlzLnNldEFjdGl2ZU9wdGlvbihudWxsKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoU3RhdGUoKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1vZGUgPT09ICdzaW5nbGUnICYmICF0aGlzLmdldFZhbHVlKCkpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuc2V0VGV4dGJveFZhbHVlKCcnKTtcbiAgICAgICAgICAgIHRoaXMuYWRkSXRlbSh0aGlzLk9wdGlvbnNbT2JqZWN0LmtleXModGhpcy5PcHRpb25zKVswXV1bdGhpcy5vcHRpb25zLnZhbHVlRmllbGRdKTtcbiAgICAgICAgICAgIC8vdGhpcy5ibHVyKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHJpZ2dlcikgdGhpcy5lbWl0KCdkcm9wZG93bl9jbG9zZScsIHRoaXMuJGRyb3Bkb3duKTtcbiAgICB9LFxuXG4gICAgcG9zaXRpb25Ecm9wZG93bjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjb250cm9sID0gdGhpcy4kY29udHJvbCxcbiAgICAgICAgICAgIG9mZnNldCA9IGNvbnRyb2wucG9zaXRpb24oKTsvL3RoaXMub3B0aW9ucy5kcm9wZG93blBhcmVudCA9PT0gJ2JvZHknID8gY29udHJvbC5vZmZzZXQoKSA6IGNvbnRyb2wucG9zaXRpb24oKTtcbiAgICAgICAgb2Zmc2V0LnRvcCArPSBjb250cm9sWzBdLm9mZnNldEhlaWdodDtcblxuICAgICAgICB0aGlzLiRkcm9wZG93bi5zdHlsZSh7XG4gICAgICAgICAgICB3aWR0aDogY29udHJvbFswXS5vZmZzZXRXaWR0aCxcbiAgICAgICAgICAgIHRvcDogY29udHJvbFswXS5vZmZzZXRUb3AgKyBjb250cm9sWzBdLm9mZnNldEhlaWdodCxcbiAgICAgICAgICAgIGxlZnQ6IGNvbnRyb2xbMF0ub2Zmc2V0TGVmdFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbm9uX2lucHV0ID0gdGhpcy4kY29udHJvbC5jaGlsZHJlbignOm5vdChpbnB1dCknKTtcbiAgICAgICAgaWYgKCF0aGlzLml0ZW1zLmxlbmd0aCkgcmV0dXJuO1xuXG4gICAgICAgIGlmIChub25faW5wdXQpIG5vbl9pbnB1dC5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IG51bGw7XG4gICAgICAgIHRoaXMuc2V0Q2FyZXQoMCk7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbShudWxsKTtcbiAgICAgICAgdGhpcy51cGRhdGVQbGFjZWhvbGRlcigpO1xuICAgICAgICB0aGlzLnVwZGF0ZU9yaWdpbmFsSW5wdXQoKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoU3RhdGUoKTtcbiAgICAgICAgdGhpcy5zaG93SW5wdXQoKTtcbiAgICAgICAgdGhpcy5lbWl0KCdjbGVhcicpO1xuICAgIH0sXG5cbiAgICBvbkNsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8vIG5lY2Vzc2FyeSBmb3IgbW9iaWxlIHdlYmtpdCBkZXZpY2VzIChtYW51YWwgZm9jdXMgdHJpZ2dlcmluZ1xuICAgICAgICAvLyBpcyBpZ25vcmVkIHVubGVzcyBpbnZva2VkIHdpdGhpbiBhIGNsaWNrIGV2ZW50KVxuICAgICAgICBpZiAoIXRoaXMuaXNGb2N1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25Nb3VzZURvd246IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGRlZmF1bHRQcmV2ZW50ZWQgPSBlLmRlZmF1bHRQcmV2ZW50ZWQ7XG4gICAgICAgIHZhciAkdGFyZ2V0ID0gJChlLnRhcmdldCk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNGb2N1c2VkKSB7XG4gICAgICAgICAgICAvLyByZXRhaW4gZm9jdXMgYnkgcHJldmVudGluZyBuYXRpdmUgaGFuZGxpbmcuIGlmIHRoZVxuICAgICAgICAgICAgLy8gZXZlbnQgdGFyZ2V0IGlzIHRoZSBpbnB1dCBpdCBzaG91bGQgbm90IGJlIG1vZGlmaWVkLlxuICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCB0ZXh0IHNlbGVjdGlvbiB3aXRoaW4gdGhlIGlucHV0IHdvbid0IHdvcmsuXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQgIT09IHRoaXMuJGNvbnRyb2xfaW5wdXRbMF0pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1vZGUgPT09ICdzaW5nbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRvZ2dsZSBkcm9wZG93blxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT3BlbiA/IHRoaXMuY2xvc2UoKSA6IHRoaXMub3BlbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWRlZmF1bHRQcmV2ZW50ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtKG51bGwpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGdpdmUgY29udHJvbCBmb2N1c1xuICAgICAgICAgICAgaWYgKCFkZWZhdWx0UHJldmVudGVkKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoYmluZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaW5wdXQuZW1pdCgnY2hhbmdlJywgdGhpcy5pbnB1dC52YWx1ZSgpLCB0aGlzKTtcbiAgICAgICAgJCgnYm9keScpLmVtaXQoJ2NoYW5nZScsIHt0YXJnZXQ6IHRoaXMuaW5wdXR9KTtcbiAgICB9LFxuXG4gICAgb25QYXN0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAodGhpcy5pc0Z1bGwoKSB8fCB0aGlzLmlzSW5wdXRIaWRkZW4gfHwgdGhpcy5pc0xvY2tlZCkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uS2V5UHJlc3M6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNMb2NrZWQpIHJldHVybiBlICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIGNoYXJhY3RlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlIHx8IGUud2hpY2gpO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNyZWF0ZSAmJiBjaGFyYWN0ZXIgPT09IHRoaXMub3B0aW9ucy5kZWxpbWl0ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlSXRlbSgpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uS2V5RG93bjogZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgaXNJbnB1dCA9IGUudGFyZ2V0ID09PSB0aGlzLiRjb250cm9sX2lucHV0WzBdO1xuXG4gICAgICAgIGlmICh0aGlzLmlzTG9ja2VkKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlICE9PSBLRVlfVEFCKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgS0VZX0E6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDbWREb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0QWxsKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtFWV9FU0M6XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYmx1cigpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGNhc2UgS0VZX046XG4gICAgICAgICAgICAgICAgaWYgKCFlLmN0cmxLZXkgfHwgZS5hbHRLZXkpIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLRVlfRE9XTjpcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNPcGVuICYmIHRoaXMuaGFzT3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuJGFjdGl2ZU9wdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlnbm9yZUhvdmVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRuZXh0ID0gdGhpcy5nZXRBZGphY2VudE9wdGlvbih0aGlzLiRhY3RpdmVPcHRpb24sIDEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJG5leHQpIHRoaXMuc2V0QWN0aXZlT3B0aW9uKCRuZXh0LCB0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgS0VZX1A6XG4gICAgICAgICAgICAgICAgaWYgKCFlLmN0cmxLZXkgfHwgZS5hbHRLZXkpIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLRVlfVVA6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGFjdGl2ZU9wdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlnbm9yZUhvdmVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRwcmV2ID0gdGhpcy5nZXRBZGphY2VudE9wdGlvbih0aGlzLiRhY3RpdmVPcHRpb24sIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRwcmV2KSB0aGlzLnNldEFjdGl2ZU9wdGlvbigkcHJldiwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlIEtFWV9SRVRVUk46XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuICYmIHRoaXMuJGFjdGl2ZU9wdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uT3B0aW9uU2VsZWN0KHsgY3VycmVudFRhcmdldDogdGhpcy4kYWN0aXZlT3B0aW9uIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY2FzZSBLRVlfTEVGVDpcbiAgICAgICAgICAgICAgICB0aGlzLmFkdmFuY2VTZWxlY3Rpb24oLTEsIGUpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgS0VZX1JJR0hUOlxuICAgICAgICAgICAgICAgIHRoaXMuYWR2YW5jZVNlbGVjdGlvbigxLCBlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlIEtFWV9UQUI6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZWxlY3RPblRhYiAmJiB0aGlzLmlzT3BlbiAmJiB0aGlzLiRhY3RpdmVPcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbk9wdGlvblNlbGVjdCh7IGN1cnJlbnRUYXJnZXQ6IHRoaXMuJGFjdGl2ZU9wdGlvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNyZWF0ZSAmJiB0aGlzLmNyZWF0ZUl0ZW0oKSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNhc2UgS0VZX0JBQ0tTUEFDRTpcbiAgICAgICAgICAgIGNhc2UgS0VZX0RFTEVURTpcbiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZVNlbGVjdGlvbihlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKHRoaXMuaXNGdWxsKCkgfHwgdGhpcy5pc0lucHV0SGlkZGVuKSAmJiAhKElTX01BQyA/IGUubWV0YUtleSA6IGUuY3RybEtleSkpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbktleVVwOiBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNMb2NrZWQpIHJldHVybiBlICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy4kY29udHJvbF9pbnB1dC52YWx1ZSgpIHx8ICcnO1xuICAgICAgICBpZiAodGhpcy5sYXN0VmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5vblNlYXJjaENoYW5nZSh2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hPcHRpb25zKCk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ3R5cGUnLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25TZWFyY2hDaGFuZ2U6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHZhciBmbiA9IHRoaXMub3B0aW9ucy5sb2FkO1xuICAgICAgICBpZiAoIWZuKSByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLmxvYWRlZFNlYXJjaGVzLmhhc093blByb3BlcnR5KHZhbHVlKSkgcmV0dXJuO1xuICAgICAgICB0aGlzLmxvYWRlZFNlYXJjaGVzW3ZhbHVlXSA9IHRydWU7XG4gICAgICAgIHRoaXMubG9hZChmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgZm4uYXBwbHkodGhpcywgW3ZhbHVlLCBjYWxsYmFja10pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgb25Gb2N1czogZnVuY3Rpb24oZSkge1xuICAgICAgICB0aGlzLmlzRm9jdXNlZCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLmlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYmx1cigpO1xuICAgICAgICAgICAgZSAmJiBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pZ25vcmVGb2N1cykgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnByZWxvYWQgPT09ICdmb2N1cycpIHRoaXMub25TZWFyY2hDaGFuZ2UoJycpO1xuXG4gICAgICAgIGlmICghdGhpcy4kYWN0aXZlSXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dJbnB1dCgpO1xuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtKG51bGwpO1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoT3B0aW9ucyghIXRoaXMub3B0aW9ucy5vcGVuT25Gb2N1cyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgIH0sXG5cbiAgICBvbkJsdXI6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlRm9jdXMpIHJldHVybjtcblxuICAgICAgICAvLyBuZWNlc3NhcnkgdG8gcHJldmVudCBJRSBjbG9zaW5nIHRoZSBkcm9wZG93biB3aGVuIHRoZSBzY3JvbGxiYXIgaXMgY2xpY2tlZFxuICAgICAgICBpZiAoIXRoaXMuaWdub3JlQmx1ciAmJiBkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSB0aGlzLiRkcm9wZG93bl9jb250ZW50WzBdKSB7XG4gICAgICAgICAgICB0aGlzLmlnbm9yZUJsdXIgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5vbkZvY3VzKGUpO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNyZWF0ZSAmJiB0aGlzLm9wdGlvbnMuY3JlYXRlT25CbHVyKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUl0ZW0oZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB0aGlzLnNldFRleHRib3hWYWx1ZSgnJyk7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbShudWxsKTtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVPcHRpb24obnVsbCk7XG4gICAgICAgIHRoaXMuc2V0Q2FyZXQodGhpcy5pdGVtcy5sZW5ndGgpO1xuICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgIH0sXG5cbiAgICBvbk9wdGlvbkhvdmVyOiBmdW5jdGlvbihlLCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBpZiAodGhpcy5pZ25vcmVIb3ZlcikgcmV0dXJuO1xuICAgICAgICB0aGlzLnNldEFjdGl2ZU9wdGlvbihlbGVtZW50IHx8IGUuY3VycmVudFRhcmdldCwgZmFsc2UpO1xuICAgIH0sXG5cbiAgICBvbk9wdGlvblNlbGVjdDogZnVuY3Rpb24oZSwgZWxlbWVudCkge1xuICAgICAgICB2YXIgdmFsdWUsICR0YXJnZXQsICRvcHRpb24sIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgJHRhcmdldCA9ICQoZWxlbWVudCB8fCBlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICBpZiAoJHRhcmdldC5oYXNDbGFzcygnY3JlYXRlJykpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlSXRlbSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFsdWUgPSAkdGFyZ2V0LmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUZXh0Ym94VmFsdWUoJycpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkSXRlbSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuaGlkZVNlbGVjdGVkICYmIGUudHlwZSAmJiAvbW91c2UvLnRlc3QoZS50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZU9wdGlvbih0aGlzLmdldE9wdGlvbih2YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkl0ZW1TZWxlY3Q6IGZ1bmN0aW9uKGUsIGVsZW1lbnQpIHtcblxuICAgICAgICBpZiAodGhpcy5pc0xvY2tlZCkgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1vZGUgPT09ICdtdWx0aScpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbShlbGVtZW50IHx8IGUuY3VycmVudFRhcmdldCwgZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbG9hZDogZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgdmFyICR3cmFwcGVyID0gdGhpcy4kd3JhcHBlci5hZGRDbGFzcygnbG9hZGluZycpO1xuXG4gICAgICAgIHRoaXMubG9hZGluZysrO1xuICAgICAgICBmbi5hcHBseSh0aGlzLCBbYmluZChmdW5jdGlvbihyZXN1bHRzKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBNYXRoLm1heCh0aGlzLmxvYWRpbmcgLSAxLCAwKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHRzICYmIHJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRPcHRpb24ocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoT3B0aW9ucyh0aGlzLmlzRm9jdXNlZCAmJiAhdGhpcy5pc0lucHV0SGlkZGVuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgJHdyYXBwZXIucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZW1pdCgnbG9hZCcsIHJlc3VsdHMpO1xuICAgICAgICB9LCB0aGlzKV0pO1xuICAgIH0sXG5cbiAgICBzZXRUZXh0Ym94VmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHZhciAkaW5wdXQgPSB0aGlzLiRjb250cm9sX2lucHV0O1xuICAgICAgICB2YXIgY2hhbmdlZCA9ICRpbnB1dC52YWx1ZSgpICE9PSB2YWx1ZTtcbiAgICAgICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgICAgICAgICRpbnB1dC52YWx1ZSh2YWx1ZSkuZW1pdCgndXBkYXRlJyk7XG4gICAgICAgICAgICB0aGlzLmxhc3RWYWx1ZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMudGFnVHlwZSA9PT0gVEFHX1NFTEVDVCAmJiB0aGlzLmlucHV0LmF0dHJpYnV0ZSgnbXVsdGlwbGUnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pdGVtcy5qb2luKHRoaXMub3B0aW9ucy5kZWxpbWl0ZXIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgc2VsZWN0ZWQgaXRlbXMgdG8gdGhlIGdpdmVuIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHttaXhlZH0gdmFsdWVcbiAgICAgKi9cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgZGVib3VuY2VfZXZlbnRzKHRoaXMsIFsnY2hhbmdlJ10sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5jbGVhcigpO1xuICAgICAgICAgICAgdGhpcy5hZGRJdGVtcyh2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBmb2N1czogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRGlzYWJsZWQpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5pZ25vcmVGb2N1cyA9IHRydWU7XG4gICAgICAgIHRoaXMuJGNvbnRyb2xfaW5wdXRbMF0uZm9jdXMoKTtcbiAgICAgICAgc2V0VGltZW91dChiaW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5pZ25vcmVGb2N1cyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5vbkZvY3VzKCk7XG4gICAgICAgIH0sIHRoaXMpLCAwKTtcbiAgICB9LFxuXG4gICAgYmx1cjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuJGNvbnRyb2xfaW5wdXQuZW1pdCgnYmx1cicpO1xuICAgICAgICB0aGlzLiRjb250cm9sX2lucHV0WzBdLmJsdXIoKTtcbiAgICB9LFxuXG4gICAgc2hvd0lucHV0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy4kY29udHJvbF9pbnB1dC5zdHlsZSh7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgICAgICAgICBsZWZ0OiAwXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlzSW5wdXRIaWRkZW4gPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgc2V0QWN0aXZlSXRlbTogZnVuY3Rpb24oaXRlbSwgZSkge1xuICAgICAgICB2YXIgZXZlbnROYW1lLCBpZHgsIGJlZ2luLCBlbmQsIGl0ZW0sIHN3YXAsICRsYXN0O1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW9kZSA9PT0gJ3NpbmdsZScpIHsgcmV0dXJuOyB9XG4gICAgICAgIGl0ZW0gPSAkKGl0ZW0pO1xuXG4gICAgICAgIC8vIGNsZWFyIHRoZSBhY3RpdmUgc2VsZWN0aW9uXG4gICAgICAgIGlmICghaXRlbSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGFjdGl2ZUl0ZW1zLmxlbmd0aCkgeyAkKHRoaXMuJGFjdGl2ZUl0ZW1zKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7IH1cbiAgICAgICAgICAgIHRoaXMuJGFjdGl2ZUl0ZW1zID0gW107XG4gICAgICAgICAgICBpZiAodGhpcy5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dJbnB1dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gbW9kaWZ5IHNlbGVjdGlvblxuICAgICAgICBldmVudE5hbWUgPSBlICYmIGUudHlwZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIGlmIChldmVudE5hbWUgPT09ICdtb3VzZWRvd24nICYmIHRoaXMuaXNTaGlmdERvd24gJiYgdGhpcy4kYWN0aXZlSXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAkbGFzdCA9ICQobGFzdCh0aGlzLiRjb250cm9sLmNoaWxkcmVuKCcuYWN0aXZlJykpKTtcbiAgICAgICAgICAgIGJlZ2luID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuYXBwbHkodGhpcy4kY29udHJvbFswXS5jaGlsZE5vZGVzLCBbJGxhc3RbMF1dKTtcbiAgICAgICAgICAgIGVuZCA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmFwcGx5KHRoaXMuJGNvbnRyb2xbMF0uY2hpbGROb2RlcywgW2l0ZW1bMF1dKTtcbiAgICAgICAgICAgIGlmIChiZWdpbiA+IGVuZCkge1xuICAgICAgICAgICAgICAgIHN3YXAgPSBiZWdpbjtcbiAgICAgICAgICAgICAgICBiZWdpbiA9IGVuZDtcbiAgICAgICAgICAgICAgICBlbmQgPSBzd2FwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGJlZ2luOyBpIDw9IGVuZDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaXRlbSA9IHRoaXMuJGNvbnRyb2xbMF0uY2hpbGROb2Rlc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kYWN0aXZlSXRlbXMuaW5kZXhPZihpdGVtKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGFjdGl2ZUl0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2UgaWYgKChldmVudE5hbWUgPT09ICdtb3VzZWRvd24nICYmIHRoaXMuaXNDdHJsRG93bikgfHwgKGV2ZW50TmFtZSA9PT0gJ2tleWRvd24nICYmIHRoaXMuaXNTaGlmdERvd24pKSB7XG4gICAgICAgICAgICBpZiAoaXRlbS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICBpZHggPSB0aGlzLiRhY3RpdmVJdGVtcy5pbmRleE9mKGl0ZW1bMF0pO1xuICAgICAgICAgICAgICAgIHRoaXMuJGFjdGl2ZUl0ZW1zLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRhY3RpdmVJdGVtcy5wdXNoKGl0ZW0uYWRkQ2xhc3MoJ2FjdGl2ZScpWzBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICgkKHRoaXMuJGFjdGl2ZUl0ZW1zKSkgJCh0aGlzLiRhY3RpdmVJdGVtcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgdGhpcy4kYWN0aXZlSXRlbXMgPSBbaXRlbS5hZGRDbGFzcygnYWN0aXZlJylbMF1dO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZW5zdXJlIGNvbnRyb2wgaGFzIGZvY3VzXG4gICAgICAgIHRoaXMuaGlkZUlucHV0KCk7XG4gICAgICAgIGlmICghdGhpcy5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZWZyZXNoT3B0aW9uczogZnVuY3Rpb24odHJpZ2dlckRyb3Bkb3duKSB7XG4gICAgICAgIHZhciBpLCBqLCBrLCBuLCBncm91cHMsIGdyb3Vwc19vcmRlciwgb3B0aW9uLCBvcHRpb25faHRtbCwgb3B0Z3JvdXAsIG9wdGdyb3VwcywgaHRtbCwgaHRtbF9jaGlsZHJlbiwgaGFzX2NyZWF0ZV9vcHRpb247XG4gICAgICAgIHZhciAkYWN0aXZlLCAkYWN0aXZlX2JlZm9yZSwgJGNyZWF0ZTtcblxuICAgICAgICBpZiAodHlwZW9mIHRyaWdnZXJEcm9wZG93biA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRyaWdnZXJEcm9wZG93biA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcXVlcnkgPSB0cmltKHRoaXMuJGNvbnRyb2xfaW5wdXQudmFsdWUoKSk7XG4gICAgICAgIHZhciByZXN1bHRzID0gdGhpcy5zZWFyY2gocXVlcnkpO1xuICAgICAgICB2YXIgJGRyb3Bkb3duX2NvbnRlbnQgPSB0aGlzLiRkcm9wZG93bl9jb250ZW50O1xuICAgICAgICB2YXIgYWN0aXZlX2JlZm9yZSA9IHRoaXMuJGFjdGl2ZU9wdGlvbiAmJiBoYXNoX2tleSh0aGlzLiRhY3RpdmVPcHRpb24uYXR0cmlidXRlKCd2YWx1ZScpKTtcblxuICAgICAgICAvLyBidWlsZCBtYXJrdXBcbiAgICAgICAgbiA9IHJlc3VsdHMuaXRlbXMubGVuZ3RoO1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5tYXhPcHRpb25zID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgbiA9IE1hdGgubWluKG4sIHRoaXMub3B0aW9ucy5tYXhPcHRpb25zKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJlbmRlciBhbmQgZ3JvdXAgYXZhaWxhYmxlIG9wdGlvbnMgaW5kaXZpZHVhbGx5XG4gICAgICAgIGdyb3VwcyA9IHt9O1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMub3B0Z3JvdXBPcmRlcikge1xuICAgICAgICAgICAgZ3JvdXBzX29yZGVyID0gdGhpcy5vcHRpb25zLm9wdGdyb3VwT3JkZXI7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZ3JvdXBzX29yZGVyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXBzW2dyb3Vwc19vcmRlcltpXV0gPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdyb3Vwc19vcmRlciA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgb3B0aW9uID0gdGhpcy5PcHRpb25zW3Jlc3VsdHMuaXRlbXNbaV0uaWRdO1xuICAgICAgICAgICAgb3B0aW9uX2h0bWwgPSB0aGlzLnJlbmRlcignb3B0aW9uJywgb3B0aW9uKTtcbiAgICAgICAgICAgIG9wdGdyb3VwID0gb3B0aW9uW3RoaXMub3B0aW9ucy5vcHRncm91cEZpZWxkXSB8fCAnJztcbiAgICAgICAgICAgIG9wdGdyb3VwcyA9IGlzQXJyYXkob3B0Z3JvdXApID8gb3B0Z3JvdXAgOiBbb3B0Z3JvdXBdO1xuXG4gICAgICAgICAgICBmb3IgKGogPSAwLCBrID0gb3B0Z3JvdXBzICYmIG9wdGdyb3Vwcy5sZW5ndGg7IGogPCBrOyBqKyspIHtcbiAgICAgICAgICAgICAgICBvcHRncm91cCA9IG9wdGdyb3Vwc1tqXTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuT3B0Z3JvdXBzLmhhc093blByb3BlcnR5KG9wdGdyb3VwKSkge1xuICAgICAgICAgICAgICAgICAgICBvcHRncm91cCA9ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShvcHRncm91cCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzW29wdGdyb3VwXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBncm91cHNfb3JkZXIucHVzaChvcHRncm91cCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGdyb3Vwc1tvcHRncm91cF0ucHVzaChvcHRpb25faHRtbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZW5kZXIgb3B0Z3JvdXAgaGVhZGVycyAmIGpvaW4gZ3JvdXBzXG4gICAgICAgIGh0bWwgPSBbXTtcbiAgICAgICAgZm9yIChpID0gMCwgbiA9IGdyb3Vwc19vcmRlci5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgIG9wdGdyb3VwID0gZ3JvdXBzX29yZGVyW2ldO1xuICAgICAgICAgICAgaWYgKHRoaXMuT3B0Z3JvdXBzLmhhc093blByb3BlcnR5KG9wdGdyb3VwKSAmJiBncm91cHNbb3B0Z3JvdXBdLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIC8vIHJlbmRlciB0aGUgb3B0Z3JvdXAgaGVhZGVyIGFuZCBvcHRpb25zIHdpdGhpbiBpdCxcbiAgICAgICAgICAgICAgICAvLyB0aGVuIHBhc3MgaXQgdG8gdGhlIHdyYXBwZXIgdGVtcGxhdGVcbiAgICAgICAgICAgICAgICBodG1sX2NoaWxkcmVuID0gdGhpcy5yZW5kZXIoJ29wdGdyb3VwX2hlYWRlcicsIHRoaXMuT3B0Z3JvdXBzW29wdGdyb3VwXSkgfHwgJyc7XG4gICAgICAgICAgICAgICAgaHRtbF9jaGlsZHJlbiArPSBncm91cHNbb3B0Z3JvdXBdLmpvaW4oJycpO1xuICAgICAgICAgICAgICAgIGh0bWwucHVzaCh0aGlzLnJlbmRlcignb3B0Z3JvdXAnLCBtZXJnZSh7fSwgdGhpcy5PcHRncm91cHNbb3B0Z3JvdXBdLCB7XG4gICAgICAgICAgICAgICAgICAgIGh0bWw6IGh0bWxfY2hpbGRyZW5cbiAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBodG1sLnB1c2goZ3JvdXBzW29wdGdyb3VwXS5qb2luKCcnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkZHJvcGRvd25fY29udGVudC5odG1sKGh0bWwuam9pbignJykpO1xuXG4gICAgICAgIC8vIGhpZ2hsaWdodCBtYXRjaGluZyB0ZXJtcyBpbmxpbmVcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWdobGlnaHQgJiYgcmVzdWx0cy5xdWVyeS5sZW5ndGggJiYgcmVzdWx0cy50b2tlbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBuID0gcmVzdWx0cy50b2tlbnMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0KCRkcm9wZG93bl9jb250ZW50LCByZXN1bHRzLnRva2Vuc1tpXS5yZWdleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBhZGQgXCJzZWxlY3RlZFwiIGNsYXNzIHRvIHNlbGVjdGVkIG9wdGlvbnNcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuaGlkZVNlbGVjdGVkKSB7XG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBuID0gdGhpcy5pdGVtcy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldE9wdGlvbih0aGlzLml0ZW1zW2ldKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCBjcmVhdGUgb3B0aW9uXG4gICAgICAgIGhhc19jcmVhdGVfb3B0aW9uID0gdGhpcy5jYW5DcmVhdGUocXVlcnkpO1xuICAgICAgICBpZiAoaGFzX2NyZWF0ZV9vcHRpb24pIHtcbiAgICAgICAgICAgIC8vJGRyb3Bkb3duX2NvbnRlbnQucHJlcGVuZCh0aGlzLnJlbmRlcignb3B0aW9uX2NyZWF0ZScsIHsgaW5wdXQ6IHF1ZXJ5IH0pKTtcbiAgICAgICAgICAgICRkcm9wZG93bl9jb250ZW50Lmh0bWwodGhpcy5yZW5kZXIoJ29wdGlvbl9jcmVhdGUnLCB7IGlucHV0OiBxdWVyeSB9KSArICRkcm9wZG93bl9jb250ZW50Lmh0bWwoKSk7XG4gICAgICAgICAgICAkY3JlYXRlID0gJCgkZHJvcGRvd25fY29udGVudFswXS5jaGlsZE5vZGVzWzBdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFjdGl2YXRlXG4gICAgICAgIHRoaXMuaGFzT3B0aW9ucyA9IHJlc3VsdHMuaXRlbXMubGVuZ3RoID4gMCB8fCBoYXNfY3JlYXRlX29wdGlvbjtcbiAgICAgICAgaWYgKHRoaXMuaGFzT3B0aW9ucykge1xuICAgICAgICAgICAgaWYgKHJlc3VsdHMuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICRhY3RpdmVfYmVmb3JlID0gYWN0aXZlX2JlZm9yZSAmJiB0aGlzLmdldE9wdGlvbihhY3RpdmVfYmVmb3JlKTtcbiAgICAgICAgICAgICAgICBpZiAoJGFjdGl2ZV9iZWZvcmUgJiYgJGFjdGl2ZV9iZWZvcmUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICRhY3RpdmUgPSAkYWN0aXZlX2JlZm9yZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5tb2RlID09PSAnc2luZ2xlJyAmJiB0aGlzLml0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkYWN0aXZlID0gdGhpcy5nZXRPcHRpb24odGhpcy5pdGVtc1swXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghJGFjdGl2ZSB8fCAhJGFjdGl2ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRjcmVhdGUgJiYgIXRoaXMub3B0aW9ucy5hZGRQcmVjZWRlbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZlID0gdGhpcy5nZXRBZGphY2VudE9wdGlvbigkY3JlYXRlLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRhY3RpdmUgPSAkZHJvcGRvd25fY29udGVudC5maW5kKCdbZGF0YS1zZWxlY3RhYmxlXTpmaXJzdC1jaGlsZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkYWN0aXZlID0gJGNyZWF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlT3B0aW9uKCRhY3RpdmUpO1xuICAgICAgICAgICAgaWYgKHRyaWdnZXJEcm9wZG93biAmJiAhdGhpcy5pc09wZW4pIHsgdGhpcy5vcGVuKCk7IH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlT3B0aW9uKG51bGwpO1xuICAgICAgICAgICAgaWYgKHRyaWdnZXJEcm9wZG93biAmJiB0aGlzLmlzT3BlbikgeyB0aGlzLmNsb3NlKCk7IH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRPcHRpb246IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIHZhbHVlO1xuXG4gICAgICAgIGlmIChpc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGRhdGEubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRPcHRpb24oZGF0YVtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YWx1ZSA9IGhhc2hfa2V5KGRhdGFbdGhpcy5vcHRpb25zLnZhbHVlRmllbGRdKTtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycgfHwgdGhpcy5PcHRpb25zLmhhc093blByb3BlcnR5KHZhbHVlKSkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuVXNlck9wdGlvbnNbdmFsdWVdID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5PcHRpb25zW3ZhbHVlXSA9IGRhdGE7XG4gICAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gbnVsbDtcbiAgICAgICAgdGhpcy5lbWl0KCdvcHRpb25fYWRkJywgdmFsdWUsIGRhdGEpO1xuICAgIH0sXG5cbiAgICByZW1vdmVPcHRpb246IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHZhbHVlID0gaGFzaF9rZXkodmFsdWUpO1xuXG4gICAgICAgIHZhciBjYWNoZV9pdGVtcyA9IHRoaXMucmVuZGVyQ2FjaGVbJ2l0ZW0nXTtcbiAgICAgICAgdmFyIGNhY2hlX29wdGlvbnMgPSB0aGlzLnJlbmRlckNhY2hlWydvcHRpb24nXTtcbiAgICAgICAgaWYgKGNhY2hlX2l0ZW1zKSBkZWxldGUgY2FjaGVfaXRlbXNbdmFsdWVdO1xuICAgICAgICBpZiAoY2FjaGVfb3B0aW9ucykgZGVsZXRlIGNhY2hlX29wdGlvbnNbdmFsdWVdO1xuXG4gICAgICAgIGRlbGV0ZSB0aGlzLlVzZXJPcHRpb25zW3ZhbHVlXTtcbiAgICAgICAgZGVsZXRlIHRoaXMuT3B0aW9uc1t2YWx1ZV07XG4gICAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gbnVsbDtcbiAgICAgICAgdGhpcy5lbWl0KCdvcHRpb25fcmVtb3ZlJywgdmFsdWUpO1xuICAgICAgICB0aGlzLnJlbW92ZUl0ZW0odmFsdWUpO1xuICAgIH0sXG5cbiAgICBzZXRBY3RpdmVPcHRpb246IGZ1bmN0aW9uKCRvcHRpb24sIHNjcm9sbCwgYW5pbWF0ZSkge1xuICAgICAgICB2YXIgaGVpZ2h0X21lbnUsIGhlaWdodF9pdGVtLCB5O1xuICAgICAgICB2YXIgc2Nyb2xsX3RvcCwgc2Nyb2xsX2JvdHRvbTtcblxuICAgICAgICBpZiAodGhpcy4kYWN0aXZlT3B0aW9uKSB0aGlzLiRhY3RpdmVPcHRpb24ucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICB0aGlzLiRhY3RpdmVPcHRpb24gPSBudWxsO1xuXG4gICAgICAgICRvcHRpb24gPSAkKCRvcHRpb24pO1xuICAgICAgICBpZiAoISRvcHRpb24pIHJldHVybjtcblxuICAgICAgICB0aGlzLiRhY3RpdmVPcHRpb24gPSAkb3B0aW9uLmFkZENsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICBpZiAoc2Nyb2xsIHx8ICFpc3NldChzY3JvbGwpKSB7XG5cbiAgICAgICAgICAgIGhlaWdodF9tZW51ID0gdGhpcy4kZHJvcGRvd25fY29udGVudFswXS5vZmZzZXRIZWlnaHQ7XG4gICAgICAgICAgICBoZWlnaHRfaXRlbSA9IHRoaXMuJGFjdGl2ZU9wdGlvblswXS5vZmZzZXRIZWlnaHQ7XG4gICAgICAgICAgICBzY3JvbGwgPSB0aGlzLiRkcm9wZG93bl9jb250ZW50WzBdLnNjcm9sbFRvcCB8fCAwO1xuICAgICAgICAgICAgeSA9IHRoaXMuJGFjdGl2ZU9wdGlvbi5wb3NpdGlvbigpLnRvcCAtIHRoaXMuJGRyb3Bkb3duX2NvbnRlbnQucG9zaXRpb24oKS50b3AgKyBzY3JvbGw7XG4gICAgICAgICAgICBzY3JvbGxfdG9wID0geTtcbiAgICAgICAgICAgIHNjcm9sbF9ib3R0b20gPSB5IC0gaGVpZ2h0X21lbnUgKyBoZWlnaHRfaXRlbTtcblxuICAgICAgICAgICAgaWYgKHkgKyBoZWlnaHRfaXRlbSA+IGhlaWdodF9tZW51ICsgc2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZHJvcGRvd25fY29udGVudFswXS5zY3JvbGxUb3AgPSBzY3JvbGxfYm90dG9tO1xuICAgICAgICAgICAgICAgIC8qbW9vZngoYmluZChmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICAgICAgIHRoaXMuJGRyb3Bkb3duX2NvbnRlbnRbMF0uc2Nyb2xsVG9wID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgIH0sIHRoaXMpLCB7XG4gICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBhbmltYXRlID8gdGhpcy5vcHRpb25zLnNjcm9sbER1cmF0aW9uIDogMCxcbiAgICAgICAgICAgICAgICAgZXF1YXRpb246ICdsaW5lYXInXG4gICAgICAgICAgICAgICAgIH0pLnN0YXJ0KHNjcm9sbCwgc2Nyb2xsX2JvdHRvbSk7Ki9cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoeSA8IHNjcm9sbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJGRyb3Bkb3duX2NvbnRlbnRbMF0uc2Nyb2xsVG9wID0gc2Nyb2xsX3RvcDtcbiAgICAgICAgICAgICAgICAvKm1vb2Z4KGJpbmQoZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgICAgICB0aGlzLiRkcm9wZG93bl9jb250ZW50WzBdLnNjcm9sbFRvcCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICB9LCB0aGlzKSwge1xuICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYW5pbWF0ZSA/IHRoaXMub3B0aW9ucy5zY3JvbGxEdXJhdGlvbiA6IDAsXG4gICAgICAgICAgICAgICAgIGVxdWF0aW9uOiAnbGluZWFyJ1xuICAgICAgICAgICAgICAgICB9KS5zdGFydChzY3JvbGwsIHNjcm9sbF90b3ApOyovXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZWxlY3RBbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1vZGUgPT09ICdzaW5nbGUnKSByZXR1cm47XG5cbiAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy4kY29udHJvbC5jaGlsZHJlbignOm5vdChpbnB1dCknKTtcbiAgICAgICAgaWYgKGl0ZW1zKSB7IGl0ZW1zLmFkZENsYXNzKCdhY3RpdmUnKTsgfVxuICAgICAgICB0aGlzLiRhY3RpdmVJdGVtcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShpdGVtcyB8fCAwKTtcbiAgICAgICAgaWYgKHRoaXMuJGFjdGl2ZUl0ZW1zKSB7XG4gICAgICAgICAgICB0aGlzLmhpZGVJbnB1dCgpO1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICB9LFxuXG4gICAgaGlkZUlucHV0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICB0aGlzLnNldFRleHRib3hWYWx1ZSgnJyk7XG4gICAgICAgIHRoaXMuJGNvbnRyb2xfaW5wdXQuc3R5bGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgbGVmdDogLTEwMDAwXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlzSW5wdXRIaWRkZW4gPSB0cnVlO1xuICAgIH0sXG5cbiAgICBzZWFyY2g6IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgIHZhciBpLCB2YWx1ZSwgc2NvcmUsIHJlc3VsdCwgY2FsY3VsYXRlU2NvcmU7XG4gICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRTZWFyY2hPcHRpb25zKCk7XG5cbiAgICAgICAgLy8gdmFsaWRhdGUgdXNlci1wcm92aWRlZCByZXN1bHQgc2NvcmluZyBmdW5jdGlvblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNjb3JlKSB7XG4gICAgICAgICAgICBjYWxjdWxhdGVTY29yZSA9IHRoaXMub3B0aW9ucy5zY29yZS5hcHBseSh0aGlzLCBbcXVlcnldKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsY3VsYXRlU2NvcmUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlbGVjdGl6ZSBcInNjb3JlXCIgc2V0dGluZyBtdXN0IGJlIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgZnVuY3Rpb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHBlcmZvcm0gc2VhcmNoXG4gICAgICAgIGlmIChxdWVyeSAhPT0gdGhpcy5sYXN0UXVlcnkpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFF1ZXJ5ID0gcXVlcnk7XG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLnNpZnRlci5zZWFyY2gocXVlcnksIG1lcmdlKG9wdGlvbnMsIHsgc2NvcmU6IGNhbGN1bGF0ZVNjb3JlIH0pKTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFJlc3VsdHMgPSByZXN1bHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSBtZXJnZSh7fSwgdGhpcy5jdXJyZW50UmVzdWx0cyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBmaWx0ZXIgb3V0IHNlbGVjdGVkIGl0ZW1zXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGlkZVNlbGVjdGVkKSB7XG4gICAgICAgICAgICBmb3IgKGkgPSByZXN1bHQuaXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pdGVtcy5pbmRleE9mKGhhc2hfa2V5KHJlc3VsdC5pdGVtc1tpXS5pZCkpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQuaXRlbXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIGdldFNlYXJjaE9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc29ydCA9IHRoaXMub3B0aW9ucy5zb3J0RmllbGQ7XG4gICAgICAgIGlmICh0eXBlb2Ygc29ydCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHNvcnQgPSB7IGZpZWxkOiBzb3J0IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRzOiB0aGlzLm9wdGlvbnMuc2VhcmNoRmllbGQsXG4gICAgICAgICAgICBjb25qdW5jdGlvbjogdGhpcy5vcHRpb25zLnNlYXJjaENvbmp1bmN0aW9uLFxuICAgICAgICAgICAgc29ydDogc29ydFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBjYW5DcmVhdGU6IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmNyZWF0ZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICB2YXIgZmlsdGVyID0gdGhpcy5vcHRpb25zLmNyZWF0ZUZpbHRlcjtcbiAgICAgICAgcmV0dXJuIGlucHV0Lmxlbmd0aFxuICAgICAgICAgICAgJiYgKHR5cGVvZiBmaWx0ZXIgIT09ICdmdW5jdGlvbicgfHwgZmlsdGVyLmFwcGx5KHNlbGYsIFtpbnB1dF0pKVxuICAgICAgICAgICAgJiYgKHR5cGVvZiBmaWx0ZXIgIT09ICdzdHJpbmcnIHx8IG5ldyBSZWdFeHAoZmlsdGVyKS50ZXN0KGlucHV0KSlcbiAgICAgICAgICAgICYmICghKGZpbHRlciBpbnN0YW5jZW9mIFJlZ0V4cCkgfHwgZmlsdGVyLnRlc3QoaW5wdXQpKTtcbiAgICB9LFxuXG4gICAgaW5zZXJ0QXRDYXJldDogZnVuY3Rpb24oJGVsKSB7XG4gICAgICAgIHZhciBjYXJldCA9IE1hdGgubWluKHRoaXMuY2FyZXRQb3MsIHRoaXMuaXRlbXMubGVuZ3RoKTtcbiAgICAgICAgaWYgKGNhcmV0ID09PSAwKSB7XG4gICAgICAgICAgICAkZWwudG9wKHRoaXMuJGNvbnRyb2wpOy8vLnByZXBlbmQoJGVsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vJCh0aGlzLiRjb250cm9sWzBdLmNoaWxkTm9kZXNbY2FyZXRdKS5iZWZvcmUoJGVsKTtcbiAgICAgICAgICAgICRlbC5hZnRlcih0aGlzLiRjb250cm9sLmZpbmQoJzpudGgtY2hpbGQoJyArIGNhcmV0ICsgJyknKSk7XG4gICAgICAgICAgICAvL3RoaXMuJGNvbnRyb2wuZmluZCgnOm50aC1jaGlsZCgnICsgY2FyZXQgKyAnKScpLmJlZm9yZSgkZWwpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0Q2FyZXQoY2FyZXQgKyAxKTtcbiAgICB9LFxuXG4gICAgZGVsZXRlU2VsZWN0aW9uOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciBpLCBuLCBkaXJlY3Rpb24sIHNlbGVjdGlvbiwgdmFsdWVzLCBjYXJldCwgb3B0aW9uX3NlbGVjdCwgJG9wdGlvbl9zZWxlY3QsICR0YWlsO1xuXG4gICAgICAgIGRpcmVjdGlvbiA9IChlICYmIGUua2V5Q29kZSA9PT0gS0VZX0JBQ0tTUEFDRSkgPyAtMSA6IDE7XG4gICAgICAgIHNlbGVjdGlvbiA9IGdldFNlbGVjdGlvbih0aGlzLiRjb250cm9sX2lucHV0WzBdKTtcblxuICAgICAgICBpZiAodGhpcy4kYWN0aXZlT3B0aW9uICYmICF0aGlzLm9wdGlvbnMuaGlkZVNlbGVjdGVkKSB7XG4gICAgICAgICAgICBvcHRpb25fc2VsZWN0ID0gdGhpcy5nZXRBZGphY2VudE9wdGlvbih0aGlzLiRhY3RpdmVPcHRpb24sIC0xKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25fc2VsZWN0KSB7IG9wdGlvbl9zZWxlY3QgPSBvcHRpb25fc2VsZWN0LmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpOyB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkZXRlcm1pbmUgaXRlbXMgdGhhdCB3aWxsIGJlIHJlbW92ZWRcbiAgICAgICAgdmFsdWVzID0gW107XG5cbiAgICAgICAgaWYgKHRoaXMuJGFjdGl2ZUl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy4kY29udHJvbC5jaGlsZHJlbignOm5vdChpbnB1dCknKTtcbiAgICAgICAgICAgICR0YWlsID0gdGhpcy4kY29udHJvbC5jaGlsZHJlbignLmFjdGl2ZScpO1xuICAgICAgICAgICAgaWYgKCR0YWlsKSB7ICR0YWlsID0gJChkaXJlY3Rpb24gPiAwID8gbGFzdCgkdGFpbCkgOiAkdGFpbFswXSk7IH1cbiAgICAgICAgICAgIGNhcmV0ID0gKCFjaGlsZHJlbiA/IC0xIDogaW5kZXhPZihjaGlsZHJlbiwgJHRhaWxbMF0pKTtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPiAwKSB7IGNhcmV0Kys7IH1cblxuICAgICAgICAgICAgZm9yIChpID0gMCwgbiA9IHRoaXMuJGFjdGl2ZUl0ZW1zLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKCQodGhpcy4kYWN0aXZlSXRlbXNbaV0pLmF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoKHRoaXMuaXNGb2N1c2VkIHx8IHRoaXMub3B0aW9ucy5tb2RlID09PSAnc2luZ2xlJykgJiYgdGhpcy5pdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPCAwICYmIHNlbGVjdGlvbi5zdGFydCA9PT0gMCAmJiBzZWxlY3Rpb24ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2godGhpcy5pdGVtc1t0aGlzLmNhcmV0UG9zIC0gMV0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPiAwICYmIHNlbGVjdGlvbi5zdGFydCA9PT0gdGhpcy4kY29udHJvbF9pbnB1dC52YWx1ZSgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHRoaXMuaXRlbXNbdGhpcy5jYXJldFBvc10pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWxsb3cgdGhlIGNhbGxiYWNrIHRvIGFib3J0XG4gICAgICAgIGlmICghdmFsdWVzLmxlbmd0aCB8fCAodHlwZW9mIHRoaXMub3B0aW9ucy5vbkRlbGV0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiB0aGlzLm9wdGlvbnMub25EZWxldGUuYXBwbHkodGhpcywgW3ZhbHVlc10pID09PSBmYWxzZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHBlcmZvcm0gcmVtb3ZhbFxuICAgICAgICBpZiAodHlwZW9mIGNhcmV0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zZXRDYXJldChjYXJldCk7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKHZhbHVlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSXRlbSh2YWx1ZXMucG9wKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zaG93SW5wdXQoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbkRyb3Bkb3duKCk7XG4gICAgICAgIHRoaXMucmVmcmVzaE9wdGlvbnModHJ1ZSk7XG5cbiAgICAgICAgLy8gc2VsZWN0IHByZXZpb3VzIG9wdGlvblxuICAgICAgICBpZiAob3B0aW9uX3NlbGVjdCkge1xuICAgICAgICAgICAgJG9wdGlvbl9zZWxlY3QgPSB0aGlzLmdldE9wdGlvbihvcHRpb25fc2VsZWN0KTtcbiAgICAgICAgICAgIGlmICgkb3B0aW9uX3NlbGVjdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZU9wdGlvbigkb3B0aW9uX3NlbGVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgYWR2YW5jZVNlbGVjdGlvbjogZnVuY3Rpb24oZGlyZWN0aW9uLCBlKSB7XG4gICAgICAgIHZhciB0YWlsLCBzZWxlY3Rpb24sIGlkeCwgdmFsdWVMZW5ndGgsIGN1cnNvckF0RWRnZSwgJHRhaWw7XG5cbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gMCkgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5ydGwpIGRpcmVjdGlvbiAqPSAtMTtcblxuICAgICAgICB0YWlsID0gZGlyZWN0aW9uID4gMCA/ICdsYXN0LWNoaWxkJyA6ICdmaXJzdC1jaGlsZCc7XG4gICAgICAgIHNlbGVjdGlvbiA9IGdldFNlbGVjdGlvbih0aGlzLiRjb250cm9sX2lucHV0WzBdKTtcblxuICAgICAgICBpZiAodGhpcy5pc0ZvY3VzZWQgJiYgIXRoaXMuaXNJbnB1dEhpZGRlbikge1xuICAgICAgICAgICAgdmFsdWVMZW5ndGggPSB0aGlzLiRjb250cm9sX2lucHV0LnZhbHVlKCkubGVuZ3RoO1xuICAgICAgICAgICAgY3Vyc29yQXRFZGdlID0gZGlyZWN0aW9uIDwgMFxuICAgICAgICAgICAgICAgID8gc2VsZWN0aW9uLnN0YXJ0ID09PSAwICYmIHNlbGVjdGlvbi5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICA6IHNlbGVjdGlvbi5zdGFydCA9PT0gdmFsdWVMZW5ndGg7XG5cbiAgICAgICAgICAgIGlmIChjdXJzb3JBdEVkZ2UgJiYgIXZhbHVlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZHZhbmNlQ2FyZXQoZGlyZWN0aW9uLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICR0YWlsID0gdGhpcy4kY29udHJvbC5jaGlsZHJlbignLmFjdGl2ZTonICsgdGFpbCk7XG4gICAgICAgICAgICBpZiAoJHRhaWwpIHtcbiAgICAgICAgICAgICAgICBpZHggPSB0aGlzLiRjb250cm9sLmNoaWxkcmVuKCc6bm90KGlucHV0KScpLmluZGV4KCR0YWlsKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0obnVsbCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDYXJldChkaXJlY3Rpb24gPiAwID8gaWR4ICsgMSA6IGlkeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWR2YW5jZUNhcmV0OiBmdW5jdGlvbihkaXJlY3Rpb24sIGUpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLCBmbiwgJGFkajtcblxuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAwKSByZXR1cm47XG5cbiAgICAgICAgZm4gPSBkaXJlY3Rpb24gPiAwID8gJ25leHRTaWJsaW5nJyA6ICdwcmV2aW91c1NpYmxpbmcnO1xuICAgICAgICBpZiAodGhpcy5pc1NoaWZ0RG93bikge1xuICAgICAgICAgICAgJGFkaiA9IHRoaXMuJGNvbnRyb2xfaW5wdXRbZm5dKCk7XG4gICAgICAgICAgICBpZiAoJGFkaikge1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZUlucHV0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtKCRhZGopO1xuICAgICAgICAgICAgICAgIGUgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRDYXJldCh0aGlzLmNhcmV0UG9zICsgZGlyZWN0aW9uKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRDYXJldDogZnVuY3Rpb24oaSkge1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW9kZSA9PT0gJ3NpbmdsZScpIHtcbiAgICAgICAgICAgIGkgPSB0aGlzLml0ZW1zLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih0aGlzLml0ZW1zLmxlbmd0aCwgaSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzUGVuZGluZykge1xuICAgICAgICAgICAgLy8gdGhlIGlucHV0IG11c3QgYmUgbW92ZWQgYnkgbGVhdmluZyBpdCBpbiBwbGFjZSBhbmQgbW92aW5nIHRoZVxuICAgICAgICAgICAgLy8gc2libGluZ3MsIGR1ZSB0byB0aGUgZmFjdCB0aGF0IGZvY3VzIGNhbm5vdCBiZSByZXN0b3JlZCBvbmNlIGxvc3RcbiAgICAgICAgICAgIC8vIG9uIG1vYmlsZSB3ZWJraXQgZGV2aWNlc1xuICAgICAgICAgICAgdmFyIGosIG4sIGZuLCAkY2hpbGRyZW4sICRjaGlsZDtcbiAgICAgICAgICAgICRjaGlsZHJlbiA9IHRoaXMuJGNvbnRyb2wuY2hpbGRyZW4oJzpub3QoaW5wdXQpJyk7XG4gICAgICAgICAgICBmb3IgKGogPSAwLCBuID0gKCRjaGlsZHJlbiA/ICRjaGlsZHJlbi5sZW5ndGggOiAwKTsgaiA8IG47IGorKykge1xuICAgICAgICAgICAgICAgICRjaGlsZCA9ICQoJGNoaWxkcmVuW2pdKTsvLy5kZXRhY2goKTtcbiAgICAgICAgICAgICAgICBpZiAoaiA8IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgJGNoaWxkLmJlZm9yZSh0aGlzLiRjb250cm9sX2lucHV0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250cm9sLmFwcGVuZENoaWxkKCRjaGlsZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jYXJldFBvcyA9IGk7XG4gICAgfSxcblxuICAgIGxvY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIHRoaXMuaXNMb2NrZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnJlZnJlc2hTdGF0ZSgpO1xuICAgIH0sXG5cbiAgICB1bmxvY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzTG9ja2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVmcmVzaFN0YXRlKCk7XG4gICAgfSxcblxuICAgIGRpc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlucHV0LmF0dHJpYnV0ZSgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2NrKCk7XG4gICAgfSxcblxuICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaW5wdXQuYXR0cmlidXRlKCdkaXNhYmxlZCcsIG51bGwpO1xuICAgICAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy51bmxvY2soKTtcbiAgICB9LFxuXG4gICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciByZXZlcnRTZXR0aW5ncyA9IHRoaXMucmV2ZXJ0U2V0dGluZ3M7XG5cbiAgICAgICAgdGhpcy5lbWl0KCdkZXN0cm95Jyk7XG4gICAgICAgIHRoaXMub2ZmKCk7XG4gICAgICAgIHRoaXMuJHdyYXBwZXIucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMuJGRyb3Bkb3duLnJlbW92ZSgpO1xuXG4gICAgICAgIHRoaXMuaW5wdXRcbiAgICAgICAgICAgIC5odG1sKCcnKVxuICAgICAgICAgICAgLmFwcGVuZENoaWxkKHJldmVydFNldHRpbmdzLiRjaGlsZHJlbilcbiAgICAgICAgICAgIC5hdHRyaWJ1dGUoJ3RhYmluZGV4JywgbnVsbClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnc2VsZWN0aXplZCcpXG4gICAgICAgICAgICAuYXR0cmlidXRlKHsgdGFiaW5kZXg6IHJldmVydFNldHRpbmdzLnRhYmluZGV4IH0pXG4gICAgICAgICAgICAuc3R5bGUoeyBkaXNwbGF5OiAnYmxvY2snIH0pO1xuXG4gICAgICAgIC8qJCh3aW5kb3cpLm9mZihldmVudE5TKTtcbiAgICAgICAgICQoZG9jdW1lbnQpLm9mZihldmVudE5TKTtcbiAgICAgICAgICQoZG9jdW1lbnQuYm9keSkub2ZmKGV2ZW50TlMpOyovXG5cbiAgICAgICAgZGVsZXRlIHRoaXMuJGNvbnRyb2xfaW5wdXQuc2VsZWN0aXplR3JvdztcbiAgICAgICAgZGVsZXRlIHRoaXMuaW5wdXQuc2VsZWN0aXplSW5zdGFuY2U7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24odGVtcGxhdGVOYW1lLCBkYXRhKSB7XG4gICAgICAgIHZhciB2YWx1ZSwgaWQsIGxhYmVsO1xuICAgICAgICB2YXIgaHRtbCA9ICcnO1xuICAgICAgICB2YXIgY2FjaGUgPSBmYWxzZTtcbiAgICAgICAgdmFyIHJlZ2V4X3RhZyA9IC9eW1xcdCBdKjwoW2Etel1bYS16MC05XFwtX10qKD86XFw6W2Etel1bYS16MC05XFwtX10qKT8pL2k7XG5cbiAgICAgICAgaWYgKHRlbXBsYXRlTmFtZSA9PT0gJ29wdGlvbicgfHwgdGVtcGxhdGVOYW1lID09PSAnaXRlbScpIHtcbiAgICAgICAgICAgIHZhbHVlID0gaGFzaF9rZXkoZGF0YVt0aGlzLm9wdGlvbnMudmFsdWVGaWVsZF0pO1xuICAgICAgICAgICAgY2FjaGUgPSAhIXZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcHVsbCBtYXJrdXAgZnJvbSBjYWNoZSBpZiBpdCBleGlzdHNcbiAgICAgICAgaWYgKGNhY2hlKSB7XG4gICAgICAgICAgICBpZiAoIWlzc2V0KHRoaXMucmVuZGVyQ2FjaGVbdGVtcGxhdGVOYW1lXSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckNhY2hlW3RlbXBsYXRlTmFtZV0gPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnJlbmRlckNhY2hlW3RlbXBsYXRlTmFtZV0uaGFzT3duUHJvcGVydHkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyQ2FjaGVbdGVtcGxhdGVOYW1lXVt2YWx1ZV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZW5kZXIgbWFya3VwXG4gICAgICAgIGh0bWwgPSB0aGlzLm9wdGlvbnMucmVuZGVyW3RlbXBsYXRlTmFtZV0uYXBwbHkodGhpcywgW2RhdGEsIGVzY2FwZUhUTUxdKTtcblxuICAgICAgICAvLyBhZGQgbWFuZGF0b3J5IGF0dHJpYnV0ZXNcbiAgICAgICAgaWYgKHRlbXBsYXRlTmFtZSA9PT0gJ29wdGlvbicgfHwgdGVtcGxhdGVOYW1lID09PSAnb3B0aW9uX2NyZWF0ZScpIHtcbiAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UocmVnZXhfdGFnLCAnPCQxIGRhdGEtc2VsZWN0YWJsZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ZW1wbGF0ZU5hbWUgPT09ICdvcHRncm91cCcpIHtcbiAgICAgICAgICAgIGlkID0gZGF0YVt0aGlzLm9wdGlvbnMub3B0Z3JvdXBWYWx1ZUZpZWxkXSB8fCAnJztcbiAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UocmVnZXhfdGFnLCAnPCQxIGRhdGEtZ3JvdXA9XCInICsgZXNjYXBlX3JlcGxhY2UoZXNjYXBlSFRNTChpZCkpICsgJ1wiJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRlbXBsYXRlTmFtZSA9PT0gJ29wdGlvbicgfHwgdGVtcGxhdGVOYW1lID09PSAnaXRlbScpIHtcbiAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UocmVnZXhfdGFnLCAnPCQxIGRhdGEtdmFsdWU9XCInICsgZXNjYXBlX3JlcGxhY2UoZXNjYXBlSFRNTCh2YWx1ZSB8fCAnJykpICsgJ1wiJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB1cGRhdGUgY2FjaGVcbiAgICAgICAgaWYgKGNhY2hlKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlckNhY2hlW3RlbXBsYXRlTmFtZV1bdmFsdWVdID0gaHRtbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBodG1sO1xuICAgIH0sXG5cbiAgICBjbGVhckNhY2hlOiBmdW5jdGlvbih0ZW1wbGF0ZU5hbWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wbGF0ZU5hbWUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlckNhY2hlID0ge307XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5yZW5kZXJDYWNoZVt0ZW1wbGF0ZU5hbWVdO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbiQuaW1wbGVtZW50KHtcbiAgICBzZWxlY3RpemU6IGZ1bmN0aW9uKHNldHRpbmdzX3VzZXIpIHtcbiAgICAgICAgc2V0dGluZ3NfdXNlciA9IHNldHRpbmdzX3VzZXIgfHwge307XG4gICAgICAgIHZhciBkZWZhdWx0cyA9IFNlbGVjdGl6ZS5wcm90b3R5cGUub3B0aW9ucyxcbiAgICAgICAgICAgIHNldHRpbmdzID0gbWVyZ2Uoe30sIGRlZmF1bHRzLCBzZXR0aW5nc191c2VyKSxcbiAgICAgICAgICAgIGF0dHJfZGF0YSA9IHNldHRpbmdzLmRhdGFBdHRyLFxuICAgICAgICAgICAgZmllbGRfbGFiZWwgPSBzZXR0aW5ncy5sYWJlbEZpZWxkLFxuICAgICAgICAgICAgZmllbGRfdmFsdWUgPSBzZXR0aW5ncy52YWx1ZUZpZWxkLFxuICAgICAgICAgICAgZmllbGRfb3B0Z3JvdXAgPSBzZXR0aW5ncy5vcHRncm91cEZpZWxkLFxuICAgICAgICAgICAgZmllbGRfb3B0Z3JvdXBfbGFiZWwgPSBzZXR0aW5ncy5vcHRncm91cExhYmVsRmllbGQsXG4gICAgICAgICAgICBmaWVsZF9vcHRncm91cF92YWx1ZSA9IHNldHRpbmdzLm9wdGdyb3VwVmFsdWVGaWVsZDtcblxuICAgICAgICB2YXIgaW5pdF90ZXh0Ym94ID0gZnVuY3Rpb24oaW5wdXQsIHNldHRpbmdzX2VsZW1lbnQpIHtcbiAgICAgICAgICAgIGlucHV0ID0gJChpbnB1dCk7XG4gICAgICAgICAgICB2YXIgaSwgbiwgdmFsdWVzLCBvcHRpb24sIHZhbHVlID0gdHJpbShpbnB1dC52YWx1ZSgpIHx8ICcnKTtcbiAgICAgICAgICAgIGlmICghc2V0dGluZ3MuYWxsb3dFbXB0eU9wdGlvbiAmJiAhdmFsdWUubGVuZ3RoKSByZXR1cm47XG5cbiAgICAgICAgICAgIHZhbHVlcyA9IHZhbHVlLnNwbGl0KHNldHRpbmdzLmRlbGltaXRlcik7XG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBuID0gdmFsdWVzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgIG9wdGlvbiA9IHt9O1xuICAgICAgICAgICAgICAgIG9wdGlvbltmaWVsZF9sYWJlbF0gPSB2YWx1ZXNbaV07XG4gICAgICAgICAgICAgICAgb3B0aW9uW2ZpZWxkX3ZhbHVlXSA9IHZhbHVlc1tpXTtcblxuICAgICAgICAgICAgICAgIHNldHRpbmdzX2VsZW1lbnQuT3B0aW9uc1t2YWx1ZXNbaV1dID0gb3B0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZXR0aW5nc19lbGVtZW50Lml0ZW1zID0gdmFsdWVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0X3NlbGVjdCA9IGZ1bmN0aW9uKGlucHV0LCBzZXR0aW5nc19lbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgaSwgbiwgdGFnTmFtZSwgY2hpbGRyZW4sIG9yZGVyID0gMDtcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0gc2V0dGluZ3NfZWxlbWVudC5PcHRpb25zO1xuXG4gICAgICAgICAgICB2YXIgcmVhZERhdGEgPSBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gYXR0cl9kYXRhICYmIGVsLmF0dHJpYnV0ZShhdHRyX2RhdGEpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycgJiYgZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGFkZE9wdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbiwgZ3JvdXApIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUsIG9wdDtcblxuICAgICAgICAgICAgICAgIG9wdGlvbiA9ICQob3B0aW9uKTtcblxuICAgICAgICAgICAgICAgIHZhbHVlID0gb3B0aW9uLmF0dHJpYnV0ZSgndmFsdWUnKSB8fCAnJztcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlLmxlbmd0aCAmJiAhc2V0dGluZ3MuYWxsb3dFbXB0eU9wdGlvbikgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlIG9wdGlvbiBhbHJlYWR5IGV4aXN0cywgaXQncyBwcm9iYWJseSBiZWVuXG4gICAgICAgICAgICAgICAgLy8gZHVwbGljYXRlZCBpbiBhbm90aGVyIG9wdGdyb3VwLiBpbiB0aGlzIGNhc2UsIHB1c2hcbiAgICAgICAgICAgICAgICAvLyB0aGUgY3VycmVudCBncm91cCB0byB0aGUgXCJvcHRncm91cFwiIHByb3BlcnR5IG9uIHRoZVxuICAgICAgICAgICAgICAgIC8vIGV4aXN0aW5nIG9wdGlvbiBzbyB0aGF0IGl0J3MgcmVuZGVyZWQgaW4gYm90aCBwbGFjZXMuXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuaGFzT3duUHJvcGVydHkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChncm91cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zW3ZhbHVlXS5vcHRncm91cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbdmFsdWVdLm9wdGdyb3VwID0gZ3JvdXA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpc0FycmF5KG9wdGlvbnNbdmFsdWVdLm9wdGdyb3VwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbdmFsdWVdLm9wdGdyb3VwID0gW29wdGlvbnNbdmFsdWVdLm9wdGdyb3VwLCBncm91cF07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbdmFsdWVdLm9wdGdyb3VwLnB1c2goZ3JvdXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBvcHQgPSByZWFkRGF0YShvcHRpb24pIHx8IHt9O1xuICAgICAgICAgICAgICAgIG9wdFtmaWVsZF9sYWJlbF0gPSBvcHRbZmllbGRfbGFiZWxdIHx8IG9wdGlvbi50ZXh0KCk7XG4gICAgICAgICAgICAgICAgb3B0W2ZpZWxkX3ZhbHVlXSA9IG9wdFtmaWVsZF92YWx1ZV0gfHwgdmFsdWU7XG4gICAgICAgICAgICAgICAgb3B0W2ZpZWxkX29wdGdyb3VwXSA9IG9wdFtmaWVsZF9vcHRncm91cF0gfHwgZ3JvdXA7XG5cbiAgICAgICAgICAgICAgICBvcHQuJG9yZGVyID0gKytvcmRlcjtcbiAgICAgICAgICAgICAgICBvcHRpb25zW3ZhbHVlXSA9IG9wdDtcblxuICAgICAgICAgICAgICAgIGlmIChvcHRpb24ubWF0Y2hlcygnOnNlbGVjdGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NfZWxlbWVudC5pdGVtcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgYWRkR3JvdXAgPSBmdW5jdGlvbihvcHRncm91cCkge1xuICAgICAgICAgICAgICAgIHZhciBpLCBuLCBpZCwgb3B0Z3JwLCBvcHRpb25zO1xuXG4gICAgICAgICAgICAgICAgb3B0Z3JvdXAgPSAkKG9wdGdyb3VwKTtcbiAgICAgICAgICAgICAgICBpZCA9IG9wdGdyb3VwLmF0dHJpYnV0ZSgnbGFiZWwnKTtcblxuICAgICAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICAgICAgICBvcHRncnAgPSByZWFkRGF0YShvcHRncm91cCkgfHwge307XG4gICAgICAgICAgICAgICAgICAgIG9wdGdycFtmaWVsZF9vcHRncm91cF9sYWJlbF0gPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgb3B0Z3JwW2ZpZWxkX29wdGdyb3VwX3ZhbHVlXSA9IGlkO1xuICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc19lbGVtZW50Lk9wdGdyb3Vwc1tpZF0gPSBvcHRncnA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGdyb3VwLnNlYXJjaCgnb3B0aW9uJyk7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMCwgbiA9IG9wdGlvbnMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZE9wdGlvbihvcHRpb25zW2ldLCBpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2V0dGluZ3NfZWxlbWVudC5tYXhJdGVtcyA9IGlucHV0LmF0dHJpYnV0ZSgnbXVsdGlwbGUnKSA/IG51bGwgOiAxO1xuXG4gICAgICAgICAgICBjaGlsZHJlbiA9IGlucHV0LmNoaWxkcmVuKCkgfHwgMDtcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIG4gPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0YWdOYW1lID0gY2hpbGRyZW5baV0udGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGlmICh0YWdOYW1lID09PSAnb3B0Z3JvdXAnKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZEdyb3VwKGNoaWxkcmVuW2ldKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhZ05hbWUgPT09ICdvcHRpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZE9wdGlvbihjaGlsZHJlbltpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24oJGlucHV0KSB7XG4gICAgICAgICAgICAkaW5wdXQgPSAkKCRpbnB1dCk7XG4gICAgICAgICAgICBpZiAoJGlucHV0LnNlbGVjdGl6ZUluc3RhbmNlKSByZXR1cm47XG5cbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSxcbiAgICAgICAgICAgICAgICBkYXRhT3B0aW9ucyA9ICRpbnB1dC5kYXRhKCdzZWxlY3RpemUnKSxcbiAgICAgICAgICAgICAgICB0YWdfbmFtZSA9ICRpbnB1dC50YWcoKS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gJGlucHV0LmF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKSB8fCAkaW5wdXQuYXR0cmlidXRlKCdkYXRhLXBsYWNlaG9sZGVyJyk7XG5cbiAgICAgICAgICAgIGlmIChkYXRhT3B0aW9ucykgeyBkYXRhT3B0aW9ucyA9IEpTT04ucGFyc2UoZGF0YU9wdGlvbnMpOyB9XG4gICAgICAgICAgICBzZXR0aW5ncyA9IG1lcmdlKHt9LCBzZXR0aW5ncywgZGF0YU9wdGlvbnMpO1xuXG4gICAgICAgICAgICBpZiAoIXBsYWNlaG9sZGVyICYmICFzZXR0aW5ncy5hbGxvd0VtcHR5T3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNobGRzID0gJGlucHV0LmNoaWxkcmVuKCdvcHRpb25bdmFsdWU9XCJcIl0nKTtcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlciA9IGNobGRzID8gJGlucHV0LmNoaWxkcmVuKCdvcHRpb25bdmFsdWU9XCJcIl0nKS50ZXh0KCkgOiAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzX2VsZW1lbnQgPSB7XG4gICAgICAgICAgICAgICAgJ3BsYWNlaG9sZGVyJzogcGxhY2Vob2xkZXIsXG4gICAgICAgICAgICAgICAgJ09wdGlvbnMnOiB7fSxcbiAgICAgICAgICAgICAgICAnT3B0Z3JvdXBzJzoge30sXG4gICAgICAgICAgICAgICAgJ2l0ZW1zJzogW11cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh0YWdfbmFtZSA9PT0gJ3NlbGVjdCcpIHtcbiAgICAgICAgICAgICAgICBpbml0X3NlbGVjdCgkaW5wdXQsIHNldHRpbmdzX2VsZW1lbnQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbml0X3RleHRib3goJGlucHV0LCBzZXR0aW5nc19lbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaW5zdGFuY2UgPSBuZXcgU2VsZWN0aXplKCRpbnB1dCwgbWVyZ2Uoe30sIGRlZmF1bHRzLCBzZXR0aW5nc19lbGVtZW50LCBzZXR0aW5nc191c2VyLCBkYXRhT3B0aW9ucykpO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGVjdHMgPSAkKCdbZGF0YS1zZWxlY3RpemVdJyk7XG4gICAgaWYgKCFzZWxlY3RzKSB7IHJldHVybjsgfVxuXG4gICAgc2VsZWN0cy5zZWxlY3RpemUoKTtcbn0pO1xuXG5cbm1vZHVsZS5leHBvcnRzID0gU2VsZWN0aXplOyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcHJpbWUgICA9IHJlcXVpcmUoJ3ByaW1lJyksXG4gICAgRW1pdHRlciA9IHJlcXVpcmUoJ3ByaW1lL2VtaXR0ZXInKSxcbiAgICBCb3VuZCAgID0gcmVxdWlyZSgncHJpbWUtdXRpbC9wcmltZS9ib3VuZCcpLFxuICAgIE9wdGlvbnMgPSByZXF1aXJlKCdwcmltZS11dGlsL3ByaW1lL29wdGlvbnMnKSxcbiAgICB6ZW4gICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgJCAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2VsZW1lbnRzLnV0aWxzLmpzJyksXG4gICAgc3RvcmFnZSA9IHJlcXVpcmUoJ3ByaW1lL21hcCcpKCksXG5cbiAgICBiaW5kICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9iaW5kJyksXG4gICAgbWVyZ2UgICA9IHJlcXVpcmUoJ21vdXQvb2JqZWN0L21lcmdlJyk7XG5cbnZhciBUb2FzdGVyID0gbmV3IHByaW1lKHtcbiAgICBtaXhpbjogW0JvdW5kLCBPcHRpb25zXSxcblxuICAgIGluaGVyaXRzOiBFbWl0dGVyLFxuXG4gICAgb3B0aW9uczoge1xuICAgICAgICB0YXBUb0Rpc21pc3M6IHRydWUsXG4gICAgICAgIG5vdGljZUNsYXNzOiAnZy1ub3RpZmljYXRpb25zJyxcbiAgICAgICAgY29udGFpbmVySUQ6ICdnLW5vdGlmaWNhdGlvbnMtY29udGFpbmVyJyxcblxuICAgICAgICB0eXBlczoge1xuICAgICAgICAgICAgYmFzZTogJycsXG4gICAgICAgICAgICBlcnJvcjogJ2ZhLW1pbnVzLWNpcmNsZScsXG4gICAgICAgICAgICBpbmZvOiAnZmEtaW5mby1jaXJjbGUnLFxuICAgICAgICAgICAgc3VjY2VzczogJ2ZhLWNoZWNrLWNpcmNsZScsXG4gICAgICAgICAgICB3YXJuaW5nOiAnZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUnXG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvd0R1cmF0aW9uOiAzMDAsXG4gICAgICAgIHNob3dFcXVhdGlvbjogJ2N1YmljLWJlemllcigwLjAyLCAwLjAxLCAwLjQ3LCAxKScsXG4gICAgICAgIGhpZGVEdXJhdGlvbjogNTAwLFxuICAgICAgICBoaWRlRXF1YXRpb246ICdjdWJpYy1iZXppZXIoMC4wMiwgMC4wMSwgMC40NywgMSknLFxuXG4gICAgICAgIHRpbWVPdXQ6IDI1MDAsIC8vIHRpbWVPdXQgYW5kIGV4dGVuZGVkVGltZW91dCB0byAwID09IHN0aWNreVxuICAgICAgICBleHRlbmRlZFRpbWVvdXQ6IDI1MDAsXG5cbiAgICAgICAgbG9jYXRpb246ICdib3R0b20tcmlnaHQnLFxuXG4gICAgICAgIHRpdGxlQ2xhc3M6ICdnLW5vdGlmaWNhdGlvbnMtdGl0bGUnLFxuICAgICAgICBtZXNzYWdlQ2xhc3M6ICdnLW5vdGlmaWNhdGlvbnMtbWVzc2FnZScsXG4gICAgICAgIGNsb3NlQnV0dG9uOiB0cnVlLFxuXG4gICAgICAgIHRhcmdldDogJyNnNS1jb250YWluZXInLFxuICAgICAgICB0YXJnZXRMb2NhdGlvbjogJ2JvdHRvbScsXG5cbiAgICAgICAgbmV3ZXN0T25Ub3A6IHRydWUsXG4gICAgICAgIHByZXZlbnREdXBsaWNhdGVzOiBmYWxzZSxcbiAgICAgICAgcHJvZ3Jlc3NCYXI6IHRydWVcblxuXG4gICAgICAgIC8qXG4gICAgICAgIG9uU2hvdzogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgb25IaWRkZW46IGZ1bmN0aW9uKCkge30sXG4gICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uKCkge31cbiAgICAgICAgKi9cbiAgICB9LFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuaWQgPSAwO1xuICAgICAgICB0aGlzLnByZXZpb3VzTm90aWNlID0gbnVsbDtcbiAgICAgICAgdGhpcy5tYXAgPSBzdG9yYWdlO1xuICAgIH0sXG5cbiAgICBtZXJnZU9wdGlvbnM6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIG1lcmdlKHRoaXMub3B0aW9ucywgb3B0aW9ucyB8fCB7fSk7XG4gICAgfSxcblxuICAgIGJhc2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSB0aGlzLm1lcmdlT3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5ub3RpZnkobWVyZ2Uob3B0aW9ucywge1xuICAgICAgICAgICAgdGl0bGU6IHRpdGxlIHx8ICcnLFxuICAgICAgICAgICAgdHlwZTogb3B0aW9ucy50eXBlIHx8ICdiYXNlJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VcbiAgICAgICAgfSkpO1xuICAgIH0sXG5cbiAgICBzdWNjZXNzOiBmdW5jdGlvbihtZXNzYWdlLCB0aXRsZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5tZXJnZU9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5KG1lcmdlKG9wdGlvbnMsIHtcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSB8fCAnU3VjY2VzcyEnLFxuICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgICAgICB9KSk7XG4gICAgfSxcblxuICAgIGluZm86IGZ1bmN0aW9uKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSB0aGlzLm1lcmdlT3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5ub3RpZnkobWVyZ2Uob3B0aW9ucywge1xuICAgICAgICAgICAgdGl0bGU6IHRpdGxlIHx8ICdJbmZvJyxcbiAgICAgICAgICAgIHR5cGU6ICdpbmZvJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VcbiAgICAgICAgfSkpO1xuICAgIH0sXG4gICAgd2FybmluZzogZnVuY3Rpb24obWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IHRoaXMubWVyZ2VPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLm5vdGlmeShtZXJnZShvcHRpb25zLCB7XG4gICAgICAgICAgICB0aXRsZTogdGl0bGUgfHwgJ1dhcm5pbmchJyxcbiAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VcbiAgICAgICAgfSkpO1xuICAgIH0sXG5cbiAgICBlcnJvcjogZnVuY3Rpb24obWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IHRoaXMubWVyZ2VPcHRpb25zKG9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLm5vdGlmeShtZXJnZShvcHRpb25zLCB7XG4gICAgICAgICAgICB0aXRsZTogdGl0bGUgfHwgJ0Vycm9yIScsXG4gICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgICAgICB9KSk7XG4gICAgfSxcblxuICAgIG5vdGlmeTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5tZXJnZU9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMucHJldmVudER1cGxpY2F0ZXMgJiYgdGhpcy5wcmV2aW91c05vdGljZSA9PT0gb3B0aW9ucy5tZXNzYWdlKSB7IHJldHVybjsgfVxuXG4gICAgICAgIHRoaXMuaWQrKztcbiAgICAgICAgdGhpcy5wcmV2aW91c05vdGljZSA9IG9wdGlvbnMubWVzc2FnZTtcblxuICAgICAgICB2YXIgY29udGFpbmVyID0gdGhpcy5nZXRDb250YWluZXIob3B0aW9ucywgdHJ1ZSksXG4gICAgICAgICAgICBlbGVtZW50ID0gemVuKCdkaXYnKSwgdGl0bGUgPSB6ZW4oJ2RpdicpLCBtZXNzYWdlID0gemVuKCdkaXYnKSxcbiAgICAgICAgICAgIGljb24gPSB6ZW4oJ2kuZmEnKSxcbiAgICAgICAgICAgIHByb2dyZXNzID0gemVuKCdkaXYuZy1ub3RpZmljYXRpb25zLXByb2dyZXNzJyksIGNsb3NlID0gemVuKCdhLmZhLmZhLWNsb3NlW2hyZWY9XCIjXCJdJyk7XG5cbiAgICAgICAgdGhpcy5tYXAuc2V0KGVsZW1lbnQsIHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICAgICAgaW50ZXJ2YWw6IG51bGwsXG4gICAgICAgICAgICBwcm9ncmVzc0Jhcjoge1xuICAgICAgICAgICAgICAgIGludGVydmFsOiBudWxsLFxuICAgICAgICAgICAgICAgIGhpZGVFVEE6IG51bGwsXG4gICAgICAgICAgICAgICAgbWF4SGlkZVRpbWU6IG51bGxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNwb25zZToge1xuICAgICAgICAgICAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgIHN0YXRlOiAndmlzaWJsZScsXG4gICAgICAgICAgICAgICAgc3RhcnQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9uc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMudGl0bGUpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQodGl0bGUuaHRtbChvcHRpb25zLnRpdGxlKS5hZGRDbGFzcyhvcHRpb25zLnRpdGxlQ2xhc3MpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQobWVzc2FnZS5odG1sKG9wdGlvbnMubWVzc2FnZSkuYWRkQ2xhc3Mob3B0aW9ucy5tZXNzYWdlQ2xhc3MpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLmNsb3NlQnV0dG9uKSB7XG4gICAgICAgICAgICBjbG9zZS50b3AoZWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5wcm9ncmVzc0Jhcikge1xuICAgICAgICAgICAgcHJvZ3Jlc3MudG9wKGVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMudHlwZSAmJiBvcHRpb25zLnRpdGxlKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy50eXBlc1tvcHRpb25zLnR5cGVdKSB7XG4gICAgICAgICAgICAgICAgaWNvbi50b3AodGl0bGUpLmFkZENsYXNzKG9wdGlvbnMudHlwZXNbb3B0aW9ucy50eXBlXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50LnN0eWxlKHsgb3BhY2l0eTogMCB9KTtcbiAgICAgICAgZWxlbWVudFtvcHRpb25zLm5ld2VzdE9uVG9wID8gJ3RvcCcgOiAnYm90dG9tJ10oY29udGFpbmVyKTtcbiAgICAgICAgZWxlbWVudC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCB7XG4gICAgICAgICAgICBkdXJhdGlvbjogb3B0aW9ucy5zaG93RHVyYXRpb24sXG4gICAgICAgICAgICBlcXVhdGlvbjogb3B0aW9ucy5zaG93RXF1YXRpb24sXG4gICAgICAgICAgICBjYWxsYmFjazogb3B0aW9ucy5vblNob3dcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMudGltZU91dCA+IDApIHtcbiAgICAgICAgICAgIHZhciBtYXAgPSB0aGlzLm1hcC5nZXQoZWxlbWVudCk7XG4gICAgICAgICAgICBtYXAuaW50ZXJ2YWwgPSBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSwgdGhpcyksIG9wdGlvbnMudGltZU91dCk7XG4gICAgICAgICAgICBtYXAucHJvZ3Jlc3NCYXIubWF4SGlkZVRpbWUgPSBwYXJzZUZsb2F0KG9wdGlvbnMudGltZU91dCk7XG4gICAgICAgICAgICBtYXAucHJvZ3Jlc3NCYXIuaGlkZUVUQSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgbWFwLnByb2dyZXNzQmFyLm1heEhpZGVUaW1lO1xuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5wcm9ncmVzc0Jhcikge1xuICAgICAgICAgICAgICAgIG1hcC5wcm9ncmVzc0Jhci5pbnRlcnZhbCA9IHNldEludGVydmFsKGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3MoZWxlbWVudCwgcHJvZ3Jlc3MpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpLCAxMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubWFwLnNldChlbGVtZW50LCBtYXApO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHN0aWNrID0gYmluZChmdW5jdGlvbigpIHsgdGhpcy5zdGlja0Fyb3VuZChlbGVtZW50KTsgfSwgdGhpcyksXG4gICAgICAgICAgICBkZWxheSA9IGJpbmQoZnVuY3Rpb24oKSB7IHRoaXMuZGVsYXllZEhpZGUoZWxlbWVudCk7IH0sIHRoaXMpO1xuICAgICAgICBlbGVtZW50Lm9uKCdtb3VzZW92ZXInLCBzdGljayk7XG4gICAgICAgIGVsZW1lbnQub24oJ21vdXNlb3V0JywgZGVsYXkpO1xuXG4gICAgICAgIGlmICghb3B0aW9ucy5vbkNsaWNrICYmIG9wdGlvbnMudGFwVG9EaXNtaXNzKSB7XG4gICAgICAgICAgICBlbGVtZW50Lm9uKCdjbGljaycsIGJpbmQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZignbW91c2VvdmVyJywgc3RpY2spO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQub2ZmKCdtb3VzZW91dCcsIGRlbGF5KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuaGlkZShlbGVtZW50KTtcbiAgICAgICAgICAgIH0sIHRoaXMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLmNsb3NlQnV0dG9uICYmIGNsb3NlKSB7XG4gICAgICAgICAgICBjbG9zZS5vbignY2xpY2snLCBiaW5kKGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vZmYoJ21vdXNlb3ZlcicsIHN0aWNrKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9mZignbW91c2VvdXQnLCBkZWxheSk7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKGVsZW1lbnQsIHRydWUpO1xuICAgICAgICAgICAgfSwgdGhpcykpO1xuICAgICAgICB9XG5cbiAgICB9LFxuXG4gICAgc3RpY2tBcm91bmQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIG1hcCA9IHRoaXMubWFwLmdldChlbGVtZW50KTtcblxuICAgICAgICBjbGVhclRpbWVvdXQobWFwLmludGVydmFsKTtcbiAgICAgICAgbWFwLnByb2dyZXNzQmFyLmhpZGVFVEEgPSAwO1xuICAgICAgICBlbGVtZW50LmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiBtYXAub3B0aW9ucy5zaG93RHVyYXRpb24sXG4gICAgICAgICAgICBlcXVhdGlvbjogbWFwLm9wdGlvbnMuc2hvd0VxdWF0aW9uLFxuICAgICAgICAgICAgY2FsbGJhY2s6IG1hcC5vcHRpb25zLm9uU2hvd1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm1hcC5zZXQoZWxlbWVudCwgbWFwKTtcbiAgICB9LFxuXG4gICAgaGlkZTogZnVuY3Rpb24oZWxlbWVudCwgb3ZlcnJpZGUpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuZmluZCgnOmZvY3VzJykgJiYgIW92ZXJyaWRlKSB7IHJldHVybjsgfVxuXG4gICAgICAgIHZhciBtYXAgPSB0aGlzLm1hcC5nZXQoZWxlbWVudCk7XG5cbiAgICAgICAgY2xlYXJUaW1lb3V0KG1hcC5wcm9ncmVzc0Jhci5pbnRlcnZhbCk7XG5cbiAgICAgICAgdGhpcy5tYXAuc2V0KGVsZW1lbnQsIG1hcCk7XG4gICAgICAgIHJldHVybiBlbGVtZW50LmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiBtYXAub3B0aW9ucy5oaWRlRHVyYXRpb24sXG4gICAgICAgICAgICBlcXVhdGlvbjogbWFwLm9wdGlvbnMuaGlkZUVxdWF0aW9uLFxuICAgICAgICAgICAgY2FsbGJhY2s6IGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgaWYgKG1hcC5vcHRpb25zLm9uSGlkZGVuICYmIG1hcC5yZXNwb25zZS5zdGF0ZSAhPT0gJ2hpZGRlbicpIHsgbWFwLm9wdGlvbnMub25IaWRkZW4oKTsgfVxuICAgICAgICAgICAgICAgIG1hcC5yZXNwb25zZS5zdGF0ZSA9ICdoaWRkZW4nO1xuICAgICAgICAgICAgICAgIG1hcC5yZXNwb25zZS5lbmRUaW1lID0gbmV3IERhdGUoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMubWFwLnNldChlbGVtZW50LCBtYXApO1xuICAgICAgICAgICAgfSwgdGhpcylcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGRlbGF5ZWRIaWRlOiBmdW5jdGlvbihlbGVtZW50LCBvdmVycmlkZSkge1xuICAgICAgICB2YXIgbWFwID0gdGhpcy5tYXAuZ2V0KGVsZW1lbnQpO1xuXG4gICAgICAgIGlmIChtYXAub3B0aW9ucy50aW1lT3V0ID4gMCB8fCBtYXAub3B0aW9ucy5leHRlbmRlZFRpbWVvdXQgPiAwKSB7XG4gICAgICAgICAgICBtYXAuaW50ZXJ2YWwgPSBzZXRUaW1lb3V0KGJpbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSwgdGhpcyksIG1hcC5vcHRpb25zLmV4dGVuZGVkVGltZW91dCk7XG4gICAgICAgICAgICBtYXAucHJvZ3Jlc3NCYXIubWF4SGlkZVRpbWUgPSBwYXJzZUZsb2F0KG1hcC5vcHRpb25zLmV4dGVuZGVkVGltZW91dCk7XG4gICAgICAgICAgICBtYXAucHJvZ3Jlc3NCYXIuaGlkZUVUQSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgbWFwLnByb2dyZXNzQmFyLm1heEhpZGVUaW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tYXAuc2V0KGVsZW1lbnQsIG1hcCk7XG4gICAgfSxcblxuICAgIHVwZGF0ZVByb2dyZXNzOiBmdW5jdGlvbihlbGVtZW50LCBwcm9ncmVzcykge1xuICAgICAgICB2YXIgbWFwID0gdGhpcy5tYXAuZ2V0KGVsZW1lbnQpLFxuICAgICAgICAgICAgcGVyY2VudGFnZSA9ICgobWFwLnByb2dyZXNzQmFyLmhpZGVFVEEgLSAobmV3IERhdGUoKS5nZXRUaW1lKCkpKSAvIG1hcC5wcm9ncmVzc0Jhci5tYXhIaWRlVGltZSkgKiAxMDA7XG5cbiAgICAgICAgdGhpcy5tYXAuc2V0KGVsZW1lbnQsIG1hcCk7XG4gICAgICAgIHByb2dyZXNzLnN0eWxlKHsgd2lkdGg6IHBlcmNlbnRhZ2UgKyAnJScgfSk7XG4gICAgfSxcblxuICAgIGdldENvbnRhaW5lcjogZnVuY3Rpb24ob3B0aW9ucywgY3JlYXRlKSB7XG4gICAgICAgIG9wdGlvbnMgPSB0aGlzLm1lcmdlT3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICB2YXIgY29udGFpbmVyID0gJCgnIycgKyBvcHRpb25zLmNvbnRhaW5lcklEKTtcbiAgICAgICAgaWYgKGNvbnRhaW5lcikgeyByZXR1cm4gY29udGFpbmVyOyB9XG5cbiAgICAgICAgaWYgKGNyZWF0ZSkgeyBjb250YWluZXIgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lcihvcHRpb25zKTsgfVxuXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgfSxcblxuICAgIGNyZWF0ZUNvbnRhaW5lcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5tZXJnZU9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgICAgcmV0dXJuIHplbignZGl2IycgKyBvcHRpb25zLmNvbnRhaW5lcklEICsgJy4nICsgb3B0aW9ucy5sb2NhdGlvbilbb3B0aW9ucy50YXJnZXRMb2NhdGlvbl0ob3B0aW9ucy50YXJnZXQpO1xuICAgIH0sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFlbGVtZW50KSB7IHJldHVybjsgfVxuXG4gICAgICAgIHZhciBtYXAgPSB0aGlzLm1hcC5nZXQoZWxlbWVudCk7XG4gICAgICAgIGlmICghbWFwLmNvbnRhaW5lcikgeyBtYXAuY29udGFpbmVyID0gdGhpcy5nZXRDb250YWluZXIobWFwLm9wdGlvbnMpOyB9XG4gICAgICAgIC8qaWYgKCR0b2FzdEVsZW1lbnQuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSovXG5cbiAgICAgICAgZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgaWYgKCFtYXAuY29udGFpbmVyLmNoaWxkcmVuKCkpIHtcbiAgICAgICAgICAgIG1hcC5jb250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLnByZXZpb3VzTm90aWNlID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubWFwLnNldChlbGVtZW50LCBtYXApO1xuICAgIH1cbn0pO1xuXG52YXIgdG9hc3RlciA9IG5ldyBUb2FzdGVyKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gdG9hc3RlcjsiLCJcInVzZSBzdHJpY3RcIjtcbnZhciByZWFkeSA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgJCA9IHJlcXVpcmUoJ2VsZW1lbnRzJyk7XG5cbnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgdmFyIGhpZGRlbnMsXG4gICAgICAgIGNsaWNrID0gKCdvbnRvdWNoZW5kJyBpbiB3aW5kb3cpID8gJ3RvdWNoZW5kJyA6ICdjbGljayc7XG5cbiAgICAkKCdib2R5JykuZGVsZWdhdGUoY2xpY2ssICcuZW5hYmxlciAudG9nZ2xlJywgZnVuY3Rpb24oZSwgZWxlbWVudCl7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhJyk7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuICAgICAgICBoaWRkZW5zID0gZWxlbWVudC5maW5kKCd+fiBbdHlwZT1oaWRkZW5dJyk7XG5cbiAgICAgICAgaWYgKCFoaWRkZW5zKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaGlkZGVucy52YWx1ZShoaWRkZW5zLnZhbHVlKCkgPT0gJzAnID8gJzEnIDogJzAnKTtcblxuICAgICAgICBoaWRkZW5zLmVtaXQoJ2NoYW5nZScpO1xuICAgICAgICAkKCdib2R5JykuZW1pdCgnY2hhbmdlJywge3RhcmdldDogaGlkZGVuc30pO1xuICAgIH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge307IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBwcmltZSAgICAgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICAkICAgICAgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZWxlbWVudHMudXRpbHMnKSxcbiAgICB6ZW4gICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgZG9tcmVhZHkgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzL2RvbXJlYWR5JyksXG4gICAgc3RvcmFnZSAgICAgICA9IHJlcXVpcmUoJ3ByaW1lL21hcCcpKCksXG4gICAgbW9kYWwgICAgICAgICA9IHJlcXVpcmUoJy4uL3VpJykubW9kYWwsXG5cbiAgICBzaXplICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9jb2xsZWN0aW9uL3NpemUnKSxcbiAgICBtZXJnZSAgICAgICAgID0gcmVxdWlyZSgnbW91dC9vYmplY3QvbWVyZ2UnKSxcbiAgICBndWlkICAgICAgICAgID0gcmVxdWlyZSgnbW91dC9yYW5kb20vZ3VpZCcpLFxuICAgIHRvUXVlcnlTdHJpbmcgPSByZXF1aXJlKCdtb3V0L3F1ZXJ5U3RyaW5nL2VuY29kZScpLFxuICAgIGNvbnRhaW5zICAgICAgPSByZXF1aXJlKCdtb3V0L3N0cmluZy9jb250YWlucycpLFxuXG4gICAgcmVxdWVzdCAgICAgICA9IHJlcXVpcmUoJ2FnZW50JykoKSxcbiAgICBIaXN0b3J5ICAgICAgID0gcmVxdWlyZSgnLi9oaXN0b3J5JyksXG4gICAgZ2V0QWpheFN1ZmZpeCA9IHJlcXVpcmUoJy4vZ2V0LWFqYXgtc3VmZml4JyksXG4gICAgbW0gICAgICAgICAgICA9IHJlcXVpcmUoJy4uL21lbnUnKTtcblxucmVxdWlyZSgnLi4vdWkvcG9wb3ZlcicpO1xuXG52YXIgRVJST1IgPSBmYWxzZTtcblxuSGlzdG9yeS5BZGFwdGVyLmJpbmQod2luZG93LCAnc3RhdGVjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICBpZiAocmVxdWVzdC5ydW5uaW5nKCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB2YXIgYm9keSA9ICQoJ2JvZHknKSxcbiAgICAgICAgU3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlKCksXG4gICAgICAgIFVSSSA9IFN0YXRlLnVybCxcbiAgICAgICAgRGF0YSA9IFN0YXRlLmRhdGEsXG4gICAgICAgIHNpZGViYXIgPSAkKCcjbmF2YmFyJyksXG4gICAgICAgIHBhcmFtcyA9ICcnO1xuXG4gICAgaWYgKHNpemUoRGF0YSkgJiYgRGF0YS5wYXJzZWQgIT09IGZhbHNlICYmIHN0b3JhZ2UuZ2V0KERhdGEudXVpZCkpIHtcbiAgICAgICAgRGF0YSA9IHN0b3JhZ2UuZ2V0KERhdGEudXVpZCk7XG4gICAgfVxuXG4gICAgaWYgKERhdGEuZWxlbWVudCkge1xuICAgICAgICBib2R5LmVtaXQoJ3N0YXRlY2hhbmdlQmVmb3JlJywgeyB0YXJnZXQ6IERhdGEuZWxlbWVudCwgRGF0YTogRGF0YSB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdXJsID0gVVJJLnJlcGxhY2Uod2luZG93LmxvY2F0aW9uLm9yaWdpbiwgJycpO1xuICAgICAgICBEYXRhLmVsZW1lbnQgPSAkKCdbaHJlZj1cIicgKyB1cmwgKyAnXCJdJyk7XG4gICAgfVxuXG4gICAgVVJJID0gVVJJICsgZ2V0QWpheFN1ZmZpeCgpO1xuXG4gICAgaWYgKHNpZGViYXIgJiYgRGF0YS5lbGVtZW50ICYmIERhdGEuZWxlbWVudC5wYXJlbnQoJyNuYXZiYXInKSkge1xuICAgICAgICB2YXIgbGlzID0gc2lkZWJhci5zZWFyY2goJ2xpJyk7XG4gICAgICAgIGxpcy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIERhdGEuZWxlbWVudC5wYXJlbnQoJ2xpJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIH1cblxuICAgIGlmIChEYXRhLnBhcmFtcykge1xuICAgICAgICBwYXJhbXMgPSB0b1F1ZXJ5U3RyaW5nKEpTT04ucGFyc2UoRGF0YS5wYXJhbXMpKTtcbiAgICAgICAgaWYgKGNvbnRhaW5zKFVSSSwgJz8nKSkgeyBwYXJhbXMgPSBwYXJhbXMucmVwbGFjZSgvXlxcPy8sICcmJyk7IH1cbiAgICB9XG5cbiAgICBpZiAoIUVSUk9SKSB7IG1vZGFsLmNsb3NlQWxsKCk7IH1cblxuICAgIHJlcXVlc3QudXJsKFVSSSArIHBhcmFtcykuZGF0YShEYXRhLmV4dHJhcyB8fCB7fSkubWV0aG9kKERhdGEuZXh0cmFzID8gJ3Bvc3QnIDogJ2dldCcpLnNlbmQoZnVuY3Rpb24oZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgIGlmICghcmVzcG9uc2UuYm9keS5zdWNjZXNzKSB7XG4gICAgICAgICAgICBFUlJPUiA9IHRydWU7XG4gICAgICAgICAgICBtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5ib2R5Lmh0bWwgfHwgcmVzcG9uc2UuYm9keSxcbiAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkuaHRtbCkgeyBjb250YWluZXIuc3R5bGUoeyB3aWR0aDogJzkwJScgfSk7IH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgSGlzdG9yeS5iYWNrKCk7XG5cbiAgICAgICAgICAgIGlmIChEYXRhLmVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBEYXRhLmVsZW1lbnQuaGlkZUluZGljYXRvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdGFyZ2V0ID0gRGF0YS5wYXJlbnQgPyBEYXRhLmVsZW1lbnQucGFyZW50KERhdGEucGFyZW50KSA6ICQoRGF0YS50YXJnZXQpLFxuICAgICAgICAgICAgZGVzdGluYXRpb24gPSAodGFyZ2V0IHx8ICQoJ1tkYXRhLWc1LWNvbnRlbnRdJykgfHwgYm9keSk7XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLmJvZHkgJiYgcmVzcG9uc2UuYm9keS5odG1sKSB7XG4gICAgICAgICAgICB2YXIgZmFkZXI7XG4gICAgICAgICAgICBkZXN0aW5hdGlvbi5odG1sKHJlc3BvbnNlLmJvZHkuaHRtbCk7XG4gICAgICAgICAgICBpZiAoZmFkZXIgPSAoZGVzdGluYXRpb24ubWF0Y2hlcygnW2RhdGEtZzUtY29udGVudF0nKSA/IGRlc3RpbmF0aW9uIDogZGVzdGluYXRpb24uZmluZCgnW2RhdGEtZzUtY29udGVudF0nKSkpIHtcbiAgICAgICAgICAgICAgICBmYWRlci5zdHlsZSh7b3BhY2l0eTogMH0pLmFuaW1hdGUoe29wYWNpdHk6IDF9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHsgZGVzdGluYXRpb24uaHRtbChyZXNwb25zZS5ib2R5KTsgfVxuXG4gICAgICAgIGJvZHkuZ2V0UG9wb3ZlcigpLmhpZGVBbGwodHJ1ZSkuZGVzdHJveSgpO1xuXG4gICAgICAgIGlmIChEYXRhLmVsZW1lbnQpIHtcbiAgICAgICAgICAgIGJvZHkuZW1pdCgnc3RhdGVjaGFuZ2VBZnRlcicsIHsgdGFyZ2V0OiBEYXRhLmVsZW1lbnQsIERhdGE6IERhdGEgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZWxlbWVudCA9IChEYXRhLmV2ZW50ICYmIERhdGEuZXZlbnQuYWN0aXZlU3Bpbm5lcikgfHwgRGF0YS5lbGVtZW50O1xuICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudC5oaWRlSW5kaWNhdG9yKCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2VsZWN0cyA9ICQoJ1tkYXRhLXNlbGVjdGl6ZV0nKTtcbiAgICAgICAgaWYgKHNlbGVjdHMpIHsgc2VsZWN0cy5zZWxlY3RpemUoKTsgfVxuICAgICAgICBzZWxlY3RvckNoYW5nZUV2ZW50KCk7XG5cbiAgICAgICAgYm9keS5lbWl0KCdzdGF0ZWNoYW5nZUVuZCcpO1xuICAgIH0pO1xufSk7XG5cbnZhciBzZWxlY3RvckNoYW5nZUV2ZW50ID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc2VsZWN0b3JzID0gJCgnW2RhdGEtc2VsZWN0aXplLWFqYXhpZnldJyk7XG4gICAgaWYgKCFzZWxlY3RvcnMpIHsgcmV0dXJuOyB9XG5cbiAgICBzZWxlY3RvcnMuZm9yRWFjaChmdW5jdGlvbihzZWxlY3Rvcikge1xuICAgICAgICBzZWxlY3RvciA9ICQoc2VsZWN0b3IpO1xuICAgICAgICB2YXIgc2VsZWN0aXplID0gc2VsZWN0b3Iuc2VsZWN0aXplKCkuc2VsZWN0aXplSW5zdGFuY2U7XG4gICAgICAgIGlmICghc2VsZWN0aXplIHx8IHNlbGVjdGl6ZS5IYXNDaGFuZ2VFdmVudCkgeyByZXR1cm47IH1cblxuICAgICAgICBzZWxlY3RpemUub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gc2VsZWN0aXplLmdldFZhbHVlKCksXG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHNlbGVjdGl6ZS5PcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAoIW9wdGlvbnNbdmFsdWVdKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICBzZWxlY3RpemUuaW5wdXRcbiAgICAgICAgICAgICAgICAuZGF0YSgnZzUtYWpheGlmeScsICcnKVxuICAgICAgICAgICAgICAgIC5kYXRhKCdnNS1hamF4aWZ5LXRhcmdldCcsIHNlbGVjdG9yLmRhdGEoJ2c1LWFqYXhpZnktdGFyZ2V0JykgfHwgJ1tkYXRhLWc1LWNvbnRlbnQtd3JhcHBlcl0nKVxuICAgICAgICAgICAgICAgIC5kYXRhKCdnNS1hamF4aWZ5LXRhcmdldC1wYXJlbnQnLCBzZWxlY3Rvci5kYXRhKCdnNS1hamF4aWZ5LXRhcmdldC1wYXJlbnQnKSB8fCBudWxsKVxuICAgICAgICAgICAgICAgIC5kYXRhKCdnNS1hamF4aWZ5LWhyZWYnLCBvcHRpb25zW3ZhbHVlXS51cmwpXG4gICAgICAgICAgICAgICAgLmRhdGEoJ2c1LWFqYXhpZnktcGFyYW1zJywgb3B0aW9uc1t2YWx1ZV0ucGFyYW1zID8gSlNPTi5zdHJpbmdpZnkob3B0aW9uc1t2YWx1ZV0ucGFyYW1zKSA6IG51bGwpO1xuXG5cbiAgICAgICAgICAgIHZhciBhY3RpdmUgPSAkKCcjbmF2YmFyIGxpLmFjdGl2ZScpIHx8ICQoJyNtYWluLWhlYWRlciBsaS5hY3RpdmUnKSB8fCAkKCcjbmF2YmFyIGxpOm50aC1jaGlsZCgyKScpO1xuICAgICAgICAgICAgaWYgKGFjdGl2ZSkgeyBhY3RpdmUuc2hvd0luZGljYXRvcigpOyB9XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS5lbWl0KCdjbGljaycsIHsgdGFyZ2V0OiBzZWxlY3RpemUuaW5wdXQsIGFjdGl2ZVNwaW5uZXI6IGFjdGl2ZSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2VsZWN0aXplLkhhc0NoYW5nZUV2ZW50ID0gdHJ1ZTtcbiAgICB9KTtcbn07XG5cblxuZG9tcmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJvZHkgPSAkKCdib2R5Jyk7XG4gICAgYm9keS5kZWxlZ2F0ZSgnY2xpY2snLCAnW2RhdGEtZzUtYWpheGlmeV0nLCBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMiB8fCBldmVudC5tZXRhS2V5IHx8IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQuYWx0S2V5IHx8IGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBlbGVtZW50LnNob3dJbmRpY2F0b3IoKTtcblxuICAgICAgICB2YXIgZGF0YSA9IGVsZW1lbnQuZGF0YSgnZzUtYWpheGlmeScpLFxuICAgICAgICAgICAgdGFyZ2V0ID0gZWxlbWVudC5kYXRhKCdnNS1hamF4aWZ5LXRhcmdldCcpLFxuICAgICAgICAgICAgcGFyZW50ID0gZWxlbWVudC5kYXRhKCdnNS1hamF4aWZ5LXRhcmdldC1wYXJlbnQnKSxcbiAgICAgICAgICAgIHVybCA9IGVsZW1lbnQuYXR0cmlidXRlKCdocmVmJykgfHwgZWxlbWVudC5kYXRhKCdnNS1hamF4aWZ5LWhyZWYnKSxcbiAgICAgICAgICAgIHBhcmFtcyA9IGVsZW1lbnQuZGF0YSgnZzUtYWpheGlmeS1wYXJhbXMnKSB8fCBmYWxzZSxcbiAgICAgICAgICAgIHRpdGxlID0gZWxlbWVudC5hdHRyaWJ1dGUoJ3RpdGxlJykgfHwgd2luZG93LmRvY3VtZW50LnRpdGxlO1xuXG4gICAgICAgIGRhdGEgPSBkYXRhID8gSlNPTi5wYXJzZShkYXRhKSA6IHsgcGFyc2VkOiBmYWxzZSB9O1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgdmFyIHV1aWQgPSBndWlkKCksIGV4dHJhcztcblxuICAgICAgICAgICAgLy8gVE9ETzogVGhlIG1lbnUgbmVlZHMgdG8gYmUgYWJsZSB0byByZWNlaXZlIFBPU1RcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmRhdGEoJ21tLWlkJykgfHwgZWxlbWVudC5wYXJlbnQoJ1tkYXRhLW1tLWlkXScpKSB7XG4gICAgICAgICAgICAgICAgZXh0cmFzID0ge307XG4gICAgICAgICAgICAgICAgZXh0cmFzLm1lbnV0eXBlID0gJCgnc2VsZWN0Lm1lbnUtc2VsZWN0LXdyYXAnKS52YWx1ZSgpO1xuICAgICAgICAgICAgICAgIGV4dHJhcy5zZXR0aW5ncyA9IEpTT04uc3RyaW5naWZ5KG1tLm1lbnVtYW5hZ2VyLnNldHRpbmdzKTtcbiAgICAgICAgICAgICAgICBleHRyYXMub3JkZXJpbmcgPSBKU09OLnN0cmluZ2lmeShtbS5tZW51bWFuYWdlci5vcmRlcmluZyk7XG4gICAgICAgICAgICAgICAgZXh0cmFzLml0ZW1zID0gSlNPTi5zdHJpbmdpZnkobW0ubWVudW1hbmFnZXIuaXRlbXMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdG9yYWdlLnNldCh1dWlkLCBtZXJnZSh7fSwgZGF0YSwge1xuICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICAgICAgICAgIHBhcmVudDogcGFyZW50LFxuICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgZXh0cmFzOiBleHRyYXMsXG4gICAgICAgICAgICAgICAgZXZlbnQ6IGV2ZW50XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBkYXRhID0geyB1dWlkOiB1dWlkIH07XG4gICAgICAgIH1cblxuICAgICAgICBIaXN0b3J5LnB1c2hTdGF0ZShkYXRhLCB0aXRsZSwgdXJsKTtcblxuICAgICAgICB2YXIgbmF2YmFyLCBhY3RpdmUsIGFjdGl2ZXMgPSAkKCcjbmF2YmFyIC5hY3RpdmUsICNtYWluLWhlYWRlciAuYWN0aXZlJyk7XG5cbiAgICAgICAgaWYgKG5hdmJhciA9IGVsZW1lbnQucGFyZW50KCcjbmF2YmFyLCAjbWFpbi1oZWFkZXInKSkge1xuICAgICAgICAgICAgaWYgKGFjdGl2ZXMpIHsgYWN0aXZlcy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7IH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYWN0aXZlID0gbmF2YmFyLnNlYXJjaCgnLmFjdGl2ZScpO1xuICAgICAgICAgICAgaWYgKGFjdGl2ZSkgeyBhY3RpdmUucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOyB9XG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudCgnbGknKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGF0dGFjaCBjaGFuZ2UgZXZlbnRzIHRvIGNvbmZpZ3VyYXRpb25zIHNlbGVjdG9yXG4gICAgc2VsZWN0b3JDaGFuZ2VFdmVudCgpO1xufSk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSB7fTsiLCJcInVzZSBzdHJpY3RcIjtcbnZhciAkICAgICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKSxcbiAgICBtb29meCAgICAgID0gcmVxdWlyZSgnbW9vZngnKSxcbiAgICBtYXAgICAgICAgID0gcmVxdWlyZSgnbW91dC9hcnJheS9tYXAnKSxcbiAgICBzZXJpZXMgICAgID0gcmVxdWlyZSgnbW91dC9mdW5jdGlvbi9zZXJpZXMnKSxcbiAgICBzbGljayAgICAgID0gcmVxdWlyZSgnc2xpY2snKSxcbiAgICB6ZW4gICAgICAgID0gcmVxdWlyZSgnZWxlbWVudHMvemVuJyksXG4gICAgcHJvZ3Jlc3NlciA9IHJlcXVpcmUoJy4uL3VpL3Byb2dyZXNzZXInKTtcblxudmFyIHdhbGsgPSBmdW5jdGlvbihjb21iaW5hdG9yLCBtZXRob2QpIHtcblxuICAgIHJldHVybiBmdW5jdGlvbihleHByZXNzaW9uKSB7XG4gICAgICAgIHZhciBwYXJ0cyA9IHNsaWNrLnBhcnNlKGV4cHJlc3Npb24gfHwgXCIqXCIpO1xuXG4gICAgICAgIGV4cHJlc3Npb24gPSBtYXAocGFydHMsIGZ1bmN0aW9uKHBhcnQpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21iaW5hdG9yICsgXCIgXCIgKyBwYXJ0O1xuICAgICAgICB9KS5qb2luKCcsICcpO1xuXG4gICAgICAgIHJldHVybiB0aGlzW21ldGhvZF0oZXhwcmVzc2lvbik7XG4gICAgfTtcblxufTtcblxuXG4kLmltcGxlbWVudCh7XG4gICAgc3R5bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbW9vID0gbW9vZngodGhpcyk7XG4gICAgICAgIG1vby5zdHlsZS5hcHBseShtb28sIGFyZ3VtZW50cyk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBhbmltYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG1vbyA9IG1vb2Z4KHRoaXMpO1xuICAgICAgICBtb28uYW5pbWF0ZS5hcHBseShtb28sIGFyZ3VtZW50cyk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBwcm9ncmVzc2VyOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHZhciBpbnN0YW5jZTtcblxuICAgICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSkge1xuICAgICAgICAgICAgaW5zdGFuY2UgPSBub2RlLlByb2dyZXNzZXJJbnN0YW5jZTtcblxuICAgICAgICAgICAgaWYgKCFpbnN0YW5jZSkgeyBpbnN0YW5jZSA9IG5ldyBwcm9ncmVzc2VyKG5vZGUsIG9wdGlvbnMpOyB9XG4gICAgICAgICAgICBlbHNlIHsgaW5zdGFuY2UuY29uc3RydWN0b3Iobm9kZSwgb3B0aW9ucyk7IH1cblxuICAgICAgICAgICAgbm9kZS5Qcm9ncmVzc2VySW5zdGFuY2UgPSBpbnN0YW5jZTtcbiAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGNvbXB1dGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbW9vID0gbW9vZngodGhpcyk7XG4gICAgICAgIHJldHVybiBtb28uY29tcHV0ZS5hcHBseShtb28sIGFyZ3VtZW50cyk7XG4gICAgfSxcblxuICAgIHNob3dJbmRpY2F0b3I6IGZ1bmN0aW9uKGtsYXNzLCBrZWVwSWNvbikge1xuICAgICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSkge1xuICAgICAgICAgICAgbm9kZSA9ICQobm9kZSk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGtsYXNzID09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGtlZXBJY29uID0ga2xhc3M7XG4gICAgICAgICAgICAgICAga2xhc3MgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaWNvbiA9IGtlZXBJY29uID8gZmFsc2UgOiBub2RlLmZpbmQoJ2knKTtcbiAgICAgICAgICAgIG5vZGUuZ0hhZEljb24gPSAhIWljb247XG5cbiAgICAgICAgICAgIGlmICghaWNvbikge1xuICAgICAgICAgICAgICAgIGlmICghbm9kZS5maW5kKCdzcGFuJykgJiYgIW5vZGUuY2hpbGRyZW4oKSkgeyB6ZW4oJ3NwYW4nKS50ZXh0KG5vZGUudGV4dCgpKS50b3Aobm9kZS5lbXB0eSgpKTsgfVxuXG4gICAgICAgICAgICAgICAgaWNvbiA9IHplbignaScpO1xuICAgICAgICAgICAgICAgIGljb24udG9wKG5vZGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIW5vZGUuZ0luZGljYXRvcikgeyBub2RlLmdJbmRpY2F0b3IgPSBpY29uLmF0dHJpYnV0ZSgnY2xhc3MnKSB8fCB0cnVlOyB9XG4gICAgICAgICAgICBpY29uLmF0dHJpYnV0ZSgnY2xhc3MnLCBrbGFzcyB8fCAnZmEgZmEtZncgZmEtc3Bpbi1mYXN0IGZhLXNwaW5uZXInKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGhpZGVJbmRpY2F0b3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSkge1xuICAgICAgICAgICAgbm9kZSA9ICQobm9kZSk7XG4gICAgICAgICAgICBpZiAoIW5vZGUuZ0luZGljYXRvcikgeyByZXR1cm47IH1cblxuICAgICAgICAgICAgdmFyIGljb24gPSBub2RlLmZpbmQoJ2knKTtcblxuICAgICAgICAgICAgaWYgKCFub2RlLmdIYWRJY29uKSB7IGljb24ucmVtb3ZlKCk7IH1cbiAgICAgICAgICAgIGVsc2UgeyBpY29uLmF0dHJpYnV0ZSgnY2xhc3MnLCBub2RlLmdJbmRpY2F0b3IpOyB9XG5cbiAgICAgICAgICAgIG5vZGUuZ0luZGljYXRvciA9IG51bGw7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzbGlkZURvd246IGZ1bmN0aW9uKGFuaW1hdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKHRoaXMuZ1NsaWRlQ29sbGFwc2VkID09PSBmYWxzZSkgeyByZXR1cm47IH1cblxuICAgICAgICB2YXIgZWxlbWVudCAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBzaXplICAgICAgICAgID0gdGhpcy5nZXRSZWFsU2l6ZSgpLFxuICAgICAgICAgICAgY2FsbGJhY2tTdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZ1NsaWRlQ29sbGFwc2VkID0gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FsbGJhY2tFbmQgICA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0cmlidXRlKCdzdHlsZScsIGVsZW1lbnQuZ1NsaWRlU3R5bGUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICBjYWxsYmFjayA9IHR5cGVvZiBhbmltYXRpb24gPT0gJ2Z1bmN0aW9uJyA/IGFuaW1hdGlvbiA6IChjYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9KTtcbiAgICAgICAgY2FsbGJhY2sgPSBzZXJpZXMoY2FsbGJhY2tTdGFydCwgY2FsbGJhY2ssIGNhbGxiYWNrRW5kKTtcblxuICAgICAgICBhbmltYXRpb24gPSB0eXBlb2YgYW5pbWF0aW9uID09ICdzdHJpbmcnID8gYW5pbWF0aW9uIDoge1xuICAgICAgICAgICAgZHVyYXRpb246ICcyNTBtcycsXG4gICAgICAgICAgICBjYWxsYmFjazogY2FsbGJhY2tcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hbmltYXRlKHsgaGVpZ2h0OiBzaXplLmhlaWdodCB9LCBhbmltYXRpb24pO1xuICAgIH0sXG5cbiAgICBzbGlkZVVwOiBmdW5jdGlvbihhbmltYXRpb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0aGlzLmdTbGlkZUNvbGxhcHNlZCA9PT0gdHJ1ZSkgeyByZXR1cm47IH1cblxuICAgICAgICBpZiAodHlwZW9mIHRoaXMuZ1NsaWRlQ29sbGFwc2VkID09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmdTbGlkZVN0eWxlID0gdGhpcy5hdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZWxlbWVudCAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBjYWxsYmFja1N0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5nU2xpZGVDb2xsYXBzZWQgPSB0cnVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICBjYWxsYmFjayA9IHR5cGVvZiBhbmltYXRpb24gPT0gJ2Z1bmN0aW9uJyA/IGFuaW1hdGlvbiA6IChjYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9KTtcbiAgICAgICAgY2FsbGJhY2sgPSBzZXJpZXMoY2FsbGJhY2tTdGFydCwgY2FsbGJhY2spO1xuXG4gICAgICAgIGFuaW1hdGlvbiA9IHR5cGVvZiBhbmltYXRpb24gPT0gJ3N0cmluZycgPyBhbmltYXRpb24gOiB7XG4gICAgICAgICAgICBkdXJhdGlvbjogJzI1MG1zJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnN0eWxlKHsgb3ZlcmZsb3c6ICdoaWRkZW4nIH0pLmFuaW1hdGUoeyBoZWlnaHQ6IDAgfSwgYW5pbWF0aW9uKTtcbiAgICB9LFxuXG4gICAgc2xpZGVUb2dnbGU6IGZ1bmN0aW9uKGFuaW1hdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHNpemUgPSB0aGlzLmdldFJlYWxTaXplKCk7XG4gICAgICAgIHJldHVybiB0aGlzW3NpemUuaGVpZ2h0ICYmICF0aGlzLmdTbGlkZUNvbGxhcHNlZCA/ICdzbGlkZVVwJyA6ICdzbGlkZURvd24nXShhbmltYXRpb24sIGNhbGxiYWNrKTtcbiAgICB9LFxuXG4gICAgZ2V0UmVhbFNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3R5bGUgPSB0aGlzLmF0dHJpYnV0ZSgnc3R5bGUnKSwgc2l6ZTtcbiAgICAgICAgdGhpcy5zdHlsZSh7XG4gICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgICAgICAgICAgIG92ZXJmbG93OiAnaW5oZXJpdCcsXG4gICAgICAgICAgICB0b3A6IC01MDAwMCxcbiAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nLFxuICAgICAgICAgICAgd2lkdGg6ICdhdXRvJ1xuICAgICAgICB9KTtcblxuICAgICAgICBzaXplID0ge1xuICAgICAgICAgICAgd2lkdGg6IHBhcnNlSW50KHRoaXMuY29tcHV0ZSgnd2lkdGgnKSwgMTApLFxuICAgICAgICAgICAgaGVpZ2h0OiBwYXJzZUludCh0aGlzLmNvbXB1dGUoJ2hlaWdodCcpLCAxMClcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmF0dHJpYnV0ZSgnc3R5bGUnLCBzdHlsZSk7XG5cbiAgICAgICAgcmV0dXJuIHNpemU7XG4gICAgfSxcblxuICAgIHNpYmxpbmc6IHdhbGsoJysrJywgJ2ZpbmQnKSxcblxuICAgIHNpYmxpbmdzOiB3YWxrKCd+ficsICdzZWFyY2gnKVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gJDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyICQgICAgID0gcmVxdWlyZSgnZWxlbWVudHMnKTtcblxuJC5pbXBsZW1lbnQoe1xuICAgIGJlbG93dGhlZm9sZDogZnVuY3Rpb24oZXhwcmVzc2lvbiwgdHJlc2hvbGQpIHtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy5zZWFyY2goZXhwcmVzc2lvbik7XG4gICAgICAgIHRyZXNob2xkID0gdHJlc2hvbGQgfHwgMDtcbiAgICAgICAgaWYgKCFlbGVtZW50cykgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgZm9sZCA9IHRoaXMucG9zaXRpb24oKS5oZWlnaHQgKyB0aGlzWzBdLnNjcm9sbFRvcDtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnRzLmZpbHRlcihmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZm9sZCA8PSAkKGVsZW1lbnQpWzBdLm9mZnNldFRvcCAtIHRyZXNob2xkO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWJvdmV0aGV0b3A6IGZ1bmN0aW9uKGV4cHJlc3Npb24sIHRyZXNob2xkKSB7XG4gICAgICAgIHZhciBlbGVtZW50cyA9IHRoaXMuc2VhcmNoKGV4cHJlc3Npb24pO1xuICAgICAgICB0cmVzaG9sZCA9IHRyZXNob2xkIHx8IDA7XG4gICAgICAgIGlmICghZWxlbWVudHMpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgICAgdmFyIHRvcCA9IHRoaXNbMF0uc2Nyb2xsVG9wO1xuICAgICAgICByZXR1cm4gZWxlbWVudHMuZmlsdGVyKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0b3AgPj0gJChlbGVtZW50KVswXS5vZmZzZXRUb3AgKyAkKGVsZW1lbnQpLnBvc2l0aW9uKCkuaGVpZ2h0IC0gdHJlc2hvbGQ7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICByaWdodG9mc2NyZWVuOiBmdW5jdGlvbihleHByZXNzaW9uLCB0cmVzaG9sZCkge1xuICAgICAgICB2YXIgZWxlbWVudHMgPSB0aGlzLnNlYXJjaChleHByZXNzaW9uKTtcbiAgICAgICAgdHJlc2hvbGQgPSB0cmVzaG9sZCB8fCAwO1xuICAgICAgICBpZiAoIWVsZW1lbnRzKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBmb2xkID0gdGhpcy5wb3NpdGlvbigpLndpZHRoICsgdGhpc1swXS5zY3JvbGxMZWZ0O1xuICAgICAgICByZXR1cm4gZWxlbWVudHMuZmlsdGVyKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmb2xkIDw9ICQoZWxlbWVudClbMF0ub2Zmc2V0TGVmdCAtIHRyZXNob2xkO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgbGVmdG9mc2NyZWVuOiBmdW5jdGlvbihleHByZXNzaW9uLCB0cmVzaG9sZCkge1xuICAgICAgICB2YXIgZWxlbWVudHMgPSB0aGlzLnNlYXJjaChleHByZXNzaW9uKTtcbiAgICAgICAgdHJlc2hvbGQgPSB0cmVzaG9sZCB8fCAwO1xuICAgICAgICBpZiAoIWVsZW1lbnRzKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICAgIHZhciBsZWZ0ID0gdGhpc1swXS5zY3JvbGxMZWZ0O1xuICAgICAgICByZXR1cm4gZWxlbWVudHMuZmlsdGVyKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBsZWZ0ID49ICQoZWxlbWVudClbMF0ub2Zmc2V0TGVmdCArICQoZWxlbWVudCkucG9zaXRpb24oKS53aWR0aCAtIHRyZXNob2xkO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgaW52aWV3cG9ydDogZnVuY3Rpb24oZXhwcmVzc2lvbiwgdHJlc2hvbGQpIHtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy5zZWFyY2goZXhwcmVzc2lvbik7XG4gICAgICAgIHRyZXNob2xkID0gdHJlc2hvbGQgfHwgMDtcbiAgICAgICAgaWYgKCFlbGVtZW50cykgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uKCk7XG4gICAgICAgIHJldHVybiBlbGVtZW50cy5maWx0ZXIoZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudFswXS5vZmZzZXRUb3AgKyB0cmVzaG9sZCA+PSB0aGlzWzBdLnNjcm9sbFRvcCAmJlxuICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0ub2Zmc2V0VG9wIC0gdHJlc2hvbGQgPD0gdGhpc1swXS5zY3JvbGxUb3AgKyBwb3NpdGlvbi5oZWlnaHQ7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9ICQ7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBnZXRBamF4U3VmZml4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIEdBTlRSWV9BSkFYX1NVRkZJWDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZ2V0QWpheFN1ZmZpeDsiLCJcInVzZSBzdHJpY3RcIjtcbnZhciB1bmVzY2FwZUh0bWwgPSByZXF1aXJlKCdtb3V0L3N0cmluZy91bmVzY2FwZUh0bWwnKTtcblxudmFyIGdldEFqYXhVUkwgPSBmdW5jdGlvbih2aWV3LCBzZWFyY2gpIHtcbiAgICBpZiAoIXNlYXJjaCkgeyBzZWFyY2ggPSAnJWFqYXglJzsgfVxuICAgIHZhciByZSA9IG5ldyBSZWdFeHAoc2VhcmNoLCAnZycpO1xuXG4gICAgcmV0dXJuIHVuZXNjYXBlSHRtbChHQU5UUllfQUpBWF9VUkwucmVwbGFjZShyZSwgdmlldykpO1xufTtcblxudmFyIGdldENvbmZBamF4VVJMID0gZnVuY3Rpb24odmlldywgc2VhcmNoKSB7XG4gICAgaWYgKCFzZWFyY2gpIHsgc2VhcmNoID0gJyVhamF4JSc7IH1cbiAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHNlYXJjaCwgJ2cnKTtcblxuICAgIHJldHVybiB1bmVzY2FwZUh0bWwoR0FOVFJZX0FKQVhfQ09ORl9VUkwucmVwbGFjZShyZSwgdmlldykpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgZ2xvYmFsOiBnZXRBamF4VVJMLFxuICAgIGNvbmZpZzogZ2V0Q29uZkFqYXhVUkxcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciAkICAgICAgICA9IHJlcXVpcmUoJ2VsZW1lbnRzJyksXG4gICAgZG9tcmVhZHkgPSByZXF1aXJlKCdlbGVtZW50cy9kb21yZWFkeScpO1xuXG4vLyBMb2NhbGlzZSBHbG9iYWxzXG52YXIgSGlzdG9yeSA9IHt9O1xuXG4vLyBDaGVjayBFeGlzdGVuY2VcbmlmICh0eXBlb2YgSGlzdG9yeS5BZGFwdGVyICE9PSAndW5kZWZpbmVkJykge1xuICAgIHRocm93IG5ldyBFcnJvcignSGlzdG9yeS5qcyBBZGFwdGVyIGhhcyBhbHJlYWR5IGJlZW4gbG9hZGVkLi4uJyk7XG59XG5cbi8vIEFkZCB0aGUgQWRhcHRlclxuSGlzdG9yeS5BZGFwdGVyID0ge1xuICAgIC8qKlxuICAgICAqIEhpc3RvcnkuQWRhcHRlci5iaW5kKGVsLGV2ZW50LGNhbGxiYWNrKVxuICAgICAqIEBwYXJhbSB7RWxlbWVudHxzdHJpbmd9IGVsXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50IC0gY3VzdG9tIGFuZCBzdGFuZGFyZCBldmVudHNcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgYmluZDogZnVuY3Rpb24oZWwsIGV2ZW50LCBjYWxsYmFjaykge1xuICAgICAgICAkKGVsKS5vbihldmVudCwgY2FsbGJhY2spO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIaXN0b3J5LkFkYXB0ZXIudHJpZ2dlcihlbCxldmVudClcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnR8c3RyaW5nfSBlbFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudCAtIGN1c3RvbSBhbmQgc3RhbmRhcmQgZXZlbnRzXG4gICAgICogQHBhcmFtIHtPYmplY3Q9fSBleHRyYSAtIGEgb2JqZWN0IG9mIGV4dHJhIGV2ZW50IGRhdGEgKG9wdGlvbmFsKVxuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIHRyaWdnZXI6IGZ1bmN0aW9uKGVsLCBldmVudCwgZXh0cmEpIHtcbiAgICAgICAgJChlbCkuZW1pdChldmVudCwgZXh0cmEpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIaXN0b3J5LkFkYXB0ZXIuZXh0cmFjdEV2ZW50RGF0YShrZXksZXZlbnQsZXh0cmEpXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIGtleSBmb3IgdGhlIGV2ZW50IGRhdGEgdG8gZXh0cmFjdFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudCAtIGN1c3RvbSBhbmQgc3RhbmRhcmQgZXZlbnRzXG4gICAgICovXG4gICAgZXh0cmFjdEV2ZW50RGF0YTogZnVuY3Rpb24oa2V5LCBldmVudCkge1xuICAgICAgICAvLyBNb29Ub29scyBOYXRpdmUgdGhlbiBNb29Ub29scyBDdXN0b21cbiAgICAgICAgcmV0dXJuIChldmVudCAmJiBldmVudC5ldmVudCAmJiBldmVudC5ldmVudFtrZXldKSB8fCAoZXZlbnQgJiYgZXZlbnRba2V5XSkgfHwgdW5kZWZpbmVkO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIaXN0b3J5LkFkYXB0ZXIub25Eb21Mb2FkKGNhbGxiYWNrKVxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBvbkRvbUxvYWQ6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgIGRvbXJlYWR5KGNhbGxiYWNrKTtcbiAgICB9XG59O1xuXG4vLyBUcnkgYW5kIEluaXRpYWxpc2UgSGlzdG9yeVxuaWYgKHR5cGVvZiBIaXN0b3J5LmluaXQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgSGlzdG9yeS5pbml0KCk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gSGlzdG9yeTsiLCJcInVzZSBzdHJpY3RcIjtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBJbml0aWFsaXNlXG5cbi8vIExvY2FsaXNlIEdsb2JhbHNcbnZhclxuICAgIGNvbnNvbGUgICAgICAgID0gd2luZG93LmNvbnNvbGUgfHwgdW5kZWZpbmVkLCAvLyBQcmV2ZW50IGEgSlNMaW50IGNvbXBsYWluXG4gICAgZG9jdW1lbnQgICAgICAgPSB3aW5kb3cuZG9jdW1lbnQsIC8vIE1ha2Ugc3VyZSB3ZSBhcmUgdXNpbmcgdGhlIGNvcnJlY3QgZG9jdW1lbnRcbiAgICBuYXZpZ2F0b3IgICAgICA9IHdpbmRvdy5uYXZpZ2F0b3IsIC8vIE1ha2Ugc3VyZSB3ZSBhcmUgdXNpbmcgdGhlIGNvcnJlY3QgbmF2aWdhdG9yXG4gICAgc2Vzc2lvblN0b3JhZ2UgPSBmYWxzZSwgLy8gc2Vzc2lvblN0b3JhZ2VcbiAgICBzZXRUaW1lb3V0ICAgICA9IHdpbmRvdy5zZXRUaW1lb3V0LFxuICAgIGNsZWFyVGltZW91dCAgID0gd2luZG93LmNsZWFyVGltZW91dCxcbiAgICBzZXRJbnRlcnZhbCAgICA9IHdpbmRvdy5zZXRJbnRlcnZhbCxcbiAgICBjbGVhckludGVydmFsICA9IHdpbmRvdy5jbGVhckludGVydmFsLFxuICAgIEpTT04gICAgICAgICAgID0gd2luZG93LkpTT04sXG4gICAgYWxlcnQgICAgICAgICAgPSB3aW5kb3cuYWxlcnQsXG4gICAgSGlzdG9yeSAgICAgICAgPSB3aW5kb3cuSGlzdG9yeSA9IHJlcXVpcmUoJy4vaGlzdG9yeS1hZGFwdGVyJykgfHwge30sIC8vIFB1YmxpYyBIaXN0b3J5IE9iamVjdFxuICAgIGhpc3RvcnkgICAgICAgID0gd2luZG93Lmhpc3Rvcnk7IC8vIE9sZCBIaXN0b3J5IE9iamVjdFxuXG50cnkge1xuICAgIHNlc3Npb25TdG9yYWdlID0gd2luZG93LnNlc3Npb25TdG9yYWdlOyAvLyBUaGlzIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uIGluIHNvbWUgYnJvd3NlcnMgd2hlbiBjb29raWVzL2xvY2FsU3RvcmFnZSBhcmUgZXhwbGljaXRseSBkaXNhYmxlZCAoaS5lLiBDaHJvbWUpXG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnVEVTVCcsICcxJyk7XG4gICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnVEVTVCcpO1xufSBjYXRjaCAoZSkge1xuICAgIHNlc3Npb25TdG9yYWdlID0gZmFsc2U7XG59XG5cbi8vIE1vb1Rvb2xzIENvbXBhdGliaWxpdHlcbkpTT04uc3RyaW5naWZ5ID0gSlNPTi5zdHJpbmdpZnkgfHwgSlNPTi5lbmNvZGU7XG5KU09OLnBhcnNlID0gSlNPTi5wYXJzZSB8fCBKU09OLmRlY29kZTtcblxuLy8gQ2hlY2sgRXhpc3RlbmNlXG5pZiAodHlwZW9mIEhpc3RvcnkuaW5pdCA9PT0gJ3VuZGVmaW5lZCcpIHtcblxuICAgIC8vIEluaXRpYWxpc2UgSGlzdG9yeVxuICAgIEhpc3RvcnkuaW5pdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIC8vIENoZWNrIExvYWQgU3RhdHVzIG9mIEFkYXB0ZXJcbiAgICAgICAgaWYgKHR5cGVvZiBIaXN0b3J5LkFkYXB0ZXIgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBMb2FkIFN0YXR1cyBvZiBDb3JlXG4gICAgICAgIGlmICh0eXBlb2YgSGlzdG9yeS5pbml0Q29yZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIEhpc3RvcnkuaW5pdENvcmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIExvYWQgU3RhdHVzIG9mIEhUTUw0IFN1cHBvcnRcbiAgICAgICAgaWYgKHR5cGVvZiBIaXN0b3J5LmluaXRIdG1sNCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIEhpc3RvcnkuaW5pdEh0bWw0KCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXR1cm4gdHJ1ZVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBJbml0aWFsaXNlIENvcmVcblxuICAgIC8vIEluaXRpYWxpc2UgQ29yZVxuICAgIEhpc3RvcnkuaW5pdENvcmUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAvLyBJbml0aWFsaXNlXG4gICAgICAgIGlmICh0eXBlb2YgSGlzdG9yeS5pbml0Q29yZS5pbml0aWFsaXplZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIC8vIEFscmVhZHkgTG9hZGVkXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBIaXN0b3J5LmluaXRDb3JlLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gT3B0aW9uc1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm9wdGlvbnNcbiAgICAgICAgICogQ29uZmlndXJhYmxlIG9wdGlvbnNcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkub3B0aW9ucyA9IEhpc3Rvcnkub3B0aW9ucyB8fCB7fTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5vcHRpb25zLmhhc2hDaGFuZ2VJbnRlcnZhbFxuICAgICAgICAgKiBIb3cgbG9uZyBzaG91bGQgdGhlIGludGVydmFsIGJlIGJlZm9yZSBoYXNoY2hhbmdlIGNoZWNrc1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5vcHRpb25zLmhhc2hDaGFuZ2VJbnRlcnZhbCA9IEhpc3Rvcnkub3B0aW9ucy5oYXNoQ2hhbmdlSW50ZXJ2YWwgfHwgMTAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm9wdGlvbnMuc2FmYXJpUG9sbEludGVydmFsXG4gICAgICAgICAqIEhvdyBsb25nIHNob3VsZCB0aGUgaW50ZXJ2YWwgYmUgYmVmb3JlIHNhZmFyaSBwb2xsIGNoZWNrc1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5vcHRpb25zLnNhZmFyaVBvbGxJbnRlcnZhbCA9IEhpc3Rvcnkub3B0aW9ucy5zYWZhcmlQb2xsSW50ZXJ2YWwgfHwgNTAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm9wdGlvbnMuZG91YmxlQ2hlY2tJbnRlcnZhbFxuICAgICAgICAgKiBIb3cgbG9uZyBzaG91bGQgdGhlIGludGVydmFsIGJlIGJlZm9yZSB3ZSBwZXJmb3JtIGEgZG91YmxlIGNoZWNrXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm9wdGlvbnMuZG91YmxlQ2hlY2tJbnRlcnZhbCA9IEhpc3Rvcnkub3B0aW9ucy5kb3VibGVDaGVja0ludGVydmFsIHx8IDUwMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5vcHRpb25zLmRpc2FibGVTdWlkXG4gICAgICAgICAqIEZvcmNlIEhpc3Rvcnkgbm90IHRvIGFwcGVuZCBzdWlkXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm9wdGlvbnMuZGlzYWJsZVN1aWQgPSBIaXN0b3J5Lm9wdGlvbnMuZGlzYWJsZVN1aWQgfHwgZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkub3B0aW9ucy5zdG9yZUludGVydmFsXG4gICAgICAgICAqIEhvdyBsb25nIHNob3VsZCB3ZSB3YWl0IGJldHdlZW4gc3RvcmUgY2FsbHNcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkub3B0aW9ucy5zdG9yZUludGVydmFsID0gSGlzdG9yeS5vcHRpb25zLnN0b3JlSW50ZXJ2YWwgfHwgMTAwMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5vcHRpb25zLmJ1c3lEZWxheVxuICAgICAgICAgKiBIb3cgbG9uZyBzaG91bGQgd2Ugd2FpdCBiZXR3ZWVuIGJ1c3kgZXZlbnRzXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm9wdGlvbnMuYnVzeURlbGF5ID0gSGlzdG9yeS5vcHRpb25zLmJ1c3lEZWxheSB8fCAyNTA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkub3B0aW9ucy5kZWJ1Z1xuICAgICAgICAgKiBJZiB0cnVlIHdpbGwgZW5hYmxlIGRlYnVnIG1lc3NhZ2VzIHRvIGJlIGxvZ2dlZFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5vcHRpb25zLmRlYnVnID0gSGlzdG9yeS5vcHRpb25zLmRlYnVnIHx8IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm9wdGlvbnMuaW5pdGlhbFRpdGxlXG4gICAgICAgICAqIFdoYXQgaXMgdGhlIHRpdGxlIG9mIHRoZSBpbml0aWFsIHN0YXRlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm9wdGlvbnMuaW5pdGlhbFRpdGxlID0gSGlzdG9yeS5vcHRpb25zLmluaXRpYWxUaXRsZSB8fCBkb2N1bWVudC50aXRsZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5vcHRpb25zLmh0bWw0TW9kZVxuICAgICAgICAgKiBJZiB0cnVlLCB3aWxsIGZvcmNlIEhUTWw0IG1vZGUgKGhhc2h0YWdzKVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5vcHRpb25zLmh0bWw0TW9kZSA9IEhpc3Rvcnkub3B0aW9ucy5odG1sNE1vZGUgfHwgZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkub3B0aW9ucy5kZWxheUluaXRcbiAgICAgICAgICogV2FudCB0byBvdmVycmlkZSBkZWZhdWx0IG9wdGlvbnMgYW5kIGNhbGwgaW5pdCBtYW51YWxseS5cbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkub3B0aW9ucy5kZWxheUluaXQgPSBIaXN0b3J5Lm9wdGlvbnMuZGVsYXlJbml0IHx8IGZhbHNlO1xuXG5cbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gSW50ZXJ2YWwgcmVjb3JkXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuaW50ZXJ2YWxMaXN0XG4gICAgICAgICAqIExpc3Qgb2YgaW50ZXJ2YWxzIHNldCwgdG8gYmUgY2xlYXJlZCB3aGVuIGRvY3VtZW50IGlzIHVubG9hZGVkLlxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5pbnRlcnZhbExpc3QgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5jbGVhckFsbEludGVydmFsc1xuICAgICAgICAgKiBDbGVhcnMgYWxsIHNldEludGVydmFsIGluc3RhbmNlcy5cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuY2xlYXJBbGxJbnRlcnZhbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaSwgaWwgPSBIaXN0b3J5LmludGVydmFsTGlzdDtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaWwgIT09IFwidW5kZWZpbmVkXCIgJiYgaWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWwubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbFtpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIEhpc3RvcnkuaW50ZXJ2YWxMaXN0ID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIERlYnVnXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZGVidWcobWVzc2FnZSwuLi4pXG4gICAgICAgICAqIExvZ3MgdGhlIHBhc3NlZCBhcmd1bWVudHMgaWYgZGVidWcgZW5hYmxlZFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5kZWJ1ZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgoSGlzdG9yeS5vcHRpb25zLmRlYnVnIHx8IGZhbHNlKSkge1xuICAgICAgICAgICAgICAgIEhpc3RvcnkubG9nLmFwcGx5KEhpc3RvcnksIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkubG9nKG1lc3NhZ2UsLi4uKVxuICAgICAgICAgKiBMb2dzIHRoZSBwYXNzZWQgYXJndW1lbnRzXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIGNvbnNvbGVFeGlzdHMgPSAhKHR5cGVvZiBjb25zb2xlID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgY29uc29sZS5sb2cgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBjb25zb2xlLmxvZy5hcHBseSA9PT0gJ3VuZGVmaW5lZCcpLFxuICAgICAgICAgICAgICAgIHRleHRhcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZycpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgaSwgbixcbiAgICAgICAgICAgICAgICBhcmdzLCBhcmdcbiAgICAgICAgICAgICAgICA7XG5cbiAgICAgICAgICAgIC8vIFdyaXRlIHRvIENvbnNvbGVcbiAgICAgICAgICAgIGlmIChjb25zb2xlRXhpc3RzKSB7XG4gICAgICAgICAgICAgICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IGFyZ3Muc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUuZGVidWcgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcuYXBwbHkoY29uc29sZSwgW21lc3NhZ2UsIGFyZ3NdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIFttZXNzYWdlLCBhcmdzXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IChcIlxcblwiICsgYXJndW1lbnRzWzBdICsgXCJcXG5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFdyaXRlIHRvIGxvZ1xuICAgICAgICAgICAgZm9yIChpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyArK2kpIHtcbiAgICAgICAgICAgICAgICBhcmcgPSBhcmd1bWVudHNbaV07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmcgPT09ICdvYmplY3QnICYmIHR5cGVvZiBKU09OICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJnID0gSlNPTi5zdHJpbmdpZnkoYXJnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWN1cnNpdmUgT2JqZWN0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbWVzc2FnZSArPSBcIlxcblwiICsgYXJnICsgXCJcXG5cIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVGV4dGFyZWFcbiAgICAgICAgICAgIGlmICh0ZXh0YXJlYSkge1xuICAgICAgICAgICAgICAgIHRleHRhcmVhLnZhbHVlICs9IG1lc3NhZ2UgKyBcIlxcbi0tLS0tXFxuXCI7XG4gICAgICAgICAgICAgICAgdGV4dGFyZWEuc2Nyb2xsVG9wID0gdGV4dGFyZWEuc2Nyb2xsSGVpZ2h0IC0gdGV4dGFyZWEuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTm8gVGV4dGFyZWEsIE5vIENvbnNvbGVcbiAgICAgICAgICAgIGVsc2UgaWYgKCFjb25zb2xlRXhpc3RzKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVybiB0cnVlXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEVtdWxhdGVkIFN0YXR1c1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldEludGVybmV0RXhwbG9yZXJNYWpvclZlcnNpb24oKVxuICAgICAgICAgKiBHZXQncyB0aGUgbWFqb3IgdmVyc2lvbiBvZiBJbnRlcm5ldCBFeHBsb3JlclxuICAgICAgICAgKiBAcmV0dXJuIHtpbnRlZ2VyfVxuICAgICAgICAgKiBAbGljZW5zZSBQdWJsaWMgRG9tYWluXG4gICAgICAgICAqIEBhdXRob3IgQmVuamFtaW4gQXJ0aHVyIEx1cHRvbiA8Y29udGFjdEBiYWx1cHRvbi5jb20+XG4gICAgICAgICAqIEBhdXRob3IgSmFtZXMgUGFkb2xzZXkgPGh0dHBzOi8vZ2lzdC5naXRodWIuY29tLzUyNzY4Mz5cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0SW50ZXJuZXRFeHBsb3Jlck1ham9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBIaXN0b3J5LmdldEludGVybmV0RXhwbG9yZXJNYWpvclZlcnNpb24uY2FjaGVkID1cbiAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiBIaXN0b3J5LmdldEludGVybmV0RXhwbG9yZXJNYWpvclZlcnNpb24uY2FjaGVkICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgID8gSGlzdG9yeS5nZXRJbnRlcm5ldEV4cGxvcmVyTWFqb3JWZXJzaW9uLmNhY2hlZFxuICAgICAgICAgICAgICAgICAgICAgICAgOiAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbCA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChkaXYuaW5uZXJIVE1MID0gJzwhLS1baWYgZ3QgSUUgJyArICgrK3YpICsgJ10+PGk+PC9pPjwhW2VuZGlmXS0tPicpICYmIGFsbFswXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh2ID4gNCkgPyB2IDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pKClcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmlzSW50ZXJuZXRFeHBsb3JlcigpXG4gICAgICAgICAqIEFyZSB3ZSB1c2luZyBJbnRlcm5ldCBFeHBsb3Jlcj9cbiAgICAgICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgICAgICogQGxpY2Vuc2UgUHVibGljIERvbWFpblxuICAgICAgICAgKiBAYXV0aG9yIEJlbmphbWluIEFydGh1ciBMdXB0b24gPGNvbnRhY3RAYmFsdXB0b24uY29tPlxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5pc0ludGVybmV0RXhwbG9yZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID1cbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5pc0ludGVybmV0RXhwbG9yZXIuY2FjaGVkID1cbiAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlb2YgSGlzdG9yeS5pc0ludGVybmV0RXhwbG9yZXIuY2FjaGVkICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IEhpc3RvcnkuaXNJbnRlcm5ldEV4cGxvcmVyLmNhY2hlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogQm9vbGVhbihIaXN0b3J5LmdldEludGVybmV0RXhwbG9yZXJNYWpvclZlcnNpb24oKSlcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmVtdWxhdGVkXG4gICAgICAgICAqIFdoaWNoIGZlYXR1cmVzIHJlcXVpcmUgZW11bGF0aW5nP1xuICAgICAgICAgKi9cblxuICAgICAgICBpZiAoSGlzdG9yeS5vcHRpb25zLmh0bWw0TW9kZSkge1xuICAgICAgICAgICAgSGlzdG9yeS5lbXVsYXRlZCA9IHtcbiAgICAgICAgICAgICAgICBwdXNoU3RhdGU6IHRydWUsXG4gICAgICAgICAgICAgICAgaGFzaENoYW5nZTogdHJ1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICBIaXN0b3J5LmVtdWxhdGVkID0ge1xuICAgICAgICAgICAgICAgIHB1c2hTdGF0ZTogIUJvb2xlYW4oXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5ICYmIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSAmJiB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGVcbiAgICAgICAgICAgICAgICAgICAgJiYgIShcbiAgICAgICAgICAgICAgICAgICAgKC8gTW9iaWxlXFwvKFsxLTddW2Etel18KDgoW2FiY2RlXXxmKDFbMC04XSkpKSkvaSkudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAvKiBkaXNhYmxlIGZvciB2ZXJzaW9ucyBvZiBpT1MgYmVmb3JlIHZlcnNpb24gNC4zICg4RjE5MCkgKi9cbiAgICAgICAgICAgICAgICAgICAgfHwgKC9BcHBsZVdlYktpdFxcLzUoWzAtMl18M1swLTJdKS9pKS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpIC8qIGRpc2FibGUgZm9yIHRoZSBtZXJjdXJ5IGlPUyBicm93c2VyLCBvciBhdCBsZWFzdCBvbGRlciB2ZXJzaW9ucyBvZiB0aGUgd2Via2l0IGVuZ2luZSAqL1xuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBoYXNoQ2hhbmdlOiBCb29sZWFuKFxuICAgICAgICAgICAgICAgICAgICAhKCgnb25oYXNoY2hhbmdlJyBpbiB3aW5kb3cpIHx8ICgnb25oYXNoY2hhbmdlJyBpbiBkb2N1bWVudCkpXG4gICAgICAgICAgICAgICAgICAgIHx8XG4gICAgICAgICAgICAgICAgICAgIChIaXN0b3J5LmlzSW50ZXJuZXRFeHBsb3JlcigpICYmIEhpc3RvcnkuZ2V0SW50ZXJuZXRFeHBsb3Jlck1ham9yVmVyc2lvbigpIDwgOClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZW5hYmxlZFxuICAgICAgICAgKiBJcyBIaXN0b3J5IGVuYWJsZWQ/XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmVuYWJsZWQgPSAhSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuYnVnc1xuICAgICAgICAgKiBXaGljaCBidWdzIGFyZSBwcmVzZW50XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmJ1Z3MgPSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFNhZmFyaSA1IGFuZCBTYWZhcmkgaU9TIDQgZmFpbCB0byByZXR1cm4gdG8gdGhlIGNvcnJlY3Qgc3RhdGUgb25jZSBhIGhhc2ggaXMgcmVwbGFjZWQgYnkgYSBgcmVwbGFjZVN0YXRlYCBjYWxsXG4gICAgICAgICAgICAgKiBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NTYyNDlcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgc2V0SGFzaDogQm9vbGVhbighSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGUgJiYgbmF2aWdhdG9yLnZlbmRvciA9PT0gJ0FwcGxlIENvbXB1dGVyLCBJbmMuJyAmJiAvQXBwbGVXZWJLaXRcXC81KFswLTJdfDNbMC0zXSkvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpLFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFNhZmFyaSA1IGFuZCBTYWZhcmkgaU9TIDQgc29tZXRpbWVzIGZhaWwgdG8gYXBwbHkgdGhlIHN0YXRlIGNoYW5nZSB1bmRlciBidXN5IGNvbmRpdGlvbnNcbiAgICAgICAgICAgICAqIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD00Mjk0MFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBzYWZhcmlQb2xsOiBCb29sZWFuKCFIaXN0b3J5LmVtdWxhdGVkLnB1c2hTdGF0ZSAmJiBuYXZpZ2F0b3IudmVuZG9yID09PSAnQXBwbGUgQ29tcHV0ZXIsIEluYy4nICYmIC9BcHBsZVdlYktpdFxcLzUoWzAtMl18M1swLTNdKS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSksXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTVNJRSA2IGFuZCA3IHNvbWV0aW1lcyBkbyBub3QgYXBwbHkgYSBoYXNoIGV2ZW4gaXQgd2FzIHRvbGQgdG8gKHJlcXVpcmluZyBhIHNlY29uZCBjYWxsIHRvIHRoZSBhcHBseSBmdW5jdGlvbilcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWVEb3VibGVDaGVjazogQm9vbGVhbihIaXN0b3J5LmlzSW50ZXJuZXRFeHBsb3JlcigpICYmIEhpc3RvcnkuZ2V0SW50ZXJuZXRFeHBsb3Jlck1ham9yVmVyc2lvbigpIDwgOCksXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTVNJRSA2IHJlcXVpcmVzIHRoZSBlbnRpcmUgaGFzaCB0byBiZSBlbmNvZGVkIGZvciB0aGUgaGFzaGVzIHRvIHRyaWdnZXIgdGhlIG9uSGFzaENoYW5nZSBldmVudFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBoYXNoRXNjYXBlOiBCb29sZWFuKEhpc3RvcnkuaXNJbnRlcm5ldEV4cGxvcmVyKCkgJiYgSGlzdG9yeS5nZXRJbnRlcm5ldEV4cGxvcmVyTWFqb3JWZXJzaW9uKCkgPCA3KVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmlzRW1wdHlPYmplY3Qob2JqKVxuICAgICAgICAgKiBDaGVja3MgdG8gc2VlIGlmIHRoZSBPYmplY3QgaXMgRW1wdHlcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9ialxuICAgICAgICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5pc0VtcHR5T2JqZWN0ID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBvYmopIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5jbG9uZU9iamVjdChvYmopXG4gICAgICAgICAqIENsb25lcyBhIG9iamVjdCBhbmQgZWxpbWluYXRlIGFsbCByZWZlcmVuY2VzIHRvIHRoZSBvcmlnaW5hbCBjb250ZXh0c1xuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqXG4gICAgICAgICAqIEByZXR1cm4ge09iamVjdH1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuY2xvbmVPYmplY3QgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICB2YXIgaGFzaCwgbmV3T2JqO1xuICAgICAgICAgICAgaWYgKG9iaikge1xuICAgICAgICAgICAgICAgIGhhc2ggPSBKU09OLnN0cmluZ2lmeShvYmopO1xuICAgICAgICAgICAgICAgIG5ld09iaiA9IEpTT04ucGFyc2UoaGFzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdPYmogPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXdPYmo7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBVUkwgSGVscGVyc1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldFJvb3RVcmwoKVxuICAgICAgICAgKiBUdXJucyBcImh0dHA6Ly9teXNpdGUuY29tL2Rpci9wYWdlLmh0bWw/YXNkXCIgaW50byBcImh0dHA6Ly9teXNpdGUuY29tXCJcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSByb290VXJsXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldFJvb3RVcmwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBDcmVhdGVcbiAgICAgICAgICAgIHZhciByb290VXJsID0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgKGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lIHx8IGRvY3VtZW50LmxvY2F0aW9uLmhvc3QpO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmxvY2F0aW9uLnBvcnQgfHwgZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByb290VXJsICs9ICc6JyArIGRvY3VtZW50LmxvY2F0aW9uLnBvcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByb290VXJsICs9ICcvJztcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gcm9vdFVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRCYXNlSHJlZigpXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGBocmVmYCBhdHRyaWJ1dGUgb2YgdGhlIGA8YmFzZSBocmVmPVwiLi4uXCI+YCBlbGVtZW50IGlmIGl0IGV4aXN0c1xuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGJhc2VIcmVmXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldEJhc2VIcmVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gQ3JlYXRlXG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBiYXNlRWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYmFzZScpLFxuICAgICAgICAgICAgICAgIGJhc2VFbGVtZW50ID0gbnVsbCxcbiAgICAgICAgICAgICAgICBiYXNlSHJlZiA9ICcnO1xuXG4gICAgICAgICAgICAvLyBUZXN0IGZvciBCYXNlIEVsZW1lbnRcbiAgICAgICAgICAgIGlmIChiYXNlRWxlbWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBmb3IgQmFzZSBFbGVtZW50XG4gICAgICAgICAgICAgICAgYmFzZUVsZW1lbnQgPSBiYXNlRWxlbWVudHNbMF07XG4gICAgICAgICAgICAgICAgYmFzZUhyZWYgPSBiYXNlRWxlbWVudC5ocmVmLnJlcGxhY2UoL1teXFwvXSskLywgJycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGp1c3QgdHJhaWxpbmcgc2xhc2hcbiAgICAgICAgICAgIGJhc2VIcmVmID0gYmFzZUhyZWYucmVwbGFjZSgvXFwvKyQvLCAnJyk7XG4gICAgICAgICAgICBpZiAoYmFzZUhyZWYpIGJhc2VIcmVmICs9ICcvJztcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gYmFzZUhyZWY7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0QmFzZVVybCgpXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGJhc2VIcmVmIG9yIGJhc2VQYWdlVXJsIG9yIHJvb3RVcmwgKHdoaWNoZXZlciBvbmUgZXhpc3RzIGZpcnN0KVxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGJhc2VVcmxcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0QmFzZVVybCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZVxuICAgICAgICAgICAgdmFyIGJhc2VVcmwgPSBIaXN0b3J5LmdldEJhc2VIcmVmKCkgfHwgSGlzdG9yeS5nZXRCYXNlUGFnZVVybCgpIHx8IEhpc3RvcnkuZ2V0Um9vdFVybCgpO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBiYXNlVXJsO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldFBhZ2VVcmwoKVxuICAgICAgICAgKiBGZXRjaGVzIHRoZSBVUkwgb2YgdGhlIGN1cnJlbnQgcGFnZVxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHBhZ2VVcmxcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0UGFnZVVybCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIEZldGNoXG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGUoZmFsc2UsIGZhbHNlKSxcbiAgICAgICAgICAgICAgICBzdGF0ZVVybCA9IChTdGF0ZSB8fCB7fSkudXJsIHx8IEhpc3RvcnkuZ2V0TG9jYXRpb25IcmVmKCksXG4gICAgICAgICAgICAgICAgcGFnZVVybDtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlXG4gICAgICAgICAgICBwYWdlVXJsID0gc3RhdGVVcmwucmVwbGFjZSgvXFwvKyQvLCAnJykucmVwbGFjZSgvW15cXC9dKyQvLCBmdW5jdGlvbiAocGFydCwgaW5kZXgsIHN0cmluZykge1xuICAgICAgICAgICAgICAgIHJldHVybiAoL1xcLi8pLnRlc3QocGFydCkgPyBwYXJ0IDogcGFydCArICcvJztcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBwYWdlVXJsO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldEJhc2VQYWdlVXJsKClcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgVXJsIG9mIHRoZSBkaXJlY3Rvcnkgb2YgdGhlIGN1cnJlbnQgcGFnZVxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGJhc2VQYWdlVXJsXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldEJhc2VQYWdlVXJsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gQ3JlYXRlXG4gICAgICAgICAgICB2YXIgYmFzZVBhZ2VVcmwgPSAoSGlzdG9yeS5nZXRMb2NhdGlvbkhyZWYoKSkucmVwbGFjZSgvWyNcXD9dLiovLCAnJykucmVwbGFjZSgvW15cXC9dKyQvLCBmdW5jdGlvbiAocGFydCwgaW5kZXgsIHN0cmluZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKC9bXlxcL10kLykudGVzdChwYXJ0KSA/ICcnIDogcGFydDtcbiAgICAgICAgICAgICAgICB9KS5yZXBsYWNlKC9cXC8rJC8sICcnKSArICcvJztcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gYmFzZVBhZ2VVcmw7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0RnVsbFVybCh1cmwpXG4gICAgICAgICAqIEVuc3VyZXMgdGhhdCB3ZSBoYXZlIGFuIGFic29sdXRlIFVSTCBhbmQgbm90IGEgcmVsYXRpdmUgVVJMXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBhbGxvd0Jhc2VIcmVmXG4gICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gZnVsbFVybFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRGdWxsVXJsID0gZnVuY3Rpb24gKHVybCwgYWxsb3dCYXNlSHJlZikge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIGZ1bGxVcmwgPSB1cmwsIGZpcnN0Q2hhciA9IHVybC5zdWJzdHJpbmcoMCwgMSk7XG4gICAgICAgICAgICBhbGxvd0Jhc2VIcmVmID0gKHR5cGVvZiBhbGxvd0Jhc2VIcmVmID09PSAndW5kZWZpbmVkJykgPyB0cnVlIDogYWxsb3dCYXNlSHJlZjtcblxuICAgICAgICAgICAgLy8gQ2hlY2tcbiAgICAgICAgICAgIGlmICgvW2Etel0rXFw6XFwvXFwvLy50ZXN0KHVybCkpIHtcbiAgICAgICAgICAgICAgICAvLyBGdWxsIFVSTFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZmlyc3RDaGFyID09PSAnLycpIHtcbiAgICAgICAgICAgICAgICAvLyBSb290IFVSTFxuICAgICAgICAgICAgICAgIGZ1bGxVcmwgPSBIaXN0b3J5LmdldFJvb3RVcmwoKSArIHVybC5yZXBsYWNlKC9eXFwvKy8sICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZpcnN0Q2hhciA9PT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgLy8gQW5jaG9yIFVSTFxuICAgICAgICAgICAgICAgIGZ1bGxVcmwgPSBIaXN0b3J5LmdldFBhZ2VVcmwoKS5yZXBsYWNlKC8jLiovLCAnJykgKyB1cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmaXJzdENoYXIgPT09ICc/Jykge1xuICAgICAgICAgICAgICAgIC8vIFF1ZXJ5IFVSTFxuICAgICAgICAgICAgICAgIGZ1bGxVcmwgPSBIaXN0b3J5LmdldFBhZ2VVcmwoKS5yZXBsYWNlKC9bXFw/I10uKi8sICcnKSArIHVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFJlbGF0aXZlIFVSTFxuICAgICAgICAgICAgICAgIGlmIChhbGxvd0Jhc2VIcmVmKSB7XG4gICAgICAgICAgICAgICAgICAgIGZ1bGxVcmwgPSBIaXN0b3J5LmdldEJhc2VVcmwoKSArIHVybC5yZXBsYWNlKC9eKFxcLlxcLykrLywgJycpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZ1bGxVcmwgPSBIaXN0b3J5LmdldEJhc2VQYWdlVXJsKCkgKyB1cmwucmVwbGFjZSgvXihcXC5cXC8pKy8sICcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBhbiBpZiBjb25kaXRpb24gYWJvdmUgYXMgd2UgZG8gbm90IHdhbnQgaGFzaGVzXG4gICAgICAgICAgICAgICAgLy8gd2hpY2ggYXJlIHJlbGF0aXZlIHRvIHRoZSBiYXNlSHJlZiBpbiBvdXIgVVJMc1xuICAgICAgICAgICAgICAgIC8vIGFzIGlmIHRoZSBiYXNlSHJlZiBjaGFuZ2VzLCB0aGVuIGFsbCBvdXIgYm9va21hcmtzXG4gICAgICAgICAgICAgICAgLy8gd291bGQgbm93IHBvaW50IHRvIGRpZmZlcmVudCBsb2NhdGlvbnNcbiAgICAgICAgICAgICAgICAvLyB3aGVyZWFzIHRoZSBiYXNlUGFnZVVybCB3aWxsIGFsd2F5cyBzdGF5IHRoZSBzYW1lXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIGZ1bGxVcmwucmVwbGFjZSgvXFwjJC8sICcnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRTaG9ydFVybCh1cmwpXG4gICAgICAgICAqIEVuc3VyZXMgdGhhdCB3ZSBoYXZlIGEgcmVsYXRpdmUgVVJMIGFuZCBub3QgYSBhYnNvbHV0ZSBVUkxcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHVybFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRTaG9ydFVybCA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBzaG9ydFVybCA9IHVybCwgYmFzZVVybCA9IEhpc3RvcnkuZ2V0QmFzZVVybCgpLCByb290VXJsID0gSGlzdG9yeS5nZXRSb290VXJsKCk7XG5cbiAgICAgICAgICAgIC8vIFRyaW0gYmFzZVVybFxuICAgICAgICAgICAgaWYgKEhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgLy8gV2UgYXJlIGluIGEgaWYgc3RhdGVtZW50IGFzIHdoZW4gcHVzaFN0YXRlIGlzIG5vdCBlbXVsYXRlZFxuICAgICAgICAgICAgICAgIC8vIFRoZSBhY3R1YWwgdXJsIHRoZXNlIHNob3J0IHVybHMgYXJlIHJlbGF0aXZlIHRvIGNhbiBjaGFuZ2VcbiAgICAgICAgICAgICAgICAvLyBTbyB3aXRoaW4gdGhlIHNhbWUgc2Vzc2lvbiwgd2UgdGhlIHVybCBtYXkgZW5kIHVwIHNvbWV3aGVyZSBkaWZmZXJlbnRcbiAgICAgICAgICAgICAgICBzaG9ydFVybCA9IHNob3J0VXJsLnJlcGxhY2UoYmFzZVVybCwgJycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUcmltIHJvb3RVcmxcbiAgICAgICAgICAgIHNob3J0VXJsID0gc2hvcnRVcmwucmVwbGFjZShyb290VXJsLCAnLycpO1xuXG4gICAgICAgICAgICAvLyBFbnN1cmUgd2UgY2FuIHN0aWxsIGRldGVjdCBpdCBhcyBhIHN0YXRlXG4gICAgICAgICAgICBpZiAoSGlzdG9yeS5pc1RyYWRpdGlvbmFsQW5jaG9yKHNob3J0VXJsKSkge1xuICAgICAgICAgICAgICAgIHNob3J0VXJsID0gJy4vJyArIHNob3J0VXJsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDbGVhbiBJdFxuICAgICAgICAgICAgc2hvcnRVcmwgPSBzaG9ydFVybC5yZXBsYWNlKC9eKFxcLlxcLykrL2csICcuLycpLnJlcGxhY2UoL1xcIyQvLCAnJyk7XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIHNob3J0VXJsO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldExvY2F0aW9uSHJlZihkb2N1bWVudClcbiAgICAgICAgICogUmV0dXJucyBhIG5vcm1hbGl6ZWQgdmVyc2lvbiBvZiBkb2N1bWVudC5sb2NhdGlvbi5ocmVmXG4gICAgICAgICAqIGFjY291bnRpbmcgZm9yIGJyb3dzZXIgaW5jb25zaXN0ZW5jaWVzLCBldGMuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoaXMgVVJMIHdpbGwgYmUgVVJJLWVuY29kZWQgYW5kIHdpbGwgaW5jbHVkZSB0aGUgaGFzaFxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gZG9jdW1lbnRcbiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSB1cmxcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0TG9jYXRpb25IcmVmID0gZnVuY3Rpb24gKGRvYykge1xuICAgICAgICAgICAgZG9jID0gZG9jIHx8IGRvY3VtZW50O1xuXG4gICAgICAgICAgICAvLyBtb3N0IG9mIHRoZSB0aW1lLCB0aGlzIHdpbGwgYmUgdHJ1ZVxuICAgICAgICAgICAgaWYgKGRvYy5VUkwgPT09IGRvYy5sb2NhdGlvbi5ocmVmKVxuICAgICAgICAgICAgICAgIHJldHVybiBkb2MubG9jYXRpb24uaHJlZjtcblxuICAgICAgICAgICAgLy8gc29tZSB2ZXJzaW9ucyBvZiB3ZWJraXQgVVJJLWRlY29kZSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmXG4gICAgICAgICAgICAvLyBidXQgdGhleSBsZWF2ZSBkb2N1bWVudC5VUkwgaW4gYW4gZW5jb2RlZCBzdGF0ZVxuICAgICAgICAgICAgaWYgKGRvYy5sb2NhdGlvbi5ocmVmID09PSBkZWNvZGVVUklDb21wb25lbnQoZG9jLlVSTCkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRvYy5VUkw7XG5cbiAgICAgICAgICAgIC8vIEZGIDMuNiBvbmx5IHVwZGF0ZXMgZG9jdW1lbnQuVVJMIHdoZW4gYSBwYWdlIGlzIHJlbG9hZGVkXG4gICAgICAgICAgICAvLyBkb2N1bWVudC5sb2NhdGlvbi5ocmVmIGlzIHVwZGF0ZWQgY29ycmVjdGx5XG4gICAgICAgICAgICBpZiAoZG9jLmxvY2F0aW9uLmhhc2ggJiYgZGVjb2RlVVJJQ29tcG9uZW50KGRvYy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoL15bXiNdKy8sIFwiXCIpKSA9PT0gZG9jLmxvY2F0aW9uLmhhc2gpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRvYy5sb2NhdGlvbi5ocmVmO1xuXG4gICAgICAgICAgICBpZiAoZG9jLlVSTC5pbmRleE9mKCcjJykgPT0gLTEgJiYgZG9jLmxvY2F0aW9uLmhyZWYuaW5kZXhPZignIycpICE9IC0xKVxuICAgICAgICAgICAgICAgIHJldHVybiBkb2MubG9jYXRpb24uaHJlZjtcblxuICAgICAgICAgICAgcmV0dXJuIGRvYy5VUkwgfHwgZG9jLmxvY2F0aW9uLmhyZWY7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBTdGF0ZSBTdG9yYWdlXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc3RvcmVcbiAgICAgICAgICogVGhlIHN0b3JlIGZvciBhbGwgc2Vzc2lvbiBzcGVjaWZpYyBkYXRhXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnN0b3JlID0ge307XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuaWRUb1N0YXRlXG4gICAgICAgICAqIDEtMTogU3RhdGUgSUQgdG8gU3RhdGUgT2JqZWN0XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmlkVG9TdGF0ZSA9IEhpc3RvcnkuaWRUb1N0YXRlIHx8IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnN0YXRlVG9JZFxuICAgICAgICAgKiAxLTE6IFN0YXRlIFN0cmluZyB0byBTdGF0ZSBJRFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zdGF0ZVRvSWQgPSBIaXN0b3J5LnN0YXRlVG9JZCB8fCB7fTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS51cmxUb0lkXG4gICAgICAgICAqIDEtMTogU3RhdGUgVVJMIHRvIFN0YXRlIElEXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnVybFRvSWQgPSBIaXN0b3J5LnVybFRvSWQgfHwge307XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc3RvcmVkU3RhdGVzXG4gICAgICAgICAqIFN0b3JlIHRoZSBzdGF0ZXMgaW4gYW4gYXJyYXlcbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkuc3RvcmVkU3RhdGVzID0gSGlzdG9yeS5zdG9yZWRTdGF0ZXMgfHwgW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc2F2ZWRTdGF0ZXNcbiAgICAgICAgICogU2F2ZWQgdGhlIHN0YXRlcyBpbiBhbiBhcnJheVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zYXZlZFN0YXRlcyA9IEhpc3Rvcnkuc2F2ZWRTdGF0ZXMgfHwgW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkubm9yYW1saXplU3RvcmUoKVxuICAgICAgICAgKiBOb3JhbWxpemUgdGhlIHN0b3JlIGJ5IGFkZGluZyBuZWNlc3NhcnkgdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm5vcm1hbGl6ZVN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgSGlzdG9yeS5zdG9yZS5pZFRvU3RhdGUgPSBIaXN0b3J5LnN0b3JlLmlkVG9TdGF0ZSB8fCB7fTtcbiAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmUudXJsVG9JZCA9IEhpc3Rvcnkuc3RvcmUudXJsVG9JZCB8fCB7fTtcbiAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmUuc3RhdGVUb0lkID0gSGlzdG9yeS5zdG9yZS5zdGF0ZVRvSWQgfHwge307XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0U3RhdGUoKVxuICAgICAgICAgKiBHZXQgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRhdGEsIHRpdGxlIGFuZCB1cmwgb2YgdGhlIGN1cnJlbnQgc3RhdGVcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBmcmllbmRseVxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNyZWF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFN0YXRlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldFN0YXRlID0gZnVuY3Rpb24gKGZyaWVuZGx5LCBjcmVhdGUpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZnJpZW5kbHkgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgZnJpZW5kbHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjcmVhdGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgY3JlYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmV0Y2hcbiAgICAgICAgICAgIHZhciBTdGF0ZSA9IEhpc3RvcnkuZ2V0TGFzdFNhdmVkU3RhdGUoKTtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlXG4gICAgICAgICAgICBpZiAoIVN0YXRlICYmIGNyZWF0ZSkge1xuICAgICAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5jcmVhdGVTdGF0ZU9iamVjdCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGp1c3RcbiAgICAgICAgICAgIGlmIChmcmllbmRseSkge1xuICAgICAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5jbG9uZU9iamVjdChTdGF0ZSk7XG4gICAgICAgICAgICAgICAgU3RhdGUudXJsID0gU3RhdGUuY2xlYW5VcmwgfHwgU3RhdGUudXJsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBTdGF0ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRJZEJ5U3RhdGUoU3RhdGUpXG4gICAgICAgICAqIEdldHMgYSBJRCBmb3IgYSBTdGF0ZVxuICAgICAgICAgKiBAcGFyYW0ge1N0YXRlfSBuZXdTdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGlkXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldElkQnlTdGF0ZSA9IGZ1bmN0aW9uIChuZXdTdGF0ZSkge1xuXG4gICAgICAgICAgICAvLyBGZXRjaCBJRFxuICAgICAgICAgICAgdmFyIGlkID0gSGlzdG9yeS5leHRyYWN0SWQobmV3U3RhdGUudXJsKSxcbiAgICAgICAgICAgICAgICBzdHI7XG5cbiAgICAgICAgICAgIGlmICghaWQpIHtcbiAgICAgICAgICAgICAgICAvLyBGaW5kIElEIHZpYSBTdGF0ZSBTdHJpbmdcbiAgICAgICAgICAgICAgICBzdHIgPSBIaXN0b3J5LmdldFN0YXRlU3RyaW5nKG5ld1N0YXRlKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIEhpc3Rvcnkuc3RhdGVUb0lkW3N0cl0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkID0gSGlzdG9yeS5zdGF0ZVRvSWRbc3RyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIEhpc3Rvcnkuc3RvcmUuc3RhdGVUb0lkW3N0cl0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkID0gSGlzdG9yeS5zdG9yZS5zdGF0ZVRvSWRbc3RyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIGEgbmV3IElEXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyBTdHJpbmcoTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXFxEL2csICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgSGlzdG9yeS5pZFRvU3RhdGVbaWRdID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgSGlzdG9yeS5zdG9yZS5pZFRvU3RhdGVbaWRdID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgdGhlIG5ldyBTdGF0ZSB0byB0aGUgSURcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5zdGF0ZVRvSWRbc3RyXSA9IGlkO1xuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmlkVG9TdGF0ZVtpZF0gPSBuZXdTdGF0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVybiBJRFxuICAgICAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm5vcm1hbGl6ZVN0YXRlKFN0YXRlKVxuICAgICAgICAgKiBFeHBhbmRzIGEgU3RhdGUgT2JqZWN0XG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBTdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtvYmplY3R9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm5vcm1hbGl6ZVN0YXRlID0gZnVuY3Rpb24gKG9sZFN0YXRlKSB7XG4gICAgICAgICAgICAvLyBWYXJpYWJsZXNcbiAgICAgICAgICAgIHZhciBuZXdTdGF0ZSwgZGF0YU5vdEVtcHR5O1xuXG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICBpZiAoIW9sZFN0YXRlIHx8ICh0eXBlb2Ygb2xkU3RhdGUgIT09ICdvYmplY3QnKSkge1xuICAgICAgICAgICAgICAgIG9sZFN0YXRlID0ge307XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoZWNrXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9sZFN0YXRlLm5vcm1hbGl6ZWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9sZFN0YXRlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGp1c3RcbiAgICAgICAgICAgIGlmICghb2xkU3RhdGUuZGF0YSB8fCAodHlwZW9mIG9sZFN0YXRlLmRhdGEgIT09ICdvYmplY3QnKSkge1xuICAgICAgICAgICAgICAgIG9sZFN0YXRlLmRhdGEgPSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAvLyBDcmVhdGVcbiAgICAgICAgICAgIG5ld1N0YXRlID0ge307XG4gICAgICAgICAgICBuZXdTdGF0ZS5ub3JtYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICAgIG5ld1N0YXRlLnRpdGxlID0gb2xkU3RhdGUudGl0bGUgfHwgJyc7XG4gICAgICAgICAgICBuZXdTdGF0ZS51cmwgPSBIaXN0b3J5LmdldEZ1bGxVcmwob2xkU3RhdGUudXJsID8gb2xkU3RhdGUudXJsIDogKEhpc3RvcnkuZ2V0TG9jYXRpb25IcmVmKCkpKTtcbiAgICAgICAgICAgIG5ld1N0YXRlLmhhc2ggPSBIaXN0b3J5LmdldFNob3J0VXJsKG5ld1N0YXRlLnVybCk7XG4gICAgICAgICAgICBuZXdTdGF0ZS5kYXRhID0gSGlzdG9yeS5jbG9uZU9iamVjdChvbGRTdGF0ZS5kYXRhKTtcblxuICAgICAgICAgICAgLy8gRmV0Y2ggSURcbiAgICAgICAgICAgIG5ld1N0YXRlLmlkID0gSGlzdG9yeS5nZXRJZEJ5U3RhdGUobmV3U3RhdGUpO1xuXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgIC8vIENsZWFuIHRoZSBVUkxcbiAgICAgICAgICAgIG5ld1N0YXRlLmNsZWFuVXJsID0gbmV3U3RhdGUudXJsLnJlcGxhY2UoL1xcPz9cXCZfc3VpZC4qLywgJycpO1xuICAgICAgICAgICAgbmV3U3RhdGUudXJsID0gbmV3U3RhdGUuY2xlYW5Vcmw7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIG1vcmUgdGhhbiBqdXN0IGEgdXJsXG4gICAgICAgICAgICBkYXRhTm90RW1wdHkgPSAhSGlzdG9yeS5pc0VtcHR5T2JqZWN0KG5ld1N0YXRlLmRhdGEpO1xuXG4gICAgICAgICAgICAvLyBBcHBseVxuICAgICAgICAgICAgaWYgKChuZXdTdGF0ZS50aXRsZSB8fCBkYXRhTm90RW1wdHkpICYmIEhpc3Rvcnkub3B0aW9ucy5kaXNhYmxlU3VpZCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIC8vIEFkZCBJRCB0byBIYXNoXG4gICAgICAgICAgICAgICAgbmV3U3RhdGUuaGFzaCA9IEhpc3RvcnkuZ2V0U2hvcnRVcmwobmV3U3RhdGUudXJsKS5yZXBsYWNlKC9cXD8/XFwmX3N1aWQuKi8sICcnKTtcbiAgICAgICAgICAgICAgICBpZiAoIS9cXD8vLnRlc3QobmV3U3RhdGUuaGFzaCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3U3RhdGUuaGFzaCArPSAnPyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5ld1N0YXRlLmhhc2ggKz0gJyZfc3VpZD0nICsgbmV3U3RhdGUuaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgSGFzaGVkIFVSTFxuICAgICAgICAgICAgbmV3U3RhdGUuaGFzaGVkVXJsID0gSGlzdG9yeS5nZXRGdWxsVXJsKG5ld1N0YXRlLmhhc2gpO1xuXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgVVJMIGlmIHdlIGhhdmUgYSBkdXBsaWNhdGVcbiAgICAgICAgICAgIGlmICgoSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGUgfHwgSGlzdG9yeS5idWdzLnNhZmFyaVBvbGwpICYmIEhpc3RvcnkuaGFzVXJsRHVwbGljYXRlKG5ld1N0YXRlKSkge1xuICAgICAgICAgICAgICAgIG5ld1N0YXRlLnVybCA9IG5ld1N0YXRlLmhhc2hlZFVybDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5jcmVhdGVTdGF0ZU9iamVjdChkYXRhLHRpdGxlLHVybClcbiAgICAgICAgICogQ3JlYXRlcyBhIG9iamVjdCBiYXNlZCBvbiB0aGUgZGF0YSwgdGl0bGUgYW5kIHVybCBzdGF0ZSBwYXJhbXNcbiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IGRhdGFcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHRpdGxlXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcbiAgICAgICAgICogQHJldHVybiB7b2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5jcmVhdGVTdGF0ZU9iamVjdCA9IGZ1bmN0aW9uIChkYXRhLCB0aXRsZSwgdXJsKSB7XG4gICAgICAgICAgICAvLyBIYXNoaWZ5XG4gICAgICAgICAgICB2YXIgU3RhdGUgPSB7XG4gICAgICAgICAgICAgICAgJ2RhdGEnOiBkYXRhLFxuICAgICAgICAgICAgICAgICd0aXRsZSc6IHRpdGxlLFxuICAgICAgICAgICAgICAgICd1cmwnOiB1cmxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIEV4cGFuZCB0aGUgU3RhdGVcbiAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5ub3JtYWxpemVTdGF0ZShTdGF0ZSk7XG5cbiAgICAgICAgICAgIC8vIFJldHVybiBvYmplY3RcbiAgICAgICAgICAgIHJldHVybiBTdGF0ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRTdGF0ZUJ5SWQoaWQpXG4gICAgICAgICAqIEdldCBhIHN0YXRlIGJ5IGl0J3MgVUlEXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nZXRTdGF0ZUJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIGlkID0gU3RyaW5nKGlkKTtcblxuICAgICAgICAgICAgLy8gUmV0cmlldmVcbiAgICAgICAgICAgIHZhciBTdGF0ZSA9IEhpc3RvcnkuaWRUb1N0YXRlW2lkXSB8fCBIaXN0b3J5LnN0b3JlLmlkVG9TdGF0ZVtpZF0gfHwgdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm4gU3RhdGVcbiAgICAgICAgICAgIHJldHVybiBTdGF0ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGEgU3RhdGUncyBTdHJpbmdcbiAgICAgICAgICogQHBhcmFtIHtTdGF0ZX0gcGFzc2VkU3RhdGVcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0U3RhdGVTdHJpbmcgPSBmdW5jdGlvbiAocGFzc2VkU3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBTdGF0ZSwgY2xlYW5lZFN0YXRlLCBzdHI7XG5cbiAgICAgICAgICAgIC8vIEZldGNoXG4gICAgICAgICAgICBTdGF0ZSA9IEhpc3Rvcnkubm9ybWFsaXplU3RhdGUocGFzc2VkU3RhdGUpO1xuXG4gICAgICAgICAgICAvLyBDbGVhblxuICAgICAgICAgICAgY2xlYW5lZFN0YXRlID0ge1xuICAgICAgICAgICAgICAgIGRhdGE6IFN0YXRlLmRhdGEsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHBhc3NlZFN0YXRlLnRpdGxlLFxuICAgICAgICAgICAgICAgIHVybDogcGFzc2VkU3RhdGUudXJsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgc3RyID0gSlNPTi5zdHJpbmdpZnkoY2xlYW5lZFN0YXRlKTtcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgYSBTdGF0ZSdzIElEXG4gICAgICAgICAqIEBwYXJhbSB7U3RhdGV9IHBhc3NlZFN0YXRlXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gaWRcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0U3RhdGVJZCA9IGZ1bmN0aW9uIChwYXNzZWRTdGF0ZSkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIFN0YXRlLCBpZDtcblxuICAgICAgICAgICAgLy8gRmV0Y2hcbiAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5ub3JtYWxpemVTdGF0ZShwYXNzZWRTdGF0ZSk7XG5cbiAgICAgICAgICAgIC8vIEZldGNoXG4gICAgICAgICAgICBpZCA9IFN0YXRlLmlkO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBpZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRIYXNoQnlTdGF0ZShTdGF0ZSlcbiAgICAgICAgICogQ3JlYXRlcyBhIEhhc2ggZm9yIHRoZSBTdGF0ZSBPYmplY3RcbiAgICAgICAgICogQHBhcmFtIHtTdGF0ZX0gcGFzc2VkU3RhdGVcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBoYXNoXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldEhhc2hCeVN0YXRlID0gZnVuY3Rpb24gKHBhc3NlZFN0YXRlKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXIgU3RhdGUsIGhhc2g7XG5cbiAgICAgICAgICAgIC8vIEZldGNoXG4gICAgICAgICAgICBTdGF0ZSA9IEhpc3Rvcnkubm9ybWFsaXplU3RhdGUocGFzc2VkU3RhdGUpO1xuXG4gICAgICAgICAgICAvLyBIYXNoXG4gICAgICAgICAgICBoYXNoID0gU3RhdGUuaGFzaDtcblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gaGFzaDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5leHRyYWN0SWQodXJsX29yX2hhc2gpXG4gICAgICAgICAqIEdldCBhIFN0YXRlIElEIGJ5IGl0J3MgVVJMIG9yIEhhc2hcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybF9vcl9oYXNoXG4gICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gaWRcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZXh0cmFjdElkID0gZnVuY3Rpb24gKHVybF9vcl9oYXNoKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXIgaWQsIHBhcnRzLCB1cmwsIHRtcDtcblxuICAgICAgICAgICAgLy8gRXh0cmFjdFxuXG4gICAgICAgICAgICAvLyBJZiB0aGUgVVJMIGhhcyBhICMsIHVzZSB0aGUgaWQgZnJvbSBiZWZvcmUgdGhlICNcbiAgICAgICAgICAgIGlmICh1cmxfb3JfaGFzaC5pbmRleE9mKCcjJykgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0bXAgPSB1cmxfb3JfaGFzaC5zcGxpdChcIiNcIilbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0bXAgPSB1cmxfb3JfaGFzaDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFydHMgPSAvKC4qKVxcJl9zdWlkPShbMC05XSspJC8uZXhlYyh0bXApO1xuICAgICAgICAgICAgdXJsID0gcGFydHMgPyAocGFydHNbMV0gfHwgdXJsX29yX2hhc2gpIDogdXJsX29yX2hhc2g7XG4gICAgICAgICAgICBpZCA9IHBhcnRzID8gU3RyaW5nKHBhcnRzWzJdIHx8ICcnKSA6ICcnO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBpZCB8fCBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5pc1RyYWRpdGlvbmFsQW5jaG9yXG4gICAgICAgICAqIENoZWNrcyB0byBzZWUgaWYgdGhlIHVybCBpcyBhIHRyYWRpdGlvbmFsIGFuY2hvciBvciBub3RcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVybF9vcl9oYXNoXG4gICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmlzVHJhZGl0aW9uYWxBbmNob3IgPSBmdW5jdGlvbiAodXJsX29yX2hhc2gpIHtcbiAgICAgICAgICAgIC8vIENoZWNrXG4gICAgICAgICAgICB2YXIgaXNUcmFkaXRpb25hbCA9ICEoL1tcXC9cXD9cXC5dLy50ZXN0KHVybF9vcl9oYXNoKSk7XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIGlzVHJhZGl0aW9uYWw7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZXh0cmFjdFN0YXRlXG4gICAgICAgICAqIEdldCBhIFN0YXRlIGJ5IGl0J3MgVVJMIG9yIEhhc2hcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVybF9vcl9oYXNoXG4gICAgICAgICAqIEByZXR1cm4ge1N0YXRlfG51bGx9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmV4dHJhY3RTdGF0ZSA9IGZ1bmN0aW9uICh1cmxfb3JfaGFzaCwgY3JlYXRlKSB7XG4gICAgICAgICAgICAvLyBQcmVwYXJlXG4gICAgICAgICAgICB2YXIgU3RhdGUgPSBudWxsLCBpZCwgdXJsO1xuICAgICAgICAgICAgY3JlYXRlID0gY3JlYXRlIHx8IGZhbHNlO1xuXG4gICAgICAgICAgICAvLyBGZXRjaCBTVUlEXG4gICAgICAgICAgICBpZCA9IEhpc3RvcnkuZXh0cmFjdElkKHVybF9vcl9oYXNoKTtcbiAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5nZXRTdGF0ZUJ5SWQoaWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGZXRjaCBTVUlEIHJldHVybmVkIG5vIFN0YXRlXG4gICAgICAgICAgICBpZiAoIVN0YXRlKSB7XG4gICAgICAgICAgICAgICAgLy8gRmV0Y2ggVVJMXG4gICAgICAgICAgICAgICAgdXJsID0gSGlzdG9yeS5nZXRGdWxsVXJsKHVybF9vcl9oYXNoKTtcblxuICAgICAgICAgICAgICAgIC8vIENoZWNrIFVSTFxuICAgICAgICAgICAgICAgIGlkID0gSGlzdG9yeS5nZXRJZEJ5VXJsKHVybCkgfHwgZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5nZXRTdGF0ZUJ5SWQoaWQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBTdGF0ZVxuICAgICAgICAgICAgICAgIGlmICghU3RhdGUgJiYgY3JlYXRlICYmICFIaXN0b3J5LmlzVHJhZGl0aW9uYWxBbmNob3IodXJsX29yX2hhc2gpKSB7XG4gICAgICAgICAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5jcmVhdGVTdGF0ZU9iamVjdChudWxsLCBudWxsLCB1cmwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmV0dXJuXG4gICAgICAgICAgICByZXR1cm4gU3RhdGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0SWRCeVVybCgpXG4gICAgICAgICAqIEdldCBhIFN0YXRlIElEIGJ5IGEgU3RhdGUgVVJMXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldElkQnlVcmwgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgdmFyIGlkID0gSGlzdG9yeS51cmxUb0lkW3VybF0gfHwgSGlzdG9yeS5zdG9yZS51cmxUb0lkW3VybF0gfHwgdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBpZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRMYXN0U2F2ZWRTdGF0ZSgpXG4gICAgICAgICAqIEdldCBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZGF0YSwgdGl0bGUgYW5kIHVybCBvZiB0aGUgY3VycmVudCBzdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFN0YXRlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldExhc3RTYXZlZFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIEhpc3Rvcnkuc2F2ZWRTdGF0ZXNbSGlzdG9yeS5zYXZlZFN0YXRlcy5sZW5ndGggLSAxXSB8fCB1bmRlZmluZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0TGFzdFN0b3JlZFN0YXRlKClcbiAgICAgICAgICogR2V0IGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBkYXRhLCB0aXRsZSBhbmQgdXJsIG9mIHRoZSBjdXJyZW50IHN0YXRlXG4gICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gU3RhdGVcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0TGFzdFN0b3JlZFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIEhpc3Rvcnkuc3RvcmVkU3RhdGVzW0hpc3Rvcnkuc3RvcmVkU3RhdGVzLmxlbmd0aCAtIDFdIHx8IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5oYXNVcmxEdXBsaWNhdGVcbiAgICAgICAgICogQ2hlY2tzIGlmIGEgVXJsIHdpbGwgaGF2ZSBhIHVybCBjb25mbGljdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gbmV3U3RhdGVcbiAgICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0gaGFzRHVwbGljYXRlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lmhhc1VybER1cGxpY2F0ZSA9IGZ1bmN0aW9uIChuZXdTdGF0ZSkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIGhhc0R1cGxpY2F0ZSA9IGZhbHNlLFxuICAgICAgICAgICAgICAgIG9sZFN0YXRlO1xuXG4gICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgb2xkU3RhdGUgPSBIaXN0b3J5LmV4dHJhY3RTdGF0ZShuZXdTdGF0ZS51cmwpO1xuXG4gICAgICAgICAgICAvLyBDaGVja1xuICAgICAgICAgICAgaGFzRHVwbGljYXRlID0gb2xkU3RhdGUgJiYgb2xkU3RhdGUuaWQgIT09IG5ld1N0YXRlLmlkO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBoYXNEdXBsaWNhdGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc3RvcmVTdGF0ZVxuICAgICAgICAgKiBTdG9yZSBhIFN0YXRlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBuZXdTdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IG5ld1N0YXRlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnN0b3JlU3RhdGUgPSBmdW5jdGlvbiAobmV3U3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBTdGF0ZVxuICAgICAgICAgICAgSGlzdG9yeS51cmxUb0lkW25ld1N0YXRlLnVybF0gPSBuZXdTdGF0ZS5pZDtcblxuICAgICAgICAgICAgLy8gUHVzaCB0aGUgU3RhdGVcbiAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmVkU3RhdGVzLnB1c2goSGlzdG9yeS5jbG9uZU9iamVjdChuZXdTdGF0ZSkpO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm4gbmV3U3RhdGVcbiAgICAgICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5pc0xhc3RTYXZlZFN0YXRlKG5ld1N0YXRlKVxuICAgICAgICAgKiBUZXN0cyB0byBzZWUgaWYgdGhlIHN0YXRlIGlzIHRoZSBsYXN0IHN0YXRlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBuZXdTdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtib29sZWFufSBpc0xhc3RcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuaXNMYXN0U2F2ZWRTdGF0ZSA9IGZ1bmN0aW9uIChuZXdTdGF0ZSkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIGlzTGFzdCA9IGZhbHNlLFxuICAgICAgICAgICAgICAgIG5ld0lkLCBvbGRTdGF0ZSwgb2xkSWQ7XG5cbiAgICAgICAgICAgIC8vIENoZWNrXG4gICAgICAgICAgICBpZiAoSGlzdG9yeS5zYXZlZFN0YXRlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBuZXdJZCA9IG5ld1N0YXRlLmlkO1xuICAgICAgICAgICAgICAgIG9sZFN0YXRlID0gSGlzdG9yeS5nZXRMYXN0U2F2ZWRTdGF0ZSgpO1xuICAgICAgICAgICAgICAgIG9sZElkID0gb2xkU3RhdGUuaWQ7XG5cbiAgICAgICAgICAgICAgICAvLyBDaGVja1xuICAgICAgICAgICAgICAgIGlzTGFzdCA9IChuZXdJZCA9PT0gb2xkSWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm5cbiAgICAgICAgICAgIHJldHVybiBpc0xhc3Q7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc2F2ZVN0YXRlXG4gICAgICAgICAqIFB1c2ggYSBTdGF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gbmV3U3RhdGVcbiAgICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gY2hhbmdlZFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zYXZlU3RhdGUgPSBmdW5jdGlvbiAobmV3U3RhdGUpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIEhhc2hcbiAgICAgICAgICAgIGlmIChIaXN0b3J5LmlzTGFzdFNhdmVkU3RhdGUobmV3U3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBQdXNoIHRoZSBTdGF0ZVxuICAgICAgICAgICAgSGlzdG9yeS5zYXZlZFN0YXRlcy5wdXNoKEhpc3RvcnkuY2xvbmVPYmplY3QobmV3U3RhdGUpKTtcblxuICAgICAgICAgICAgLy8gUmV0dXJuIHRydWVcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldFN0YXRlQnlJbmRleCgpXG4gICAgICAgICAqIEdldHMgYSBzdGF0ZSBieSB0aGUgaW5kZXhcbiAgICAgICAgICogQHBhcmFtIHtpbnRlZ2VyfSBpbmRleFxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldFN0YXRlQnlJbmRleCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIFN0YXRlID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gSGFuZGxlXG4gICAgICAgICAgICBpZiAodHlwZW9mIGluZGV4ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgbGFzdCBpbnNlcnRlZFxuICAgICAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5zYXZlZFN0YXRlc1tIaXN0b3J5LnNhdmVkU3RhdGVzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgICAgICAgICAgLy8gR2V0IGZyb20gdGhlIGVuZFxuICAgICAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5zYXZlZFN0YXRlc1tIaXN0b3J5LnNhdmVkU3RhdGVzLmxlbmd0aCArIGluZGV4XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEdldCBmcm9tIHRoZSBiZWdpbm5pbmdcbiAgICAgICAgICAgICAgICBTdGF0ZSA9IEhpc3Rvcnkuc2F2ZWRTdGF0ZXNbaW5kZXhdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXR1cm4gU3RhdGVcbiAgICAgICAgICAgIHJldHVybiBTdGF0ZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5nZXRDdXJyZW50SW5kZXgoKVxuICAgICAgICAgKiBHZXRzIHRoZSBjdXJyZW50IGluZGV4XG4gICAgICAgICAqIEByZXR1cm4gKGludGVnZXIpXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldEN1cnJlbnRJbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciBpbmRleCA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIE5vIHN0YXRlcyBzYXZlZFxuICAgICAgICAgICAgaWYgKEhpc3Rvcnkuc2F2ZWRTdGF0ZXMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGluZGV4ID0gSGlzdG9yeS5zYXZlZFN0YXRlcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEhhc2ggSGVscGVyc1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdldEhhc2goKVxuICAgICAgICAgKiBAcGFyYW0ge0xvY2F0aW9uPX0gbG9jYXRpb25cbiAgICAgICAgICogR2V0cyB0aGUgY3VycmVudCBkb2N1bWVudCBoYXNoXG4gICAgICAgICAqIE5vdGU6IHVubGlrZSBsb2NhdGlvbi5oYXNoLCB0aGlzIGlzIGd1YXJhbnRlZWQgdG8gcmV0dXJuIHRoZSBlc2NhcGVkIGhhc2ggaW4gYWxsIGJyb3dzZXJzXG4gICAgICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZ2V0SGFzaCA9IGZ1bmN0aW9uIChkb2MpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBIaXN0b3J5LmdldExvY2F0aW9uSHJlZihkb2MpLFxuICAgICAgICAgICAgICAgIGhhc2g7XG4gICAgICAgICAgICBoYXNoID0gSGlzdG9yeS5nZXRIYXNoQnlVcmwodXJsKTtcbiAgICAgICAgICAgIHJldHVybiBoYXNoO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LnVuZXNjYXBlSGFzaCgpXG4gICAgICAgICAqIG5vcm1hbGl6ZSBhbmQgVW5lc2NhcGUgYSBIYXNoXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBoYXNoXG4gICAgICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkudW5lc2NhcGVIYXNoID0gZnVuY3Rpb24gKGhhc2gpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBIaXN0b3J5Lm5vcm1hbGl6ZUhhc2goaGFzaCk7XG5cbiAgICAgICAgICAgIC8vIFVuZXNjYXBlIGhhc2hcbiAgICAgICAgICAgIHJlc3VsdCA9IGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHQpO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm4gcmVzdWx0XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5Lm5vcm1hbGl6ZUhhc2goKVxuICAgICAgICAgKiBub3JtYWxpemUgYSBoYXNoIGFjcm9zcyBicm93c2Vyc1xuICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5Lm5vcm1hbGl6ZUhhc2ggPSBmdW5jdGlvbiAoaGFzaCkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGhhc2gucmVwbGFjZSgvW14jXSojLywgJycpLnJlcGxhY2UoLyMuKi8sICcnKTtcblxuICAgICAgICAgICAgLy8gUmV0dXJuIHJlc3VsdFxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5zZXRIYXNoKGhhc2gpXG4gICAgICAgICAqIFNldHMgdGhlIGRvY3VtZW50IGhhc2hcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGhhc2hcbiAgICAgICAgICogQHJldHVybiB7SGlzdG9yeX1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3Rvcnkuc2V0SGFzaCA9IGZ1bmN0aW9uIChoYXNoLCBxdWV1ZSkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIFN0YXRlLCBwYWdlVXJsO1xuXG4gICAgICAgICAgICAvLyBIYW5kbGUgUXVldWVpbmdcbiAgICAgICAgICAgIGlmIChxdWV1ZSAhPT0gZmFsc2UgJiYgSGlzdG9yeS5idXN5KCkpIHtcbiAgICAgICAgICAgICAgICAvLyBXYWl0ICsgUHVzaCB0byBRdWV1ZVxuICAgICAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5zZXRIYXNoOiB3ZSBtdXN0IHdhaXQnLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIEhpc3RvcnkucHVzaFF1ZXVlKHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6IEhpc3RvcnksXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBIaXN0b3J5LnNldEhhc2gsXG4gICAgICAgICAgICAgICAgICAgIGFyZ3M6IGFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgcXVldWU6IHF1ZXVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2dcbiAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5zZXRIYXNoOiBjYWxsZWQnLGhhc2gpO1xuXG4gICAgICAgICAgICAvLyBNYWtlIEJ1c3kgKyBDb250aW51ZVxuICAgICAgICAgICAgSGlzdG9yeS5idXN5KHRydWUpO1xuXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBoYXNoIGlzIGEgc3RhdGVcbiAgICAgICAgICAgIFN0YXRlID0gSGlzdG9yeS5leHRyYWN0U3RhdGUoaGFzaCwgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAoU3RhdGUgJiYgIUhpc3RvcnkuZW11bGF0ZWQucHVzaFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgLy8gSGFzaCBpcyBhIHN0YXRlIHNvIHNraXAgdGhlIHNldEhhc2hcbiAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3Rvcnkuc2V0SGFzaDogSGFzaCBpcyBhIHN0YXRlIHNvIHNraXBwaW5nIHRoZSBoYXNoIHNldCB3aXRoIGEgZGlyZWN0IHB1c2hTdGF0ZSBjYWxsJyxhcmd1bWVudHMpO1xuXG4gICAgICAgICAgICAgICAgLy8gUHVzaFN0YXRlXG4gICAgICAgICAgICAgICAgSGlzdG9yeS5wdXNoU3RhdGUoU3RhdGUuZGF0YSwgU3RhdGUudGl0bGUsIFN0YXRlLnVybCwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoSGlzdG9yeS5nZXRIYXNoKCkgIT09IGhhc2gpIHtcbiAgICAgICAgICAgICAgICAvLyBIYXNoIGlzIGEgcHJvcGVyIGhhc2gsIHNvIGFwcGx5IGl0XG5cbiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgYnJvd3NlciBidWdzXG4gICAgICAgICAgICAgICAgaWYgKEhpc3RvcnkuYnVncy5zZXRIYXNoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpeCBTYWZhcmkgQnVnIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD01NjI0OVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEZldGNoIHRoZSBiYXNlIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgcGFnZVVybCA9IEhpc3RvcnkuZ2V0UGFnZVVybCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNhZmFyaSBoYXNoIGFwcGx5XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkucHVzaFN0YXRlKG51bGwsIG51bGwsIHBhZ2VVcmwgKyAnIycgKyBoYXNoLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBOb3JtYWwgaGFzaCBhcHBseVxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5oYXNoID0gaGFzaDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoYWluXG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5lc2NhcGUoKVxuICAgICAgICAgKiBub3JtYWxpemUgYW5kIEVzY2FwZSBhIEhhc2hcbiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5lc2NhcGVIYXNoID0gZnVuY3Rpb24gKGhhc2gpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBIaXN0b3J5Lm5vcm1hbGl6ZUhhc2goaGFzaCk7XG5cbiAgICAgICAgICAgIC8vIEVzY2FwZSBoYXNoXG4gICAgICAgICAgICByZXN1bHQgPSB3aW5kb3cuZW5jb2RlVVJJQ29tcG9uZW50KHJlc3VsdCk7XG5cbiAgICAgICAgICAgIC8vIElFNiBFc2NhcGUgQnVnXG4gICAgICAgICAgICBpZiAoIUhpc3RvcnkuYnVncy5oYXNoRXNjYXBlKSB7XG4gICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBjb21tb24gcGFydHNcbiAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcJTIxL2csICchJylcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcJTI2L2csICcmJylcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcJTNEL2csICc9JylcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcJTNGL2csICc/Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVybiByZXN1bHRcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZ2V0SGFzaEJ5VXJsKHVybClcbiAgICAgICAgICogRXh0cmFjdHMgdGhlIEhhc2ggZnJvbSBhIFVSTFxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsXG4gICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gdXJsXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmdldEhhc2hCeVVybCA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICAgIC8vIEV4dHJhY3QgdGhlIGhhc2hcbiAgICAgICAgICAgIHZhciBoYXNoID0gU3RyaW5nKHVybClcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyhbXiNdKikjPyhbXiNdKikjPyguKikvLCAnJDInKVxuICAgICAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgLy8gVW5lc2NhcGUgaGFzaFxuICAgICAgICAgICAgaGFzaCA9IEhpc3RvcnkudW5lc2NhcGVIYXNoKGhhc2gpO1xuXG4gICAgICAgICAgICAvLyBSZXR1cm4gaGFzaFxuICAgICAgICAgICAgcmV0dXJuIGhhc2g7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc2V0VGl0bGUodGl0bGUpXG4gICAgICAgICAqIEFwcGxpZXMgdGhlIHRpdGxlIHRvIHRoZSBkb2N1bWVudFxuICAgICAgICAgKiBAcGFyYW0ge1N0YXRlfSBuZXdTdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zZXRUaXRsZSA9IGZ1bmN0aW9uIChuZXdTdGF0ZSkge1xuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIHRpdGxlID0gbmV3U3RhdGUudGl0bGUsXG4gICAgICAgICAgICAgICAgZmlyc3RTdGF0ZTtcblxuICAgICAgICAgICAgLy8gSW5pdGlhbFxuICAgICAgICAgICAgaWYgKCF0aXRsZSkge1xuICAgICAgICAgICAgICAgIGZpcnN0U3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlQnlJbmRleCgwKTtcbiAgICAgICAgICAgICAgICBpZiAoZmlyc3RTdGF0ZSAmJiBmaXJzdFN0YXRlLnVybCA9PT0gbmV3U3RhdGUudXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlID0gZmlyc3RTdGF0ZS50aXRsZSB8fCBIaXN0b3J5Lm9wdGlvbnMuaW5pdGlhbFRpdGxlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXBwbHlcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RpdGxlJylbMF0uaW5uZXJIVE1MID0gdGl0bGUucmVwbGFjZSgnPCcsICcmbHQ7JykucmVwbGFjZSgnPicsICcmZ3Q7JykucmVwbGFjZSgnICYgJywgJyAmYW1wOyAnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24pIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7XG5cbiAgICAgICAgICAgIC8vIENoYWluXG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIFF1ZXVlaW5nXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkucXVldWVzXG4gICAgICAgICAqIFRoZSBsaXN0IG9mIHF1ZXVlcyB0byB1c2VcbiAgICAgICAgICogRmlyc3QgSW4sIEZpcnN0IE91dFxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5xdWV1ZXMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5idXN5KHZhbHVlKVxuICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlIFtvcHRpb25hbF1cbiAgICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gYnVzeVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5idXN5ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAvLyBBcHBseVxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkuYnVzeTogY2hhbmdpbmcgWycrKEhpc3RvcnkuYnVzeS5mbGFnfHxmYWxzZSkrJ10gdG8gWycrKHZhbHVlfHxmYWxzZSkrJ10nLCBIaXN0b3J5LnF1ZXVlcy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeS5mbGFnID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBEZWZhdWx0XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgSGlzdG9yeS5idXN5LmZsYWcgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5idXN5LmZsYWcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUXVldWVcbiAgICAgICAgICAgIGlmICghSGlzdG9yeS5idXN5LmZsYWcpIHtcbiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBuZXh0IGl0ZW0gaW4gdGhlIHF1ZXVlXG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KEhpc3RvcnkuYnVzeS50aW1lb3V0KTtcbiAgICAgICAgICAgICAgICB2YXIgZmlyZU5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpLCBxdWV1ZSwgaXRlbTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKEhpc3RvcnkuYnVzeS5mbGFnKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IEhpc3RvcnkucXVldWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZSA9IEhpc3RvcnkucXVldWVzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMCkgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gcXVldWUuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuZmlyZVF1ZXVlSXRlbShpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeS50aW1lb3V0ID0gc2V0VGltZW91dChmaXJlTmV4dCwgSGlzdG9yeS5vcHRpb25zLmJ1c3lEZWxheSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeS50aW1lb3V0ID0gc2V0VGltZW91dChmaXJlTmV4dCwgSGlzdG9yeS5vcHRpb25zLmJ1c3lEZWxheSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJldHVyblxuICAgICAgICAgICAgcmV0dXJuIEhpc3RvcnkuYnVzeS5mbGFnO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmJ1c3kuZmxhZ1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5idXN5LmZsYWcgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5maXJlUXVldWVJdGVtKGl0ZW0pXG4gICAgICAgICAqIEZpcmUgYSBRdWV1ZSBJdGVtXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtXG4gICAgICAgICAqIEByZXR1cm4ge01peGVkfSByZXN1bHRcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZmlyZVF1ZXVlSXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbS5jYWxsYmFjay5hcHBseShpdGVtLnNjb3BlIHx8IEhpc3RvcnksIGl0ZW0uYXJncyB8fCBbXSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkucHVzaFF1ZXVlKGNhbGxiYWNrLGFyZ3MpXG4gICAgICAgICAqIEFkZCBhbiBpdGVtIHRvIHRoZSBxdWV1ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBbc2NvcGUsY2FsbGJhY2ssYXJncyxxdWV1ZV1cbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkucHVzaFF1ZXVlID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmUgdGhlIHF1ZXVlXG4gICAgICAgICAgICBIaXN0b3J5LnF1ZXVlc1tpdGVtLnF1ZXVlIHx8IDBdID0gSGlzdG9yeS5xdWV1ZXNbaXRlbS5xdWV1ZSB8fCAwXSB8fCBbXTtcblxuICAgICAgICAgICAgLy8gQWRkIHRvIHRoZSBxdWV1ZVxuICAgICAgICAgICAgSGlzdG9yeS5xdWV1ZXNbaXRlbS5xdWV1ZSB8fCAwXS5wdXNoKGl0ZW0pO1xuXG4gICAgICAgICAgICAvLyBDaGFpblxuICAgICAgICAgICAgcmV0dXJuIEhpc3Rvcnk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkucXVldWUgKGl0ZW0scXVldWUpLCAoZnVuYyxxdWV1ZSksIChmdW5jKSwgKGl0ZW0pXG4gICAgICAgICAqIEVpdGhlciBmaXJzIHRoZSBpdGVtIG5vdyBpZiBub3QgYnVzeSwgb3IgYWRkcyBpdCB0byB0aGUgcXVldWVcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkucXVldWUgPSBmdW5jdGlvbiAoaXRlbSwgcXVldWUpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGl0ZW0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBpdGVtXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgcXVldWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgaXRlbS5xdWV1ZSA9IHF1ZXVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBIYW5kbGVcbiAgICAgICAgICAgIGlmIChIaXN0b3J5LmJ1c3koKSkge1xuICAgICAgICAgICAgICAgIEhpc3RvcnkucHVzaFF1ZXVlKGl0ZW0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmZpcmVRdWV1ZUl0ZW0oaXRlbSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoYWluXG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5jbGVhclF1ZXVlKClcbiAgICAgICAgICogQ2xlYXJzIHRoZSBRdWV1ZVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5jbGVhclF1ZXVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgSGlzdG9yeS5idXN5LmZsYWcgPSBmYWxzZTtcbiAgICAgICAgICAgIEhpc3RvcnkucXVldWVzID0gW107XG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIElFIEJ1ZyBGaXhcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlzdG9yeS5zdGF0ZUNoYW5nZWRcbiAgICAgICAgICogU3RhdGVzIHdoZXRoZXIgb3Igbm90IHRoZSBzdGF0ZSBoYXMgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCBkb3VibGUgY2hlY2sgd2FzIGluaXRpYWxpc2VkXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnN0YXRlQ2hhbmdlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmRvdWJsZUNoZWNrZXJcbiAgICAgICAgICogQ29udGFpbnMgdGhlIHRpbWVvdXQgdXNlZCBmb3IgdGhlIGRvdWJsZSBjaGVja3NcbiAgICAgICAgICovXG4gICAgICAgIEhpc3RvcnkuZG91YmxlQ2hlY2tlciA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmRvdWJsZUNoZWNrQ29tcGxldGUoKVxuICAgICAgICAgKiBDb21wbGV0ZSBhIGRvdWJsZSBjaGVja1xuICAgICAgICAgKiBAcmV0dXJuIHtIaXN0b3J5fVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5kb3VibGVDaGVja0NvbXBsZXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gVXBkYXRlXG4gICAgICAgICAgICBIaXN0b3J5LnN0YXRlQ2hhbmdlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIC8vIENsZWFyXG4gICAgICAgICAgICBIaXN0b3J5LmRvdWJsZUNoZWNrQ2xlYXIoKTtcblxuICAgICAgICAgICAgLy8gQ2hhaW5cbiAgICAgICAgICAgIHJldHVybiBIaXN0b3J5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmRvdWJsZUNoZWNrQ2xlYXIoKVxuICAgICAgICAgKiBDbGVhciBhIGRvdWJsZSBjaGVja1xuICAgICAgICAgKiBAcmV0dXJuIHtIaXN0b3J5fVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5kb3VibGVDaGVja0NsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gQ2xlYXJcbiAgICAgICAgICAgIGlmIChIaXN0b3J5LmRvdWJsZUNoZWNrZXIpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoSGlzdG9yeS5kb3VibGVDaGVja2VyKTtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmRvdWJsZUNoZWNrZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hhaW5cbiAgICAgICAgICAgIHJldHVybiBIaXN0b3J5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmRvdWJsZUNoZWNrKClcbiAgICAgICAgICogQ3JlYXRlIGEgZG91YmxlIGNoZWNrXG4gICAgICAgICAqIEByZXR1cm4ge0hpc3Rvcnl9XG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmRvdWJsZUNoZWNrID0gZnVuY3Rpb24gKHRyeUFnYWluKSB7XG4gICAgICAgICAgICAvLyBSZXNldFxuICAgICAgICAgICAgSGlzdG9yeS5zdGF0ZUNoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIEhpc3RvcnkuZG91YmxlQ2hlY2tDbGVhcigpO1xuXG4gICAgICAgICAgICAvLyBGaXggSUU2LElFNyBidWcgd2hlcmUgY2FsbGluZyBoaXN0b3J5LmJhY2sgb3IgaGlzdG9yeS5mb3J3YXJkIGRvZXMgbm90IGFjdHVhbGx5IGNoYW5nZSB0aGUgaGFzaCAod2hlcmVhcyBkb2luZyBpdCBtYW51YWxseSBkb2VzKVxuICAgICAgICAgICAgLy8gRml4IFNhZmFyaSA1IGJ1ZyB3aGVyZSBzb21ldGltZXMgdGhlIHN0YXRlIGRvZXMgbm90IGNoYW5nZTogaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTQyOTQwXG4gICAgICAgICAgICBpZiAoSGlzdG9yeS5idWdzLmllRG91YmxlQ2hlY2spIHtcbiAgICAgICAgICAgICAgICAvLyBBcHBseSBDaGVja1xuICAgICAgICAgICAgICAgIEhpc3RvcnkuZG91YmxlQ2hlY2tlciA9IHNldFRpbWVvdXQoXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuZG91YmxlQ2hlY2tDbGVhcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFIaXN0b3J5LnN0YXRlQ2hhbmdlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5kb3VibGVDaGVjazogU3RhdGUgaGFzIG5vdCB5ZXQgY2hhbmdlZCwgdHJ5aW5nIGFnYWluJywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZS1BdHRlbXB0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5QWdhaW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5Lm9wdGlvbnMuZG91YmxlQ2hlY2tJbnRlcnZhbFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoYWluXG4gICAgICAgICAgICByZXR1cm4gSGlzdG9yeTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIFNhZmFyaSBCdWcgRml4XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3Rvcnkuc2FmYXJpU3RhdGVQb2xsKClcbiAgICAgICAgICogUG9sbCB0aGUgY3VycmVudCBzdGF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtIaXN0b3J5fVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5zYWZhcmlTdGF0ZVBvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBQb2xsIHRoZSBVUkxcblxuICAgICAgICAgICAgLy8gR2V0IHRoZSBMYXN0IFN0YXRlIHdoaWNoIGhhcyB0aGUgbmV3IFVSTFxuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgdXJsU3RhdGUgPSBIaXN0b3J5LmV4dHJhY3RTdGF0ZShIaXN0b3J5LmdldExvY2F0aW9uSHJlZigpKSxcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZTtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGEgZGlmZmVyZW5jZVxuICAgICAgICAgICAgaWYgKCFIaXN0b3J5LmlzTGFzdFNhdmVkU3RhdGUodXJsU3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgbmV3U3RhdGUgPSB1cmxTdGF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgaGF2ZSBhIHN0YXRlIHdpdGggdGhhdCB1cmxcbiAgICAgICAgICAgIC8vIElmIG5vdCBjcmVhdGUgaXRcbiAgICAgICAgICAgIGlmICghbmV3U3RhdGUpIHtcbiAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3Rvcnkuc2FmYXJpU3RhdGVQb2xsOiBuZXcnKTtcbiAgICAgICAgICAgICAgICBuZXdTdGF0ZSA9IEhpc3RvcnkuY3JlYXRlU3RhdGVPYmplY3QoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXBwbHkgdGhlIE5ldyBTdGF0ZVxuICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5LnNhZmFyaVN0YXRlUG9sbDogdHJpZ2dlcicpO1xuICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLnRyaWdnZXIod2luZG93LCAncG9wc3RhdGUnKTtcblxuICAgICAgICAgICAgLy8gQ2hhaW5cbiAgICAgICAgICAgIHJldHVybiBIaXN0b3J5O1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gU3RhdGUgQWxpYXNlc1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmJhY2socXVldWUpXG4gICAgICAgICAqIFNlbmQgdGhlIGJyb3dzZXIgaGlzdG9yeSBiYWNrIG9uZSBpdGVtXG4gICAgICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gcXVldWUgW29wdGlvbmFsXVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5iYWNrID0gZnVuY3Rpb24gKHF1ZXVlKSB7XG4gICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkuYmFjazogY2FsbGVkJywgYXJndW1lbnRzKTtcblxuICAgICAgICAgICAgLy8gSGFuZGxlIFF1ZXVlaW5nXG4gICAgICAgICAgICBpZiAocXVldWUgIT09IGZhbHNlICYmIEhpc3RvcnkuYnVzeSgpKSB7XG4gICAgICAgICAgICAgICAgLy8gV2FpdCArIFB1c2ggdG8gUXVldWVcbiAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkuYmFjazogd2UgbXVzdCB3YWl0JywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnB1c2hRdWV1ZSh7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiBIaXN0b3J5LFxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogSGlzdG9yeS5iYWNrLFxuICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBxdWV1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTWFrZSBCdXN5ICsgQ29udGludWVcbiAgICAgICAgICAgIEhpc3RvcnkuYnVzeSh0cnVlKTtcblxuICAgICAgICAgICAgLy8gRml4IGNlcnRhaW4gYnJvd3NlciBidWdzIHRoYXQgcHJldmVudCB0aGUgc3RhdGUgZnJvbSBjaGFuZ2luZ1xuICAgICAgICAgICAgSGlzdG9yeS5kb3VibGVDaGVjayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5iYWNrKGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBHbyBiYWNrXG4gICAgICAgICAgICBoaXN0b3J5LmdvKC0xKTtcblxuICAgICAgICAgICAgLy8gRW5kIGJhY2sgY2xvc3VyZVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpc3RvcnkuZm9yd2FyZChxdWV1ZSlcbiAgICAgICAgICogU2VuZCB0aGUgYnJvd3NlciBoaXN0b3J5IGZvcndhcmQgb25lIGl0ZW1cbiAgICAgICAgICogQHBhcmFtIHtJbnRlZ2VyfSBxdWV1ZSBbb3B0aW9uYWxdXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LmZvcndhcmQgPSBmdW5jdGlvbiAocXVldWUpIHtcbiAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5mb3J3YXJkOiBjYWxsZWQnLCBhcmd1bWVudHMpO1xuXG4gICAgICAgICAgICAvLyBIYW5kbGUgUXVldWVpbmdcbiAgICAgICAgICAgIGlmIChxdWV1ZSAhPT0gZmFsc2UgJiYgSGlzdG9yeS5idXN5KCkpIHtcbiAgICAgICAgICAgICAgICAvLyBXYWl0ICsgUHVzaCB0byBRdWV1ZVxuICAgICAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5mb3J3YXJkOiB3ZSBtdXN0IHdhaXQnLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIEhpc3RvcnkucHVzaFF1ZXVlKHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6IEhpc3RvcnksXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBIaXN0b3J5LmZvcndhcmQsXG4gICAgICAgICAgICAgICAgICAgIGFyZ3M6IGFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgcXVldWU6IHF1ZXVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYWtlIEJ1c3kgKyBDb250aW51ZVxuICAgICAgICAgICAgSGlzdG9yeS5idXN5KHRydWUpO1xuXG4gICAgICAgICAgICAvLyBGaXggY2VydGFpbiBicm93c2VyIGJ1Z3MgdGhhdCBwcmV2ZW50IHRoZSBzdGF0ZSBmcm9tIGNoYW5naW5nXG4gICAgICAgICAgICBIaXN0b3J5LmRvdWJsZUNoZWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmZvcndhcmQoZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIEdvIGZvcndhcmRcbiAgICAgICAgICAgIGhpc3RvcnkuZ28oMSk7XG5cbiAgICAgICAgICAgIC8vIEVuZCBmb3J3YXJkIGNsb3N1cmVcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaXN0b3J5LmdvKGluZGV4LHF1ZXVlKVxuICAgICAgICAgKiBTZW5kIHRoZSBicm93c2VyIGhpc3RvcnkgYmFjayBvciBmb3J3YXJkIGluZGV4IHRpbWVzXG4gICAgICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gcXVldWUgW29wdGlvbmFsXVxuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5nbyA9IGZ1bmN0aW9uIChpbmRleCwgcXVldWUpIHtcbiAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5nbzogY2FsbGVkJywgYXJndW1lbnRzKTtcblxuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIGk7XG5cbiAgICAgICAgICAgIC8vIEhhbmRsZVxuICAgICAgICAgICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgICAgICAgICAgIC8vIEZvcndhcmRcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IGluZGV4OyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5mb3J3YXJkKHF1ZXVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgICAgICAgICAvLyBCYWNrd2FyZFxuICAgICAgICAgICAgICAgIGZvciAoaSA9IC0xOyBpID49IGluZGV4OyAtLWkpIHtcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5iYWNrKHF1ZXVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0hpc3RvcnkuZ286IEhpc3RvcnkuZ28gcmVxdWlyZXMgYSBwb3NpdGl2ZSBvciBuZWdhdGl2ZSBpbnRlZ2VyIHBhc3NlZC4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hhaW5cbiAgICAgICAgICAgIHJldHVybiBIaXN0b3J5O1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gSFRNTDUgU3RhdGUgU3VwcG9ydFxuXG4gICAgICAgIC8vIE5vbi1OYXRpdmUgcHVzaFN0YXRlIEltcGxlbWVudGF0aW9uXG4gICAgICAgIGlmIChIaXN0b3J5LmVtdWxhdGVkLnB1c2hTdGF0ZSkge1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAqIFByb3ZpZGUgU2tlbGV0b24gZm9yIEhUTUw0IEJyb3dzZXJzXG4gICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgdmFyIGVtcHR5RnVuY3Rpb24gPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgIEhpc3RvcnkucHVzaFN0YXRlID0gSGlzdG9yeS5wdXNoU3RhdGUgfHwgZW1wdHlGdW5jdGlvbjtcbiAgICAgICAgICAgIEhpc3RvcnkucmVwbGFjZVN0YXRlID0gSGlzdG9yeS5yZXBsYWNlU3RhdGUgfHwgZW1wdHlGdW5jdGlvbjtcbiAgICAgICAgfSAvLyBIaXN0b3J5LmVtdWxhdGVkLnB1c2hTdGF0ZVxuXG4gICAgICAgIC8vIE5hdGl2ZSBwdXNoU3RhdGUgSW1wbGVtZW50YXRpb25cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgICogVXNlIG5hdGl2ZSBIVE1MNSBIaXN0b3J5IEFQSSBJbXBsZW1lbnRhdGlvblxuICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogSGlzdG9yeS5vblBvcFN0YXRlKGV2ZW50LGV4dHJhKVxuICAgICAgICAgICAgICogUmVmcmVzaCB0aGUgQ3VycmVudCBTdGF0ZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBIaXN0b3J5Lm9uUG9wU3RhdGUgPSBmdW5jdGlvbiAoZXZlbnQsIGV4dHJhKSB7XG4gICAgICAgICAgICAgICAgLy8gUHJlcGFyZVxuICAgICAgICAgICAgICAgIHZhciBzdGF0ZUlkID0gZmFsc2UsIG5ld1N0YXRlID0gZmFsc2UsIGN1cnJlbnRIYXNoLCBjdXJyZW50U3RhdGU7XG5cbiAgICAgICAgICAgICAgICAvLyBSZXNldCB0aGUgZG91YmxlIGNoZWNrXG4gICAgICAgICAgICAgICAgSGlzdG9yeS5kb3VibGVDaGVja0NvbXBsZXRlKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgYSBIYXNoLCBhbmQgaGFuZGxlIGFwcG9yaWF0bHlcbiAgICAgICAgICAgICAgICBjdXJyZW50SGFzaCA9IEhpc3RvcnkuZ2V0SGFzaCgpO1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50SGFzaCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBFeHBhbmQgSGFzaFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSBIaXN0b3J5LmV4dHJhY3RTdGF0ZShjdXJyZW50SGFzaCB8fCBIaXN0b3J5LmdldExvY2F0aW9uSHJlZigpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugd2VyZSBhYmxlIHRvIHBhcnNlIGl0LCBpdCBtdXN0IGJlIGEgU3RhdGUhXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBMZXQncyBmb3J3YXJkIHRvIHJlcGxhY2VTdGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy9IaXN0b3J5LmRlYnVnKCdIaXN0b3J5Lm9uUG9wU3RhdGU6IHN0YXRlIGFuY2hvcicsIGN1cnJlbnRIYXNoLCBjdXJyZW50U3RhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5yZXBsYWNlU3RhdGUoY3VycmVudFN0YXRlLmRhdGEsIGN1cnJlbnRTdGF0ZS50aXRsZSwgY3VycmVudFN0YXRlLnVybCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJhZGl0aW9uYWwgQW5jaG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3Rvcnkub25Qb3BTdGF0ZTogdHJhZGl0aW9uYWwgYW5jaG9yJywgY3VycmVudEhhc2gpO1xuICAgICAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLnRyaWdnZXIod2luZG93LCAnYW5jaG9yY2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LmJ1c3koZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgZG9uJ3QgY2FyZSBmb3IgaGFzaGVzXG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuZXhwZWN0ZWRTdGF0ZUlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBFbnN1cmVcbiAgICAgICAgICAgICAgICBzdGF0ZUlkID0gSGlzdG9yeS5BZGFwdGVyLmV4dHJhY3RFdmVudERhdGEoJ3N0YXRlJywgZXZlbnQsIGV4dHJhKSB8fCBmYWxzZTtcblxuICAgICAgICAgICAgICAgIC8vIEZldGNoIFN0YXRlXG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVmFuaWxsYTogQmFjay9mb3J3YXJkIGJ1dHRvbiB3YXMgdXNlZFxuICAgICAgICAgICAgICAgICAgICBuZXdTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGVCeUlkKHN0YXRlSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChIaXN0b3J5LmV4cGVjdGVkU3RhdGVJZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBWYW5pbGxhOiBBIG5ldyBzdGF0ZSB3YXMgcHVzaGVkLCBhbmQgcG9wc3RhdGUgd2FzIGNhbGxlZCBtYW51YWxseVxuICAgICAgICAgICAgICAgICAgICBuZXdTdGF0ZSA9IEhpc3RvcnkuZ2V0U3RhdGVCeUlkKEhpc3RvcnkuZXhwZWN0ZWRTdGF0ZUlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYWwgU3RhdGVcbiAgICAgICAgICAgICAgICAgICAgbmV3U3RhdGUgPSBIaXN0b3J5LmV4dHJhY3RTdGF0ZShIaXN0b3J5LmdldExvY2F0aW9uSHJlZigpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBUaGUgU3RhdGUgZGlkIG5vdCBleGlzdCBpbiBvdXIgc3RvcmVcbiAgICAgICAgICAgICAgICBpZiAoIW5ld1N0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlZ2VuZXJhdGUgdGhlIFN0YXRlXG4gICAgICAgICAgICAgICAgICAgIG5ld1N0YXRlID0gSGlzdG9yeS5jcmVhdGVTdGF0ZU9iamVjdChudWxsLCBudWxsLCBIaXN0b3J5LmdldExvY2F0aW9uSHJlZigpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBDbGVhblxuICAgICAgICAgICAgICAgIEhpc3RvcnkuZXhwZWN0ZWRTdGF0ZUlkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSBhcmUgdGhlIHNhbWUgc3RhdGVcbiAgICAgICAgICAgICAgICBpZiAoSGlzdG9yeS5pc0xhc3RTYXZlZFN0YXRlKG5ld1N0YXRlKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSBoYXMgYmVlbiBubyBjaGFuZ2UgKGp1c3QgdGhlIHBhZ2UncyBoYXNoIGhhcyBmaW5hbGx5IHByb3BhZ2F0ZWQpXG4gICAgICAgICAgICAgICAgICAgIC8vSGlzdG9yeS5kZWJ1ZygnSGlzdG9yeS5vblBvcFN0YXRlOiBubyBjaGFuZ2UnLCBuZXdTdGF0ZSwgSGlzdG9yeS5zYXZlZFN0YXRlcyk7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgU3RhdGVcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnN0b3JlU3RhdGUobmV3U3RhdGUpO1xuICAgICAgICAgICAgICAgIEhpc3Rvcnkuc2F2ZVN0YXRlKG5ld1N0YXRlKTtcblxuICAgICAgICAgICAgICAgIC8vIEZvcmNlIHVwZGF0ZSBvZiB0aGUgdGl0bGVcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnNldFRpdGxlKG5ld1N0YXRlKTtcblxuICAgICAgICAgICAgICAgIC8vIEZpcmUgT3VyIEV2ZW50XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLnRyaWdnZXIod2luZG93LCAnc3RhdGVjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LmJ1c3koZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRydWVcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBIaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csICdwb3BzdGF0ZScsIEhpc3Rvcnkub25Qb3BTdGF0ZSk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogSGlzdG9yeS5wdXNoU3RhdGUoZGF0YSx0aXRsZSx1cmwpXG4gICAgICAgICAgICAgKiBBZGQgYSBuZXcgU3RhdGUgdG8gdGhlIGhpc3Rvcnkgb2JqZWN0LCBiZWNvbWUgaXQsIGFuZCB0cmlnZ2VyIG9ucG9wc3RhdGVcbiAgICAgICAgICAgICAqIFdlIGhhdmUgdG8gdHJpZ2dlciBmb3IgSFRNTDQgY29tcGF0aWJpbGl0eVxuICAgICAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IGRhdGFcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0aXRsZVxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAgICAgICAgICogQHJldHVybiB7dHJ1ZX1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgSGlzdG9yeS5wdXNoU3RhdGUgPSBmdW5jdGlvbiAoZGF0YSwgdGl0bGUsIHVybCwgcXVldWUpIHtcbiAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkucHVzaFN0YXRlOiBjYWxsZWQnLCBhcmd1bWVudHMpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIFN0YXRlXG4gICAgICAgICAgICAgICAgaWYgKEhpc3RvcnkuZ2V0SGFzaEJ5VXJsKHVybCkgJiYgSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdIaXN0b3J5LmpzIGRvZXMgbm90IHN1cHBvcnQgc3RhdGVzIHdpdGggZnJhZ2VtZW50LWlkZW50aWZpZXJzIChoYXNoZXMvYW5jaG9ycykuJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIFF1ZXVlaW5nXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlICE9PSBmYWxzZSAmJiBIaXN0b3J5LmJ1c3koKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXYWl0ICsgUHVzaCB0byBRdWV1ZVxuICAgICAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkucHVzaFN0YXRlOiB3ZSBtdXN0IHdhaXQnLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LnB1c2hRdWV1ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogSGlzdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBIaXN0b3J5LnB1c2hTdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IGFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBxdWV1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIE1ha2UgQnVzeSArIENvbnRpbnVlXG4gICAgICAgICAgICAgICAgSGlzdG9yeS5idXN5KHRydWUpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBuZXdTdGF0ZVxuICAgICAgICAgICAgICAgIHZhciBuZXdTdGF0ZSA9IEhpc3RvcnkuY3JlYXRlU3RhdGVPYmplY3QoZGF0YSwgdGl0bGUsIHVybCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpdFxuICAgICAgICAgICAgICAgIGlmIChIaXN0b3J5LmlzTGFzdFNhdmVkU3RhdGUobmV3U3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdvbid0IGJlIGEgY2hhbmdlXG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeShmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgbmV3U3RhdGVcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5zdG9yZVN0YXRlKG5ld1N0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5leHBlY3RlZFN0YXRlSWQgPSBuZXdTdGF0ZS5pZDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBQdXNoIHRoZSBuZXdTdGF0ZVxuICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZShuZXdTdGF0ZS5pZCwgbmV3U3RhdGUudGl0bGUsIG5ld1N0YXRlLnVybCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRmlyZSBIVE1MNSBFdmVudFxuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LkFkYXB0ZXIudHJpZ2dlcih3aW5kb3csICdwb3BzdGF0ZScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEVuZCBwdXNoU3RhdGUgY2xvc3VyZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBIaXN0b3J5LnJlcGxhY2VTdGF0ZShkYXRhLHRpdGxlLHVybClcbiAgICAgICAgICAgICAqIFJlcGxhY2UgdGhlIFN0YXRlIGFuZCB0cmlnZ2VyIG9ucG9wc3RhdGVcbiAgICAgICAgICAgICAqIFdlIGhhdmUgdG8gdHJpZ2dlciBmb3IgSFRNTDQgY29tcGF0aWJpbGl0eVxuICAgICAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IGRhdGFcbiAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0aXRsZVxuICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgICAgICAgICAgICogQHJldHVybiB7dHJ1ZX1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgSGlzdG9yeS5yZXBsYWNlU3RhdGUgPSBmdW5jdGlvbiAoZGF0YSwgdGl0bGUsIHVybCwgcXVldWUpIHtcbiAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkucmVwbGFjZVN0YXRlOiBjYWxsZWQnLCBhcmd1bWVudHMpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIFN0YXRlXG4gICAgICAgICAgICAgICAgaWYgKEhpc3RvcnkuZ2V0SGFzaEJ5VXJsKHVybCkgJiYgSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdIaXN0b3J5LmpzIGRvZXMgbm90IHN1cHBvcnQgc3RhdGVzIHdpdGggZnJhZ2VtZW50LWlkZW50aWZpZXJzIChoYXNoZXMvYW5jaG9ycykuJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIFF1ZXVlaW5nXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlICE9PSBmYWxzZSAmJiBIaXN0b3J5LmJ1c3koKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXYWl0ICsgUHVzaCB0byBRdWV1ZVxuICAgICAgICAgICAgICAgICAgICAvL0hpc3RvcnkuZGVidWcoJ0hpc3RvcnkucmVwbGFjZVN0YXRlOiB3ZSBtdXN0IHdhaXQnLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LnB1c2hRdWV1ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogSGlzdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBIaXN0b3J5LnJlcGxhY2VTdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IGFyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlOiBxdWV1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIE1ha2UgQnVzeSArIENvbnRpbnVlXG4gICAgICAgICAgICAgICAgSGlzdG9yeS5idXN5KHRydWUpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBuZXdTdGF0ZVxuICAgICAgICAgICAgICAgIHZhciBuZXdTdGF0ZSA9IEhpc3RvcnkuY3JlYXRlU3RhdGVPYmplY3QoZGF0YSwgdGl0bGUsIHVybCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpdFxuICAgICAgICAgICAgICAgIGlmIChIaXN0b3J5LmlzTGFzdFNhdmVkU3RhdGUobmV3U3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdvbid0IGJlIGEgY2hhbmdlXG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuYnVzeShmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgbmV3U3RhdGVcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5zdG9yZVN0YXRlKG5ld1N0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5leHBlY3RlZFN0YXRlSWQgPSBuZXdTdGF0ZS5pZDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBQdXNoIHRoZSBuZXdTdGF0ZVxuICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShuZXdTdGF0ZS5pZCwgbmV3U3RhdGUudGl0bGUsIG5ld1N0YXRlLnVybCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRmlyZSBIVE1MNSBFdmVudFxuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LkFkYXB0ZXIudHJpZ2dlcih3aW5kb3csICdwb3BzdGF0ZScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEVuZCByZXBsYWNlU3RhdGUgY2xvc3VyZVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICB9IC8vICFIaXN0b3J5LmVtdWxhdGVkLnB1c2hTdGF0ZVxuXG5cbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gSW5pdGlhbGlzZVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2FkIHRoZSBTdG9yZVxuICAgICAgICAgKi9cbiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlKSB7XG4gICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBIaXN0b3J5LnN0b3JlID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdIaXN0b3J5LnN0b3JlJykpIHx8IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmUgPSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTm9ybWFsaXplXG4gICAgICAgICAgICBIaXN0b3J5Lm5vcm1hbGl6ZVN0b3JlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBEZWZhdWx0IExvYWRcbiAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmUgPSB7fTtcbiAgICAgICAgICAgIEhpc3Rvcnkubm9ybWFsaXplU3RvcmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbGVhciBJbnRlcnZhbHMgb24gZXhpdCB0byBwcmV2ZW50IG1lbW9yeSBsZWFrc1xuICAgICAgICAgKi9cbiAgICAgICAgSGlzdG9yeS5BZGFwdGVyLmJpbmQod2luZG93LCBcInVubG9hZFwiLCBIaXN0b3J5LmNsZWFyQWxsSW50ZXJ2YWxzKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ3JlYXRlIHRoZSBpbml0aWFsIFN0YXRlXG4gICAgICAgICAqL1xuICAgICAgICBIaXN0b3J5LnNhdmVTdGF0ZShIaXN0b3J5LnN0b3JlU3RhdGUoSGlzdG9yeS5leHRyYWN0U3RhdGUoSGlzdG9yeS5nZXRMb2NhdGlvbkhyZWYoKSwgdHJ1ZSkpKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQmluZCBmb3IgU2F2aW5nIFN0b3JlXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UpIHtcbiAgICAgICAgICAgIC8vIFdoZW4gdGhlIHBhZ2UgaXMgY2xvc2VkXG4gICAgICAgICAgICBIaXN0b3J5Lm9uVW5sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIFByZXBhcmVcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFN0b3JlLCBpdGVtLCBjdXJyZW50U3RvcmVTdHJpbmc7XG5cbiAgICAgICAgICAgICAgICAvLyBGZXRjaFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdG9yZSA9IEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnSGlzdG9yeS5zdG9yZScpKSB8fCB7fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RvcmUgPSB7fTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBFbnN1cmVcbiAgICAgICAgICAgICAgICBjdXJyZW50U3RvcmUuaWRUb1N0YXRlID0gY3VycmVudFN0b3JlLmlkVG9TdGF0ZSB8fCB7fTtcbiAgICAgICAgICAgICAgICBjdXJyZW50U3RvcmUudXJsVG9JZCA9IGN1cnJlbnRTdG9yZS51cmxUb0lkIHx8IHt9O1xuICAgICAgICAgICAgICAgIGN1cnJlbnRTdG9yZS5zdGF0ZVRvSWQgPSBjdXJyZW50U3RvcmUuc3RhdGVUb0lkIHx8IHt9O1xuXG4gICAgICAgICAgICAgICAgLy8gU3luY1xuICAgICAgICAgICAgICAgIGZvciAoaXRlbSBpbiBIaXN0b3J5LmlkVG9TdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUhpc3RvcnkuaWRUb1N0YXRlLmhhc093blByb3BlcnR5KGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RvcmUuaWRUb1N0YXRlW2l0ZW1dID0gSGlzdG9yeS5pZFRvU3RhdGVbaXRlbV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZvciAoaXRlbSBpbiBIaXN0b3J5LnVybFRvSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFIaXN0b3J5LnVybFRvSWQuaGFzT3duUHJvcGVydHkoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdG9yZS51cmxUb0lkW2l0ZW1dID0gSGlzdG9yeS51cmxUb0lkW2l0ZW1dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGl0ZW0gaW4gSGlzdG9yeS5zdGF0ZVRvSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFIaXN0b3J5LnN0YXRlVG9JZC5oYXNPd25Qcm9wZXJ0eShpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0b3JlLnN0YXRlVG9JZFtpdGVtXSA9IEhpc3Rvcnkuc3RhdGVUb0lkW2l0ZW1dO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZVxuICAgICAgICAgICAgICAgIEhpc3Rvcnkuc3RvcmUgPSBjdXJyZW50U3RvcmU7XG4gICAgICAgICAgICAgICAgSGlzdG9yeS5ub3JtYWxpemVTdG9yZSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gSW4gU2FmYXJpLCBnb2luZyBpbnRvIFByaXZhdGUgQnJvd3NpbmcgbW9kZSBjYXVzZXMgdGhlXG4gICAgICAgICAgICAgICAgLy8gU2Vzc2lvbiBTdG9yYWdlIG9iamVjdCB0byBzdGlsbCBleGlzdCBidXQgaWYgeW91IHRyeSBhbmQgdXNlXG4gICAgICAgICAgICAgICAgLy8gb3Igc2V0IGFueSBwcm9wZXJ0eS9mdW5jdGlvbiBvZiBpdCBpdCB0aHJvd3MgdGhlIGV4Y2VwdGlvblxuICAgICAgICAgICAgICAgIC8vIFwiUVVPVEFfRVhDRUVERURfRVJSOiBET00gRXhjZXB0aW9uIDIyOiBBbiBhdHRlbXB0IHdhcyBtYWRlIHRvXG4gICAgICAgICAgICAgICAgLy8gYWRkIHNvbWV0aGluZyB0byBzdG9yYWdlIHRoYXQgZXhjZWVkZWQgdGhlIHF1b3RhLlwiIGluZmluaXRlbHlcbiAgICAgICAgICAgICAgICAvLyBldmVyeSBzZWNvbmQuXG4gICAgICAgICAgICAgICAgY3VycmVudFN0b3JlU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoY3VycmVudFN0b3JlKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTdG9yZVxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdIaXN0b3J5LnN0b3JlJywgY3VycmVudFN0b3JlU3RyaW5nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuY29kZSA9PT0gRE9NRXhjZXB0aW9uLlFVT1RBX0VYQ0VFREVEX0VSUikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdvcmthcm91bmQgZm9yIGEgYnVnIHNlZW4gb24gaVBhZHMuIFNvbWV0aW1lcyB0aGUgcXVvdGEgZXhjZWVkZWQgZXJyb3IgY29tZXMgdXAgYW5kIHNpbXBseVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbW92aW5nL3Jlc2V0dGluZyB0aGUgc3RvcmFnZSBjYW4gd29yay5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdIaXN0b3J5LnN0b3JlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnSGlzdG9yeS5zdG9yZScsIGN1cnJlbnRTdG9yZVN0cmluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgd2UncmUgcHJvYmFibHkgcHJpdmF0ZSBicm93c2luZyBpbiBTYWZhcmksIHNvIHdlJ2xsIGlnbm9yZSB0aGUgZXhjZXB0aW9uLlxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIEZvciBJbnRlcm5ldCBFeHBsb3JlclxuICAgICAgICAgICAgSGlzdG9yeS5pc0ludGVybmV0RXhwbG9yZXIoKSAmJiBIaXN0b3J5LmludGVydmFsTGlzdC5wdXNoKHNldEludGVydmFsKEhpc3Rvcnkub25VbmxvYWQsIEhpc3Rvcnkub3B0aW9ucy5zdG9yZUludGVydmFsKSk7XG5cbiAgICAgICAgICAgIC8vIEZvciBPdGhlciBCcm93c2Vyc1xuICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLmJpbmQod2luZG93LCAnYmVmb3JldW5sb2FkJywgSGlzdG9yeS5vblVubG9hZCk7XG4gICAgICAgICAgICBIaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csICd1bmxvYWQnLCBIaXN0b3J5Lm9uVW5sb2FkKTtcblxuICAgICAgICAgICAgLy8gQm90aCBhcmUgZW5hYmxlZCBmb3IgY29uc2lzdGVuY3lcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vbi1OYXRpdmUgcHVzaFN0YXRlIEltcGxlbWVudGF0aW9uXG4gICAgICAgIGlmICghSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGUpIHtcbiAgICAgICAgICAgIC8vIEJlIGF3YXJlLCB0aGUgZm9sbG93aW5nIGlzIG9ubHkgZm9yIG5hdGl2ZSBwdXNoU3RhdGUgaW1wbGVtZW50YXRpb25zXG4gICAgICAgICAgICAvLyBJZiB5b3UgYXJlIHdhbnRpbmcgdG8gaW5jbHVkZSBzb21ldGhpbmcgZm9yIGFsbCBicm93c2Vyc1xuICAgICAgICAgICAgLy8gVGhlbiBpbmNsdWRlIGl0IGFib3ZlIHRoaXMgaWYgYmxvY2tcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBTZXR1cCBTYWZhcmkgRml4XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmIChIaXN0b3J5LmJ1Z3Muc2FmYXJpUG9sbCkge1xuICAgICAgICAgICAgICAgIEhpc3RvcnkuaW50ZXJ2YWxMaXN0LnB1c2goc2V0SW50ZXJ2YWwoSGlzdG9yeS5zYWZhcmlTdGF0ZVBvbGwsIEhpc3Rvcnkub3B0aW9ucy5zYWZhcmlQb2xsSW50ZXJ2YWwpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBFbnN1cmUgQ3Jvc3MgQnJvd3NlciBDb21wYXRpYmlsaXR5XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IudmVuZG9yID09PSAnQXBwbGUgQ29tcHV0ZXIsIEluYy4nIHx8IChuYXZpZ2F0b3IuYXBwQ29kZU5hbWUgfHwgJycpID09PSAnTW96aWxsYScpIHtcbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBGaXggU2FmYXJpIEhhc2hDaGFuZ2UgSXNzdWVcbiAgICAgICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgICAgICAgICAvLyBTZXR1cCBBbGlhc1xuICAgICAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci5iaW5kKHdpbmRvdywgJ2hhc2hjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci50cmlnZ2VyKHdpbmRvdywgJ3BvcHN0YXRlJyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXNlIEFsaWFzXG4gICAgICAgICAgICAgICAgaWYgKEhpc3RvcnkuZ2V0SGFzaCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIEhpc3RvcnkuQWRhcHRlci5vbkRvbUxvYWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5BZGFwdGVyLnRyaWdnZXIod2luZG93LCAnaGFzaGNoYW5nZScpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSAvLyAhSGlzdG9yeS5lbXVsYXRlZC5wdXNoU3RhdGVcblxuXG4gICAgfTsgLy8gSGlzdG9yeS5pbml0Q29yZVxuXG4gICAgLy8gVHJ5IHRvIEluaXRpYWxpc2UgSGlzdG9yeVxuICAgIGlmICghSGlzdG9yeS5vcHRpb25zIHx8ICFIaXN0b3J5Lm9wdGlvbnMuZGVsYXlJbml0KSB7XG4gICAgICAgIEhpc3RvcnkuaW5pdCgpO1xuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBIaXN0b3J5OyIsInZhciBwcmltZSAgICAgID0gcmVxdWlyZSgncHJpbWUnKSxcbiAgICBkZWVwQ2xvbmUgID0gcmVxdWlyZSgnbW91dC9sYW5nL2RlZXBDbG9uZScpLFxuICAgIG9iamVjdERpZmYgPSByZXF1aXJlKCdvYmplY3RkaWZmJyk7XG5cbnZhciBTYXZlU3RhdGUgPSBuZXcgcHJpbWUoe1xuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uKHNlc3Npb24pIHtcbiAgICAgICAgc2Vzc2lvbiA9IGRlZXBDbG9uZShzZXNzaW9uKTtcbiAgICAgICAgdGhpcy5zZXRTZXNzaW9uKHNlc3Npb24pO1xuICAgIH0sXG5cbiAgICBzZXRTZXNzaW9uOiBmdW5jdGlvbihzZXNzaW9uKSB7XG4gICAgICAgIHNlc3Npb24gPSAhc2Vzc2lvbiA/IHt9XG4gICAgICAgICAgICA6IHtcbiAgICAgICAgICAgIHRpbWU6ICsobmV3IERhdGUoKSksXG4gICAgICAgICAgICBkYXRhOiBkZWVwQ2xvbmUoc2Vzc2lvbilcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uO1xuICAgIH0sXG5cbiAgICBnZXRUaW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi50aW1lO1xuICAgIH0sXG5cbiAgICBnZXREYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi5kYXRhO1xuICAgIH0sXG5cbiAgICBnZXRTZXNzaW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbjtcbiAgICB9LFxuXG4gICAgZ2V0RGlmZjogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICB2YXIgZGlmZiA9IG9iamVjdERpZmYuZGlmZih0aGlzLmdldERhdGEoKSwgZGF0YSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkaWZmOiBkaWZmLFxuICAgICAgICAgICAgeG1sOiBvYmplY3REaWZmLmNvbnZlcnRUb1hNTFN0cmluZyhkaWZmKVxuICAgICAgICB9O1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNhdmVTdGF0ZTtcbiIsIi8qXG5BZ2VudFxuLSBoZWF2aWx5IGluc3BpcmVkIGJ5IHN1cGVyYWdlbnQgYnkgdmlzaW9ubWVkaWEgaHR0cHM6Ly9naXRodWIuY29tL3Zpc2lvbm1lZGlhL3N1cGVyYWdlbnQsIHJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuLSBjb2RlIGRlcml2ZWQgZnJvbSBNb29Ub29scyAxLjQgUmVxdWVzdC5qcyAmJiBzdXBlcmFnZW50XG4tIE1JVC1MaWNlbnNlXG4qL1widXNlIHN0cmljdFwiO1xuLyogZ2xvYmFsIEFjdGl2ZVhPYmplY3QgKi9cblxudmFyIHByaW1lICAgPSByZXF1aXJlKFwicHJpbWVcIiksXG4gICAgRW1pdHRlciA9IHJlcXVpcmUoXCJwcmltZS9lbWl0dGVyXCIpXG5cbnZhciBpc09iamVjdCAgID0gcmVxdWlyZShcIm1vdXQvbGFuZy9pc09iamVjdFwiKSxcbiAgICBpc1N0cmluZyAgID0gcmVxdWlyZShcIm1vdXQvbGFuZy9pc1N0cmluZ1wiKSxcbiAgICBpc0FycmF5ICAgID0gcmVxdWlyZShcIm1vdXQvbGFuZy9pc0FycmF5XCIpLFxuICAgIGlzRnVuY3Rpb24gPSByZXF1aXJlKFwibW91dC9sYW5nL2lzRnVuY3Rpb25cIiksXG4gICAgdHJpbSAgICAgICA9IHJlcXVpcmUoXCJtb3V0L3N0cmluZy90cmltXCIpLFxuICAgIHVwcGVyQ2FzZSAgPSByZXF1aXJlKFwibW91dC9zdHJpbmcvdXBwZXJDYXNlXCIpLFxuICAgIGZvckluICAgICAgPSByZXF1aXJlKFwibW91dC9vYmplY3QvZm9ySW5cIiksXG4gICAgbWl4SW4gICAgICA9IHJlcXVpcmUoXCJtb3V0L29iamVjdC9taXhJblwiKSxcbiAgICByZW1vdmUgICAgID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvcmVtb3ZlXCIpLFxuICAgIGZvckVhY2ggICAgPSByZXF1aXJlKFwibW91dC9hcnJheS9mb3JFYWNoXCIpXG5cbnZhciBjYXBpdGFsaXplID0gZnVuY3Rpb24oc3RyKXtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1xcYlthLXpdL2csIHVwcGVyQ2FzZSlcbn1cblxuLy8gTW9vVG9vbHNcblxudmFyIGdldFJlcXVlc3QgPSAoZnVuY3Rpb24oKXtcblxuICAgIHZhciBYTUxIVFRQID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpXG4gICAgfSwgTVNYTUwyID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KFwiTVNYTUwyLlhNTEhUVFBcIilcbiAgICB9LCBNU1hNTCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxIVFRQXCIpXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIFhNTEhUVFAoKVxuICAgICAgcmV0dXJuIFhNTEhUVFBcbiAgICB9IGNhdGNoKGUpe31cbiAgICB0cnkge1xuICAgICAgICBNU1hNTDIoKVxuICAgICAgICByZXR1cm4gTVNYTUwyXG4gICAgfSBjYXRjaChlKXt9XG4gICAgdHJ5IHtcbiAgICAgICAgTVNYTUwoKVxuICAgICAgICByZXR1cm4gTVNYTUxcbiAgICB9IGNhdGNoKGUpe31cblxuICAgIHJldHVybiBudWxsXG5cbn0pKClcblxudmFyIGVuY29kZUpTT04gPSBmdW5jdGlvbihvYmplY3Qpe1xuICAgIGlmIChvYmplY3QgPT0gbnVsbCkgcmV0dXJuIFwiXCJcbiAgICBpZiAob2JqZWN0LnRvSlNPTikgcmV0dXJuIG9iamVjdC50b0pTT04oKVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmplY3QpXG59XG5cbi8vIE1vb1Rvb2xzXG5cbnZhciBlbmNvZGVRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKG9iamVjdCwgYmFzZSl7XG5cbiAgICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiBcIlwiXG4gICAgaWYgKG9iamVjdC50b1F1ZXJ5U3RyaW5nKSByZXR1cm4gb2JqZWN0LnRvUXVlcnlTdHJpbmcoKVxuXG4gICAgdmFyIHF1ZXJ5U3RyaW5nID0gW11cblxuICAgIGZvckluKG9iamVjdCwgZnVuY3Rpb24odmFsdWUsIGtleSl7XG4gICAgICAgIGlmIChiYXNlKSBrZXkgPSBiYXNlICsgXCJbXCIgKyBrZXkgKyBcIl1cIlxuICAgICAgICB2YXIgcmVzdWx0XG5cbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHJldHVyblxuXG4gICAgICAgIGlmIChpc0FycmF5KHZhbHVlKSl7XG4gICAgICAgICAgICB2YXIgcXMgPSB7fVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykgcXNbaV0gPSB2YWx1ZVtpXVxuICAgICAgICAgICAgcmVzdWx0ID0gZW5jb2RlUXVlcnlTdHJpbmcocXMsIGtleSlcbiAgICAgICAgfSBlbHNlIGlmIChpc09iamVjdCh2YWx1ZSkpe1xuICAgICAgICAgICAgcmVzdWx0ID0gZW5jb2RlUXVlcnlTdHJpbmcodmFsdWUsIGtleSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGtleSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKVxuICAgICAgICB9XG5cbiAgICAgICAgcXVlcnlTdHJpbmcucHVzaChyZXN1bHQpXG4gICAgfSlcblxuICAgIHJldHVybiBxdWVyeVN0cmluZy5qb2luKFwiJlwiKVxuXG59XG5cbnZhciBkZWNvZGVKU09OID0gSlNPTi5wYXJzZVxuXG4vLyBkZWNvZGVRdWVyeVN0cmluZyBieSBCcmlhbiBEb25vdmFuXG4vLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vdXNlcnMvNTQ5MzYzL2JyaWFuLWRvbm92YW5cblxudmFyIGRlY29kZVF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24ocGFyYW1zKXtcblxuICAgIHZhciBwYWlycyAgPSBwYXJhbXMuc3BsaXQoJyYnKSxcbiAgICAgICAgcmVzdWx0ID0ge31cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspe1xuXG4gICAgICAgIHZhciBwYWlyICAgICAgPSBwYWlyc1tpXS5zcGxpdCgnPScpLFxuICAgICAgICAgICAga2V5ICAgICAgID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMF0pLFxuICAgICAgICAgICAgdmFsdWUgICAgID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMV0pLFxuICAgICAgICAgICAgaXNBcnJheSAgID0gL1xcW1xcXSQvLnRlc3Qoa2V5KSxcbiAgICAgICAgICAgIGRpY3RNYXRjaCA9IGtleS5tYXRjaCgvXiguKylcXFsoW15cXF1dKylcXF0kLylcblxuICAgICAgICBpZiAoZGljdE1hdGNoKXtcbiAgICAgICAgICAgIGtleSA9IGRpY3RNYXRjaFsxXVxuICAgICAgICAgICAgdmFyIHN1YmtleSA9IGRpY3RNYXRjaFsyXVxuXG4gICAgICAgICAgICByZXN1bHRba2V5XSA9IHJlc3VsdFtrZXldIHx8IHt9XG4gICAgICAgICAgICByZXN1bHRba2V5XVtzdWJrZXldID0gdmFsdWVcbiAgICAgICAgfSBlbHNlIGlmIChpc0FycmF5KXtcbiAgICAgICAgICAgIGtleSA9IGtleS5zdWJzdHJpbmcoMCwga2V5Lmxlbmd0aCAtIDIpXG4gICAgICAgICAgICByZXN1bHRba2V5XSA9IHJlc3VsdFtrZXldIHx8IFtdXG4gICAgICAgICAgICByZXN1bHRba2V5XS5wdXNoKHZhbHVlKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG5cbn1cblxudmFyIGVuY29kZXJzID0ge1xuICAgIFwiYXBwbGljYXRpb24vanNvblwiIDogZW5jb2RlSlNPTixcbiAgICBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiIDogZW5jb2RlUXVlcnlTdHJpbmdcbn1cblxudmFyIGRlY29kZXJzID0ge1xuICAgIFwiYXBwbGljYXRpb24vanNvblwiOiBkZWNvZGVKU09OLFxuICAgIFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCI6IGRlY29kZVF1ZXJ5U3RyaW5nXG59XG5cbi8vIHBhcnNlSGVhZGVyIGZyb20gc3VwZXJhZ2VudFxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3Zpc2lvbm1lZGlhL3N1cGVyYWdlbnRcbi8vIE1JVFxuXG52YXIgcGFyc2VIZWFkZXIgPSBmdW5jdGlvbihzdHIpe1xuICAgIHZhciBsaW5lcyA9IHN0ci5zcGxpdCgvXFxyP1xcbi8pLCBmaWVsZHMgPSB7fVxuXG4gICAgbGluZXMucG9wKCkgLy8gdHJhaWxpbmcgQ1JMRlxuXG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBsaW5lcy5sZW5ndGg7IGkgPCBsOyArK2kpe1xuICAgICAgICB2YXIgbGluZSAgPSBsaW5lc1tpXSxcbiAgICAgICAgICAgIGluZGV4ID0gbGluZS5pbmRleE9mKCc6JyksXG4gICAgICAgICAgICBmaWVsZCA9IGNhcGl0YWxpemUobGluZS5zbGljZSgwLCBpbmRleCkpLFxuICAgICAgICAgICAgdmFsdWUgPSB0cmltKGxpbmUuc2xpY2UoaW5kZXggKyAxKSlcblxuICAgICAgICBmaWVsZHNbZmllbGRdID0gdmFsdWVcbiAgICB9XG5cbiAgICByZXR1cm4gZmllbGRzXG59XG5cbnZhciBSRVFVRVNUUyA9IDAsIFEgPSBbXSAvLyBRdWV1ZSBzdHVmZlxuXG52YXIgUmVxdWVzdCA9IHByaW1lKHtcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBSZXF1ZXN0KCl7XG4gICAgICAgIHRoaXMuX2hlYWRlciA9IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCJcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBoZWFkZXI6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKXtcbiAgICAgICAgaWYgKGlzT2JqZWN0KG5hbWUpKSBmb3IgKHZhciBrZXkgaW4gbmFtZSkgdGhpcy5oZWFkZXIoa2V5LCBuYW1lW2tleV0pXG4gICAgICAgIGVsc2UgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGhpcy5faGVhZGVyXG4gICAgICAgIGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHJldHVybiB0aGlzLl9oZWFkZXJbY2FwaXRhbGl6ZShuYW1lKV1cbiAgICAgICAgZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMil7XG4gICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgZGVsZXRlIHRoaXMuX2hlYWRlcltjYXBpdGFsaXplKG5hbWUpXVxuICAgICAgICAgICAgZWxzZSB0aGlzLl9oZWFkZXJbY2FwaXRhbGl6ZShuYW1lKV0gPSB2YWx1ZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIHJ1bm5pbmc6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAhIXRoaXMuX3J1bm5pbmdcbiAgICB9LFxuXG4gICAgYWJvcnQ6IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgaWYgKHRoaXMuX3F1ZXVlZCl7XG4gICAgICAgICAgICByZW1vdmUoUSwgdGhpcy5fcXVldWVkKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3F1ZXVlZFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX3hocil7XG4gICAgICAgICAgICB0aGlzLl94aHIuYWJvcnQoKVxuICAgICAgICAgICAgdGhpcy5fZW5kKClcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIG1ldGhvZDogZnVuY3Rpb24obSl7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRoaXMuX21ldGhvZFxuICAgICAgICB0aGlzLl9tZXRob2QgPSBtLnRvVXBwZXJDYXNlKClcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgZGF0YTogZnVuY3Rpb24oZCl7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRoaXMuX2RhdGFcbiAgICAgICAgdGhpcy5fZGF0YSA9IGRcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgdXJsOiBmdW5jdGlvbih1KXtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGhpcy5fdXJsXG4gICAgICAgIHRoaXMuX3VybCA9IHVcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgdXNlcjogZnVuY3Rpb24odSl7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRoaXMuX3VzZXJcbiAgICAgICAgdGhpcy5fdXNlciA9IHVcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgcGFzc3dvcmQ6IGZ1bmN0aW9uKHApe1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aGlzLl9wYXNzd29yZFxuICAgICAgICB0aGlzLl9wYXNzd29yZCA9IHBcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgX3NlbmQ6IGZ1bmN0aW9uKG1ldGhvZCwgdXJsLCBkYXRhLCBoZWFkZXIsIHVzZXIsIHBhc3N3b3JkLCBjYWxsYmFjayl7XG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xuXG4gICAgICAgIGlmIChSRVFVRVNUUyA9PT0gYWdlbnQuTUFYX1JFUVVFU1RTKSByZXR1cm4gUS51bnNoaWZ0KHRoaXMuX3F1ZXVlZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBkZWxldGUgc2VsZi5fcXVldWVkXG4gICAgICAgICAgICBzZWxmLl9zZW5kKG1ldGhvZCwgdXJsLCBkYXRhLCBoZWFkZXIsIHVzZXIsIHBhc3N3b3JkLCBjYWxsYmFjaylcbiAgICAgICAgfSlcblxuICAgICAgICBSRVFVRVNUUysrXG5cbiAgICAgICAgdmFyIHhociA9IHRoaXMuX3hociA9IGFnZW50LmdldFJlcXVlc3QoKVxuXG4gICAgICAgIGlmICh4aHIuYWRkRXZlbnRMaXN0ZW5lcikgZm9yRWFjaChbJ3Byb2dyZXNzJywgJ2xvYWQnLCAnZXJyb3InICwgJ2Fib3J0JywgJ2xvYWRlbmQnXSwgZnVuY3Rpb24obWV0aG9kKXtcbiAgICAgICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKG1ldGhvZCwgZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICAgICAgICAgIHNlbGYuZW1pdChtZXRob2QsIGV2ZW50KVxuICAgICAgICAgICAgfSwgZmFsc2UpXG4gICAgICAgIH0pXG5cbiAgICAgICAgeGhyLm9wZW4obWV0aG9kLCB1cmwsIHRydWUsIHVzZXIsIHBhc3N3b3JkKVxuICAgICAgICBpZiAodXNlciAhPSBudWxsICYmIFwid2l0aENyZWRlbnRpYWxzXCIgaW4geGhyKSB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZVxuXG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KXtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0geGhyLnN0YXR1c1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG5ldyBSZXNwb25zZSh4aHIucmVzcG9uc2VUZXh0LCBzdGF0dXMsIHBhcnNlSGVhZGVyKHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSkpXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gcmVzcG9uc2UuZXJyb3IgPyBuZXcgRXJyb3IobWV0aG9kICsgXCIgXCIgKyB1cmwgKyBcIiBcIiArIHN0YXR1cykgOiBudWxsXG4gICAgICAgICAgICAgICAgc2VsZi5fZW5kKClcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgcmVzcG9uc2UpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBmaWVsZCBpbiBoZWFkZXIpIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGZpZWxkLCBoZWFkZXJbZmllbGRdKVxuICAgICAgICB4aHIuc2VuZChkYXRhIHx8IG51bGwpXG4gICAgfSxcblxuICAgIF9lbmQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuX3hoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpe31cblxuICAgICAgICBkZWxldGUgdGhpcy5feGhyXG4gICAgICAgIGRlbGV0ZSB0aGlzLl9ydW5uaW5nXG5cbiAgICAgICAgUkVRVUVTVFMtLVxuXG4gICAgICAgIHZhciBxdWV1ZWQgPSBRLnBvcCgpXG4gICAgICAgIGlmIChxdWV1ZWQpIHF1ZXVlZCgpXG4gICAgfSxcblxuICAgIHNlbmQ6IGZ1bmN0aW9uKGNhbGxiYWNrKXtcbiAgICAgICAgaWYgKHRoaXMuX3J1bm5pbmcpIHRoaXMuYWJvcnQoKVxuICAgICAgICB0aGlzLl9ydW5uaW5nID0gdHJ1ZVxuXG4gICAgICAgIGlmICghY2FsbGJhY2spIGNhbGxiYWNrID0gZnVuY3Rpb24oKXt9XG5cbiAgICAgICAgdmFyIG1ldGhvZCAgID0gdGhpcy5fbWV0aG9kIHx8IFwiUE9TVFwiLFxuICAgICAgICAgICAgZGF0YSAgICAgPSB0aGlzLl9kYXRhIHx8IG51bGwsXG4gICAgICAgICAgICB1cmwgICAgICA9IHRoaXMuX3VybCxcbiAgICAgICAgICAgIHVzZXIgICAgID0gdGhpcy5fdXNlciB8fCBudWxsLFxuICAgICAgICAgICAgcGFzc3dvcmQgPSB0aGlzLl9wYXNzd29yZCB8fCBudWxsXG5cbiAgICAgICAgaWYgKGRhdGEgJiYgIWlzU3RyaW5nKGRhdGEpKXtcbiAgICAgICAgICAgIHZhciBjb250ZW50VHlwZSA9IHRoaXMuX2hlYWRlclsnQ29udGVudC1UeXBlJ10uc3BsaXQoLyAqOyAqLykuc2hpZnQoKSxcbiAgICAgICAgICAgICAgICBlbmNvZGUgICAgICA9IGVuY29kZXJzW2NvbnRlbnRUeXBlXVxuICAgICAgICAgICAgaWYgKGVuY29kZSkgZGF0YSA9IGVuY29kZShkYXRhKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKC9HRVR8SEVBRC8udGVzdChtZXRob2QpICYmIGRhdGEpIHVybCArPSAodXJsLmluZGV4T2YoXCI/XCIpID4gLTEgPyBcIiZcIiA6IFwiP1wiKSArIGRhdGFcblxuICAgICAgICB2YXIgaGVhZGVyID0gbWl4SW4oe30sIHRoaXMuX2hlYWRlcik7XG5cbiAgICAgICAgdGhpcy5fc2VuZChtZXRob2QsIHVybCwgZGF0YSwgaGVhZGVyLCB1c2VyLCBwYXNzd29yZCwgY2FsbGJhY2spXG5cbiAgICAgICAgcmV0dXJuIHRoaXNcblxuICAgIH1cblxufSlcblxuUmVxdWVzdC5pbXBsZW1lbnQobmV3IEVtaXR0ZXIpXG5cbnZhciBSZXNwb25zZSA9IHByaW1lKHtcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBSZXNwb25zZSh0ZXh0LCBzdGF0dXMsIGhlYWRlcil7XG5cbiAgICAgICAgdGhpcy50ZXh0ICAgPSB0ZXh0XG4gICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzXG5cbiAgICAgICAgdGhpcy5oZWFkZXIgPSBoZWFkZXJcblxuICAgICAgICAvLyBzdGF0dXNlcyBmcm9tIHN1cGVyYWdlbnRcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Zpc2lvbm1lZGlhL3N1cGVyYWdlbnRcbiAgICAgICAgLy8gTUlUXG5cbiAgICAgICAgdmFyIHQgPSBzdGF0dXMgLyAxMDAgfCAwXG5cbiAgICAgICAgdGhpcy5pbmZvICAgICAgICA9IHQgPT09IDFcbiAgICAgICAgdGhpcy5vayAgICAgICAgICA9IHQgPT09IDJcbiAgICAgICAgdGhpcy5jbGllbnRFcnJvciA9IHQgPT09IDRcbiAgICAgICAgdGhpcy5zZXJ2ZXJFcnJvciA9IHQgPT09IDVcbiAgICAgICAgdGhpcy5lcnJvciAgICAgICA9IHQgPT09IDQgfHwgdCA9PT0gNVxuICAgICAgICB2YXIgbGVuZ3RoID0gJycgKyBoZWFkZXJbJ0NvbnRlbnQtTGVuZ3RoJ11cblxuICAgICAgICAvLyBzdWdhclxuICAgICAgICB0aGlzLmFjY2VwdGVkICAgICAgPSBzdGF0dXMgPT09IDIwMlxuICAgICAgICB0aGlzLm5vQ29udGVudCAgICAgPSBsZW5ndGggPT09ICcwJyB8fCBzdGF0dXMgPT09IDIwNCB8fCBzdGF0dXMgPT09IDEyMjNcbiAgICAgICAgdGhpcy5iYWRSZXF1ZXN0ICAgID0gc3RhdHVzID09PSA0MDBcbiAgICAgICAgdGhpcy51bmF1dGhvcml6ZWQgID0gc3RhdHVzID09PSA0MDFcbiAgICAgICAgdGhpcy5ub3RBY2NlcHRhYmxlID0gc3RhdHVzID09PSA0MDZcbiAgICAgICAgdGhpcy5ub3RGb3VuZCAgICAgID0gc3RhdHVzID09PSA0MDRcblxuICAgICAgICB2YXIgY29udGVudFR5cGUgPSBoZWFkZXJbJ0NvbnRlbnQtVHlwZSddID8gaGVhZGVyWydDb250ZW50LVR5cGUnXS5zcGxpdCgvICo7ICovKS5zaGlmdCgpIDogJycsXG4gICAgICAgICAgICBkZWNvZGVcblxuICAgICAgICBpZiAoIXRoaXMubm9Db250ZW50KSBkZWNvZGUgPSBkZWNvZGVyc1tjb250ZW50VHlwZV1cblxuICAgICAgICB0aGlzLmJvZHkgPSBkZWNvZGUgPyBkZWNvZGUodGhpcy50ZXh0KSA6IHRoaXMudGV4dFxuXG4gICAgfVxuXG59KVxuXG52YXIgbWV0aG9kcyAgPSBcImdldHxwb3N0fHB1dHxkZWxldGV8aGVhZHxwYXRjaHxvcHRpb25zXCIsXG4gICAgck1ldGhvZHMgPSBuZXcgUmVnRXhwKFwiXlwiICsgbWV0aG9kcyArIFwiJFwiLCBcImlcIilcblxudmFyIGFnZW50ID0gZnVuY3Rpb24obWV0aG9kLCB1cmwsIGRhdGEsIGNhbGxiYWNrKXtcbiAgICB2YXIgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KClcblxuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHJlcXVlc3RcblxuICAgIGlmICghck1ldGhvZHMudGVzdChtZXRob2QpKXsgLy8gc2hpZnRcbiAgICAgICAgY2FsbGJhY2sgPSBkYXRhXG4gICAgICAgIGRhdGEgICAgID0gdXJsXG4gICAgICAgIHVybCAgICAgID0gbWV0aG9kXG4gICAgICAgIG1ldGhvZCAgID0gXCJwb3N0XCJcbiAgICB9XG5cbiAgICBpZiAoaXNGdW5jdGlvbihkYXRhKSl7XG4gICAgICAgIGNhbGxiYWNrID0gZGF0YVxuICAgICAgICBkYXRhID0gbnVsbFxuICAgIH1cblxuICAgIHJlcXVlc3QubWV0aG9kKG1ldGhvZClcblxuICAgIGlmICh1cmwpIHJlcXVlc3QudXJsKHVybClcbiAgICBpZiAoZGF0YSkgcmVxdWVzdC5kYXRhKGRhdGEpXG4gICAgaWYgKGNhbGxiYWNrKSByZXF1ZXN0LnNlbmQoY2FsbGJhY2spXG5cbiAgICByZXR1cm4gcmVxdWVzdFxufVxuXG5hZ2VudC5lbmNvZGVyID0gZnVuY3Rpb24oY3QsIGVuY29kZSl7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHJldHVybiBlbmNvZGVyc1tjdF1cbiAgICBlbmNvZGVyc1tjdF0gPSBlbmNvZGVcbiAgICByZXR1cm4gYWdlbnRcbn1cblxuYWdlbnQuZGVjb2RlciA9IGZ1bmN0aW9uKGN0LCBkZWNvZGUpe1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSByZXR1cm4gZGVjb2RlcnNbY3RdXG4gICAgZGVjb2RlcnNbY3RdID0gZGVjb2RlXG4gICAgcmV0dXJuIGFnZW50XG59XG5cbmZvckVhY2gobWV0aG9kcy5zcGxpdChcInxcIiksIGZ1bmN0aW9uKG1ldGhvZCl7XG4gICAgYWdlbnRbbWV0aG9kXSA9IGZ1bmN0aW9uKHVybCwgZGF0YSwgY2FsbGJhY2spe1xuICAgICAgICByZXR1cm4gYWdlbnQobWV0aG9kLCB1cmwsIGRhdGEsIGNhbGxiYWNrKVxuICAgIH1cbn0pXG5cbmFnZW50Lk1BWF9SRVFVRVNUUyA9IEluZmluaXR5XG5hZ2VudC5nZXRSZXF1ZXN0ID0gZ2V0UmVxdWVzdFxuYWdlbnQuUmVxdWVzdCAgPSBSZXF1ZXN0XG5hZ2VudC5SZXNwb25zZSA9IFJlc3BvbnNlXG5cbm1vZHVsZS5leHBvcnRzID0gYWdlbnRcbiIsIlxuXG4gICAgLyoqXG4gICAgICogQXJyYXkgZm9yRWFjaFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZvckVhY2goYXJyLCBjYWxsYmFjaywgdGhpc09iaikge1xuICAgICAgICBpZiAoYXJyID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaSA9IC0xLFxuICAgICAgICAgICAgbGVuID0gYXJyLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikge1xuICAgICAgICAgICAgLy8gd2UgaXRlcmF0ZSBvdmVyIHNwYXJzZSBpdGVtcyBzaW5jZSB0aGVyZSBpcyBubyB3YXkgdG8gbWFrZSBpdFxuICAgICAgICAgICAgLy8gd29yayBwcm9wZXJseSBvbiBJRSA3LTguIHNlZSAjNjRcbiAgICAgICAgICAgIGlmICggY2FsbGJhY2suY2FsbCh0aGlzT2JqLCBhcnJbaV0sIGksIGFycikgPT09IGZhbHNlICkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmb3JFYWNoO1xuXG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogQXJyYXkuaW5kZXhPZlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGluZGV4T2YoYXJyLCBpdGVtLCBmcm9tSW5kZXgpIHtcbiAgICAgICAgZnJvbUluZGV4ID0gZnJvbUluZGV4IHx8IDA7XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxlbiA9IGFyci5sZW5ndGgsXG4gICAgICAgICAgICBpID0gZnJvbUluZGV4IDwgMCA/IGxlbiArIGZyb21JbmRleCA6IGZyb21JbmRleDtcbiAgICAgICAgd2hpbGUgKGkgPCBsZW4pIHtcbiAgICAgICAgICAgIC8vIHdlIGl0ZXJhdGUgb3ZlciBzcGFyc2UgaXRlbXMgc2luY2UgdGhlcmUgaXMgbm8gd2F5IHRvIG1ha2UgaXRcbiAgICAgICAgICAgIC8vIHdvcmsgcHJvcGVybHkgb24gSUUgNy04LiBzZWUgIzY0XG4gICAgICAgICAgICBpZiAoYXJyW2ldID09PSBpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGluZGV4T2Y7XG5cbiIsInZhciBpbmRleE9mID0gcmVxdWlyZSgnLi9pbmRleE9mJyk7XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYSBzaW5nbGUgaXRlbSBmcm9tIHRoZSBhcnJheS5cbiAgICAgKiAoaXQgd29uJ3QgcmVtb3ZlIGR1cGxpY2F0ZXMsIGp1c3QgYSBzaW5nbGUgaXRlbSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW1vdmUoYXJyLCBpdGVtKXtcbiAgICAgICAgdmFyIGlkeCA9IGluZGV4T2YoYXJyLCBpdGVtKTtcbiAgICAgICAgaWYgKGlkeCAhPT0gLTEpIGFyci5zcGxpY2UoaWR4LCAxKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlbW92ZTtcblxuIiwidmFyIGlzS2luZCA9IHJlcXVpcmUoJy4vaXNLaW5kJyk7XG4gICAgLyoqXG4gICAgICovXG4gICAgdmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgcmV0dXJuIGlzS2luZCh2YWwsICdBcnJheScpO1xuICAgIH07XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpc0FycmF5O1xuXG4iLCJ2YXIgaXNLaW5kID0gcmVxdWlyZSgnLi9pc0tpbmQnKTtcbiAgICAvKipcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0Z1bmN0aW9uKHZhbCkge1xuICAgICAgICByZXR1cm4gaXNLaW5kKHZhbCwgJ0Z1bmN0aW9uJyk7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gaXNGdW5jdGlvbjtcblxuIiwidmFyIGtpbmRPZiA9IHJlcXVpcmUoJy4va2luZE9mJyk7XG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdmFsdWUgaXMgZnJvbSBhIHNwZWNpZmljIFwia2luZFwiLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzS2luZCh2YWwsIGtpbmQpe1xuICAgICAgICByZXR1cm4ga2luZE9mKHZhbCkgPT09IGtpbmQ7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gaXNLaW5kO1xuXG4iLCJ2YXIgaXNLaW5kID0gcmVxdWlyZSgnLi9pc0tpbmQnKTtcbiAgICAvKipcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc09iamVjdCh2YWwpIHtcbiAgICAgICAgcmV0dXJuIGlzS2luZCh2YWwsICdPYmplY3QnKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpc09iamVjdDtcblxuIiwidmFyIGlzS2luZCA9IHJlcXVpcmUoJy4vaXNLaW5kJyk7XG4gICAgLyoqXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNTdHJpbmcodmFsKSB7XG4gICAgICAgIHJldHVybiBpc0tpbmQodmFsLCAnU3RyaW5nJyk7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gaXNTdHJpbmc7XG5cbiIsIlxuXG4gICAgdmFyIF9yS2luZCA9IC9eXFxbb2JqZWN0ICguKilcXF0kLyxcbiAgICAgICAgX3RvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxcbiAgICAgICAgVU5ERUY7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBcImtpbmRcIiBvZiB2YWx1ZS4gKGUuZy4gXCJTdHJpbmdcIiwgXCJOdW1iZXJcIiwgZXRjKVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGtpbmRPZih2YWwpIHtcbiAgICAgICAgaWYgKHZhbCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuICdOdWxsJztcbiAgICAgICAgfSBlbHNlIGlmICh2YWwgPT09IFVOREVGKSB7XG4gICAgICAgICAgICByZXR1cm4gJ1VuZGVmaW5lZCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gX3JLaW5kLmV4ZWMoIF90b1N0cmluZy5jYWxsKHZhbCkgKVsxXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGtpbmRPZjtcblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBUeXBlY2FzdCBhIHZhbHVlIHRvIGEgU3RyaW5nLCB1c2luZyBhbiBlbXB0eSBzdHJpbmcgdmFsdWUgZm9yIG51bGwgb3JcbiAgICAgKiB1bmRlZmluZWQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9TdHJpbmcodmFsKXtcbiAgICAgICAgcmV0dXJuIHZhbCA9PSBudWxsID8gJycgOiB2YWwudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHRvU3RyaW5nO1xuXG5cbiIsInZhciBoYXNPd24gPSByZXF1aXJlKCcuL2hhc093bicpO1xuXG4gICAgdmFyIF9oYXNEb250RW51bUJ1ZyxcbiAgICAgICAgX2RvbnRFbnVtcztcblxuICAgIGZ1bmN0aW9uIGNoZWNrRG9udEVudW0oKXtcbiAgICAgICAgX2RvbnRFbnVtcyA9IFtcbiAgICAgICAgICAgICAgICAndG9TdHJpbmcnLFxuICAgICAgICAgICAgICAgICd0b0xvY2FsZVN0cmluZycsXG4gICAgICAgICAgICAgICAgJ3ZhbHVlT2YnLFxuICAgICAgICAgICAgICAgICdoYXNPd25Qcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgJ2lzUHJvdG90eXBlT2YnLFxuICAgICAgICAgICAgICAgICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsXG4gICAgICAgICAgICAgICAgJ2NvbnN0cnVjdG9yJ1xuICAgICAgICAgICAgXTtcblxuICAgICAgICBfaGFzRG9udEVudW1CdWcgPSB0cnVlO1xuXG4gICAgICAgIGZvciAodmFyIGtleSBpbiB7J3RvU3RyaW5nJzogbnVsbH0pIHtcbiAgICAgICAgICAgIF9oYXNEb250RW51bUJ1ZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2ltaWxhciB0byBBcnJheS9mb3JFYWNoIGJ1dCB3b3JrcyBvdmVyIG9iamVjdCBwcm9wZXJ0aWVzIGFuZCBmaXhlcyBEb24ndFxuICAgICAqIEVudW0gYnVnIG9uIElFLlxuICAgICAqIGJhc2VkIG9uOiBodHRwOi8vd2hhdHRoZWhlYWRzYWlkLmNvbS8yMDEwLzEwL2Etc2FmZXItb2JqZWN0LWtleXMtY29tcGF0aWJpbGl0eS1pbXBsZW1lbnRhdGlvblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZvckluKG9iaiwgZm4sIHRoaXNPYmope1xuICAgICAgICB2YXIga2V5LCBpID0gMDtcbiAgICAgICAgLy8gbm8gbmVlZCB0byBjaGVjayBpZiBhcmd1bWVudCBpcyBhIHJlYWwgb2JqZWN0IHRoYXQgd2F5IHdlIGNhbiB1c2VcbiAgICAgICAgLy8gaXQgZm9yIGFycmF5cywgZnVuY3Rpb25zLCBkYXRlLCBldGMuXG5cbiAgICAgICAgLy9wb3N0LXBvbmUgY2hlY2sgdGlsbCBuZWVkZWRcbiAgICAgICAgaWYgKF9oYXNEb250RW51bUJ1ZyA9PSBudWxsKSBjaGVja0RvbnRFbnVtKCk7XG5cbiAgICAgICAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgICAgICAgICBpZiAoZXhlYyhmbiwgb2JqLCBrZXksIHRoaXNPYmopID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cblxuICAgICAgICBpZiAoX2hhc0RvbnRFbnVtQnVnKSB7XG4gICAgICAgICAgICB2YXIgY3RvciA9IG9iai5jb25zdHJ1Y3RvcixcbiAgICAgICAgICAgICAgICBpc1Byb3RvID0gISFjdG9yICYmIG9iaiA9PT0gY3Rvci5wcm90b3R5cGU7XG5cbiAgICAgICAgICAgIHdoaWxlIChrZXkgPSBfZG9udEVudW1zW2krK10pIHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgY29uc3RydWN0b3IsIGlmIGl0IGlzIGEgcHJvdG90eXBlIG9iamVjdCB0aGUgY29uc3RydWN0b3JcbiAgICAgICAgICAgICAgICAvLyBpcyBhbHdheXMgbm9uLWVudW1lcmFibGUgdW5sZXNzIGRlZmluZWQgb3RoZXJ3aXNlIChhbmRcbiAgICAgICAgICAgICAgICAvLyBlbnVtZXJhdGVkIGFib3ZlKS4gIEZvciBub24tcHJvdG90eXBlIG9iamVjdHMsIGl0IHdpbGwgaGF2ZVxuICAgICAgICAgICAgICAgIC8vIHRvIGJlIGRlZmluZWQgb24gdGhpcyBvYmplY3QsIHNpbmNlIGl0IGNhbm5vdCBiZSBkZWZpbmVkIG9uXG4gICAgICAgICAgICAgICAgLy8gYW55IHByb3RvdHlwZSBvYmplY3RzLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gRm9yIG90aGVyIFtbRG9udEVudW1dXSBwcm9wZXJ0aWVzLCBjaGVjayBpZiB0aGUgdmFsdWUgaXNcbiAgICAgICAgICAgICAgICAvLyBkaWZmZXJlbnQgdGhhbiBPYmplY3QgcHJvdG90eXBlIHZhbHVlLlxuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgKGtleSAhPT0gJ2NvbnN0cnVjdG9yJyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKCFpc1Byb3RvICYmIGhhc093bihvYmosIGtleSkpKSAmJlxuICAgICAgICAgICAgICAgICAgICBvYmpba2V5XSAhPT0gT2JqZWN0LnByb3RvdHlwZVtrZXldXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChleGVjKGZuLCBvYmosIGtleSwgdGhpc09iaikgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGV4ZWMoZm4sIG9iaiwga2V5LCB0aGlzT2JqKXtcbiAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhpc09iaiwgb2JqW2tleV0sIGtleSwgb2JqKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZvckluO1xuXG5cbiIsInZhciBoYXNPd24gPSByZXF1aXJlKCcuL2hhc093bicpO1xudmFyIGZvckluID0gcmVxdWlyZSgnLi9mb3JJbicpO1xuXG4gICAgLyoqXG4gICAgICogU2ltaWxhciB0byBBcnJheS9mb3JFYWNoIGJ1dCB3b3JrcyBvdmVyIG9iamVjdCBwcm9wZXJ0aWVzIGFuZCBmaXhlcyBEb24ndFxuICAgICAqIEVudW0gYnVnIG9uIElFLlxuICAgICAqIGJhc2VkIG9uOiBodHRwOi8vd2hhdHRoZWhlYWRzYWlkLmNvbS8yMDEwLzEwL2Etc2FmZXItb2JqZWN0LWtleXMtY29tcGF0aWJpbGl0eS1pbXBsZW1lbnRhdGlvblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZvck93bihvYmosIGZuLCB0aGlzT2JqKXtcbiAgICAgICAgZm9ySW4ob2JqLCBmdW5jdGlvbih2YWwsIGtleSl7XG4gICAgICAgICAgICBpZiAoaGFzT3duKG9iaiwga2V5KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmbi5jYWxsKHRoaXNPYmosIG9ialtrZXldLCBrZXksIG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZm9yT3duO1xuXG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogU2FmZXIgT2JqZWN0Lmhhc093blByb3BlcnR5XG4gICAgICovXG4gICAgIGZ1bmN0aW9uIGhhc093bihvYmosIHByb3Ape1xuICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApO1xuICAgICB9XG5cbiAgICAgbW9kdWxlLmV4cG9ydHMgPSBoYXNPd247XG5cblxuIiwidmFyIGZvck93biA9IHJlcXVpcmUoJy4vZm9yT3duJyk7XG5cbiAgICAvKipcbiAgICAqIENvbWJpbmUgcHJvcGVydGllcyBmcm9tIGFsbCB0aGUgb2JqZWN0cyBpbnRvIGZpcnN0IG9uZS5cbiAgICAqIC0gVGhpcyBtZXRob2QgYWZmZWN0cyB0YXJnZXQgb2JqZWN0IGluIHBsYWNlLCBpZiB5b3Ugd2FudCB0byBjcmVhdGUgYSBuZXcgT2JqZWN0IHBhc3MgYW4gZW1wdHkgb2JqZWN0IGFzIGZpcnN0IHBhcmFtLlxuICAgICogQHBhcmFtIHtvYmplY3R9IHRhcmdldCAgICBUYXJnZXQgT2JqZWN0XG4gICAgKiBAcGFyYW0gey4uLm9iamVjdH0gb2JqZWN0cyAgICBPYmplY3RzIHRvIGJlIGNvbWJpbmVkICgwLi4ubiBvYmplY3RzKS5cbiAgICAqIEByZXR1cm4ge29iamVjdH0gVGFyZ2V0IE9iamVjdC5cbiAgICAqL1xuICAgIGZ1bmN0aW9uIG1peEluKHRhcmdldCwgb2JqZWN0cyl7XG4gICAgICAgIHZhciBpID0gMCxcbiAgICAgICAgICAgIG4gPSBhcmd1bWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgb2JqO1xuICAgICAgICB3aGlsZSgrK2kgPCBuKXtcbiAgICAgICAgICAgIG9iaiA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGZvck93bihvYmosIGNvcHlQcm9wLCB0YXJnZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29weVByb3AodmFsLCBrZXkpe1xuICAgICAgICB0aGlzW2tleV0gPSB2YWw7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBtaXhJbjtcblxuIiwiXG4gICAgLyoqXG4gICAgICogQ29udGFpbnMgYWxsIFVuaWNvZGUgd2hpdGUtc3BhY2VzLiBUYWtlbiBmcm9tXG4gICAgICogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9XaGl0ZXNwYWNlX2NoYXJhY3Rlci5cbiAgICAgKi9cbiAgICBtb2R1bGUuZXhwb3J0cyA9IFtcbiAgICAgICAgJyAnLCAnXFxuJywgJ1xccicsICdcXHQnLCAnXFxmJywgJ1xcdicsICdcXHUwMEEwJywgJ1xcdTE2ODAnLCAnXFx1MTgwRScsXG4gICAgICAgICdcXHUyMDAwJywgJ1xcdTIwMDEnLCAnXFx1MjAwMicsICdcXHUyMDAzJywgJ1xcdTIwMDQnLCAnXFx1MjAwNScsICdcXHUyMDA2JyxcbiAgICAgICAgJ1xcdTIwMDcnLCAnXFx1MjAwOCcsICdcXHUyMDA5JywgJ1xcdTIwMEEnLCAnXFx1MjAyOCcsICdcXHUyMDI5JywgJ1xcdTIwMkYnLFxuICAgICAgICAnXFx1MjA1RicsICdcXHUzMDAwJ1xuICAgIF07XG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcbnZhciBXSElURV9TUEFDRVMgPSByZXF1aXJlKCcuL1dISVRFX1NQQUNFUycpO1xuICAgIC8qKlxuICAgICAqIFJlbW92ZSBjaGFycyBmcm9tIGJlZ2lubmluZyBvZiBzdHJpbmcuXG4gICAgICovXG4gICAgZnVuY3Rpb24gbHRyaW0oc3RyLCBjaGFycykge1xuICAgICAgICBzdHIgPSB0b1N0cmluZyhzdHIpO1xuICAgICAgICBjaGFycyA9IGNoYXJzIHx8IFdISVRFX1NQQUNFUztcblxuICAgICAgICB2YXIgc3RhcnQgPSAwLFxuICAgICAgICAgICAgbGVuID0gc3RyLmxlbmd0aCxcbiAgICAgICAgICAgIGNoYXJMZW4gPSBjaGFycy5sZW5ndGgsXG4gICAgICAgICAgICBmb3VuZCA9IHRydWUsXG4gICAgICAgICAgICBpLCBjO1xuXG4gICAgICAgIHdoaWxlIChmb3VuZCAmJiBzdGFydCA8IGxlbikge1xuICAgICAgICAgICAgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgIGkgPSAtMTtcbiAgICAgICAgICAgIGMgPSBzdHIuY2hhckF0KHN0YXJ0KTtcblxuICAgICAgICAgICAgd2hpbGUgKCsraSA8IGNoYXJMZW4pIHtcbiAgICAgICAgICAgICAgICBpZiAoYyA9PT0gY2hhcnNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzdGFydCsrO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKHN0YXJ0ID49IGxlbikgPyAnJyA6IHN0ci5zdWJzdHIoc3RhcnQsIGxlbik7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBsdHJpbTtcblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xudmFyIFdISVRFX1NQQUNFUyA9IHJlcXVpcmUoJy4vV0hJVEVfU1BBQ0VTJyk7XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGNoYXJzIGZyb20gZW5kIG9mIHN0cmluZy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBydHJpbShzdHIsIGNoYXJzKSB7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIGNoYXJzID0gY2hhcnMgfHwgV0hJVEVfU1BBQ0VTO1xuXG4gICAgICAgIHZhciBlbmQgPSBzdHIubGVuZ3RoIC0gMSxcbiAgICAgICAgICAgIGNoYXJMZW4gPSBjaGFycy5sZW5ndGgsXG4gICAgICAgICAgICBmb3VuZCA9IHRydWUsXG4gICAgICAgICAgICBpLCBjO1xuXG4gICAgICAgIHdoaWxlIChmb3VuZCAmJiBlbmQgPj0gMCkge1xuICAgICAgICAgICAgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgIGkgPSAtMTtcbiAgICAgICAgICAgIGMgPSBzdHIuY2hhckF0KGVuZCk7XG5cbiAgICAgICAgICAgIHdoaWxlICgrK2kgPCBjaGFyTGVuKSB7XG4gICAgICAgICAgICAgICAgaWYgKGMgPT09IGNoYXJzW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZW5kLS07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoZW5kID49IDApID8gc3RyLnN1YnN0cmluZygwLCBlbmQgKyAxKSA6ICcnO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gcnRyaW07XG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcbnZhciBXSElURV9TUEFDRVMgPSByZXF1aXJlKCcuL1dISVRFX1NQQUNFUycpO1xudmFyIGx0cmltID0gcmVxdWlyZSgnLi9sdHJpbScpO1xudmFyIHJ0cmltID0gcmVxdWlyZSgnLi9ydHJpbScpO1xuICAgIC8qKlxuICAgICAqIFJlbW92ZSB3aGl0ZS1zcGFjZXMgZnJvbSBiZWdpbm5pbmcgYW5kIGVuZCBvZiBzdHJpbmcuXG4gICAgICovXG4gICAgZnVuY3Rpb24gdHJpbShzdHIsIGNoYXJzKSB7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIGNoYXJzID0gY2hhcnMgfHwgV0hJVEVfU1BBQ0VTO1xuICAgICAgICByZXR1cm4gbHRyaW0ocnRyaW0oc3RyLCBjaGFycyksIGNoYXJzKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHRyaW07XG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcbiAgICAvKipcbiAgICAgKiBcIlNhZmVyXCIgU3RyaW5nLnRvVXBwZXJDYXNlKClcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1cHBlckNhc2Uoc3RyKXtcbiAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcbiAgICAgICAgcmV0dXJuIHN0ci50b1VwcGVyQ2FzZSgpO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHVwcGVyQ2FzZTtcblxuIiwiLyohXG4gKiBhc3luY1xuICogaHR0cHM6Ly9naXRodWIuY29tL2Nhb2xhbi9hc3luY1xuICpcbiAqIENvcHlyaWdodCAyMDEwLTIwMTQgQ2FvbGFuIE1jTWFob25cbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICovXG4vKmpzaGludCBvbmV2YXI6IGZhbHNlLCBpbmRlbnQ6NCAqL1xuLypnbG9iYWwgc2V0SW1tZWRpYXRlOiBmYWxzZSwgc2V0VGltZW91dDogZmFsc2UsIGNvbnNvbGU6IGZhbHNlICovXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIGFzeW5jID0ge307XG5cbiAgICAvLyBnbG9iYWwgb24gdGhlIHNlcnZlciwgd2luZG93IGluIHRoZSBicm93c2VyXG4gICAgdmFyIHJvb3QsIHByZXZpb3VzX2FzeW5jO1xuXG4gICAgcm9vdCA9IHRoaXM7XG4gICAgaWYgKHJvb3QgIT0gbnVsbCkge1xuICAgICAgcHJldmlvdXNfYXN5bmMgPSByb290LmFzeW5jO1xuICAgIH1cblxuICAgIGFzeW5jLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJvb3QuYXN5bmMgPSBwcmV2aW91c19hc3luYztcbiAgICAgICAgcmV0dXJuIGFzeW5jO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBvbmx5X29uY2UoZm4pIHtcbiAgICAgICAgdmFyIGNhbGxlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoY2FsbGVkKSB0aHJvdyBuZXcgRXJyb3IoXCJDYWxsYmFjayB3YXMgYWxyZWFkeSBjYWxsZWQuXCIpO1xuICAgICAgICAgICAgY2FsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGZuLmFwcGx5KHJvb3QsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLy8vIGNyb3NzLWJyb3dzZXIgY29tcGF0aWJsaXR5IGZ1bmN0aW9ucyAvLy8vXG5cbiAgICB2YXIgX3RvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztcblxuICAgIHZhciBfaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICByZXR1cm4gX3RvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgICB9O1xuXG4gICAgdmFyIF9lYWNoID0gZnVuY3Rpb24gKGFyciwgaXRlcmF0b3IpIHtcbiAgICAgICAgaWYgKGFyci5mb3JFYWNoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXJyLmZvckVhY2goaXRlcmF0b3IpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBpdGVyYXRvcihhcnJbaV0sIGksIGFycik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIF9tYXAgPSBmdW5jdGlvbiAoYXJyLCBpdGVyYXRvcikge1xuICAgICAgICBpZiAoYXJyLm1hcCkge1xuICAgICAgICAgICAgcmV0dXJuIGFyci5tYXAoaXRlcmF0b3IpO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIF9lYWNoKGFyciwgZnVuY3Rpb24gKHgsIGksIGEpIHtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChpdGVyYXRvcih4LCBpLCBhKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9O1xuXG4gICAgdmFyIF9yZWR1Y2UgPSBmdW5jdGlvbiAoYXJyLCBpdGVyYXRvciwgbWVtbykge1xuICAgICAgICBpZiAoYXJyLnJlZHVjZSkge1xuICAgICAgICAgICAgcmV0dXJuIGFyci5yZWR1Y2UoaXRlcmF0b3IsIG1lbW8pO1xuICAgICAgICB9XG4gICAgICAgIF9lYWNoKGFyciwgZnVuY3Rpb24gKHgsIGksIGEpIHtcbiAgICAgICAgICAgIG1lbW8gPSBpdGVyYXRvcihtZW1vLCB4LCBpLCBhKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBtZW1vO1xuICAgIH07XG5cbiAgICB2YXIgX2tleXMgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cykge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGtleXMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgayBpbiBvYmopIHtcbiAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoaykpIHtcbiAgICAgICAgICAgICAgICBrZXlzLnB1c2goayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGtleXM7XG4gICAgfTtcblxuICAgIC8vLy8gZXhwb3J0ZWQgYXN5bmMgbW9kdWxlIGZ1bmN0aW9ucyAvLy8vXG5cbiAgICAvLy8vIG5leHRUaWNrIGltcGxlbWVudGF0aW9uIHdpdGggYnJvd3Nlci1jb21wYXRpYmxlIGZhbGxiYWNrIC8vLy9cbiAgICBpZiAodHlwZW9mIHByb2Nlc3MgPT09ICd1bmRlZmluZWQnIHx8ICEocHJvY2Vzcy5uZXh0VGljaykpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBzZXRJbW1lZGlhdGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGFzeW5jLm5leHRUaWNrID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgICAgICAgICAgLy8gbm90IGEgZGlyZWN0IGFsaWFzIGZvciBJRTEwIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgICAgICBzZXRJbW1lZGlhdGUoZm4pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGFzeW5jLnNldEltbWVkaWF0ZSA9IGFzeW5jLm5leHRUaWNrO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYXN5bmMubmV4dFRpY2sgPSBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZuLCAwKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhc3luYy5zZXRJbW1lZGlhdGUgPSBhc3luYy5uZXh0VGljaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXN5bmMubmV4dFRpY2sgPSBwcm9jZXNzLm5leHRUaWNrO1xuICAgICAgICBpZiAodHlwZW9mIHNldEltbWVkaWF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGFzeW5jLnNldEltbWVkaWF0ZSA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICAgICAgICAvLyBub3QgYSBkaXJlY3QgYWxpYXMgZm9yIElFMTAgY29tcGF0aWJpbGl0eVxuICAgICAgICAgICAgICBzZXRJbW1lZGlhdGUoZm4pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFzeW5jLnNldEltbWVkaWF0ZSA9IGFzeW5jLm5leHRUaWNrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMuZWFjaCA9IGZ1bmN0aW9uIChhcnIsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICBpZiAoIWFyci5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSAwO1xuICAgICAgICBfZWFjaChhcnIsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICBpdGVyYXRvcih4LCBvbmx5X29uY2UoZG9uZSkgKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZ1bmN0aW9uIGRvbmUoZXJyKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgY29tcGxldGVkICs9IDE7XG4gICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQgPj0gYXJyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgYXN5bmMuZm9yRWFjaCA9IGFzeW5jLmVhY2g7XG5cbiAgICBhc3luYy5lYWNoU2VyaWVzID0gZnVuY3Rpb24gKGFyciwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge307XG4gICAgICAgIGlmICghYXJyLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IDA7XG4gICAgICAgIHZhciBpdGVyYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaXRlcmF0b3IoYXJyW2NvbXBsZXRlZF0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlZCA+PSBhcnIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlcmF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGl0ZXJhdGUoKTtcbiAgICB9O1xuICAgIGFzeW5jLmZvckVhY2hTZXJpZXMgPSBhc3luYy5lYWNoU2VyaWVzO1xuXG4gICAgYXN5bmMuZWFjaExpbWl0ID0gZnVuY3Rpb24gKGFyciwgbGltaXQsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgZm4gPSBfZWFjaExpbWl0KGxpbWl0KTtcbiAgICAgICAgZm4uYXBwbHkobnVsbCwgW2FyciwgaXRlcmF0b3IsIGNhbGxiYWNrXSk7XG4gICAgfTtcbiAgICBhc3luYy5mb3JFYWNoTGltaXQgPSBhc3luYy5lYWNoTGltaXQ7XG5cbiAgICB2YXIgX2VhY2hMaW1pdCA9IGZ1bmN0aW9uIChsaW1pdCkge1xuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoYXJyLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICBpZiAoIWFyci5sZW5ndGggfHwgbGltaXQgPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNvbXBsZXRlZCA9IDA7XG4gICAgICAgICAgICB2YXIgc3RhcnRlZCA9IDA7XG4gICAgICAgICAgICB2YXIgcnVubmluZyA9IDA7XG5cbiAgICAgICAgICAgIChmdW5jdGlvbiByZXBsZW5pc2ggKCkge1xuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQgPj0gYXJyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3aGlsZSAocnVubmluZyA8IGxpbWl0ICYmIHN0YXJ0ZWQgPCBhcnIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgcnVubmluZyArPSAxO1xuICAgICAgICAgICAgICAgICAgICBpdGVyYXRvcihhcnJbc3RhcnRlZCAtIDFdLCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVubmluZyAtPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQgPj0gYXJyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGVuaXNoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSgpO1xuICAgICAgICB9O1xuICAgIH07XG5cblxuICAgIHZhciBkb1BhcmFsbGVsID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkobnVsbCwgW2FzeW5jLmVhY2hdLmNvbmNhdChhcmdzKSk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZG9QYXJhbGxlbExpbWl0ID0gZnVuY3Rpb24obGltaXQsIGZuKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkobnVsbCwgW19lYWNoTGltaXQobGltaXQpXS5jb25jYXQoYXJncykpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgdmFyIGRvU2VyaWVzID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkobnVsbCwgW2FzeW5jLmVhY2hTZXJpZXNdLmNvbmNhdChhcmdzKSk7XG4gICAgICAgIH07XG4gICAgfTtcblxuXG4gICAgdmFyIF9hc3luY01hcCA9IGZ1bmN0aW9uIChlYWNoZm4sIGFyciwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgIGFyciA9IF9tYXAoYXJyLCBmdW5jdGlvbiAoeCwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIHtpbmRleDogaSwgdmFsdWU6IHh9O1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFjYWxsYmFjaykge1xuICAgICAgICAgICAgZWFjaGZuKGFyciwgZnVuY3Rpb24gKHgsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaXRlcmF0b3IoeC52YWx1ZSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgZWFjaGZuKGFyciwgZnVuY3Rpb24gKHgsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaXRlcmF0b3IoeC52YWx1ZSwgZnVuY3Rpb24gKGVyciwgdikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzW3guaW5kZXhdID0gdjtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIsIHJlc3VsdHMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGFzeW5jLm1hcCA9IGRvUGFyYWxsZWwoX2FzeW5jTWFwKTtcbiAgICBhc3luYy5tYXBTZXJpZXMgPSBkb1NlcmllcyhfYXN5bmNNYXApO1xuICAgIGFzeW5jLm1hcExpbWl0ID0gZnVuY3Rpb24gKGFyciwgbGltaXQsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICByZXR1cm4gX21hcExpbWl0KGxpbWl0KShhcnIsIGl0ZXJhdG9yLCBjYWxsYmFjayk7XG4gICAgfTtcblxuICAgIHZhciBfbWFwTGltaXQgPSBmdW5jdGlvbihsaW1pdCkge1xuICAgICAgICByZXR1cm4gZG9QYXJhbGxlbExpbWl0KGxpbWl0LCBfYXN5bmNNYXApO1xuICAgIH07XG5cbiAgICAvLyByZWR1Y2Ugb25seSBoYXMgYSBzZXJpZXMgdmVyc2lvbiwgYXMgZG9pbmcgcmVkdWNlIGluIHBhcmFsbGVsIHdvbid0XG4gICAgLy8gd29yayBpbiBtYW55IHNpdHVhdGlvbnMuXG4gICAgYXN5bmMucmVkdWNlID0gZnVuY3Rpb24gKGFyciwgbWVtbywgaXRlcmF0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgIGFzeW5jLmVhY2hTZXJpZXMoYXJyLCBmdW5jdGlvbiAoeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKG1lbW8sIHgsIGZ1bmN0aW9uIChlcnIsIHYpIHtcbiAgICAgICAgICAgICAgICBtZW1vID0gdjtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGVyciwgbWVtbyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLy8gaW5qZWN0IGFsaWFzXG4gICAgYXN5bmMuaW5qZWN0ID0gYXN5bmMucmVkdWNlO1xuICAgIC8vIGZvbGRsIGFsaWFzXG4gICAgYXN5bmMuZm9sZGwgPSBhc3luYy5yZWR1Y2U7XG5cbiAgICBhc3luYy5yZWR1Y2VSaWdodCA9IGZ1bmN0aW9uIChhcnIsIG1lbW8sIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgcmV2ZXJzZWQgPSBfbWFwKGFyciwgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgIHJldHVybiB4O1xuICAgICAgICB9KS5yZXZlcnNlKCk7XG4gICAgICAgIGFzeW5jLnJlZHVjZShyZXZlcnNlZCwgbWVtbywgaXRlcmF0b3IsIGNhbGxiYWNrKTtcbiAgICB9O1xuICAgIC8vIGZvbGRyIGFsaWFzXG4gICAgYXN5bmMuZm9sZHIgPSBhc3luYy5yZWR1Y2VSaWdodDtcblxuICAgIHZhciBfZmlsdGVyID0gZnVuY3Rpb24gKGVhY2hmbiwgYXJyLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgYXJyID0gX21hcChhcnIsIGZ1bmN0aW9uICh4LCBpKSB7XG4gICAgICAgICAgICByZXR1cm4ge2luZGV4OiBpLCB2YWx1ZTogeH07XG4gICAgICAgIH0pO1xuICAgICAgICBlYWNoZm4oYXJyLCBmdW5jdGlvbiAoeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHgudmFsdWUsIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKF9tYXAocmVzdWx0cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEuaW5kZXggLSBiLmluZGV4O1xuICAgICAgICAgICAgfSksIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHgudmFsdWU7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYXN5bmMuZmlsdGVyID0gZG9QYXJhbGxlbChfZmlsdGVyKTtcbiAgICBhc3luYy5maWx0ZXJTZXJpZXMgPSBkb1NlcmllcyhfZmlsdGVyKTtcbiAgICAvLyBzZWxlY3QgYWxpYXNcbiAgICBhc3luYy5zZWxlY3QgPSBhc3luYy5maWx0ZXI7XG4gICAgYXN5bmMuc2VsZWN0U2VyaWVzID0gYXN5bmMuZmlsdGVyU2VyaWVzO1xuXG4gICAgdmFyIF9yZWplY3QgPSBmdW5jdGlvbiAoZWFjaGZuLCBhcnIsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgICAgICBhcnIgPSBfbWFwKGFyciwgZnVuY3Rpb24gKHgsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiB7aW5kZXg6IGksIHZhbHVlOiB4fTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVhY2hmbihhcnIsIGZ1bmN0aW9uICh4LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgaXRlcmF0b3IoeC52YWx1ZSwgZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKF9tYXAocmVzdWx0cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEuaW5kZXggLSBiLmluZGV4O1xuICAgICAgICAgICAgfSksIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHgudmFsdWU7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYXN5bmMucmVqZWN0ID0gZG9QYXJhbGxlbChfcmVqZWN0KTtcbiAgICBhc3luYy5yZWplY3RTZXJpZXMgPSBkb1NlcmllcyhfcmVqZWN0KTtcblxuICAgIHZhciBfZGV0ZWN0ID0gZnVuY3Rpb24gKGVhY2hmbiwgYXJyLCBpdGVyYXRvciwgbWFpbl9jYWxsYmFjaykge1xuICAgICAgICBlYWNoZm4oYXJyLCBmdW5jdGlvbiAoeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHgsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIG1haW5fY2FsbGJhY2soeCk7XG4gICAgICAgICAgICAgICAgICAgIG1haW5fY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIG1haW5fY2FsbGJhY2soKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBhc3luYy5kZXRlY3QgPSBkb1BhcmFsbGVsKF9kZXRlY3QpO1xuICAgIGFzeW5jLmRldGVjdFNlcmllcyA9IGRvU2VyaWVzKF9kZXRlY3QpO1xuXG4gICAgYXN5bmMuc29tZSA9IGZ1bmN0aW9uIChhcnIsIGl0ZXJhdG9yLCBtYWluX2NhbGxiYWNrKSB7XG4gICAgICAgIGFzeW5jLmVhY2goYXJyLCBmdW5jdGlvbiAoeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHgsIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgbWFpbl9jYWxsYmFjayh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgbWFpbl9jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIG1haW5fY2FsbGJhY2soZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8vIGFueSBhbGlhc1xuICAgIGFzeW5jLmFueSA9IGFzeW5jLnNvbWU7XG5cbiAgICBhc3luYy5ldmVyeSA9IGZ1bmN0aW9uIChhcnIsIGl0ZXJhdG9yLCBtYWluX2NhbGxiYWNrKSB7XG4gICAgICAgIGFzeW5jLmVhY2goYXJyLCBmdW5jdGlvbiAoeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHgsIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgaWYgKCF2KSB7XG4gICAgICAgICAgICAgICAgICAgIG1haW5fY2FsbGJhY2soZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBtYWluX2NhbGxiYWNrID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgbWFpbl9jYWxsYmFjayh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvLyBhbGwgYWxpYXNcbiAgICBhc3luYy5hbGwgPSBhc3luYy5ldmVyeTtcblxuICAgIGFzeW5jLnNvcnRCeSA9IGZ1bmN0aW9uIChhcnIsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICBhc3luYy5tYXAoYXJyLCBmdW5jdGlvbiAoeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHgsIGZ1bmN0aW9uIChlcnIsIGNyaXRlcmlhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwge3ZhbHVlOiB4LCBjcml0ZXJpYTogY3JpdGVyaWF9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVyciwgcmVzdWx0cykge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGZuID0gZnVuY3Rpb24gKGxlZnQsIHJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhID0gbGVmdC5jcml0ZXJpYSwgYiA9IHJpZ2h0LmNyaXRlcmlhO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IDA7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBfbWFwKHJlc3VsdHMuc29ydChmbiksIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB4LnZhbHVlO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGFzeW5jLmF1dG8gPSBmdW5jdGlvbiAodGFza3MsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge307XG4gICAgICAgIHZhciBrZXlzID0gX2tleXModGFza3MpO1xuICAgICAgICB2YXIgcmVtYWluaW5nVGFza3MgPSBrZXlzLmxlbmd0aFxuICAgICAgICBpZiAoIXJlbWFpbmluZ1Rhc2tzKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXN1bHRzID0ge307XG5cbiAgICAgICAgdmFyIGxpc3RlbmVycyA9IFtdO1xuICAgICAgICB2YXIgYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgICAgIGxpc3RlbmVycy51bnNoaWZ0KGZuKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcnNbaV0gPT09IGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVycy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciB0YXNrQ29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZW1haW5pbmdUYXNrcy0tXG4gICAgICAgICAgICBfZWFjaChsaXN0ZW5lcnMuc2xpY2UoMCksIGZ1bmN0aW9uIChmbikge1xuICAgICAgICAgICAgICAgIGZuKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBhZGRMaXN0ZW5lcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXJlbWFpbmluZ1Rhc2tzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRoZUNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgLy8gcHJldmVudCBmaW5hbCBjYWxsYmFjayBmcm9tIGNhbGxpbmcgaXRzZWxmIGlmIGl0IGVycm9yc1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge307XG5cbiAgICAgICAgICAgICAgICB0aGVDYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgX2VhY2goa2V5cywgZnVuY3Rpb24gKGspIHtcbiAgICAgICAgICAgIHZhciB0YXNrID0gX2lzQXJyYXkodGFza3Nba10pID8gdGFza3Nba106IFt0YXNrc1trXV07XG4gICAgICAgICAgICB2YXIgdGFza0NhbGxiYWNrID0gZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPD0gMSkge1xuICAgICAgICAgICAgICAgICAgICBhcmdzID0gYXJnc1swXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2FmZVJlc3VsdHMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgX2VhY2goX2tleXMocmVzdWx0cyksIGZ1bmN0aW9uKHJrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVSZXN1bHRzW3JrZXldID0gcmVzdWx0c1tya2V5XTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNhZmVSZXN1bHRzW2tdID0gYXJncztcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyLCBzYWZlUmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHN0b3Agc3Vic2VxdWVudCBlcnJvcnMgaGl0dGluZyBjYWxsYmFjayBtdWx0aXBsZSB0aW1lc1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1trXSA9IGFyZ3M7XG4gICAgICAgICAgICAgICAgICAgIGFzeW5jLnNldEltbWVkaWF0ZSh0YXNrQ29tcGxldGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgcmVxdWlyZXMgPSB0YXNrLnNsaWNlKDAsIE1hdGguYWJzKHRhc2subGVuZ3RoIC0gMSkpIHx8IFtdO1xuICAgICAgICAgICAgdmFyIHJlYWR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfcmVkdWNlKHJlcXVpcmVzLCBmdW5jdGlvbiAoYSwgeCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGEgJiYgcmVzdWx0cy5oYXNPd25Qcm9wZXJ0eSh4KSk7XG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSkgJiYgIXJlc3VsdHMuaGFzT3duUHJvcGVydHkoayk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHJlYWR5KCkpIHtcbiAgICAgICAgICAgICAgICB0YXNrW3Rhc2subGVuZ3RoIC0gMV0odGFza0NhbGxiYWNrLCByZXN1bHRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWR5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tbdGFzay5sZW5ndGggLSAxXSh0YXNrQ2FsbGJhY2ssIHJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhZGRMaXN0ZW5lcihsaXN0ZW5lcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBhc3luYy5yZXRyeSA9IGZ1bmN0aW9uKHRpbWVzLCB0YXNrLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgREVGQVVMVF9USU1FUyA9IDU7XG4gICAgICAgIHZhciBhdHRlbXB0cyA9IFtdO1xuICAgICAgICAvLyBVc2UgZGVmYXVsdHMgaWYgdGltZXMgbm90IHBhc3NlZFxuICAgICAgICBpZiAodHlwZW9mIHRpbWVzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWxsYmFjayA9IHRhc2s7XG4gICAgICAgICAgICB0YXNrID0gdGltZXM7XG4gICAgICAgICAgICB0aW1lcyA9IERFRkFVTFRfVElNRVM7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTWFrZSBzdXJlIHRpbWVzIGlzIGEgbnVtYmVyXG4gICAgICAgIHRpbWVzID0gcGFyc2VJbnQodGltZXMsIDEwKSB8fCBERUZBVUxUX1RJTUVTO1xuICAgICAgICB2YXIgd3JhcHBlZFRhc2sgPSBmdW5jdGlvbih3cmFwcGVkQ2FsbGJhY2ssIHdyYXBwZWRSZXN1bHRzKSB7XG4gICAgICAgICAgICB2YXIgcmV0cnlBdHRlbXB0ID0gZnVuY3Rpb24odGFzaywgZmluYWxBdHRlbXB0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNlcmllc0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2soZnVuY3Rpb24oZXJyLCByZXN1bHQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWVzQ2FsbGJhY2soIWVyciB8fCBmaW5hbEF0dGVtcHQsIHtlcnI6IGVyciwgcmVzdWx0OiByZXN1bHR9KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgd3JhcHBlZFJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgd2hpbGUgKHRpbWVzKSB7XG4gICAgICAgICAgICAgICAgYXR0ZW1wdHMucHVzaChyZXRyeUF0dGVtcHQodGFzaywgISh0aW1lcy09MSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFzeW5jLnNlcmllcyhhdHRlbXB0cywgZnVuY3Rpb24oZG9uZSwgZGF0YSl7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGFbZGF0YS5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICAod3JhcHBlZENhbGxiYWNrIHx8IGNhbGxiYWNrKShkYXRhLmVyciwgZGF0YS5yZXN1bHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgYSBjYWxsYmFjayBpcyBwYXNzZWQsIHJ1biB0aGlzIGFzIGEgY29udHJvbGwgZmxvd1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sgPyB3cmFwcGVkVGFzaygpIDogd3JhcHBlZFRhc2tcbiAgICB9O1xuXG4gICAgYXN5bmMud2F0ZXJmYWxsID0gZnVuY3Rpb24gKHRhc2tzLCBjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICBpZiAoIV9pc0FycmF5KHRhc2tzKSkge1xuICAgICAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoJ0ZpcnN0IGFyZ3VtZW50IHRvIHdhdGVyZmFsbCBtdXN0IGJlIGFuIGFycmF5IG9mIGZ1bmN0aW9ucycpO1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGFza3MubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgd3JhcEl0ZXJhdG9yID0gZnVuY3Rpb24gKGl0ZXJhdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHQgPSBpdGVyYXRvci5uZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2god3JhcEl0ZXJhdG9yKG5leHQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYXN5bmMuc2V0SW1tZWRpYXRlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9yLmFwcGx5KG51bGwsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB3cmFwSXRlcmF0b3IoYXN5bmMuaXRlcmF0b3IodGFza3MpKSgpO1xuICAgIH07XG5cbiAgICB2YXIgX3BhcmFsbGVsID0gZnVuY3Rpb24oZWFjaGZuLCB0YXNrcywgY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgaWYgKF9pc0FycmF5KHRhc2tzKSkge1xuICAgICAgICAgICAgZWFjaGZuLm1hcCh0YXNrcywgZnVuY3Rpb24gKGZuLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGlmIChmbikge1xuICAgICAgICAgICAgICAgICAgICBmbihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPD0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmdzWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChudWxsLCBlcnIsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IHt9O1xuICAgICAgICAgICAgZWFjaGZuLmVhY2goX2tleXModGFza3MpLCBmdW5jdGlvbiAoaywgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB0YXNrc1trXShmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmdzWzBdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHNba10gPSBhcmdzO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVyciwgcmVzdWx0cyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhc3luYy5wYXJhbGxlbCA9IGZ1bmN0aW9uICh0YXNrcywgY2FsbGJhY2spIHtcbiAgICAgICAgX3BhcmFsbGVsKHsgbWFwOiBhc3luYy5tYXAsIGVhY2g6IGFzeW5jLmVhY2ggfSwgdGFza3MsIGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgYXN5bmMucGFyYWxsZWxMaW1pdCA9IGZ1bmN0aW9uKHRhc2tzLCBsaW1pdCwgY2FsbGJhY2spIHtcbiAgICAgICAgX3BhcmFsbGVsKHsgbWFwOiBfbWFwTGltaXQobGltaXQpLCBlYWNoOiBfZWFjaExpbWl0KGxpbWl0KSB9LCB0YXNrcywgY2FsbGJhY2spO1xuICAgIH07XG5cbiAgICBhc3luYy5zZXJpZXMgPSBmdW5jdGlvbiAodGFza3MsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge307XG4gICAgICAgIGlmIChfaXNBcnJheSh0YXNrcykpIHtcbiAgICAgICAgICAgIGFzeW5jLm1hcFNlcmllcyh0YXNrcywgZnVuY3Rpb24gKGZuLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGlmIChmbikge1xuICAgICAgICAgICAgICAgICAgICBmbihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPD0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmdzWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChudWxsLCBlcnIsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IHt9O1xuICAgICAgICAgICAgYXN5bmMuZWFjaFNlcmllcyhfa2V5cyh0YXNrcyksIGZ1bmN0aW9uIChrLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHRhc2tzW2tdKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPD0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1trXSA9IGFyZ3M7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHRzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFzeW5jLml0ZXJhdG9yID0gZnVuY3Rpb24gKHRhc2tzKSB7XG4gICAgICAgIHZhciBtYWtlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBmbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGFza3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tzW2luZGV4XS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZm4ubmV4dCgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGZuLm5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChpbmRleCA8IHRhc2tzLmxlbmd0aCAtIDEpID8gbWFrZUNhbGxiYWNrKGluZGV4ICsgMSk6IG51bGw7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gbWFrZUNhbGxiYWNrKDApO1xuICAgIH07XG5cbiAgICBhc3luYy5hcHBseSA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkoXG4gICAgICAgICAgICAgICAgbnVsbCwgYXJncy5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBfY29uY2F0ID0gZnVuY3Rpb24gKGVhY2hmbiwgYXJyLCBmbiwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHIgPSBbXTtcbiAgICAgICAgZWFjaGZuKGFyciwgZnVuY3Rpb24gKHgsIGNiKSB7XG4gICAgICAgICAgICBmbih4LCBmdW5jdGlvbiAoZXJyLCB5KSB7XG4gICAgICAgICAgICAgICAgciA9IHIuY29uY2F0KHkgfHwgW10pO1xuICAgICAgICAgICAgICAgIGNiKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgY2FsbGJhY2soZXJyLCByKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBhc3luYy5jb25jYXQgPSBkb1BhcmFsbGVsKF9jb25jYXQpO1xuICAgIGFzeW5jLmNvbmNhdFNlcmllcyA9IGRvU2VyaWVzKF9jb25jYXQpO1xuXG4gICAgYXN5bmMud2hpbHN0ID0gZnVuY3Rpb24gKHRlc3QsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAodGVzdCgpKSB7XG4gICAgICAgICAgICBpdGVyYXRvcihmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXN5bmMud2hpbHN0KHRlc3QsIGl0ZXJhdG9yLCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYXN5bmMuZG9XaGlsc3QgPSBmdW5jdGlvbiAoaXRlcmF0b3IsIHRlc3QsIGNhbGxiYWNrKSB7XG4gICAgICAgIGl0ZXJhdG9yKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICAgICAgICAgIGlmICh0ZXN0LmFwcGx5KG51bGwsIGFyZ3MpKSB7XG4gICAgICAgICAgICAgICAgYXN5bmMuZG9XaGlsc3QoaXRlcmF0b3IsIHRlc3QsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBhc3luYy51bnRpbCA9IGZ1bmN0aW9uICh0ZXN0LCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKCF0ZXN0KCkpIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhc3luYy51bnRpbCh0ZXN0LCBpdGVyYXRvciwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGFzeW5jLmRvVW50aWwgPSBmdW5jdGlvbiAoaXRlcmF0b3IsIHRlc3QsIGNhbGxiYWNrKSB7XG4gICAgICAgIGl0ZXJhdG9yKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICAgICAgICAgIGlmICghdGVzdC5hcHBseShudWxsLCBhcmdzKSkge1xuICAgICAgICAgICAgICAgIGFzeW5jLmRvVW50aWwoaXRlcmF0b3IsIHRlc3QsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBhc3luYy5xdWV1ZSA9IGZ1bmN0aW9uICh3b3JrZXIsIGNvbmN1cnJlbmN5KSB7XG4gICAgICAgIGlmIChjb25jdXJyZW5jeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25jdXJyZW5jeSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gX2luc2VydChxLCBkYXRhLCBwb3MsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgaWYgKCFxLnN0YXJ0ZWQpe1xuICAgICAgICAgICAgcS5zdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFfaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICBkYXRhID0gW2RhdGFdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihkYXRhLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgLy8gY2FsbCBkcmFpbiBpbW1lZGlhdGVseSBpZiB0aGVyZSBhcmUgbm8gdGFza3NcbiAgICAgICAgICAgICByZXR1cm4gYXN5bmMuc2V0SW1tZWRpYXRlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICBpZiAocS5kcmFpbikge1xuICAgICAgICAgICAgICAgICAgICAgcS5kcmFpbigpO1xuICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIF9lYWNoKGRhdGEsIGZ1bmN0aW9uKHRhc2spIHtcbiAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB7XG4gICAgICAgICAgICAgICAgICBkYXRhOiB0YXNrLFxuICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyA/IGNhbGxiYWNrIDogbnVsbFxuICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgIGlmIChwb3MpIHtcbiAgICAgICAgICAgICAgICBxLnRhc2tzLnVuc2hpZnQoaXRlbSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcS50YXNrcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKHEuc2F0dXJhdGVkICYmIHEudGFza3MubGVuZ3RoID09PSBxLmNvbmN1cnJlbmN5KSB7XG4gICAgICAgICAgICAgICAgICBxLnNhdHVyYXRlZCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGFzeW5jLnNldEltbWVkaWF0ZShxLnByb2Nlc3MpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHdvcmtlcnMgPSAwO1xuICAgICAgICB2YXIgcSA9IHtcbiAgICAgICAgICAgIHRhc2tzOiBbXSxcbiAgICAgICAgICAgIGNvbmN1cnJlbmN5OiBjb25jdXJyZW5jeSxcbiAgICAgICAgICAgIHNhdHVyYXRlZDogbnVsbCxcbiAgICAgICAgICAgIGVtcHR5OiBudWxsLFxuICAgICAgICAgICAgZHJhaW46IG51bGwsXG4gICAgICAgICAgICBzdGFydGVkOiBmYWxzZSxcbiAgICAgICAgICAgIHBhdXNlZDogZmFsc2UsXG4gICAgICAgICAgICBwdXNoOiBmdW5jdGlvbiAoZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgX2luc2VydChxLCBkYXRhLCBmYWxzZSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGtpbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcS5kcmFpbiA9IG51bGw7XG4gICAgICAgICAgICAgIHEudGFza3MgPSBbXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1bnNoaWZ0OiBmdW5jdGlvbiAoZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgX2luc2VydChxLCBkYXRhLCB0cnVlLCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJvY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghcS5wYXVzZWQgJiYgd29ya2VycyA8IHEuY29uY3VycmVuY3kgJiYgcS50YXNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhc2sgPSBxLnRhc2tzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxLmVtcHR5ICYmIHEudGFza3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgd29ya2VycyArPSAxO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtlcnMgLT0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXNrLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5jYWxsYmFjay5hcHBseSh0YXNrLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHEuZHJhaW4gJiYgcS50YXNrcy5sZW5ndGggKyB3b3JrZXJzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcS5kcmFpbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcS5wcm9jZXNzKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYiA9IG9ubHlfb25jZShuZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgd29ya2VyKHRhc2suZGF0YSwgY2IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZW5ndGg6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcS50YXNrcy5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcnVubmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB3b3JrZXJzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlkbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxLnRhc2tzLmxlbmd0aCArIHdvcmtlcnMgPT09IDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAocS5wYXVzZWQgPT09IHRydWUpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgcS5wYXVzZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHEucHJvY2VzcygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc3VtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChxLnBhdXNlZCA9PT0gZmFsc2UpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgcS5wYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBxLnByb2Nlc3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHE7XG4gICAgfTtcbiAgICBcbiAgICBhc3luYy5wcmlvcml0eVF1ZXVlID0gZnVuY3Rpb24gKHdvcmtlciwgY29uY3VycmVuY3kpIHtcbiAgICAgICAgXG4gICAgICAgIGZ1bmN0aW9uIF9jb21wYXJlVGFza3MoYSwgYil7XG4gICAgICAgICAgcmV0dXJuIGEucHJpb3JpdHkgLSBiLnByaW9yaXR5O1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgZnVuY3Rpb24gX2JpbmFyeVNlYXJjaChzZXF1ZW5jZSwgaXRlbSwgY29tcGFyZSkge1xuICAgICAgICAgIHZhciBiZWcgPSAtMSxcbiAgICAgICAgICAgICAgZW5kID0gc2VxdWVuY2UubGVuZ3RoIC0gMTtcbiAgICAgICAgICB3aGlsZSAoYmVnIDwgZW5kKSB7XG4gICAgICAgICAgICB2YXIgbWlkID0gYmVnICsgKChlbmQgLSBiZWcgKyAxKSA+Pj4gMSk7XG4gICAgICAgICAgICBpZiAoY29tcGFyZShpdGVtLCBzZXF1ZW5jZVttaWRdKSA+PSAwKSB7XG4gICAgICAgICAgICAgIGJlZyA9IG1pZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVuZCA9IG1pZCAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBiZWc7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZ1bmN0aW9uIF9pbnNlcnQocSwgZGF0YSwgcHJpb3JpdHksIGNhbGxiYWNrKSB7XG4gICAgICAgICAgaWYgKCFxLnN0YXJ0ZWQpe1xuICAgICAgICAgICAgcS5zdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFfaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICBkYXRhID0gW2RhdGFdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihkYXRhLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgLy8gY2FsbCBkcmFpbiBpbW1lZGlhdGVseSBpZiB0aGVyZSBhcmUgbm8gdGFza3NcbiAgICAgICAgICAgICByZXR1cm4gYXN5bmMuc2V0SW1tZWRpYXRlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICBpZiAocS5kcmFpbikge1xuICAgICAgICAgICAgICAgICAgICAgcS5kcmFpbigpO1xuICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIF9lYWNoKGRhdGEsIGZ1bmN0aW9uKHRhc2spIHtcbiAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB7XG4gICAgICAgICAgICAgICAgICBkYXRhOiB0YXNrLFxuICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyA/IGNhbGxiYWNrIDogbnVsbFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgcS50YXNrcy5zcGxpY2UoX2JpbmFyeVNlYXJjaChxLnRhc2tzLCBpdGVtLCBfY29tcGFyZVRhc2tzKSArIDEsIDAsIGl0ZW0pO1xuXG4gICAgICAgICAgICAgIGlmIChxLnNhdHVyYXRlZCAmJiBxLnRhc2tzLmxlbmd0aCA9PT0gcS5jb25jdXJyZW5jeSkge1xuICAgICAgICAgICAgICAgICAgcS5zYXR1cmF0ZWQoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBhc3luYy5zZXRJbW1lZGlhdGUocS5wcm9jZXNzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gU3RhcnQgd2l0aCBhIG5vcm1hbCBxdWV1ZVxuICAgICAgICB2YXIgcSA9IGFzeW5jLnF1ZXVlKHdvcmtlciwgY29uY3VycmVuY3kpO1xuICAgICAgICBcbiAgICAgICAgLy8gT3ZlcnJpZGUgcHVzaCB0byBhY2NlcHQgc2Vjb25kIHBhcmFtZXRlciByZXByZXNlbnRpbmcgcHJpb3JpdHlcbiAgICAgICAgcS5wdXNoID0gZnVuY3Rpb24gKGRhdGEsIHByaW9yaXR5LCBjYWxsYmFjaykge1xuICAgICAgICAgIF9pbnNlcnQocSwgZGF0YSwgcHJpb3JpdHksIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIFJlbW92ZSB1bnNoaWZ0IGZ1bmN0aW9uXG4gICAgICAgIGRlbGV0ZSBxLnVuc2hpZnQ7XG5cbiAgICAgICAgcmV0dXJuIHE7XG4gICAgfTtcblxuICAgIGFzeW5jLmNhcmdvID0gZnVuY3Rpb24gKHdvcmtlciwgcGF5bG9hZCkge1xuICAgICAgICB2YXIgd29ya2luZyAgICAgPSBmYWxzZSxcbiAgICAgICAgICAgIHRhc2tzICAgICAgID0gW107XG5cbiAgICAgICAgdmFyIGNhcmdvID0ge1xuICAgICAgICAgICAgdGFza3M6IHRhc2tzLFxuICAgICAgICAgICAgcGF5bG9hZDogcGF5bG9hZCxcbiAgICAgICAgICAgIHNhdHVyYXRlZDogbnVsbCxcbiAgICAgICAgICAgIGVtcHR5OiBudWxsLFxuICAgICAgICAgICAgZHJhaW46IG51bGwsXG4gICAgICAgICAgICBkcmFpbmVkOiB0cnVlLFxuICAgICAgICAgICAgcHVzaDogZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFfaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gW2RhdGFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfZWFjaChkYXRhLCBmdW5jdGlvbih0YXNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGFzayxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgPyBjYWxsYmFjayA6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNhcmdvLmRyYWluZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhcmdvLnNhdHVyYXRlZCAmJiB0YXNrcy5sZW5ndGggPT09IHBheWxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcmdvLnNhdHVyYXRlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYXN5bmMuc2V0SW1tZWRpYXRlKGNhcmdvLnByb2Nlc3MpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByb2Nlc3M6IGZ1bmN0aW9uIHByb2Nlc3MoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdvcmtpbmcpIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodGFza3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGNhcmdvLmRyYWluICYmICFjYXJnby5kcmFpbmVkKSBjYXJnby5kcmFpbigpO1xuICAgICAgICAgICAgICAgICAgICBjYXJnby5kcmFpbmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciB0cyA9IHR5cGVvZiBwYXlsb2FkID09PSAnbnVtYmVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdGFza3Muc3BsaWNlKDAsIHBheWxvYWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB0YXNrcy5zcGxpY2UoMCwgdGFza3MubGVuZ3RoKTtcblxuICAgICAgICAgICAgICAgIHZhciBkcyA9IF9tYXAodHMsIGZ1bmN0aW9uICh0YXNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXNrLmRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZihjYXJnby5lbXB0eSkgY2FyZ28uZW1wdHkoKTtcbiAgICAgICAgICAgICAgICB3b3JraW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB3b3JrZXIoZHMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgd29ya2luZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICAgICBfZWFjaCh0cywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5jYWxsYmFjay5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcHJvY2VzcygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlbmd0aDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0YXNrcy5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcnVubmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB3b3JraW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FyZ287XG4gICAgfTtcblxuICAgIHZhciBfY29uc29sZV9mbiA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICAgICAgICAgIGZuLmFwcGx5KG51bGwsIGFyZ3MuY29uY2F0KFtmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnNvbGUuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uc29sZVtuYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2VhY2goYXJncywgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlW25hbWVdKHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XSkpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgYXN5bmMubG9nID0gX2NvbnNvbGVfZm4oJ2xvZycpO1xuICAgIGFzeW5jLmRpciA9IF9jb25zb2xlX2ZuKCdkaXInKTtcbiAgICAvKmFzeW5jLmluZm8gPSBfY29uc29sZV9mbignaW5mbycpO1xuICAgIGFzeW5jLndhcm4gPSBfY29uc29sZV9mbignd2FybicpO1xuICAgIGFzeW5jLmVycm9yID0gX2NvbnNvbGVfZm4oJ2Vycm9yJyk7Ki9cblxuICAgIGFzeW5jLm1lbW9pemUgPSBmdW5jdGlvbiAoZm4sIGhhc2hlcikge1xuICAgICAgICB2YXIgbWVtbyA9IHt9O1xuICAgICAgICB2YXIgcXVldWVzID0ge307XG4gICAgICAgIGhhc2hlciA9IGhhc2hlciB8fCBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgcmV0dXJuIHg7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBtZW1vaXplZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3MucG9wKCk7XG4gICAgICAgICAgICB2YXIga2V5ID0gaGFzaGVyLmFwcGx5KG51bGwsIGFyZ3MpO1xuICAgICAgICAgICAgaWYgKGtleSBpbiBtZW1vKSB7XG4gICAgICAgICAgICAgICAgYXN5bmMubmV4dFRpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBtZW1vW2tleV0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5IGluIHF1ZXVlcykge1xuICAgICAgICAgICAgICAgIHF1ZXVlc1trZXldLnB1c2goY2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcXVldWVzW2tleV0gPSBbY2FsbGJhY2tdO1xuICAgICAgICAgICAgICAgIGZuLmFwcGx5KG51bGwsIGFyZ3MuY29uY2F0KFtmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbW9ba2V5XSA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHEgPSBxdWV1ZXNba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHF1ZXVlc1trZXldO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcVtpXS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfV0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgbWVtb2l6ZWQubWVtbyA9IG1lbW87XG4gICAgICAgIG1lbW9pemVkLnVubWVtb2l6ZWQgPSBmbjtcbiAgICAgICAgcmV0dXJuIG1lbW9pemVkO1xuICAgIH07XG5cbiAgICBhc3luYy51bm1lbW9pemUgPSBmdW5jdGlvbiAoZm4pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoZm4udW5tZW1vaXplZCB8fCBmbikuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIGFzeW5jLnRpbWVzID0gZnVuY3Rpb24gKGNvdW50LCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGNvdW50ZXIgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBjb3VudGVyLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFzeW5jLm1hcChjb3VudGVyLCBpdGVyYXRvciwgY2FsbGJhY2spO1xuICAgIH07XG5cbiAgICBhc3luYy50aW1lc1NlcmllcyA9IGZ1bmN0aW9uIChjb3VudCwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBjb3VudGVyID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgY291bnRlci5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhc3luYy5tYXBTZXJpZXMoY291bnRlciwgaXRlcmF0b3IsIGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgYXN5bmMuc2VxID0gZnVuY3Rpb24gKC8qIGZ1bmN0aW9ucy4uLiAqLykge1xuICAgICAgICB2YXIgZm5zID0gYXJndW1lbnRzO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICAgICAgICAgIGFzeW5jLnJlZHVjZShmbnMsIGFyZ3MsIGZ1bmN0aW9uIChuZXdhcmdzLCBmbiwgY2IpIHtcbiAgICAgICAgICAgICAgICBmbi5hcHBseSh0aGF0LCBuZXdhcmdzLmNvbmNhdChbZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyID0gYXJndW1lbnRzWzBdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgICAgICAgICAgICAgICAgICBjYihlcnIsIG5leHRhcmdzKTtcbiAgICAgICAgICAgICAgICB9XSkpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnVuY3Rpb24gKGVyciwgcmVzdWx0cykge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHRoYXQsIFtlcnJdLmNvbmNhdChyZXN1bHRzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgYXN5bmMuY29tcG9zZSA9IGZ1bmN0aW9uICgvKiBmdW5jdGlvbnMuLi4gKi8pIHtcbiAgICAgIHJldHVybiBhc3luYy5zZXEuYXBwbHkobnVsbCwgQXJyYXkucHJvdG90eXBlLnJldmVyc2UuY2FsbChhcmd1bWVudHMpKTtcbiAgICB9O1xuXG4gICAgdmFyIF9hcHBseUVhY2ggPSBmdW5jdGlvbiAoZWFjaGZuLCBmbnMgLyphcmdzLi4uKi8pIHtcbiAgICAgICAgdmFyIGdvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICAgICAgICAgIHJldHVybiBlYWNoZm4oZm5zLCBmdW5jdGlvbiAoZm4sIGNiKSB7XG4gICAgICAgICAgICAgICAgZm4uYXBwbHkodGhhdCwgYXJncy5jb25jYXQoW2NiXSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG4gICAgICAgICAgICByZXR1cm4gZ28uYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZ287XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGFzeW5jLmFwcGx5RWFjaCA9IGRvUGFyYWxsZWwoX2FwcGx5RWFjaCk7XG4gICAgYXN5bmMuYXBwbHlFYWNoU2VyaWVzID0gZG9TZXJpZXMoX2FwcGx5RWFjaCk7XG5cbiAgICBhc3luYy5mb3JldmVyID0gZnVuY3Rpb24gKGZuLCBjYWxsYmFjaykge1xuICAgICAgICBmdW5jdGlvbiBuZXh0KGVycikge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm4obmV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgbmV4dCgpO1xuICAgIH07XG5cbiAgICAvLyBOb2RlLmpzXG4gICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0gYXN5bmM7XG4gICAgfVxuICAgIC8vIEFNRCAvIFJlcXVpcmVKU1xuICAgIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgIT09ICd1bmRlZmluZWQnICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKFtdLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXN5bmM7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBpbmNsdWRlZCBkaXJlY3RseSB2aWEgPHNjcmlwdD4gdGFnXG4gICAgZWxzZSB7XG4gICAgICAgIHJvb3QuYXN5bmMgPSBhc3luYztcbiAgICB9XG5cbn0oKSk7XG4iLCIvLyBzaGltIGZvciB1c2luZyBwcm9jZXNzIGluIGJyb3dzZXJcblxudmFyIHByb2Nlc3MgPSBtb2R1bGUuZXhwb3J0cyA9IHt9O1xudmFyIHF1ZXVlID0gW107XG52YXIgZHJhaW5pbmcgPSBmYWxzZTtcblxuZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHtcbiAgICBpZiAoZHJhaW5pbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBkcmFpbmluZyA9IHRydWU7XG4gICAgdmFyIGN1cnJlbnRRdWV1ZTtcbiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIHdoaWxlKGxlbikge1xuICAgICAgICBjdXJyZW50UXVldWUgPSBxdWV1ZTtcbiAgICAgICAgcXVldWUgPSBbXTtcbiAgICAgICAgdmFyIGkgPSAtMTtcbiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikge1xuICAgICAgICAgICAgY3VycmVudFF1ZXVlW2ldKCk7XG4gICAgICAgIH1cbiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIH1cbiAgICBkcmFpbmluZyA9IGZhbHNlO1xufVxucHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICBxdWV1ZS5wdXNoKGZ1bik7XG4gICAgaWYgKCFkcmFpbmluZykge1xuICAgICAgICBzZXRUaW1lb3V0KGRyYWluUXVldWUsIDApO1xuICAgIH1cbn07XG5cbnByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xucHJvY2Vzcy5lbnYgPSB7fTtcbnByb2Nlc3MuYXJndiA9IFtdO1xucHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzXG5wcm9jZXNzLnZlcnNpb25zID0ge307XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG5wcm9jZXNzLm9uID0gbm9vcDtcbnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5vbmNlID0gbm9vcDtcbnByb2Nlc3Mub2ZmID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBub29wO1xucHJvY2Vzcy5lbWl0ID0gbm9vcDtcblxucHJvY2Vzcy5iaW5kaW5nID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuXG4vLyBUT0RPKHNodHlsbWFuKVxucHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnLycgfTtcbnByb2Nlc3MuY2hkaXIgPSBmdW5jdGlvbiAoZGlyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG5wcm9jZXNzLnVtYXNrID0gZnVuY3Rpb24oKSB7IHJldHVybiAwOyB9O1xuIiwiXG4vKlxuICpcbiAqIE1vcmUgaW5mbyBhdCBbd3d3LmRyb3B6b25lanMuY29tXShodHRwOi8vd3d3LmRyb3B6b25lanMuY29tKVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMiwgTWF0aWFzIE1lbm9cbiAqXG4gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4gKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4gKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4gKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gKlxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbiAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuICogVEhFIFNPRlRXQVJFLlxuICpcbiAqL1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBEcm9wem9uZSwgRW1pdHRlciwgY2FtZWxpemUsIGNvbnRlbnRMb2FkZWQsIGRldGVjdFZlcnRpY2FsU3F1YXNoLCBkcmF3SW1hZ2VJT1NGaXgsIG5vb3AsIHdpdGhvdXQsXG4gICAgX19zbGljZSA9IFtdLnNsaWNlLFxuICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG4gIG5vb3AgPSBmdW5jdGlvbigpIHt9O1xuXG4gIEVtaXR0ZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gRW1pdHRlcigpIHt9XG5cbiAgICBFbWl0dGVyLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gRW1pdHRlci5wcm90b3R5cGUub247XG5cbiAgICBFbWl0dGVyLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGV2ZW50LCBmbikge1xuICAgICAgdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9O1xuICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3NbZXZlbnRdKSB7XG4gICAgICAgIHRoaXMuX2NhbGxiYWNrc1tldmVudF0gPSBbXTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2NhbGxiYWNrc1tldmVudF0ucHVzaChmbik7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgRW1pdHRlci5wcm90b3R5cGUuZW1pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFyZ3MsIGNhbGxiYWNrLCBjYWxsYmFja3MsIGV2ZW50LCBfaSwgX2xlbjtcbiAgICAgIGV2ZW50ID0gYXJndW1lbnRzWzBdLCBhcmdzID0gMiA8PSBhcmd1bWVudHMubGVuZ3RoID8gX19zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkgOiBbXTtcbiAgICAgIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fTtcbiAgICAgIGNhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrc1tldmVudF07XG4gICAgICBpZiAoY2FsbGJhY2tzKSB7XG4gICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gY2FsbGJhY2tzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFja3NbX2ldO1xuICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgRW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBFbWl0dGVyLnByb3RvdHlwZS5vZmY7XG5cbiAgICBFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBFbWl0dGVyLnByb3RvdHlwZS5vZmY7XG5cbiAgICBFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyID0gRW1pdHRlci5wcm90b3R5cGUub2ZmO1xuXG4gICAgRW1pdHRlci5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24oZXZlbnQsIGZuKSB7XG4gICAgICB2YXIgY2FsbGJhY2ssIGNhbGxiYWNrcywgaSwgX2ksIF9sZW47XG4gICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrcyB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMuX2NhbGxiYWNrcyA9IHt9O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrc1tldmVudF07XG4gICAgICBpZiAoIWNhbGxiYWNrcykge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLl9jYWxsYmFja3NbZXZlbnRdO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIGZvciAoaSA9IF9pID0gMCwgX2xlbiA9IGNhbGxiYWNrcy5sZW5ndGg7IF9pIDwgX2xlbjsgaSA9ICsrX2kpIHtcbiAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFja3NbaV07XG4gICAgICAgIGlmIChjYWxsYmFjayA9PT0gZm4pIHtcbiAgICAgICAgICBjYWxsYmFja3Muc3BsaWNlKGksIDEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIEVtaXR0ZXI7XG5cbiAgfSkoKTtcblxuICBEcm9wem9uZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgICB2YXIgZXh0ZW5kLCByZXNvbHZlT3B0aW9uO1xuXG4gICAgX19leHRlbmRzKERyb3B6b25lLCBfc3VwZXIpO1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLkVtaXR0ZXIgPSBFbWl0dGVyO1xuXG5cbiAgICAvKlxuICAgIFRoaXMgaXMgYSBsaXN0IG9mIGFsbCBhdmFpbGFibGUgZXZlbnRzIHlvdSBjYW4gcmVnaXN0ZXIgb24gYSBkcm9wem9uZSBvYmplY3QuXG4gICAgXG4gICAgWW91IGNhbiByZWdpc3RlciBhbiBldmVudCBoYW5kbGVyIGxpa2UgdGhpczpcbiAgICBcbiAgICAgICAgZHJvcHpvbmUub24oXCJkcmFnRW50ZXJcIiwgZnVuY3Rpb24oKSB7IH0pO1xuICAgICAqL1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmV2ZW50cyA9IFtcImRyb3BcIiwgXCJkcmFnc3RhcnRcIiwgXCJkcmFnZW5kXCIsIFwiZHJhZ2VudGVyXCIsIFwiZHJhZ292ZXJcIiwgXCJkcmFnbGVhdmVcIiwgXCJhZGRlZGZpbGVcIiwgXCJyZW1vdmVkZmlsZVwiLCBcInRodW1ibmFpbFwiLCBcImVycm9yXCIsIFwiZXJyb3JtdWx0aXBsZVwiLCBcInByb2Nlc3NpbmdcIiwgXCJwcm9jZXNzaW5nbXVsdGlwbGVcIiwgXCJ1cGxvYWRwcm9ncmVzc1wiLCBcInRvdGFsdXBsb2FkcHJvZ3Jlc3NcIiwgXCJzZW5kaW5nXCIsIFwic2VuZGluZ211bHRpcGxlXCIsIFwic3VjY2Vzc1wiLCBcInN1Y2Nlc3NtdWx0aXBsZVwiLCBcImNhbmNlbGVkXCIsIFwiY2FuY2VsZWRtdWx0aXBsZVwiLCBcImNvbXBsZXRlXCIsIFwiY29tcGxldGVtdWx0aXBsZVwiLCBcInJlc2V0XCIsIFwibWF4ZmlsZXNleGNlZWRlZFwiLCBcIm1heGZpbGVzcmVhY2hlZFwiLCBcInF1ZXVlY29tcGxldGVcIl07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICB1cmw6IG51bGwsXG4gICAgICBtZXRob2Q6IFwicG9zdFwiLFxuICAgICAgd2l0aENyZWRlbnRpYWxzOiBmYWxzZSxcbiAgICAgIHBhcmFsbGVsVXBsb2FkczogMixcbiAgICAgIHVwbG9hZE11bHRpcGxlOiBmYWxzZSxcbiAgICAgIG1heEZpbGVzaXplOiAyNTYsXG4gICAgICBwYXJhbU5hbWU6IFwiZmlsZVwiLFxuICAgICAgY3JlYXRlSW1hZ2VUaHVtYm5haWxzOiB0cnVlLFxuICAgICAgbWF4VGh1bWJuYWlsRmlsZXNpemU6IDEwLFxuICAgICAgdGh1bWJuYWlsV2lkdGg6IDEyMCxcbiAgICAgIHRodW1ibmFpbEhlaWdodDogMTIwLFxuICAgICAgZmlsZXNpemVCYXNlOiAxMDAwLFxuICAgICAgbWF4RmlsZXM6IG51bGwsXG4gICAgICBmaWxlc2l6ZUJhc2U6IDEwMDAsXG4gICAgICBwYXJhbXM6IHt9LFxuICAgICAgY2xpY2thYmxlOiB0cnVlLFxuICAgICAgaWdub3JlSGlkZGVuRmlsZXM6IHRydWUsXG4gICAgICBhY2NlcHRlZEZpbGVzOiBudWxsLFxuICAgICAgYWNjZXB0ZWRNaW1lVHlwZXM6IG51bGwsXG4gICAgICBhdXRvUHJvY2Vzc1F1ZXVlOiB0cnVlLFxuICAgICAgYXV0b1F1ZXVlOiB0cnVlLFxuICAgICAgYWRkUmVtb3ZlTGlua3M6IGZhbHNlLFxuICAgICAgcHJldmlld3NDb250YWluZXI6IG51bGwsXG4gICAgICBjYXB0dXJlOiBudWxsLFxuICAgICAgZGljdERlZmF1bHRNZXNzYWdlOiBcIkRyb3AgZmlsZXMgaGVyZSB0byB1cGxvYWRcIixcbiAgICAgIGRpY3RGYWxsYmFja01lc3NhZ2U6IFwiWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgZHJhZyduJ2Ryb3AgZmlsZSB1cGxvYWRzLlwiLFxuICAgICAgZGljdEZhbGxiYWNrVGV4dDogXCJQbGVhc2UgdXNlIHRoZSBmYWxsYmFjayBmb3JtIGJlbG93IHRvIHVwbG9hZCB5b3VyIGZpbGVzIGxpa2UgaW4gdGhlIG9sZGVuIGRheXMuXCIsXG4gICAgICBkaWN0RmlsZVRvb0JpZzogXCJGaWxlIGlzIHRvbyBiaWcgKHt7ZmlsZXNpemV9fU1pQikuIE1heCBmaWxlc2l6ZToge3ttYXhGaWxlc2l6ZX19TWlCLlwiLFxuICAgICAgZGljdEludmFsaWRGaWxlVHlwZTogXCJZb3UgY2FuJ3QgdXBsb2FkIGZpbGVzIG9mIHRoaXMgdHlwZS5cIixcbiAgICAgIGRpY3RSZXNwb25zZUVycm9yOiBcIlNlcnZlciByZXNwb25kZWQgd2l0aCB7e3N0YXR1c0NvZGV9fSBjb2RlLlwiLFxuICAgICAgZGljdENhbmNlbFVwbG9hZDogXCJDYW5jZWwgdXBsb2FkXCIsXG4gICAgICBkaWN0Q2FuY2VsVXBsb2FkQ29uZmlybWF0aW9uOiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjYW5jZWwgdGhpcyB1cGxvYWQ/XCIsXG4gICAgICBkaWN0UmVtb3ZlRmlsZTogXCJSZW1vdmUgZmlsZVwiLFxuICAgICAgZGljdFJlbW92ZUZpbGVDb25maXJtYXRpb246IG51bGwsXG4gICAgICBkaWN0TWF4RmlsZXNFeGNlZWRlZDogXCJZb3UgY2FuIG5vdCB1cGxvYWQgYW55IG1vcmUgZmlsZXMuXCIsXG4gICAgICBhY2NlcHQ6IGZ1bmN0aW9uKGZpbGUsIGRvbmUpIHtcbiAgICAgICAgcmV0dXJuIGRvbmUoKTtcbiAgICAgIH0sXG4gICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5vb3A7XG4gICAgICB9LFxuICAgICAgZm9yY2VGYWxsYmFjazogZmFsc2UsXG4gICAgICBmYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjaGlsZCwgbWVzc2FnZUVsZW1lbnQsIHNwYW4sIF9pLCBfbGVuLCBfcmVmO1xuICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NOYW1lID0gXCJcIiArIHRoaXMuZWxlbWVudC5jbGFzc05hbWUgKyBcIiBkei1icm93c2VyLW5vdC1zdXBwb3J0ZWRcIjtcbiAgICAgICAgX3JlZiA9IHRoaXMuZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRpdlwiKTtcbiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgY2hpbGQgPSBfcmVmW19pXTtcbiAgICAgICAgICBpZiAoLyhefCApZHotbWVzc2FnZSgkfCApLy50ZXN0KGNoaWxkLmNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VFbGVtZW50ID0gY2hpbGQ7XG4gICAgICAgICAgICBjaGlsZC5jbGFzc05hbWUgPSBcImR6LW1lc3NhZ2VcIjtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIW1lc3NhZ2VFbGVtZW50KSB7XG4gICAgICAgICAgbWVzc2FnZUVsZW1lbnQgPSBEcm9wem9uZS5jcmVhdGVFbGVtZW50KFwiPGRpdiBjbGFzcz1cXFwiZHotbWVzc2FnZVxcXCI+PHNwYW4+PC9zcGFuPjwvZGl2PlwiKTtcbiAgICAgICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQobWVzc2FnZUVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHNwYW4gPSBtZXNzYWdlRWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNwYW5cIilbMF07XG4gICAgICAgIGlmIChzcGFuKSB7XG4gICAgICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IHRoaXMub3B0aW9ucy5kaWN0RmFsbGJhY2tNZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5nZXRGYWxsYmFja0Zvcm0oKSk7XG4gICAgICB9LFxuICAgICAgcmVzaXplOiBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgIHZhciBpbmZvLCBzcmNSYXRpbywgdHJnUmF0aW87XG4gICAgICAgIGluZm8gPSB7XG4gICAgICAgICAgc3JjWDogMCxcbiAgICAgICAgICBzcmNZOiAwLFxuICAgICAgICAgIHNyY1dpZHRoOiBmaWxlLndpZHRoLFxuICAgICAgICAgIHNyY0hlaWdodDogZmlsZS5oZWlnaHRcbiAgICAgICAgfTtcbiAgICAgICAgc3JjUmF0aW8gPSBmaWxlLndpZHRoIC8gZmlsZS5oZWlnaHQ7XG4gICAgICAgIGluZm8ub3B0V2lkdGggPSB0aGlzLm9wdGlvbnMudGh1bWJuYWlsV2lkdGg7XG4gICAgICAgIGluZm8ub3B0SGVpZ2h0ID0gdGhpcy5vcHRpb25zLnRodW1ibmFpbEhlaWdodDtcbiAgICAgICAgaWYgKChpbmZvLm9wdFdpZHRoID09IG51bGwpICYmIChpbmZvLm9wdEhlaWdodCA9PSBudWxsKSkge1xuICAgICAgICAgIGluZm8ub3B0V2lkdGggPSBpbmZvLnNyY1dpZHRoO1xuICAgICAgICAgIGluZm8ub3B0SGVpZ2h0ID0gaW5mby5zcmNIZWlnaHQ7XG4gICAgICAgIH0gZWxzZSBpZiAoaW5mby5vcHRXaWR0aCA9PSBudWxsKSB7XG4gICAgICAgICAgaW5mby5vcHRXaWR0aCA9IHNyY1JhdGlvICogaW5mby5vcHRIZWlnaHQ7XG4gICAgICAgIH0gZWxzZSBpZiAoaW5mby5vcHRIZWlnaHQgPT0gbnVsbCkge1xuICAgICAgICAgIGluZm8ub3B0SGVpZ2h0ID0gKDEgLyBzcmNSYXRpbykgKiBpbmZvLm9wdFdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIHRyZ1JhdGlvID0gaW5mby5vcHRXaWR0aCAvIGluZm8ub3B0SGVpZ2h0O1xuICAgICAgICBpZiAoZmlsZS5oZWlnaHQgPCBpbmZvLm9wdEhlaWdodCB8fCBmaWxlLndpZHRoIDwgaW5mby5vcHRXaWR0aCkge1xuICAgICAgICAgIGluZm8udHJnSGVpZ2h0ID0gaW5mby5zcmNIZWlnaHQ7XG4gICAgICAgICAgaW5mby50cmdXaWR0aCA9IGluZm8uc3JjV2lkdGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHNyY1JhdGlvID4gdHJnUmF0aW8pIHtcbiAgICAgICAgICAgIGluZm8uc3JjSGVpZ2h0ID0gZmlsZS5oZWlnaHQ7XG4gICAgICAgICAgICBpbmZvLnNyY1dpZHRoID0gaW5mby5zcmNIZWlnaHQgKiB0cmdSYXRpbztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW5mby5zcmNXaWR0aCA9IGZpbGUud2lkdGg7XG4gICAgICAgICAgICBpbmZvLnNyY0hlaWdodCA9IGluZm8uc3JjV2lkdGggLyB0cmdSYXRpbztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaW5mby5zcmNYID0gKGZpbGUud2lkdGggLSBpbmZvLnNyY1dpZHRoKSAvIDI7XG4gICAgICAgIGluZm8uc3JjWSA9IChmaWxlLmhlaWdodCAtIGluZm8uc3JjSGVpZ2h0KSAvIDI7XG4gICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgfSxcblxuICAgICAgLypcbiAgICAgIFRob3NlIGZ1bmN0aW9ucyByZWdpc3RlciB0aGVtc2VsdmVzIHRvIHRoZSBldmVudHMgb24gaW5pdCBhbmQgaGFuZGxlIGFsbFxuICAgICAgdGhlIHVzZXIgaW50ZXJmYWNlIHNwZWNpZmljIHN0dWZmLiBPdmVyd3JpdGluZyB0aGVtIHdvbid0IGJyZWFrIHRoZSB1cGxvYWRcbiAgICAgIGJ1dCBjYW4gYnJlYWsgdGhlIHdheSBpdCdzIGRpc3BsYXllZC5cbiAgICAgIFlvdSBjYW4gb3ZlcndyaXRlIHRoZW0gaWYgeW91IGRvbid0IGxpa2UgdGhlIGRlZmF1bHQgYmVoYXZpb3IuIElmIHlvdSBqdXN0XG4gICAgICB3YW50IHRvIGFkZCBhbiBhZGRpdGlvbmFsIGV2ZW50IGhhbmRsZXIsIHJlZ2lzdGVyIGl0IG9uIHRoZSBkcm9wem9uZSBvYmplY3RcbiAgICAgIGFuZCBkb24ndCBvdmVyd3JpdGUgdGhvc2Ugb3B0aW9ucy5cbiAgICAgICAqL1xuICAgICAgZHJvcDogZnVuY3Rpb24oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJkei1kcmFnLWhvdmVyXCIpO1xuICAgICAgfSxcbiAgICAgIGRyYWdzdGFydDogbm9vcCxcbiAgICAgIGRyYWdlbmQ6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZHotZHJhZy1ob3ZlclwiKTtcbiAgICAgIH0sXG4gICAgICBkcmFnZW50ZXI6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotZHJhZy1ob3ZlclwiKTtcbiAgICAgIH0sXG4gICAgICBkcmFnb3ZlcjogZnVuY3Rpb24oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkei1kcmFnLWhvdmVyXCIpO1xuICAgICAgfSxcbiAgICAgIGRyYWdsZWF2ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJkei1kcmFnLWhvdmVyXCIpO1xuICAgICAgfSxcbiAgICAgIHBhc3RlOiBub29wLFxuICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJkei1zdGFydGVkXCIpO1xuICAgICAgfSxcbiAgICAgIGFkZGVkZmlsZTogZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICB2YXIgbm9kZSwgcmVtb3ZlRmlsZUV2ZW50LCByZW1vdmVMaW5rLCBfaSwgX2osIF9rLCBfbGVuLCBfbGVuMSwgX2xlbjIsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3Jlc3VsdHM7XG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnQgPT09IHRoaXMucHJldmlld3NDb250YWluZXIpIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImR6LXN0YXJ0ZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJldmlld3NDb250YWluZXIpIHtcbiAgICAgICAgICBmaWxlLnByZXZpZXdFbGVtZW50ID0gRHJvcHpvbmUuY3JlYXRlRWxlbWVudCh0aGlzLm9wdGlvbnMucHJldmlld1RlbXBsYXRlLnRyaW0oKSk7XG4gICAgICAgICAgZmlsZS5wcmV2aWV3VGVtcGxhdGUgPSBmaWxlLnByZXZpZXdFbGVtZW50O1xuICAgICAgICAgIHRoaXMucHJldmlld3NDb250YWluZXIuYXBwZW5kQ2hpbGQoZmlsZS5wcmV2aWV3RWxlbWVudCk7XG4gICAgICAgICAgX3JlZiA9IGZpbGUucHJldmlld0VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWR6LW5hbWVdXCIpO1xuICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgICAgbm9kZSA9IF9yZWZbX2ldO1xuICAgICAgICAgICAgbm9kZS50ZXh0Q29udGVudCA9IGZpbGUubmFtZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgX3JlZjEgPSBmaWxlLnByZXZpZXdFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1kei1zaXplXVwiKTtcbiAgICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBfcmVmMS5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHtcbiAgICAgICAgICAgIG5vZGUgPSBfcmVmMVtfal07XG4gICAgICAgICAgICBub2RlLmlubmVySFRNTCA9IHRoaXMuZmlsZXNpemUoZmlsZS5zaXplKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hZGRSZW1vdmVMaW5rcykge1xuICAgICAgICAgICAgZmlsZS5fcmVtb3ZlTGluayA9IERyb3B6b25lLmNyZWF0ZUVsZW1lbnQoXCI8YSBjbGFzcz1cXFwiZHotcmVtb3ZlXFxcIiBocmVmPVxcXCJqYXZhc2NyaXB0OnVuZGVmaW5lZDtcXFwiIGRhdGEtZHotcmVtb3ZlPlwiICsgdGhpcy5vcHRpb25zLmRpY3RSZW1vdmVGaWxlICsgXCI8L2E+XCIpO1xuICAgICAgICAgICAgZmlsZS5wcmV2aWV3RWxlbWVudC5hcHBlbmRDaGlsZChmaWxlLl9yZW1vdmVMaW5rKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVtb3ZlRmlsZUV2ZW50ID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgIGlmIChmaWxlLnN0YXR1cyA9PT0gRHJvcHpvbmUuVVBMT0FESU5HKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIERyb3B6b25lLmNvbmZpcm0oX3RoaXMub3B0aW9ucy5kaWN0Q2FuY2VsVXBsb2FkQ29uZmlybWF0aW9uLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yZW1vdmVGaWxlKGZpbGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmRpY3RSZW1vdmVGaWxlQ29uZmlybWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gRHJvcHpvbmUuY29uZmlybShfdGhpcy5vcHRpb25zLmRpY3RSZW1vdmVGaWxlQ29uZmlybWF0aW9uLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlbW92ZUZpbGUoZmlsZSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlbW92ZUZpbGUoZmlsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKHRoaXMpO1xuICAgICAgICAgIF9yZWYyID0gZmlsZS5wcmV2aWV3RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtZHotcmVtb3ZlXVwiKTtcbiAgICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICAgIGZvciAoX2sgPSAwLCBfbGVuMiA9IF9yZWYyLmxlbmd0aDsgX2sgPCBfbGVuMjsgX2srKykge1xuICAgICAgICAgICAgcmVtb3ZlTGluayA9IF9yZWYyW19rXTtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2gocmVtb3ZlTGluay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcmVtb3ZlRmlsZUV2ZW50KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlbW92ZWRmaWxlOiBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgIHZhciBfcmVmO1xuICAgICAgICBpZiAoZmlsZS5wcmV2aWV3RWxlbWVudCkge1xuICAgICAgICAgIGlmICgoX3JlZiA9IGZpbGUucHJldmlld0VsZW1lbnQpICE9IG51bGwpIHtcbiAgICAgICAgICAgIF9yZWYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmaWxlLnByZXZpZXdFbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3VwZGF0ZU1heEZpbGVzUmVhY2hlZENsYXNzKCk7XG4gICAgICB9LFxuICAgICAgdGh1bWJuYWlsOiBmdW5jdGlvbihmaWxlLCBkYXRhVXJsKSB7XG4gICAgICAgIHZhciB0aHVtYm5haWxFbGVtZW50LCBfaSwgX2xlbiwgX3JlZjtcbiAgICAgICAgaWYgKGZpbGUucHJldmlld0VsZW1lbnQpIHtcbiAgICAgICAgICBmaWxlLnByZXZpZXdFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJkei1maWxlLXByZXZpZXdcIik7XG4gICAgICAgICAgX3JlZiA9IGZpbGUucHJldmlld0VsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWR6LXRodW1ibmFpbF1cIik7XG4gICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgICB0aHVtYm5haWxFbGVtZW50ID0gX3JlZltfaV07XG4gICAgICAgICAgICB0aHVtYm5haWxFbGVtZW50LmFsdCA9IGZpbGUubmFtZTtcbiAgICAgICAgICAgIHRodW1ibmFpbEVsZW1lbnQuc3JjID0gZGF0YVVybDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gZmlsZS5wcmV2aWV3RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotaW1hZ2UtcHJldmlld1wiKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSkodGhpcykpLCAxKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihmaWxlLCBtZXNzYWdlKSB7XG4gICAgICAgIHZhciBub2RlLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICAgIGlmIChmaWxlLnByZXZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgZmlsZS5wcmV2aWV3RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotZXJyb3JcIik7XG4gICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlICE9PSBcIlN0cmluZ1wiICYmIG1lc3NhZ2UuZXJyb3IpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLmVycm9yO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfcmVmID0gZmlsZS5wcmV2aWV3RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtZHotZXJyb3JtZXNzYWdlXVwiKTtcbiAgICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgICAgbm9kZSA9IF9yZWZbX2ldO1xuICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChub2RlLnRleHRDb250ZW50ID0gbWVzc2FnZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGVycm9ybXVsdGlwbGU6IG5vb3AsXG4gICAgICBwcm9jZXNzaW5nOiBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgIGlmIChmaWxlLnByZXZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgZmlsZS5wcmV2aWV3RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotcHJvY2Vzc2luZ1wiKTtcbiAgICAgICAgICBpZiAoZmlsZS5fcmVtb3ZlTGluaykge1xuICAgICAgICAgICAgcmV0dXJuIGZpbGUuX3JlbW92ZUxpbmsudGV4dENvbnRlbnQgPSB0aGlzLm9wdGlvbnMuZGljdENhbmNlbFVwbG9hZDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwcm9jZXNzaW5nbXVsdGlwbGU6IG5vb3AsXG4gICAgICB1cGxvYWRwcm9ncmVzczogZnVuY3Rpb24oZmlsZSwgcHJvZ3Jlc3MsIGJ5dGVzU2VudCkge1xuICAgICAgICB2YXIgbm9kZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgICBpZiAoZmlsZS5wcmV2aWV3RWxlbWVudCkge1xuICAgICAgICAgIF9yZWYgPSBmaWxlLnByZXZpZXdFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1kei11cGxvYWRwcm9ncmVzc11cIik7XG4gICAgICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgIG5vZGUgPSBfcmVmW19pXTtcbiAgICAgICAgICAgIGlmIChub2RlLm5vZGVOYW1lID09PSAnUFJPR1JFU1MnKSB7XG4gICAgICAgICAgICAgIF9yZXN1bHRzLnB1c2gobm9kZS52YWx1ZSA9IHByb2dyZXNzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIF9yZXN1bHRzLnB1c2gobm9kZS5zdHlsZS53aWR0aCA9IFwiXCIgKyBwcm9ncmVzcyArIFwiJVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdG90YWx1cGxvYWRwcm9ncmVzczogbm9vcCxcbiAgICAgIHNlbmRpbmc6IG5vb3AsXG4gICAgICBzZW5kaW5nbXVsdGlwbGU6IG5vb3AsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgIGlmIChmaWxlLnByZXZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGZpbGUucHJldmlld0VsZW1lbnQuY2xhc3NMaXN0LmFkZChcImR6LXN1Y2Nlc3NcIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzdWNjZXNzbXVsdGlwbGU6IG5vb3AsXG4gICAgICBjYW5jZWxlZDogZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbWl0KFwiZXJyb3JcIiwgZmlsZSwgXCJVcGxvYWQgY2FuY2VsZWQuXCIpO1xuICAgICAgfSxcbiAgICAgIGNhbmNlbGVkbXVsdGlwbGU6IG5vb3AsXG4gICAgICBjb21wbGV0ZTogZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICBpZiAoZmlsZS5fcmVtb3ZlTGluaykge1xuICAgICAgICAgIGZpbGUuX3JlbW92ZUxpbmsudGV4dENvbnRlbnQgPSB0aGlzLm9wdGlvbnMuZGljdFJlbW92ZUZpbGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbGUucHJldmlld0VsZW1lbnQpIHtcbiAgICAgICAgICByZXR1cm4gZmlsZS5wcmV2aWV3RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotY29tcGxldGVcIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjb21wbGV0ZW11bHRpcGxlOiBub29wLFxuICAgICAgbWF4ZmlsZXNleGNlZWRlZDogbm9vcCxcbiAgICAgIG1heGZpbGVzcmVhY2hlZDogbm9vcCxcbiAgICAgIHF1ZXVlY29tcGxldGU6IG5vb3AsXG4gICAgICBwcmV2aWV3VGVtcGxhdGU6IFwiPGRpdiBjbGFzcz1cXFwiZHotcHJldmlldyBkei1maWxlLXByZXZpZXdcXFwiPlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotaW1hZ2VcXFwiPjxpbWcgZGF0YS1kei10aHVtYm5haWwgLz48L2Rpdj5cXG4gIDxkaXYgY2xhc3M9XFxcImR6LWRldGFpbHNcXFwiPlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJkei1zaXplXFxcIj48c3BhbiBkYXRhLWR6LXNpemU+PC9zcGFuPjwvZGl2PlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJkei1maWxlbmFtZVxcXCI+PHNwYW4gZGF0YS1kei1uYW1lPjwvc3Bhbj48L2Rpdj5cXG4gIDwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotcHJvZ3Jlc3NcXFwiPjxzcGFuIGNsYXNzPVxcXCJkei11cGxvYWRcXFwiIGRhdGEtZHotdXBsb2FkcHJvZ3Jlc3M+PC9zcGFuPjwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotZXJyb3ItbWVzc2FnZVxcXCI+PHNwYW4gZGF0YS1kei1lcnJvcm1lc3NhZ2U+PC9zcGFuPjwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotc3VjY2Vzcy1tYXJrXFxcIj5cXG4gICAgPHN2ZyB3aWR0aD1cXFwiNTRweFxcXCIgaGVpZ2h0PVxcXCI1NHB4XFxcIiB2aWV3Qm94PVxcXCIwIDAgNTQgNTRcXFwiIHZlcnNpb249XFxcIjEuMVxcXCIgeG1sbnM9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIiB4bWxuczp4bGluaz1cXFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1xcXCIgeG1sbnM6c2tldGNoPVxcXCJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnNcXFwiPlxcbiAgICAgIDx0aXRsZT5DaGVjazwvdGl0bGU+XFxuICAgICAgPGRlZnM+PC9kZWZzPlxcbiAgICAgIDxnIGlkPVxcXCJQYWdlLTFcXFwiIHN0cm9rZT1cXFwibm9uZVxcXCIgc3Ryb2tlLXdpZHRoPVxcXCIxXFxcIiBmaWxsPVxcXCJub25lXFxcIiBmaWxsLXJ1bGU9XFxcImV2ZW5vZGRcXFwiIHNrZXRjaDp0eXBlPVxcXCJNU1BhZ2VcXFwiPlxcbiAgICAgICAgPHBhdGggZD1cXFwiTTIzLjUsMzEuODQzMTQ1OCBMMTcuNTg1MjQxOSwyNS45MjgzODc3IEMxNi4wMjQ4MjUzLDI0LjM2Nzk3MTEgMTMuNDkxMDI5NCwyNC4zNjY4MzUgMTEuOTI4OTMyMiwyNS45Mjg5MzIyIEMxMC4zNzAwMTM2LDI3LjQ4Nzg1MDggMTAuMzY2NTkxMiwzMC4wMjM0NDU1IDExLjkyODM4NzcsMzEuNTg1MjQxOSBMMjAuNDE0NzU4MSw0MC4wNzE2MTIzIEMyMC41MTMzOTk5LDQwLjE3MDI1NDEgMjAuNjE1OTMxNSw0MC4yNjI2NjQ5IDIwLjcyMTg2MTUsNDAuMzQ4ODQzNSBDMjIuMjgzNTY2OSw0MS44NzI1NjUxIDI0Ljc5NDIzNCw0MS44NjI2MjAyIDI2LjM0NjE1NjQsNDAuMzEwNjk3OCBMNDMuMzEwNjk3OCwyMy4zNDYxNTY0IEM0NC44NzcxMDIxLDIxLjc3OTc1MjEgNDQuODc1ODA1NywxOS4yNDgzODg3IDQzLjMxMzcwODUsMTcuNjg2MjkxNSBDNDEuNzU0Nzg5OSwxNi4xMjczNzI5IDM5LjIxNzYwMzUsMTYuMTI1NTQyMiAzNy42NTM4NDM2LDE3LjY4OTMwMjIgTDIzLjUsMzEuODQzMTQ1OCBaIE0yNyw1MyBDNDEuMzU5NDAzNSw1MyA1Myw0MS4zNTk0MDM1IDUzLDI3IEM1MywxMi42NDA1OTY1IDQxLjM1OTQwMzUsMSAyNywxIEMxMi42NDA1OTY1LDEgMSwxMi42NDA1OTY1IDEsMjcgQzEsNDEuMzU5NDAzNSAxMi42NDA1OTY1LDUzIDI3LDUzIFpcXFwiIGlkPVxcXCJPdmFsLTJcXFwiIHN0cm9rZS1vcGFjaXR5PVxcXCIwLjE5ODc5NDE1OFxcXCIgc3Ryb2tlPVxcXCIjNzQ3NDc0XFxcIiBmaWxsLW9wYWNpdHk9XFxcIjAuODE2NTE5NDc1XFxcIiBmaWxsPVxcXCIjRkZGRkZGXFxcIiBza2V0Y2g6dHlwZT1cXFwiTVNTaGFwZUdyb3VwXFxcIj48L3BhdGg+XFxuICAgICAgPC9nPlxcbiAgICA8L3N2Zz5cXG4gIDwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwiZHotZXJyb3ItbWFya1xcXCI+XFxuICAgIDxzdmcgd2lkdGg9XFxcIjU0cHhcXFwiIGhlaWdodD1cXFwiNTRweFxcXCIgdmlld0JveD1cXFwiMCAwIDU0IDU0XFxcIiB2ZXJzaW9uPVxcXCIxLjFcXFwiIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCIgeG1sbnM6eGxpbms9XFxcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcXFwiIHhtbG5zOnNrZXRjaD1cXFwiaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoL25zXFxcIj5cXG4gICAgICA8dGl0bGU+RXJyb3I8L3RpdGxlPlxcbiAgICAgIDxkZWZzPjwvZGVmcz5cXG4gICAgICA8ZyBpZD1cXFwiUGFnZS0xXFxcIiBzdHJva2U9XFxcIm5vbmVcXFwiIHN0cm9rZS13aWR0aD1cXFwiMVxcXCIgZmlsbD1cXFwibm9uZVxcXCIgZmlsbC1ydWxlPVxcXCJldmVub2RkXFxcIiBza2V0Y2g6dHlwZT1cXFwiTVNQYWdlXFxcIj5cXG4gICAgICAgIDxnIGlkPVxcXCJDaGVjay0rLU92YWwtMlxcXCIgc2tldGNoOnR5cGU9XFxcIk1TTGF5ZXJHcm91cFxcXCIgc3Ryb2tlPVxcXCIjNzQ3NDc0XFxcIiBzdHJva2Utb3BhY2l0eT1cXFwiMC4xOTg3OTQxNThcXFwiIGZpbGw9XFxcIiNGRkZGRkZcXFwiIGZpbGwtb3BhY2l0eT1cXFwiMC44MTY1MTk0NzVcXFwiPlxcbiAgICAgICAgICA8cGF0aCBkPVxcXCJNMzIuNjU2ODU0MiwyOSBMMzguMzEwNjk3OCwyMy4zNDYxNTY0IEMzOS44NzcxMDIxLDIxLjc3OTc1MjEgMzkuODc1ODA1NywxOS4yNDgzODg3IDM4LjMxMzcwODUsMTcuNjg2MjkxNSBDMzYuNzU0Nzg5OSwxNi4xMjczNzI5IDM0LjIxNzYwMzUsMTYuMTI1NTQyMiAzMi42NTM4NDM2LDE3LjY4OTMwMjIgTDI3LDIzLjM0MzE0NTggTDIxLjM0NjE1NjQsMTcuNjg5MzAyMiBDMTkuNzgyMzk2NSwxNi4xMjU1NDIyIDE3LjI0NTIxMDEsMTYuMTI3MzcyOSAxNS42ODYyOTE1LDE3LjY4NjI5MTUgQzE0LjEyNDE5NDMsMTkuMjQ4Mzg4NyAxNC4xMjI4OTc5LDIxLjc3OTc1MjEgMTUuNjg5MzAyMiwyMy4zNDYxNTY0IEwyMS4zNDMxNDU4LDI5IEwxNS42ODkzMDIyLDM0LjY1Mzg0MzYgQzE0LjEyMjg5NzksMzYuMjIwMjQ3OSAxNC4xMjQxOTQzLDM4Ljc1MTYxMTMgMTUuNjg2MjkxNSw0MC4zMTM3MDg1IEMxNy4yNDUyMTAxLDQxLjg3MjYyNzEgMTkuNzgyMzk2NSw0MS44NzQ0NTc4IDIxLjM0NjE1NjQsNDAuMzEwNjk3OCBMMjcsMzQuNjU2ODU0MiBMMzIuNjUzODQzNiw0MC4zMTA2OTc4IEMzNC4yMTc2MDM1LDQxLjg3NDQ1NzggMzYuNzU0Nzg5OSw0MS44NzI2MjcxIDM4LjMxMzcwODUsNDAuMzEzNzA4NSBDMzkuODc1ODA1NywzOC43NTE2MTEzIDM5Ljg3NzEwMjEsMzYuMjIwMjQ3OSAzOC4zMTA2OTc4LDM0LjY1Mzg0MzYgTDMyLjY1Njg1NDIsMjkgWiBNMjcsNTMgQzQxLjM1OTQwMzUsNTMgNTMsNDEuMzU5NDAzNSA1MywyNyBDNTMsMTIuNjQwNTk2NSA0MS4zNTk0MDM1LDEgMjcsMSBDMTIuNjQwNTk2NSwxIDEsMTIuNjQwNTk2NSAxLDI3IEMxLDQxLjM1OTQwMzUgMTIuNjQwNTk2NSw1MyAyNyw1MyBaXFxcIiBpZD1cXFwiT3ZhbC0yXFxcIiBza2V0Y2g6dHlwZT1cXFwiTVNTaGFwZUdyb3VwXFxcIj48L3BhdGg+XFxuICAgICAgICA8L2c+XFxuICAgICAgPC9nPlxcbiAgICA8L3N2Zz5cXG4gIDwvZGl2PlxcbjwvZGl2PlwiXG4gICAgfTtcblxuICAgIGV4dGVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGtleSwgb2JqZWN0LCBvYmplY3RzLCB0YXJnZXQsIHZhbCwgX2ksIF9sZW47XG4gICAgICB0YXJnZXQgPSBhcmd1bWVudHNbMF0sIG9iamVjdHMgPSAyIDw9IGFyZ3VtZW50cy5sZW5ndGggPyBfX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSA6IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBvYmplY3RzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIG9iamVjdCA9IG9iamVjdHNbX2ldO1xuICAgICAgICBmb3IgKGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgICB2YWwgPSBvYmplY3Rba2V5XTtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gRHJvcHpvbmUoZWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgdmFyIGVsZW1lbnRPcHRpb25zLCBmYWxsYmFjaywgX3JlZjtcbiAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICB0aGlzLnZlcnNpb24gPSBEcm9wem9uZS52ZXJzaW9uO1xuICAgICAgdGhpcy5kZWZhdWx0T3B0aW9ucy5wcmV2aWV3VGVtcGxhdGUgPSB0aGlzLmRlZmF1bHRPcHRpb25zLnByZXZpZXdUZW1wbGF0ZS5yZXBsYWNlKC9cXG4qL2csIFwiXCIpO1xuICAgICAgdGhpcy5jbGlja2FibGVFbGVtZW50cyA9IFtdO1xuICAgICAgdGhpcy5saXN0ZW5lcnMgPSBbXTtcbiAgICAgIHRoaXMuZmlsZXMgPSBbXTtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5lbGVtZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5lbGVtZW50KTtcbiAgICAgIH1cbiAgICAgIGlmICghKHRoaXMuZWxlbWVudCAmJiAodGhpcy5lbGVtZW50Lm5vZGVUeXBlICE9IG51bGwpKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGRyb3B6b25lIGVsZW1lbnQuXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZWxlbWVudC5kcm9wem9uZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEcm9wem9uZSBhbHJlYWR5IGF0dGFjaGVkLlwiKTtcbiAgICAgIH1cbiAgICAgIERyb3B6b25lLmluc3RhbmNlcy5wdXNoKHRoaXMpO1xuICAgICAgdGhpcy5lbGVtZW50LmRyb3B6b25lID0gdGhpcztcbiAgICAgIGVsZW1lbnRPcHRpb25zID0gKF9yZWYgPSBEcm9wem9uZS5vcHRpb25zRm9yRWxlbWVudCh0aGlzLmVsZW1lbnQpKSAhPSBudWxsID8gX3JlZiA6IHt9O1xuICAgICAgdGhpcy5vcHRpb25zID0gZXh0ZW5kKHt9LCB0aGlzLmRlZmF1bHRPcHRpb25zLCBlbGVtZW50T3B0aW9ucywgb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucyA6IHt9KTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZm9yY2VGYWxsYmFjayB8fCAhRHJvcHpvbmUuaXNCcm93c2VyU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5mYWxsYmFjay5jYWxsKHRoaXMpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy51cmwgPT0gbnVsbCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMudXJsID0gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZShcImFjdGlvblwiKTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnVybCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBVUkwgcHJvdmlkZWQuXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hY2NlcHRlZEZpbGVzICYmIHRoaXMub3B0aW9ucy5hY2NlcHRlZE1pbWVUeXBlcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgY2FuJ3QgcHJvdmlkZSBib3RoICdhY2NlcHRlZEZpbGVzJyBhbmQgJ2FjY2VwdGVkTWltZVR5cGVzJy4gJ2FjY2VwdGVkTWltZVR5cGVzJyBpcyBkZXByZWNhdGVkLlwiKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWNjZXB0ZWRNaW1lVHlwZXMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmFjY2VwdGVkRmlsZXMgPSB0aGlzLm9wdGlvbnMuYWNjZXB0ZWRNaW1lVHlwZXM7XG4gICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMuYWNjZXB0ZWRNaW1lVHlwZXM7XG4gICAgICB9XG4gICAgICB0aGlzLm9wdGlvbnMubWV0aG9kID0gdGhpcy5vcHRpb25zLm1ldGhvZC50b1VwcGVyQ2FzZSgpO1xuICAgICAgaWYgKChmYWxsYmFjayA9IHRoaXMuZ2V0RXhpc3RpbmdGYWxsYmFjaygpKSAmJiBmYWxsYmFjay5wYXJlbnROb2RlKSB7XG4gICAgICAgIGZhbGxiYWNrLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZmFsbGJhY2spO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5wcmV2aWV3c0NvbnRhaW5lciAhPT0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5wcmV2aWV3c0NvbnRhaW5lcikge1xuICAgICAgICAgIHRoaXMucHJldmlld3NDb250YWluZXIgPSBEcm9wem9uZS5nZXRFbGVtZW50KHRoaXMub3B0aW9ucy5wcmV2aWV3c0NvbnRhaW5lciwgXCJwcmV2aWV3c0NvbnRhaW5lclwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnByZXZpZXdzQ29udGFpbmVyID0gdGhpcy5lbGVtZW50O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmNsaWNrYWJsZSkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNsaWNrYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHRoaXMuY2xpY2thYmxlRWxlbWVudHMgPSBbdGhpcy5lbGVtZW50XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNsaWNrYWJsZUVsZW1lbnRzID0gRHJvcHpvbmUuZ2V0RWxlbWVudHModGhpcy5vcHRpb25zLmNsaWNrYWJsZSwgXCJjbGlja2FibGVcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRBY2NlcHRlZEZpbGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgX3JlZiA9IHRoaXMuZmlsZXM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKGZpbGUuYWNjZXB0ZWQpIHtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGZpbGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRSZWplY3RlZEZpbGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgX3JlZiA9IHRoaXMuZmlsZXM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKCFmaWxlLmFjY2VwdGVkKSB7XG4gICAgICAgICAgX3Jlc3VsdHMucHVzaChmaWxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZ2V0RmlsZXNXaXRoU3RhdHVzID0gZnVuY3Rpb24oc3RhdHVzKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgX3JlZiA9IHRoaXMuZmlsZXM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSBzdGF0dXMpIHtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGZpbGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRRdWV1ZWRGaWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmlsZXNXaXRoU3RhdHVzKERyb3B6b25lLlFVRVVFRCk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRVcGxvYWRpbmdGaWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmlsZXNXaXRoU3RhdHVzKERyb3B6b25lLlVQTE9BRElORyk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRBY3RpdmVGaWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGZpbGUsIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0cztcbiAgICAgIF9yZWYgPSB0aGlzLmZpbGVzO1xuICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICBmaWxlID0gX3JlZltfaV07XG4gICAgICAgIGlmIChmaWxlLnN0YXR1cyA9PT0gRHJvcHpvbmUuVVBMT0FESU5HIHx8IGZpbGUuc3RhdHVzID09PSBEcm9wem9uZS5RVUVVRUQpIHtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGZpbGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZXZlbnROYW1lLCBub1Byb3BhZ2F0aW9uLCBzZXR1cEhpZGRlbkZpbGVJbnB1dCwgX2ksIF9sZW4sIF9yZWYsIF9yZWYxO1xuICAgICAgaWYgKHRoaXMuZWxlbWVudC50YWdOYW1lID09PSBcImZvcm1cIikge1xuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZW5jdHlwZVwiLCBcIm11bHRpcGFydC9mb3JtLWRhdGFcIik7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5lbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcImRyb3B6b25lXCIpICYmICF0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5kei1tZXNzYWdlXCIpKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChEcm9wem9uZS5jcmVhdGVFbGVtZW50KFwiPGRpdiBjbGFzcz1cXFwiZHotZGVmYXVsdCBkei1tZXNzYWdlXFxcIj48c3Bhbj5cIiArIHRoaXMub3B0aW9ucy5kaWN0RGVmYXVsdE1lc3NhZ2UgKyBcIjwvc3Bhbj48L2Rpdj5cIikpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY2xpY2thYmxlRWxlbWVudHMubGVuZ3RoKSB7XG4gICAgICAgIHNldHVwSGlkZGVuRmlsZUlucHV0ID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKF90aGlzLmhpZGRlbkZpbGVJbnB1dCkge1xuICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKF90aGlzLmhpZGRlbkZpbGVJbnB1dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5oaWRkZW5GaWxlSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgICAgICAgICBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImZpbGVcIik7XG4gICAgICAgICAgICBpZiAoKF90aGlzLm9wdGlvbnMubWF4RmlsZXMgPT0gbnVsbCkgfHwgX3RoaXMub3B0aW9ucy5tYXhGaWxlcyA+IDEpIHtcbiAgICAgICAgICAgICAgX3RoaXMuaGlkZGVuRmlsZUlucHV0LnNldEF0dHJpYnV0ZShcIm11bHRpcGxlXCIsIFwibXVsdGlwbGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuY2xhc3NOYW1lID0gXCJkei1oaWRkZW4taW5wdXRcIjtcbiAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmFjY2VwdGVkRmlsZXMgIT0gbnVsbCkge1xuICAgICAgICAgICAgICBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuc2V0QXR0cmlidXRlKFwiYWNjZXB0XCIsIF90aGlzLm9wdGlvbnMuYWNjZXB0ZWRGaWxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5jYXB0dXJlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgX3RoaXMuaGlkZGVuRmlsZUlucHV0LnNldEF0dHJpYnV0ZShcImNhcHR1cmVcIiwgX3RoaXMub3B0aW9ucy5jYXB0dXJlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5zdHlsZS50b3AgPSBcIjBcIjtcbiAgICAgICAgICAgIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5zdHlsZS5sZWZ0ID0gXCIwXCI7XG4gICAgICAgICAgICBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIwXCI7XG4gICAgICAgICAgICBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuc3R5bGUud2lkdGggPSBcIjBcIjtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoX3RoaXMuaGlkZGVuRmlsZUlucHV0KTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgdmFyIGZpbGUsIGZpbGVzLCBfaSwgX2xlbjtcbiAgICAgICAgICAgICAgZmlsZXMgPSBfdGhpcy5oaWRkZW5GaWxlSW5wdXQuZmlsZXM7XG4gICAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICBmaWxlID0gZmlsZXNbX2ldO1xuICAgICAgICAgICAgICAgICAgX3RoaXMuYWRkRmlsZShmaWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHNldHVwSGlkZGVuRmlsZUlucHV0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKTtcbiAgICAgICAgc2V0dXBIaWRkZW5GaWxlSW5wdXQoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuVVJMID0gKF9yZWYgPSB3aW5kb3cuVVJMKSAhPSBudWxsID8gX3JlZiA6IHdpbmRvdy53ZWJraXRVUkw7XG4gICAgICBfcmVmMSA9IHRoaXMuZXZlbnRzO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICBldmVudE5hbWUgPSBfcmVmMVtfaV07XG4gICAgICAgIHRoaXMub24oZXZlbnROYW1lLCB0aGlzLm9wdGlvbnNbZXZlbnROYW1lXSk7XG4gICAgICB9XG4gICAgICB0aGlzLm9uKFwidXBsb2FkcHJvZ3Jlc3NcIiwgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXMudXBkYXRlVG90YWxVcGxvYWRQcm9ncmVzcygpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgdGhpcy5vbihcInJlbW92ZWRmaWxlXCIsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLnVwZGF0ZVRvdGFsVXBsb2FkUHJvZ3Jlc3MoKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHRoaXMub24oXCJjYW5jZWxlZFwiLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuZW1pdChcImNvbXBsZXRlXCIsIGZpbGUpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgdGhpcy5vbihcImNvbXBsZXRlXCIsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgIGlmIChfdGhpcy5nZXRVcGxvYWRpbmdGaWxlcygpLmxlbmd0aCA9PT0gMCAmJiBfdGhpcy5nZXRRdWV1ZWRGaWxlcygpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZW1pdChcInF1ZXVlY29tcGxldGVcIik7XG4gICAgICAgICAgICB9KSwgMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgbm9Qcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgaWYgKGUucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICByZXR1cm4gZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBlLnJldHVyblZhbHVlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB0aGlzLmxpc3RlbmVycyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGVsZW1lbnQ6IHRoaXMuZWxlbWVudCxcbiAgICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgIFwiZHJhZ3N0YXJ0XCI6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lbWl0KFwiZHJhZ3N0YXJ0XCIsIGUpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkodGhpcyksXG4gICAgICAgICAgICBcImRyYWdlbnRlclwiOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBub1Byb3BhZ2F0aW9uKGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lbWl0KFwiZHJhZ2VudGVyXCIsIGUpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkodGhpcyksXG4gICAgICAgICAgICBcImRyYWdvdmVyXCI6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHZhciBlZmN0O1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBlZmN0ID0gZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZDtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHt9XG4gICAgICAgICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICdtb3ZlJyA9PT0gZWZjdCB8fCAnbGlua01vdmUnID09PSBlZmN0ID8gJ21vdmUnIDogJ2NvcHknO1xuICAgICAgICAgICAgICAgIG5vUHJvcGFnYXRpb24oZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVtaXQoXCJkcmFnb3ZlclwiLCBlKTtcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKHRoaXMpLFxuICAgICAgICAgICAgXCJkcmFnbGVhdmVcIjogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVtaXQoXCJkcmFnbGVhdmVcIiwgZSk7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSh0aGlzKSxcbiAgICAgICAgICAgIFwiZHJvcFwiOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBub1Byb3BhZ2F0aW9uKGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5kcm9wKGUpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkodGhpcyksXG4gICAgICAgICAgICBcImRyYWdlbmRcIjogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVtaXQoXCJkcmFnZW5kXCIsIGUpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkodGhpcylcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICB0aGlzLmNsaWNrYWJsZUVsZW1lbnRzLmZvckVhY2goKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihjbGlja2FibGVFbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLmxpc3RlbmVycy5wdXNoKHtcbiAgICAgICAgICAgIGVsZW1lbnQ6IGNsaWNrYWJsZUVsZW1lbnQsXG4gICAgICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgICAgXCJjbGlja1wiOiBmdW5jdGlvbihldnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoKGNsaWNrYWJsZUVsZW1lbnQgIT09IF90aGlzLmVsZW1lbnQpIHx8IChldnQudGFyZ2V0ID09PSBfdGhpcy5lbGVtZW50IHx8IERyb3B6b25lLmVsZW1lbnRJbnNpZGUoZXZ0LnRhcmdldCwgX3RoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmR6LW1lc3NhZ2VcIikpKSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmhpZGRlbkZpbGVJbnB1dC5jbGljaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuaW5pdC5jYWxsKHRoaXMpO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIF9yZWY7XG4gICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgIHRoaXMucmVtb3ZlQWxsRmlsZXModHJ1ZSk7XG4gICAgICBpZiAoKF9yZWYgPSB0aGlzLmhpZGRlbkZpbGVJbnB1dCkgIT0gbnVsbCA/IF9yZWYucGFyZW50Tm9kZSA6IHZvaWQgMCkge1xuICAgICAgICB0aGlzLmhpZGRlbkZpbGVJbnB1dC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuaGlkZGVuRmlsZUlucHV0KTtcbiAgICAgICAgdGhpcy5oaWRkZW5GaWxlSW5wdXQgPSBudWxsO1xuICAgICAgfVxuICAgICAgZGVsZXRlIHRoaXMuZWxlbWVudC5kcm9wem9uZTtcbiAgICAgIHJldHVybiBEcm9wem9uZS5pbnN0YW5jZXMuc3BsaWNlKERyb3B6b25lLmluc3RhbmNlcy5pbmRleE9mKHRoaXMpLCAxKTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLnVwZGF0ZVRvdGFsVXBsb2FkUHJvZ3Jlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBhY3RpdmVGaWxlcywgZmlsZSwgdG90YWxCeXRlcywgdG90YWxCeXRlc1NlbnQsIHRvdGFsVXBsb2FkUHJvZ3Jlc3MsIF9pLCBfbGVuLCBfcmVmO1xuICAgICAgdG90YWxCeXRlc1NlbnQgPSAwO1xuICAgICAgdG90YWxCeXRlcyA9IDA7XG4gICAgICBhY3RpdmVGaWxlcyA9IHRoaXMuZ2V0QWN0aXZlRmlsZXMoKTtcbiAgICAgIGlmIChhY3RpdmVGaWxlcy5sZW5ndGgpIHtcbiAgICAgICAgX3JlZiA9IHRoaXMuZ2V0QWN0aXZlRmlsZXMoKTtcbiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgZmlsZSA9IF9yZWZbX2ldO1xuICAgICAgICAgIHRvdGFsQnl0ZXNTZW50ICs9IGZpbGUudXBsb2FkLmJ5dGVzU2VudDtcbiAgICAgICAgICB0b3RhbEJ5dGVzICs9IGZpbGUudXBsb2FkLnRvdGFsO1xuICAgICAgICB9XG4gICAgICAgIHRvdGFsVXBsb2FkUHJvZ3Jlc3MgPSAxMDAgKiB0b3RhbEJ5dGVzU2VudCAvIHRvdGFsQnl0ZXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0b3RhbFVwbG9hZFByb2dyZXNzID0gMTAwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuZW1pdChcInRvdGFsdXBsb2FkcHJvZ3Jlc3NcIiwgdG90YWxVcGxvYWRQcm9ncmVzcywgdG90YWxCeXRlcywgdG90YWxCeXRlc1NlbnQpO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuX2dldFBhcmFtTmFtZSA9IGZ1bmN0aW9uKG4pIHtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLnBhcmFtTmFtZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMucGFyYW1OYW1lKG4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiXCIgKyB0aGlzLm9wdGlvbnMucGFyYW1OYW1lICsgKHRoaXMub3B0aW9ucy51cGxvYWRNdWx0aXBsZSA/IFwiW1wiICsgbiArIFwiXVwiIDogXCJcIik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5nZXRGYWxsYmFja0Zvcm0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBleGlzdGluZ0ZhbGxiYWNrLCBmaWVsZHMsIGZpZWxkc1N0cmluZywgZm9ybTtcbiAgICAgIGlmIChleGlzdGluZ0ZhbGxiYWNrID0gdGhpcy5nZXRFeGlzdGluZ0ZhbGxiYWNrKCkpIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nRmFsbGJhY2s7XG4gICAgICB9XG4gICAgICBmaWVsZHNTdHJpbmcgPSBcIjxkaXYgY2xhc3M9XFxcImR6LWZhbGxiYWNrXFxcIj5cIjtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGljdEZhbGxiYWNrVGV4dCkge1xuICAgICAgICBmaWVsZHNTdHJpbmcgKz0gXCI8cD5cIiArIHRoaXMub3B0aW9ucy5kaWN0RmFsbGJhY2tUZXh0ICsgXCI8L3A+XCI7XG4gICAgICB9XG4gICAgICBmaWVsZHNTdHJpbmcgKz0gXCI8aW5wdXQgdHlwZT1cXFwiZmlsZVxcXCIgbmFtZT1cXFwiXCIgKyAodGhpcy5fZ2V0UGFyYW1OYW1lKDApKSArIFwiXFxcIiBcIiArICh0aGlzLm9wdGlvbnMudXBsb2FkTXVsdGlwbGUgPyAnbXVsdGlwbGU9XCJtdWx0aXBsZVwiJyA6IHZvaWQgMCkgKyBcIiAvPjxpbnB1dCB0eXBlPVxcXCJzdWJtaXRcXFwiIHZhbHVlPVxcXCJVcGxvYWQhXFxcIj48L2Rpdj5cIjtcbiAgICAgIGZpZWxkcyA9IERyb3B6b25lLmNyZWF0ZUVsZW1lbnQoZmllbGRzU3RyaW5nKTtcbiAgICAgIGlmICh0aGlzLmVsZW1lbnQudGFnTmFtZSAhPT0gXCJGT1JNXCIpIHtcbiAgICAgICAgZm9ybSA9IERyb3B6b25lLmNyZWF0ZUVsZW1lbnQoXCI8Zm9ybSBhY3Rpb249XFxcIlwiICsgdGhpcy5vcHRpb25zLnVybCArIFwiXFxcIiBlbmN0eXBlPVxcXCJtdWx0aXBhcnQvZm9ybS1kYXRhXFxcIiBtZXRob2Q9XFxcIlwiICsgdGhpcy5vcHRpb25zLm1ldGhvZCArIFwiXFxcIj48L2Zvcm0+XCIpO1xuICAgICAgICBmb3JtLmFwcGVuZENoaWxkKGZpZWxkcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZW5jdHlwZVwiLCBcIm11bHRpcGFydC9mb3JtLWRhdGFcIik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJtZXRob2RcIiwgdGhpcy5vcHRpb25zLm1ldGhvZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZm9ybSAhPSBudWxsID8gZm9ybSA6IGZpZWxkcztcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmdldEV4aXN0aW5nRmFsbGJhY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBmYWxsYmFjaywgZ2V0RmFsbGJhY2ssIHRhZ05hbWUsIF9pLCBfbGVuLCBfcmVmO1xuICAgICAgZ2V0RmFsbGJhY2sgPSBmdW5jdGlvbihlbGVtZW50cykge1xuICAgICAgICB2YXIgZWwsIF9pLCBfbGVuO1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGVsZW1lbnRzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgZWwgPSBlbGVtZW50c1tfaV07XG4gICAgICAgICAgaWYgKC8oXnwgKWZhbGxiYWNrKCR8ICkvLnRlc3QoZWwuY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuIGVsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIF9yZWYgPSBbXCJkaXZcIiwgXCJmb3JtXCJdO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIHRhZ05hbWUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKGZhbGxiYWNrID0gZ2V0RmFsbGJhY2sodGhpcy5lbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZ05hbWUpKSkge1xuICAgICAgICAgIHJldHVybiBmYWxsYmFjaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuc2V0dXBFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGVsZW1lbnRMaXN0ZW5lcnMsIGV2ZW50LCBsaXN0ZW5lciwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgX3JlZiA9IHRoaXMubGlzdGVuZXJzO1xuICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICBlbGVtZW50TGlzdGVuZXJzID0gX3JlZltfaV07XG4gICAgICAgIF9yZXN1bHRzLnB1c2goKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBfcmVmMSwgX3Jlc3VsdHMxO1xuICAgICAgICAgIF9yZWYxID0gZWxlbWVudExpc3RlbmVycy5ldmVudHM7XG4gICAgICAgICAgX3Jlc3VsdHMxID0gW107XG4gICAgICAgICAgZm9yIChldmVudCBpbiBfcmVmMSkge1xuICAgICAgICAgICAgbGlzdGVuZXIgPSBfcmVmMVtldmVudF07XG4gICAgICAgICAgICBfcmVzdWx0czEucHVzaChlbGVtZW50TGlzdGVuZXJzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgbGlzdGVuZXIsIGZhbHNlKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfcmVzdWx0czE7XG4gICAgICAgIH0pKCkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBlbGVtZW50TGlzdGVuZXJzLCBldmVudCwgbGlzdGVuZXIsIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0cztcbiAgICAgIF9yZWYgPSB0aGlzLmxpc3RlbmVycztcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZWxlbWVudExpc3RlbmVycyA9IF9yZWZbX2ldO1xuICAgICAgICBfcmVzdWx0cy5wdXNoKChmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgX3JlZjEsIF9yZXN1bHRzMTtcbiAgICAgICAgICBfcmVmMSA9IGVsZW1lbnRMaXN0ZW5lcnMuZXZlbnRzO1xuICAgICAgICAgIF9yZXN1bHRzMSA9IFtdO1xuICAgICAgICAgIGZvciAoZXZlbnQgaW4gX3JlZjEpIHtcbiAgICAgICAgICAgIGxpc3RlbmVyID0gX3JlZjFbZXZlbnRdO1xuICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2goZWxlbWVudExpc3RlbmVycy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGxpc3RlbmVyLCBmYWxzZSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3Jlc3VsdHMxO1xuICAgICAgICB9KSgpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBmaWxlLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICB0aGlzLmNsaWNrYWJsZUVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZHotY2xpY2thYmxlXCIpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICBfcmVmID0gdGhpcy5maWxlcztcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZmlsZSA9IF9yZWZbX2ldO1xuICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMuY2FuY2VsVXBsb2FkKGZpbGUpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5jbGlja2FibGVFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImR6LWNsaWNrYWJsZVwiKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRoaXMuc2V0dXBFdmVudExpc3RlbmVycygpO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuZmlsZXNpemUgPSBmdW5jdGlvbihzaXplKSB7XG4gICAgICB2YXIgY3V0b2ZmLCBpLCBzZWxlY3RlZFNpemUsIHNlbGVjdGVkVW5pdCwgdW5pdCwgdW5pdHMsIF9pLCBfbGVuO1xuICAgICAgdW5pdHMgPSBbJ1RCJywgJ0dCJywgJ01CJywgJ0tCJywgJ2InXTtcbiAgICAgIHNlbGVjdGVkU2l6ZSA9IHNlbGVjdGVkVW5pdCA9IG51bGw7XG4gICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSB1bml0cy5sZW5ndGg7IF9pIDwgX2xlbjsgaSA9ICsrX2kpIHtcbiAgICAgICAgdW5pdCA9IHVuaXRzW2ldO1xuICAgICAgICBjdXRvZmYgPSBNYXRoLnBvdyh0aGlzLm9wdGlvbnMuZmlsZXNpemVCYXNlLCA0IC0gaSkgLyAxMDtcbiAgICAgICAgaWYgKHNpemUgPj0gY3V0b2ZmKSB7XG4gICAgICAgICAgc2VsZWN0ZWRTaXplID0gc2l6ZSAvIE1hdGgucG93KHRoaXMub3B0aW9ucy5maWxlc2l6ZUJhc2UsIDQgLSBpKTtcbiAgICAgICAgICBzZWxlY3RlZFVuaXQgPSB1bml0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBzZWxlY3RlZFNpemUgPSBNYXRoLnJvdW5kKDEwICogc2VsZWN0ZWRTaXplKSAvIDEwO1xuICAgICAgcmV0dXJuIFwiPHN0cm9uZz5cIiArIHNlbGVjdGVkU2l6ZSArIFwiPC9zdHJvbmc+IFwiICsgc2VsZWN0ZWRVbml0O1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuX3VwZGF0ZU1heEZpbGVzUmVhY2hlZENsYXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoKHRoaXMub3B0aW9ucy5tYXhGaWxlcyAhPSBudWxsKSAmJiB0aGlzLmdldEFjY2VwdGVkRmlsZXMoKS5sZW5ndGggPj0gdGhpcy5vcHRpb25zLm1heEZpbGVzKSB7XG4gICAgICAgIGlmICh0aGlzLmdldEFjY2VwdGVkRmlsZXMoKS5sZW5ndGggPT09IHRoaXMub3B0aW9ucy5tYXhGaWxlcykge1xuICAgICAgICAgIHRoaXMuZW1pdCgnbWF4ZmlsZXNyZWFjaGVkJywgdGhpcy5maWxlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHotbWF4LWZpbGVzLXJlYWNoZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJkei1tYXgtZmlsZXMtcmVhY2hlZFwiKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmRyb3AgPSBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgZmlsZXMsIGl0ZW1zO1xuICAgICAgaWYgKCFlLmRhdGFUcmFuc2Zlcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmVtaXQoXCJkcm9wXCIsIGUpO1xuICAgICAgZmlsZXMgPSBlLmRhdGFUcmFuc2Zlci5maWxlcztcbiAgICAgIGlmIChmaWxlcy5sZW5ndGgpIHtcbiAgICAgICAgaXRlbXMgPSBlLmRhdGFUcmFuc2Zlci5pdGVtcztcbiAgICAgICAgaWYgKGl0ZW1zICYmIGl0ZW1zLmxlbmd0aCAmJiAoaXRlbXNbMF0ud2Via2l0R2V0QXNFbnRyeSAhPSBudWxsKSkge1xuICAgICAgICAgIHRoaXMuX2FkZEZpbGVzRnJvbUl0ZW1zKGl0ZW1zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUZpbGVzKGZpbGVzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUucGFzdGUgPSBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgaXRlbXMsIF9yZWY7XG4gICAgICBpZiAoKGUgIT0gbnVsbCA/IChfcmVmID0gZS5jbGlwYm9hcmREYXRhKSAhPSBudWxsID8gX3JlZi5pdGVtcyA6IHZvaWQgMCA6IHZvaWQgMCkgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmVtaXQoXCJwYXN0ZVwiLCBlKTtcbiAgICAgIGl0ZW1zID0gZS5jbGlwYm9hcmREYXRhLml0ZW1zO1xuICAgICAgaWYgKGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYWRkRmlsZXNGcm9tSXRlbXMoaXRlbXMpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuaGFuZGxlRmlsZXMgPSBmdW5jdGlvbihmaWxlcykge1xuICAgICAgdmFyIGZpbGUsIF9pLCBfbGVuLCBfcmVzdWx0cztcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBmaWxlc1tfaV07XG4gICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5hZGRGaWxlKGZpbGUpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLl9hZGRGaWxlc0Zyb21JdGVtcyA9IGZ1bmN0aW9uKGl0ZW1zKSB7XG4gICAgICB2YXIgZW50cnksIGl0ZW0sIF9pLCBfbGVuLCBfcmVzdWx0cztcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGl0ZW1zLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGl0ZW0gPSBpdGVtc1tfaV07XG4gICAgICAgIGlmICgoaXRlbS53ZWJraXRHZXRBc0VudHJ5ICE9IG51bGwpICYmIChlbnRyeSA9IGl0ZW0ud2Via2l0R2V0QXNFbnRyeSgpKSkge1xuICAgICAgICAgIGlmIChlbnRyeS5pc0ZpbGUpIHtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5hZGRGaWxlKGl0ZW0uZ2V0QXNGaWxlKCkpKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KSB7XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMuX2FkZEZpbGVzRnJvbURpcmVjdG9yeShlbnRyeSwgZW50cnkubmFtZSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZ2V0QXNGaWxlICE9IG51bGwpIHtcbiAgICAgICAgICBpZiAoKGl0ZW0ua2luZCA9PSBudWxsKSB8fCBpdGVtLmtpbmQgPT09IFwiZmlsZVwiKSB7XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMuYWRkRmlsZShpdGVtLmdldEFzRmlsZSgpKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fYWRkRmlsZXNGcm9tRGlyZWN0b3J5ID0gZnVuY3Rpb24oZGlyZWN0b3J5LCBwYXRoKSB7XG4gICAgICB2YXIgZGlyUmVhZGVyLCBlbnRyaWVzUmVhZGVyO1xuICAgICAgZGlyUmVhZGVyID0gZGlyZWN0b3J5LmNyZWF0ZVJlYWRlcigpO1xuICAgICAgZW50cmllc1JlYWRlciA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZW50cmllcykge1xuICAgICAgICAgIHZhciBlbnRyeSwgX2ksIF9sZW47XG4gICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBlbnRyaWVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgICBlbnRyeSA9IGVudHJpZXNbX2ldO1xuICAgICAgICAgICAgaWYgKGVudHJ5LmlzRmlsZSkge1xuICAgICAgICAgICAgICBlbnRyeS5maWxlKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5pZ25vcmVIaWRkZW5GaWxlcyAmJiBmaWxlLm5hbWUuc3Vic3RyaW5nKDAsIDEpID09PSAnLicpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmlsZS5mdWxsUGF0aCA9IFwiXCIgKyBwYXRoICsgXCIvXCIgKyBmaWxlLm5hbWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmFkZEZpbGUoZmlsZSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS5pc0RpcmVjdG9yeSkge1xuICAgICAgICAgICAgICBfdGhpcy5fYWRkRmlsZXNGcm9tRGlyZWN0b3J5KGVudHJ5LCBcIlwiICsgcGF0aCArIFwiL1wiICsgZW50cnkubmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICByZXR1cm4gZGlyUmVhZGVyLnJlYWRFbnRyaWVzKGVudHJpZXNSZWFkZXIsIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgY29uc29sZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb25zb2xlICE9PSBudWxsID8gdHlwZW9mIGNvbnNvbGUubG9nID09PSBcImZ1bmN0aW9uXCIgPyBjb25zb2xlLmxvZyhlcnJvcikgOiB2b2lkIDAgOiB2b2lkIDA7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uKGZpbGUsIGRvbmUpIHtcbiAgICAgIGlmIChmaWxlLnNpemUgPiB0aGlzLm9wdGlvbnMubWF4RmlsZXNpemUgKiAxMDI0ICogMTAyNCkge1xuICAgICAgICByZXR1cm4gZG9uZSh0aGlzLm9wdGlvbnMuZGljdEZpbGVUb29CaWcucmVwbGFjZShcInt7ZmlsZXNpemV9fVwiLCBNYXRoLnJvdW5kKGZpbGUuc2l6ZSAvIDEwMjQgLyAxMC4yNCkgLyAxMDApLnJlcGxhY2UoXCJ7e21heEZpbGVzaXplfX1cIiwgdGhpcy5vcHRpb25zLm1heEZpbGVzaXplKSk7XG4gICAgICB9IGVsc2UgaWYgKCFEcm9wem9uZS5pc1ZhbGlkRmlsZShmaWxlLCB0aGlzLm9wdGlvbnMuYWNjZXB0ZWRGaWxlcykpIHtcbiAgICAgICAgcmV0dXJuIGRvbmUodGhpcy5vcHRpb25zLmRpY3RJbnZhbGlkRmlsZVR5cGUpO1xuICAgICAgfSBlbHNlIGlmICgodGhpcy5vcHRpb25zLm1heEZpbGVzICE9IG51bGwpICYmIHRoaXMuZ2V0QWNjZXB0ZWRGaWxlcygpLmxlbmd0aCA+PSB0aGlzLm9wdGlvbnMubWF4RmlsZXMpIHtcbiAgICAgICAgZG9uZSh0aGlzLm9wdGlvbnMuZGljdE1heEZpbGVzRXhjZWVkZWQucmVwbGFjZShcInt7bWF4RmlsZXN9fVwiLCB0aGlzLm9wdGlvbnMubWF4RmlsZXMpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChcIm1heGZpbGVzZXhjZWVkZWRcIiwgZmlsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmFjY2VwdC5jYWxsKHRoaXMsIGZpbGUsIGRvbmUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuYWRkRmlsZSA9IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgIGZpbGUudXBsb2FkID0ge1xuICAgICAgICBwcm9ncmVzczogMCxcbiAgICAgICAgdG90YWw6IGZpbGUuc2l6ZSxcbiAgICAgICAgYnl0ZXNTZW50OiAwXG4gICAgICB9O1xuICAgICAgdGhpcy5maWxlcy5wdXNoKGZpbGUpO1xuICAgICAgZmlsZS5zdGF0dXMgPSBEcm9wem9uZS5BRERFRDtcbiAgICAgIHRoaXMuZW1pdChcImFkZGVkZmlsZVwiLCBmaWxlKTtcbiAgICAgIHRoaXMuX2VucXVldWVUaHVtYm5haWwoZmlsZSk7XG4gICAgICByZXR1cm4gdGhpcy5hY2NlcHQoZmlsZSwgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgZmlsZS5hY2NlcHRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuX2Vycm9yUHJvY2Vzc2luZyhbZmlsZV0sIGVycm9yKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmlsZS5hY2NlcHRlZCA9IHRydWU7XG4gICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5hdXRvUXVldWUpIHtcbiAgICAgICAgICAgICAgX3RoaXMuZW5xdWV1ZUZpbGUoZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfdGhpcy5fdXBkYXRlTWF4RmlsZXNSZWFjaGVkQ2xhc3MoKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmVucXVldWVGaWxlcyA9IGZ1bmN0aW9uKGZpbGVzKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW47XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBmaWxlc1tfaV07XG4gICAgICAgIHRoaXMuZW5xdWV1ZUZpbGUoZmlsZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLmVucXVldWVGaWxlID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSBEcm9wem9uZS5BRERFRCAmJiBmaWxlLmFjY2VwdGVkID09PSB0cnVlKSB7XG4gICAgICAgIGZpbGUuc3RhdHVzID0gRHJvcHpvbmUuUVVFVUVEO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9Qcm9jZXNzUXVldWUpIHtcbiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dCgoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHJldHVybiBfdGhpcy5wcm9jZXNzUXVldWUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSkodGhpcykpLCAwKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhpcyBmaWxlIGNhbid0IGJlIHF1ZXVlZCBiZWNhdXNlIGl0IGhhcyBhbHJlYWR5IGJlZW4gcHJvY2Vzc2VkIG9yIHdhcyByZWplY3RlZC5cIik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fdGh1bWJuYWlsUXVldWUgPSBbXTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fcHJvY2Vzc2luZ1RodW1ibmFpbCA9IGZhbHNlO1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLl9lbnF1ZXVlVGh1bWJuYWlsID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5jcmVhdGVJbWFnZVRodW1ibmFpbHMgJiYgZmlsZS50eXBlLm1hdGNoKC9pbWFnZS4qLykgJiYgZmlsZS5zaXplIDw9IHRoaXMub3B0aW9ucy5tYXhUaHVtYm5haWxGaWxlc2l6ZSAqIDEwMjQgKiAxMDI0KSB7XG4gICAgICAgIHRoaXMuX3RodW1ibmFpbFF1ZXVlLnB1c2goZmlsZSk7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuX3Byb2Nlc3NUaHVtYm5haWxRdWV1ZSgpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpKSwgMCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fcHJvY2Vzc1RodW1ibmFpbFF1ZXVlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5fcHJvY2Vzc2luZ1RodW1ibmFpbCB8fCB0aGlzLl90aHVtYm5haWxRdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5fcHJvY2Vzc2luZ1RodW1ibmFpbCA9IHRydWU7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVUaHVtYm5haWwodGhpcy5fdGh1bWJuYWlsUXVldWUuc2hpZnQoKSwgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBfdGhpcy5fcHJvY2Vzc2luZ1RodW1ibmFpbCA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBfdGhpcy5fcHJvY2Vzc1RodW1ibmFpbFF1ZXVlKCk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5yZW1vdmVGaWxlID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSBEcm9wem9uZS5VUExPQURJTkcpIHtcbiAgICAgICAgdGhpcy5jYW5jZWxVcGxvYWQoZmlsZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmZpbGVzID0gd2l0aG91dCh0aGlzLmZpbGVzLCBmaWxlKTtcbiAgICAgIHRoaXMuZW1pdChcInJlbW92ZWRmaWxlXCIsIGZpbGUpO1xuICAgICAgaWYgKHRoaXMuZmlsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVtaXQoXCJyZXNldFwiKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLnJlbW92ZUFsbEZpbGVzID0gZnVuY3Rpb24oY2FuY2VsSWZOZWNlc3NhcnkpIHtcbiAgICAgIHZhciBmaWxlLCBfaSwgX2xlbiwgX3JlZjtcbiAgICAgIGlmIChjYW5jZWxJZk5lY2Vzc2FyeSA9PSBudWxsKSB7XG4gICAgICAgIGNhbmNlbElmTmVjZXNzYXJ5ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBfcmVmID0gdGhpcy5maWxlcy5zbGljZSgpO1xuICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBfcmVmW19pXTtcbiAgICAgICAgaWYgKGZpbGUuc3RhdHVzICE9PSBEcm9wem9uZS5VUExPQURJTkcgfHwgY2FuY2VsSWZOZWNlc3NhcnkpIHtcbiAgICAgICAgICB0aGlzLnJlbW92ZUZpbGUoZmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUuY3JlYXRlVGh1bWJuYWlsID0gZnVuY3Rpb24oZmlsZSwgY2FsbGJhY2spIHtcbiAgICAgIHZhciBmaWxlUmVhZGVyO1xuICAgICAgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyO1xuICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmIChmaWxlLnR5cGUgPT09IFwiaW1hZ2Uvc3ZnK3htbFwiKSB7XG4gICAgICAgICAgICBfdGhpcy5lbWl0KFwidGh1bWJuYWlsXCIsIGZpbGUsIGZpbGVSZWFkZXIucmVzdWx0KTtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsKSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfdGhpcy5jcmVhdGVUaHVtYm5haWxGcm9tVXJsKGZpbGUsIGZpbGVSZWFkZXIucmVzdWx0LCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKTtcbiAgICAgIHJldHVybiBmaWxlUmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5jcmVhdGVUaHVtYm5haWxGcm9tVXJsID0gZnVuY3Rpb24oZmlsZSwgaW1hZ2VVcmwsIGNhbGxiYWNrKSB7XG4gICAgICB2YXIgaW1nO1xuICAgICAgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgIGltZy5vbmxvYWQgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBjYW52YXMsIGN0eCwgcmVzaXplSW5mbywgdGh1bWJuYWlsLCBfcmVmLCBfcmVmMSwgX3JlZjIsIF9yZWYzO1xuICAgICAgICAgIGZpbGUud2lkdGggPSBpbWcud2lkdGg7XG4gICAgICAgICAgZmlsZS5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgICAgICAgIHJlc2l6ZUluZm8gPSBfdGhpcy5vcHRpb25zLnJlc2l6ZS5jYWxsKF90aGlzLCBmaWxlKTtcbiAgICAgICAgICBpZiAocmVzaXplSW5mby50cmdXaWR0aCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXNpemVJbmZvLnRyZ1dpZHRoID0gcmVzaXplSW5mby5vcHRXaWR0aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHJlc2l6ZUluZm8udHJnSGVpZ2h0ID09IG51bGwpIHtcbiAgICAgICAgICAgIHJlc2l6ZUluZm8udHJnSGVpZ2h0ID0gcmVzaXplSW5mby5vcHRIZWlnaHQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICBjYW52YXMud2lkdGggPSByZXNpemVJbmZvLnRyZ1dpZHRoO1xuICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSByZXNpemVJbmZvLnRyZ0hlaWdodDtcbiAgICAgICAgICBkcmF3SW1hZ2VJT1NGaXgoY3R4LCBpbWcsIChfcmVmID0gcmVzaXplSW5mby5zcmNYKSAhPSBudWxsID8gX3JlZiA6IDAsIChfcmVmMSA9IHJlc2l6ZUluZm8uc3JjWSkgIT0gbnVsbCA/IF9yZWYxIDogMCwgcmVzaXplSW5mby5zcmNXaWR0aCwgcmVzaXplSW5mby5zcmNIZWlnaHQsIChfcmVmMiA9IHJlc2l6ZUluZm8udHJnWCkgIT0gbnVsbCA/IF9yZWYyIDogMCwgKF9yZWYzID0gcmVzaXplSW5mby50cmdZKSAhPSBudWxsID8gX3JlZjMgOiAwLCByZXNpemVJbmZvLnRyZ1dpZHRoLCByZXNpemVJbmZvLnRyZ0hlaWdodCk7XG4gICAgICAgICAgdGh1bWJuYWlsID0gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcbiAgICAgICAgICBfdGhpcy5lbWl0KFwidGh1bWJuYWlsXCIsIGZpbGUsIHRodW1ibmFpbCk7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpO1xuICAgICAgaWYgKGNhbGxiYWNrICE9IG51bGwpIHtcbiAgICAgICAgaW1nLm9uZXJyb3IgPSBjYWxsYmFjaztcbiAgICAgIH1cbiAgICAgIHJldHVybiBpbWcuc3JjID0gaW1hZ2VVcmw7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5wcm9jZXNzUXVldWUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpLCBwYXJhbGxlbFVwbG9hZHMsIHByb2Nlc3NpbmdMZW5ndGgsIHF1ZXVlZEZpbGVzO1xuICAgICAgcGFyYWxsZWxVcGxvYWRzID0gdGhpcy5vcHRpb25zLnBhcmFsbGVsVXBsb2FkcztcbiAgICAgIHByb2Nlc3NpbmdMZW5ndGggPSB0aGlzLmdldFVwbG9hZGluZ0ZpbGVzKCkubGVuZ3RoO1xuICAgICAgaSA9IHByb2Nlc3NpbmdMZW5ndGg7XG4gICAgICBpZiAocHJvY2Vzc2luZ0xlbmd0aCA+PSBwYXJhbGxlbFVwbG9hZHMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcXVldWVkRmlsZXMgPSB0aGlzLmdldFF1ZXVlZEZpbGVzKCk7XG4gICAgICBpZiAoIShxdWV1ZWRGaWxlcy5sZW5ndGggPiAwKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnVwbG9hZE11bHRpcGxlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NGaWxlcyhxdWV1ZWRGaWxlcy5zbGljZSgwLCBwYXJhbGxlbFVwbG9hZHMgLSBwcm9jZXNzaW5nTGVuZ3RoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aGlsZSAoaSA8IHBhcmFsbGVsVXBsb2Fkcykge1xuICAgICAgICAgIGlmICghcXVldWVkRmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMucHJvY2Vzc0ZpbGUocXVldWVkRmlsZXMuc2hpZnQoKSk7XG4gICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5wcm9jZXNzRmlsZSA9IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NGaWxlcyhbZmlsZV0pO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUucHJvY2Vzc0ZpbGVzID0gZnVuY3Rpb24oZmlsZXMpIHtcbiAgICAgIHZhciBmaWxlLCBfaSwgX2xlbjtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZmlsZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgZmlsZSA9IGZpbGVzW19pXTtcbiAgICAgICAgZmlsZS5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgICAgZmlsZS5zdGF0dXMgPSBEcm9wem9uZS5VUExPQURJTkc7XG4gICAgICAgIHRoaXMuZW1pdChcInByb2Nlc3NpbmdcIiwgZmlsZSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnVwbG9hZE11bHRpcGxlKSB7XG4gICAgICAgIHRoaXMuZW1pdChcInByb2Nlc3NpbmdtdWx0aXBsZVwiLCBmaWxlcyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy51cGxvYWRGaWxlcyhmaWxlcyk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fZ2V0RmlsZXNXaXRoWGhyID0gZnVuY3Rpb24oeGhyKSB7XG4gICAgICB2YXIgZmlsZSwgZmlsZXM7XG4gICAgICByZXR1cm4gZmlsZXMgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICAgIF9yZWYgPSB0aGlzLmZpbGVzO1xuICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICBmaWxlID0gX3JlZltfaV07XG4gICAgICAgICAgaWYgKGZpbGUueGhyID09PSB4aHIpIHtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goZmlsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgIH0pLmNhbGwodGhpcyk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5jYW5jZWxVcGxvYWQgPSBmdW5jdGlvbihmaWxlKSB7XG4gICAgICB2YXIgZ3JvdXBlZEZpbGUsIGdyb3VwZWRGaWxlcywgX2ksIF9qLCBfbGVuLCBfbGVuMSwgX3JlZjtcbiAgICAgIGlmIChmaWxlLnN0YXR1cyA9PT0gRHJvcHpvbmUuVVBMT0FESU5HKSB7XG4gICAgICAgIGdyb3VwZWRGaWxlcyA9IHRoaXMuX2dldEZpbGVzV2l0aFhocihmaWxlLnhocik7XG4gICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gZ3JvdXBlZEZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgZ3JvdXBlZEZpbGUgPSBncm91cGVkRmlsZXNbX2ldO1xuICAgICAgICAgIGdyb3VwZWRGaWxlLnN0YXR1cyA9IERyb3B6b25lLkNBTkNFTEVEO1xuICAgICAgICB9XG4gICAgICAgIGZpbGUueGhyLmFib3J0KCk7XG4gICAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IGdyb3VwZWRGaWxlcy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHtcbiAgICAgICAgICBncm91cGVkRmlsZSA9IGdyb3VwZWRGaWxlc1tfal07XG4gICAgICAgICAgdGhpcy5lbWl0KFwiY2FuY2VsZWRcIiwgZ3JvdXBlZEZpbGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudXBsb2FkTXVsdGlwbGUpIHtcbiAgICAgICAgICB0aGlzLmVtaXQoXCJjYW5jZWxlZG11bHRpcGxlXCIsIGdyb3VwZWRGaWxlcyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoKF9yZWYgPSBmaWxlLnN0YXR1cykgPT09IERyb3B6b25lLkFEREVEIHx8IF9yZWYgPT09IERyb3B6b25lLlFVRVVFRCkge1xuICAgICAgICBmaWxlLnN0YXR1cyA9IERyb3B6b25lLkNBTkNFTEVEO1xuICAgICAgICB0aGlzLmVtaXQoXCJjYW5jZWxlZFwiLCBmaWxlKTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy51cGxvYWRNdWx0aXBsZSkge1xuICAgICAgICAgIHRoaXMuZW1pdChcImNhbmNlbGVkbXVsdGlwbGVcIiwgW2ZpbGVdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvUHJvY2Vzc1F1ZXVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NRdWV1ZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXNvbHZlT3B0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYXJncywgb3B0aW9uO1xuICAgICAgb3B0aW9uID0gYXJndW1lbnRzWzBdLCBhcmdzID0gMiA8PSBhcmd1bWVudHMubGVuZ3RoID8gX19zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkgOiBbXTtcbiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBvcHRpb24uYXBwbHkodGhpcywgYXJncyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3B0aW9uO1xuICAgIH07XG5cbiAgICBEcm9wem9uZS5wcm90b3R5cGUudXBsb2FkRmlsZSA9IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgIHJldHVybiB0aGlzLnVwbG9hZEZpbGVzKFtmaWxlXSk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS51cGxvYWRGaWxlcyA9IGZ1bmN0aW9uKGZpbGVzKSB7XG4gICAgICB2YXIgZmlsZSwgZm9ybURhdGEsIGhhbmRsZUVycm9yLCBoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZSwgaGVhZGVycywgaSwgaW5wdXQsIGlucHV0TmFtZSwgaW5wdXRUeXBlLCBrZXksIG1ldGhvZCwgb3B0aW9uLCBwcm9ncmVzc09iaiwgcmVzcG9uc2UsIHVwZGF0ZVByb2dyZXNzLCB1cmwsIHZhbHVlLCB4aHIsIF9pLCBfaiwgX2ssIF9sLCBfbGVuLCBfbGVuMSwgX2xlbjIsIF9sZW4zLCBfbSwgX3JlZiwgX3JlZjEsIF9yZWYyLCBfcmVmMywgX3JlZjQsIF9yZWY1O1xuICAgICAgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBmaWxlc1tfaV07XG4gICAgICAgIGZpbGUueGhyID0geGhyO1xuICAgICAgfVxuICAgICAgbWV0aG9kID0gcmVzb2x2ZU9wdGlvbih0aGlzLm9wdGlvbnMubWV0aG9kLCBmaWxlcyk7XG4gICAgICB1cmwgPSByZXNvbHZlT3B0aW9uKHRoaXMub3B0aW9ucy51cmwsIGZpbGVzKTtcbiAgICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTtcbiAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSAhIXRoaXMub3B0aW9ucy53aXRoQ3JlZGVudGlhbHM7XG4gICAgICByZXNwb25zZSA9IG51bGw7XG4gICAgICBoYW5kbGVFcnJvciA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIF9qLCBfbGVuMSwgX3Jlc3VsdHM7XG4gICAgICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBmaWxlcy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHtcbiAgICAgICAgICAgIGZpbGUgPSBmaWxlc1tfal07XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKF90aGlzLl9lcnJvclByb2Nlc3NpbmcoZmlsZXMsIHJlc3BvbnNlIHx8IF90aGlzLm9wdGlvbnMuZGljdFJlc3BvbnNlRXJyb3IucmVwbGFjZShcInt7c3RhdHVzQ29kZX19XCIsIHhoci5zdGF0dXMpLCB4aHIpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICB1cGRhdGVQcm9ncmVzcyA9IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgIHZhciBhbGxGaWxlc0ZpbmlzaGVkLCBwcm9ncmVzcywgX2osIF9rLCBfbCwgX2xlbjEsIF9sZW4yLCBfbGVuMywgX3Jlc3VsdHM7XG4gICAgICAgICAgaWYgKGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgcHJvZ3Jlc3MgPSAxMDAgKiBlLmxvYWRlZCAvIGUudG90YWw7XG4gICAgICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBmaWxlcy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHtcbiAgICAgICAgICAgICAgZmlsZSA9IGZpbGVzW19qXTtcbiAgICAgICAgICAgICAgZmlsZS51cGxvYWQgPSB7XG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IHByb2dyZXNzLFxuICAgICAgICAgICAgICAgIHRvdGFsOiBlLnRvdGFsLFxuICAgICAgICAgICAgICAgIGJ5dGVzU2VudDogZS5sb2FkZWRcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYWxsRmlsZXNGaW5pc2hlZCA9IHRydWU7XG4gICAgICAgICAgICBwcm9ncmVzcyA9IDEwMDtcbiAgICAgICAgICAgIGZvciAoX2sgPSAwLCBfbGVuMiA9IGZpbGVzLmxlbmd0aDsgX2sgPCBfbGVuMjsgX2srKykge1xuICAgICAgICAgICAgICBmaWxlID0gZmlsZXNbX2tdO1xuICAgICAgICAgICAgICBpZiAoIShmaWxlLnVwbG9hZC5wcm9ncmVzcyA9PT0gMTAwICYmIGZpbGUudXBsb2FkLmJ5dGVzU2VudCA9PT0gZmlsZS51cGxvYWQudG90YWwpKSB7XG4gICAgICAgICAgICAgICAgYWxsRmlsZXNGaW5pc2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGZpbGUudXBsb2FkLnByb2dyZXNzID0gcHJvZ3Jlc3M7XG4gICAgICAgICAgICAgIGZpbGUudXBsb2FkLmJ5dGVzU2VudCA9IGZpbGUudXBsb2FkLnRvdGFsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFsbEZpbGVzRmluaXNoZWQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICAgIGZvciAoX2wgPSAwLCBfbGVuMyA9IGZpbGVzLmxlbmd0aDsgX2wgPCBfbGVuMzsgX2wrKykge1xuICAgICAgICAgICAgZmlsZSA9IGZpbGVzW19sXTtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goX3RoaXMuZW1pdChcInVwbG9hZHByb2dyZXNzXCIsIGZpbGUsIHByb2dyZXNzLCBmaWxlLnVwbG9hZC5ieXRlc1NlbnQpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICB4aHIub25sb2FkID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgdmFyIF9yZWY7XG4gICAgICAgICAgaWYgKGZpbGVzWzBdLnN0YXR1cyA9PT0gRHJvcHpvbmUuQ0FOQ0VMRUQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlICE9PSA0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3BvbnNlID0geGhyLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICBpZiAoeGhyLmdldFJlc3BvbnNlSGVhZGVyKFwiY29udGVudC10eXBlXCIpICYmIH54aHIuZ2V0UmVzcG9uc2VIZWFkZXIoXCJjb250ZW50LXR5cGVcIikuaW5kZXhPZihcImFwcGxpY2F0aW9uL2pzb25cIikpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHtcbiAgICAgICAgICAgICAgZSA9IF9lcnJvcjtcbiAgICAgICAgICAgICAgcmVzcG9uc2UgPSBcIkludmFsaWQgSlNPTiByZXNwb25zZSBmcm9tIHNlcnZlci5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdXBkYXRlUHJvZ3Jlc3MoKTtcbiAgICAgICAgICBpZiAoISgoMjAwIDw9IChfcmVmID0geGhyLnN0YXR1cykgJiYgX3JlZiA8IDMwMCkpKSB7XG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlRXJyb3IoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9maW5pc2hlZChmaWxlcywgcmVzcG9uc2UsIGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpO1xuICAgICAgeGhyLm9uZXJyb3IgPSAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmIChmaWxlc1swXS5zdGF0dXMgPT09IERyb3B6b25lLkNBTkNFTEVEKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcigpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyk7XG4gICAgICBwcm9ncmVzc09iaiA9IChfcmVmID0geGhyLnVwbG9hZCkgIT0gbnVsbCA/IF9yZWYgOiB4aHI7XG4gICAgICBwcm9ncmVzc09iai5vbnByb2dyZXNzID0gdXBkYXRlUHJvZ3Jlc3M7XG4gICAgICBoZWFkZXJzID0ge1xuICAgICAgICBcIkFjY2VwdFwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgXCJDYWNoZS1Db250cm9sXCI6IFwibm8tY2FjaGVcIixcbiAgICAgICAgXCJYLVJlcXVlc3RlZC1XaXRoXCI6IFwiWE1MSHR0cFJlcXVlc3RcIlxuICAgICAgfTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGVhZGVycykge1xuICAgICAgICBleHRlbmQoaGVhZGVycywgdGhpcy5vcHRpb25zLmhlYWRlcnMpO1xuICAgICAgfVxuICAgICAgZm9yIChoZWFkZXJOYW1lIGluIGhlYWRlcnMpIHtcbiAgICAgICAgaGVhZGVyVmFsdWUgPSBoZWFkZXJzW2hlYWRlck5hbWVdO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZSk7XG4gICAgICB9XG4gICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5wYXJhbXMpIHtcbiAgICAgICAgX3JlZjEgPSB0aGlzLm9wdGlvbnMucGFyYW1zO1xuICAgICAgICBmb3IgKGtleSBpbiBfcmVmMSkge1xuICAgICAgICAgIHZhbHVlID0gX3JlZjFba2V5XTtcbiAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IGZpbGVzLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykge1xuICAgICAgICBmaWxlID0gZmlsZXNbX2pdO1xuICAgICAgICB0aGlzLmVtaXQoXCJzZW5kaW5nXCIsIGZpbGUsIHhociwgZm9ybURhdGEpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy51cGxvYWRNdWx0aXBsZSkge1xuICAgICAgICB0aGlzLmVtaXQoXCJzZW5kaW5nbXVsdGlwbGVcIiwgZmlsZXMsIHhociwgZm9ybURhdGEpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZWxlbWVudC50YWdOYW1lID09PSBcIkZPUk1cIikge1xuICAgICAgICBfcmVmMiA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QsIGJ1dHRvblwiKTtcbiAgICAgICAgZm9yIChfayA9IDAsIF9sZW4yID0gX3JlZjIubGVuZ3RoOyBfayA8IF9sZW4yOyBfaysrKSB7XG4gICAgICAgICAgaW5wdXQgPSBfcmVmMltfa107XG4gICAgICAgICAgaW5wdXROYW1lID0gaW5wdXQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTtcbiAgICAgICAgICBpbnB1dFR5cGUgPSBpbnB1dC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpO1xuICAgICAgICAgIGlmIChpbnB1dC50YWdOYW1lID09PSBcIlNFTEVDVFwiICYmIGlucHV0Lmhhc0F0dHJpYnV0ZShcIm11bHRpcGxlXCIpKSB7XG4gICAgICAgICAgICBfcmVmMyA9IGlucHV0Lm9wdGlvbnM7XG4gICAgICAgICAgICBmb3IgKF9sID0gMCwgX2xlbjMgPSBfcmVmMy5sZW5ndGg7IF9sIDwgX2xlbjM7IF9sKyspIHtcbiAgICAgICAgICAgICAgb3B0aW9uID0gX3JlZjNbX2xdO1xuICAgICAgICAgICAgICBpZiAob3B0aW9uLnNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGlucHV0TmFtZSwgb3B0aW9uLnZhbHVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAoIWlucHV0VHlwZSB8fCAoKF9yZWY0ID0gaW5wdXRUeXBlLnRvTG93ZXJDYXNlKCkpICE9PSBcImNoZWNrYm94XCIgJiYgX3JlZjQgIT09IFwicmFkaW9cIikgfHwgaW5wdXQuY2hlY2tlZCkge1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGlucHV0TmFtZSwgaW5wdXQudmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChpID0gX20gPSAwLCBfcmVmNSA9IGZpbGVzLmxlbmd0aCAtIDE7IDAgPD0gX3JlZjUgPyBfbSA8PSBfcmVmNSA6IF9tID49IF9yZWY1OyBpID0gMCA8PSBfcmVmNSA/ICsrX20gOiAtLV9tKSB7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCh0aGlzLl9nZXRQYXJhbU5hbWUoaSksIGZpbGVzW2ldLCBmaWxlc1tpXS5uYW1lKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB4aHIuc2VuZChmb3JtRGF0YSk7XG4gICAgfTtcblxuICAgIERyb3B6b25lLnByb3RvdHlwZS5fZmluaXNoZWQgPSBmdW5jdGlvbihmaWxlcywgcmVzcG9uc2VUZXh0LCBlKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW47XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBmaWxlc1tfaV07XG4gICAgICAgIGZpbGUuc3RhdHVzID0gRHJvcHpvbmUuU1VDQ0VTUztcbiAgICAgICAgdGhpcy5lbWl0KFwic3VjY2Vzc1wiLCBmaWxlLCByZXNwb25zZVRleHQsIGUpO1xuICAgICAgICB0aGlzLmVtaXQoXCJjb21wbGV0ZVwiLCBmaWxlKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMudXBsb2FkTXVsdGlwbGUpIHtcbiAgICAgICAgdGhpcy5lbWl0KFwic3VjY2Vzc211bHRpcGxlXCIsIGZpbGVzLCByZXNwb25zZVRleHQsIGUpO1xuICAgICAgICB0aGlzLmVtaXQoXCJjb21wbGV0ZW11bHRpcGxlXCIsIGZpbGVzKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b1Byb2Nlc3NRdWV1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzUXVldWUoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgRHJvcHpvbmUucHJvdG90eXBlLl9lcnJvclByb2Nlc3NpbmcgPSBmdW5jdGlvbihmaWxlcywgbWVzc2FnZSwgeGhyKSB7XG4gICAgICB2YXIgZmlsZSwgX2ksIF9sZW47XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZpbGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgIGZpbGUgPSBmaWxlc1tfaV07XG4gICAgICAgIGZpbGUuc3RhdHVzID0gRHJvcHpvbmUuRVJST1I7XG4gICAgICAgIHRoaXMuZW1pdChcImVycm9yXCIsIGZpbGUsIG1lc3NhZ2UsIHhocik7XG4gICAgICAgIHRoaXMuZW1pdChcImNvbXBsZXRlXCIsIGZpbGUpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy51cGxvYWRNdWx0aXBsZSkge1xuICAgICAgICB0aGlzLmVtaXQoXCJlcnJvcm11bHRpcGxlXCIsIGZpbGVzLCBtZXNzYWdlLCB4aHIpO1xuICAgICAgICB0aGlzLmVtaXQoXCJjb21wbGV0ZW11bHRpcGxlXCIsIGZpbGVzKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b1Byb2Nlc3NRdWV1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzUXVldWUoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIERyb3B6b25lO1xuXG4gIH0pKEVtaXR0ZXIpO1xuXG4gIERyb3B6b25lLnZlcnNpb24gPSBcIjQuMC4xXCI7XG5cbiAgRHJvcHpvbmUub3B0aW9ucyA9IHt9O1xuXG4gIERyb3B6b25lLm9wdGlvbnNGb3JFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGlmIChlbGVtZW50LmdldEF0dHJpYnV0ZShcImlkXCIpKSB7XG4gICAgICByZXR1cm4gRHJvcHpvbmUub3B0aW9uc1tjYW1lbGl6ZShlbGVtZW50LmdldEF0dHJpYnV0ZShcImlkXCIpKV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfVxuICB9O1xuXG4gIERyb3B6b25lLmluc3RhbmNlcyA9IFtdO1xuXG4gIERyb3B6b25lLmZvckVsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50KTtcbiAgICB9XG4gICAgaWYgKChlbGVtZW50ICE9IG51bGwgPyBlbGVtZW50LmRyb3B6b25lIDogdm9pZCAwKSA9PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBEcm9wem9uZSBmb3VuZCBmb3IgZ2l2ZW4gZWxlbWVudC4gVGhpcyBpcyBwcm9iYWJseSBiZWNhdXNlIHlvdSdyZSB0cnlpbmcgdG8gYWNjZXNzIGl0IGJlZm9yZSBEcm9wem9uZSBoYWQgdGhlIHRpbWUgdG8gaW5pdGlhbGl6ZS4gVXNlIHRoZSBgaW5pdGAgb3B0aW9uIHRvIHNldHVwIGFueSBhZGRpdGlvbmFsIG9ic2VydmVycyBvbiB5b3VyIERyb3B6b25lLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnQuZHJvcHpvbmU7XG4gIH07XG5cbiAgRHJvcHpvbmUuYXV0b0Rpc2NvdmVyID0gdHJ1ZTtcblxuICBEcm9wem9uZS5kaXNjb3ZlciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjaGVja0VsZW1lbnRzLCBkcm9wem9uZSwgZHJvcHpvbmVzLCBfaSwgX2xlbiwgX3Jlc3VsdHM7XG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwpIHtcbiAgICAgIGRyb3B6b25lcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZHJvcHpvbmVcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRyb3B6b25lcyA9IFtdO1xuICAgICAgY2hlY2tFbGVtZW50cyA9IGZ1bmN0aW9uKGVsZW1lbnRzKSB7XG4gICAgICAgIHZhciBlbCwgX2ksIF9sZW4sIF9yZXN1bHRzO1xuICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGVsZW1lbnRzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgZWwgPSBlbGVtZW50c1tfaV07XG4gICAgICAgICAgaWYgKC8oXnwgKWRyb3B6b25lKCR8ICkvLnRlc3QoZWwuY2xhc3NOYW1lKSkge1xuICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChkcm9wem9uZXMucHVzaChlbCkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgIH07XG4gICAgICBjaGVja0VsZW1lbnRzKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiZGl2XCIpKTtcbiAgICAgIGNoZWNrRWxlbWVudHMoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJmb3JtXCIpKTtcbiAgICB9XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGRyb3B6b25lcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgZHJvcHpvbmUgPSBkcm9wem9uZXNbX2ldO1xuICAgICAgaWYgKERyb3B6b25lLm9wdGlvbnNGb3JFbGVtZW50KGRyb3B6b25lKSAhPT0gZmFsc2UpIHtcbiAgICAgICAgX3Jlc3VsdHMucHVzaChuZXcgRHJvcHpvbmUoZHJvcHpvbmUpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9yZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIERyb3B6b25lLmJsYWNrbGlzdGVkQnJvd3NlcnMgPSBbL29wZXJhLipNYWNpbnRvc2guKnZlcnNpb25cXC8xMi9pXTtcblxuICBEcm9wem9uZS5pc0Jyb3dzZXJTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgY2FwYWJsZUJyb3dzZXIsIHJlZ2V4LCBfaSwgX2xlbiwgX3JlZjtcbiAgICBjYXBhYmxlQnJvd3NlciA9IHRydWU7XG4gICAgaWYgKHdpbmRvdy5GaWxlICYmIHdpbmRvdy5GaWxlUmVhZGVyICYmIHdpbmRvdy5GaWxlTGlzdCAmJiB3aW5kb3cuQmxvYiAmJiB3aW5kb3cuRm9ybURhdGEgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcikge1xuICAgICAgaWYgKCEoXCJjbGFzc0xpc3RcIiBpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKSkpIHtcbiAgICAgICAgY2FwYWJsZUJyb3dzZXIgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9yZWYgPSBEcm9wem9uZS5ibGFja2xpc3RlZEJyb3dzZXJzO1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICByZWdleCA9IF9yZWZbX2ldO1xuICAgICAgICAgIGlmIChyZWdleC50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgICAgICBjYXBhYmxlQnJvd3NlciA9IGZhbHNlO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhcGFibGVCcm93c2VyID0gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBjYXBhYmxlQnJvd3NlcjtcbiAgfTtcblxuICB3aXRob3V0ID0gZnVuY3Rpb24obGlzdCwgcmVqZWN0ZWRJdGVtKSB7XG4gICAgdmFyIGl0ZW0sIF9pLCBfbGVuLCBfcmVzdWx0cztcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoX2kgPSAwLCBfbGVuID0gbGlzdC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgaXRlbSA9IGxpc3RbX2ldO1xuICAgICAgaWYgKGl0ZW0gIT09IHJlamVjdGVkSXRlbSkge1xuICAgICAgICBfcmVzdWx0cy5wdXNoKGl0ZW0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX3Jlc3VsdHM7XG4gIH07XG5cbiAgY2FtZWxpemUgPSBmdW5jdGlvbihzdHIpIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcXC1fXShcXHcpL2csIGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgICByZXR1cm4gbWF0Y2guY2hhckF0KDEpLnRvVXBwZXJDYXNlKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgRHJvcHpvbmUuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uKHN0cmluZykge1xuICAgIHZhciBkaXY7XG4gICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBkaXYuaW5uZXJIVE1MID0gc3RyaW5nO1xuICAgIHJldHVybiBkaXYuY2hpbGROb2Rlc1swXTtcbiAgfTtcblxuICBEcm9wem9uZS5lbGVtZW50SW5zaWRlID0gZnVuY3Rpb24oZWxlbWVudCwgY29udGFpbmVyKSB7XG4gICAgaWYgKGVsZW1lbnQgPT09IGNvbnRhaW5lcikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHdoaWxlIChlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlKSB7XG4gICAgICBpZiAoZWxlbWVudCA9PT0gY29udGFpbmVyKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgRHJvcHpvbmUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uKGVsLCBuYW1lKSB7XG4gICAgdmFyIGVsZW1lbnQ7XG4gICAgaWYgKHR5cGVvZiBlbCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xuICAgIH0gZWxzZSBpZiAoZWwubm9kZVR5cGUgIT0gbnVsbCkge1xuICAgICAgZWxlbWVudCA9IGVsO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudCA9PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGBcIiArIG5hbWUgKyBcImAgb3B0aW9uIHByb3ZpZGVkLiBQbGVhc2UgcHJvdmlkZSBhIENTUyBzZWxlY3RvciBvciBhIHBsYWluIEhUTUwgZWxlbWVudC5cIik7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50O1xuICB9O1xuXG4gIERyb3B6b25lLmdldEVsZW1lbnRzID0gZnVuY3Rpb24oZWxzLCBuYW1lKSB7XG4gICAgdmFyIGUsIGVsLCBlbGVtZW50cywgX2ksIF9qLCBfbGVuLCBfbGVuMSwgX3JlZjtcbiAgICBpZiAoZWxzIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIGVsZW1lbnRzID0gW107XG4gICAgICB0cnkge1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGVscy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgIGVsID0gZWxzW19pXTtcbiAgICAgICAgICBlbGVtZW50cy5wdXNoKHRoaXMuZ2V0RWxlbWVudChlbCwgbmFtZSkpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChfZXJyb3IpIHtcbiAgICAgICAgZSA9IF9lcnJvcjtcbiAgICAgICAgZWxlbWVudHMgPSBudWxsO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGVscyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgZWxlbWVudHMgPSBbXTtcbiAgICAgIF9yZWYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGVscyk7XG4gICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBfcmVmLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykge1xuICAgICAgICBlbCA9IF9yZWZbX2pdO1xuICAgICAgICBlbGVtZW50cy5wdXNoKGVsKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGVscy5ub2RlVHlwZSAhPSBudWxsKSB7XG4gICAgICBlbGVtZW50cyA9IFtlbHNdO1xuICAgIH1cbiAgICBpZiAoISgoZWxlbWVudHMgIT0gbnVsbCkgJiYgZWxlbWVudHMubGVuZ3RoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBgXCIgKyBuYW1lICsgXCJgIG9wdGlvbiBwcm92aWRlZC4gUGxlYXNlIHByb3ZpZGUgYSBDU1Mgc2VsZWN0b3IsIGEgcGxhaW4gSFRNTCBlbGVtZW50IG9yIGEgbGlzdCBvZiB0aG9zZS5cIik7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50cztcbiAgfTtcblxuICBEcm9wem9uZS5jb25maXJtID0gZnVuY3Rpb24ocXVlc3Rpb24sIGFjY2VwdGVkLCByZWplY3RlZCkge1xuICAgIGlmICh3aW5kb3cuY29uZmlybShxdWVzdGlvbikpIHtcbiAgICAgIHJldHVybiBhY2NlcHRlZCgpO1xuICAgIH0gZWxzZSBpZiAocmVqZWN0ZWQgIT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHJlamVjdGVkKCk7XG4gICAgfVxuICB9O1xuXG4gIERyb3B6b25lLmlzVmFsaWRGaWxlID0gZnVuY3Rpb24oZmlsZSwgYWNjZXB0ZWRGaWxlcykge1xuICAgIHZhciBiYXNlTWltZVR5cGUsIG1pbWVUeXBlLCB2YWxpZFR5cGUsIF9pLCBfbGVuO1xuICAgIGlmICghYWNjZXB0ZWRGaWxlcykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGFjY2VwdGVkRmlsZXMgPSBhY2NlcHRlZEZpbGVzLnNwbGl0KFwiLFwiKTtcbiAgICBtaW1lVHlwZSA9IGZpbGUudHlwZTtcbiAgICBiYXNlTWltZVR5cGUgPSBtaW1lVHlwZS5yZXBsYWNlKC9cXC8uKiQvLCBcIlwiKTtcbiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGFjY2VwdGVkRmlsZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgIHZhbGlkVHlwZSA9IGFjY2VwdGVkRmlsZXNbX2ldO1xuICAgICAgdmFsaWRUeXBlID0gdmFsaWRUeXBlLnRyaW0oKTtcbiAgICAgIGlmICh2YWxpZFR5cGUuY2hhckF0KDApID09PSBcIi5cIikge1xuICAgICAgICBpZiAoZmlsZS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWxpZFR5cGUudG9Mb3dlckNhc2UoKSwgZmlsZS5uYW1lLmxlbmd0aCAtIHZhbGlkVHlwZS5sZW5ndGgpICE9PSAtMSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKC9cXC9cXCokLy50ZXN0KHZhbGlkVHlwZSkpIHtcbiAgICAgICAgaWYgKGJhc2VNaW1lVHlwZSA9PT0gdmFsaWRUeXBlLnJlcGxhY2UoL1xcLy4qJC8sIFwiXCIpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChtaW1lVHlwZSA9PT0gdmFsaWRUeXBlKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGlmICh0eXBlb2YgalF1ZXJ5ICE9PSBcInVuZGVmaW5lZFwiICYmIGpRdWVyeSAhPT0gbnVsbCkge1xuICAgIGpRdWVyeS5mbi5kcm9wem9uZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBuZXcgRHJvcHpvbmUodGhpcywgb3B0aW9ucyk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9kdWxlICE9PSBudWxsKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBEcm9wem9uZTtcbiAgfSBlbHNlIHtcbiAgICB3aW5kb3cuRHJvcHpvbmUgPSBEcm9wem9uZTtcbiAgfVxuXG4gIERyb3B6b25lLkFEREVEID0gXCJhZGRlZFwiO1xuXG4gIERyb3B6b25lLlFVRVVFRCA9IFwicXVldWVkXCI7XG5cbiAgRHJvcHpvbmUuQUNDRVBURUQgPSBEcm9wem9uZS5RVUVVRUQ7XG5cbiAgRHJvcHpvbmUuVVBMT0FESU5HID0gXCJ1cGxvYWRpbmdcIjtcblxuICBEcm9wem9uZS5QUk9DRVNTSU5HID0gRHJvcHpvbmUuVVBMT0FESU5HO1xuXG4gIERyb3B6b25lLkNBTkNFTEVEID0gXCJjYW5jZWxlZFwiO1xuXG4gIERyb3B6b25lLkVSUk9SID0gXCJlcnJvclwiO1xuXG4gIERyb3B6b25lLlNVQ0NFU1MgPSBcInN1Y2Nlc3NcIjtcblxuXG4gIC8qXG4gIFxuICBCdWdmaXggZm9yIGlPUyA2IGFuZCA3XG4gIFNvdXJjZTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMTkyOTA5OS9odG1sNS1jYW52YXMtZHJhd2ltYWdlLXJhdGlvLWJ1Zy1pb3NcbiAgYmFzZWQgb24gdGhlIHdvcmsgb2YgaHR0cHM6Ly9naXRodWIuY29tL3N0b21pdGEvaW9zLWltYWdlZmlsZS1tZWdhcGl4ZWxcbiAgICovXG5cbiAgZGV0ZWN0VmVydGljYWxTcXVhc2ggPSBmdW5jdGlvbihpbWcpIHtcbiAgICB2YXIgYWxwaGEsIGNhbnZhcywgY3R4LCBkYXRhLCBleSwgaWgsIGl3LCBweSwgcmF0aW8sIHN5O1xuICAgIGl3ID0gaW1nLm5hdHVyYWxXaWR0aDtcbiAgICBpaCA9IGltZy5uYXR1cmFsSGVpZ2h0O1xuICAgIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgY2FudmFzLndpZHRoID0gMTtcbiAgICBjYW52YXMuaGVpZ2h0ID0gaWg7XG4gICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7XG4gICAgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgaWgpLmRhdGE7XG4gICAgc3kgPSAwO1xuICAgIGV5ID0gaWg7XG4gICAgcHkgPSBpaDtcbiAgICB3aGlsZSAocHkgPiBzeSkge1xuICAgICAgYWxwaGEgPSBkYXRhWyhweSAtIDEpICogNCArIDNdO1xuICAgICAgaWYgKGFscGhhID09PSAwKSB7XG4gICAgICAgIGV5ID0gcHk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzeSA9IHB5O1xuICAgICAgfVxuICAgICAgcHkgPSAoZXkgKyBzeSkgPj4gMTtcbiAgICB9XG4gICAgcmF0aW8gPSBweSAvIGloO1xuICAgIGlmIChyYXRpbyA9PT0gMCkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByYXRpbztcbiAgICB9XG4gIH07XG5cbiAgZHJhd0ltYWdlSU9TRml4ID0gZnVuY3Rpb24oY3R4LCBpbWcsIHN4LCBzeSwgc3csIHNoLCBkeCwgZHksIGR3LCBkaCkge1xuICAgIHZhciB2ZXJ0U3F1YXNoUmF0aW87XG4gICAgdmVydFNxdWFzaFJhdGlvID0gZGV0ZWN0VmVydGljYWxTcXVhc2goaW1nKTtcbiAgICByZXR1cm4gY3R4LmRyYXdJbWFnZShpbWcsIHN4LCBzeSwgc3csIHNoLCBkeCwgZHksIGR3LCBkaCAvIHZlcnRTcXVhc2hSYXRpbyk7XG4gIH07XG5cblxuICAvKlxuICAgKiBjb250ZW50bG9hZGVkLmpzXG4gICAqXG4gICAqIEF1dGhvcjogRGllZ28gUGVyaW5pIChkaWVnby5wZXJpbmkgYXQgZ21haWwuY29tKVxuICAgKiBTdW1tYXJ5OiBjcm9zcy1icm93c2VyIHdyYXBwZXIgZm9yIERPTUNvbnRlbnRMb2FkZWRcbiAgICogVXBkYXRlZDogMjAxMDEwMjBcbiAgICogTGljZW5zZTogTUlUXG4gICAqIFZlcnNpb246IDEuMlxuICAgKlxuICAgKiBVUkw6XG4gICAqIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9Db250ZW50TG9hZGVkL1xuICAgKiBodHRwOi8vamF2YXNjcmlwdC5ud2JveC5jb20vQ29udGVudExvYWRlZC9NSVQtTElDRU5TRVxuICAgKi9cblxuICBjb250ZW50TG9hZGVkID0gZnVuY3Rpb24od2luLCBmbikge1xuICAgIHZhciBhZGQsIGRvYywgZG9uZSwgaW5pdCwgcG9sbCwgcHJlLCByZW0sIHJvb3QsIHRvcDtcbiAgICBkb25lID0gZmFsc2U7XG4gICAgdG9wID0gdHJ1ZTtcbiAgICBkb2MgPSB3aW4uZG9jdW1lbnQ7XG4gICAgcm9vdCA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgYWRkID0gKGRvYy5hZGRFdmVudExpc3RlbmVyID8gXCJhZGRFdmVudExpc3RlbmVyXCIgOiBcImF0dGFjaEV2ZW50XCIpO1xuICAgIHJlbSA9IChkb2MuYWRkRXZlbnRMaXN0ZW5lciA/IFwicmVtb3ZlRXZlbnRMaXN0ZW5lclwiIDogXCJkZXRhY2hFdmVudFwiKTtcbiAgICBwcmUgPSAoZG9jLmFkZEV2ZW50TGlzdGVuZXIgPyBcIlwiIDogXCJvblwiKTtcbiAgICBpbml0ID0gZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKGUudHlwZSA9PT0gXCJyZWFkeXN0YXRlY2hhbmdlXCIgJiYgZG9jLnJlYWR5U3RhdGUgIT09IFwiY29tcGxldGVcIikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAoZS50eXBlID09PSBcImxvYWRcIiA/IHdpbiA6IGRvYylbcmVtXShwcmUgKyBlLnR5cGUsIGluaXQsIGZhbHNlKTtcbiAgICAgIGlmICghZG9uZSAmJiAoZG9uZSA9IHRydWUpKSB7XG4gICAgICAgIHJldHVybiBmbi5jYWxsKHdpbiwgZS50eXBlIHx8IGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgcG9sbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGU7XG4gICAgICB0cnkge1xuICAgICAgICByb290LmRvU2Nyb2xsKFwibGVmdFwiKTtcbiAgICAgIH0gY2F0Y2ggKF9lcnJvcikge1xuICAgICAgICBlID0gX2Vycm9yO1xuICAgICAgICBzZXRUaW1lb3V0KHBvbGwsIDUwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGluaXQoXCJwb2xsXCIpO1xuICAgIH07XG4gICAgaWYgKGRvYy5yZWFkeVN0YXRlICE9PSBcImNvbXBsZXRlXCIpIHtcbiAgICAgIGlmIChkb2MuY3JlYXRlRXZlbnRPYmplY3QgJiYgcm9vdC5kb1Njcm9sbCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHRvcCA9ICF3aW4uZnJhbWVFbGVtZW50O1xuICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHt9XG4gICAgICAgIGlmICh0b3ApIHtcbiAgICAgICAgICBwb2xsKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGRvY1thZGRdKHByZSArIFwiRE9NQ29udGVudExvYWRlZFwiLCBpbml0LCBmYWxzZSk7XG4gICAgICBkb2NbYWRkXShwcmUgKyBcInJlYWR5c3RhdGVjaGFuZ2VcIiwgaW5pdCwgZmFsc2UpO1xuICAgICAgcmV0dXJuIHdpblthZGRdKHByZSArIFwibG9hZFwiLCBpbml0LCBmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIERyb3B6b25lLl9hdXRvRGlzY292ZXJGdW5jdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChEcm9wem9uZS5hdXRvRGlzY292ZXIpIHtcbiAgICAgIHJldHVybiBEcm9wem9uZS5kaXNjb3ZlcigpO1xuICAgIH1cbiAgfTtcblxuICBjb250ZW50TG9hZGVkKHdpbmRvdywgRHJvcHpvbmUuX2F1dG9EaXNjb3ZlckZ1bmN0aW9uKTtcblxufSkuY2FsbCh0aGlzKTtcbiIsIi8qXG5hdHRyaWJ1dGVzXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciAkICAgICAgID0gcmVxdWlyZShcIi4vYmFzZVwiKVxuXG52YXIgdHJpbSAgICA9IHJlcXVpcmUoXCJtb3V0L3N0cmluZy90cmltXCIpLFxuICAgIGZvckVhY2ggPSByZXF1aXJlKFwibW91dC9hcnJheS9mb3JFYWNoXCIpLFxuICAgIGZpbHRlciAgPSByZXF1aXJlKFwibW91dC9hcnJheS9maWx0ZXJcIiksXG4gICAgaW5kZXhPZiA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2luZGV4T2ZcIilcblxuLy8gYXR0cmlidXRlc1xuXG4kLmltcGxlbWVudCh7XG5cbiAgICBzZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBnZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICB2YXIgYXR0ciA9IHRoaXNbMF0uZ2V0QXR0cmlidXRlTm9kZShuYW1lKVxuICAgICAgICByZXR1cm4gKGF0dHIgJiYgYXR0ci5zcGVjaWZpZWQpID8gYXR0ci52YWx1ZSA6IG51bGxcbiAgICB9LFxuXG4gICAgaGFzQXR0cmlidXRlOiBmdW5jdGlvbihuYW1lKXtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzWzBdXG4gICAgICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZSkgcmV0dXJuIG5vZGUuaGFzQXR0cmlidXRlKG5hbWUpXG4gICAgICAgIHZhciBhdHRyID0gbm9kZS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpXG4gICAgICAgIHJldHVybiAhIShhdHRyICYmIGF0dHIuc3BlY2lmaWVkKVxuICAgIH0sXG5cbiAgICByZW1vdmVBdHRyaWJ1dGU6IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgdmFyIGF0dHIgPSBub2RlLmdldEF0dHJpYnV0ZU5vZGUobmFtZSlcbiAgICAgICAgICAgIGlmIChhdHRyKSBub2RlLnJlbW92ZUF0dHJpYnV0ZU5vZGUoYXR0cilcbiAgICAgICAgfSlcbiAgICB9XG5cbn0pXG5cbnZhciBhY2Nlc3NvcnMgPSB7fVxuXG5mb3JFYWNoKFtcInR5cGVcIiwgXCJ2YWx1ZVwiLCBcIm5hbWVcIiwgXCJocmVmXCIsIFwidGl0bGVcIiwgXCJpZFwiXSwgZnVuY3Rpb24obmFtZSl7XG5cbiAgICBhY2Nlc3NvcnNbbmFtZV0gPSBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgIHJldHVybiAodmFsdWUgIT09IHVuZGVmaW5lZCkgPyB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICBub2RlW25hbWVdID0gdmFsdWVcbiAgICAgICAgfSkgOiB0aGlzWzBdW25hbWVdXG4gICAgfVxuXG59KVxuXG4vLyBib29sZWFuc1xuXG5mb3JFYWNoKFtcImNoZWNrZWRcIiwgXCJkaXNhYmxlZFwiLCBcInNlbGVjdGVkXCJdLCBmdW5jdGlvbihuYW1lKXtcblxuICAgIGFjY2Vzc29yc1tuYW1lXSA9IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSA/IHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIG5vZGVbbmFtZV0gPSAhIXZhbHVlXG4gICAgICAgIH0pIDogISF0aGlzWzBdW25hbWVdXG4gICAgfVxuXG59KVxuXG4vLyBjbGFzc05hbWVcblxudmFyIGNsYXNzZXMgPSBmdW5jdGlvbihjbGFzc05hbWUpe1xuICAgIHZhciBjbGFzc05hbWVzID0gdHJpbShjbGFzc05hbWUpLnJlcGxhY2UoL1xccysvZywgXCIgXCIpLnNwbGl0KFwiIFwiKSxcbiAgICAgICAgdW5pcXVlcyAgICA9IHt9XG5cbiAgICByZXR1cm4gZmlsdGVyKGNsYXNzTmFtZXMsIGZ1bmN0aW9uKGNsYXNzTmFtZSl7XG4gICAgICAgIGlmIChjbGFzc05hbWUgIT09IFwiXCIgJiYgIXVuaXF1ZXNbY2xhc3NOYW1lXSkgcmV0dXJuIHVuaXF1ZXNbY2xhc3NOYW1lXSA9IGNsYXNzTmFtZVxuICAgIH0pLnNvcnQoKVxufVxuXG5hY2Nlc3NvcnMuY2xhc3NOYW1lID0gZnVuY3Rpb24oY2xhc3NOYW1lKXtcbiAgICByZXR1cm4gKGNsYXNzTmFtZSAhPT0gdW5kZWZpbmVkKSA/IHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgbm9kZS5jbGFzc05hbWUgPSBjbGFzc2VzKGNsYXNzTmFtZSkuam9pbihcIiBcIilcbiAgICB9KSA6IGNsYXNzZXModGhpc1swXS5jbGFzc05hbWUpLmpvaW4oXCIgXCIpXG59XG5cbi8vIGF0dHJpYnV0ZVxuXG4kLmltcGxlbWVudCh7XG5cbiAgICBhdHRyaWJ1dGU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKXtcbiAgICAgICAgdmFyIGFjY2Vzc29yID0gYWNjZXNzb3JzW25hbWVdXG4gICAgICAgIGlmIChhY2Nlc3NvcikgcmV0dXJuIGFjY2Vzc29yLmNhbGwodGhpcywgdmFsdWUpXG4gICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSByZXR1cm4gdGhpcy5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgcmV0dXJuIHRoaXMucmVtb3ZlQXR0cmlidXRlKG5hbWUpXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdGhpcy5nZXRBdHRyaWJ1dGUobmFtZSlcbiAgICB9XG5cbn0pXG5cbiQuaW1wbGVtZW50KGFjY2Vzc29ycylcblxuLy8gc2hvcnRjdXRzXG5cbiQuaW1wbGVtZW50KHtcblxuICAgIGNoZWNrOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5jaGVja2VkKHRydWUpXG4gICAgfSxcblxuICAgIHVuY2hlY2s6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrZWQoZmFsc2UpXG4gICAgfSxcblxuICAgIGRpc2FibGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkKHRydWUpXG4gICAgfSxcblxuICAgIGVuYWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQoZmFsc2UpXG4gICAgfSxcblxuICAgIHNlbGVjdDogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWQodHJ1ZSlcbiAgICB9LFxuXG4gICAgZGVzZWxlY3Q6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkKGZhbHNlKVxuICAgIH1cblxufSlcblxuLy8gY2xhc3NOYW1lcywgaGFzIC8gYWRkIC8gcmVtb3ZlIENsYXNzXG5cbiQuaW1wbGVtZW50KHtcblxuICAgIGNsYXNzTmFtZXM6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBjbGFzc2VzKHRoaXNbMF0uY2xhc3NOYW1lKVxuICAgIH0sXG5cbiAgICBoYXNDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lKXtcbiAgICAgICAgcmV0dXJuIGluZGV4T2YodGhpcy5jbGFzc05hbWVzKCksIGNsYXNzTmFtZSkgPiAtMVxuICAgIH0sXG5cbiAgICBhZGRDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIHZhciBub2RlQ2xhc3NOYW1lID0gbm9kZS5jbGFzc05hbWVcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWVzID0gY2xhc3Nlcyhub2RlQ2xhc3NOYW1lICsgXCIgXCIgKyBjbGFzc05hbWUpLmpvaW4oXCIgXCIpXG4gICAgICAgICAgICBpZiAobm9kZUNsYXNzTmFtZSAhPT0gY2xhc3NOYW1lcykgbm9kZS5jbGFzc05hbWUgPSBjbGFzc05hbWVzXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIHJlbW92ZUNsYXNzOiBmdW5jdGlvbihjbGFzc05hbWUpe1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgdmFyIGNsYXNzTmFtZXMgPSBjbGFzc2VzKG5vZGUuY2xhc3NOYW1lKVxuICAgICAgICAgICAgZm9yRWFjaChjbGFzc2VzKGNsYXNzTmFtZSksIGZ1bmN0aW9uKGNsYXNzTmFtZSl7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaW5kZXhPZihjbGFzc05hbWVzLCBjbGFzc05hbWUpXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIGNsYXNzTmFtZXMuc3BsaWNlKGluZGV4LCAxKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIG5vZGUuY2xhc3NOYW1lID0gY2xhc3NOYW1lcy5qb2luKFwiIFwiKVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICB0b2dnbGVDbGFzczogZnVuY3Rpb24oY2xhc3NOYW1lLCBmb3JjZSl7XG4gICAgICAgIHZhciBhZGQgPSBmb3JjZSAhPT0gdW5kZWZpbmVkID8gZm9yY2UgOiAhdGhpcy5oYXNDbGFzcyhjbGFzc05hbWUpXG4gICAgICAgIGlmIChhZGQpXG4gICAgICAgICAgICB0aGlzLmFkZENsYXNzKGNsYXNzTmFtZSlcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5yZW1vdmVDbGFzcyhjbGFzc05hbWUpXG4gICAgICAgIHJldHVybiAhIWFkZFxuICAgIH1cblxufSlcblxuLy8gdG9TdHJpbmdcblxuJC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpe1xuICAgIHZhciB0YWcgICAgID0gdGhpcy50YWcoKSxcbiAgICAgICAgaWQgICAgICA9IHRoaXMuaWQoKSxcbiAgICAgICAgY2xhc3NlcyA9IHRoaXMuY2xhc3NOYW1lcygpXG5cbiAgICB2YXIgc3RyID0gdGFnXG4gICAgaWYgKGlkKSBzdHIgKz0gJyMnICsgaWRcbiAgICBpZiAoY2xhc3Nlcy5sZW5ndGgpIHN0ciArPSAnLicgKyBjbGFzc2VzLmpvaW4oXCIuXCIpXG4gICAgcmV0dXJuIHN0clxufVxuXG52YXIgdGV4dFByb3BlcnR5ID0gKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLnRleHRDb250ZW50ID09IG51bGwpID8gJ2lubmVyVGV4dCcgOiAndGV4dENvbnRlbnQnXG5cbi8vIHRhZywgaHRtbCwgdGV4dCwgZGF0YVxuXG4kLmltcGxlbWVudCh7XG5cbiAgICB0YWc6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzWzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKVxuICAgIH0sXG5cbiAgICBodG1sOiBmdW5jdGlvbihodG1sKXtcbiAgICAgICAgcmV0dXJuIChodG1sICE9PSB1bmRlZmluZWQpID8gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgbm9kZS5pbm5lckhUTUwgPSBodG1sXG4gICAgICAgIH0pIDogdGhpc1swXS5pbm5lckhUTUxcbiAgICB9LFxuXG4gICAgdGV4dDogZnVuY3Rpb24odGV4dCl7XG4gICAgICAgIHJldHVybiAodGV4dCAhPT0gdW5kZWZpbmVkKSA/IHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIG5vZGVbdGV4dFByb3BlcnR5XSA9IHRleHRcbiAgICAgICAgfSkgOiB0aGlzWzBdW3RleHRQcm9wZXJ0eV1cbiAgICB9LFxuXG4gICAgZGF0YTogZnVuY3Rpb24oa2V5LCB2YWx1ZSl7XG4gICAgICAgIHN3aXRjaCh2YWx1ZSkge1xuICAgICAgICAgICAgY2FzZSB1bmRlZmluZWQ6IHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZShcImRhdGEtXCIgKyBrZXkpXG4gICAgICAgICAgICBjYXNlIG51bGw6IHJldHVybiB0aGlzLnJlbW92ZUF0dHJpYnV0ZShcImRhdGEtXCIgKyBrZXkpXG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gdGhpcy5zZXRBdHRyaWJ1dGUoXCJkYXRhLVwiICsga2V5LCB2YWx1ZSlcbiAgICAgICAgfVxuICAgIH1cblxufSlcblxubW9kdWxlLmV4cG9ydHMgPSAkXG4iLCIvKlxuZWxlbWVudHNcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIHByaW1lICAgPSByZXF1aXJlKFwicHJpbWVcIilcblxudmFyIGZvckVhY2ggPSByZXF1aXJlKFwibW91dC9hcnJheS9mb3JFYWNoXCIpLFxuICAgIG1hcCAgICAgPSByZXF1aXJlKFwibW91dC9hcnJheS9tYXBcIiksXG4gICAgZmlsdGVyICA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2ZpbHRlclwiKSxcbiAgICBldmVyeSAgID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvZXZlcnlcIiksXG4gICAgc29tZSAgICA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L3NvbWVcIilcblxuLy8gdW5pcXVlSURcblxudmFyIGluZGV4ID0gMCxcbiAgICBfX2RjID0gZG9jdW1lbnQuX19jb3VudGVyLFxuICAgIGNvdW50ZXIgPSBkb2N1bWVudC5fX2NvdW50ZXIgPSAoX19kYyA/IHBhcnNlSW50KF9fZGMsIDM2KSArIDEgOiAwKS50b1N0cmluZygzNiksXG4gICAga2V5ID0gXCJ1aWQ6XCIgKyBjb3VudGVyXG5cbnZhciB1bmlxdWVJRCA9IGZ1bmN0aW9uKG4pe1xuICAgIGlmIChuID09PSB3aW5kb3cpIHJldHVybiBcIndpbmRvd1wiXG4gICAgaWYgKG4gPT09IGRvY3VtZW50KSByZXR1cm4gXCJkb2N1bWVudFwiXG4gICAgaWYgKG4gPT09IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgcmV0dXJuIFwiaHRtbFwiXG4gICAgcmV0dXJuIG5ba2V5XSB8fCAobltrZXldID0gKGluZGV4KyspLnRvU3RyaW5nKDM2KSlcbn1cblxudmFyIGluc3RhbmNlcyA9IHt9XG5cbi8vIGVsZW1lbnRzIHByaW1lXG5cbnZhciAkID0gcHJpbWUoe2NvbnN0cnVjdG9yOiBmdW5jdGlvbiAkKG4sIGNvbnRleHQpe1xuXG4gICAgaWYgKG4gPT0gbnVsbCkgcmV0dXJuICh0aGlzICYmIHRoaXMuY29uc3RydWN0b3IgPT09ICQpID8gbmV3IEVsZW1lbnRzIDogbnVsbFxuXG4gICAgdmFyIHNlbGYsIHVpZFxuXG4gICAgaWYgKG4uY29uc3RydWN0b3IgIT09IEVsZW1lbnRzKXtcblxuICAgICAgICBzZWxmID0gbmV3IEVsZW1lbnRzXG5cbiAgICAgICAgaWYgKHR5cGVvZiBuID09PSBcInN0cmluZ1wiKXtcbiAgICAgICAgICAgIGlmICghc2VsZi5zZWFyY2gpIHJldHVybiBudWxsXG4gICAgICAgICAgICBzZWxmW3NlbGYubGVuZ3RoKytdID0gY29udGV4dCB8fCBkb2N1bWVudFxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuc2VhcmNoKG4pXG4gICAgICAgIH1cblxuICAgICAgICBpZiAobi5ub2RlVHlwZSB8fCBuID09PSB3aW5kb3cpe1xuXG4gICAgICAgICAgICBzZWxmW3NlbGYubGVuZ3RoKytdID0gblxuXG4gICAgICAgIH0gZWxzZSBpZiAobi5sZW5ndGgpe1xuXG4gICAgICAgICAgICAvLyB0aGlzIGNvdWxkIGJlIGFuIGFycmF5LCBvciBhbnkgb2JqZWN0IHdpdGggYSBsZW5ndGggYXR0cmlidXRlLFxuICAgICAgICAgICAgLy8gaW5jbHVkaW5nIGFub3RoZXIgaW5zdGFuY2Ugb2YgZWxlbWVudHMgZnJvbSBhbm90aGVyIGludGVyZmFjZS5cblxuICAgICAgICAgICAgdmFyIHVuaXF1ZXMgPSB7fVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG4ubGVuZ3RoOyBpIDwgbDsgaSsrKXsgLy8gcGVyZm9ybSBlbGVtZW50cyBmbGF0dGVuaW5nXG4gICAgICAgICAgICAgICAgdmFyIG5vZGVzID0gJChuW2ldLCBjb250ZXh0KVxuICAgICAgICAgICAgICAgIGlmIChub2RlcyAmJiBub2Rlcy5sZW5ndGgpIGZvciAodmFyIGogPSAwLCBrID0gbm9kZXMubGVuZ3RoOyBqIDwgazsgaisrKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBub2Rlc1tqXVxuICAgICAgICAgICAgICAgICAgICB1aWQgPSB1bmlxdWVJRChub2RlKVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXVuaXF1ZXNbdWlkXSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmW3NlbGYubGVuZ3RoKytdID0gbm9kZVxuICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlc1t1aWRdID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmID0gblxuICAgIH1cblxuICAgIGlmICghc2VsZi5sZW5ndGgpIHJldHVybiBudWxsXG5cbiAgICAvLyB3aGVuIGxlbmd0aCBpcyAxIGFsd2F5cyB1c2UgdGhlIHNhbWUgZWxlbWVudHMgaW5zdGFuY2VcblxuICAgIGlmIChzZWxmLmxlbmd0aCA9PT0gMSl7XG4gICAgICAgIHVpZCA9IHVuaXF1ZUlEKHNlbGZbMF0pXG4gICAgICAgIHJldHVybiBpbnN0YW5jZXNbdWlkXSB8fCAoaW5zdGFuY2VzW3VpZF0gPSBzZWxmKVxuICAgIH1cblxuICAgIHJldHVybiBzZWxmXG5cbn19KVxuXG52YXIgRWxlbWVudHMgPSBwcmltZSh7XG5cbiAgICBpbmhlcml0czogJCxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBFbGVtZW50cygpe1xuICAgICAgICB0aGlzLmxlbmd0aCA9IDBcbiAgICB9LFxuXG4gICAgdW5saW5rOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICBkZWxldGUgaW5zdGFuY2VzW3VuaXF1ZUlEKG5vZGUpXVxuICAgICAgICAgICAgcmV0dXJuIG5vZGVcbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgLy8gbWV0aG9kc1xuXG4gICAgZm9yRWFjaDogZnVuY3Rpb24obWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgZm9yRWFjaCh0aGlzLCBtZXRob2QsIGNvbnRleHQpXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIG1hcDogZnVuY3Rpb24obWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgcmV0dXJuIG1hcCh0aGlzLCBtZXRob2QsIGNvbnRleHQpXG4gICAgfSxcblxuICAgIGZpbHRlcjogZnVuY3Rpb24obWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgcmV0dXJuIGZpbHRlcih0aGlzLCBtZXRob2QsIGNvbnRleHQpXG4gICAgfSxcblxuICAgIGV2ZXJ5OiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gZXZlcnkodGhpcywgbWV0aG9kLCBjb250ZXh0KVxuICAgIH0sXG5cbiAgICBzb21lOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gc29tZSh0aGlzLCBtZXRob2QsIGNvbnRleHQpXG4gICAgfVxuXG59KVxuXG5tb2R1bGUuZXhwb3J0cyA9ICRcbiIsIi8qXG5kZWxlZ2F0aW9uXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBNYXAgPSByZXF1aXJlKFwicHJpbWUvbWFwXCIpXG5cbnZhciAkID0gcmVxdWlyZShcIi4vZXZlbnRzXCIpXG4gICAgICAgIHJlcXVpcmUoJy4vdHJhdmVyc2FsJylcblxuJC5pbXBsZW1lbnQoe1xuXG4gICAgZGVsZWdhdGU6IGZ1bmN0aW9uKGV2ZW50LCBzZWxlY3RvciwgaGFuZGxlLCB1c2VDYXB0dXJlKXtcblxuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuXG4gICAgICAgICAgICB2YXIgc2VsZiA9ICQobm9kZSlcblxuICAgICAgICAgICAgdmFyIGRlbGVnYXRpb24gPSBzZWxmLl9kZWxlZ2F0aW9uIHx8IChzZWxmLl9kZWxlZ2F0aW9uID0ge30pLFxuICAgICAgICAgICAgICAgIGV2ZW50cyAgICAgPSBkZWxlZ2F0aW9uW2V2ZW50XSB8fCAoZGVsZWdhdGlvbltldmVudF0gPSB7fSksXG4gICAgICAgICAgICAgICAgbWFwICAgICAgICA9IChldmVudHNbc2VsZWN0b3JdIHx8IChldmVudHNbc2VsZWN0b3JdID0gbmV3IE1hcCkpXG5cbiAgICAgICAgICAgIGlmIChtYXAuZ2V0KGhhbmRsZSkpIHJldHVyblxuXG4gICAgICAgICAgICB2YXIgYWN0aW9uID0gZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50KSxcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggID0gdGFyZ2V0Lm1hdGNoZXMoc2VsZWN0b3IpID8gdGFyZ2V0IDogdGFyZ2V0LnBhcmVudChzZWxlY3RvcilcblxuICAgICAgICAgICAgICAgIHZhciByZXNcblxuICAgICAgICAgICAgICAgIGlmIChtYXRjaCkgcmVzID0gaGFuZGxlLmNhbGwoc2VsZiwgZSwgbWF0Y2gpXG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1hcC5zZXQoaGFuZGxlLCBhY3Rpb24pXG5cbiAgICAgICAgICAgIHNlbGYub24oZXZlbnQsIGFjdGlvbiwgdXNlQ2FwdHVyZSlcblxuICAgICAgICB9KVxuXG4gICAgfSxcblxuICAgIHVuZGVsZWdhdGU6IGZ1bmN0aW9uKGV2ZW50LCBzZWxlY3RvciwgaGFuZGxlLCB1c2VDYXB0dXJlKXtcblxuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuXG4gICAgICAgICAgICB2YXIgc2VsZiA9ICQobm9kZSksIGRlbGVnYXRpb24sIGV2ZW50cywgbWFwXG5cbiAgICAgICAgICAgIGlmICghKGRlbGVnYXRpb24gPSBzZWxmLl9kZWxlZ2F0aW9uKSB8fCAhKGV2ZW50cyA9IGRlbGVnYXRpb25bZXZlbnRdKSB8fCAhKG1hcCA9IGV2ZW50c1tzZWxlY3Rvcl0pKSByZXR1cm47XG5cbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBtYXAuZ2V0KGhhbmRsZSlcblxuICAgICAgICAgICAgaWYgKGFjdGlvbil7XG4gICAgICAgICAgICAgICAgc2VsZi5vZmYoZXZlbnQsIGFjdGlvbiwgdXNlQ2FwdHVyZSlcbiAgICAgICAgICAgICAgICBtYXAucmVtb3ZlKGFjdGlvbilcblxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGFyZSBubyBtb3JlIGhhbmRsZXMgaW4gYSBnaXZlbiBzZWxlY3RvciwgZGVsZXRlIGl0XG4gICAgICAgICAgICAgICAgaWYgKCFtYXAuY291bnQoKSkgZGVsZXRlIGV2ZW50c1tzZWxlY3Rvcl1cbiAgICAgICAgICAgICAgICAvLyB2YXIgZXZjID0gZXZkID0gMCwgeFxuICAgICAgICAgICAgICAgIHZhciBlMSA9IHRydWUsIGUyID0gdHJ1ZSwgeFxuICAgICAgICAgICAgICAgIGZvciAoeCBpbiBldmVudHMpe1xuICAgICAgICAgICAgICAgICAgICBlMSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGlmIG5vIG1vcmUgc2VsZWN0b3JzIGluIGEgZ2l2ZW4gZXZlbnQgdHlwZSwgZGVsZXRlIGl0XG4gICAgICAgICAgICAgICAgaWYgKGUxKSBkZWxldGUgZGVsZWdhdGlvbltldmVudF1cbiAgICAgICAgICAgICAgICBmb3IgKHggaW4gZGVsZWdhdGlvbil7XG4gICAgICAgICAgICAgICAgICAgIGUyID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIG5vIG1vcmUgZGVsZWdhdGlvbiBldmVudHMgaW4gdGhlIGVsZW1lbnQsIGRlbGV0ZSB0aGUgX2RlbGVnYXRpb24gb2JqZWN0XG4gICAgICAgICAgICAgICAgaWYgKGUyKSBkZWxldGUgc2VsZi5fZGVsZWdhdGlvblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pXG5cbiAgICB9XG5cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gJFxuIiwiLypcbmRvbXJlYWR5XG4qL1widXNlIHN0cmljdFwiXG5cbnZhciAkID0gcmVxdWlyZShcIi4vZXZlbnRzXCIpXG5cbnZhciByZWFkeXN0YXRlY2hhbmdlID0gJ29ucmVhZHlzdGF0ZWNoYW5nZScgaW4gZG9jdW1lbnQsXG4gICAgc2hvdWxkUG9sbCAgICAgICA9IGZhbHNlLFxuICAgIGxvYWRlZCAgICAgICAgICAgPSBmYWxzZSxcbiAgICByZWFkeXMgICAgICAgICAgID0gW10sXG4gICAgY2hlY2tzICAgICAgICAgICA9IFtdLFxuICAgIHJlYWR5ICAgICAgICAgICAgPSBudWxsLFxuICAgIHRpbWVyICAgICAgICAgICAgPSBudWxsLFxuICAgIHRlc3QgICAgICAgICAgICAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcbiAgICBkb2MgICAgICAgICAgICAgID0gJChkb2N1bWVudCksXG4gICAgd2luICAgICAgICAgICAgICA9ICQod2luZG93KVxuXG52YXIgZG9tcmVhZHkgPSBmdW5jdGlvbigpe1xuXG4gICAgaWYgKHRpbWVyKSB0aW1lciA9IGNsZWFyVGltZW91dCh0aW1lcilcblxuICAgIGlmICghbG9hZGVkKXtcblxuICAgICAgICBpZiAocmVhZHlzdGF0ZWNoYW5nZSkgZG9jLm9mZigncmVhZHlzdGF0ZWNoYW5nZScsIGNoZWNrKVxuICAgICAgICBkb2Mub2ZmKCdET01Db250ZW50TG9hZGVkJywgZG9tcmVhZHkpXG4gICAgICAgIHdpbi5vZmYoJ2xvYWQnLCBkb21yZWFkeSlcblxuICAgICAgICBsb2FkZWQgPSB0cnVlXG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IHJlYWR5ID0gcmVhZHlzW2krK107KSByZWFkeSgpXG4gICAgfVxuXG4gICAgcmV0dXJuIGxvYWRlZFxuXG59XG5cbnZhciBjaGVjayA9IGZ1bmN0aW9uKCl7XG4gICAgZm9yICh2YXIgaSA9IGNoZWNrcy5sZW5ndGg7IGktLTspIGlmIChjaGVja3NbaV0oKSkgcmV0dXJuIGRvbXJlYWR5KClcbiAgICByZXR1cm4gZmFsc2Vcbn1cblxudmFyIHBvbGwgPSBmdW5jdGlvbigpe1xuICAgIGNsZWFyVGltZW91dCh0aW1lcilcbiAgICBpZiAoIWNoZWNrKCkpIHRpbWVyID0gc2V0VGltZW91dChwb2xsLCAxZTMgLyA2MClcbn1cblxuaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUpeyAvLyB1c2UgcmVhZHlTdGF0ZSBpZiBhdmFpbGFibGVcblxuICAgIHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAhISgvbG9hZGVkfGNvbXBsZXRlLykudGVzdChkb2N1bWVudC5yZWFkeVN0YXRlKVxuICAgIH1cblxuICAgIGNoZWNrcy5wdXNoKGNvbXBsZXRlKVxuXG4gICAgaWYgKCFjb21wbGV0ZSgpKXsgLy8gdW5sZXNzIGRvbSBpcyBhbHJlYWR5IGxvYWRlZFxuICAgICAgICBpZiAocmVhZHlzdGF0ZWNoYW5nZSkgZG9jLm9uKCdyZWFkeXN0YXRlY2hhbmdlJywgY2hlY2spIC8vIG9ucmVhZHlzdGF0ZWNoYW5nZSBldmVudFxuICAgICAgICBlbHNlIHNob3VsZFBvbGwgPSB0cnVlIC8vb3IgcG9sbCByZWFkeVN0YXRlIGNoZWNrXG4gICAgfSBlbHNlIHsgLy8gZG9tIGlzIGFscmVhZHkgbG9hZGVkXG4gICAgICAgIGRvbXJlYWR5KClcbiAgICB9XG5cbn1cblxuaWYgKHRlc3QuZG9TY3JvbGwpeyAvLyBhbHNvIHVzZSBkb1Njcm9sbCBpZiBhdmFpbGFibGUgKGRvc2Nyb2xsIGNvbWVzIGJlZm9yZSByZWFkeVN0YXRlIFwiY29tcGxldGVcIilcblxuICAgIC8vIExFR0FMIERFUFQ6XG4gICAgLy8gZG9TY3JvbGwgdGVjaG5pcXVlIGRpc2NvdmVyZWQgYnksIG93bmVkIGJ5LCBhbmQgY29weXJpZ2h0ZWQgdG8gRGllZ28gUGVyaW5pIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9JRUNvbnRlbnRMb2FkZWQvXG5cbiAgICAvLyB0ZXN0RWxlbWVudC5kb1Njcm9sbCgpIHRocm93cyB3aGVuIHRoZSBET00gaXMgbm90IHJlYWR5LCBvbmx5IGluIHRoZSB0b3Agd2luZG93XG5cbiAgICB2YXIgc2Nyb2xscyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0ZXN0LmRvU2Nyb2xsKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH0gY2F0Y2ggKGUpe31cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgLy8gSWYgZG9TY3JvbGwgd29ya3MgYWxyZWFkeSwgaXQgY2FuJ3QgYmUgdXNlZCB0byBkZXRlcm1pbmUgZG9tcmVhZHlcbiAgICAvLyBlLmcuIGluIGFuIGlmcmFtZVxuXG4gICAgaWYgKCFzY3JvbGxzKCkpe1xuICAgICAgICBjaGVja3MucHVzaChzY3JvbGxzKVxuICAgICAgICBzaG91bGRQb2xsID0gdHJ1ZVxuICAgIH1cblxufVxuXG5pZiAoc2hvdWxkUG9sbCkgcG9sbCgpXG5cbi8vIG1ha2Ugc3VyZSB0aGF0IGRvbXJlYWR5IGZpcmVzIGJlZm9yZSBsb2FkLCBhbHNvIGlmIG5vdCBvbnJlYWR5c3RhdGVjaGFuZ2UgYW5kIGRvU2Nyb2xsIGFuZCBET01Db250ZW50TG9hZGVkIGxvYWQgd2lsbCBmaXJlXG5kb2Mub24oJ0RPTUNvbnRlbnRMb2FkZWQnLCBkb21yZWFkeSlcbndpbi5vbignbG9hZCcsIGRvbXJlYWR5KVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHJlYWR5KXtcbiAgICAobG9hZGVkKSA/IHJlYWR5KCkgOiByZWFkeXMucHVzaChyZWFkeSlcbiAgICByZXR1cm4gbnVsbFxufVxuIiwiLypcbmV2ZW50c1xuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgRW1pdHRlciA9IHJlcXVpcmUoXCJwcmltZS9lbWl0dGVyXCIpXG5cbnZhciAkID0gcmVxdWlyZShcIi4vYmFzZVwiKVxuXG52YXIgaHRtbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudFxuXG52YXIgYWRkRXZlbnRMaXN0ZW5lciA9IGh0bWwuYWRkRXZlbnRMaXN0ZW5lciA/IGZ1bmN0aW9uKG5vZGUsIGV2ZW50LCBoYW5kbGUsIHVzZUNhcHR1cmUpe1xuICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlLCB1c2VDYXB0dXJlIHx8IGZhbHNlKVxuICAgIHJldHVybiBoYW5kbGVcbn0gOiBmdW5jdGlvbihub2RlLCBldmVudCwgaGFuZGxlKXtcbiAgICBub2RlLmF0dGFjaEV2ZW50KCdvbicgKyBldmVudCwgaGFuZGxlKVxuICAgIHJldHVybiBoYW5kbGVcbn1cblxudmFyIHJlbW92ZUV2ZW50TGlzdGVuZXIgPSBodG1sLnJlbW92ZUV2ZW50TGlzdGVuZXIgPyBmdW5jdGlvbihub2RlLCBldmVudCwgaGFuZGxlLCB1c2VDYXB0dXJlKXtcbiAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZSwgdXNlQ2FwdHVyZSB8fCBmYWxzZSlcbn0gOiBmdW5jdGlvbihub2RlLCBldmVudCwgaGFuZGxlKXtcbiAgICBub2RlLmRldGFjaEV2ZW50KFwib25cIiArIGV2ZW50LCBoYW5kbGUpXG59XG5cbiQuaW1wbGVtZW50KHtcblxuICAgIG9uOiBmdW5jdGlvbihldmVudCwgaGFuZGxlLCB1c2VDYXB0dXJlKXtcblxuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgdmFyIHNlbGYgPSAkKG5vZGUpXG5cbiAgICAgICAgICAgIHZhciBpbnRlcm5hbEV2ZW50ID0gZXZlbnQgKyAodXNlQ2FwdHVyZSA/IFwiOmNhcHR1cmVcIiA6IFwiXCIpXG5cbiAgICAgICAgICAgIEVtaXR0ZXIucHJvdG90eXBlLm9uLmNhbGwoc2VsZiwgaW50ZXJuYWxFdmVudCwgaGFuZGxlKVxuXG4gICAgICAgICAgICB2YXIgZG9tTGlzdGVuZXJzID0gc2VsZi5fZG9tTGlzdGVuZXJzIHx8IChzZWxmLl9kb21MaXN0ZW5lcnMgPSB7fSlcbiAgICAgICAgICAgIGlmICghZG9tTGlzdGVuZXJzW2ludGVybmFsRXZlbnRdKSBkb21MaXN0ZW5lcnNbaW50ZXJuYWxFdmVudF0gPSBhZGRFdmVudExpc3RlbmVyKG5vZGUsIGV2ZW50LCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBFbWl0dGVyLnByb3RvdHlwZS5lbWl0LmNhbGwoc2VsZiwgaW50ZXJuYWxFdmVudCwgZSB8fCB3aW5kb3cuZXZlbnQsIEVtaXR0ZXIuRU1JVF9TWU5DKVxuICAgICAgICAgICAgfSwgdXNlQ2FwdHVyZSlcbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgb2ZmOiBmdW5jdGlvbihldmVudCwgaGFuZGxlLCB1c2VDYXB0dXJlKXtcblxuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpe1xuXG4gICAgICAgICAgICB2YXIgc2VsZiA9ICQobm9kZSlcblxuICAgICAgICAgICAgdmFyIGludGVybmFsRXZlbnQgPSBldmVudCArICh1c2VDYXB0dXJlID8gXCI6Y2FwdHVyZVwiIDogXCJcIilcblxuICAgICAgICAgICAgdmFyIGRvbUxpc3RlbmVycyA9IHNlbGYuX2RvbUxpc3RlbmVycywgZG9tRXZlbnQsIGxpc3RlbmVycyA9IHNlbGYuX2xpc3RlbmVycywgZXZlbnRzXG5cbiAgICAgICAgICAgIGlmIChkb21MaXN0ZW5lcnMgJiYgKGRvbUV2ZW50ID0gZG9tTGlzdGVuZXJzW2ludGVybmFsRXZlbnRdKSAmJiBsaXN0ZW5lcnMgJiYgKGV2ZW50cyA9IGxpc3RlbmVyc1tpbnRlcm5hbEV2ZW50XSkpe1xuXG4gICAgICAgICAgICAgICAgRW1pdHRlci5wcm90b3R5cGUub2ZmLmNhbGwoc2VsZiwgaW50ZXJuYWxFdmVudCwgaGFuZGxlKVxuXG4gICAgICAgICAgICAgICAgaWYgKCFzZWxmLl9saXN0ZW5lcnMgfHwgIXNlbGYuX2xpc3RlbmVyc1tldmVudF0pe1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyKG5vZGUsIGV2ZW50LCBkb21FdmVudClcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGRvbUxpc3RlbmVyc1tldmVudF1cblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBsIGluIGRvbUxpc3RlbmVycykgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBzZWxmLl9kb21MaXN0ZW5lcnNcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgZW1pdDogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHNcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgIEVtaXR0ZXIucHJvdG90eXBlLmVtaXQuYXBwbHkoJChub2RlKSwgYXJncylcbiAgICAgICAgfSlcbiAgICB9XG5cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gJFxuIiwiLypcbmVsZW1lbnRzXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciAkID0gcmVxdWlyZShcIi4vYmFzZVwiKVxuICAgICAgICByZXF1aXJlKFwiLi9hdHRyaWJ1dGVzXCIpXG4gICAgICAgIHJlcXVpcmUoXCIuL2V2ZW50c1wiKVxuICAgICAgICByZXF1aXJlKFwiLi9pbnNlcnRpb25cIilcbiAgICAgICAgcmVxdWlyZShcIi4vdHJhdmVyc2FsXCIpXG4gICAgICAgIHJlcXVpcmUoXCIuL2RlbGVnYXRpb25cIilcblxubW9kdWxlLmV4cG9ydHMgPSAkXG4iLCIvKlxuaW5zZXJ0aW9uXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciAkID0gcmVxdWlyZShcIi4vYmFzZVwiKVxuXG4vLyBiYXNlIGluc2VydGlvblxuXG4kLmltcGxlbWVudCh7XG5cbiAgICBhcHBlbmRDaGlsZDogZnVuY3Rpb24oY2hpbGQpe1xuICAgICAgICB0aGlzWzBdLmFwcGVuZENoaWxkKCQoY2hpbGQpWzBdKVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICBpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKGNoaWxkLCByZWYpe1xuICAgICAgICB0aGlzWzBdLmluc2VydEJlZm9yZSgkKGNoaWxkKVswXSwgJChyZWYpWzBdKVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICByZW1vdmVDaGlsZDogZnVuY3Rpb24oY2hpbGQpe1xuICAgICAgICB0aGlzWzBdLnJlbW92ZUNoaWxkKCQoY2hpbGQpWzBdKVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICByZXBsYWNlQ2hpbGQ6IGZ1bmN0aW9uKGNoaWxkLCByZWYpe1xuICAgICAgICB0aGlzWzBdLnJlcGxhY2VDaGlsZCgkKGNoaWxkKVswXSwgJChyZWYpWzBdKVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH1cblxufSlcblxuLy8gYmVmb3JlLCBhZnRlciwgYm90dG9tLCB0b3BcblxuJC5pbXBsZW1lbnQoe1xuXG4gICAgYmVmb3JlOiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudClbMF1cbiAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZVxuICAgICAgICBpZiAocGFyZW50KSB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIGVsZW1lbnQpXG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIGFmdGVyOiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudClbMF1cbiAgICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZVxuICAgICAgICBpZiAocGFyZW50KSB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIGVsZW1lbnQubmV4dFNpYmxpbmcpXG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIGJvdHRvbTogZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpWzBdXG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKG5vZGUpXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIHRvcDogZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpWzBdXG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICBlbGVtZW50Lmluc2VydEJlZm9yZShub2RlLCBlbGVtZW50LmZpcnN0Q2hpbGQpXG4gICAgICAgIH0pXG4gICAgfVxuXG59KVxuXG4vLyBpbnNlcnQsIHJlcGxhY2VcblxuJC5pbXBsZW1lbnQoe1xuXG4gICAgaW5zZXJ0OiAkLnByb3RvdHlwZS5ib3R0b20sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24obm9kZSl7XG4gICAgICAgICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlXG4gICAgICAgICAgICBpZiAocGFyZW50KSBwYXJlbnQucmVtb3ZlQ2hpbGQobm9kZSlcbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgcmVwbGFjZTogZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpWzBdXG4gICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQodGhpc1swXSwgZWxlbWVudClcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9XG5cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gJFxuIiwidmFyIG1ha2VJdGVyYXRvciA9IHJlcXVpcmUoJy4uL2Z1bmN0aW9uL21ha2VJdGVyYXRvcl8nKTtcblxuICAgIC8qKlxuICAgICAqIEFycmF5IGV2ZXJ5XG4gICAgICovXG4gICAgZnVuY3Rpb24gZXZlcnkoYXJyLCBjYWxsYmFjaywgdGhpc09iaikge1xuICAgICAgICBjYWxsYmFjayA9IG1ha2VJdGVyYXRvcihjYWxsYmFjaywgdGhpc09iaik7XG4gICAgICAgIHZhciByZXN1bHQgPSB0cnVlO1xuICAgICAgICBpZiAoYXJyID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaSA9IC0xLCBsZW4gPSBhcnIubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7XG4gICAgICAgICAgICAvLyB3ZSBpdGVyYXRlIG92ZXIgc3BhcnNlIGl0ZW1zIHNpbmNlIHRoZXJlIGlzIG5vIHdheSB0byBtYWtlIGl0XG4gICAgICAgICAgICAvLyB3b3JrIHByb3Blcmx5IG9uIElFIDctOC4gc2VlICM2NFxuICAgICAgICAgICAgaWYgKCFjYWxsYmFjayhhcnJbaV0sIGksIGFycikgKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZXZlcnk7XG5cbiIsInZhciBtYWtlSXRlcmF0b3IgPSByZXF1aXJlKCcuLi9mdW5jdGlvbi9tYWtlSXRlcmF0b3JfJyk7XG5cbiAgICAvKipcbiAgICAgKiBBcnJheSBmaWx0ZXJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmaWx0ZXIoYXJyLCBjYWxsYmFjaywgdGhpc09iaikge1xuICAgICAgICBjYWxsYmFjayA9IG1ha2VJdGVyYXRvcihjYWxsYmFjaywgdGhpc09iaik7XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaSA9IC0xLCBsZW4gPSBhcnIubGVuZ3RoLCB2YWx1ZTtcbiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikge1xuICAgICAgICAgICAgdmFsdWUgPSBhcnJbaV07XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2sodmFsdWUsIGksIGFycikpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2godmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmaWx0ZXI7XG5cblxuIiwidmFyIG1ha2VJdGVyYXRvciA9IHJlcXVpcmUoJy4uL2Z1bmN0aW9uL21ha2VJdGVyYXRvcl8nKTtcblxuICAgIC8qKlxuICAgICAqIEFycmF5IG1hcFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG1hcChhcnIsIGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGNhbGxiYWNrID0gbWFrZUl0ZXJhdG9yKGNhbGxiYWNrLCB0aGlzT2JqKTtcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgaWYgKGFyciA9PSBudWxsKXtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGkgPSAtMSwgbGVuID0gYXJyLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikge1xuICAgICAgICAgICAgcmVzdWx0c1tpXSA9IGNhbGxiYWNrKGFycltpXSwgaSwgYXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cblxuICAgICBtb2R1bGUuZXhwb3J0cyA9IG1hcDtcblxuIiwidmFyIG1ha2VJdGVyYXRvciA9IHJlcXVpcmUoJy4uL2Z1bmN0aW9uL21ha2VJdGVyYXRvcl8nKTtcblxuICAgIC8qKlxuICAgICAqIEFycmF5IHNvbWVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzb21lKGFyciwgY2FsbGJhY2ssIHRoaXNPYmopIHtcbiAgICAgICAgY2FsbGJhY2sgPSBtYWtlSXRlcmF0b3IoY2FsbGJhY2ssIHRoaXNPYmopO1xuICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpID0gLTEsIGxlbiA9IGFyci5sZW5ndGg7XG4gICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHtcbiAgICAgICAgICAgIC8vIHdlIGl0ZXJhdGUgb3ZlciBzcGFyc2UgaXRlbXMgc2luY2UgdGhlcmUgaXMgbm8gd2F5IHRvIG1ha2UgaXRcbiAgICAgICAgICAgIC8vIHdvcmsgcHJvcGVybHkgb24gSUUgNy04LiBzZWUgIzY0XG4gICAgICAgICAgICBpZiAoIGNhbGxiYWNrKGFycltpXSwgaSwgYXJyKSApIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHNvbWU7XG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgZmlyc3QgYXJndW1lbnQgcHJvdmlkZWQgdG8gaXQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaWRlbnRpdHkodmFsKXtcbiAgICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGlkZW50aXR5O1xuXG5cbiIsInZhciBpZGVudGl0eSA9IHJlcXVpcmUoJy4vaWRlbnRpdHknKTtcbnZhciBwcm9wID0gcmVxdWlyZSgnLi9wcm9wJyk7XG52YXIgZGVlcE1hdGNoZXMgPSByZXF1aXJlKCcuLi9vYmplY3QvZGVlcE1hdGNoZXMnKTtcblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGFyZ3VtZW50IGludG8gYSB2YWxpZCBpdGVyYXRvci5cbiAgICAgKiBVc2VkIGludGVybmFsbHkgb24gbW9zdCBhcnJheS9vYmplY3QvY29sbGVjdGlvbiBtZXRob2RzIHRoYXQgcmVjZWl2ZXMgYVxuICAgICAqIGNhbGxiYWNrL2l0ZXJhdG9yIHByb3ZpZGluZyBhIHNob3J0Y3V0IHN5bnRheC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtYWtlSXRlcmF0b3Ioc3JjLCB0aGlzT2JqKXtcbiAgICAgICAgaWYgKHNyYyA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gaWRlbnRpdHk7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoKHR5cGVvZiBzcmMpIHtcbiAgICAgICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzpcbiAgICAgICAgICAgICAgICAvLyBmdW5jdGlvbiBpcyB0aGUgZmlyc3QgdG8gaW1wcm92ZSBwZXJmIChtb3N0IGNvbW1vbiBjYXNlKVxuICAgICAgICAgICAgICAgIC8vIGFsc28gYXZvaWQgdXNpbmcgYEZ1bmN0aW9uI2NhbGxgIGlmIG5vdCBuZWVkZWQsIHdoaWNoIGJvb3N0c1xuICAgICAgICAgICAgICAgIC8vIHBlcmYgYSBsb3QgaW4gc29tZSBjYXNlc1xuICAgICAgICAgICAgICAgIHJldHVybiAodHlwZW9mIHRoaXNPYmogIT09ICd1bmRlZmluZWQnKT8gZnVuY3Rpb24odmFsLCBpLCBhcnIpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3JjLmNhbGwodGhpc09iaiwgdmFsLCBpLCBhcnIpO1xuICAgICAgICAgICAgICAgIH0gOiBzcmM7XG4gICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVlcE1hdGNoZXModmFsLCBzcmMpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcChzcmMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBtYWtlSXRlcmF0b3I7XG5cblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBnZXRzIGEgcHJvcGVydHkgb2YgdGhlIHBhc3NlZCBvYmplY3RcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwcm9wKG5hbWUpe1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24ob2JqKXtcbiAgICAgICAgICAgIHJldHVybiBvYmpbbmFtZV07XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBwcm9wO1xuXG5cbiIsInZhciBmb3JPd24gPSByZXF1aXJlKCcuL2Zvck93bicpO1xudmFyIGlzQXJyYXkgPSByZXF1aXJlKCcuLi9sYW5nL2lzQXJyYXknKTtcblxuICAgIGZ1bmN0aW9uIGNvbnRhaW5zTWF0Y2goYXJyYXksIHBhdHRlcm4pIHtcbiAgICAgICAgdmFyIGkgPSAtMSwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoZGVlcE1hdGNoZXMoYXJyYXlbaV0sIHBhdHRlcm4pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWF0Y2hBcnJheSh0YXJnZXQsIHBhdHRlcm4pIHtcbiAgICAgICAgdmFyIGkgPSAtMSwgcGF0dGVybkxlbmd0aCA9IHBhdHRlcm4ubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgcGF0dGVybkxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKCFjb250YWluc01hdGNoKHRhcmdldCwgcGF0dGVybltpXSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYXRjaE9iamVjdCh0YXJnZXQsIHBhdHRlcm4pIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XG4gICAgICAgIGZvck93bihwYXR0ZXJuLCBmdW5jdGlvbih2YWwsIGtleSkge1xuICAgICAgICAgICAgaWYgKCFkZWVwTWF0Y2hlcyh0YXJnZXRba2V5XSwgdmFsKSkge1xuICAgICAgICAgICAgICAgIC8vIFJldHVybiBmYWxzZSB0byBicmVhayBvdXQgb2YgZm9yT3duIGVhcmx5XG4gICAgICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQgPSBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVjdXJzaXZlbHkgY2hlY2sgaWYgdGhlIG9iamVjdHMgbWF0Y2guXG4gICAgICovXG4gICAgZnVuY3Rpb24gZGVlcE1hdGNoZXModGFyZ2V0LCBwYXR0ZXJuKXtcbiAgICAgICAgaWYgKHRhcmdldCAmJiB0eXBlb2YgdGFyZ2V0ID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgaWYgKGlzQXJyYXkodGFyZ2V0KSAmJiBpc0FycmF5KHBhdHRlcm4pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoQXJyYXkodGFyZ2V0LCBwYXR0ZXJuKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoT2JqZWN0KHRhcmdldCwgcGF0dGVybik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0ID09PSBwYXR0ZXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBkZWVwTWF0Y2hlcztcblxuXG4iLCIvKlxudHJhdmVyc2FsXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBtYXAgPSByZXF1aXJlKFwibW91dC9hcnJheS9tYXBcIilcblxudmFyIHNsaWNrID0gcmVxdWlyZShcInNsaWNrXCIpXG5cbnZhciAkID0gcmVxdWlyZShcIi4vYmFzZVwiKVxuXG52YXIgZ2VuID0gZnVuY3Rpb24oY29tYmluYXRvciwgZXhwcmVzc2lvbil7XG4gICAgcmV0dXJuIG1hcChzbGljay5wYXJzZShleHByZXNzaW9uIHx8IFwiKlwiKSwgZnVuY3Rpb24ocGFydCl7XG4gICAgICAgIHJldHVybiBjb21iaW5hdG9yICsgXCIgXCIgKyBwYXJ0XG4gICAgfSkuam9pbihcIiwgXCIpXG59XG5cbnZhciBwdXNoXyA9IEFycmF5LnByb3RvdHlwZS5wdXNoXG5cbiQuaW1wbGVtZW50KHtcblxuICAgIHNlYXJjaDogZnVuY3Rpb24oZXhwcmVzc2lvbil7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMSkgcmV0dXJuICQoc2xpY2suc2VhcmNoKGV4cHJlc3Npb24sIHRoaXNbMF0sIG5ldyAkKSlcblxuICAgICAgICB2YXIgYnVmZmVyID0gW11cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSB0aGlzW2ldOyBpKyspIHB1c2hfLmFwcGx5KGJ1ZmZlciwgc2xpY2suc2VhcmNoKGV4cHJlc3Npb24sIG5vZGUpKVxuICAgICAgICBidWZmZXIgPSAkKGJ1ZmZlcilcbiAgICAgICAgcmV0dXJuIGJ1ZmZlciAmJiBidWZmZXIuc29ydCgpXG4gICAgfSxcblxuICAgIGZpbmQ6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDEpIHJldHVybiAkKHNsaWNrLmZpbmQoZXhwcmVzc2lvbiwgdGhpc1swXSkpXG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSB0aGlzW2ldOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBmb3VuZCA9IHNsaWNrLmZpbmQoZXhwcmVzc2lvbiwgbm9kZSlcbiAgICAgICAgICAgIGlmIChmb3VuZCkgcmV0dXJuICQoZm91bmQpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbFxuICAgIH0sXG5cbiAgICBzb3J0OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gc2xpY2suc29ydCh0aGlzKVxuICAgIH0sXG5cbiAgICBtYXRjaGVzOiBmdW5jdGlvbihleHByZXNzaW9uKXtcbiAgICAgICAgcmV0dXJuIHNsaWNrLm1hdGNoZXModGhpc1swXSwgZXhwcmVzc2lvbilcbiAgICB9LFxuXG4gICAgY29udGFpbnM6IGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICByZXR1cm4gc2xpY2suY29udGFpbnModGhpc1swXSwgbm9kZSlcbiAgICB9LFxuXG4gICAgbmV4dFNpYmxpbmdzOiBmdW5jdGlvbihleHByZXNzaW9uKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VhcmNoKGdlbignficsIGV4cHJlc3Npb24pKVxuICAgIH0sXG5cbiAgICBuZXh0U2libGluZzogZnVuY3Rpb24oZXhwcmVzc2lvbil7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmQoZ2VuKCcrJywgZXhwcmVzc2lvbikpXG4gICAgfSxcblxuICAgIHByZXZpb3VzU2libGluZ3M6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2goZ2VuKCchficsIGV4cHJlc3Npb24pKVxuICAgIH0sXG5cbiAgICBwcmV2aW91c1NpYmxpbmc6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICByZXR1cm4gdGhpcy5maW5kKGdlbignISsnLCBleHByZXNzaW9uKSlcbiAgICB9LFxuXG4gICAgY2hpbGRyZW46IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2goZ2VuKCc+JywgZXhwcmVzc2lvbikpXG4gICAgfSxcblxuICAgIGZpcnN0Q2hpbGQ6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICByZXR1cm4gdGhpcy5maW5kKGdlbignXicsIGV4cHJlc3Npb24pKVxuICAgIH0sXG5cbiAgICBsYXN0Q2hpbGQ6IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgICAgICByZXR1cm4gdGhpcy5maW5kKGdlbignIV4nLCBleHByZXNzaW9uKSlcbiAgICB9LFxuXG4gICAgcGFyZW50OiBmdW5jdGlvbihleHByZXNzaW9uKXtcbiAgICAgICAgdmFyIGJ1ZmZlciA9IFtdXG4gICAgICAgIGxvb3A6IGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gdGhpc1tpXTsgaSsrKSB3aGlsZSAoKG5vZGUgPSBub2RlLnBhcmVudE5vZGUpICYmIChub2RlICE9PSBkb2N1bWVudCkpe1xuICAgICAgICAgICAgaWYgKCFleHByZXNzaW9uIHx8IHNsaWNrLm1hdGNoZXMobm9kZSwgZXhwcmVzc2lvbikpe1xuICAgICAgICAgICAgICAgIGJ1ZmZlci5wdXNoKG5vZGUpXG4gICAgICAgICAgICAgICAgYnJlYWsgbG9vcFxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICQoYnVmZmVyKVxuICAgIH0sXG5cbiAgICBwYXJlbnRzOiBmdW5jdGlvbihleHByZXNzaW9uKXtcbiAgICAgICAgdmFyIGJ1ZmZlciA9IFtdXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gdGhpc1tpXTsgaSsrKSB3aGlsZSAoKG5vZGUgPSBub2RlLnBhcmVudE5vZGUpICYmIChub2RlICE9PSBkb2N1bWVudCkpe1xuICAgICAgICAgICAgaWYgKCFleHByZXNzaW9uIHx8IHNsaWNrLm1hdGNoZXMobm9kZSwgZXhwcmVzc2lvbikpIGJ1ZmZlci5wdXNoKG5vZGUpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICQoYnVmZmVyKVxuICAgIH1cblxufSlcblxubW9kdWxlLmV4cG9ydHMgPSAkXG4iLCIvKlxuemVuXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBmb3JFYWNoID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvZm9yRWFjaFwiKSxcbiAgICBtYXAgICAgID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvbWFwXCIpXG5cbnZhciBwYXJzZSA9IHJlcXVpcmUoXCJzbGljay9wYXJzZXJcIilcblxudmFyICQgPSByZXF1aXJlKFwiLi9iYXNlXCIpXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZXhwcmVzc2lvbiwgZG9jKXtcblxuICAgIHJldHVybiAkKG1hcChwYXJzZShleHByZXNzaW9uKSwgZnVuY3Rpb24oZXhwcmVzc2lvbil7XG5cbiAgICAgICAgdmFyIHByZXZpb3VzLCByZXN1bHRcblxuICAgICAgICBmb3JFYWNoKGV4cHJlc3Npb24sIGZ1bmN0aW9uKHBhcnQsIGkpe1xuXG4gICAgICAgICAgICB2YXIgbm9kZSA9IChkb2MgfHwgZG9jdW1lbnQpLmNyZWF0ZUVsZW1lbnQocGFydC50YWcpXG5cbiAgICAgICAgICAgIGlmIChwYXJ0LmlkKSBub2RlLmlkID0gcGFydC5pZFxuXG4gICAgICAgICAgICBpZiAocGFydC5jbGFzc0xpc3QpIG5vZGUuY2xhc3NOYW1lID0gcGFydC5jbGFzc0xpc3Quam9pbihcIiBcIilcblxuICAgICAgICAgICAgaWYgKHBhcnQuYXR0cmlidXRlcykgZm9yRWFjaChwYXJ0LmF0dHJpYnV0ZXMsIGZ1bmN0aW9uKGF0dHJpYnV0ZSl7XG4gICAgICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlLm5hbWUsIGF0dHJpYnV0ZS52YWx1ZSB8fCBcIlwiKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgaWYgKHBhcnQucHNldWRvcykgZm9yRWFjaChwYXJ0LnBzZXVkb3MsIGZ1bmN0aW9uKHBzZXVkbyl7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSAkKG5vZGUpLCBtZXRob2QgPSBuW3BzZXVkby5uYW1lXVxuICAgICAgICAgICAgICAgIGlmIChtZXRob2QpIG1ldGhvZC5jYWxsKG4sIHBzZXVkby52YWx1ZSlcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGlmIChpID09PSAwKXtcblxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5vZGVcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LmNvbWJpbmF0b3IgPT09IFwiIFwiKXtcblxuICAgICAgICAgICAgICAgIHByZXZpb3VzLmFwcGVuZENoaWxkKG5vZGUpXG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydC5jb21iaW5hdG9yID09PSBcIitcIil7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBwcmV2aW91cy5wYXJlbnROb2RlXG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudE5vZGUpIHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQobm9kZSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJldmlvdXMgPSBub2RlXG5cbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4gcmVzdWx0XG5cbiAgICB9KSlcblxufVxuIiwiLyogICAgICAgICAgLi0gICAzXG4uLS4tLi4tLi4tLi18LS5fLlxuJyAnICdgLSdgLScgJyAnICdcbiovXCJ1c2Ugc3RyaWN0XCJcblxuLy8gY29sb3IgYW5kIHRpbWVyXG52YXIgY29sb3IgPSByZXF1aXJlKFwiLi9saWIvY29sb3JcIiksXG4gICAgZnJhbWUgPSByZXF1aXJlKFwiLi9saWIvZnJhbWVcIilcblxuLy8gaWYgd2UncmUgaW4gYSBicm93c2VyIHdlIG5lZWQgLi9icm93c2VyLCBvdGhlcndpc2UgLi9meFxudmFyIG1vb2Z4ID0gKHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIikgPyByZXF1aXJlKFwiLi9saWIvYnJvd3NlclwiKSA6IHJlcXVpcmUoXCIuL2xpYi9meFwiKVxuXG5tb29meC5yZXF1ZXN0RnJhbWUgPSBmdW5jdGlvbihjYWxsYmFjayl7XG4gICAgZnJhbWUucmVxdWVzdChjYWxsYmFjaylcbiAgICByZXR1cm4gdGhpc1xufVxuXG5tb29meC5jYW5jZWxGcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKXtcbiAgICBmcmFtZS5jYW5jZWwoY2FsbGJhY2spXG4gICAgcmV0dXJuIHRoaXNcbn1cblxubW9vZnguY29sb3IgPSBjb2xvclxuXG4vLyBhbmQgZXhwb3J0IG1vb2Z4XG5cbm1vZHVsZS5leHBvcnRzID0gbW9vZnhcbiIsIi8qXG5Nb29GeFxuKi9cInVzZSBzdHJpY3RcIlxuXG4vLyByZXF1aXJlc1xuXG52YXIgY29sb3IgID0gcmVxdWlyZShcIi4vY29sb3JcIiksXG4gICAgZnJhbWUgID0gcmVxdWlyZShcIi4vZnJhbWVcIilcblxudmFyIGNhbmNlbEZyYW1lID0gZnJhbWUuY2FuY2VsLFxuICAgIHJlcXVlc3RGcmFtZSA9IGZyYW1lLnJlcXVlc3RcblxudmFyIHByaW1lICA9IHJlcXVpcmUoXCJwcmltZVwiKVxuXG52YXIgY2FtZWxpemUgICAgICAgID0gcmVxdWlyZShcInByaW1lL3N0cmluZy9jYW1lbGl6ZVwiKSxcbiAgICBjbGVhbiAgICAgICAgICAgPSByZXF1aXJlKFwicHJpbWUvc3RyaW5nL2NsZWFuXCIpLFxuICAgIGNhcGl0YWxpemUgICAgICA9IHJlcXVpcmUoXCJwcmltZS9zdHJpbmcvY2FwaXRhbGl6ZVwiKSxcbiAgICBoeXBoZW5hdGVTdHJpbmcgPSByZXF1aXJlKFwicHJpbWUvc3RyaW5nL2h5cGhlbmF0ZVwiKVxuXG52YXIgbWFwICAgICA9IHJlcXVpcmUoXCJwcmltZS9hcnJheS9tYXBcIiksXG4gICAgZm9yRWFjaCA9IHJlcXVpcmUoXCJwcmltZS9hcnJheS9mb3JFYWNoXCIpLFxuICAgIGluZGV4T2YgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvaW5kZXhPZlwiKVxuXG52YXIgZWxlbWVudHMgPSByZXF1aXJlKFwiZWxlbWVudHNcIilcblxudmFyIGZ4ID0gcmVxdWlyZShcIi4vZnhcIilcblxuLy8gdXRpbFxuXG52YXIgbWF0Y2hTdHJpbmcgPSBmdW5jdGlvbihzLCByKXtcbiAgICByZXR1cm4gU3RyaW5nLnByb3RvdHlwZS5tYXRjaC5jYWxsKHMsIHIpO1xufVxuXG52YXIgaHlwaGVuYXRlZCA9IHt9XG52YXIgaHlwaGVuYXRlID0gZnVuY3Rpb24oc2VsZil7XG4gICAgcmV0dXJuIGh5cGhlbmF0ZWRbc2VsZl0gfHwgKGh5cGhlbmF0ZWRbc2VsZl0gPSBoeXBoZW5hdGVTdHJpbmcoc2VsZikpXG59XG5cbnZhciByb3VuZCA9IGZ1bmN0aW9uKG4pe1xuICAgIHJldHVybiBNYXRoLnJvdW5kKG4gKiAxZTMpIC8gMWUzXG59XG5cbi8vIGNvbXB1dGUgPiBub2RlID4gcHJvcGVydHlcblxudmFyIGNvbXB1dGUgPSBnbG9iYWwuZ2V0Q29tcHV0ZWRTdHlsZSA/IGZ1bmN0aW9uKG5vZGUpe1xuICAgIHZhciBjdHMgPSBnZXRDb21wdXRlZFN0eWxlKG5vZGUsIG51bGwpXG4gICAgcmV0dXJuIGZ1bmN0aW9uKHByb3BlcnR5KXtcbiAgICAgICAgcmV0dXJuIGN0cyA/IGN0cy5nZXRQcm9wZXJ0eVZhbHVlKGh5cGhlbmF0ZShwcm9wZXJ0eSkpIDogXCJcIlxuICAgIH1cbn0gOiAvKihjc3MzKT8qL2Z1bmN0aW9uKG5vZGUpe1xuICAgIHZhciBjdHMgPSBub2RlLmN1cnJlbnRTdHlsZVxuICAgIHJldHVybiBmdW5jdGlvbihwcm9wZXJ0eSl7XG4gICAgICAgIHJldHVybiBjdHMgPyBjdHNbY2FtZWxpemUocHJvcGVydHkpXSA6IFwiXCJcbiAgICB9XG59Lyo6bnVsbCovXG5cbi8vIHBpeGVsIHJhdGlvIHJldHJpZXZlclxuXG52YXIgdGVzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcblxudmFyIGNzc1RleHQgPSBcImJvcmRlcjpub25lO21hcmdpbjpub25lO3BhZGRpbmc6bm9uZTt2aXNpYmlsaXR5OmhpZGRlbjtwb3NpdGlvbjphYnNvbHV0ZTtoZWlnaHQ6MDtcIjtcblxuLy8gcmV0dXJucyB0aGUgYW1vdW50IG9mIHBpeGVscyB0aGF0IHRha2VzIHRvIG1ha2Ugb25lIG9mIHRoZSB1bml0XG5cbnZhciBwaXhlbFJhdGlvID0gZnVuY3Rpb24oZWxlbWVudCwgdSl7XG4gICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSwgcmF0aW8gPSAxXG4gICAgaWYgKHBhcmVudCl7XG4gICAgICAgIHRlc3Quc3R5bGUuY3NzVGV4dCA9IGNzc1RleHQgKyAoXCJ3aWR0aDoxMDBcIiArIHUgKyBcIjtcIilcbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKHRlc3QpXG4gICAgICAgIHJhdGlvID0gdGVzdC5vZmZzZXRXaWR0aCAvIDEwMFxuICAgICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQodGVzdClcbiAgICB9XG4gICAgcmV0dXJuIHJhdGlvXG59XG5cbi8vIG1pcnJvciA0IHZhbHVlc1xuXG52YXIgbWlycm9yNCA9IGZ1bmN0aW9uKHZhbHVlcyl7XG4gICAgdmFyIGxlbmd0aCA9IHZhbHVlcy5sZW5ndGhcbiAgICBpZiAgICAgIChsZW5ndGggPT09IDEpIHZhbHVlcy5wdXNoKHZhbHVlc1swXSwgdmFsdWVzWzBdLCB2YWx1ZXNbMF0pXG4gICAgZWxzZSBpZiAobGVuZ3RoID09PSAyKSB2YWx1ZXMucHVzaCh2YWx1ZXNbMF0sIHZhbHVlc1sxXSlcbiAgICBlbHNlIGlmIChsZW5ndGggPT09IDMpIHZhbHVlcy5wdXNoKHZhbHVlc1sxXSlcbiAgICByZXR1cm4gdmFsdWVzXG59XG5cbi8vIHJlZ3VsYXIgZXhwcmVzc2lvbnMgc3RyaW5nc1xuXG52YXIgc0xlbmd0aCAgICAgID0gXCIoWy0uXFxcXGRdKykoJXxjbXxtbXxpbnxweHxwdHxwY3xlbXxleHxjaHxyZW18dnd8dmh8dm0pXCIsXG4gICAgc0xlbmd0aE51bSAgID0gc0xlbmd0aCArIFwiP1wiLFxuICAgIHNCb3JkZXJTdHlsZSA9IFwibm9uZXxoaWRkZW58ZG90dGVkfGRhc2hlZHxzb2xpZHxkb3VibGV8Z3Jvb3ZlfHJpZGdlfGluc2V0fG91dHNldHxpbmhlcml0XCJcblxuLy8gcmVndWxhciBleHByZXNzaW9uc1xuXG52YXIgcmdMZW5ndGggICAgID0gUmVnRXhwKHNMZW5ndGgsIFwiZ1wiKSxcbiAgICByTGVuZ3RoTnVtICAgPSBSZWdFeHAoc0xlbmd0aE51bSksXG4gICAgcmdMZW5ndGhOdW0gID0gUmVnRXhwKHNMZW5ndGhOdW0sIFwiZ1wiKSxcbiAgICByQm9yZGVyU3R5bGUgPSBSZWdFeHAoc0JvcmRlclN0eWxlKVxuXG4vLyBub3JtYWxpemUgPiBjc3NcblxudmFyIHBhcnNlU3RyaW5nID0gZnVuY3Rpb24odmFsdWUpe1xuICAgIHJldHVybiAodmFsdWUgPT0gbnVsbCkgPyBcIlwiIDogdmFsdWUgKyBcIlwiXG59XG5cbnZhciBwYXJzZU9wYWNpdHkgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIikgcmV0dXJuIG5vcm1hbGl6ZSA/IFwiMVwiIDogXCJcIlxuICAgIHJldHVybiAoaXNGaW5pdGUoKHZhbHVlID0gK3ZhbHVlKSkpID8gKHZhbHVlIDwgMCA/IFwiMFwiIDogdmFsdWUgKyBcIlwiKSA6IFwiMVwiXG59XG5cbnRyeSB7dGVzdC5zdHlsZS5jb2xvciA9IFwicmdiYSgwLDAsMCwwLjUpXCJ9IGNhdGNoKGUpe31cbnZhciByZ2JhID0gL15yZ2JhLy50ZXN0KHRlc3Quc3R5bGUuY29sb3IpXG5cbnZhciBwYXJzZUNvbG9yID0gZnVuY3Rpb24odmFsdWUsIG5vcm1hbGl6ZSl7XG4gICAgdmFyIGJsYWNrID0gXCJyZ2JhKDAsMCwwLDEpXCIsIGNcbiAgICBpZiAoIXZhbHVlIHx8ICEoYyA9IGNvbG9yKHZhbHVlLCB0cnVlKSkpIHJldHVybiBub3JtYWxpemUgPyBibGFjayA6IFwiXCJcbiAgICBpZiAobm9ybWFsaXplKSByZXR1cm4gXCJyZ2JhKFwiICsgYyArIFwiKVwiXG5cbiAgICB2YXIgYWxwaGEgPSBjWzNdXG4gICAgaWYgKGFscGhhID09PSAwKSByZXR1cm4gXCJ0cmFuc3BhcmVudFwiXG4gICAgcmV0dXJuICghcmdiYSB8fCBhbHBoYSA9PT0gMSkgPyBcInJnYihcIiArIGMuc2xpY2UoMCwgMykgKyBcIilcIiA6IFwicmdiYShcIiArIGMgKyBcIilcIlxufVxuXG52YXIgcGFyc2VMZW5ndGggPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIikgcmV0dXJuIG5vcm1hbGl6ZSA/IFwiMHB4XCIgOiBcIlwiXG4gICAgdmFyIG1hdGNoID0gbWF0Y2hTdHJpbmcodmFsdWUsIHJMZW5ndGhOdW0pXG4gICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0gKyAobWF0Y2hbMl0gfHwgXCJweFwiKSA6IHZhbHVlIC8vIGNhbm5vdCBiZSBwYXJzZWQuIHByb2JhYmx5IFwiYXV0b1wiXG59XG5cbnZhciBwYXJzZUJvcmRlclN0eWxlID0gZnVuY3Rpb24odmFsdWUsIG5vcm1hbGl6ZSl7XG4gICAgaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUgPT09IFwiXCIpIHJldHVybiBub3JtYWxpemUgPyBcIm5vbmVcIiA6IFwiXCJcbiAgICB2YXIgbWF0Y2ggPSB2YWx1ZS5tYXRjaChyQm9yZGVyU3R5bGUpXG4gICAgcmV0dXJuIG1hdGNoID8gdmFsdWUgOiBub3JtYWxpemUgPyBcIm5vbmVcIiA6IFwiXCJcbn1cblxudmFyIHBhcnNlQm9yZGVyID0gZnVuY3Rpb24odmFsdWUsIG5vcm1hbGl6ZSl7XG4gICAgdmFyIG5vcm1hbGl6ZWQgPSBcIjBweCBub25lIHJnYmEoMCwwLDAsMSlcIlxuICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09PSBcIlwiKSAgICAgcmV0dXJuIG5vcm1hbGl6ZSA/IG5vcm1hbGl6ZWQgOiBcIlwiXG4gICAgaWYgKHZhbHVlID09PSAwICAgfHwgdmFsdWUgPT09IFwibm9uZVwiKSByZXR1cm4gbm9ybWFsaXplID8gbm9ybWFsaXplZCA6IHZhbHVlICsgXCJcIlxuXG4gICAgdmFyIGNcbiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoY29sb3IueCwgZnVuY3Rpb24obWF0Y2gpe1xuICAgICAgICBjID0gbWF0Y2hcbiAgICAgICAgcmV0dXJuIFwiXCJcbiAgICB9KVxuXG4gICAgdmFyIHMgPSB2YWx1ZS5tYXRjaChyQm9yZGVyU3R5bGUpLFxuICAgICAgICBsID0gdmFsdWUubWF0Y2gocmdMZW5ndGhOdW0pXG5cbiAgICByZXR1cm4gY2xlYW4oW1xuICAgICAgICBwYXJzZUxlbmd0aChsID8gbFswXSA6IFwiXCIsIG5vcm1hbGl6ZSksXG4gICAgICAgIHBhcnNlQm9yZGVyU3R5bGUocyA/IHNbMF0gOiBcIlwiLCBub3JtYWxpemUpLFxuICAgICAgICBwYXJzZUNvbG9yKGMsIG5vcm1hbGl6ZSlcbiAgICBdLmpvaW4oXCIgXCIpKVxufVxuXG52YXIgcGFyc2VTaG9ydDQgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIikgcmV0dXJuIG5vcm1hbGl6ZSA/IFwiMHB4IDBweCAwcHggMHB4XCIgOiBcIlwiXG4gICAgcmV0dXJuIGNsZWFuKG1pcnJvcjQobWFwKGNsZWFuKHZhbHVlKS5zcGxpdChcIiBcIiksIGZ1bmN0aW9uKHYpe1xuICAgICAgICByZXR1cm4gcGFyc2VMZW5ndGgodiwgbm9ybWFsaXplKVxuICAgIH0pKS5qb2luKFwiIFwiKSlcbn1cblxudmFyIHBhcnNlU2hhZG93ID0gZnVuY3Rpb24odmFsdWUsIG5vcm1hbGl6ZSwgbGVuKXtcbiAgICB2YXIgdHJhbnNwYXJlbnQgPSBcInJnYmEoMCwwLDAsMClcIixcbiAgICAgICAgbm9ybWFsaXplZCAgPSAobGVuID09PSAzKSA/IHRyYW5zcGFyZW50ICsgXCIgMHB4IDBweCAwcHhcIiA6IHRyYW5zcGFyZW50ICsgXCIgMHB4IDBweCAwcHggMHB4XCJcblxuICAgIGlmICh2YWx1ZSA9PSAgbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIikgcmV0dXJuIG5vcm1hbGl6ZSA/IG5vcm1hbGl6ZWQgOiBcIlwiXG4gICAgaWYgKHZhbHVlID09PSBcIm5vbmVcIikgcmV0dXJuIG5vcm1hbGl6ZSA/IG5vcm1hbGl6ZWQgOiB2YWx1ZVxuXG4gICAgdmFyIGNvbG9ycyA9IFtdLCB2YWx1ZSA9IGNsZWFuKHZhbHVlKS5yZXBsYWNlKGNvbG9yLngsIGZ1bmN0aW9uKG1hdGNoKXtcbiAgICAgICAgY29sb3JzLnB1c2gobWF0Y2gpXG4gICAgICAgIHJldHVybiBcIlwiXG4gICAgfSlcblxuICAgIHJldHVybiBtYXAodmFsdWUuc3BsaXQoXCIsXCIpLCBmdW5jdGlvbihzaGFkb3csIGkpe1xuXG4gICAgICAgIHZhciBjICAgICAgID0gcGFyc2VDb2xvcihjb2xvcnNbaV0sIG5vcm1hbGl6ZSksXG4gICAgICAgICAgICBpbnNldCAgID0gL2luc2V0Ly50ZXN0KHNoYWRvdyksXG4gICAgICAgICAgICBsZW5ndGhzID0gc2hhZG93Lm1hdGNoKHJnTGVuZ3RoTnVtKSB8fCBbXCIwcHhcIl1cblxuICAgICAgICBsZW5ndGhzID0gbWFwKGxlbmd0aHMsIGZ1bmN0aW9uKG0pe1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlTGVuZ3RoKG0sIG5vcm1hbGl6ZSlcbiAgICAgICAgfSlcblxuICAgICAgICB3aGlsZSAobGVuZ3Rocy5sZW5ndGggPCBsZW4pIGxlbmd0aHMucHVzaChcIjBweFwiKVxuXG4gICAgICAgIHZhciByZXQgPSBpbnNldCA/IFtcImluc2V0XCIsIGNdIDogW2NdXG5cbiAgICAgICAgcmV0dXJuIHJldC5jb25jYXQobGVuZ3Rocykuam9pbihcIiBcIilcblxuICAgIH0pLmpvaW4oXCIsIFwiKVxufVxuXG52YXIgcGFyc2UgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIikgcmV0dXJuIFwiXCIgLy8gY2FudCBub3JtYWxpemUgXCJcIiB8fCBudWxsXG4gICAgcmV0dXJuIHZhbHVlLnJlcGxhY2UoY29sb3IueCwgZnVuY3Rpb24obWF0Y2gpe1xuICAgICAgICByZXR1cm4gcGFyc2VDb2xvcihtYXRjaCwgbm9ybWFsaXplKVxuICAgIH0pLnJlcGxhY2UocmdMZW5ndGgsIGZ1bmN0aW9uKG1hdGNoKXtcbiAgICAgICAgcmV0dXJuIHBhcnNlTGVuZ3RoKG1hdGNoLCBub3JtYWxpemUpXG4gICAgfSlcbn1cblxuLy8gZ2V0ICYmIHNldFxuXG52YXIgZ2V0dGVycyA9IHt9LCBzZXR0ZXJzID0ge30sIHBhcnNlcnMgPSB7fSwgYWxpYXNlcyA9IHt9XG5cbnZhciBnZXR0ZXIgPSBmdW5jdGlvbihrZXkpe1xuICAgIHJldHVybiBnZXR0ZXJzW2tleV0gfHwgKGdldHRlcnNba2V5XSA9IChmdW5jdGlvbigpe1xuICAgICAgICB2YXIgYWxpYXMgID0gYWxpYXNlc1trZXldIHx8IGtleSxcbiAgICAgICAgICAgIHBhcnNlciA9IHBhcnNlcnNba2V5XSB8fCBwYXJzZVxuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlcihjb21wdXRlKHRoaXMpKGFsaWFzKSwgdHJ1ZSlcbiAgICAgICAgfVxuXG4gICAgfSgpKSlcbn1cblxudmFyIHNldHRlciA9IGZ1bmN0aW9uKGtleSl7XG4gICAgcmV0dXJuIHNldHRlcnNba2V5XSB8fCAoc2V0dGVyc1trZXldID0gKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgdmFyIGFsaWFzICA9IGFsaWFzZXNba2V5XSB8fCBrZXksXG4gICAgICAgICAgICBwYXJzZXIgPSBwYXJzZXJzW2tleV0gfHwgcGFyc2VcblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgdGhpcy5zdHlsZVthbGlhc10gPSBwYXJzZXIodmFsdWUsIGZhbHNlKVxuICAgICAgICB9XG5cbiAgICB9KCkpKVxufVxuXG4vLyBwYXJzZXJzXG5cbnZhciB0cmJsID0gW1wiVG9wXCIsIFwiUmlnaHRcIiwgXCJCb3R0b21cIiwgXCJMZWZ0XCJdLCB0bGJsID0gW1wiVG9wTGVmdFwiLCBcIlRvcFJpZ2h0XCIsIFwiQm90dG9tUmlnaHRcIiwgXCJCb3R0b21MZWZ0XCJdXG5cbmZvckVhY2godHJibCwgZnVuY3Rpb24oZCl7XG4gICAgdmFyIGJkID0gXCJib3JkZXJcIiArIGRcbiAgICBmb3JFYWNoKFsgXCJtYXJnaW5cIiArIGQsIFwicGFkZGluZ1wiICsgZCwgYmQgKyBcIldpZHRoXCIsIGQudG9Mb3dlckNhc2UoKV0sIGZ1bmN0aW9uKG4pe1xuICAgICAgICBwYXJzZXJzW25dID0gcGFyc2VMZW5ndGhcbiAgICB9KVxuICAgIHBhcnNlcnNbYmQgKyBcIkNvbG9yXCJdID0gcGFyc2VDb2xvclxuICAgIHBhcnNlcnNbYmQgKyBcIlN0eWxlXCJdID0gcGFyc2VCb3JkZXJTdHlsZVxuXG4gICAgLy8gYm9yZGVyRElSXG4gICAgcGFyc2Vyc1tiZF0gPSBwYXJzZUJvcmRlclxuICAgIGdldHRlcnNbYmRdID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIGdldHRlcihiZCArIFwiV2lkdGhcIikuY2FsbCh0aGlzKSxcbiAgICAgICAgICAgIGdldHRlcihiZCArIFwiU3R5bGVcIikuY2FsbCh0aGlzKSxcbiAgICAgICAgICAgIGdldHRlcihiZCArIFwiQ29sb3JcIikuY2FsbCh0aGlzKVxuICAgICAgICBdLmpvaW4oXCIgXCIpXG4gICAgfVxufSlcblxuZm9yRWFjaCh0bGJsLCBmdW5jdGlvbihkKXtcbiAgICBwYXJzZXJzW1wiYm9yZGVyXCIgKyBkICsgXCJSYWRpdXNcIl0gPSBwYXJzZUxlbmd0aFxufSlcblxucGFyc2Vycy5jb2xvciA9IHBhcnNlcnMuYmFja2dyb3VuZENvbG9yID0gcGFyc2VDb2xvclxucGFyc2Vycy53aWR0aCA9IHBhcnNlcnMuaGVpZ2h0ID0gcGFyc2Vycy5taW5XaWR0aCA9IHBhcnNlcnMubWluSGVpZ2h0ID0gcGFyc2Vycy5tYXhXaWR0aCA9IHBhcnNlcnMubWF4SGVpZ2h0ID0gcGFyc2Vycy5mb250U2l6ZSA9IHBhcnNlcnMuYmFja2dyb3VuZFNpemUgPSBwYXJzZUxlbmd0aFxuXG4vLyBtYXJnaW4gKyBwYWRkaW5nXG5cbmZvckVhY2goW1wibWFyZ2luXCIsIFwicGFkZGluZ1wiXSwgZnVuY3Rpb24obmFtZSl7XG4gICAgcGFyc2Vyc1tuYW1lXSA9IHBhcnNlU2hvcnQ0XG4gICAgZ2V0dGVyc1tuYW1lXSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBtYXAodHJibCwgZnVuY3Rpb24oZCl7XG4gICAgICAgICAgICByZXR1cm4gZ2V0dGVyKG5hbWUgKyBkKS5jYWxsKHRoaXMpXG4gICAgICAgIH0sIHRoaXMpLmpvaW4oXCIgXCIpXG4gICAgfVxufSlcblxuLy8gYm9yZGVyc1xuXG4vLyBib3JkZXJESVJXaWR0aCwgYm9yZGVyRElSU3R5bGUsIGJvcmRlckRJUkNvbG9yXG5cbnBhcnNlcnMuYm9yZGVyV2lkdGggPSBwYXJzZVNob3J0NFxuXG5wYXJzZXJzLmJvcmRlclN0eWxlID0gZnVuY3Rpb24odmFsdWUsIG5vcm1hbGl6ZSl7XG4gICAgaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUgPT09IFwiXCIpIHJldHVybiBub3JtYWxpemUgPyBtaXJyb3I0KFtcIm5vbmVcIl0pLmpvaW4oXCIgXCIpIDogXCJcIlxuICAgIHZhbHVlID0gY2xlYW4odmFsdWUpLnNwbGl0KFwiIFwiKVxuICAgIHJldHVybiBjbGVhbihtaXJyb3I0KG1hcCh2YWx1ZSwgZnVuY3Rpb24odil7XG4gICAgICAgIHBhcnNlQm9yZGVyU3R5bGUodiwgbm9ybWFsaXplKVxuICAgIH0pKS5qb2luKFwiIFwiKSlcbn1cblxucGFyc2Vycy5ib3JkZXJDb2xvciA9IGZ1bmN0aW9uKHZhbHVlLCBub3JtYWxpemUpe1xuICAgIGlmICghdmFsdWUgfHwgISh2YWx1ZSA9IG1hdGNoU3RyaW5nKHZhbHVlLCBjb2xvci54KSkpIHJldHVybiBub3JtYWxpemUgPyBtaXJyb3I0KFtcInJnYmEoMCwwLDAsMSlcIl0pLmpvaW4oXCIgXCIpIDogXCJcIlxuICAgIHJldHVybiBjbGVhbihtaXJyb3I0KG1hcCh2YWx1ZSwgZnVuY3Rpb24odil7XG4gICAgICAgIHJldHVybiBwYXJzZUNvbG9yKHYsIG5vcm1hbGl6ZSlcbiAgICB9KSkuam9pbihcIiBcIikpXG59XG5cbmZvckVhY2goW1wiV2lkdGhcIiwgXCJTdHlsZVwiLCBcIkNvbG9yXCJdLCBmdW5jdGlvbihuYW1lKXtcbiAgICBnZXR0ZXJzW1wiYm9yZGVyXCIgKyBuYW1lXSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBtYXAodHJibCwgZnVuY3Rpb24oZCl7XG4gICAgICAgICAgICByZXR1cm4gZ2V0dGVyKFwiYm9yZGVyXCIgKyBkICsgbmFtZSkuY2FsbCh0aGlzKVxuICAgICAgICB9LCB0aGlzKS5qb2luKFwiIFwiKVxuICAgIH1cbn0pXG5cbi8vIGJvcmRlclJhZGl1c1xuXG5wYXJzZXJzLmJvcmRlclJhZGl1cyA9IHBhcnNlU2hvcnQ0XG5cbmdldHRlcnMuYm9yZGVyUmFkaXVzID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gbWFwKHRsYmwsIGZ1bmN0aW9uKGQpe1xuICAgICAgICByZXR1cm4gZ2V0dGVyKFwiYm9yZGVyXCIgKyBkICsgXCJSYWRpdXNcIikuY2FsbCh0aGlzKVxuICAgIH0sIHRoaXMpLmpvaW4oXCIgXCIpXG59XG5cbi8vIGJvcmRlclxuXG5wYXJzZXJzLmJvcmRlciA9IHBhcnNlQm9yZGVyXG5cbmdldHRlcnMuYm9yZGVyID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgcHZhbHVlXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0cmJsLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgdmFyIHZhbHVlID0gZ2V0dGVyKFwiYm9yZGVyXCIgKyB0cmJsW2ldKS5jYWxsKHRoaXMpXG4gICAgICAgIGlmIChwdmFsdWUgJiYgdmFsdWUgIT09IHB2YWx1ZSkgcmV0dXJuIG51bGxcbiAgICAgICAgcHZhbHVlID0gdmFsdWVcbiAgICB9XG4gICAgcmV0dXJuIHB2YWx1ZVxufVxuXG4vLyB6SW5kZXhcblxucGFyc2Vycy56SW5kZXggPSBwYXJzZVN0cmluZ1xuXG4vLyBvcGFjaXR5XG5cbnBhcnNlcnMub3BhY2l0eSA9IHBhcnNlT3BhY2l0eVxuXG4vKihjc3MzKT8qL1xuXG52YXIgZmlsdGVyTmFtZSA9ICh0ZXN0LnN0eWxlLk1zRmlsdGVyICE9IG51bGwgJiYgXCJNc0ZpbHRlclwiKSB8fCAodGVzdC5zdHlsZS5maWx0ZXIgIT0gbnVsbCAmJiBcImZpbHRlclwiKVxuXG5pZiAoZmlsdGVyTmFtZSAmJiB0ZXN0LnN0eWxlLm9wYWNpdHkgPT0gbnVsbCl7XG5cbiAgICB2YXIgbWF0Y2hPcCA9IC9hbHBoYVxcKG9wYWNpdHk9KFtcXGQuXSspXFwpL2lcblxuICAgIHNldHRlcnMub3BhY2l0eSA9IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgdmFsdWUgPSAoKHZhbHVlID0gcGFyc2VPcGFjaXR5KHZhbHVlKSkgPT09IFwiMVwiKSA/IFwiXCIgOiBcImFscGhhKG9wYWNpdHk9XCIgKyBNYXRoLnJvdW5kKHZhbHVlICogMTAwKSArIFwiKVwiXG4gICAgICAgIHZhciBmaWx0ZXIgPSBjb21wdXRlKHRoaXMpKGZpbHRlck5hbWUpXG4gICAgICAgIHJldHVybiB0aGlzLnN0eWxlW2ZpbHRlck5hbWVdID0gbWF0Y2hPcC50ZXN0KGZpbHRlcikgPyBmaWx0ZXIucmVwbGFjZShtYXRjaE9wLCB2YWx1ZSkgOiBmaWx0ZXIgKyBcIiBcIiArIHZhbHVlXG4gICAgfVxuXG4gICAgZ2V0dGVycy5vcGFjaXR5ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG1hdGNoID0gY29tcHV0ZSh0aGlzKShmaWx0ZXJOYW1lKS5tYXRjaChtYXRjaE9wKVxuICAgICAgICByZXR1cm4gKCFtYXRjaCA/IDEgOiBtYXRjaFsxXSAvIDEwMCkgKyBcIlwiXG4gICAgfVxuXG59Lyo6Ki9cblxudmFyIHBhcnNlQm94U2hhZG93ID0gcGFyc2Vycy5ib3hTaGFkb3cgPSBmdW5jdGlvbih2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICByZXR1cm4gcGFyc2VTaGFkb3codmFsdWUsIG5vcm1hbGl6ZSwgNClcbn1cblxudmFyIHBhcnNlVGV4dFNoYWRvdyA9IHBhcnNlcnMudGV4dFNoYWRvdyA9IGZ1bmN0aW9uKHZhbHVlLCBub3JtYWxpemUpe1xuICAgIHJldHVybiBwYXJzZVNoYWRvdyh2YWx1ZSwgbm9ybWFsaXplLCAzKVxufVxuXG4vLyBBbGlhc2VzXG5cbmZvckVhY2goWydXZWJraXQnLCBcIk1velwiLCBcIm1zXCIsIFwiT1wiLCBudWxsXSwgZnVuY3Rpb24ocHJlZml4KXtcbiAgICBmb3JFYWNoKFtcbiAgICAgICAgXCJ0cmFuc2l0aW9uXCIsIFwidHJhbnNmb3JtXCIsIFwidHJhbnNmb3JtT3JpZ2luXCIsIFwidHJhbnNmb3JtU3R5bGVcIiwgXCJwZXJzcGVjdGl2ZVwiLCBcInBlcnNwZWN0aXZlT3JpZ2luXCIsIFwiYmFja2ZhY2VWaXNpYmlsaXR5XCJcbiAgICBdLCBmdW5jdGlvbihzdHlsZSl7XG4gICAgICAgIHZhciBjYyA9IHByZWZpeCA/IHByZWZpeCArIGNhcGl0YWxpemUoc3R5bGUpIDogc3R5bGVcbiAgICAgICAgaWYgKHByZWZpeCA9PT0gXCJtc1wiKSBoeXBoZW5hdGVkW2NjXSA9IFwiLW1zLVwiICsgaHlwaGVuYXRlKHN0eWxlKVxuICAgICAgICBpZiAodGVzdC5zdHlsZVtjY10gIT0gbnVsbCkgYWxpYXNlc1tzdHlsZV0gPSBjY1xuICAgIH0pXG59KVxuXG52YXIgdHJhbnNpdGlvbk5hbWUgPSBhbGlhc2VzLnRyYW5zaXRpb24sXG4gICAgdHJhbnNmb3JtTmFtZSAgPSBhbGlhc2VzLnRyYW5zZm9ybVxuXG4vLyBtYW51YWxseSBkaXNhYmxlIGNzczMgdHJhbnNpdGlvbnMgaW4gT3BlcmEsIGJlY2F1c2UgdGhleSBkbyBub3Qgd29yayBwcm9wZXJseS5cblxuaWYgKHRyYW5zaXRpb25OYW1lID09PSBcIk9UcmFuc2l0aW9uXCIpIHRyYW5zaXRpb25OYW1lID0gbnVsbFxuXG5cbi8vIHRoaXMgdGFrZXMgY2FyZSBvZiBtYXRyaXggZGVjb21wb3NpdGlvbiBvbiBicm93c2VycyB0aGF0IHN1cHBvcnQgb25seSAyZCB0cmFuc2Zvcm1zIGJ1dCBubyBDU1MzIHRyYW5zaXRpb25zLlxuLy8gYmFzaWNhbGx5LCBJRTkgKGFuZCBPcGVyYSBhcyB3ZWxsLCBzaW5jZSB3ZSBkaXNhYmxlZCBDU1MzIHRyYW5zaXRpb25zIG1hbnVhbGx5KVxuXG52YXIgcGFyc2VUcmFuc2Zvcm0yZCwgVHJhbnNmb3JtMmRcblxuLyooY3NzMyk/Ki9cblxuaWYgKCF0cmFuc2l0aW9uTmFtZSAmJiB0cmFuc2Zvcm1OYW1lKSAoZnVuY3Rpb24oKXtcblxuICAgIHZhciB1bm1hdHJpeCA9IHJlcXVpcmUoXCIuL3VubWF0cml4MmRcIilcblxuICAgIHZhciB2ID0gXCJcXFxccyooWy1cXFxcZFxcXFx3Ll0rKVxcXFxzKlwiXG5cbiAgICB2YXIgck1hdHJpeCA9IFJlZ0V4cChcIm1hdHJpeFxcXFwoXCIgKyBbdiwgdiwgdiwgdiwgdiwgdl0gKyBcIlxcXFwpXCIpXG5cbiAgICB2YXIgZGVjb21wb3NlTWF0cml4ID0gZnVuY3Rpb24obWF0cml4KXtcblxuICAgICAgICB2YXIgZCA9IHVubWF0cml4LmFwcGx5KG51bGwsIG1hdHJpeC5tYXRjaChyTWF0cml4KS5zbGljZSgxKSkgfHwgW1swLCAwXSwgMCwgMCwgWzAsIDBdXVxuXG4gICAgICAgIHJldHVybiBbXG5cbiAgICAgICAgICAgIFwidHJhbnNsYXRlKFwiICsgbWFwKGRbMF0sIGZ1bmN0aW9uKHYpe3JldHVybiByb3VuZCh2KSArIFwicHhcIn0pICsgXCIpXCIsXG4gICAgICAgICAgICBcInJvdGF0ZShcIiArIHJvdW5kKGRbMV0gKiAxODAgLyBNYXRoLlBJKSArIFwiZGVnKVwiLFxuICAgICAgICAgICAgXCJza2V3WChcIiArIHJvdW5kKGRbMl0gKiAxODAgLyBNYXRoLlBJKSArIFwiZGVnKVwiLFxuICAgICAgICAgICAgXCJzY2FsZShcIiArIG1hcChkWzNdLCByb3VuZCkgKyBcIilcIlxuXG4gICAgICAgIF0uam9pbihcIiBcIilcblxuICAgIH1cblxuICAgIHZhciBkZWYwcHggID0gZnVuY3Rpb24odmFsdWUpe3JldHVybiB2YWx1ZSB8fCBcIjBweFwifSxcbiAgICAgICAgZGVmMSAgICA9IGZ1bmN0aW9uKHZhbHVlKXtyZXR1cm4gdmFsdWUgfHwgXCIxXCJ9LFxuICAgICAgICBkZWYwZGVnID0gZnVuY3Rpb24odmFsdWUpe3JldHVybiB2YWx1ZSB8fCBcIjBkZWdcIn1cblxuICAgIHZhciB0cmFuc2Zvcm1zID0ge1xuXG4gICAgICAgIHRyYW5zbGF0ZTogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgaWYgKCF2YWx1ZSkgdmFsdWUgPSBcIjBweCwwcHhcIlxuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IHZhbHVlLnNwbGl0KFwiLFwiKVxuICAgICAgICAgICAgaWYgKCF2YWx1ZXNbMV0pIHZhbHVlc1sxXSA9IFwiMHB4XCJcbiAgICAgICAgICAgIHJldHVybiBtYXAodmFsdWVzLCBjbGVhbikgKyBcIlwiXG4gICAgICAgIH0sXG4gICAgICAgIHRyYW5zbGF0ZVg6IGRlZjBweCxcbiAgICAgICAgdHJhbnNsYXRlWTogZGVmMHB4LFxuICAgICAgICBzY2FsZTogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgaWYgKCF2YWx1ZSkgdmFsdWUgPSBcIjEsMVwiXG4gICAgICAgICAgICB2YXIgdmFsdWVzID0gdmFsdWUuc3BsaXQoXCIsXCIpXG4gICAgICAgICAgICBpZiAoIXZhbHVlc1sxXSkgdmFsdWVzWzFdID0gdmFsdWVzWzBdXG4gICAgICAgICAgICByZXR1cm4gbWFwKHZhbHVlcywgY2xlYW4pICsgXCJcIlxuICAgICAgICB9LFxuICAgICAgICBzY2FsZVg6IGRlZjEsXG4gICAgICAgIHNjYWxlWTogZGVmMSxcbiAgICAgICAgcm90YXRlOiBkZWYwZGVnLFxuICAgICAgICBza2V3WDogZGVmMGRlZyxcbiAgICAgICAgc2tld1k6IGRlZjBkZWdcblxuICAgIH1cblxuICAgIFRyYW5zZm9ybTJkID0gcHJpbWUoe1xuXG4gICAgICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbih0cmFuc2Zvcm0pe1xuXG4gICAgICAgICAgICB2YXIgbmFtZXMgPSB0aGlzLm5hbWVzID0gW11cbiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcyA9IFtdXG5cbiAgICAgICAgICAgIHRyYW5zZm9ybS5yZXBsYWNlKC8oXFx3KylcXCgoWy0uXFxkXFxzXFx3LF0rKVxcKS9nLCBmdW5jdGlvbihtYXRjaCwgbmFtZSwgdmFsdWUpe1xuICAgICAgICAgICAgICAgIG5hbWVzLnB1c2gobmFtZSlcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSlcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfSxcblxuICAgICAgICBpZGVudGl0eTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBmdW5jdGlvbnMgPSBbXVxuICAgICAgICAgICAgZm9yRWFjaCh0aGlzLm5hbWVzLCBmdW5jdGlvbihuYW1lKXtcbiAgICAgICAgICAgICAgICB2YXIgZm4gPSB0cmFuc2Zvcm1zW25hbWVdXG4gICAgICAgICAgICAgICAgaWYgKGZuKSBmdW5jdGlvbnMucHVzaChuYW1lICsgXCIoXCIgKyBmbigpICsgXCIpXCIpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9ucy5qb2luKFwiIFwiKVxuICAgICAgICB9LFxuXG4gICAgICAgIHNhbWVUeXBlOiBmdW5jdGlvbih0cmFuc2Zvcm1PYmplY3Qpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZXMudG9TdHJpbmcoKSA9PT0gdHJhbnNmb3JtT2JqZWN0Lm5hbWVzLnRvU3RyaW5nKClcbiAgICAgICAgfSxcblxuICAgICAgICAvLyB0aGlzIGlzLCBiYXNpY2FsbHksIGNoZWF0aW5nLlxuICAgICAgICAvLyByZXRyaWV2aW5nIHRoZSBtYXRyaXggdmFsdWUgZnJvbSB0aGUgZG9tLCByYXRoZXIgdGhhbiBjYWxjdWxhdGluZyBpdFxuXG4gICAgICAgIGRlY29tcG9zZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciB0cmFuc2Zvcm0gPSB0aGlzLnRvU3RyaW5nKClcblxuICAgICAgICAgICAgdGVzdC5zdHlsZS5jc3NUZXh0ID0gY3NzVGV4dCArIGh5cGhlbmF0ZSh0cmFuc2Zvcm1OYW1lKSArIFwiOlwiICsgdHJhbnNmb3JtICsgXCI7XCJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGVzdClcbiAgICAgICAgICAgIHZhciBtID0gY29tcHV0ZSh0ZXN0KSh0cmFuc2Zvcm1OYW1lKVxuICAgICAgICAgICAgaWYgKCFtIHx8IG0gPT09IFwibm9uZVwiKSBtID0gXCJtYXRyaXgoMSwgMCwgMCwgMSwgMCwgMClcIlxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXN0KVxuICAgICAgICAgICAgcmV0dXJuIGRlY29tcG9zZU1hdHJpeChtKVxuICAgICAgICB9XG5cbiAgICB9KVxuXG4gICAgVHJhbnNmb3JtMmQucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oY2xlYW4pe1xuICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXMsIGZ1bmN0aW9ucyA9IFtdXG4gICAgICAgIGZvckVhY2godGhpcy5uYW1lcywgZnVuY3Rpb24obmFtZSwgaSl7XG4gICAgICAgICAgICB2YXIgZm4gPSB0cmFuc2Zvcm1zW25hbWVdXG4gICAgICAgICAgICBpZiAoIWZuKSByZXR1cm5cbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGZuKHZhbHVlc1tpXSlcbiAgICAgICAgICAgIGlmICghY2xlYW4gfHwgdmFsdWUgIT09IGZuKCkpIGZ1bmN0aW9ucy5wdXNoKG5hbWUgKyBcIihcIiArIHZhbHVlICsgXCIpXCIpXG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiBmdW5jdGlvbnMubGVuZ3RoID8gZnVuY3Rpb25zLmpvaW4oXCIgXCIpIDogXCJub25lXCJcbiAgICB9XG5cbiAgICBUcmFuc2Zvcm0yZC51bmlvbiA9IGZ1bmN0aW9uKGZyb20sIHRvKXtcblxuICAgICAgICBpZiAoZnJvbSA9PT0gdG8pIHJldHVybiAvLyBub3RoaW5nIHRvIGRvXG5cbiAgICAgICAgdmFyIGZyb21NYXAsIHRvTWFwXG5cbiAgICAgICAgaWYgKGZyb20gPT09IFwibm9uZVwiKXtcblxuICAgICAgICAgICAgdG9NYXAgICA9IG5ldyBUcmFuc2Zvcm0yZCh0bylcbiAgICAgICAgICAgIHRvICAgICAgPSB0b01hcC50b1N0cmluZygpXG4gICAgICAgICAgICBmcm9tICAgID0gdG9NYXAuaWRlbnRpdHkoKVxuICAgICAgICAgICAgZnJvbU1hcCA9IG5ldyBUcmFuc2Zvcm0yZChmcm9tKVxuXG4gICAgICAgIH0gZWxzZSBpZiAodG8gPT09IFwibm9uZVwiKXtcblxuICAgICAgICAgICAgZnJvbU1hcCA9IG5ldyBUcmFuc2Zvcm0yZChmcm9tKVxuICAgICAgICAgICAgZnJvbSAgICA9IGZyb21NYXAudG9TdHJpbmcoKVxuICAgICAgICAgICAgdG8gICAgICA9IGZyb21NYXAuaWRlbnRpdHkoKVxuICAgICAgICAgICAgdG9NYXAgICA9IG5ldyBUcmFuc2Zvcm0yZCh0bylcblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICBmcm9tTWFwID0gbmV3IFRyYW5zZm9ybTJkKGZyb20pXG4gICAgICAgICAgICBmcm9tICAgID0gZnJvbU1hcC50b1N0cmluZygpXG4gICAgICAgICAgICB0b01hcCAgID0gbmV3IFRyYW5zZm9ybTJkKHRvKVxuICAgICAgICAgICAgdG8gICAgICA9IHRvTWFwLnRvU3RyaW5nKClcblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGZyb20gPT09IHRvKSByZXR1cm4gLy8gbm90aGluZyB0byBkb1xuXG4gICAgICAgIGlmICghZnJvbU1hcC5zYW1lVHlwZSh0b01hcCkpe1xuXG4gICAgICAgICAgICBmcm9tID0gZnJvbU1hcC5kZWNvbXBvc2UoKVxuICAgICAgICAgICAgdG8gICA9IHRvTWFwLmRlY29tcG9zZSgpXG5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmcm9tID09PSB0bykgcmV0dXJuIC8vIG5vdGhpbmcgdG8gZG9cblxuICAgICAgICByZXR1cm4gW2Zyb20sIHRvXVxuXG4gICAgfVxuXG4gICAgLy8gdGhpcyBwYXJzZXIgbWFrZXMgc3VyZSBpdCBuZXZlciBnZXRzIFwibWF0cml4XCJcblxuICAgIHBhcnNlVHJhbnNmb3JtMmQgPSBwYXJzZXJzLnRyYW5zZm9ybSA9IGZ1bmN0aW9uKHRyYW5zZm9ybSl7XG4gICAgICAgIGlmICghdHJhbnNmb3JtIHx8IHRyYW5zZm9ybSA9PT0gXCJub25lXCIpIHJldHVybiBcIm5vbmVcIlxuICAgICAgICByZXR1cm4gbmV3IFRyYW5zZm9ybTJkKHJNYXRyaXgudGVzdCh0cmFuc2Zvcm0pID8gZGVjb21wb3NlTWF0cml4KHRyYW5zZm9ybSkgOiB0cmFuc2Zvcm0pLnRvU3RyaW5nKHRydWUpXG4gICAgfVxuXG4gICAgLy8gdGhpcyBnZXR0ZXIgbWFrZXMgc3VyZSB3ZSByZWFkIGZyb20gdGhlIGRvbSBvbmx5IHRoZSBmaXJzdCB0aW1lXG4gICAgLy8gdGhpcyB3YXkgd2Ugc2F2ZSB0aGUgYWN0dWFsIHRyYW5zZm9ybSBhbmQgbm90IFwibWF0cml4XCJcbiAgICAvLyBzZXR0aW5nIG1hdHJpeCgpIHdpbGwgdXNlIHBhcnNlVHJhbnNmb3JtMmQgYXMgd2VsbCwgdGh1cyBzZXR0aW5nIHRoZSBkZWNvbXBvc2VkIG1hdHJpeFxuXG4gICAgZ2V0dGVycy50cmFuc2Zvcm0gPSBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgcyA9IHRoaXMuc3R5bGVcbiAgICAgICAgcmV0dXJuIHNbdHJhbnNmb3JtTmFtZV0gfHwgKHNbdHJhbnNmb3JtTmFtZV0gPSBwYXJzZVRyYW5zZm9ybTJkKGNvbXB1dGUodGhpcykodHJhbnNmb3JtTmFtZSkpKVxuICAgIH1cblxuXG59KSgpLyo6Ki9cblxuLy8gdHJpZXMgdG8gbWF0Y2ggZnJvbSBhbmQgdG8gdmFsdWVzXG5cbnZhciBwcmVwYXJlID0gZnVuY3Rpb24obm9kZSwgcHJvcGVydHksIHRvKXtcblxuICAgIHZhciBwYXJzZXIgPSBwYXJzZXJzW3Byb3BlcnR5XSB8fCBwYXJzZSxcbiAgICAgICAgZnJvbSAgID0gZ2V0dGVyKHByb3BlcnR5KS5jYWxsKG5vZGUpLCAvLyBcIm5vcm1hbGl6ZWRcIiBieSB0aGUgZ2V0dGVyXG4gICAgICAgIHRvICAgICA9IHBhcnNlcih0bywgdHJ1ZSkgLy8gbm9ybWFsaXplIHBhcnNlZCBwcm9wZXJ0eVxuXG4gICAgaWYgKGZyb20gPT09IHRvKSByZXR1cm5cblxuICAgIGlmIChwYXJzZXIgPT09IHBhcnNlTGVuZ3RoIHx8IHBhcnNlciA9PT0gcGFyc2VCb3JkZXIgfHwgcGFyc2VyID09PSBwYXJzZVNob3J0NCl7XG5cbiAgICAgICAgdmFyIHRvQWxsID0gdG8ubWF0Y2gocmdMZW5ndGgpLCBpID0gMCAvLyB0aGlzIHNob3VsZCBhbHdheXMgbWF0Y2ggc29tZXRoaW5nXG5cbiAgICAgICAgaWYgKHRvQWxsKSBmcm9tID0gZnJvbS5yZXBsYWNlKHJnTGVuZ3RoLCBmdW5jdGlvbihmcm9tRnVsbCwgZnJvbVZhbHVlLCBmcm9tVW5pdCl7XG5cbiAgICAgICAgICAgIHZhciB0b0Z1bGwgICAgPSB0b0FsbFtpKytdLFxuICAgICAgICAgICAgICAgIHRvTWF0Y2hlZCA9IHRvRnVsbC5tYXRjaChyTGVuZ3RoTnVtKSxcbiAgICAgICAgICAgICAgICB0b1VuaXQgICAgPSB0b01hdGNoZWRbMl1cblxuICAgICAgICAgICAgaWYgKGZyb21Vbml0ICE9PSB0b1VuaXQpe1xuICAgICAgICAgICAgICAgIHZhciBmcm9tUGl4ZWxzID0gKGZyb21Vbml0ID09PSBcInB4XCIpID8gZnJvbVZhbHVlIDogcGl4ZWxSYXRpbyhub2RlLCBmcm9tVW5pdCkgKiBmcm9tVmFsdWVcbiAgICAgICAgICAgICAgICByZXR1cm4gcm91bmQoZnJvbVBpeGVscyAvIHBpeGVsUmF0aW8obm9kZSwgdG9Vbml0KSkgKyB0b1VuaXRcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZyb21GdWxsXG5cbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoaSA+IDApIHNldHRlcihwcm9wZXJ0eSkuY2FsbChub2RlLCBmcm9tKVxuXG4gICAgfS8qKGNzczMpPyovZWxzZSBpZiAocGFyc2VyID09PSBwYXJzZVRyYW5zZm9ybTJkKXsgLy8gSUU5L09wZXJhXG5cbiAgICAgICAgcmV0dXJuIFRyYW5zZm9ybTJkLnVuaW9uKGZyb20sIHRvKVxuXG4gICAgfS8qOiovXG5cbiAgICByZXR1cm4gKGZyb20gIT09IHRvKSA/IFtmcm9tLCB0b10gOiBudWxsXG5cbn1cblxuLy8gQnJvd3NlckFuaW1hdGlvblxuXG52YXIgQnJvd3NlckFuaW1hdGlvbiA9IHByaW1lKHtcblxuICAgIGluaGVyaXRzOiBmeCxcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBCcm93c2VyQW5pbWF0aW9uKG5vZGUsIHByb3BlcnR5KXtcblxuICAgICAgICB2YXIgX2dldHRlciA9IGdldHRlcihwcm9wZXJ0eSksXG4gICAgICAgICAgICBfc2V0dGVyID0gc2V0dGVyKHByb3BlcnR5KVxuXG4gICAgICAgIHRoaXMuZ2V0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBfZ2V0dGVyLmNhbGwobm9kZSlcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0ID0gZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgcmV0dXJuIF9zZXR0ZXIuY2FsbChub2RlLCB2YWx1ZSlcbiAgICAgICAgfVxuXG4gICAgICAgIEJyb3dzZXJBbmltYXRpb24ucGFyZW50LmNvbnN0cnVjdG9yLmNhbGwodGhpcywgdGhpcy5zZXQpXG5cbiAgICAgICAgdGhpcy5ub2RlID0gbm9kZVxuICAgICAgICB0aGlzLnByb3BlcnR5ID0gcHJvcGVydHlcblxuICAgIH1cblxufSlcblxudmFyIEpTQW5pbWF0aW9uXG5cbi8qKGNzczMpPyovXG5cbkpTQW5pbWF0aW9uID0gcHJpbWUoe1xuXG4gICAgaW5oZXJpdHM6IEJyb3dzZXJBbmltYXRpb24sXG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gSlNBbmltYXRpb24oKXtcbiAgICAgICAgcmV0dXJuIEpTQW5pbWF0aW9uLnBhcmVudC5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgfSxcblxuICAgIHN0YXJ0OiBmdW5jdGlvbih0byl7XG5cbiAgICAgICAgdGhpcy5zdG9wKClcblxuICAgICAgICBpZiAodGhpcy5kdXJhdGlvbiA9PT0gMCl7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbCh0bylcbiAgICAgICAgICAgIHJldHVybiB0aGlzXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZnJvbVRvID0gcHJlcGFyZSh0aGlzLm5vZGUsIHRoaXMucHJvcGVydHksIHRvKVxuXG4gICAgICAgIGlmICghZnJvbVRvKXtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsKHRvKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfVxuXG4gICAgICAgIEpTQW5pbWF0aW9uLnBhcmVudC5zdGFydC5hcHBseSh0aGlzLCBmcm9tVG8pXG5cbiAgICAgICAgaWYgKCF0aGlzLmNhbmNlbFN0ZXApIHJldHVybiB0aGlzXG5cbiAgICAgICAgLy8gdGhlIGFuaW1hdGlvbiB3b3VsZCBoYXZlIHN0YXJ0ZWQgYnV0IHdlIG5lZWQgYWRkaXRpb25hbCBjaGVja3NcblxuICAgICAgICB2YXIgcGFyc2VyID0gcGFyc2Vyc1t0aGlzLnByb3BlcnR5XSB8fCBwYXJzZVxuXG4gICAgICAgIC8vIGNvbXBsZXggaW50ZXJwb2xhdGlvbnMgSlNBbmltYXRpb24gY2FuJ3QgaGFuZGxlXG4gICAgICAgIC8vIGV2ZW4gQ1NTMyBhbmltYXRpb24gZ3JhY2VmdWxseSBmYWlsIHdpdGggc29tZSBvZiB0aG9zZSBlZGdlIGNhc2VzXG4gICAgICAgIC8vIG90aGVyIFwic2ltcGxlXCIgcHJvcGVydGllcywgc3VjaCBhcyBgYm9yZGVyYCBjYW4gaGF2ZSBkaWZmZXJlbnQgdGVtcGxhdGVzXG4gICAgICAgIC8vIGJlY2F1c2Ugb2Ygc3RyaW5nIHByb3BlcnRpZXMgbGlrZSBcInNvbGlkXCIgYW5kIFwiZGFzaGVkXCJcblxuICAgICAgICBpZiAoKHBhcnNlciA9PT0gcGFyc2VCb3hTaGFkb3cgfHwgcGFyc2VyID09PSBwYXJzZVRleHRTaGFkb3cgfHwgcGFyc2VyID09PSBwYXJzZSkgJiZcbiAgICAgICAgICAgICh0aGlzLnRlbXBsYXRlRnJvbSAhPT0gdGhpcy50ZW1wbGF0ZVRvKSl7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxTdGVwKClcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jYW5jZWxTdGVwXG4gICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwodG8pXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICBwYXJzZUVxdWF0aW9uOiBmdW5jdGlvbihlcXVhdGlvbil7XG4gICAgICAgIGlmICh0eXBlb2YgZXF1YXRpb24gPT09IFwic3RyaW5nXCIpIHJldHVybiBKU0FuaW1hdGlvbi5wYXJlbnQucGFyc2VFcXVhdGlvbi5jYWxsKHRoaXMsIGVxdWF0aW9uKVxuICAgIH1cblxuXG59KS8qOiovXG5cbi8vIENTU0FuaW1hdGlvblxuXG52YXIgcmVtb3ZlMyA9IGZ1bmN0aW9uKHZhbHVlLCBhLCBiLCBjKXtcbiAgICB2YXIgaW5kZXggPSBpbmRleE9mKGEsIHZhbHVlKVxuICAgIGlmIChpbmRleCAhPT0gLTEpe1xuICAgICAgICBhLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgYi5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICAgIGMuc3BsaWNlKGluZGV4LCAxKVxuICAgIH1cbn1cblxudmFyIENTU0FuaW1hdGlvbiA9IHByaW1lKHtcblxuICAgIGluaGVyaXRzOiBCcm93c2VyQW5pbWF0aW9uLFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uIENTU0FuaW1hdGlvbihub2RlLCBwcm9wZXJ0eSl7XG4gICAgICAgIENTU0FuaW1hdGlvbi5wYXJlbnQuY29uc3RydWN0b3IuY2FsbCh0aGlzLCBub2RlLCBwcm9wZXJ0eSlcblxuICAgICAgICB0aGlzLmhwcm9wZXJ0eSA9IGh5cGhlbmF0ZShhbGlhc2VzW3Byb3BlcnR5XSB8fCBwcm9wZXJ0eSlcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXNcblxuICAgICAgICB0aGlzLmJTZXRUcmFuc2l0aW9uQ1NTID0gZnVuY3Rpb24odGltZSl7XG4gICAgICAgICAgICBzZWxmLnNldFRyYW5zaXRpb25DU1ModGltZSlcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYlNldFN0eWxlQ1NTID0gZnVuY3Rpb24odGltZSl7XG4gICAgICAgICAgICBzZWxmLnNldFN0eWxlQ1NTKHRpbWUpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJDb21wbGV0ZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBzZWxmLmNvbXBsZXRlKClcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24odG8pe1xuXG4gICAgICAgIHRoaXMuc3RvcCgpXG5cbiAgICAgICAgaWYgKHRoaXMuZHVyYXRpb24gPT09IDApe1xuICAgICAgICAgICAgdGhpcy5jYW5jZWwodG8pXG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGZyb21UbyA9IHByZXBhcmUodGhpcy5ub2RlLCB0aGlzLnByb3BlcnR5LCB0bylcblxuICAgICAgICBpZiAoIWZyb21Ubyl7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbCh0bylcbiAgICAgICAgICAgIHJldHVybiB0aGlzXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRvID0gZnJvbVRvWzFdXG4gICAgICAgIC8vIHNldHRpbmcgdHJhbnNpdGlvbiBzdHlsZXMgaW1tZWRpYXRlbHkgd2lsbCBtYWtlIGdvb2QgYnJvd3NlcnMgYmVoYXZlIHdlaXJkbHlcbiAgICAgICAgLy8gYmVjYXVzZSBET00gY2hhbmdlcyBhcmUgYWx3YXlzIGRlZmVycmVkLCBzbyB3ZSByZXF1ZXN0RnJhbWVcbiAgICAgICAgdGhpcy5jYW5jZWxTZXRUcmFuc2l0aW9uQ1NTID0gcmVxdWVzdEZyYW1lKHRoaXMuYlNldFRyYW5zaXRpb25DU1MpXG5cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgc2V0VHJhbnNpdGlvbkNTUzogZnVuY3Rpb24odGltZSl7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbFNldFRyYW5zaXRpb25DU1NcbiAgICAgICAgdGhpcy5yZXNldENTUyh0cnVlKVxuICAgICAgICAvLyBmaXJlZm94IGZsaWNrZXJzIGlmIHdlIHNldCBjc3MgZm9yIHRyYW5zaXRpb24gYXMgd2VsbCBhcyBzdHlsZXMgYXQgdGhlIHNhbWUgdGltZVxuICAgICAgICAvLyBzbywgb3RoZXIgdGhhbiBkZWZlcnJpbmcgdHJhbnNpdGlvbiBzdHlsZXMgd2UgZGVmZXIgYWN0dWFsIHN0eWxlcyBhcyB3ZWxsIG9uIGEgcmVxdWVzdEZyYW1lXG4gICAgICAgIHRoaXMuY2FuY2VsU2V0U3R5bGVDU1MgPSByZXF1ZXN0RnJhbWUodGhpcy5iU2V0U3R5bGVDU1MpXG4gICAgfSxcblxuICAgIHNldFN0eWxlQ1NTOiBmdW5jdGlvbih0aW1lKXtcbiAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsU2V0U3R5bGVDU1NcbiAgICAgICAgdmFyIGR1cmF0aW9uID0gdGhpcy5kdXJhdGlvblxuICAgICAgICAvLyB3ZSB1c2Ugc2V0VGltZW91dCBpbnN0ZWFkIG9mIHRyYW5zaXRpb25FbmQgYmVjYXVzZSBzb21lIGJyb3dzZXJzIChsb29raW5nIGF0IHlvdSBmb3h5KVxuICAgICAgICAvLyBpbmNvcnJlY3RseSBzZXQgZXZlbnQucHJvcGVydHlOYW1lLCBzbyB3ZSBjYW5ub3QgY2hlY2sgd2hpY2ggYW5pbWF0aW9uIHdlIGFyZSBjYW5jZWxpbmdcbiAgICAgICAgdGhpcy5jYW5jZWxDb21wbGV0ZSA9IHNldFRpbWVvdXQodGhpcy5iQ29tcGxldGUsIGR1cmF0aW9uKVxuICAgICAgICB0aGlzLmVuZFRpbWUgPSB0aW1lICsgZHVyYXRpb25cbiAgICAgICAgdGhpcy5zZXQodGhpcy50bylcbiAgICB9LFxuXG4gICAgY29tcGxldGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbENvbXBsZXRlXG4gICAgICAgIHRoaXMucmVzZXRDU1MoKVxuICAgICAgICB0aGlzLmNhbGxiYWNrKHRoaXMuZW5kVGltZSlcbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oaGFyZCl7XG4gICAgICAgIGlmICh0aGlzLmNhbmNlbEV4aXQpe1xuICAgICAgICAgICAgdGhpcy5jYW5jZWxFeGl0KClcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbEV4aXRcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNhbmNlbFNldFRyYW5zaXRpb25DU1Mpe1xuICAgICAgICAgICAgLy8gaWYgY2FuY2VsU2V0VHJhbnNpdGlvbkNTUyBpcyBzZXQsIG1lYW5zIG5vdGhpbmcgaXMgc2V0IHlldFxuICAgICAgICAgICAgdGhpcy5jYW5jZWxTZXRUcmFuc2l0aW9uQ1NTKCkgLy9zbyB3ZSBjYW5jZWwgYW5kIHdlJ3JlIGdvb2RcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbFNldFRyYW5zaXRpb25DU1NcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNhbmNlbFNldFN0eWxlQ1NTKXtcbiAgICAgICAgICAgIC8vIGlmIGNhbmNlbFNldFN0eWxlQ1NTIGlzIHNldCwgbWVhbnMgdHJhbnNpdGlvbiBjc3MgaGFzIGJlZW4gc2V0LCBidXQgbm8gYWN0dWFsIHN0eWxlcy5cbiAgICAgICAgICAgIHRoaXMuY2FuY2VsU2V0U3R5bGVDU1MoKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsU2V0U3R5bGVDU1NcbiAgICAgICAgICAgIC8vIGlmIGl0cyBhIGhhcmQgc3RvcCAoYW5kIG5vdCBhbm90aGVyIHN0YXJ0IG9uIHRvcCBvZiB0aGUgY3VycmVudCBhbmltYXRpb24pXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHJlc2V0IHRoZSB0cmFuc2l0aW9uIENTU1xuICAgICAgICAgICAgaWYgKGhhcmQpIHRoaXMucmVzZXRDU1MoKVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2FuY2VsQ29tcGxldGUpe1xuICAgICAgICAgICAgLy8gaWYgY2FuY2VsQ29tcGxldGUgaXMgc2V0LCBtZWFucyBzdHlsZSBhbmQgdHJhbnNpdGlvbiBjc3MgaGF2ZSBiZWVuIHNldCwgbm90IHlldCBjb21wbGV0ZWQuXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5jYW5jZWxDb21wbGV0ZSlcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhbmNlbENvbXBsZXRlXG4gICAgICAgICAgICAvLyBpZiBpdHMgYSBoYXJkIHN0b3AgKGFuZCBub3QgYW5vdGhlciBzdGFydCBvbiB0b3Agb2YgdGhlIGN1cnJlbnQgYW5pbWF0aW9uKVxuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byByZXNldCB0aGUgdHJhbnNpdGlvbiBDU1Mgc2V0IHRoZSBjdXJyZW50IGFuaW1hdGlvbiBzdHlsZXNcbiAgICAgICAgICAgIGlmIChoYXJkKXtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0Q1NTKClcbiAgICAgICAgICAgICAgICB0aGlzLnNldCh0aGlzLmdldCgpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIHJlc2V0Q1NTOiBmdW5jdGlvbihpbmNsdXNpdmUpe1xuICAgICAgICB2YXIgcnVsZXMgICAgICA9IGNvbXB1dGUodGhpcy5ub2RlKSxcbiAgICAgICAgICAgIHByb3BlcnRpZXMgPSAocnVsZXModHJhbnNpdGlvbk5hbWUgKyBcIlByb3BlcnR5XCIpLnJlcGxhY2UoL1xccysvZywgXCJcIikgfHwgXCJhbGxcIikuc3BsaXQoXCIsXCIpLFxuICAgICAgICAgICAgZHVyYXRpb25zICA9IChydWxlcyh0cmFuc2l0aW9uTmFtZSArIFwiRHVyYXRpb25cIikucmVwbGFjZSgvXFxzKy9nLCBcIlwiKSB8fCBcIjBzXCIpLnNwbGl0KFwiLFwiKSxcbiAgICAgICAgICAgIGVxdWF0aW9ucyAgPSAocnVsZXModHJhbnNpdGlvbk5hbWUgKyBcIlRpbWluZ0Z1bmN0aW9uXCIpLnJlcGxhY2UoL1xccysvZywgXCJcIikgfHwgXCJlYXNlXCIpLm1hdGNoKC9jdWJpYy1iZXppZXJcXChbXFxkLS4sXStcXCl8KFthLXotXSspL2cpXG5cbiAgICAgICAgcmVtb3ZlMyhcImFsbFwiLCAgICAgICAgICBwcm9wZXJ0aWVzLCBkdXJhdGlvbnMsIGVxdWF0aW9ucylcbiAgICAgICAgcmVtb3ZlMyh0aGlzLmhwcm9wZXJ0eSwgcHJvcGVydGllcywgZHVyYXRpb25zLCBlcXVhdGlvbnMpXG5cbiAgICAgICAgaWYgKGluY2x1c2l2ZSl7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2godGhpcy5ocHJvcGVydHkpXG4gICAgICAgICAgICBkdXJhdGlvbnMucHVzaCh0aGlzLmR1cmF0aW9uICsgXCJtc1wiKVxuICAgICAgICAgICAgZXF1YXRpb25zLnB1c2goXCJjdWJpYy1iZXppZXIoXCIgKyB0aGlzLmVxdWF0aW9uICsgXCIpXCIpXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbm9kZVN0eWxlID0gdGhpcy5ub2RlLnN0eWxlXG5cbiAgICAgICAgbm9kZVN0eWxlW3RyYW5zaXRpb25OYW1lICsgXCJQcm9wZXJ0eVwiXSAgICAgICA9IHByb3BlcnRpZXNcbiAgICAgICAgbm9kZVN0eWxlW3RyYW5zaXRpb25OYW1lICsgXCJEdXJhdGlvblwiXSAgICAgICA9IGR1cmF0aW9uc1xuICAgICAgICBub2RlU3R5bGVbdHJhbnNpdGlvbk5hbWUgKyBcIlRpbWluZ0Z1bmN0aW9uXCJdID0gZXF1YXRpb25zXG4gICAgfSxcblxuICAgIHBhcnNlRXF1YXRpb246IGZ1bmN0aW9uKGVxdWF0aW9uKXtcbiAgICAgICAgaWYgKHR5cGVvZiBlcXVhdGlvbiA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIENTU0FuaW1hdGlvbi5wYXJlbnQucGFyc2VFcXVhdGlvbi5jYWxsKHRoaXMsIGVxdWF0aW9uLCB0cnVlKVxuICAgIH1cblxufSlcblxuLy8gZWxlbWVudHMgbWV0aG9kc1xuXG52YXIgQmFzZUFuaW1hdGlvbiA9IHRyYW5zaXRpb25OYW1lID8gQ1NTQW5pbWF0aW9uIDogSlNBbmltYXRpb25cblxudmFyIG1vb2Z4ID0gZnVuY3Rpb24oeCwgeSl7XG4gICAgcmV0dXJuICh0eXBlb2YgeCA9PT0gXCJmdW5jdGlvblwiKSA/IGZ4KHgpIDogZWxlbWVudHMoeCwgeSlcbn1cblxuZWxlbWVudHMuaW1wbGVtZW50KHtcblxuICAgIC8vIHtwcm9wZXJ0aWVzfSwgb3B0aW9ucyBvclxuICAgIC8vIHByb3BlcnR5LCB2YWx1ZSBvcHRpb25zXG4gICAgYW5pbWF0ZTogZnVuY3Rpb24oQSwgQiwgQyl7XG5cbiAgICAgICAgdmFyIHN0eWxlcyA9IEEsIG9wdGlvbnMgPSBCXG5cbiAgICAgICAgaWYgKHR5cGVvZiBBID09PSBcInN0cmluZ1wiKXtcbiAgICAgICAgICAgIHN0eWxlcyA9IHt9XG4gICAgICAgICAgICBzdHlsZXNbQV0gPSBCXG4gICAgICAgICAgICBvcHRpb25zID0gQ1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkgb3B0aW9ucyA9IHt9XG5cbiAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2Ygb3B0aW9uc1xuXG4gICAgICAgIG9wdGlvbnMgPSB0eXBlID09PSBcImZ1bmN0aW9uXCIgPyB7XG4gICAgICAgICAgICBjYWxsYmFjazogb3B0aW9uc1xuICAgICAgICB9IDogKHR5cGUgPT09IFwic3RyaW5nXCIgfHwgdHlwZSA9PT0gXCJudW1iZXJcIikgPyB7XG4gICAgICAgICAgICBkdXJhdGlvbjogb3B0aW9uc1xuICAgICAgICB9IDogb3B0aW9uc1xuXG4gICAgICAgIHZhciBjYWxsYmFjayAgPSBvcHRpb25zLmNhbGxiYWNrIHx8IGZ1bmN0aW9uKCl7fSxcbiAgICAgICAgICAgIGNvbXBsZXRlZCA9IDAsXG4gICAgICAgICAgICBsZW5ndGggICAgPSAwXG5cbiAgICAgICAgb3B0aW9ucy5jYWxsYmFjayA9IGZ1bmN0aW9uKHQpe1xuICAgICAgICAgICAgaWYgKCsrY29tcGxldGVkID09PSBsZW5ndGgpIGNhbGxiYWNrKHQpXG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzdHlsZXMpe1xuXG4gICAgICAgICAgICB2YXIgdmFsdWUgICAgPSBzdHlsZXNbcHJvcGVydHldLFxuICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gY2FtZWxpemUocHJvcGVydHkpXG5cbiAgICAgICAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgICAgICBsZW5ndGgrK1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gZWxlbWVudHMobm9kZSksIGFuaW1zID0gc2VsZi5fYW5pbWF0aW9ucyB8fCAoc2VsZi5fYW5pbWF0aW9ucyA9IHt9KVxuICAgICAgICAgICAgICAgIHZhciBhbmltICA9IGFuaW1zW3Byb3BlcnR5XSB8fCAoYW5pbXNbcHJvcGVydHldID0gbmV3IEJhc2VBbmltYXRpb24obm9kZSwgcHJvcGVydHkpKVxuICAgICAgICAgICAgICAgIGFuaW0uc2V0T3B0aW9ucyhvcHRpb25zKS5zdGFydCh2YWx1ZSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpc1xuXG4gICAgfSxcblxuICAgIC8vIHtwcm9wZXJ0aWVzfSBvclxuICAgIC8vIHByb3BlcnR5LCB2YWx1ZVxuICAgIHN0eWxlOiBmdW5jdGlvbihBLCBCKXtcblxuICAgICAgICB2YXIgc3R5bGVzID0gQVxuXG4gICAgICAgIGlmICh0eXBlb2YgQSA9PT0gXCJzdHJpbmdcIil7XG4gICAgICAgICAgICBzdHlsZXMgPSB7fVxuICAgICAgICAgICAgc3R5bGVzW0FdID0gQlxuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gc3R5bGVzKXtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHN0eWxlc1twcm9wZXJ0eV0sXG4gICAgICAgICAgICAgICAgc2V0ICAgPSBzZXR0ZXIocHJvcGVydHkgPSBjYW1lbGl6ZShwcm9wZXJ0eSkpXG5cbiAgICAgICAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IGVsZW1lbnRzKG5vZGUpLCBhbmltcyA9IHNlbGYuX2FuaW1hdGlvbnMsIGFuaW1cbiAgICAgICAgICAgICAgICBpZiAoYW5pbXMgJiYgKGFuaW0gPSBhbmltc1twcm9wZXJ0eV0pKSBhbmltLnN0b3AodHJ1ZSlcbiAgICAgICAgICAgICAgICBzZXQuY2FsbChub2RlLCB2YWx1ZSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpc1xuXG4gICAgfSxcblxuICAgIGNvbXB1dGU6IGZ1bmN0aW9uKHByb3BlcnR5KXtcblxuICAgICAgICBwcm9wZXJ0eSA9IGNhbWVsaXplKHByb3BlcnR5KVxuICAgICAgICB2YXIgbm9kZSA9IHRoaXNbMF1cblxuICAgICAgICAvLyByZXR1cm4gZGVmYXVsdCBtYXRyaXggZm9yIHRyYW5zZm9ybSwgaW5zdGVhZCBvZiBwYXJzZWQgKGZvciBjb25zaXN0ZW5jeSlcblxuICAgICAgICBpZiAocHJvcGVydHkgPT09IFwidHJhbnNmb3JtXCIgJiYgcGFyc2VUcmFuc2Zvcm0yZCkgcmV0dXJuIGNvbXB1dGUobm9kZSkodHJhbnNmb3JtTmFtZSlcblxuICAgICAgICB2YXIgdmFsdWUgPSBnZXR0ZXIocHJvcGVydHkpLmNhbGwobm9kZSlcblxuICAgICAgICAvLyB1bml0IGNvbnZlcnNpb24gdG8gYHB4YFxuXG4gICAgICAgIHJldHVybiAodmFsdWUgIT0gbnVsbCkgPyB2YWx1ZS5yZXBsYWNlKHJnTGVuZ3RoLCBmdW5jdGlvbihtYXRjaCwgdmFsdWUsIHVuaXQpe1xuICAgICAgICAgICAgcmV0dXJuICh1bml0ID09PSBcInB4XCIpID8gbWF0Y2ggOiBwaXhlbFJhdGlvKG5vZGUsIHVuaXQpICogdmFsdWUgKyBcInB4XCJcbiAgICAgICAgfSkgOiAnJ1xuXG4gICAgfVxuXG59KVxuXG5tb29meC5wYXJzZSA9IGZ1bmN0aW9uKHByb3BlcnR5LCB2YWx1ZSwgbm9ybWFsaXplKXtcbiAgICByZXR1cm4gKHBhcnNlcnNbY2FtZWxpemUocHJvcGVydHkpXSB8fCBwYXJzZSkodmFsdWUsIG5vcm1hbGl6ZSlcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBtb29meFxuIiwiLypcbmNvbG9yXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBjb2xvcnMgPSB7XG4gICAgbWFyb29uICAgICAgOiBcIiM4MDAwMDBcIixcbiAgICByZWQgICAgICAgICA6IFwiI2ZmMDAwMFwiLFxuICAgIG9yYW5nZSAgICAgIDogXCIjZmZBNTAwXCIsXG4gICAgeWVsbG93ICAgICAgOiBcIiNmZmZmMDBcIixcbiAgICBvbGl2ZSAgICAgICA6IFwiIzgwODAwMFwiLFxuICAgIHB1cnBsZSAgICAgIDogXCIjODAwMDgwXCIsXG4gICAgZnVjaHNpYSAgICAgOiBcIiNmZjAwZmZcIixcbiAgICB3aGl0ZSAgICAgICA6IFwiI2ZmZmZmZlwiLFxuICAgIGxpbWUgICAgICAgIDogXCIjMDBmZjAwXCIsXG4gICAgZ3JlZW4gICAgICAgOiBcIiMwMDgwMDBcIixcbiAgICBuYXZ5ICAgICAgICA6IFwiIzAwMDA4MFwiLFxuICAgIGJsdWUgICAgICAgIDogXCIjMDAwMGZmXCIsXG4gICAgYXF1YSAgICAgICAgOiBcIiMwMGZmZmZcIixcbiAgICB0ZWFsICAgICAgICA6IFwiIzAwODA4MFwiLFxuICAgIGJsYWNrICAgICAgIDogXCIjMDAwMDAwXCIsXG4gICAgc2lsdmVyICAgICAgOiBcIiNjMGMwYzBcIixcbiAgICBncmF5ICAgICAgICA6IFwiIzgwODA4MFwiLFxuICAgIHRyYW5zcGFyZW50IDogXCIjMDAwMFwiXG59XG5cbnZhciBSR0J0b1JHQiA9IGZ1bmN0aW9uKHIsIGcsIGIsIGEpe1xuICAgIGlmIChhID09IG51bGwgfHwgYSA9PT0gXCJcIikgYSA9IDFcbiAgICByID0gcGFyc2VGbG9hdChyKVxuICAgIGcgPSBwYXJzZUZsb2F0KGcpXG4gICAgYiA9IHBhcnNlRmxvYXQoYilcbiAgICBhID0gcGFyc2VGbG9hdChhKVxuICAgIGlmICghKHIgPD0gMjU1ICYmIHIgPj0gMCAmJiBnIDw9IDI1NSAmJiBnID49IDAgJiYgYiA8PSAyNTUgJiYgYiA+PSAwICYmIGEgPD0gMSAmJiBhID49IDApKSByZXR1cm4gbnVsbFxuXG4gICAgcmV0dXJuIFtNYXRoLnJvdW5kKHIpLCBNYXRoLnJvdW5kKGcpLCBNYXRoLnJvdW5kKGIpLCBhXVxufVxuXG52YXIgSEVYdG9SR0IgPSBmdW5jdGlvbihoZXgpe1xuICAgIGlmIChoZXgubGVuZ3RoID09PSAzKSBoZXggKz0gXCJmXCJcbiAgICBpZiAoaGV4Lmxlbmd0aCA9PT0gNCl7XG4gICAgICAgIHZhciBoMCA9IGhleC5jaGFyQXQoMCksXG4gICAgICAgICAgICBoMSA9IGhleC5jaGFyQXQoMSksXG4gICAgICAgICAgICBoMiA9IGhleC5jaGFyQXQoMiksXG4gICAgICAgICAgICBoMyA9IGhleC5jaGFyQXQoMylcblxuICAgICAgICBoZXggPSBoMCArIGgwICsgaDEgKyBoMSArIGgyICsgaDIgKyBoMyArIGgzXG4gICAgfVxuICAgIGlmIChoZXgubGVuZ3RoID09PSA2KSBoZXggKz0gXCJmZlwiXG4gICAgdmFyIHJnYiA9IFtdXG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBoZXgubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSByZ2IucHVzaChwYXJzZUludChoZXguc3Vic3RyKGksIDIpLCAxNikgLyAoaSA9PT0gNiA/IDI1NSA6IDEpKVxuICAgIHJldHVybiByZ2Jcbn1cblxuLy8gSFNMIHRvIFJHQiBjb252ZXJzaW9uIGZyb206XG4vLyBodHRwOi8vbWppamFja3Nvbi5jb20vMjAwOC8wMi9yZ2ItdG8taHNsLWFuZC1yZ2ItdG8taHN2LWNvbG9yLW1vZGVsLWNvbnZlcnNpb24tYWxnb3JpdGhtcy1pbi1qYXZhc2NyaXB0XG4vLyB0aGFuayB5b3UhXG5cbnZhciBIVUV0b1JHQiA9IGZ1bmN0aW9uKHAsIHEsIHQpe1xuICAgIGlmICh0IDwgMCkgdCArPSAxXG4gICAgaWYgKHQgPiAxKSB0IC09IDFcbiAgICBpZiAodCA8IDEgLyA2KSByZXR1cm4gcCArIChxIC0gcCkgKiA2ICogdFxuICAgIGlmICh0IDwgMSAvIDIpIHJldHVybiBxXG4gICAgaWYgKHQgPCAyIC8gMykgcmV0dXJuIHAgKyAocSAtIHApICogKDIgLyAzIC0gdCkgKiA2XG4gICAgcmV0dXJuIHBcbn1cblxudmFyIEhTTHRvUkdCID0gZnVuY3Rpb24oaCwgcywgbCwgYSl7XG4gICAgdmFyIHIsIGIsIGdcbiAgICBpZiAoYSA9PSBudWxsIHx8IGEgPT09IFwiXCIpIGEgPSAxXG4gICAgaCA9IHBhcnNlRmxvYXQoaCkgLyAzNjBcbiAgICBzID0gcGFyc2VGbG9hdChzKSAvIDEwMFxuICAgIGwgPSBwYXJzZUZsb2F0KGwpIC8gMTAwXG4gICAgYSA9IHBhcnNlRmxvYXQoYSkgLyAxXG4gICAgaWYgKGggPiAxIHx8IGggPCAwIHx8IHMgPiAxIHx8IHMgPCAwIHx8IGwgPiAxIHx8IGwgPCAwIHx8IGEgPiAxIHx8IGEgPCAwKSByZXR1cm4gbnVsbFxuICAgIGlmIChzID09PSAwKXtcbiAgICAgICAgciA9IGIgPSBnID0gbFxuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBxID0gbCA8IDAuNSA/IGwgKiAoMSArIHMpIDogbCArIHMgLSBsICogc1xuICAgICAgICB2YXIgcCA9IDIgKiBsIC0gcVxuICAgICAgICByID0gSFVFdG9SR0IocCwgcSwgaCArIDEgLyAzKVxuICAgICAgICBnID0gSFVFdG9SR0IocCwgcSwgaClcbiAgICAgICAgYiA9IEhVRXRvUkdCKHAsIHEsIGggLSAxIC8gMylcbiAgICB9XG4gICAgcmV0dXJuIFtyICogMjU1LCBnICogMjU1LCBiICogMjU1LCBhXVxufVxuXG52YXIga2V5cyA9IFtdXG5mb3IgKHZhciBjIGluIGNvbG9ycykga2V5cy5wdXNoKGMpXG5cbnZhciBzaGV4ICA9IFwiKD86IyhbYS1mMC05XXszLDh9KSlcIixcbiAgICBzdmFsICA9IFwiXFxcXHMqKFsuXFxcXGQlXSspXFxcXHMqXCIsXG4gICAgc29wICAgPSBcIig/OixcXFxccyooWy5cXFxcZF0rKVxcXFxzKik/XCIsXG4gICAgc2xpc3QgPSBcIlxcXFwoXCIgKyBbc3ZhbCwgc3ZhbCwgc3ZhbF0gKyBzb3AgKyBcIlxcXFwpXCIsXG4gICAgc3JnYiAgPSBcIig/OnJnYilhP1wiLFxuICAgIHNoc2wgID0gXCIoPzpoc2wpYT9cIixcbiAgICBza2V5cyA9IFwiKFwiICsga2V5cy5qb2luKFwifFwiKSArIFwiKVwiXG5cblxudmFyIHhoZXggICA9IFJlZ0V4cChzaGV4LCBcImlcIiksXG4gICAgeHJnYiAgID0gUmVnRXhwKHNyZ2IgKyBzbGlzdCwgXCJpXCIpLFxuICAgIHhoc2wgICA9IFJlZ0V4cChzaHNsICsgc2xpc3QsIFwiaVwiKVxuXG52YXIgY29sb3IgPSBmdW5jdGlvbihpbnB1dCwgYXJyYXkpe1xuICAgIGlmIChpbnB1dCA9PSBudWxsKSByZXR1cm4gbnVsbFxuICAgIGlucHV0ID0gKGlucHV0ICsgXCJcIikucmVwbGFjZSgvXFxzKy8sIFwiXCIpXG5cbiAgICB2YXIgbWF0Y2ggPSBjb2xvcnNbaW5wdXRdXG4gICAgaWYgKG1hdGNoKXtcbiAgICAgICAgcmV0dXJuIGNvbG9yKG1hdGNoLCBhcnJheSlcbiAgICB9IGVsc2UgaWYgKG1hdGNoID0gaW5wdXQubWF0Y2goeGhleCkpe1xuICAgICAgICBpbnB1dCA9IEhFWHRvUkdCKG1hdGNoWzFdKVxuICAgIH0gZWxzZSBpZiAobWF0Y2ggPSBpbnB1dC5tYXRjaCh4cmdiKSl7XG4gICAgICAgIGlucHV0ID0gbWF0Y2guc2xpY2UoMSlcbiAgICB9IGVsc2UgaWYgKG1hdGNoID0gaW5wdXQubWF0Y2goeGhzbCkpe1xuICAgICAgICBpbnB1dCA9IEhTTHRvUkdCLmFwcGx5KG51bGwsIG1hdGNoLnNsaWNlKDEpKVxuICAgIH0gZWxzZSByZXR1cm4gbnVsbFxuXG4gICAgaWYgKCEoaW5wdXQgJiYgKGlucHV0ID0gUkdCdG9SR0IuYXBwbHkobnVsbCwgaW5wdXQpKSkpIHJldHVybiBudWxsXG4gICAgaWYgKGFycmF5KSByZXR1cm4gaW5wdXRcbiAgICBpZiAoaW5wdXRbM10gPT09IDEpIGlucHV0LnNwbGljZSgzLCAxKVxuICAgIHJldHVybiBcInJnYlwiICsgKGlucHV0Lmxlbmd0aCA9PT0gNCA/IFwiYVwiIDogXCJcIikgKyBcIihcIiArIGlucHV0ICsgXCIpXCJcbn1cblxuY29sb3IueCA9IFJlZ0V4cChbc2tleXMsIHNoZXgsIHNyZ2IgKyBzbGlzdCwgc2hzbCArIHNsaXN0XS5qb2luKFwifFwiKSwgXCJnaVwiKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNvbG9yXG4iLCIvKlxucmVxdWVzdEZyYW1lIC8gY2FuY2VsRnJhbWVcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGluZGV4T2YgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvaW5kZXhPZlwiKVxuXG52YXIgcmVxdWVzdEZyYW1lID0gZ2xvYmFsLnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgICAgICAgIGdsb2JhbC53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgICAgICAgICBnbG9iYWwubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICAgICAgICAgZ2xvYmFsLm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgICAgICAgICBnbG9iYWwubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihjYWxsYmFjayl7XG4gICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpXG4gICAgICAgICAgICAgICAgICAgICAgIH0sIDFlMyAvIDYwKVxuICAgICAgICAgICAgICAgICAgIH1cblxudmFyIGNhbGxiYWNrcyA9IFtdXG5cbnZhciBpdGVyYXRvciA9IGZ1bmN0aW9uKHRpbWUpe1xuICAgIHZhciBzcGxpdCA9IGNhbGxiYWNrcy5zcGxpY2UoMCwgY2FsbGJhY2tzLmxlbmd0aClcbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHNwbGl0Lmxlbmd0aDsgaSA8IGw7IGkrKykgc3BsaXRbaV0odGltZSB8fCAodGltZSA9ICsobmV3IERhdGUpKSlcbn1cblxudmFyIGNhbmNlbCA9IGZ1bmN0aW9uKGNhbGxiYWNrKXtcbiAgICB2YXIgaW8gPSBpbmRleE9mKGNhbGxiYWNrcywgY2FsbGJhY2spXG4gICAgaWYgKGlvID4gLTEpIGNhbGxiYWNrcy5zcGxpY2UoaW8sIDEpXG59XG5cbnZhciByZXF1ZXN0ID0gZnVuY3Rpb24oY2FsbGJhY2spe1xuICAgIHZhciBpID0gY2FsbGJhY2tzLnB1c2goY2FsbGJhY2spXG4gICAgaWYgKGkgPT09IDEpIHJlcXVlc3RGcmFtZShpdGVyYXRvcilcbiAgICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICAgICAgY2FuY2VsKGNhbGxiYWNrKVxuICAgIH1cbn1cblxuZXhwb3J0cy5yZXF1ZXN0ID0gcmVxdWVzdFxuZXhwb3J0cy5jYW5jZWwgPSBjYW5jZWxcbiIsIi8qXG5meFxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgcHJpbWUgICAgICAgID0gcmVxdWlyZShcInByaW1lXCIpLFxuICAgIHJlcXVlc3RGcmFtZSA9IHJlcXVpcmUoXCIuL2ZyYW1lXCIpLnJlcXVlc3QsXG4gICAgYmV6aWVyICAgICAgID0gcmVxdWlyZShcImN1YmljLWJlemllclwiKVxuXG52YXIgbWFwID0gcmVxdWlyZShcInByaW1lL2FycmF5L21hcFwiKVxuXG52YXIgc0R1cmF0aW9uICAgID0gXCIoW1xcXFxkLl0rKShzfG1zKT9cIixcbiAgICBzQ3ViaWNCZXppZXIgPSBcImN1YmljLWJlemllclxcXFwoKFstLlxcXFxkXSspLChbLS5cXFxcZF0rKSwoWy0uXFxcXGRdKyksKFstLlxcXFxkXSspXFxcXClcIlxuXG52YXIgckR1cmF0aW9uICAgICA9IFJlZ0V4cChzRHVyYXRpb24pLFxuICAgIHJDdWJpY0JlemllciAgPSBSZWdFeHAoc0N1YmljQmV6aWVyKSxcbiAgICByZ0N1YmljQmV6aWVyID0gUmVnRXhwKHNDdWJpY0JlemllciwgXCJnXCIpXG5cbiAgICAvLyBlcXVhdGlvbnMgY29sbGVjdGlvblxuXG52YXIgZXF1YXRpb25zID0ge1xuICAgIFwiZGVmYXVsdFwiICAgICA6IFwiY3ViaWMtYmV6aWVyKDAuMjUsIDAuMSwgMC4yNSwgMS4wKVwiLFxuICAgIFwibGluZWFyXCIgICAgICA6IFwiY3ViaWMtYmV6aWVyKDAsIDAsIDEsIDEpXCIsXG4gICAgXCJlYXNlLWluXCIgICAgIDogXCJjdWJpYy1iZXppZXIoMC40MiwgMCwgMS4wLCAxLjApXCIsXG4gICAgXCJlYXNlLW91dFwiICAgIDogXCJjdWJpYy1iZXppZXIoMCwgMCwgMC41OCwgMS4wKVwiLFxuICAgIFwiZWFzZS1pbi1vdXRcIiA6IFwiY3ViaWMtYmV6aWVyKDAuNDIsIDAsIDAuNTgsIDEuMClcIlxufVxuXG5lcXVhdGlvbnMuZWFzZSA9IGVxdWF0aW9uc1tcImRlZmF1bHRcIl1cblxudmFyIGNvbXB1dGUgPSBmdW5jdGlvbihmcm9tLCB0bywgZGVsdGEpe1xuICAgIHJldHVybiAodG8gLSBmcm9tKSAqIGRlbHRhICsgZnJvbVxufVxuXG52YXIgZGl2aWRlID0gZnVuY3Rpb24oc3RyaW5nKXtcbiAgICB2YXIgbnVtYmVycyA9IFtdXG4gICAgdmFyIHRlbXBsYXRlID0gKHN0cmluZyArIFwiXCIpLnJlcGxhY2UoL1stLlxcZF0rL2csIGZ1bmN0aW9uKG51bWJlcil7XG4gICAgICAgIG51bWJlcnMucHVzaCgrbnVtYmVyKVxuICAgICAgICByZXR1cm4gXCJAXCJcbiAgICB9KVxuICAgIHJldHVybiBbbnVtYmVycywgdGVtcGxhdGVdXG59XG5cbnZhciBGeCA9IHByaW1lKHtcblxuICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBGeChyZW5kZXIsIG9wdGlvbnMpe1xuXG4gICAgICAgIC8vIHNldCBvcHRpb25zXG5cbiAgICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpXG5cbiAgICAgICAgLy8gcmVuZGVyZXJcblxuICAgICAgICB0aGlzLnJlbmRlciA9IHJlbmRlciB8fCBmdW5jdGlvbigpe31cblxuICAgICAgICAvLyBib3VuZCBmdW5jdGlvbnNcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXNcblxuICAgICAgICB0aGlzLmJTdGVwID0gZnVuY3Rpb24odCl7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5zdGVwKHQpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJFeGl0ID0gZnVuY3Rpb24odGltZSl7XG4gICAgICAgICAgICBzZWxmLmV4aXQodGltZSlcbiAgICAgICAgfVxuXG4gICAgfSxcblxuICAgIHNldE9wdGlvbnM6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSBvcHRpb25zID0ge31cblxuICAgICAgICBpZiAoISh0aGlzLmR1cmF0aW9uID0gdGhpcy5wYXJzZUR1cmF0aW9uKG9wdGlvbnMuZHVyYXRpb24gfHwgXCI1MDBtc1wiKSkpIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgZHVyYXRpb25cIilcbiAgICAgICAgaWYgKCEodGhpcy5lcXVhdGlvbiA9IHRoaXMucGFyc2VFcXVhdGlvbihvcHRpb25zLmVxdWF0aW9uIHx8IFwiZGVmYXVsdFwiKSkpIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgZXF1YXRpb25cIilcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgZnVuY3Rpb24oKXt9XG5cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgcGFyc2VEdXJhdGlvbjogZnVuY3Rpb24oZHVyYXRpb24pe1xuICAgICAgICBpZiAoZHVyYXRpb24gPSAoZHVyYXRpb24gKyBcIlwiKS5tYXRjaChyRHVyYXRpb24pKXtcbiAgICAgICAgICAgIHZhciB0aW1lID0gK2R1cmF0aW9uWzFdLFxuICAgICAgICAgICAgICAgIHVuaXQgPSBkdXJhdGlvblsyXSB8fCBcIm1zXCJcblxuICAgICAgICAgICAgaWYgKHVuaXQgPT09IFwic1wiKSAgcmV0dXJuIHRpbWUgKiAxZTNcbiAgICAgICAgICAgIGlmICh1bml0ID09PSBcIm1zXCIpIHJldHVybiB0aW1lXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcGFyc2VFcXVhdGlvbjogZnVuY3Rpb24oZXF1YXRpb24sIGFycmF5KXtcbiAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgZXF1YXRpb25cblxuICAgICAgICBpZiAodHlwZSA9PT0gXCJmdW5jdGlvblwiKXsgLy8gZnVuY3Rpb25cbiAgICAgICAgICAgIHJldHVybiBlcXVhdGlvblxuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwic3RyaW5nXCIpeyAvLyBjdWJpYy1iZXppZXIgc3RyaW5nXG4gICAgICAgICAgICBlcXVhdGlvbiA9IGVxdWF0aW9uc1tlcXVhdGlvbl0gfHwgZXF1YXRpb25cbiAgICAgICAgICAgIHZhciBtYXRjaCA9IGVxdWF0aW9uLnJlcGxhY2UoL1xccysvZywgXCJcIikubWF0Y2gockN1YmljQmV6aWVyKVxuICAgICAgICAgICAgaWYgKG1hdGNoKXtcbiAgICAgICAgICAgICAgICBlcXVhdGlvbiA9IG1hcChtYXRjaC5zbGljZSgxKSwgZnVuY3Rpb24odil7cmV0dXJuICt2fSlcbiAgICAgICAgICAgICAgICBpZiAoYXJyYXkpIHJldHVybiBlcXVhdGlvblxuICAgICAgICAgICAgICAgIGlmIChlcXVhdGlvbi50b1N0cmluZygpID09PSBcIjAsMCwxLDFcIikgcmV0dXJuIGZ1bmN0aW9uKHgpe3JldHVybiB4fVxuICAgICAgICAgICAgICAgIHR5cGUgPSBcIm9iamVjdFwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZSA9PT0gXCJvYmplY3RcIil7IC8vIGFycmF5XG4gICAgICAgICAgICByZXR1cm4gYmV6aWVyKGVxdWF0aW9uWzBdLCBlcXVhdGlvblsxXSwgZXF1YXRpb25bMl0sIGVxdWF0aW9uWzNdLCAxZTMgLyA2MCAvIHRoaXMuZHVyYXRpb24gLyA0KVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNhbmNlbDogZnVuY3Rpb24odG8pe1xuICAgICAgICB0aGlzLnRvID0gdG9cbiAgICAgICAgdGhpcy5jYW5jZWxFeGl0ID0gcmVxdWVzdEZyYW1lKHRoaXMuYkV4aXQpXG4gICAgfSxcblxuICAgIGV4aXQ6IGZ1bmN0aW9uKHRpbWUpe1xuICAgICAgICB0aGlzLnJlbmRlcih0aGlzLnRvKVxuICAgICAgICBkZWxldGUgdGhpcy5jYW5jZWxFeGl0XG4gICAgICAgIHRoaXMuY2FsbGJhY2sodGltZSlcbiAgICB9LFxuXG4gICAgc3RhcnQ6IGZ1bmN0aW9uKGZyb20sIHRvKXtcblxuICAgICAgICB0aGlzLnN0b3AoKVxuXG4gICAgICAgIGlmICh0aGlzLmR1cmF0aW9uID09PSAwKXtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsKHRvKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaXNBcnJheSA9IGZhbHNlXG4gICAgICAgIHRoaXMuaXNOdW1iZXIgPSBmYWxzZVxuXG4gICAgICAgIHZhciBmcm9tVHlwZSA9IHR5cGVvZiBmcm9tLFxuICAgICAgICAgICAgdG9UeXBlICAgPSB0eXBlb2YgdG9cblxuICAgICAgICBpZiAoZnJvbVR5cGUgPT09IFwib2JqZWN0XCIgJiYgdG9UeXBlID09PSBcIm9iamVjdFwiKXtcbiAgICAgICAgICAgIHRoaXMuaXNBcnJheSA9IHRydWVcbiAgICAgICAgfSBlbHNlIGlmIChmcm9tVHlwZSA9PT0gXCJudW1iZXJcIiAmJiB0b1R5cGUgPT09IFwibnVtYmVyXCIpe1xuICAgICAgICAgICAgdGhpcy5pc051bWJlciA9IHRydWVcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmcm9tXyA9IGRpdmlkZShmcm9tKSxcbiAgICAgICAgICAgIHRvXyAgID0gZGl2aWRlKHRvKVxuXG4gICAgICAgIHRoaXMuZnJvbSA9IGZyb21fWzBdXG4gICAgICAgIHRoaXMudG8gPSB0b19bMF1cbiAgICAgICAgdGhpcy50ZW1wbGF0ZUZyb20gPSBmcm9tX1sxXVxuICAgICAgICB0aGlzLnRlbXBsYXRlVG8gPSB0b19bMV1cblxuICAgICAgICBpZiAodGhpcy5mcm9tLmxlbmd0aCAhPT0gdGhpcy50by5sZW5ndGggfHwgdGhpcy5mcm9tLnRvU3RyaW5nKCkgPT09IHRoaXMudG8udG9TdHJpbmcoKSl7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbCh0bylcbiAgICAgICAgICAgIHJldHVybiB0aGlzXG4gICAgICAgIH1cblxuICAgICAgICBkZWxldGUgdGhpcy50aW1lXG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5mcm9tLmxlbmd0aFxuICAgICAgICB0aGlzLmNhbmNlbFN0ZXAgPSByZXF1ZXN0RnJhbWUodGhpcy5iU3RlcClcblxuICAgICAgICByZXR1cm4gdGhpc1xuXG4gICAgfSxcblxuICAgIHN0b3A6IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgaWYgKHRoaXMuY2FuY2VsRXhpdCl7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbEV4aXQoKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsRXhpdFxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2FuY2VsU3RlcCl7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbFN0ZXAoKVxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsU3RlcFxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgc3RlcDogZnVuY3Rpb24obm93KXtcblxuICAgICAgICB0aGlzLnRpbWUgfHwgKHRoaXMudGltZSA9IG5vdylcblxuICAgICAgICB2YXIgZmFjdG9yID0gKG5vdyAtIHRoaXMudGltZSkgLyB0aGlzLmR1cmF0aW9uXG5cbiAgICAgICAgaWYgKGZhY3RvciA+IDEpIGZhY3RvciA9IDFcblxuICAgICAgICB2YXIgZGVsdGEgPSB0aGlzLmVxdWF0aW9uKGZhY3RvciksXG4gICAgICAgICAgICBmcm9tICA9IHRoaXMuZnJvbSxcbiAgICAgICAgICAgIHRvICAgID0gdGhpcy50byxcbiAgICAgICAgICAgIHRwbCAgID0gdGhpcy50ZW1wbGF0ZVRvXG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKyl7XG4gICAgICAgICAgICB2YXIgZiA9IGZyb21baV0sIHQgPSB0b1tpXVxuICAgICAgICAgICAgdHBsID0gdHBsLnJlcGxhY2UoXCJAXCIsIHQgIT09IGYgPyBjb21wdXRlKGYsIHQsIGRlbHRhKSA6IHQpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlbmRlcih0aGlzLmlzQXJyYXkgPyB0cGwuc3BsaXQoXCIsXCIpIDogdGhpcy5pc051bWJlciA/ICt0cGwgOiB0cGwsIGZhY3RvcilcblxuICAgICAgICBpZiAoZmFjdG9yICE9PSAxKXtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsU3RlcCA9IHJlcXVlc3RGcmFtZSh0aGlzLmJTdGVwKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FuY2VsU3RlcFxuICAgICAgICAgICAgdGhpcy5jYWxsYmFjayhub3cpXG4gICAgICAgIH1cblxuICAgIH1cblxufSlcblxudmFyIGZ4ID0gZnVuY3Rpb24ocmVuZGVyKXtcblxuICAgIHZhciBmZnggPSBuZXcgRngocmVuZGVyKVxuXG4gICAgcmV0dXJuIHtcblxuICAgICAgICBzdGFydDogZnVuY3Rpb24oZnJvbSwgdG8sIG9wdGlvbnMpe1xuICAgICAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2Ygb3B0aW9uc1xuICAgICAgICAgICAgZmZ4LnNldE9wdGlvbnMoKHR5cGUgPT09IFwiZnVuY3Rpb25cIikgPyB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6IG9wdGlvbnNcbiAgICAgICAgICAgIH0gOiAodHlwZSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlID09PSBcIm51bWJlclwiKSA/IHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogb3B0aW9uc1xuICAgICAgICAgICAgfSA6IG9wdGlvbnMpLnN0YXJ0KGZyb20sIHRvKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfSxcblxuICAgICAgICBzdG9wOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgZmZ4LnN0b3AoKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfVxuXG4gICAgfVxuXG59XG5cbmZ4LnByb3RvdHlwZSA9IEZ4LnByb3RvdHlwZVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ4XG4iLCIvKlxuVW5tYXRyaXggMmRcbiAtIGEgY3J1ZGUgaW1wbGVtZW50YXRpb24gb2YgdGhlIHNsaWdodGx5IGJ1Z2dlZCBwc2V1ZG8gY29kZSBpbiBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLTJkLXRyYW5zZm9ybXMvI21hdHJpeC1kZWNvbXBvc2l0aW9uXG4qL1widXNlIHN0cmljdFwiXG5cbi8vIHJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGUgcGFzc2VkIHZlY3RvclxuXG52YXIgbGVuZ3RoID0gZnVuY3Rpb24oYSl7XG4gICAgcmV0dXJuIE1hdGguc3FydChhWzBdICogYVswXSArIGFbMV0gKiBhWzFdKVxufVxuXG4vLyBub3JtYWxpemVzIHRoZSBsZW5ndGggb2YgdGhlIHBhc3NlZCBwb2ludCB0byAxXG5cbnZhciBub3JtYWxpemUgPSBmdW5jdGlvbihhKXtcbiAgICB2YXIgbCA9IGxlbmd0aChhKVxuICAgIHJldHVybiBsID8gW2FbMF0gLyBsLCBhWzFdIC8gbF0gOiBbMCwgMF1cbn1cblxuLy8gcmV0dXJucyB0aGUgZG90IHByb2R1Y3Qgb2YgdGhlIHBhc3NlZCBwb2ludHNcblxudmFyIGRvdCA9IGZ1bmN0aW9uKGEsIGIpe1xuICAgIHJldHVybiBhWzBdICogYlswXSArIGFbMV0gKiBiWzFdXG59XG5cbi8vIHJldHVybnMgdGhlIHByaW5jaXBhbCB2YWx1ZSBvZiB0aGUgYXJjIHRhbmdlbnQgb2Zcbi8vIHkveCwgdXNpbmcgdGhlIHNpZ25zIG9mIGJvdGggYXJndW1lbnRzIHRvIGRldGVybWluZVxuLy8gdGhlIHF1YWRyYW50IG9mIHRoZSByZXR1cm4gdmFsdWVcblxudmFyIGF0YW4yID0gTWF0aC5hdGFuMlxuXG52YXIgY29tYmluZSA9IGZ1bmN0aW9uKGEsIGIsIGFzY2wsIGJzY2wpe1xuICAgIHJldHVybiBbXG4gICAgICAgIChhc2NsICogYVswXSkgKyAoYnNjbCAqIGJbMF0pLFxuICAgICAgICAoYXNjbCAqIGFbMV0pICsgKGJzY2wgKiBiWzFdKVxuICAgIF1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCB0eCwgdHkpe1xuXG4gICAgLy8gTWFrZSBzdXJlIHRoZSBtYXRyaXggaXMgaW52ZXJ0aWJsZVxuXG4gICAgaWYgKChhICogZCAtIGIgKiBjKSA9PT0gMCkgcmV0dXJuIGZhbHNlXG5cbiAgICAvLyBUYWtlIGNhcmUgb2YgdHJhbnNsYXRpb25cblxuICAgIHZhciB0cmFuc2xhdGUgPSBbdHgsIHR5XVxuXG4gICAgLy8gUHV0IHRoZSBjb21wb25lbnRzIGludG8gYSAyeDIgbWF0cml4XG5cbiAgICB2YXIgbSA9IFtbYSwgYl0sIFtjLCBkXV1cblxuICAgIC8vIENvbXB1dGUgWCBzY2FsZSBmYWN0b3IgYW5kIG5vcm1hbGl6ZSBmaXJzdCByb3cuXG5cbiAgICB2YXIgc2NhbGUgPSBbbGVuZ3RoKG1bMF0pXVxuICAgIG1bMF0gPSBub3JtYWxpemUobVswXSlcblxuICAgIC8vIENvbXB1dGUgc2hlYXIgZmFjdG9yIGFuZCBtYWtlIDJuZCByb3cgb3J0aG9nb25hbCB0byAxc3QuXG5cbiAgICB2YXIgc2tldyA9IGRvdChtWzBdLCBtWzFdKVxuICAgIG1bMV0gPSBjb21iaW5lKG1bMV0sIG1bMF0sIDEsIC1za2V3KVxuXG4gICAgLy8gTm93LCBjb21wdXRlIFkgc2NhbGUgYW5kIG5vcm1hbGl6ZSAybmQgcm93LlxuXG4gICAgc2NhbGVbMV0gPSBsZW5ndGgobVsxXSlcbiAgICAvLyBtWzFdID0gbm9ybWFsaXplKG1bMV0pIC8vXG4gICAgc2tldyAvPSBzY2FsZVsxXVxuXG4gICAgLy8gTm93LCBnZXQgdGhlIHJvdGF0aW9uIG91dFxuXG4gICAgdmFyIHJvdGF0ZSA9IGF0YW4yKG1bMF1bMV0sIG1bMF1bMF0pXG5cbiAgICByZXR1cm4gW3RyYW5zbGF0ZSwgcm90YXRlLCBza2V3LCBzY2FsZV1cblxufVxuIiwiXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHgxLCB5MSwgeDIsIHkyLCBlcHNpbG9uKXtcblxuXHR2YXIgY3VydmVYID0gZnVuY3Rpb24odCl7XG5cdFx0dmFyIHYgPSAxIC0gdDtcblx0XHRyZXR1cm4gMyAqIHYgKiB2ICogdCAqIHgxICsgMyAqIHYgKiB0ICogdCAqIHgyICsgdCAqIHQgKiB0O1xuXHR9O1xuXG5cdHZhciBjdXJ2ZVkgPSBmdW5jdGlvbih0KXtcblx0XHR2YXIgdiA9IDEgLSB0O1xuXHRcdHJldHVybiAzICogdiAqIHYgKiB0ICogeTEgKyAzICogdiAqIHQgKiB0ICogeTIgKyB0ICogdCAqIHQ7XG5cdH07XG5cblx0dmFyIGRlcml2YXRpdmVDdXJ2ZVggPSBmdW5jdGlvbih0KXtcblx0XHR2YXIgdiA9IDEgLSB0O1xuXHRcdHJldHVybiAzICogKDIgKiAodCAtIDEpICogdCArIHYgKiB2KSAqIHgxICsgMyAqICgtIHQgKiB0ICogdCArIDIgKiB2ICogdCkgKiB4Mjtcblx0fTtcblxuXHRyZXR1cm4gZnVuY3Rpb24odCl7XG5cblx0XHR2YXIgeCA9IHQsIHQwLCB0MSwgdDIsIHgyLCBkMiwgaTtcblxuXHRcdC8vIEZpcnN0IHRyeSBhIGZldyBpdGVyYXRpb25zIG9mIE5ld3RvbidzIG1ldGhvZCAtLSBub3JtYWxseSB2ZXJ5IGZhc3QuXG5cdFx0Zm9yICh0MiA9IHgsIGkgPSAwOyBpIDwgODsgaSsrKXtcblx0XHRcdHgyID0gY3VydmVYKHQyKSAtIHg7XG5cdFx0XHRpZiAoTWF0aC5hYnMoeDIpIDwgZXBzaWxvbikgcmV0dXJuIGN1cnZlWSh0Mik7XG5cdFx0XHRkMiA9IGRlcml2YXRpdmVDdXJ2ZVgodDIpO1xuXHRcdFx0aWYgKE1hdGguYWJzKGQyKSA8IDFlLTYpIGJyZWFrO1xuXHRcdFx0dDIgPSB0MiAtIHgyIC8gZDI7XG5cdFx0fVxuXG5cdFx0dDAgPSAwLCB0MSA9IDEsIHQyID0geDtcblxuXHRcdGlmICh0MiA8IHQwKSByZXR1cm4gY3VydmVZKHQwKTtcblx0XHRpZiAodDIgPiB0MSkgcmV0dXJuIGN1cnZlWSh0MSk7XG5cblx0XHQvLyBGYWxsYmFjayB0byB0aGUgYmlzZWN0aW9uIG1ldGhvZCBmb3IgcmVsaWFiaWxpdHkuXG5cdFx0d2hpbGUgKHQwIDwgdDEpe1xuXHRcdFx0eDIgPSBjdXJ2ZVgodDIpO1xuXHRcdFx0aWYgKE1hdGguYWJzKHgyIC0geCkgPCBlcHNpbG9uKSByZXR1cm4gY3VydmVZKHQyKTtcblx0XHRcdGlmICh4ID4geDIpIHQwID0gdDI7XG5cdFx0XHRlbHNlIHQxID0gdDI7XG5cdFx0XHR0MiA9ICh0MSAtIHQwKSAqIC41ICsgdDA7XG5cdFx0fVxuXG5cdFx0Ly8gRmFpbHVyZVxuXHRcdHJldHVybiBjdXJ2ZVkodDIpO1xuXG5cdH07XG5cbn07XG4iLCIvKlxuZWxlbWVudHNcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIHByaW1lICAgPSByZXF1aXJlKFwicHJpbWVcIiksXG4gICAgZm9yRWFjaCA9IHJlcXVpcmUoXCJwcmltZS9hcnJheS9mb3JFYWNoXCIpLFxuICAgIG1hcCAgICAgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvbWFwXCIpLFxuICAgIGZpbHRlciAgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvZmlsdGVyXCIpLFxuICAgIGV2ZXJ5ICAgPSByZXF1aXJlKFwicHJpbWUvYXJyYXkvZXZlcnlcIiksXG4gICAgc29tZSAgICA9IHJlcXVpcmUoXCJwcmltZS9hcnJheS9zb21lXCIpXG5cbi8vIHVuaXF1ZUlEXG5cbnZhciB1bmlxdWVJbmRleCA9IDBcbnZhciB1bmlxdWVJRCA9IGZ1bmN0aW9uKG4pe1xuICAgIHJldHVybiAobiA9PT0gZ2xvYmFsKSA/IFwiZ2xvYmFsXCIgOiBuLnVuaXF1ZU51bWJlciB8fCAobi51bmlxdWVOdW1iZXIgPSBcIm46XCIgKyAodW5pcXVlSW5kZXgrKykudG9TdHJpbmcoMzYpKVxufVxuXG52YXIgaW5zdGFuY2VzID0ge31cblxuLy8gZWxlbWVudHMgcHJpbWVcblxudmFyICQgPSBwcmltZSh7Y29uc3RydWN0b3I6IGZ1bmN0aW9uICQobiwgY29udGV4dCl7XG5cbiAgICBpZiAobiA9PSBudWxsKSByZXR1cm4gKHRoaXMgJiYgdGhpcy5jb25zdHJ1Y3RvciA9PT0gJCkgPyBuZXcgZWxlbWVudHMgOiBudWxsXG5cbiAgICB2YXIgc2VsZiA9IG5cblxuICAgIGlmIChuLmNvbnN0cnVjdG9yICE9PSBlbGVtZW50cyl7XG5cbiAgICAgICAgc2VsZiA9IG5ldyBlbGVtZW50c1xuXG4gICAgICAgIHZhciB1aWRcblxuICAgICAgICBpZiAodHlwZW9mIG4gPT09IFwic3RyaW5nXCIpe1xuICAgICAgICAgICAgaWYgKCFzZWxmLnNlYXJjaCkgcmV0dXJuIG51bGxcbiAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBjb250ZXh0IHx8IGRvY3VtZW50XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5zZWFyY2gobilcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuLm5vZGVUeXBlIHx8IG4gPT09IGdsb2JhbCl7XG5cbiAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBuXG5cbiAgICAgICAgfSBlbHNlIGlmIChuLmxlbmd0aCl7XG5cbiAgICAgICAgICAgIC8vIHRoaXMgY291bGQgYmUgYW4gYXJyYXksIG9yIGFueSBvYmplY3Qgd2l0aCBhIGxlbmd0aCBhdHRyaWJ1dGUsXG4gICAgICAgICAgICAvLyBpbmNsdWRpbmcgYW5vdGhlciBpbnN0YW5jZSBvZiBlbGVtZW50cyBmcm9tIGFub3RoZXIgaW50ZXJmYWNlLlxuXG4gICAgICAgICAgICB2YXIgdW5pcXVlcyA9IHt9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbi5sZW5ndGg7IGkgPCBsOyBpKyspeyAvLyBwZXJmb3JtIGVsZW1lbnRzIGZsYXR0ZW5pbmdcbiAgICAgICAgICAgICAgICB2YXIgbm9kZXMgPSAkKG5baV0sIGNvbnRleHQpXG4gICAgICAgICAgICAgICAgaWYgKG5vZGVzICYmIG5vZGVzLmxlbmd0aCkgZm9yICh2YXIgaiA9IDAsIGsgPSBub2Rlcy5sZW5ndGg7IGogPCBrOyBqKyspe1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IG5vZGVzW2pdXG4gICAgICAgICAgICAgICAgICAgIHVpZCA9IHVuaXF1ZUlEKG5vZGUpXG4gICAgICAgICAgICAgICAgICAgIGlmICghdW5pcXVlc1t1aWRdKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGZbc2VsZi5sZW5ndGgrK10gPSBub2RlXG4gICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVzW3VpZF0gPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgaWYgKCFzZWxmLmxlbmd0aCkgcmV0dXJuIG51bGxcblxuICAgIC8vIHdoZW4gbGVuZ3RoIGlzIDEgYWx3YXlzIHVzZSB0aGUgc2FtZSBlbGVtZW50cyBpbnN0YW5jZVxuXG4gICAgaWYgKHNlbGYubGVuZ3RoID09PSAxKXtcbiAgICAgICAgdWlkID0gdW5pcXVlSUQoc2VsZlswXSlcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlc1t1aWRdIHx8IChpbnN0YW5jZXNbdWlkXSA9IHNlbGYpXG4gICAgfVxuXG4gICAgcmV0dXJuIHNlbGZcblxufX0pXG5cbnZhciBlbGVtZW50cyA9IHByaW1lKHtcblxuICAgIGluaGVyaXRzOiAkLFxuXG4gICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uIGVsZW1lbnRzKCl7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMFxuICAgIH0sXG5cbiAgICB1bmxpbms6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihub2RlLCBpKXtcbiAgICAgICAgICAgIGRlbGV0ZSBpbnN0YW5jZXNbdW5pcXVlSUQobm9kZSldXG4gICAgICAgICAgICByZXR1cm4gbm9kZVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICAvLyBzdHJhaWdodCBlczUgcHJvdG90eXBlcyAob3IgZW11bGF0ZWQgbWV0aG9kcylcblxuICAgIGZvckVhY2g6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBmb3JFYWNoKHRoaXMsIG1ldGhvZCwgY29udGV4dCk7XG4gICAgfSxcblxuICAgIG1hcDogZnVuY3Rpb24obWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgcmV0dXJuIG1hcCh0aGlzLCBtZXRob2QsIGNvbnRleHQpO1xuICAgIH0sXG5cbiAgICBmaWx0ZXI6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBmaWx0ZXIodGhpcywgbWV0aG9kLCBjb250ZXh0KTtcbiAgICB9LFxuXG4gICAgZXZlcnk6IGZ1bmN0aW9uKG1ldGhvZCwgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBldmVyeSh0aGlzLCBtZXRob2QsIGNvbnRleHQpO1xuICAgIH0sXG5cbiAgICBzb21lOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gc29tZSh0aGlzLCBtZXRob2QsIGNvbnRleHQpO1xuICAgIH1cblxufSlcblxubW9kdWxlLmV4cG9ydHMgPSAkXG4iLCIvKlxuYXJyYXk6ZXZlcnlcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGV2ZXJ5ID0gZnVuY3Rpb24oc2VsZiwgbWV0aG9kLCBjb250ZXh0KXtcbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHNlbGYubGVuZ3RoID4+PiAwOyBpIDwgbDsgaSsrKXtcbiAgICAgICAgaWYgKCFtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2ldLCBpLCBzZWxmKSkgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIHJldHVybiB0cnVlXG59XG5cbm1vZHVsZS5leHBvcnRzID0gZXZlcnlcbiIsIi8qXG5hcnJheTpmaWx0ZXJcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGZpbHRlciA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgdmFyIHJlc3VsdHMgPSBbXVxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gc2VsZi5sZW5ndGggPj4+IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgdmFyIHZhbHVlID0gc2VsZltpXVxuICAgICAgICBpZiAobWV0aG9kLmNhbGwoY29udGV4dCwgdmFsdWUsIGksIHNlbGYpKSByZXN1bHRzLnB1c2godmFsdWUpXG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzXG59XG5cbm1vZHVsZS5leHBvcnRzID0gZmlsdGVyXG4iLCIvKlxuYXJyYXk6Zm9yRWFjaFxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgZm9yRWFjaCA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzZWxmLmxlbmd0aCA+Pj4gMDsgaSA8IGw7IGkrKyl7XG4gICAgICAgIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2ldLCBpLCBzZWxmKSA9PT0gZmFsc2UpIGJyZWFrXG4gICAgfVxuICAgIHJldHVybiBzZWxmXG59XG5cbm1vZHVsZS5leHBvcnRzID0gZm9yRWFjaFxuIiwiLypcbmFycmF5OmluZGV4T2ZcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGluZGV4T2YgPSBmdW5jdGlvbihzZWxmLCBpdGVtLCBmcm9tKXtcbiAgICBmb3IgKHZhciBsID0gc2VsZi5sZW5ndGggPj4+IDAsIGkgPSAoZnJvbSA8IDApID8gTWF0aC5tYXgoMCwgbCArIGZyb20pIDogZnJvbSB8fCAwOyBpIDwgbDsgaSsrKXtcbiAgICAgICAgaWYgKHNlbGZbaV0gPT09IGl0ZW0pIHJldHVybiBpXG4gICAgfVxuICAgIHJldHVybiAtMVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGluZGV4T2ZcbiIsIi8qXG5hcnJheTptYXBcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIG1hcCA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgdmFyIGxlbmd0aCA9IHNlbGYubGVuZ3RoID4+PiAwLCByZXN1bHRzID0gQXJyYXkobGVuZ3RoKVxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGVuZ3RoOyBpIDwgbDsgaSsrKXtcbiAgICAgICAgcmVzdWx0c1tpXSA9IG1ldGhvZC5jYWxsKGNvbnRleHQsIHNlbGZbaV0sIGksIHNlbGYpXG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzXG59XG5cbm1vZHVsZS5leHBvcnRzID0gbWFwXG4iLCIvKlxuYXJyYXk6c29tZVxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgc29tZSA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzZWxmLmxlbmd0aCA+Pj4gMDsgaSA8IGw7IGkrKyl7XG4gICAgICAgIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2ldLCBpLCBzZWxmKSkgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlXG59XG5cbm1vZHVsZS5leHBvcnRzID0gc29tZVxuIiwiLypcbnByaW1lXG4gLSBwcm90b3R5cGFsIGluaGVyaXRhbmNlXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBoYXNPd24gPSByZXF1aXJlKFwiLi9vYmplY3QvaGFzT3duXCIpLFxuICAgIGZvckluICA9IHJlcXVpcmUoXCIuL29iamVjdC9mb3JJblwiKSxcbiAgICBtaXhJbiAgPSByZXF1aXJlKFwiLi9vYmplY3QvbWl4SW5cIiksXG4gICAgZmlsdGVyID0gcmVxdWlyZShcIi4vb2JqZWN0L2ZpbHRlclwiKSxcbiAgICBjcmVhdGUgPSByZXF1aXJlKFwiLi9vYmplY3QvY3JlYXRlXCIpLFxuICAgIHR5cGUgICA9IHJlcXVpcmUoXCIuL3R5cGVcIilcblxudmFyIGRlZmluZVByb3BlcnR5ICAgICAgICAgICA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSxcbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yXG5cbnRyeSB7XG4gICAgZGVmaW5lUHJvcGVydHkoe30sIFwiflwiLCB7fSlcbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioe30sIFwiflwiKVxufSBjYXRjaCAoZSl7XG4gICAgZGVmaW5lUHJvcGVydHkgPSBudWxsXG4gICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gbnVsbFxufVxuXG52YXIgZGVmaW5lID0gZnVuY3Rpb24odmFsdWUsIGtleSwgZnJvbSl7XG4gICAgZGVmaW5lUHJvcGVydHkodGhpcywga2V5LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZnJvbSwga2V5KSB8fCB7XG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgIH0pXG59XG5cbnZhciBjb3B5ID0gZnVuY3Rpb24odmFsdWUsIGtleSl7XG4gICAgdGhpc1trZXldID0gdmFsdWVcbn1cblxudmFyIGltcGxlbWVudCA9IGZ1bmN0aW9uKHByb3RvKXtcbiAgICBmb3JJbihwcm90bywgZGVmaW5lUHJvcGVydHkgPyBkZWZpbmUgOiBjb3B5LCB0aGlzLnByb3RvdHlwZSlcbiAgICByZXR1cm4gdGhpc1xufVxuXG52YXIgdmVyYnMgPSAvXmNvbnN0cnVjdG9yfGluaGVyaXRzfG1peGluJC9cblxudmFyIHByaW1lID0gZnVuY3Rpb24ocHJvdG8pe1xuXG4gICAgaWYgKHR5cGUocHJvdG8pID09PSBcImZ1bmN0aW9uXCIpIHByb3RvID0ge2NvbnN0cnVjdG9yOiBwcm90b31cblxuICAgIHZhciBzdXBlcnByaW1lID0gcHJvdG8uaW5oZXJpdHNcblxuICAgIC8vIGlmIG91ciBuaWNlIHByb3RvIG9iamVjdCBoYXMgbm8gb3duIGNvbnN0cnVjdG9yIHByb3BlcnR5XG4gICAgLy8gdGhlbiB3ZSBwcm9jZWVkIHVzaW5nIGEgZ2hvc3RpbmcgY29uc3RydWN0b3IgdGhhdCBhbGwgaXQgZG9lcyBpc1xuICAgIC8vIGNhbGwgdGhlIHBhcmVudCdzIGNvbnN0cnVjdG9yIGlmIGl0IGhhcyBhIHN1cGVycHJpbWUsIGVsc2UgYW4gZW1wdHkgY29uc3RydWN0b3JcbiAgICAvLyBwcm90by5jb25zdHJ1Y3RvciBiZWNvbWVzIHRoZSBlZmZlY3RpdmUgY29uc3RydWN0b3JcbiAgICB2YXIgY29uc3RydWN0b3IgPSAoaGFzT3duKHByb3RvLCBcImNvbnN0cnVjdG9yXCIpKSA/IHByb3RvLmNvbnN0cnVjdG9yIDogKHN1cGVycHJpbWUpID8gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHN1cGVycHJpbWUuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgIH0gOiBmdW5jdGlvbigpe31cblxuICAgIGlmIChzdXBlcnByaW1lKXtcblxuICAgICAgICBtaXhJbihjb25zdHJ1Y3Rvciwgc3VwZXJwcmltZSlcblxuICAgICAgICB2YXIgc3VwZXJwcm90byA9IHN1cGVycHJpbWUucHJvdG90eXBlXG4gICAgICAgIC8vIGluaGVyaXQgZnJvbSBzdXBlcnByaW1lXG4gICAgICAgIHZhciBjcHJvdG8gPSBjb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoc3VwZXJwcm90bylcblxuICAgICAgICAvLyBzZXR0aW5nIGNvbnN0cnVjdG9yLnBhcmVudCB0byBzdXBlcnByaW1lLnByb3RvdHlwZVxuICAgICAgICAvLyBiZWNhdXNlIGl0J3MgdGhlIHNob3J0ZXN0IHBvc3NpYmxlIGFic29sdXRlIHJlZmVyZW5jZVxuICAgICAgICBjb25zdHJ1Y3Rvci5wYXJlbnQgPSBzdXBlcnByb3RvXG4gICAgICAgIGNwcm90by5jb25zdHJ1Y3RvciA9IGNvbnN0cnVjdG9yXG4gICAgfVxuXG4gICAgaWYgKCFjb25zdHJ1Y3Rvci5pbXBsZW1lbnQpIGNvbnN0cnVjdG9yLmltcGxlbWVudCA9IGltcGxlbWVudFxuXG4gICAgdmFyIG1peGlucyA9IHByb3RvLm1peGluXG4gICAgaWYgKG1peGlucyl7XG4gICAgICAgIGlmICh0eXBlKG1peGlucykgIT09IFwiYXJyYXlcIikgbWl4aW5zID0gW21peGluc11cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtaXhpbnMubGVuZ3RoOyBpKyspIGNvbnN0cnVjdG9yLmltcGxlbWVudChjcmVhdGUobWl4aW5zW2ldLnByb3RvdHlwZSkpXG4gICAgfVxuXG4gICAgLy8gaW1wbGVtZW50IHByb3RvIGFuZCByZXR1cm4gY29uc3RydWN0b3JcbiAgICByZXR1cm4gY29uc3RydWN0b3IuaW1wbGVtZW50KGZpbHRlcihwcm90bywgZnVuY3Rpb24odmFsdWUsIGtleSl7XG4gICAgICAgIHJldHVybiAha2V5Lm1hdGNoKHZlcmJzKVxuICAgIH0pKVxuXG59XG5cbm1vZHVsZS5leHBvcnRzID0gcHJpbWVcbiIsIi8qXG5vYmplY3Q6Y3JlYXRlXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBjcmVhdGUgPSBmdW5jdGlvbihzZWxmKXtcbiAgICB2YXIgY29uc3RydWN0b3IgPSBmdW5jdGlvbigpe31cbiAgICBjb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBzZWxmXG4gICAgcmV0dXJuIG5ldyBjb25zdHJ1Y3RvclxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZVxuIiwiLypcbm9iamVjdDpmaWx0ZXJcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGZvckluID0gcmVxdWlyZShcIi4vZm9ySW5cIilcblxudmFyIGZpbHRlciA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgdmFyIHJlc3VsdHMgPSB7fVxuICAgIGZvckluKHNlbGYsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpe1xuICAgICAgICBpZiAobWV0aG9kLmNhbGwoY29udGV4dCwgdmFsdWUsIGtleSwgc2VsZikpIHJlc3VsdHNba2V5XSA9IHZhbHVlXG4gICAgfSlcbiAgICByZXR1cm4gcmVzdWx0c1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZpbHRlclxuIiwiLypcbm9iamVjdDpmb3JJblxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgaGFzID0gcmVxdWlyZShcIi4vaGFzT3duXCIpXG5cbnZhciBmb3JJbiA9IGZ1bmN0aW9uKHNlbGYsIG1ldGhvZCwgY29udGV4dCl7XG4gICAgZm9yICh2YXIga2V5IGluIHNlbGYpIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2tleV0sIGtleSwgc2VsZikgPT09IGZhbHNlKSBicmVha1xuICAgIHJldHVybiBzZWxmXG59XG5cbmlmICghKHt2YWx1ZU9mOiAwfSkucHJvcGVydHlJc0VudW1lcmFibGUoXCJ2YWx1ZU9mXCIpKXsgLy8gZml4IGZvciBzdHVwaWQgSUUgZW51bWVyYXRpb24gYnVnXG5cbiAgICB2YXIgYnVnZ3kgPSBcImNvbnN0cnVjdG9yLHRvU3RyaW5nLHZhbHVlT2YsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZ1wiLnNwbGl0KFwiLFwiKVxuICAgIHZhciBwcm90byA9IE9iamVjdC5wcm90b3R5cGVcblxuICAgIGZvckluID0gZnVuY3Rpb24oc2VsZiwgbWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHNlbGYpIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCBzZWxmW2tleV0sIGtleSwgc2VsZikgPT09IGZhbHNlKSByZXR1cm4gc2VsZlxuICAgICAgICBmb3IgKHZhciBpID0gMDsga2V5ID0gYnVnZ3lbaV07IGkrKyl7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzZWxmW2tleV1cbiAgICAgICAgICAgIGlmICgodmFsdWUgIT09IHByb3RvW2tleV0gfHwgaGFzKHNlbGYsIGtleSkpICYmIG1ldGhvZC5jYWxsKGNvbnRleHQsIHZhbHVlLCBrZXksIHNlbGYpID09PSBmYWxzZSkgYnJlYWtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2VsZlxuICAgIH1cblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZvckluXG4iLCIvKlxub2JqZWN0OmZvck93blxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgZm9ySW4gID0gcmVxdWlyZShcIi4vZm9ySW5cIiksXG4gICAgaGFzT3duID0gcmVxdWlyZShcIi4vaGFzT3duXCIpXG5cbnZhciBmb3JPd24gPSBmdW5jdGlvbihzZWxmLCBtZXRob2QsIGNvbnRleHQpe1xuICAgIGZvckluKHNlbGYsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpe1xuICAgICAgICBpZiAoaGFzT3duKHNlbGYsIGtleSkpIHJldHVybiBtZXRob2QuY2FsbChjb250ZXh0LCB2YWx1ZSwga2V5LCBzZWxmKVxuICAgIH0pXG4gICAgcmV0dXJuIHNlbGZcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmb3JPd25cbiIsIi8qXG5vYmplY3Q6aGFzT3duXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5oYXNPd25Qcm9wZXJ0eVxuXG52YXIgaGFzT3duID0gZnVuY3Rpb24oc2VsZiwga2V5KXtcbiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChzZWxmLCBrZXkpXG59XG5cbm1vZHVsZS5leHBvcnRzID0gaGFzT3duXG4iLCIvKlxub2JqZWN0Om1peEluXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBmb3JPd24gPSByZXF1aXJlKFwiLi9mb3JPd25cIilcblxudmFyIGNvcHkgPSBmdW5jdGlvbih2YWx1ZSwga2V5KXtcbiAgICB0aGlzW2tleV0gPSB2YWx1ZVxufVxuXG52YXIgbWl4SW4gPSBmdW5jdGlvbihzZWxmKXtcbiAgICBmb3IgKHZhciBpID0gMSwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIGZvck93bihhcmd1bWVudHNbaV0sIGNvcHksIHNlbGYpXG4gICAgcmV0dXJuIHNlbGZcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBtaXhJblxuIiwiLypcbnN0cmluZzpjYW1lbGl6ZVxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgY2FtZWxpemUgPSBmdW5jdGlvbihzZWxmKXtcbiAgICByZXR1cm4gKHNlbGYgKyBcIlwiKS5yZXBsYWNlKC8tXFxEL2csIGZ1bmN0aW9uKG1hdGNoKXtcbiAgICAgICAgcmV0dXJuIG1hdGNoLmNoYXJBdCgxKS50b1VwcGVyQ2FzZSgpXG4gICAgfSlcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjYW1lbGl6ZVxuIiwiLypcbnN0cmluZzpjYXBpdGFsaXplXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBjYXBpdGFsaXplID0gZnVuY3Rpb24oc2VsZil7XG4gICAgcmV0dXJuIChzZWxmICsgXCJcIikucmVwbGFjZSgvXFxiW2Etel0vZywgZnVuY3Rpb24obWF0Y2gpe1xuICAgICAgICByZXR1cm4gbWF0Y2gudG9VcHBlckNhc2UoKVxuICAgIH0pXG59XG5cbm1vZHVsZS5leHBvcnRzID0gY2FwaXRhbGl6ZVxuIiwiLypcbnN0cmluZzpjbGVhblxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgdHJpbSA9IHJlcXVpcmUoXCIuL3RyaW1cIilcblxudmFyIGNsZWFuID0gZnVuY3Rpb24oc2VsZil7XG4gICAgcmV0dXJuIHRyaW0oKHNlbGYgKyBcIlwiKS5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKSlcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjbGVhblxuIiwiLypcbnN0cmluZzpoeXBoZW5hdGVcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGh5cGhlbmF0ZSA9IGZ1bmN0aW9uKHNlbGYpe1xuICAgIHJldHVybiAoc2VsZiArIFwiXCIpLnJlcGxhY2UoL1tBLVpdL2csIGZ1bmN0aW9uKG1hdGNoKXtcbiAgICAgICAgcmV0dXJuICctJyArIG1hdGNoLnRvTG93ZXJDYXNlKClcbiAgICB9KVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGh5cGhlbmF0ZVxuIiwiLypcbnN0cmluZzp0cmltXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciB0cmltID0gZnVuY3Rpb24oc2VsZil7XG4gICAgcmV0dXJuIChzZWxmICsgXCJcIikucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIilcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB0cmltXG4iLCIvKlxudHlwZVxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgIHR5cGVzID0gL251bWJlcnxvYmplY3R8YXJyYXl8c3RyaW5nfGZ1bmN0aW9ufGRhdGV8cmVnZXhwfGJvb2xlYW4vXG5cbnZhciB0eXBlID0gZnVuY3Rpb24ob2JqZWN0KXtcbiAgICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiBcIm51bGxcIlxuICAgIHZhciBzdHJpbmcgPSB0b1N0cmluZy5jYWxsKG9iamVjdCkuc2xpY2UoOCwgLTEpLnRvTG93ZXJDYXNlKClcbiAgICBpZiAoc3RyaW5nID09PSBcIm51bWJlclwiICYmIGlzTmFOKG9iamVjdCkpIHJldHVybiBcIm51bGxcIlxuICAgIGlmICh0eXBlcy50ZXN0KHN0cmluZykpIHJldHVybiBzdHJpbmdcbiAgICByZXR1cm4gXCJvYmplY3RcIlxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHR5cGVcbiIsIlxuXG4gICAgLyoqXG4gICAgICogQXBwZW5kcyBhbiBhcnJheSB0byB0aGUgZW5kIG9mIGFub3RoZXIuXG4gICAgICogVGhlIGZpcnN0IGFycmF5IHdpbGwgYmUgbW9kaWZpZWQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gYXBwZW5kKGFycjEsIGFycjIpIHtcbiAgICAgICAgaWYgKGFycjIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGFycjE7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcGFkID0gYXJyMS5sZW5ndGgsXG4gICAgICAgICAgICBpID0gLTEsXG4gICAgICAgICAgICBsZW4gPSBhcnIyLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikge1xuICAgICAgICAgICAgYXJyMVtwYWQgKyBpXSA9IGFycjJbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycjE7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gYXBwZW5kO1xuXG4iLCJ2YXIgaW5kZXhPZiA9IHJlcXVpcmUoJy4vaW5kZXhPZicpO1xuXG4gICAgLyoqXG4gICAgICogQ29tYmluZXMgYW4gYXJyYXkgd2l0aCBhbGwgdGhlIGl0ZW1zIG9mIGFub3RoZXIuXG4gICAgICogRG9lcyBub3QgYWxsb3cgZHVwbGljYXRlcyBhbmQgaXMgY2FzZSBhbmQgdHlwZSBzZW5zaXRpdmUuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29tYmluZShhcnIxLCBhcnIyKSB7XG4gICAgICAgIGlmIChhcnIyID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBhcnIxO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGkgPSAtMSwgbGVuID0gYXJyMi5sZW5ndGg7XG4gICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHtcbiAgICAgICAgICAgIGlmIChpbmRleE9mKGFycjEsIGFycjJbaV0pID09PSAtMSkge1xuICAgICAgICAgICAgICAgIGFycjEucHVzaChhcnIyW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcnIxO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNvbWJpbmU7XG5cbiIsInZhciBpbmRleE9mID0gcmVxdWlyZSgnLi9pbmRleE9mJyk7XG5cbiAgICAvKipcbiAgICAgKiBJZiBhcnJheSBjb250YWlucyB2YWx1ZXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29udGFpbnMoYXJyLCB2YWwpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4T2YoYXJyLCB2YWwpICE9PSAtMTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBjb250YWlucztcblxuIiwidmFyIHVuaXF1ZSA9IHJlcXVpcmUoJy4vdW5pcXVlJyk7XG52YXIgZmlsdGVyID0gcmVxdWlyZSgnLi9maWx0ZXInKTtcbnZhciBzb21lID0gcmVxdWlyZSgnLi9zb21lJyk7XG52YXIgY29udGFpbnMgPSByZXF1aXJlKCcuL2NvbnRhaW5zJyk7XG52YXIgc2xpY2UgPSByZXF1aXJlKCcuL3NsaWNlJyk7XG5cblxuICAgIC8qKlxuICAgICAqIFJldHVybiBhIG5ldyBBcnJheSB3aXRoIGVsZW1lbnRzIHRoYXQgYXJlbid0IHByZXNlbnQgaW4gdGhlIG90aGVyIEFycmF5cy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkaWZmZXJlbmNlKGFycikge1xuICAgICAgICB2YXIgYXJycyA9IHNsaWNlKGFyZ3VtZW50cywgMSksXG4gICAgICAgICAgICByZXN1bHQgPSBmaWx0ZXIodW5pcXVlKGFyciksIGZ1bmN0aW9uKG5lZWRsZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFzb21lKGFycnMsIGZ1bmN0aW9uKGhheXN0YWNrKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5zKGhheXN0YWNrLCBuZWVkbGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBkaWZmZXJlbmNlO1xuXG5cbiIsInZhciBpcyA9IHJlcXVpcmUoJy4uL2xhbmcvaXMnKTtcbnZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi4vbGFuZy9pc0FycmF5Jyk7XG52YXIgZXZlcnkgPSByZXF1aXJlKCcuL2V2ZXJ5Jyk7XG5cbiAgICAvKipcbiAgICAgKiBDb21wYXJlcyBpZiBib3RoIGFycmF5cyBoYXZlIHRoZSBzYW1lIGVsZW1lbnRzXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXF1YWxzKGEsIGIsIGNhbGxiYWNrKXtcbiAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBpcztcblxuICAgICAgICBpZiAoIWlzQXJyYXkoYSkgfHwgIWlzQXJyYXkoYikpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhhLCBiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBldmVyeShhLCBtYWtlQ29tcGFyZShjYWxsYmFjayksIGIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VDb21wYXJlKGNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIGkgaW4gdGhpcyAmJiBjYWxsYmFjayh2YWx1ZSwgdGhpc1tpXSk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBlcXVhbHM7XG5cblxuIiwidmFyIGZpbmRJbmRleCA9IHJlcXVpcmUoJy4vZmluZEluZGV4Jyk7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGZpcnN0IGl0ZW0gdGhhdCBtYXRjaGVzIGNyaXRlcmlhXG4gICAgICovXG4gICAgZnVuY3Rpb24gZmluZChhcnIsIGl0ZXJhdG9yLCB0aGlzT2JqKXtcbiAgICAgICAgdmFyIGlkeCA9IGZpbmRJbmRleChhcnIsIGl0ZXJhdG9yLCB0aGlzT2JqKTtcbiAgICAgICAgcmV0dXJuIGlkeCA+PSAwPyBhcnJbaWR4XSA6IHZvaWQoMCk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmaW5kO1xuXG5cbiIsInZhciBtYWtlSXRlcmF0b3IgPSByZXF1aXJlKCcuLi9mdW5jdGlvbi9tYWtlSXRlcmF0b3JfJyk7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZmlyc3QgaXRlbSB0aGF0IG1hdGNoZXMgY3JpdGVyaWFcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmaW5kSW5kZXgoYXJyLCBpdGVyYXRvciwgdGhpc09iail7XG4gICAgICAgIGl0ZXJhdG9yID0gbWFrZUl0ZXJhdG9yKGl0ZXJhdG9yLCB0aGlzT2JqKTtcbiAgICAgICAgaWYgKGFyciA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaSA9IC0xLCBsZW4gPSBhcnIubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7XG4gICAgICAgICAgICBpZiAoaXRlcmF0b3IoYXJyW2ldLCBpLCBhcnIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmaW5kSW5kZXg7XG5cbiIsInZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi4vbGFuZy9pc0FycmF5Jyk7XG52YXIgYXBwZW5kID0gcmVxdWlyZSgnLi9hcHBlbmQnKTtcblxuICAgIC8qXG4gICAgICogSGVscGVyIGZ1bmN0aW9uIHRvIGZsYXR0ZW4gdG8gYSBkZXN0aW5hdGlvbiBhcnJheS5cbiAgICAgKiBVc2VkIHRvIHJlbW92ZSB0aGUgbmVlZCB0byBjcmVhdGUgaW50ZXJtZWRpYXRlIGFycmF5cyB3aGlsZSBmbGF0dGVuaW5nLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZsYXR0ZW5UbyhhcnIsIHJlc3VsdCwgbGV2ZWwpIHtcbiAgICAgICAgaWYgKGFyciA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9IGVsc2UgaWYgKGxldmVsID09PSAwKSB7XG4gICAgICAgICAgICBhcHBlbmQocmVzdWx0LCBhcnIpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB2YWx1ZSxcbiAgICAgICAgICAgIGkgPSAtMSxcbiAgICAgICAgICAgIGxlbiA9IGFyci5sZW5ndGg7XG4gICAgICAgIHdoaWxlICgrK2kgPCBsZW4pIHtcbiAgICAgICAgICAgIHZhbHVlID0gYXJyW2ldO1xuICAgICAgICAgICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgZmxhdHRlblRvKHZhbHVlLCByZXN1bHQsIGxldmVsIC0gMSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlY3Vyc2l2ZWx5IGZsYXR0ZW5zIGFuIGFycmF5LlxuICAgICAqIEEgbmV3IGFycmF5IGNvbnRhaW5pbmcgYWxsIHRoZSBlbGVtZW50cyBpcyByZXR1cm5lZC5cbiAgICAgKiBJZiBgc2hhbGxvd2AgaXMgdHJ1ZSwgaXQgd2lsbCBvbmx5IGZsYXR0ZW4gb25lIGxldmVsLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyLCBsZXZlbCkge1xuICAgICAgICBsZXZlbCA9IGxldmVsID09IG51bGw/IC0xIDogbGV2ZWw7XG4gICAgICAgIHJldHVybiBmbGF0dGVuVG8oYXJyLCBbXSwgbGV2ZWwpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZmxhdHRlbjtcblxuXG5cbiIsInZhciBkaWZmZXJlbmNlID0gcmVxdWlyZSgnLi9kaWZmZXJlbmNlJyk7XG52YXIgc2xpY2UgPSByZXF1aXJlKCcuL3NsaWNlJyk7XG5cbiAgICAvKipcbiAgICAgKiBJbnNlcnQgaXRlbSBpbnRvIGFycmF5IGlmIG5vdCBhbHJlYWR5IHByZXNlbnQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaW5zZXJ0KGFyciwgcmVzdF9pdGVtcykge1xuICAgICAgICB2YXIgZGlmZiA9IGRpZmZlcmVuY2Uoc2xpY2UoYXJndW1lbnRzLCAxKSwgYXJyKTtcbiAgICAgICAgaWYgKGRpZmYubGVuZ3RoKSB7XG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShhcnIsIGRpZmYpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcnIubGVuZ3RoO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGluc2VydDtcblxuIiwidmFyIHNsaWNlID0gcmVxdWlyZSgnLi9zbGljZScpO1xuXG4gICAgLyoqXG4gICAgICogQ2FsbCBgbWV0aG9kTmFtZWAgb24gZWFjaCBpdGVtIG9mIHRoZSBhcnJheSBwYXNzaW5nIGN1c3RvbSBhcmd1bWVudHMgaWZcbiAgICAgKiBuZWVkZWQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaW52b2tlKGFyciwgbWV0aG9kTmFtZSwgdmFyX2FyZ3Mpe1xuICAgICAgICBpZiAoYXJyID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBhcnI7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYXJncyA9IHNsaWNlKGFyZ3VtZW50cywgMik7XG4gICAgICAgIHZhciBpID0gLTEsIGxlbiA9IGFyci5sZW5ndGgsIHZhbHVlO1xuICAgICAgICB3aGlsZSAoKytpIDwgbGVuKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IGFycltpXTtcbiAgICAgICAgICAgIHZhbHVlW21ldGhvZE5hbWVdLmFwcGx5KHZhbHVlLCBhcmdzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcnI7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpbnZva2U7XG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBsYXN0IGVsZW1lbnQgb2YgYXJyYXkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gbGFzdChhcnIpe1xuICAgICAgICBpZiAoYXJyID09IG51bGwgfHwgYXJyLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXJyW2Fyci5sZW5ndGggLSAxXTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGxhc3Q7XG5cblxuIiwidmFyIGluZGV4T2YgPSByZXF1aXJlKCcuL2luZGV4T2YnKTtcblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhbGwgaW5zdGFuY2VzIG9mIGFuIGl0ZW0gZnJvbSBhcnJheS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW1vdmVBbGwoYXJyLCBpdGVtKXtcbiAgICAgICAgdmFyIGlkeCA9IGluZGV4T2YoYXJyLCBpdGVtKTtcbiAgICAgICAgd2hpbGUgKGlkeCAhPT0gLTEpIHtcbiAgICAgICAgICAgIGFyci5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgICAgIGlkeCA9IGluZGV4T2YoYXJyLCBpdGVtLCBpZHgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSByZW1vdmVBbGw7XG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHNsaWNlIG9mIHNvdXJjZSBhcnJheSBvciBhcnJheS1saWtlIG9iamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNsaWNlKGFyciwgc3RhcnQsIGVuZCl7XG4gICAgICAgIHZhciBsZW4gPSBhcnIubGVuZ3RoO1xuXG4gICAgICAgIGlmIChzdGFydCA9PSBudWxsKSB7XG4gICAgICAgICAgICBzdGFydCA9IDA7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnQgPCAwKSB7XG4gICAgICAgICAgICBzdGFydCA9IE1hdGgubWF4KGxlbiArIHN0YXJ0LCAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gTWF0aC5taW4oc3RhcnQsIGxlbik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW5kID09IG51bGwpIHtcbiAgICAgICAgICAgIGVuZCA9IGxlbjtcbiAgICAgICAgfSBlbHNlIGlmIChlbmQgPCAwKSB7XG4gICAgICAgICAgICBlbmQgPSBNYXRoLm1heChsZW4gKyBlbmQsIDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZW5kID0gTWF0aC5taW4oZW5kLCBsZW4pO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICB3aGlsZSAoc3RhcnQgPCBlbmQpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFycltzdGFydCsrXSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gc2xpY2U7XG5cblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBTcGxpdCBhcnJheSBpbnRvIGEgZml4ZWQgbnVtYmVyIG9mIHNlZ21lbnRzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNwbGl0KGFycmF5LCBzZWdtZW50cykge1xuICAgICAgICBzZWdtZW50cyA9IHNlZ21lbnRzIHx8IDI7XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIGlmIChhcnJheSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBtaW5MZW5ndGggPSBNYXRoLmZsb29yKGFycmF5Lmxlbmd0aCAvIHNlZ21lbnRzKSxcbiAgICAgICAgICAgIHJlbWFpbmRlciA9IGFycmF5Lmxlbmd0aCAlIHNlZ21lbnRzLFxuICAgICAgICAgICAgaSA9IDAsXG4gICAgICAgICAgICBsZW4gPSBhcnJheS5sZW5ndGgsXG4gICAgICAgICAgICBzZWdtZW50SW5kZXggPSAwLFxuICAgICAgICAgICAgc2VnbWVudExlbmd0aDtcblxuICAgICAgICB3aGlsZSAoaSA8IGxlbikge1xuICAgICAgICAgICAgc2VnbWVudExlbmd0aCA9IG1pbkxlbmd0aDtcbiAgICAgICAgICAgIGlmIChzZWdtZW50SW5kZXggPCByZW1haW5kZXIpIHtcbiAgICAgICAgICAgICAgICBzZWdtZW50TGVuZ3RoKys7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChhcnJheS5zbGljZShpLCBpICsgc2VnbWVudExlbmd0aCkpO1xuXG4gICAgICAgICAgICBzZWdtZW50SW5kZXgrKztcbiAgICAgICAgICAgIGkgKz0gc2VnbWVudExlbmd0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHNwbGl0O1xuXG4iLCJ2YXIgZmlsdGVyID0gcmVxdWlyZSgnLi9maWx0ZXInKTtcblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge2FycmF5fSBBcnJheSBvZiB1bmlxdWUgaXRlbXNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1bmlxdWUoYXJyLCBjb21wYXJlKXtcbiAgICAgICAgY29tcGFyZSA9IGNvbXBhcmUgfHwgaXNFcXVhbDtcbiAgICAgICAgcmV0dXJuIGZpbHRlcihhcnIsIGZ1bmN0aW9uKGl0ZW0sIGksIGFycil7XG4gICAgICAgICAgICB2YXIgbiA9IGFyci5sZW5ndGg7XG4gICAgICAgICAgICB3aGlsZSAoKytpIDwgbikge1xuICAgICAgICAgICAgICAgIGlmICggY29tcGFyZShpdGVtLCBhcnJbaV0pICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzRXF1YWwoYSwgYil7XG4gICAgICAgIHJldHVybiBhID09PSBiO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gdW5pcXVlO1xuXG5cbiIsInZhciBtYWtlID0gcmVxdWlyZSgnLi9tYWtlXycpO1xudmFyIGFyckZpbmQgPSByZXF1aXJlKCcuLi9hcnJheS9maW5kJyk7XG52YXIgb2JqRmluZCA9IHJlcXVpcmUoJy4uL29iamVjdC9maW5kJyk7XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIHZhbHVlIHRoYXQgcmV0dXJucyB0cnVlIG9uIGl0ZXJhdG9yIGNoZWNrLlxuICAgICAqL1xuICAgIG1vZHVsZS5leHBvcnRzID0gbWFrZShhcnJGaW5kLCBvYmpGaW5kKTtcblxuXG4iLCJ2YXIgbWFrZSA9IHJlcXVpcmUoJy4vbWFrZV8nKTtcbnZhciBhcnJGb3JFYWNoID0gcmVxdWlyZSgnLi4vYXJyYXkvZm9yRWFjaCcpO1xudmFyIG9iakZvckVhY2ggPSByZXF1aXJlKCcuLi9vYmplY3QvZm9yT3duJyk7XG5cbiAgICAvKipcbiAgICAgKi9cbiAgICBtb2R1bGUuZXhwb3J0cyA9IG1ha2UoYXJyRm9yRWFjaCwgb2JqRm9yRWFjaCk7XG5cblxuIiwidmFyIHNsaWNlID0gcmVxdWlyZSgnLi4vYXJyYXkvc2xpY2UnKTtcblxuICAgIC8qKlxuICAgICAqIGludGVybmFsIG1ldGhvZCB1c2VkIHRvIGNyZWF0ZSBvdGhlciBjb2xsZWN0aW9uIG1vZHVsZXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWFrZUNvbGxlY3Rpb25NZXRob2QoYXJyTWV0aG9kLCBvYmpNZXRob2QsIGRlZmF1bHRSZXR1cm4pIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgYXJncyA9IHNsaWNlKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICBpZiAoYXJnc1swXSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRSZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBhcnJheS1saWtlIGlzIHRyZWF0ZWQgYXMgYXJyYXlcbiAgICAgICAgICAgIHJldHVybiAodHlwZW9mIGFyZ3NbMF0ubGVuZ3RoID09PSAnbnVtYmVyJyk/IGFyck1ldGhvZC5hcHBseShudWxsLCBhcmdzKSA6IG9iak1ldGhvZC5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IG1ha2VDb2xsZWN0aW9uTWV0aG9kO1xuXG5cbiIsInZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi4vbGFuZy9pc0FycmF5Jyk7XG52YXIgb2JqU2l6ZSA9IHJlcXVpcmUoJy4uL29iamVjdC9zaXplJyk7XG5cbiAgICAvKipcbiAgICAgKiBHZXQgY29sbGVjdGlvbiBzaXplXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2l6ZShsaXN0KSB7XG4gICAgICAgIGlmICghbGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQXJyYXkobGlzdCkpIHtcbiAgICAgICAgICAgIHJldHVybiBsaXN0Lmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2JqU2l6ZShsaXN0KTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHNpemU7XG5cblxuIiwidmFyIHNsaWNlID0gcmVxdWlyZSgnLi4vYXJyYXkvc2xpY2UnKTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybiBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBleGVjdXRlIGluIHRoZSBnaXZlbiBjb250ZXh0LCBvcHRpb25hbGx5IGFkZGluZyBhbnkgYWRkaXRpb25hbCBzdXBwbGllZCBwYXJhbWV0ZXJzIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGFyZ3VtZW50cyBjb2xsZWN0aW9uLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuICBGdW5jdGlvbi5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gY29udGV4dCAgIEV4ZWN1dGlvbiBjb250ZXh0LlxuICAgICAqIEBwYXJhbSB7cmVzdH0gYXJncyAgICBBcmd1bWVudHMgKDAuLi5uIGFyZ3VtZW50cykuXG4gICAgICogQHJldHVybiB7RnVuY3Rpb259IFdyYXBwZWQgRnVuY3Rpb24uXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmluZChmbiwgY29udGV4dCwgYXJncyl7XG4gICAgICAgIHZhciBhcmdzQXJyID0gc2xpY2UoYXJndW1lbnRzLCAyKTsgLy9jdXJyaWVkIGFyZ3NcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkoY29udGV4dCwgYXJnc0Fyci5jb25jYXQoc2xpY2UoYXJndW1lbnRzKSkpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gYmluZDtcblxuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIERlYm91bmNlIGNhbGxiYWNrIGV4ZWN1dGlvblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlYm91bmNlKGZuLCB0aHJlc2hvbGQsIGlzQXNhcCl7XG4gICAgICAgIHZhciB0aW1lb3V0LCByZXN1bHQ7XG4gICAgICAgIGZ1bmN0aW9uIGRlYm91bmNlZCgpe1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsIGNvbnRleHQgPSB0aGlzO1xuICAgICAgICAgICAgZnVuY3Rpb24gZGVsYXllZCgpe1xuICAgICAgICAgICAgICAgIGlmICghIGlzQXNhcCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmbi5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBc2FwKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZm4uYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChkZWxheWVkLCB0aHJlc2hvbGQpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBkZWJvdW5jZWQuY2FuY2VsID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRlYm91bmNlZDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGRlYm91bmNlO1xuXG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBleGVjdXRlIGEgbGlzdCBvZiBmdW5jdGlvbnMgaW4gc2VxdWVuY2VcbiAgICAgKiBwYXNzaW5nIHRoZSBzYW1lIGFyZ3VtZW50cyB0byBlYWNoIG9uZS4gKHVzZWZ1bCBmb3IgYmF0Y2ggcHJvY2Vzc2luZ1xuICAgICAqIGl0ZW1zIGR1cmluZyBhIGZvckVhY2ggbG9vcClcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZXJpZXMoKXtcbiAgICAgICAgdmFyIGZucyA9IGFyZ3VtZW50cztcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICAgICAgbiA9IGZucy5sZW5ndGg7XG4gICAgICAgICAgICB3aGlsZSAoaSA8IG4pIHtcbiAgICAgICAgICAgICAgICBmbnNbaV0uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICBpICs9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBzZXJpZXM7XG5cblxuIiwidmFyIGtpbmRPZiA9IHJlcXVpcmUoJy4va2luZE9mJyk7XG52YXIgaXNQbGFpbk9iamVjdCA9IHJlcXVpcmUoJy4vaXNQbGFpbk9iamVjdCcpO1xudmFyIG1peEluID0gcmVxdWlyZSgnLi4vb2JqZWN0L21peEluJyk7XG5cbiAgICAvKipcbiAgICAgKiBDbG9uZSBuYXRpdmUgdHlwZXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvbmUodmFsKXtcbiAgICAgICAgc3dpdGNoIChraW5kT2YodmFsKSkge1xuICAgICAgICAgICAgY2FzZSAnT2JqZWN0JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmVPYmplY3QodmFsKTtcbiAgICAgICAgICAgIGNhc2UgJ0FycmF5JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmVBcnJheSh2YWwpO1xuICAgICAgICAgICAgY2FzZSAnUmVnRXhwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmVSZWdFeHAodmFsKTtcbiAgICAgICAgICAgIGNhc2UgJ0RhdGUnOlxuICAgICAgICAgICAgICAgIHJldHVybiBjbG9uZURhdGUodmFsKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb25lT2JqZWN0KHNvdXJjZSkge1xuICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChzb3VyY2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gbWl4SW4oe30sIHNvdXJjZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc291cmNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xvbmVSZWdFeHAocikge1xuICAgICAgICB2YXIgZmxhZ3MgPSAnJztcbiAgICAgICAgZmxhZ3MgKz0gci5tdWx0aWxpbmUgPyAnbScgOiAnJztcbiAgICAgICAgZmxhZ3MgKz0gci5nbG9iYWwgPyAnZycgOiAnJztcbiAgICAgICAgZmxhZ3MgKz0gci5pZ25vcmVDYXNlID8gJ2knIDogJyc7XG4gICAgICAgIHJldHVybiBuZXcgUmVnRXhwKHIuc291cmNlLCBmbGFncyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xvbmVEYXRlKGRhdGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCtkYXRlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9uZUFycmF5KGFycikge1xuICAgICAgICByZXR1cm4gYXJyLnNsaWNlKCk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBjbG9uZTtcblxuXG4iLCJ2YXIgY2xvbmUgPSByZXF1aXJlKCcuL2Nsb25lJyk7XG52YXIgZm9yT3duID0gcmVxdWlyZSgnLi4vb2JqZWN0L2Zvck93bicpO1xudmFyIGtpbmRPZiA9IHJlcXVpcmUoJy4va2luZE9mJyk7XG52YXIgaXNQbGFpbk9iamVjdCA9IHJlcXVpcmUoJy4vaXNQbGFpbk9iamVjdCcpO1xuXG4gICAgLyoqXG4gICAgICogUmVjdXJzaXZlbHkgY2xvbmUgbmF0aXZlIHR5cGVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlZXBDbG9uZSh2YWwsIGluc3RhbmNlQ2xvbmUpIHtcbiAgICAgICAgc3dpdGNoICgga2luZE9mKHZhbCkgKSB7XG4gICAgICAgICAgICBjYXNlICdPYmplY3QnOlxuICAgICAgICAgICAgICAgIHJldHVybiBjbG9uZU9iamVjdCh2YWwsIGluc3RhbmNlQ2xvbmUpO1xuICAgICAgICAgICAgY2FzZSAnQXJyYXknOlxuICAgICAgICAgICAgICAgIHJldHVybiBjbG9uZUFycmF5KHZhbCwgaW5zdGFuY2VDbG9uZSk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBjbG9uZSh2YWwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xvbmVPYmplY3Qoc291cmNlLCBpbnN0YW5jZUNsb25lKSB7XG4gICAgICAgIGlmIChpc1BsYWluT2JqZWN0KHNvdXJjZSkpIHtcbiAgICAgICAgICAgIHZhciBvdXQgPSB7fTtcbiAgICAgICAgICAgIGZvck93bihzb3VyY2UsIGZ1bmN0aW9uKHZhbCwga2V5KSB7XG4gICAgICAgICAgICAgICAgdGhpc1trZXldID0gZGVlcENsb25lKHZhbCwgaW5zdGFuY2VDbG9uZSk7XG4gICAgICAgICAgICB9LCBvdXQpO1xuICAgICAgICAgICAgcmV0dXJuIG91dDtcbiAgICAgICAgfSBlbHNlIGlmIChpbnN0YW5jZUNsb25lKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5zdGFuY2VDbG9uZShzb3VyY2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb25lQXJyYXkoYXJyLCBpbnN0YW5jZUNsb25lKSB7XG4gICAgICAgIHZhciBvdXQgPSBbXSxcbiAgICAgICAgICAgIGkgPSAtMSxcbiAgICAgICAgICAgIG4gPSBhcnIubGVuZ3RoLFxuICAgICAgICAgICAgdmFsO1xuICAgICAgICB3aGlsZSAoKytpIDwgbikge1xuICAgICAgICAgICAgb3V0W2ldID0gZGVlcENsb25lKGFycltpXSwgaW5zdGFuY2VDbG9uZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGRlZXBDbG9uZTtcblxuXG5cbiIsInZhciBpcyA9IHJlcXVpcmUoJy4vaXMnKTtcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vaXNPYmplY3QnKTtcbnZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi9pc0FycmF5Jyk7XG52YXIgb2JqRXF1YWxzID0gcmVxdWlyZSgnLi4vb2JqZWN0L2VxdWFscycpO1xudmFyIGFyckVxdWFscyA9IHJlcXVpcmUoJy4uL2FycmF5L2VxdWFscycpO1xuXG4gICAgLyoqXG4gICAgICogUmVjdXJzaXZlbHkgY2hlY2tzIGZvciBzYW1lIHByb3BlcnRpZXMgYW5kIHZhbHVlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWVwRXF1YWxzKGEsIGIsIGNhbGxiYWNrKXtcbiAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBpcztcblxuICAgICAgICB2YXIgYm90aE9iamVjdHMgPSBpc09iamVjdChhKSAmJiBpc09iamVjdChiKTtcbiAgICAgICAgdmFyIGJvdGhBcnJheXMgPSAhYm90aE9iamVjdHMgJiYgaXNBcnJheShhKSAmJiBpc0FycmF5KGIpO1xuXG4gICAgICAgIGlmICghYm90aE9iamVjdHMgJiYgIWJvdGhBcnJheXMpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhhLCBiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNvbXBhcmUoYSwgYil7XG4gICAgICAgICAgICByZXR1cm4gZGVlcEVxdWFscyhhLCBiLCBjYWxsYmFjayk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbWV0aG9kID0gYm90aE9iamVjdHMgPyBvYmpFcXVhbHMgOiBhcnJFcXVhbHM7XG4gICAgICAgIHJldHVybiBtZXRob2QoYSwgYiwgY29tcGFyZSk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBkZWVwRXF1YWxzO1xuXG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgYm90aCBhcmd1bWVudHMgYXJlIGVnYWwuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXMoeCwgeSl7XG4gICAgICAgIC8vIGltcGxlbWVudGF0aW9uIGJvcnJvd2VkIGZyb20gaGFybW9ueTplZ2FsIHNwZWNcbiAgICAgICAgaWYgKHggPT09IHkpIHtcbiAgICAgICAgICAvLyAwID09PSAtMCwgYnV0IHRoZXkgYXJlIG5vdCBpZGVudGljYWxcbiAgICAgICAgICByZXR1cm4geCAhPT0gMCB8fCAxIC8geCA9PT0gMSAvIHk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBOYU4gIT09IE5hTiwgYnV0IHRoZXkgYXJlIGlkZW50aWNhbC5cbiAgICAgICAgLy8gTmFOcyBhcmUgdGhlIG9ubHkgbm9uLXJlZmxleGl2ZSB2YWx1ZSwgaS5lLiwgaWYgeCAhPT0geCxcbiAgICAgICAgLy8gdGhlbiB4IGlzIGEgTmFOLlxuICAgICAgICAvLyBpc05hTiBpcyBicm9rZW46IGl0IGNvbnZlcnRzIGl0cyBhcmd1bWVudCB0byBudW1iZXIsIHNvXG4gICAgICAgIC8vIGlzTmFOKFwiZm9vXCIpID0+IHRydWVcbiAgICAgICAgcmV0dXJuIHggIT09IHggJiYgeSAhPT0geTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGlzO1xuXG5cbiIsInZhciBpc0tpbmQgPSByZXF1aXJlKCcuL2lzS2luZCcpO1xuICAgIC8qKlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzQm9vbGVhbih2YWwpIHtcbiAgICAgICAgcmV0dXJuIGlzS2luZCh2YWwsICdCb29sZWFuJyk7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gaXNCb29sZWFuO1xuXG4iLCJ2YXIgaXNLaW5kID0gcmVxdWlyZSgnLi9pc0tpbmQnKTtcbiAgICAvKipcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc051bWJlcih2YWwpIHtcbiAgICAgICAgcmV0dXJuIGlzS2luZCh2YWwsICdOdW1iZXInKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpc051bWJlcjtcblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgdGhlIHZhbHVlIGlzIGNyZWF0ZWQgYnkgdGhlIGBPYmplY3RgIGNvbnN0cnVjdG9yLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzUGxhaW5PYmplY3QodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuICghIXZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgICAgIHZhbHVlLmNvbnN0cnVjdG9yID09PSBPYmplY3QpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gaXNQbGFpbk9iamVjdDtcblxuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgb2JqZWN0IGlzIGEgcHJpbWl0aXZlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNQcmltaXRpdmUodmFsdWUpIHtcbiAgICAgICAgLy8gVXNpbmcgc3dpdGNoIGZhbGx0aHJvdWdoIGJlY2F1c2UgaXQncyBzaW1wbGUgdG8gcmVhZCBhbmQgaXNcbiAgICAgICAgLy8gZ2VuZXJhbGx5IGZhc3Q6IGh0dHA6Ly9qc3BlcmYuY29tL3Rlc3RpbmctdmFsdWUtaXMtcHJpbWl0aXZlLzVcbiAgICAgICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgICAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgICAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGlzUHJpbWl0aXZlO1xuXG5cbiIsInZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi9pc0FycmF5Jyk7XG5cbiAgICAvKipcbiAgICAgKiBjb3ZlcnQgdmFsdWUgaW50byBudW1iZXIgaWYgbnVtZXJpY1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvTnVtYmVyKHZhbCl7XG4gICAgICAgIC8vIG51bWJlcmljIHZhbHVlcyBzaG91bGQgY29tZSBmaXJzdCBiZWNhdXNlIG9mIC0wXG4gICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykgcmV0dXJuIHZhbDtcbiAgICAgICAgLy8gd2Ugd2FudCBhbGwgZmFsc3kgdmFsdWVzIChiZXNpZGVzIC0wKSB0byByZXR1cm4gemVybyB0byBhdm9pZFxuICAgICAgICAvLyBoZWFkYWNoZXNcbiAgICAgICAgaWYgKCF2YWwpIHJldHVybiAwO1xuICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHJldHVybiBwYXJzZUZsb2F0KHZhbCk7XG4gICAgICAgIC8vIGFycmF5cyBhcmUgZWRnZSBjYXNlcy4gYE51bWJlcihbNF0pID09PSA0YFxuICAgICAgICBpZiAoaXNBcnJheSh2YWwpKSByZXR1cm4gTmFOO1xuICAgICAgICByZXR1cm4gTnVtYmVyKHZhbCk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSB0b051bWJlcjtcblxuXG4iLCJcbiAgICAvKipcbiAgICAgKiBDbGFtcHMgdmFsdWUgaW5zaWRlIHJhbmdlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsYW1wKHZhbCwgbWluLCBtYXgpe1xuICAgICAgICByZXR1cm4gdmFsIDwgbWluPyBtaW4gOiAodmFsID4gbWF4PyBtYXggOiB2YWwpO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNsYW1wO1xuXG4iLCJcbiAgICAvKipcbiAgICAqIExpbmVhciBpbnRlcnBvbGF0aW9uLlxuICAgICogSU1QT1JUQU5UOndpbGwgcmV0dXJuIGBJbmZpbml0eWAgaWYgbnVtYmVycyBvdmVyZmxvdyBOdW1iZXIuTUFYX1ZBTFVFXG4gICAgKi9cbiAgICBmdW5jdGlvbiBsZXJwKHJhdGlvLCBzdGFydCwgZW5kKXtcbiAgICAgICAgcmV0dXJuIHN0YXJ0ICsgKGVuZCAtIHN0YXJ0KSAqIHJhdGlvO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gbGVycDtcblxuIiwidmFyIGxlcnAgPSByZXF1aXJlKCcuL2xlcnAnKTtcbnZhciBub3JtID0gcmVxdWlyZSgnLi9ub3JtJyk7XG4gICAgLyoqXG4gICAgKiBNYXBzIGEgbnVtYmVyIGZyb20gb25lIHNjYWxlIHRvIGFub3RoZXIuXG4gICAgKiBAZXhhbXBsZSBtYXAoMywgMCwgNCwgLTEsIDEpIC0+IDAuNVxuICAgICovXG4gICAgZnVuY3Rpb24gbWFwKHZhbCwgbWluMSwgbWF4MSwgbWluMiwgbWF4Mil7XG4gICAgICAgIHJldHVybiBsZXJwKCBub3JtKHZhbCwgbWluMSwgbWF4MSksIG1pbjIsIG1heDIgKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBtYXA7XG5cbiIsIlxuICAgIC8qKlxuICAgICogR2V0cyBub3JtYWxpemVkIHJhdGlvIG9mIHZhbHVlIGluc2lkZSByYW5nZS5cbiAgICAqL1xuICAgIGZ1bmN0aW9uIG5vcm0odmFsLCBtaW4sIG1heCl7XG4gICAgICAgIGlmICh2YWwgPCBtaW4gfHwgdmFsID4gbWF4KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigndmFsdWUgKCcgKyB2YWwgKyAnKSBtdXN0IGJlIGJldHdlZW4gJyArIG1pbiArICcgYW5kICcgKyBtYXgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbCA9PT0gbWF4ID8gMSA6ICh2YWwgLSBtaW4pIC8gKG1heCAtIG1pbik7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gbm9ybTtcblxuIiwiLyoqXG4gKiBAY29uc3RhbnQgTWF4aW11bSAzMi1iaXQgc2lnbmVkIGludGVnZXIgdmFsdWUuICgyXjMxIC0gMSlcbiAqL1xuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSAyMTQ3NDgzNjQ3O1xuXG4iLCIvKipcbiAqIEBjb25zdGFudCBNaW5pbXVtIDMyLWJpdCBzaWduZWQgaW50ZWdlciB2YWx1ZSAoLTJeMzEpLlxuICovXG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IC0yMTQ3NDgzNjQ4O1xuXG4iLCJ2YXIgdG9OdW1iZXIgPSByZXF1aXJlKCcuLi9sYW5nL3RvTnVtYmVyJyk7XG4gICAgLyoqXG4gICAgICogRW5mb3JjZSBhIHNwZWNpZmljIGFtb3VudCBvZiBkZWNpbWFsIGRpZ2l0cyBhbmQgYWxzbyBmaXggZmxvYXRpbmdcbiAgICAgKiBwb2ludCByb3VuZGluZyBpc3N1ZXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZW5mb3JjZVByZWNpc2lvbih2YWwsIG5EZWNpbWFsRGlnaXRzKXtcbiAgICAgICAgdmFsID0gdG9OdW1iZXIodmFsKTtcbiAgICAgICAgdmFyIHBvdyA9IE1hdGgucG93KDEwLCBuRGVjaW1hbERpZ2l0cyk7XG4gICAgICAgIHJldHVybiArKE1hdGgucm91bmQodmFsICogcG93KSAvIHBvdykudG9GaXhlZChuRGVjaW1hbERpZ2l0cyk7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0gZW5mb3JjZVByZWNpc2lvbjtcblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBcIkNvbnZlcnRcIiB2YWx1ZSBpbnRvIGFuIDMyLWJpdCBpbnRlZ2VyLlxuICAgICAqIFdvcmtzIGxpa2UgYE1hdGguZmxvb3JgIGlmIHZhbCA+IDAgYW5kIGBNYXRoLmNlaWxgIGlmIHZhbCA8IDAuXG4gICAgICogSU1QT1JUQU5UOiB2YWwgd2lsbCB3cmFwIGF0IDJeMzEgYW5kIC0yXjMxLlxuICAgICAqIFBlcmYgdGVzdHM6IGh0dHA6Ly9qc3BlcmYuY29tL3ZzLXZzLXBhcnNlaW50LWJpdHdpc2Utb3BlcmF0b3JzLzdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b0ludCh2YWwpe1xuICAgICAgICAvLyB3ZSBkbyBub3QgdXNlIGxhbmcvdG9OdW1iZXIgYmVjYXVzZSBvZiBwZXJmIGFuZCBhbHNvIGJlY2F1c2UgaXRcbiAgICAgICAgLy8gZG9lc24ndCBicmVhayB0aGUgZnVuY3Rpb25hbGl0eVxuICAgICAgICByZXR1cm4gfn52YWw7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSB0b0ludDtcblxuXG4iLCJ2YXIgZm9yT3duID0gcmVxdWlyZSgnLi9mb3JPd24nKTtcbnZhciBpc1BsYWluT2JqZWN0ID0gcmVxdWlyZSgnLi4vbGFuZy9pc1BsYWluT2JqZWN0Jyk7XG5cbiAgICAvKipcbiAgICAgKiBEZWVwbHkgY29weSBtaXNzaW5nIHByb3BlcnRpZXMgaW4gdGhlIHRhcmdldCBmcm9tIHRoZSBkZWZhdWx0cy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWVwRmlsbEluKHRhcmdldCwgZGVmYXVsdHMpe1xuICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICBuID0gYXJndW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICAgIG9iajtcblxuICAgICAgICB3aGlsZSgrK2kgPCBuKSB7XG4gICAgICAgICAgICBvYmogPSBhcmd1bWVudHNbaV07XG4gICAgICAgICAgICBpZiAob2JqKSB7XG4gICAgICAgICAgICAgICAgLy8ganNoaW50IGxvb3BmdW5jOiB0cnVlXG4gICAgICAgICAgICAgICAgZm9yT3duKG9iaiwgZnVuY3Rpb24obmV3VmFsdWUsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY3VyVmFsdWUgPSB0YXJnZXRba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1clZhbHVlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChjdXJWYWx1ZSkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1BsYWluT2JqZWN0KG5ld1ZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVlcEZpbGxJbihjdXJWYWx1ZSwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZGVlcEZpbGxJbjtcblxuXG4iLCJ2YXIgaGFzT3duID0gcmVxdWlyZSgnLi9oYXNPd24nKTtcbnZhciBldmVyeSA9IHJlcXVpcmUoJy4vZXZlcnknKTtcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4uL2xhbmcvaXNPYmplY3QnKTtcbnZhciBpcyA9IHJlcXVpcmUoJy4uL2xhbmcvaXMnKTtcblxuICAgIC8vIE1ha2VzIGEgZnVuY3Rpb24gdG8gY29tcGFyZSB0aGUgb2JqZWN0IHZhbHVlcyBmcm9tIHRoZSBzcGVjaWZpZWQgY29tcGFyZVxuICAgIC8vIG9wZXJhdGlvbiBjYWxsYmFjay5cbiAgICBmdW5jdGlvbiBtYWtlQ29tcGFyZShjYWxsYmFjaykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgICAgICAgcmV0dXJuIGhhc093bih0aGlzLCBrZXkpICYmIGNhbGxiYWNrKHZhbHVlLCB0aGlzW2tleV0pO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrUHJvcGVydGllcyh2YWx1ZSwga2V5KSB7XG4gICAgICAgIHJldHVybiBoYXNPd24odGhpcywga2V5KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgdHdvIG9iamVjdHMgaGF2ZSB0aGUgc2FtZSBrZXlzIGFuZCB2YWx1ZXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXF1YWxzKGEsIGIsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgaXM7XG5cbiAgICAgICAgaWYgKCFpc09iamVjdChhKSB8fCAhaXNPYmplY3QoYikpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhhLCBiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoZXZlcnkoYSwgbWFrZUNvbXBhcmUoY2FsbGJhY2spLCBiKSAmJlxuICAgICAgICAgICAgICAgIGV2ZXJ5KGIsIGNoZWNrUHJvcGVydGllcywgYSkpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZXF1YWxzO1xuXG4iLCJ2YXIgZm9yT3duID0gcmVxdWlyZSgnLi9mb3JPd24nKTtcbnZhciBtYWtlSXRlcmF0b3IgPSByZXF1aXJlKCcuLi9mdW5jdGlvbi9tYWtlSXRlcmF0b3JfJyk7XG5cbiAgICAvKipcbiAgICAgKiBPYmplY3QgZXZlcnlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBldmVyeShvYmosIGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGNhbGxiYWNrID0gbWFrZUl0ZXJhdG9yKGNhbGxiYWNrLCB0aGlzT2JqKTtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XG4gICAgICAgIGZvck93bihvYmosIGZ1bmN0aW9uKHZhbCwga2V5KSB7XG4gICAgICAgICAgICAvLyB3ZSBjb25zaWRlciBhbnkgZmFsc3kgdmFsdWVzIGFzIFwiZmFsc2VcIiBvbiBwdXJwb3NlIHNvIHNob3J0aGFuZFxuICAgICAgICAgICAgLy8gc3ludGF4IGNhbiBiZSB1c2VkIHRvIGNoZWNrIHByb3BlcnR5IGV4aXN0ZW5jZVxuICAgICAgICAgICAgaWYgKCFjYWxsYmFjayh2YWwsIGtleSwgb2JqKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBldmVyeTtcblxuXG4iLCJ2YXIgc29tZSA9IHJlcXVpcmUoJy4vc29tZScpO1xudmFyIG1ha2VJdGVyYXRvciA9IHJlcXVpcmUoJy4uL2Z1bmN0aW9uL21ha2VJdGVyYXRvcl8nKTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgZmlyc3QgaXRlbSB0aGF0IG1hdGNoZXMgY3JpdGVyaWFcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmaW5kKG9iaiwgY2FsbGJhY2ssIHRoaXNPYmopIHtcbiAgICAgICAgY2FsbGJhY2sgPSBtYWtlSXRlcmF0b3IoY2FsbGJhY2ssIHRoaXNPYmopO1xuICAgICAgICB2YXIgcmVzdWx0O1xuICAgICAgICBzb21lKG9iaiwgZnVuY3Rpb24odmFsdWUsIGtleSwgb2JqKSB7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2sodmFsdWUsIGtleSwgb2JqKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyAvL2JyZWFrXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZmluZDtcblxuXG4iLCJ2YXIgaXNQcmltaXRpdmUgPSByZXF1aXJlKCcuLi9sYW5nL2lzUHJpbWl0aXZlJyk7XG5cbiAgICAvKipcbiAgICAgKiBnZXQgXCJuZXN0ZWRcIiBvYmplY3QgcHJvcGVydHlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXQob2JqLCBwcm9wKXtcbiAgICAgICAgdmFyIHBhcnRzID0gcHJvcC5zcGxpdCgnLicpLFxuICAgICAgICAgICAgbGFzdCA9IHBhcnRzLnBvcCgpO1xuXG4gICAgICAgIHdoaWxlIChwcm9wID0gcGFydHMuc2hpZnQoKSkge1xuICAgICAgICAgICAgb2JqID0gb2JqW3Byb3BdO1xuICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb2JqW2xhc3RdO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gZ2V0O1xuXG5cbiIsInZhciBnZXQgPSByZXF1aXJlKCcuL2dldCcpO1xuXG4gICAgdmFyIFVOREVGO1xuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgb2JqZWN0IGhhcyBuZXN0ZWQgcHJvcGVydHkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzKG9iaiwgcHJvcCl7XG4gICAgICAgIHJldHVybiBnZXQob2JqLCBwcm9wKSAhPT0gVU5ERUY7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBoYXM7XG5cblxuXG4iLCJ2YXIgZm9yT3duID0gcmVxdWlyZSgnLi9mb3JPd24nKTtcblxuICAgIC8qKlxuICAgICAqIEdldCBvYmplY3Qga2V5c1xuICAgICAqL1xuICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIHZhciBrZXlzID0gW107XG4gICAgICAgICAgICBmb3JPd24ob2JqLCBmdW5jdGlvbih2YWwsIGtleSl7XG4gICAgICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBrZXlzO1xuICAgICAgICB9O1xuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBrZXlzO1xuXG5cbiIsInZhciBoYXNPd24gPSByZXF1aXJlKCcuL2hhc093bicpO1xudmFyIGRlZXBDbG9uZSA9IHJlcXVpcmUoJy4uL2xhbmcvZGVlcENsb25lJyk7XG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuLi9sYW5nL2lzT2JqZWN0Jyk7XG5cbiAgICAvKipcbiAgICAgKiBEZWVwIG1lcmdlIG9iamVjdHMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWVyZ2UoKSB7XG4gICAgICAgIHZhciBpID0gMSxcbiAgICAgICAgICAgIGtleSwgdmFsLCBvYmosIHRhcmdldDtcblxuICAgICAgICAvLyBtYWtlIHN1cmUgd2UgZG9uJ3QgbW9kaWZ5IHNvdXJjZSBlbGVtZW50IGFuZCBpdCdzIHByb3BlcnRpZXNcbiAgICAgICAgLy8gb2JqZWN0cyBhcmUgcGFzc2VkIGJ5IHJlZmVyZW5jZVxuICAgICAgICB0YXJnZXQgPSBkZWVwQ2xvbmUoIGFyZ3VtZW50c1swXSApO1xuXG4gICAgICAgIHdoaWxlIChvYmogPSBhcmd1bWVudHNbaSsrXSkge1xuICAgICAgICAgICAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAhIGhhc093bihvYmosIGtleSkgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhbCA9IG9ialtrZXldO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBpc09iamVjdCh2YWwpICYmIGlzT2JqZWN0KHRhcmdldFtrZXldKSApe1xuICAgICAgICAgICAgICAgICAgICAvLyBpbmNlcHRpb24sIGRlZXAgbWVyZ2Ugb2JqZWN0c1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IG1lcmdlKHRhcmdldFtrZXldLCB2YWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBhcnJheXMsIHJlZ2V4cCwgZGF0ZSwgb2JqZWN0cyBhcmUgY2xvbmVkXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gZGVlcENsb25lKHZhbCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gbWVyZ2U7XG5cblxuIiwidmFyIGZvckVhY2ggPSByZXF1aXJlKCcuLi9hcnJheS9mb3JFYWNoJyk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgbmVzdGVkIG9iamVjdCBpZiBub24tZXhpc3RlbnRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBuYW1lc3BhY2Uob2JqLCBwYXRoKXtcbiAgICAgICAgaWYgKCFwYXRoKSByZXR1cm4gb2JqO1xuICAgICAgICBmb3JFYWNoKHBhdGguc3BsaXQoJy4nKSwgZnVuY3Rpb24oa2V5KXtcbiAgICAgICAgICAgIGlmICghb2JqW2tleV0pIHtcbiAgICAgICAgICAgICAgICBvYmpba2V5XSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2JqID0gb2JqW2tleV07XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gbmFtZXNwYWNlO1xuXG5cbiIsInZhciBzbGljZSA9IHJlcXVpcmUoJy4uL2FycmF5L3NsaWNlJyk7XG52YXIgY29udGFpbnMgPSByZXF1aXJlKCcuLi9hcnJheS9jb250YWlucycpO1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGEgY29weSBvZiB0aGUgb2JqZWN0LCBmaWx0ZXJlZCB0byBvbmx5IGNvbnRhaW4gcHJvcGVydGllcyBleGNlcHQgdGhlIGJsYWNrbGlzdGVkIGtleXMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gb21pdChvYmosIHZhcl9rZXlzKXtcbiAgICAgICAgdmFyIGtleXMgPSB0eXBlb2YgYXJndW1lbnRzWzFdICE9PSAnc3RyaW5nJz8gYXJndW1lbnRzWzFdIDogc2xpY2UoYXJndW1lbnRzLCAxKSxcbiAgICAgICAgICAgIG91dCA9IHt9O1xuXG4gICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIG9iaikge1xuICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkgJiYgIWNvbnRhaW5zKGtleXMsIHByb3BlcnR5KSkge1xuICAgICAgICAgICAgICAgIG91dFtwcm9wZXJ0eV0gPSBvYmpbcHJvcGVydHldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBvbWl0O1xuXG5cbiIsInZhciBuYW1lc3BhY2UgPSByZXF1aXJlKCcuL25hbWVzcGFjZScpO1xuXG4gICAgLyoqXG4gICAgICogc2V0IFwibmVzdGVkXCIgb2JqZWN0IHByb3BlcnR5XG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0KG9iaiwgcHJvcCwgdmFsKXtcbiAgICAgICAgdmFyIHBhcnRzID0gKC9eKC4rKVxcLiguKykkLykuZXhlYyhwcm9wKTtcbiAgICAgICAgaWYgKHBhcnRzKXtcbiAgICAgICAgICAgIG5hbWVzcGFjZShvYmosIHBhcnRzWzFdKVtwYXJ0c1syXV0gPSB2YWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYmpbcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHNldDtcblxuXG4iLCJ2YXIgZm9yT3duID0gcmVxdWlyZSgnLi9mb3JPd24nKTtcblxuICAgIC8qKlxuICAgICAqIEdldCBvYmplY3Qgc2l6ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNpemUob2JqKSB7XG4gICAgICAgIHZhciBjb3VudCA9IDA7XG4gICAgICAgIGZvck93bihvYmosIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gc2l6ZTtcblxuXG4iLCJ2YXIgZm9yT3duID0gcmVxdWlyZSgnLi9mb3JPd24nKTtcbnZhciBtYWtlSXRlcmF0b3IgPSByZXF1aXJlKCcuLi9mdW5jdGlvbi9tYWtlSXRlcmF0b3JfJyk7XG5cbiAgICAvKipcbiAgICAgKiBPYmplY3Qgc29tZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNvbWUob2JqLCBjYWxsYmFjaywgdGhpc09iaikge1xuICAgICAgICBjYWxsYmFjayA9IG1ha2VJdGVyYXRvcihjYWxsYmFjaywgdGhpc09iaik7XG4gICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgZm9yT3duKG9iaiwgZnVuY3Rpb24odmFsLCBrZXkpIHtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayh2YWwsIGtleSwgb2JqKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHNvbWU7XG5cblxuIiwidmFyIGhhcyA9IHJlcXVpcmUoJy4vaGFzJyk7XG5cbiAgICAvKipcbiAgICAgKiBVbnNldCBvYmplY3QgcHJvcGVydHkuXG4gICAgICovXG4gICAgZnVuY3Rpb24gdW5zZXQob2JqLCBwcm9wKXtcbiAgICAgICAgaWYgKGhhcyhvYmosIHByb3ApKSB7XG4gICAgICAgICAgICB2YXIgcGFydHMgPSBwcm9wLnNwbGl0KCcuJyksXG4gICAgICAgICAgICAgICAgbGFzdCA9IHBhcnRzLnBvcCgpO1xuICAgICAgICAgICAgd2hpbGUgKHByb3AgPSBwYXJ0cy5zaGlmdCgpKSB7XG4gICAgICAgICAgICAgICAgb2JqID0gb2JqW3Byb3BdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChkZWxldGUgb2JqW2xhc3RdKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gaWYgcHJvcGVydHkgZG9lc24ndCBleGlzdCB0cmVhdCBhcyBkZWxldGVkXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gdW5zZXQ7XG5cblxuIiwidmFyIGZvck93biA9IHJlcXVpcmUoJy4vZm9yT3duJyk7XG5cbiAgICAvKipcbiAgICAgKiBHZXQgb2JqZWN0IHZhbHVlc1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHZhbHVlcyhvYmopIHtcbiAgICAgICAgdmFyIHZhbHMgPSBbXTtcbiAgICAgICAgZm9yT3duKG9iaiwgZnVuY3Rpb24odmFsLCBrZXkpe1xuICAgICAgICAgICAgdmFscy5wdXNoKHZhbCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdmFscztcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHZhbHVlcztcblxuXG4iLCJ2YXIgZm9yT3duID0gcmVxdWlyZSgnLi4vb2JqZWN0L2Zvck93bicpO1xudmFyIGlzQXJyYXkgPSByZXF1aXJlKCcuLi9sYW5nL2lzQXJyYXknKTtcbnZhciBmb3JFYWNoID0gcmVxdWlyZSgnLi4vYXJyYXkvZm9yRWFjaCcpO1xuXG4gICAgLyoqXG4gICAgICogRW5jb2RlIG9iamVjdCBpbnRvIGEgcXVlcnkgc3RyaW5nLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGVuY29kZShvYmope1xuICAgICAgICB2YXIgcXVlcnkgPSBbXSxcbiAgICAgICAgICAgIGFyclZhbHVlcywgcmVnO1xuICAgICAgICBmb3JPd24ob2JqLCBmdW5jdGlvbiAodmFsLCBrZXkpIHtcbiAgICAgICAgICAgIGlmIChpc0FycmF5KHZhbCkpIHtcbiAgICAgICAgICAgICAgICBhcnJWYWx1ZXMgPSBrZXkgKyAnPSc7XG4gICAgICAgICAgICAgICAgcmVnID0gbmV3IFJlZ0V4cCgnJicra2V5KycrPSQnKTtcbiAgICAgICAgICAgICAgICBmb3JFYWNoKHZhbCwgZnVuY3Rpb24gKGFWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBhcnJWYWx1ZXMgKz0gZW5jb2RlVVJJQ29tcG9uZW50KGFWYWx1ZSkgKyAnJicgKyBrZXkgKyAnPSc7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcXVlcnkucHVzaChhcnJWYWx1ZXMucmVwbGFjZShyZWcsICcnKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgcXVlcnkucHVzaChrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKHF1ZXJ5Lmxlbmd0aCkgPyAnPycgKyBxdWVyeS5qb2luKCcmJykgOiAnJztcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGVuY29kZTtcblxuIiwiXG5cbiAgICAvKipcbiAgICAgKiBTZXQgcXVlcnkgc3RyaW5nIHBhcmFtZXRlciB2YWx1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNldFBhcmFtKHVybCwgcGFyYW1OYW1lLCB2YWx1ZSl7XG4gICAgICAgIHVybCA9IHVybCB8fCAnJztcblxuICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKCcoXFxcXD98JiknKyBwYXJhbU5hbWUgKyc9W14mXSonICk7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtTmFtZSArJz0nKyBlbmNvZGVVUklDb21wb25lbnQoIHZhbHVlICk7XG5cbiAgICAgICAgaWYgKCByZS50ZXN0KHVybCkgKSB7XG4gICAgICAgICAgICByZXR1cm4gdXJsLnJlcGxhY2UocmUsICckMScrIHBhcmFtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh1cmwuaW5kZXhPZignPycpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHVybCArPSAnPyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodXJsLmluZGV4T2YoJz0nKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICB1cmwgKz0gJyYnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVybCArIHBhcmFtO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHNldFBhcmFtO1xuXG5cbiIsInZhciByYW5kSW50ID0gcmVxdWlyZSgnLi9yYW5kSW50Jyk7XG52YXIgaXNBcnJheSA9IHJlcXVpcmUoJy4uL2xhbmcvaXNBcnJheScpO1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHJhbmRvbSBlbGVtZW50IGZyb20gdGhlIHN1cHBsaWVkIGFyZ3VtZW50c1xuICAgICAqIG9yIGZyb20gdGhlIGFycmF5IChpZiBzaW5nbGUgYXJndW1lbnQgaXMgYW4gYXJyYXkpLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNob2ljZShpdGVtcykge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgaXNBcnJheShpdGVtcykpPyBpdGVtcyA6IGFyZ3VtZW50cztcbiAgICAgICAgcmV0dXJuIHRhcmdldFsgcmFuZEludCgwLCB0YXJnZXQubGVuZ3RoIC0gMSkgXTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNob2ljZTtcblxuXG4iLCJ2YXIgcmFuZEhleCA9IHJlcXVpcmUoJy4vcmFuZEhleCcpO1xudmFyIGNob2ljZSA9IHJlcXVpcmUoJy4vY2hvaWNlJyk7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgcHNldWRvLXJhbmRvbSBndWlkIChVVUlEIHY0KVxuICAgKiBJTVBPUlRBTlQ6IGl0J3Mgbm90IHRvdGFsbHkgXCJzYWZlXCIgc2luY2UgcmFuZEhleC9jaG9pY2UgdXNlcyBNYXRoLnJhbmRvbVxuICAgKiBieSBkZWZhdWx0IGFuZCBzZXF1ZW5jZXMgY2FuIGJlIHByZWRpY3RlZCBpbiBzb21lIGNhc2VzLiBTZWUgdGhlXG4gICAqIFwicmFuZG9tL3JhbmRvbVwiIGRvY3VtZW50YXRpb24gZm9yIG1vcmUgaW5mbyBhYm91dCBpdCBhbmQgaG93IHRvIHJlcGxhY2VcbiAgICogdGhlIGRlZmF1bHQgUFJORy5cbiAgICovXG4gIGZ1bmN0aW9uIGd1aWQoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgcmFuZEhleCg4KSsnLScrXG4gICAgICAgIHJhbmRIZXgoNCkrJy0nK1xuICAgICAgICAvLyB2NCBVVUlEIGFsd2F5cyBjb250YWluIFwiNFwiIGF0IHRoaXMgcG9zaXRpb24gdG8gc3BlY2lmeSBpdCB3YXNcbiAgICAgICAgLy8gcmFuZG9tbHkgZ2VuZXJhdGVkXG4gICAgICAgICc0JyArIHJhbmRIZXgoMykgKyctJytcbiAgICAgICAgLy8gdjQgVVVJRCBhbHdheXMgY29udGFpbiBjaGFycyBbYSxiLDgsOV0gYXQgdGhpcyBwb3NpdGlvblxuICAgICAgICBjaG9pY2UoOCwgOSwgJ2EnLCAnYicpICsgcmFuZEhleCgzKSsnLScrXG4gICAgICAgIHJhbmRIZXgoMTIpXG4gICAgKTtcbiAgfVxuICBtb2R1bGUuZXhwb3J0cyA9IGd1aWQ7XG5cbiIsInZhciByYW5kb20gPSByZXF1aXJlKCcuL3JhbmRvbScpO1xudmFyIE1JTl9JTlQgPSByZXF1aXJlKCcuLi9udW1iZXIvTUlOX0lOVCcpO1xudmFyIE1BWF9JTlQgPSByZXF1aXJlKCcuLi9udW1iZXIvTUFYX0lOVCcpO1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyByYW5kb20gbnVtYmVyIGluc2lkZSByYW5nZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJhbmQobWluLCBtYXgpe1xuICAgICAgICBtaW4gPSBtaW4gPT0gbnVsbD8gTUlOX0lOVCA6IG1pbjtcbiAgICAgICAgbWF4ID0gbWF4ID09IG51bGw/IE1BWF9JTlQgOiBtYXg7XG4gICAgICAgIHJldHVybiBtaW4gKyAobWF4IC0gbWluKSAqIHJhbmRvbSgpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gcmFuZDtcblxuIiwidmFyIGNob2ljZSA9IHJlcXVpcmUoJy4vY2hvaWNlJyk7XG5cbiAgICB2YXIgX2NoYXJzID0gJzAxMjM0NTY3ODlhYmNkZWYnLnNwbGl0KCcnKTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSByYW5kb20gaGV4YWRlY2ltYWwgc3RyaW5nXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmFuZEhleChzaXplKXtcbiAgICAgICAgc2l6ZSA9IHNpemUgJiYgc2l6ZSA+IDA/IHNpemUgOiA2O1xuICAgICAgICB2YXIgc3RyID0gJyc7XG4gICAgICAgIHdoaWxlIChzaXplLS0pIHtcbiAgICAgICAgICAgIHN0ciArPSBjaG9pY2UoX2NoYXJzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RyO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gcmFuZEhleDtcblxuXG4iLCJ2YXIgTUlOX0lOVCA9IHJlcXVpcmUoJy4uL251bWJlci9NSU5fSU5UJyk7XG52YXIgTUFYX0lOVCA9IHJlcXVpcmUoJy4uL251bWJlci9NQVhfSU5UJyk7XG52YXIgcmFuZCA9IHJlcXVpcmUoJy4vcmFuZCcpO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyByYW5kb20gaW50ZWdlciBpbnNpZGUgcmFuZ2Ugb3Igc25hcCB0byBtaW4vbWF4IHZhbHVlcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiByYW5kSW50KG1pbiwgbWF4KXtcbiAgICAgICAgbWluID0gbWluID09IG51bGw/IE1JTl9JTlQgOiB+fm1pbjtcbiAgICAgICAgbWF4ID0gbWF4ID09IG51bGw/IE1BWF9JTlQgOiB+fm1heDtcbiAgICAgICAgLy8gY2FuJ3QgYmUgbWF4ICsgMC41IG90aGVyd2lzZSBpdCB3aWxsIHJvdW5kIHVwIGlmIGByYW5kYFxuICAgICAgICAvLyByZXR1cm5zIGBtYXhgIGNhdXNpbmcgaXQgdG8gb3ZlcmZsb3cgcmFuZ2UuXG4gICAgICAgIC8vIC0wLjUgYW5kICsgMC40OSBhcmUgcmVxdWlyZWQgdG8gYXZvaWQgYmlhcyBjYXVzZWQgYnkgcm91bmRpbmdcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoIHJhbmQobWluIC0gMC41LCBtYXggKyAwLjQ5OTk5OTk5OTk5OSkgKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHJhbmRJbnQ7XG5cbiIsIlxuXG4gICAgLyoqXG4gICAgICogSnVzdCBhIHdyYXBwZXIgdG8gTWF0aC5yYW5kb20uIE5vIG1ldGhvZHMgaW5zaWRlIG1vdXQvcmFuZG9tIHNob3VsZCBjYWxsXG4gICAgICogTWF0aC5yYW5kb20oKSBkaXJlY3RseSBzbyB3ZSBjYW4gaW5qZWN0IHRoZSBwc2V1ZG8tcmFuZG9tIG51bWJlclxuICAgICAqIGdlbmVyYXRvciBpZiBuZWVkZWQgKGllLiBpbiBjYXNlIHdlIG5lZWQgYSBzZWVkZWQgcmFuZG9tIG9yIGEgYmV0dGVyXG4gICAgICogYWxnb3JpdGhtIHRoYW4gdGhlIG5hdGl2ZSBvbmUpXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmFuZG9tKCl7XG4gICAgICAgIHJldHVybiByYW5kb20uZ2V0KCk7XG4gICAgfVxuXG4gICAgLy8gd2UgZXhwb3NlIHRoZSBtZXRob2Qgc28gaXQgY2FuIGJlIHN3YXBwZWQgaWYgbmVlZGVkXG4gICAgcmFuZG9tLmdldCA9IE1hdGgucmFuZG9tO1xuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSByYW5kb207XG5cblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xuXG4gICAgLyoqXG4gICAgICogU2VhcmNoZXMgZm9yIGEgZ2l2ZW4gc3Vic3RyaW5nXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29udGFpbnMoc3RyLCBzdWJzdHJpbmcsIGZyb21JbmRleCl7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIHN1YnN0cmluZyA9IHRvU3RyaW5nKHN1YnN0cmluZyk7XG4gICAgICAgIHJldHVybiBzdHIuaW5kZXhPZihzdWJzdHJpbmcsIGZyb21JbmRleCkgIT09IC0xO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gY29udGFpbnM7XG5cblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xuXG4gICAgLyoqXG4gICAgICogRXNjYXBlcyBhIHN0cmluZyBmb3IgaW5zZXJ0aW9uIGludG8gSFRNTC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBlc2NhcGVIdG1sKHN0cil7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cilcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpXG4gICAgICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpXG4gICAgICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpXG4gICAgICAgICAgICAucmVwbGFjZSgvJy9nLCAnJiMzOTsnKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1wiL2csICcmcXVvdDsnKTtcbiAgICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGVzY2FwZUh0bWw7XG5cblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xuXG4gICAgLyoqXG4gICAgICogRXNjYXBlIHN0cmluZyBpbnRvIHVuaWNvZGUgc2VxdWVuY2VzXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXNjYXBlVW5pY29kZShzdHIsIHNob3VsZEVzY2FwZVByaW50YWJsZSl7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1xcc1xcU10vZywgZnVuY3Rpb24oY2gpe1xuICAgICAgICAgICAgLy8gc2tpcCBwcmludGFibGUgQVNDSUkgY2hhcnMgaWYgd2Ugc2hvdWxkIG5vdCBlc2NhcGUgdGhlbVxuICAgICAgICAgICAgaWYgKCFzaG91bGRFc2NhcGVQcmludGFibGUgJiYgKC9bXFx4MjAtXFx4N0VdLykudGVzdChjaCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2g7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB3ZSB1c2UgXCIwMDBcIiBhbmQgc2xpY2UoLTQpIGZvciBicmV2aXR5LCBuZWVkIHRvIHBhZCB6ZXJvcyxcbiAgICAgICAgICAgIC8vIHVuaWNvZGUgZXNjYXBlIGFsd2F5cyBoYXZlIDQgY2hhcnMgYWZ0ZXIgXCJcXHVcIlxuICAgICAgICAgICAgcmV0dXJuICdcXFxcdScrICgnMDAwJysgY2guY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBlc2NhcGVVbmljb2RlO1xuXG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcbnZhciBnZXQgPSByZXF1aXJlKCcuLi9vYmplY3QvZ2V0Jyk7XG5cbiAgICB2YXIgc3RhY2hlID0gL1xce1xceyhbXlxcfV0rKVxcfVxcfS9nOyAvL211c3RhY2hlLWxpa2VcblxuICAgIC8qKlxuICAgICAqIFN0cmluZyBpbnRlcnBvbGF0aW9uXG4gICAgICovXG4gICAgZnVuY3Rpb24gaW50ZXJwb2xhdGUodGVtcGxhdGUsIHJlcGxhY2VtZW50cywgc3ludGF4KXtcbiAgICAgICAgdGVtcGxhdGUgPSB0b1N0cmluZyh0ZW1wbGF0ZSk7XG4gICAgICAgIHZhciByZXBsYWNlRm4gPSBmdW5jdGlvbihtYXRjaCwgcHJvcCl7XG4gICAgICAgICAgICByZXR1cm4gdG9TdHJpbmcoIGdldChyZXBsYWNlbWVudHMsIHByb3ApICk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZS5yZXBsYWNlKHN5bnRheCB8fCBzdGFjaGUsIHJlcGxhY2VGbik7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBpbnRlcnBvbGF0ZTtcblxuXG4iLCJ2YXIgdG9TdHJpbmcgPSByZXF1aXJlKCcuLi9sYW5nL3RvU3RyaW5nJyk7XG4gICAgLyoqXG4gICAgICogXCJTYWZlclwiIFN0cmluZy50b0xvd2VyQ2FzZSgpXG4gICAgICovXG4gICAgZnVuY3Rpb24gbG93ZXJDYXNlKHN0cil7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIHJldHVybiBzdHIudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGxvd2VyQ2FzZTtcblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xudmFyIGxvd2VyQ2FzZSA9IHJlcXVpcmUoJy4vbG93ZXJDYXNlJyk7XG52YXIgdXBwZXJDYXNlID0gcmVxdWlyZSgnLi91cHBlckNhc2UnKTtcbiAgICAvKipcbiAgICAgKiBVUFBFUkNBU0UgZmlyc3QgY2hhciBvZiBlYWNoIHdvcmQuXG4gICAgICovXG4gICAgZnVuY3Rpb24gcHJvcGVyQ2FzZShzdHIpe1xuICAgICAgICBzdHIgPSB0b1N0cmluZyhzdHIpO1xuICAgICAgICByZXR1cm4gbG93ZXJDYXNlKHN0cikucmVwbGFjZSgvXlxcd3xcXHNcXHcvZywgdXBwZXJDYXNlKTtcbiAgICB9XG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHByb3BlckNhc2U7XG5cbiIsInZhciB0b1N0cmluZyA9IHJlcXVpcmUoJy4uL2xhbmcvdG9TdHJpbmcnKTtcbnZhciB0b0ludCA9IHJlcXVpcmUoJy4uL251bWJlci90b0ludCcpO1xuXG4gICAgLyoqXG4gICAgICogUmVwZWF0IHN0cmluZyBuIHRpbWVzXG4gICAgICovXG4gICAgIGZ1bmN0aW9uIHJlcGVhdChzdHIsIG4pe1xuICAgICAgICAgdmFyIHJlc3VsdCA9ICcnO1xuICAgICAgICAgc3RyID0gdG9TdHJpbmcoc3RyKTtcbiAgICAgICAgIG4gPSB0b0ludChuKTtcbiAgICAgICAgaWYgKG4gPCAxKSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKG4gPiAwKSB7XG4gICAgICAgICAgICBpZiAobiAlIDIpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gc3RyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbiA9IE1hdGguZmxvb3IobiAvIDIpO1xuICAgICAgICAgICAgc3RyICs9IHN0cjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICB9XG5cbiAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXBlYXQ7XG5cblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xudmFyIHJlcGVhdCA9IHJlcXVpcmUoJy4vcmVwZWF0Jyk7XG5cbiAgICAvKipcbiAgICAgKiBQYWQgc3RyaW5nIHdpdGggYGNoYXJgIGlmIGl0cycgbGVuZ3RoIGlzIHNtYWxsZXIgdGhhbiBgbWluTGVuYFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJwYWQoc3RyLCBtaW5MZW4sIGNoKSB7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIGNoID0gY2ggfHwgJyAnO1xuICAgICAgICByZXR1cm4gKHN0ci5sZW5ndGggPCBtaW5MZW4pPyBzdHIgKyByZXBlYXQoY2gsIG1pbkxlbiAtIHN0ci5sZW5ndGgpIDogc3RyO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gcnBhZDtcblxuXG4iLCJ2YXIgdG9TdHJpbmcgPSByZXF1aXJlKCcuLi9sYW5nL3RvU3RyaW5nJyk7XG5cbiAgICAvKipcbiAgICAgKiBVbmVzY2FwZXMgSFRNTCBzcGVjaWFsIGNoYXJzXG4gICAgICovXG4gICAgZnVuY3Rpb24gdW5lc2NhcGVIdG1sKHN0cil7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cilcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mYW1wOy9nICwgJyYnKVxuICAgICAgICAgICAgLnJlcGxhY2UoLyZsdDsvZyAgLCAnPCcpXG4gICAgICAgICAgICAucmVwbGFjZSgvJmd0Oy9nICAsICc+JylcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mIzAqMzk7L2cgLCBcIidcIilcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mcXVvdDsvZywgJ1wiJyk7XG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSB1bmVzY2FwZUh0bWw7XG5cblxuIiwidmFyIHRvU3RyaW5nID0gcmVxdWlyZSgnLi4vbGFuZy90b1N0cmluZycpO1xuICAgIC8qKlxuICAgICAqIFJlcGxhY2VzIGh5cGhlbnMgd2l0aCBzcGFjZXMuIChvbmx5IGh5cGhlbnMgYmV0d2VlbiB3b3JkIGNoYXJzKVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVuaHlwaGVuYXRlKHN0cil7XG4gICAgICAgIHN0ciA9IHRvU3RyaW5nKHN0cik7XG4gICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvKFxcdykoLSkoXFx3KS9nLCAnJDEgJDMnKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB1bmh5cGhlbmF0ZTtcblxuIiwidmFyIG9iamVjdERpZmYgPSB0eXBlb2YgZXhwb3J0cyAhPSAndW5kZWZpbmVkJyA/IGV4cG9ydHMgOiB7fTtcblxuLyoqXG4gKiBAcGFyYW0ge09iamVjdH0gYVxuICogQHBhcmFtIHtPYmplY3R9IGJcbiAqIEByZXR1cm4ge09iamVjdH1cbiAqL1xub2JqZWN0RGlmZi5kaWZmID0gZnVuY3Rpb24gZGlmZihhLCBiKSB7XG5cbiAgICBpZiAoYSA9PT0gYikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2hhbmdlZDogJ2VxdWFsJyxcbiAgICAgICAgICAgIHZhbHVlOiBhXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgdmFsdWUgPSB7fTtcbiAgICB2YXIgZXF1YWwgPSB0cnVlO1xuXG4gICAgZm9yICh2YXIga2V5IGluIGEpIHtcbiAgICAgICAgaWYgKGtleSBpbiBiKSB7XG4gICAgICAgICAgICBpZiAoYVtrZXldID09PSBiW2tleV0pIHtcbiAgICAgICAgICAgICAgICB2YWx1ZVtrZXldID0ge1xuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkOiAnZXF1YWwnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYVtrZXldXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgdHlwZUEgPSB0eXBlb2YgYVtrZXldO1xuICAgICAgICAgICAgICAgIHZhciB0eXBlQiA9IHR5cGVvZiBiW2tleV07XG4gICAgICAgICAgICAgICAgaWYgKGFba2V5XSAmJiBiW2tleV0gJiYgKHR5cGVBID09ICdvYmplY3QnIHx8IHR5cGVBID09ICdmdW5jdGlvbicpICYmICh0eXBlQiA9PSAnb2JqZWN0JyB8fCB0eXBlQiA9PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVEaWZmID0gZGlmZihhW2tleV0sIGJba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZURpZmYuY2hhbmdlZCA9PSAnZXF1YWwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVtrZXldID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWQ6ICdlcXVhbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGFba2V5XVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXF1YWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlW2tleV0gPSB2YWx1ZURpZmY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlcXVhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZVtrZXldID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZDogJ3ByaW1pdGl2ZSBjaGFuZ2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZDogYVtrZXldLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWQ6IGJba2V5XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZXF1YWwgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhbHVlW2tleV0gPSB7XG4gICAgICAgICAgICAgICAgY2hhbmdlZDogJ3JlbW92ZWQnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBhW2tleV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoa2V5IGluIGIpIHtcbiAgICAgICAgaWYgKCEoa2V5IGluIGEpKSB7XG4gICAgICAgICAgICBlcXVhbCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFsdWVba2V5XSA9IHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VkOiAnYWRkZWQnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBiW2tleV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChlcXVhbCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2hhbmdlZDogJ2VxdWFsJyxcbiAgICAgICAgICAgIHZhbHVlOiBhXG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2hhbmdlZDogJ29iamVjdCBjaGFuZ2UnLFxuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5cbi8qKlxuICogQHBhcmFtIHtPYmplY3R9IGFcbiAqIEBwYXJhbSB7T2JqZWN0fSBiXG4gKiBAcmV0dXJuIHtPYmplY3R9XG4gKi9cbm9iamVjdERpZmYuZGlmZk93blByb3BlcnRpZXMgPSBmdW5jdGlvbiBkaWZmT3duUHJvcGVydGllcyhhLCBiKSB7XG5cbiAgICBpZiAoYSA9PT0gYikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2hhbmdlZDogJ2VxdWFsJyxcbiAgICAgICAgICAgIHZhbHVlOiBhXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgZGlmZiA9IHt9O1xuICAgIHZhciBlcXVhbCA9IHRydWU7XG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhhKTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBrZXkgPSBrZXlzW2ldO1xuICAgICAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICBpZiAoYVtrZXldID09PSBiW2tleV0pIHtcbiAgICAgICAgICAgICAgICBkaWZmW2tleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZWQ6ICdlcXVhbCcsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhW2tleV1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciB0eXBlQSA9IHR5cGVvZiBhW2tleV07XG4gICAgICAgICAgICAgICAgdmFyIHR5cGVCID0gdHlwZW9mIGJba2V5XTtcbiAgICAgICAgICAgICAgICBpZiAoYVtrZXldICYmIGJba2V5XSAmJiAodHlwZUEgPT0gJ29iamVjdCcgfHwgdHlwZUEgPT0gJ2Z1bmN0aW9uJykgJiYgKHR5cGVCID09ICdvYmplY3QnIHx8IHR5cGVCID09ICdmdW5jdGlvbicpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZURpZmYgPSBkaWZmT3duUHJvcGVydGllcyhhW2tleV0sIGJba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZURpZmYuY2hhbmdlZCA9PSAnZXF1YWwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmW2tleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZDogJ2VxdWFsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYVtrZXldXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcXVhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZltrZXldID0gdmFsdWVEaWZmO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZXF1YWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgZGlmZltrZXldID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZDogJ3ByaW1pdGl2ZSBjaGFuZ2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZDogYVtrZXldLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWQ6IGJba2V5XVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZXF1YWwgPSBmYWxzZTtcbiAgICAgICAgICAgIGRpZmZba2V5XSA9IHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VkOiAncmVtb3ZlZCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6IGFba2V5XVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAga2V5cyA9IE9iamVjdC5rZXlzKGIpO1xuXG4gICAgZm9yIChpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBrZXkgPSBrZXlzW2ldO1xuICAgICAgICBpZiAoIWEuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgZXF1YWwgPSBmYWxzZTtcbiAgICAgICAgICAgIGRpZmZba2V5XSA9IHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VkOiAnYWRkZWQnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBiW2tleV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChlcXVhbCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IGEsXG4gICAgICAgICAgICBjaGFuZ2VkOiAnZXF1YWwnXG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2hhbmdlZDogJ29iamVjdCBjaGFuZ2UnLFxuICAgICAgICAgICAgdmFsdWU6IGRpZmZcbiAgICAgICAgfVxuICAgIH1cbn07XG5cblxuKGZ1bmN0aW9uKCkge1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNoYW5nZXNcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgb2JqZWN0RGlmZi5jb252ZXJ0VG9YTUxTdHJpbmcgPSBmdW5jdGlvbiBjb252ZXJ0VG9YTUxTdHJpbmcoY2hhbmdlcykge1xuICAgICAgICB2YXIgcHJvcGVydGllcyA9IFtdO1xuXG4gICAgICAgIHZhciBkaWZmID0gY2hhbmdlcy52YWx1ZTtcbiAgICAgICAgaWYgKGNoYW5nZXMuY2hhbmdlZCA9PSAnZXF1YWwnKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5zcGVjdChkaWZmKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGtleSBpbiBkaWZmKSB7XG4gICAgICAgICAgICB2YXIgY2hhbmdlZCA9IGRpZmZba2V5XS5jaGFuZ2VkO1xuICAgICAgICAgICAgc3dpdGNoIChjaGFuZ2VkKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZXF1YWwnOlxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2goc3RyaW5naWZ5T2JqZWN0S2V5KGVzY2FwZUhUTUwoa2V5KSkgKyAnPHNwYW4+OiA8L3NwYW4+JyArIGluc3BlY3QoZGlmZltrZXldLnZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAncmVtb3ZlZCc6XG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaCgnPGRlbCBjbGFzcz1cImRpZmZcIj4nICsgc3RyaW5naWZ5T2JqZWN0S2V5KGVzY2FwZUhUTUwoa2V5KSkgKyAnPHNwYW4+OiA8L3NwYW4+JyArIGluc3BlY3QoZGlmZltrZXldLnZhbHVlKSArICc8L2RlbD4nKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdhZGRlZCc6XG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaCgnPGlucyBjbGFzcz1cImRpZmZcIj4nICsgc3RyaW5naWZ5T2JqZWN0S2V5KGVzY2FwZUhUTUwoa2V5KSkgKyAnPHNwYW4+OiA8L3NwYW4+JyArIGluc3BlY3QoZGlmZltrZXldLnZhbHVlKSArICc8L2lucz4nKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdwcmltaXRpdmUgY2hhbmdlJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByZWZpeCA9IHN0cmluZ2lmeU9iamVjdEtleShlc2NhcGVIVE1MKGtleSkpICsgJzxzcGFuPjogPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGVsIGNsYXNzPVwiZGlmZiBkaWZmLWtleVwiPicgKyBwcmVmaXggKyBpbnNwZWN0KGRpZmZba2V5XS5yZW1vdmVkKSArICc8L2RlbD48c3Bhbj4sPC9zcGFuPlxcbicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnMgY2xhc3M9XCJkaWZmIGRpZmYta2V5XCI+JyArIHByZWZpeCArIGluc3BlY3QoZGlmZltrZXldLmFkZGVkKSArICc8L2lucz4nKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QgY2hhbmdlJzpcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllcy5wdXNoKHN0cmluZ2lmeU9iamVjdEtleShrZXkpICsgJzxzcGFuPjogPC9zcGFuPicgKyBjb252ZXJ0VG9YTUxTdHJpbmcoZGlmZltrZXldKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICc8c3Bhbj57PC9zcGFuPlxcbjxkaXYgY2xhc3M9XCJkaWZmLWxldmVsXCI+JyArIHByb3BlcnRpZXMuam9pbignPHNwYW4+LDwvc3Bhbj5cXG4nKSArICdcXG48L2Rpdj48c3Bhbj59PC9zcGFuPic7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXlcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgZnVuY3Rpb24gc3RyaW5naWZ5T2JqZWN0S2V5KGtleSkge1xuICAgICAgICByZXR1cm4gL15bYS16MC05XyRdKiQvaS50ZXN0KGtleSkgP1xuICAgICAgICAgICAga2V5IDpcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGtleSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZ1xuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBlc2NhcGVIVE1MKHN0cmluZykge1xuICAgICAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqXG4gICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGluc3BlY3Qob2JqKSB7XG5cbiAgICAgICAgcmV0dXJuIF9pbnNwZWN0KCcnLCBvYmopO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gYWNjdW11bGF0b3JcbiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IG9ialxuICAgICAgICAgKiBAc2VlIGh0dHA6Ly9qc3BlcmYuY29tL2NvbnRpbnVhdGlvbi1wYXNzaW5nLXN0eWxlLzNcbiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gX2luc3BlY3QoYWNjdW11bGF0b3IsIG9iaikge1xuICAgICAgICAgICAgc3dpdGNoKHR5cGVvZiBvYmopIHtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0b3IgKz0gJ251bGwnO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yICs9ICc8c3Bhbj57fTwvc3Bhbj4nO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0b3IgKz0gJzxzcGFuPns8L3NwYW4+XFxuPGRpdiBjbGFzcz1cImRpZmYtbGV2ZWxcIj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yID0gX2luc3BlY3QoYWNjdW11bGF0b3IgKyBzdHJpbmdpZnlPYmplY3RLZXkoZXNjYXBlSFRNTChrZXkpKSArICc8c3Bhbj46IDwvc3Bhbj4nLCBvYmpba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCBsZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9yICs9ICc8c3Bhbj4sPC9zcGFuPlxcbic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0b3IgKz0gJ1xcbjwvZGl2PjxzcGFuPn08L3NwYW4+J1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0b3IgKz0gSlNPTi5zdHJpbmdpZnkoZXNjYXBlSFRNTChvYmopKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICd1bmRlZmluZWQnOlxuICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRvciArPSAndW5kZWZpbmVkJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRvciArPSBlc2NhcGVIVE1MKFN0cmluZyhvYmopKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsInZhciBraW5kT2YgPSByZXF1aXJlKCcuL2tpbmRPZicpO1xudmFyIGlzUGxhaW5PYmplY3QgPSByZXF1aXJlKCcuL2lzUGxhaW5PYmplY3QnKTtcbnZhciBtaXhJbiA9IHJlcXVpcmUoJy4uL29iamVjdC9taXhJbicpO1xuXG4gICAgLyoqXG4gICAgICogQ2xvbmUgbmF0aXZlIHR5cGVzLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb25lKHZhbCl7XG4gICAgICAgIHN3aXRjaCAoa2luZE9mKHZhbCkpIHtcbiAgICAgICAgICAgIGNhc2UgJ09iamVjdCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb25lT2JqZWN0KHZhbCk7XG4gICAgICAgICAgICBjYXNlICdBcnJheSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb25lQXJyYXkodmFsKTtcbiAgICAgICAgICAgIGNhc2UgJ1JlZ0V4cCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNsb25lUmVnRXhwKHZhbCk7XG4gICAgICAgICAgICBjYXNlICdEYXRlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmVEYXRlKHZhbCk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9uZU9iamVjdChzb3VyY2UpIHtcbiAgICAgICAgaWYgKGlzUGxhaW5PYmplY3Qoc291cmNlKSkge1xuICAgICAgICAgICAgcmV0dXJuIG1peEluKHt9LCBzb3VyY2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb25lUmVnRXhwKHIpIHtcbiAgICAgICAgdmFyIGZsYWdzID0gJyc7XG4gICAgICAgIGZsYWdzICs9IHIubXVsdGlsaW5lID8gJ20nIDogJyc7XG4gICAgICAgIGZsYWdzICs9IHIuZ2xvYmFsID8gJ2cnIDogJyc7XG4gICAgICAgIGZsYWdzICs9IHIuaWdub3JlY2FzZSA/ICdpJyA6ICcnO1xuICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChyLnNvdXJjZSwgZmxhZ3MpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb25lRGF0ZShkYXRlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSgrZGF0ZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xvbmVBcnJheShhcnIpIHtcbiAgICAgICAgcmV0dXJuIGFyci5zbGljZSgpO1xuICAgIH1cblxuICAgIG1vZHVsZS5leHBvcnRzID0gY2xvbmU7XG5cblxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIGNyZWRpdHMgdG8gQGNwb2plcidzIENsYXNzLkJpbmRzLCByZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2Vcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9jcG9qZXIvbW9vdG9vbHMtY2xhc3MtZXh0cmFzL2Jsb2IvbWFzdGVyL1NvdXJjZS9DbGFzcy5CaW5kcy5qc1xuXG52YXIgcHJpbWUgPSByZXF1aXJlKFwicHJpbWVcIilcbnZhciBiaW5kID0gcmVxdWlyZShcIm1vdXQvZnVuY3Rpb24vYmluZFwiKVxuXG52YXIgYm91bmQgPSBwcmltZSh7XG5cbiAgICBib3VuZDogZnVuY3Rpb24obmFtZSl7XG4gICAgICAgIHZhciBib3VuZCA9IHRoaXMuX2JvdW5kIHx8ICh0aGlzLl9ib3VuZCA9IHt9KVxuICAgICAgICByZXR1cm4gYm91bmRbbmFtZV0gfHwgKGJvdW5kW25hbWVdID0gYmluZCh0aGlzW25hbWVdLCB0aGlzKSlcbiAgICB9XG5cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gYm91bmRcbiIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcHJpbWUgPSByZXF1aXJlKFwicHJpbWVcIilcbnZhciBtZXJnZSA9IHJlcXVpcmUoXCJtb3V0L29iamVjdC9tZXJnZVwiKVxuXG52YXIgT3B0aW9ucyA9IHByaW1lKHtcblxuICAgIHNldE9wdGlvbnM6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICB2YXIgYXJncyA9IFt7fSwgdGhpcy5vcHRpb25zXVxuICAgICAgICBhcmdzLnB1c2guYXBwbHkoYXJncywgYXJndW1lbnRzKVxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBtZXJnZS5hcHBseShudWxsLCBhcmdzKVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH1cblxufSlcblxubW9kdWxlLmV4cG9ydHMgPSBPcHRpb25zXG4iLCIvKlxuZGVmZXJcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGtpbmRPZiAgPSByZXF1aXJlKFwibW91dC9sYW5nL2tpbmRPZlwiKSxcbiAgICBub3cgICAgID0gcmVxdWlyZShcIm1vdXQvdGltZS9ub3dcIiksXG4gICAgZm9yRWFjaCA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2ZvckVhY2hcIiksXG4gICAgaW5kZXhPZiA9IHJlcXVpcmUoXCJtb3V0L2FycmF5L2luZGV4T2ZcIilcblxudmFyIGNhbGxiYWNrcyA9IHtcbiAgICB0aW1lb3V0OiB7fSxcbiAgICBmcmFtZTogW10sXG4gICAgaW1tZWRpYXRlOiBbXVxufVxuXG52YXIgcHVzaCA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGNhbGxiYWNrLCBjb250ZXh0LCBkZWZlcil7XG5cbiAgICB2YXIgaXRlcmF0b3IgPSBmdW5jdGlvbigpe1xuICAgICAgICBpdGVyYXRlKGNvbGxlY3Rpb24pXG4gICAgfVxuXG4gICAgaWYgKCFjb2xsZWN0aW9uLmxlbmd0aCkgZGVmZXIoaXRlcmF0b3IpXG5cbiAgICB2YXIgZW50cnkgPSB7XG4gICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjayxcbiAgICAgICAgY29udGV4dDogY29udGV4dFxuICAgIH1cblxuICAgIGNvbGxlY3Rpb24ucHVzaChlbnRyeSlcblxuICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgaW8gPSBpbmRleE9mKGNvbGxlY3Rpb24sIGVudHJ5KVxuICAgICAgICBpZiAoaW8gPiAtMSkgY29sbGVjdGlvbi5zcGxpY2UoaW8sIDEpXG4gICAgfVxufVxuXG52YXIgaXRlcmF0ZSA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24pe1xuICAgIHZhciB0aW1lID0gbm93KClcblxuICAgIGZvckVhY2goY29sbGVjdGlvbi5zcGxpY2UoMCksIGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgICAgIGVudHJ5LmNhbGxiYWNrLmNhbGwoZW50cnkuY29udGV4dCwgdGltZSlcbiAgICB9KVxufVxuXG52YXIgZGVmZXIgPSBmdW5jdGlvbihjYWxsYmFjaywgYXJndW1lbnQsIGNvbnRleHQpe1xuICAgIHJldHVybiAoa2luZE9mKGFyZ3VtZW50KSA9PT0gXCJOdW1iZXJcIikgPyBkZWZlci50aW1lb3V0KGNhbGxiYWNrLCBhcmd1bWVudCwgY29udGV4dCkgOiBkZWZlci5pbW1lZGlhdGUoY2FsbGJhY2ssIGFyZ3VtZW50KVxufVxuXG5pZiAoZ2xvYmFsLnByb2Nlc3MgJiYgcHJvY2Vzcy5uZXh0VGljayl7XG5cbiAgICBkZWZlci5pbW1lZGlhdGUgPSBmdW5jdGlvbihjYWxsYmFjaywgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBwdXNoKGNhbGxiYWNrcy5pbW1lZGlhdGUsIGNhbGxiYWNrLCBjb250ZXh0LCBwcm9jZXNzLm5leHRUaWNrKVxuICAgIH1cblxufSBlbHNlIGlmIChnbG9iYWwuc2V0SW1tZWRpYXRlKXtcblxuICAgIGRlZmVyLmltbWVkaWF0ZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb250ZXh0KXtcbiAgICAgICAgcmV0dXJuIHB1c2goY2FsbGJhY2tzLmltbWVkaWF0ZSwgY2FsbGJhY2ssIGNvbnRleHQsIHNldEltbWVkaWF0ZSlcbiAgICB9XG5cbn0gZWxzZSBpZiAoZ2xvYmFsLnBvc3RNZXNzYWdlICYmIGdsb2JhbC5hZGRFdmVudExpc3RlbmVyKXtcblxuICAgIGFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgaWYgKGV2ZW50LnNvdXJjZSA9PT0gZ2xvYmFsICYmIGV2ZW50LmRhdGEgPT09IFwiQGRlZmVycmVkXCIpe1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcbiAgICAgICAgICAgIGl0ZXJhdGUoY2FsbGJhY2tzLmltbWVkaWF0ZSlcbiAgICAgICAgfVxuICAgIH0sIHRydWUpXG5cbiAgICBkZWZlci5pbW1lZGlhdGUgPSBmdW5jdGlvbihjYWxsYmFjaywgY29udGV4dCl7XG4gICAgICAgIHJldHVybiBwdXNoKGNhbGxiYWNrcy5pbW1lZGlhdGUsIGNhbGxiYWNrLCBjb250ZXh0LCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcG9zdE1lc3NhZ2UoXCJAZGVmZXJyZWRcIiwgXCIqXCIpXG4gICAgICAgIH0pXG4gICAgfVxuXG59IGVsc2Uge1xuXG4gICAgZGVmZXIuaW1tZWRpYXRlID0gZnVuY3Rpb24oY2FsbGJhY2ssIGNvbnRleHQpe1xuICAgICAgICByZXR1cm4gcHVzaChjYWxsYmFja3MuaW1tZWRpYXRlLCBjYWxsYmFjaywgY29udGV4dCwgZnVuY3Rpb24oaXRlcmF0b3Ipe1xuICAgICAgICAgICAgc2V0VGltZW91dChpdGVyYXRvciwgMClcbiAgICAgICAgfSlcbiAgICB9XG5cbn1cblxudmFyIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGdsb2JhbC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICBnbG9iYWwud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgZ2xvYmFsLm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgIGdsb2JhbC5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgZ2xvYmFsLm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgc2V0VGltZW91dChjYWxsYmFjaywgMWUzIC8gNjApXG4gICAgfVxuXG5kZWZlci5mcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb250ZXh0KXtcbiAgICByZXR1cm4gcHVzaChjYWxsYmFja3MuZnJhbWUsIGNhbGxiYWNrLCBjb250ZXh0LCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUpXG59XG5cbnZhciBjbGVhclxuXG5kZWZlci50aW1lb3V0ID0gZnVuY3Rpb24oY2FsbGJhY2ssIG1zLCBjb250ZXh0KXtcbiAgICB2YXIgY3QgPSBjYWxsYmFja3MudGltZW91dFxuXG4gICAgaWYgKCFjbGVhcikgY2xlYXIgPSBkZWZlci5pbW1lZGlhdGUoZnVuY3Rpb24oKXtcbiAgICAgICAgY2xlYXIgPSBudWxsXG4gICAgICAgIGNhbGxiYWNrcy50aW1lb3V0ID0ge31cbiAgICB9KVxuXG4gICAgcmV0dXJuIHB1c2goY3RbbXNdIHx8IChjdFttc10gPSBbXSksIGNhbGxiYWNrLCBjb250ZXh0LCBmdW5jdGlvbihpdGVyYXRvcil7XG4gICAgICAgIHNldFRpbWVvdXQoaXRlcmF0b3IsIG1zKVxuICAgIH0pXG59XG5cbm1vZHVsZS5leHBvcnRzID0gZGVmZXJcbiIsIi8qXG5FbWl0dGVyXG4qL1widXNlIHN0cmljdFwiXG5cbnZhciBpbmRleE9mID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvaW5kZXhPZlwiKSxcbiAgICBmb3JFYWNoID0gcmVxdWlyZShcIm1vdXQvYXJyYXkvZm9yRWFjaFwiKVxuXG52YXIgcHJpbWUgPSByZXF1aXJlKFwiLi9pbmRleFwiKSxcbiAgICBkZWZlciA9IHJlcXVpcmUoXCIuL2RlZmVyXCIpXG5cbnZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcblxudmFyIEVtaXR0ZXIgPSBwcmltZSh7XG5cbiAgICBvbjogZnVuY3Rpb24oZXZlbnQsIGZuKXtcbiAgICAgICAgdmFyIGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVycyB8fCAodGhpcy5fbGlzdGVuZXJzID0ge30pLFxuICAgICAgICAgICAgZXZlbnRzID0gbGlzdGVuZXJzW2V2ZW50XSB8fCAobGlzdGVuZXJzW2V2ZW50XSA9IFtdKVxuXG4gICAgICAgIGlmIChpbmRleE9mKGV2ZW50cywgZm4pID09PSAtMSkgZXZlbnRzLnB1c2goZm4pXG5cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgb2ZmOiBmdW5jdGlvbihldmVudCwgZm4pe1xuICAgICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzLCBldmVudHMsIGtleSwgbGVuZ3RoID0gMFxuICAgICAgICBpZiAobGlzdGVuZXJzICYmIChldmVudHMgPSBsaXN0ZW5lcnNbZXZlbnRdKSl7XG5cbiAgICAgICAgICAgIHZhciBpbyA9IGluZGV4T2YoZXZlbnRzLCBmbilcbiAgICAgICAgICAgIGlmIChpbyA+IC0xKSBldmVudHMuc3BsaWNlKGlvLCAxKVxuICAgICAgICAgICAgaWYgKCFldmVudHMubGVuZ3RoKSBkZWxldGUgbGlzdGVuZXJzW2V2ZW50XTtcbiAgICAgICAgICAgIGZvciAodmFyIGwgaW4gbGlzdGVuZXJzKSByZXR1cm4gdGhpc1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2xpc3RlbmVyc1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIGVtaXQ6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAgICAgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKVxuXG4gICAgICAgIHZhciBlbWl0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBsaXN0ZW5lcnMgPSBzZWxmLl9saXN0ZW5lcnMsIGV2ZW50c1xuICAgICAgICAgICAgaWYgKGxpc3RlbmVycyAmJiAoZXZlbnRzID0gbGlzdGVuZXJzW2V2ZW50XSkpe1xuICAgICAgICAgICAgICAgIGZvckVhY2goZXZlbnRzLnNsaWNlKDApLCBmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudC5hcHBseShzZWxmLCBhcmdzKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBFbWl0dGVyLkVNSVRfU1lOQyl7XG4gICAgICAgICAgICBhcmdzLnBvcCgpXG4gICAgICAgICAgICBlbWl0KClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRlZmVyKGVtaXQpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH1cblxufSlcblxuRW1pdHRlci5FTUlUX1NZTkMgPSB7fVxuXG5tb2R1bGUuZXhwb3J0cyA9IEVtaXR0ZXJcbiIsIi8qXG5wcmltZVxuIC0gcHJvdG90eXBhbCBpbmhlcml0YW5jZVxuKi9cInVzZSBzdHJpY3RcIlxuXG52YXIgaGFzT3duID0gcmVxdWlyZShcIm1vdXQvb2JqZWN0L2hhc093blwiKSxcbiAgICBtaXhJbiAgPSByZXF1aXJlKFwibW91dC9vYmplY3QvbWl4SW5cIiksXG4gICAgY3JlYXRlID0gcmVxdWlyZShcIm1vdXQvbGFuZy9jcmVhdGVPYmplY3RcIiksXG4gICAga2luZE9mID0gcmVxdWlyZShcIm1vdXQvbGFuZy9raW5kT2ZcIilcblxudmFyIGhhc0Rlc2NyaXB0b3JzID0gdHJ1ZVxuXG50cnkge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgXCJ+XCIsIHt9KVxuICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioe30sIFwiflwiKVxufSBjYXRjaCAoZSl7XG4gICAgaGFzRGVzY3JpcHRvcnMgPSBmYWxzZVxufVxuXG4vLyB3ZSBvbmx5IG5lZWQgdG8gYmUgYWJsZSB0byBpbXBsZW1lbnQgXCJ0b1N0cmluZ1wiIGFuZCBcInZhbHVlT2ZcIiBpbiBJRSA8IDlcbnZhciBoYXNFbnVtQnVnID0gISh7dmFsdWVPZjogMH0pLnByb3BlcnR5SXNFbnVtZXJhYmxlKFwidmFsdWVPZlwiKSxcbiAgICBidWdneSAgICAgID0gW1widG9TdHJpbmdcIiwgXCJ2YWx1ZU9mXCJdXG5cbnZhciB2ZXJicyA9IC9eY29uc3RydWN0b3J8aW5oZXJpdHN8bWl4aW4kL1xuXG52YXIgaW1wbGVtZW50ID0gZnVuY3Rpb24ocHJvdG8pe1xuICAgIHZhciBwcm90b3R5cGUgPSB0aGlzLnByb3RvdHlwZVxuXG4gICAgZm9yICh2YXIga2V5IGluIHByb3RvKXtcbiAgICAgICAgaWYgKGtleS5tYXRjaCh2ZXJicykpIGNvbnRpbnVlXG4gICAgICAgIGlmIChoYXNEZXNjcmlwdG9ycyl7XG4gICAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG8sIGtleSlcbiAgICAgICAgICAgIGlmIChkZXNjcmlwdG9yKXtcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCBrZXksIGRlc2NyaXB0b3IpXG4gICAgICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwcm90b3R5cGVba2V5XSA9IHByb3RvW2tleV1cbiAgICB9XG5cbiAgICBpZiAoaGFzRW51bUJ1ZykgZm9yICh2YXIgaSA9IDA7IChrZXkgPSBidWdneVtpXSk7IGkrKyl7XG4gICAgICAgIHZhciB2YWx1ZSA9IHByb3RvW2tleV1cbiAgICAgICAgaWYgKHZhbHVlICE9PSBPYmplY3QucHJvdG90eXBlW2tleV0pIHByb3RvdHlwZVtrZXldID0gdmFsdWVcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpc1xufVxuXG52YXIgcHJpbWUgPSBmdW5jdGlvbihwcm90byl7XG5cbiAgICBpZiAoa2luZE9mKHByb3RvKSA9PT0gXCJGdW5jdGlvblwiKSBwcm90byA9IHtjb25zdHJ1Y3RvcjogcHJvdG99XG5cbiAgICB2YXIgc3VwZXJwcmltZSA9IHByb3RvLmluaGVyaXRzXG5cbiAgICAvLyBpZiBvdXIgbmljZSBwcm90byBvYmplY3QgaGFzIG5vIG93biBjb25zdHJ1Y3RvciBwcm9wZXJ0eVxuICAgIC8vIHRoZW4gd2UgcHJvY2VlZCB1c2luZyBhIGdob3N0aW5nIGNvbnN0cnVjdG9yIHRoYXQgYWxsIGl0IGRvZXMgaXNcbiAgICAvLyBjYWxsIHRoZSBwYXJlbnQncyBjb25zdHJ1Y3RvciBpZiBpdCBoYXMgYSBzdXBlcnByaW1lLCBlbHNlIGFuIGVtcHR5IGNvbnN0cnVjdG9yXG4gICAgLy8gcHJvdG8uY29uc3RydWN0b3IgYmVjb21lcyB0aGUgZWZmZWN0aXZlIGNvbnN0cnVjdG9yXG4gICAgdmFyIGNvbnN0cnVjdG9yID0gKGhhc093bihwcm90bywgXCJjb25zdHJ1Y3RvclwiKSkgPyBwcm90by5jb25zdHJ1Y3RvciA6IChzdXBlcnByaW1lKSA/IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBzdXBlcnByaW1lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbiAgICB9IDogZnVuY3Rpb24oKXt9XG5cbiAgICBpZiAoc3VwZXJwcmltZSl7XG5cbiAgICAgICAgbWl4SW4oY29uc3RydWN0b3IsIHN1cGVycHJpbWUpXG5cbiAgICAgICAgdmFyIHN1cGVycHJvdG8gPSBzdXBlcnByaW1lLnByb3RvdHlwZVxuICAgICAgICAvLyBpbmhlcml0IGZyb20gc3VwZXJwcmltZVxuICAgICAgICB2YXIgY3Byb3RvID0gY29uc3RydWN0b3IucHJvdG90eXBlID0gY3JlYXRlKHN1cGVycHJvdG8pXG5cbiAgICAgICAgLy8gc2V0dGluZyBjb25zdHJ1Y3Rvci5wYXJlbnQgdG8gc3VwZXJwcmltZS5wcm90b3R5cGVcbiAgICAgICAgLy8gYmVjYXVzZSBpdCdzIHRoZSBzaG9ydGVzdCBwb3NzaWJsZSBhYnNvbHV0ZSByZWZlcmVuY2VcbiAgICAgICAgY29uc3RydWN0b3IucGFyZW50ID0gc3VwZXJwcm90b1xuICAgICAgICBjcHJvdG8uY29uc3RydWN0b3IgPSBjb25zdHJ1Y3RvclxuICAgIH1cblxuICAgIGlmICghY29uc3RydWN0b3IuaW1wbGVtZW50KSBjb25zdHJ1Y3Rvci5pbXBsZW1lbnQgPSBpbXBsZW1lbnRcblxuICAgIHZhciBtaXhpbnMgPSBwcm90by5taXhpblxuICAgIGlmIChtaXhpbnMpe1xuICAgICAgICBpZiAoa2luZE9mKG1peGlucykgIT09IFwiQXJyYXlcIikgbWl4aW5zID0gW21peGluc11cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtaXhpbnMubGVuZ3RoOyBpKyspIGNvbnN0cnVjdG9yLmltcGxlbWVudChjcmVhdGUobWl4aW5zW2ldLnByb3RvdHlwZSkpXG4gICAgfVxuXG4gICAgLy8gaW1wbGVtZW50IHByb3RvIGFuZCByZXR1cm4gY29uc3RydWN0b3JcbiAgICByZXR1cm4gY29uc3RydWN0b3IuaW1wbGVtZW50KHByb3RvKVxuXG59XG5cbm1vZHVsZS5leHBvcnRzID0gcHJpbWVcbiIsIi8qXG5NYXBcbiovXCJ1c2Ugc3RyaWN0XCJcblxudmFyIGluZGV4T2YgPSByZXF1aXJlKFwibW91dC9hcnJheS9pbmRleE9mXCIpXG5cbnZhciBwcmltZSA9IHJlcXVpcmUoXCIuL2luZGV4XCIpXG5cbnZhciBNYXAgPSBwcmltZSh7XG5cbiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gTWFwKCl7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMFxuICAgICAgICB0aGlzLl92YWx1ZXMgPSBbXVxuICAgICAgICB0aGlzLl9rZXlzID0gW11cbiAgICB9LFxuXG4gICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKXtcbiAgICAgICAgdmFyIGluZGV4ID0gaW5kZXhPZih0aGlzLl9rZXlzLCBrZXkpXG5cbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSl7XG4gICAgICAgICAgICB0aGlzLl9rZXlzLnB1c2goa2V5KVxuICAgICAgICAgICAgdGhpcy5fdmFsdWVzLnB1c2godmFsdWUpXG4gICAgICAgICAgICB0aGlzLmxlbmd0aCsrXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl92YWx1ZXNbaW5kZXhdID0gdmFsdWVcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfSxcblxuICAgIGdldDogZnVuY3Rpb24oa2V5KXtcbiAgICAgICAgdmFyIGluZGV4ID0gaW5kZXhPZih0aGlzLl9rZXlzLCBrZXkpXG4gICAgICAgIHJldHVybiAoaW5kZXggPT09IC0xKSA/IG51bGwgOiB0aGlzLl92YWx1ZXNbaW5kZXhdXG4gICAgfSxcblxuICAgIGNvdW50OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGhcbiAgICB9LFxuXG4gICAgZm9yRWFjaDogZnVuY3Rpb24obWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKyl7XG4gICAgICAgICAgICBpZiAobWV0aG9kLmNhbGwoY29udGV4dCwgdGhpcy5fdmFsdWVzW2ldLCB0aGlzLl9rZXlzW2ldLCB0aGlzKSA9PT0gZmFsc2UpIGJyZWFrXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9LFxuXG4gICAgbWFwOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICB2YXIgcmVzdWx0cyA9IG5ldyBNYXBcbiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpe1xuICAgICAgICAgICAgcmVzdWx0cy5zZXQoa2V5LCBtZXRob2QuY2FsbChjb250ZXh0LCB2YWx1ZSwga2V5LCB0aGlzKSlcbiAgICAgICAgfSwgdGhpcylcbiAgICAgICAgcmV0dXJuIHJlc3VsdHNcbiAgICB9LFxuXG4gICAgZmlsdGVyOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICB2YXIgcmVzdWx0cyA9IG5ldyBNYXBcbiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpe1xuICAgICAgICAgICAgaWYgKG1ldGhvZC5jYWxsKGNvbnRleHQsIHZhbHVlLCBrZXksIHRoaXMpKSByZXN1bHRzLnNldChrZXksIHZhbHVlKVxuICAgICAgICB9LCB0aGlzKVxuICAgICAgICByZXR1cm4gcmVzdWx0c1xuICAgIH0sXG5cbiAgICBldmVyeTogZnVuY3Rpb24obWV0aG9kLCBjb250ZXh0KXtcbiAgICAgICAgdmFyIGV2ZXJ5ID0gdHJ1ZVxuICAgICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSl7XG4gICAgICAgICAgICBpZiAoIW1ldGhvZC5jYWxsKGNvbnRleHQsIHZhbHVlLCBrZXksIHRoaXMpKSByZXR1cm4gKGV2ZXJ5ID0gZmFsc2UpXG4gICAgICAgIH0sIHRoaXMpXG4gICAgICAgIHJldHVybiBldmVyeVxuICAgIH0sXG5cbiAgICBzb21lOiBmdW5jdGlvbihtZXRob2QsIGNvbnRleHQpe1xuICAgICAgICB2YXIgc29tZSA9IGZhbHNlXG4gICAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KXtcbiAgICAgICAgICAgIGlmIChtZXRob2QuY2FsbChjb250ZXh0LCB2YWx1ZSwga2V5LCB0aGlzKSkgcmV0dXJuICEoc29tZSA9IHRydWUpXG4gICAgICAgIH0sIHRoaXMpXG4gICAgICAgIHJldHVybiBzb21lXG4gICAgfSxcblxuICAgIGluZGV4T2Y6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgdmFyIGluZGV4ID0gaW5kZXhPZih0aGlzLl92YWx1ZXMsIHZhbHVlKVxuICAgICAgICByZXR1cm4gKGluZGV4ID4gLTEpID8gdGhpcy5fa2V5c1tpbmRleF0gOiBudWxsXG4gICAgfSxcblxuICAgIHJlbW92ZTogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICB2YXIgaW5kZXggPSBpbmRleE9mKHRoaXMuX3ZhbHVlcywgdmFsdWUpXG5cbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSl7XG4gICAgICAgICAgICB0aGlzLl92YWx1ZXMuc3BsaWNlKGluZGV4LCAxKVxuICAgICAgICAgICAgdGhpcy5sZW5ndGgtLVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2tleXMuc3BsaWNlKGluZGV4LCAxKVswXVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICB9LFxuXG4gICAgdW5zZXQ6IGZ1bmN0aW9uKGtleSl7XG4gICAgICAgIHZhciBpbmRleCA9IGluZGV4T2YodGhpcy5fa2V5cywga2V5KVxuXG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpe1xuICAgICAgICAgICAgdGhpcy5fa2V5cy5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICAgICAgICB0aGlzLmxlbmd0aC0tXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWVzLnNwbGljZShpbmRleCwgMSlbMF1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgfSxcblxuICAgIGtleXM6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXlzLnNsaWNlKClcbiAgICB9LFxuXG4gICAgdmFsdWVzOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWVzLnNsaWNlKClcbiAgICB9XG5cbn0pXG5cbnZhciBtYXAgPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiBuZXcgTWFwXG59XG5cbm1hcC5wcm90b3R5cGUgPSBNYXAucHJvdG90eXBlXG5cbm1vZHVsZS5leHBvcnRzID0gbWFwXG4iLCJ2YXIgbWl4SW4gPSByZXF1aXJlKCcuLi9vYmplY3QvbWl4SW4nKTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBPYmplY3QgdXNpbmcgcHJvdG90eXBhbCBpbmhlcml0YW5jZSBhbmQgc2V0dGluZyBjdXN0b20gcHJvcGVydGllcy5cbiAgICAgKiAtIE1peCBiZXR3ZWVuIERvdWdsYXMgQ3JvY2tmb3JkIFByb3RvdHlwYWwgSW5oZXJpdGFuY2UgPGh0dHA6Ly9qYXZhc2NyaXB0LmNyb2NrZm9yZC5jb20vcHJvdG90eXBhbC5odG1sPiBhbmQgdGhlIEVjbWFTY3JpcHQgNSBgT2JqZWN0LmNyZWF0ZSgpYCBtZXRob2QuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHBhcmVudCAgICBQYXJlbnQgT2JqZWN0LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbcHJvcHNdIE9iamVjdCBwcm9wZXJ0aWVzLlxuICAgICAqIEByZXR1cm4ge29iamVjdH0gQ3JlYXRlZCBvYmplY3QuXG4gICAgICovXG4gICAgZnVuY3Rpb24gY3JlYXRlT2JqZWN0KHBhcmVudCwgcHJvcHMpe1xuICAgICAgICBmdW5jdGlvbiBGKCl7fVxuICAgICAgICBGLnByb3RvdHlwZSA9IHBhcmVudDtcbiAgICAgICAgcmV0dXJuIG1peEluKG5ldyBGKCksIHByb3BzKTtcblxuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZU9iamVjdDtcblxuXG4iLCJcblxuICAgIC8qKlxuICAgICAqIEdldCBjdXJyZW50IHRpbWUgaW4gbWlsaXNlY29uZHNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBub3coKXtcbiAgICAgICAgLy8geWVzLCB3ZSBkZWZlciB0aGUgd29yayB0byBhbm90aGVyIGZ1bmN0aW9uIHRvIGFsbG93IG1vY2tpbmcgaXRcbiAgICAgICAgLy8gZHVyaW5nIHRoZSB0ZXN0c1xuICAgICAgICByZXR1cm4gbm93LmdldCgpO1xuICAgIH1cblxuICAgIG5vdy5nZXQgPSAodHlwZW9mIERhdGUubm93ID09PSAnZnVuY3Rpb24nKT8gRGF0ZS5ub3cgOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gKyhuZXcgRGF0ZSgpKTtcbiAgICB9O1xuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBub3c7XG5cblxuIiwiLyoqXG4gKiBzaWZ0ZXIuanNcbiAqIENvcHlyaWdodCAoYykgMjAxMyBCcmlhbiBSZWF2aXMgJiBjb250cmlidXRvcnNcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpc1xuICogZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQ6XG4gKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyXG4gKiB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GXG4gKiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2VcbiAqIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKlxuICogQGF1dGhvciBCcmlhbiBSZWF2aXMgPGJyaWFuQHRoaXJkcm91dGUuY29tPlxuICovXG5cbihmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcblx0XHRkZWZpbmUoZmFjdG9yeSk7XG5cdH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdH0gZWxzZSB7XG5cdFx0cm9vdC5TaWZ0ZXIgPSBmYWN0b3J5KCk7XG5cdH1cbn0odGhpcywgZnVuY3Rpb24oKSB7XG5cblx0LyoqXG5cdCAqIFRleHR1YWxseSBzZWFyY2hlcyBhcnJheXMgYW5kIGhhc2hlcyBvZiBvYmplY3RzXG5cdCAqIGJ5IHByb3BlcnR5IChvciBtdWx0aXBsZSBwcm9wZXJ0aWVzKS4gRGVzaWduZWRcblx0ICogc3BlY2lmaWNhbGx5IGZvciBhdXRvY29tcGxldGUuXG5cdCAqXG5cdCAqIEBjb25zdHJ1Y3RvclxuXHQgKiBAcGFyYW0ge2FycmF5fG9iamVjdH0gaXRlbXNcblx0ICogQHBhcmFtIHtvYmplY3R9IGl0ZW1zXG5cdCAqL1xuXHR2YXIgU2lmdGVyID0gZnVuY3Rpb24oaXRlbXMsIHNldHRpbmdzKSB7XG5cdFx0dGhpcy5pdGVtcyA9IGl0ZW1zO1xuXHRcdHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncyB8fCB7ZGlhY3JpdGljczogdHJ1ZX07XG5cdH07XG5cblx0LyoqXG5cdCAqIFNwbGl0cyBhIHNlYXJjaCBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBpbmRpdmlkdWFsXG5cdCAqIHJlZ2V4cHMgdG8gYmUgdXNlZCB0byBtYXRjaCByZXN1bHRzLlxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlcblx0ICogQHJldHVybnMge2FycmF5fVxuXHQgKi9cblx0U2lmdGVyLnByb3RvdHlwZS50b2tlbml6ZSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG5cdFx0cXVlcnkgPSB0cmltKFN0cmluZyhxdWVyeSB8fCAnJykudG9Mb3dlckNhc2UoKSk7XG5cdFx0aWYgKCFxdWVyeSB8fCAhcXVlcnkubGVuZ3RoKSByZXR1cm4gW107XG5cblx0XHR2YXIgaSwgbiwgcmVnZXgsIGxldHRlcjtcblx0XHR2YXIgdG9rZW5zID0gW107XG5cdFx0dmFyIHdvcmRzID0gcXVlcnkuc3BsaXQoLyArLyk7XG5cblx0XHRmb3IgKGkgPSAwLCBuID0gd29yZHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG5cdFx0XHRyZWdleCA9IGVzY2FwZV9yZWdleCh3b3Jkc1tpXSk7XG5cdFx0XHRpZiAodGhpcy5zZXR0aW5ncy5kaWFjcml0aWNzKSB7XG5cdFx0XHRcdGZvciAobGV0dGVyIGluIERJQUNSSVRJQ1MpIHtcblx0XHRcdFx0XHRpZiAoRElBQ1JJVElDUy5oYXNPd25Qcm9wZXJ0eShsZXR0ZXIpKSB7XG5cdFx0XHRcdFx0XHRyZWdleCA9IHJlZ2V4LnJlcGxhY2UobmV3IFJlZ0V4cChsZXR0ZXIsICdnJyksIERJQUNSSVRJQ1NbbGV0dGVyXSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHR0b2tlbnMucHVzaCh7XG5cdFx0XHRcdHN0cmluZyA6IHdvcmRzW2ldLFxuXHRcdFx0XHRyZWdleCAgOiBuZXcgUmVnRXhwKHJlZ2V4LCAnaScpXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdG9rZW5zO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBJdGVyYXRlcyBvdmVyIGFycmF5cyBhbmQgaGFzaGVzLlxuXHQgKlxuXHQgKiBgYGBcblx0ICogdGhpcy5pdGVyYXRvcih0aGlzLml0ZW1zLCBmdW5jdGlvbihpdGVtLCBpZCkge1xuXHQgKiAgICAvLyBpbnZva2VkIGZvciBlYWNoIGl0ZW1cblx0ICogfSk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0ge2FycmF5fG9iamVjdH0gb2JqZWN0XG5cdCAqL1xuXHRTaWZ0ZXIucHJvdG90eXBlLml0ZXJhdG9yID0gZnVuY3Rpb24ob2JqZWN0LCBjYWxsYmFjaykge1xuXHRcdHZhciBpdGVyYXRvcjtcblx0XHRpZiAoaXNfYXJyYXkob2JqZWN0KSkge1xuXHRcdFx0aXRlcmF0b3IgPSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaCB8fCBmdW5jdGlvbihjYWxsYmFjaykge1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMCwgbiA9IHRoaXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2sodGhpc1tpXSwgaSwgdGhpcyk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0fSBlbHNlIHtcblx0XHRcdGl0ZXJhdG9yID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcblx0XHRcdFx0Zm9yICh2YXIga2V5IGluIHRoaXMpIHtcblx0XHRcdFx0XHRpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG5cdFx0XHRcdFx0XHRjYWxsYmFjayh0aGlzW2tleV0sIGtleSwgdGhpcyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdGl0ZXJhdG9yLmFwcGx5KG9iamVjdCwgW2NhbGxiYWNrXSk7XG5cdH07XG5cblx0LyoqXG5cdCAqIFJldHVybnMgYSBmdW5jdGlvbiB0byBiZSB1c2VkIHRvIHNjb3JlIGluZGl2aWR1YWwgcmVzdWx0cy5cblx0ICpcblx0ICogR29vZCBtYXRjaGVzIHdpbGwgaGF2ZSBhIGhpZ2hlciBzY29yZSB0aGFuIHBvb3IgbWF0Y2hlcy5cblx0ICogSWYgYW4gaXRlbSBpcyBub3QgYSBtYXRjaCwgMCB3aWxsIGJlIHJldHVybmVkIGJ5IHRoZSBmdW5jdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIHtvYmplY3R8c3RyaW5nfSBzZWFyY2hcblx0ICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgKG9wdGlvbmFsKVxuXHQgKiBAcmV0dXJucyB7ZnVuY3Rpb259XG5cdCAqL1xuXHRTaWZ0ZXIucHJvdG90eXBlLmdldFNjb3JlRnVuY3Rpb24gPSBmdW5jdGlvbihzZWFyY2gsIG9wdGlvbnMpIHtcblx0XHR2YXIgc2VsZiwgZmllbGRzLCB0b2tlbnMsIHRva2VuX2NvdW50O1xuXG5cdFx0c2VsZiAgICAgICAgPSB0aGlzO1xuXHRcdHNlYXJjaCAgICAgID0gc2VsZi5wcmVwYXJlU2VhcmNoKHNlYXJjaCwgb3B0aW9ucyk7XG5cdFx0dG9rZW5zICAgICAgPSBzZWFyY2gudG9rZW5zO1xuXHRcdGZpZWxkcyAgICAgID0gc2VhcmNoLm9wdGlvbnMuZmllbGRzO1xuXHRcdHRva2VuX2NvdW50ID0gdG9rZW5zLmxlbmd0aDtcblxuXHRcdC8qKlxuXHRcdCAqIENhbGN1bGF0ZXMgaG93IGNsb3NlIG9mIGEgbWF0Y2ggdGhlXG5cdFx0ICogZ2l2ZW4gdmFsdWUgaXMgYWdhaW5zdCBhIHNlYXJjaCB0b2tlbi5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSB7bWl4ZWR9IHZhbHVlXG5cdFx0ICogQHBhcmFtIHtvYmplY3R9IHRva2VuXG5cdFx0ICogQHJldHVybiB7bnVtYmVyfVxuXHRcdCAqL1xuXHRcdHZhciBzY29yZVZhbHVlID0gZnVuY3Rpb24odmFsdWUsIHRva2VuKSB7XG5cdFx0XHR2YXIgc2NvcmUsIHBvcztcblxuXHRcdFx0aWYgKCF2YWx1ZSkgcmV0dXJuIDA7XG5cdFx0XHR2YWx1ZSA9IFN0cmluZyh2YWx1ZSB8fCAnJyk7XG5cdFx0XHRwb3MgPSB2YWx1ZS5zZWFyY2godG9rZW4ucmVnZXgpO1xuXHRcdFx0aWYgKHBvcyA9PT0gLTEpIHJldHVybiAwO1xuXHRcdFx0c2NvcmUgPSB0b2tlbi5zdHJpbmcubGVuZ3RoIC8gdmFsdWUubGVuZ3RoO1xuXHRcdFx0aWYgKHBvcyA9PT0gMCkgc2NvcmUgKz0gMC41O1xuXHRcdFx0cmV0dXJuIHNjb3JlO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDYWxjdWxhdGVzIHRoZSBzY29yZSBvZiBhbiBvYmplY3Rcblx0XHQgKiBhZ2FpbnN0IHRoZSBzZWFyY2ggcXVlcnkuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0ge29iamVjdH0gdG9rZW5cblx0XHQgKiBAcGFyYW0ge29iamVjdH0gZGF0YVxuXHRcdCAqIEByZXR1cm4ge251bWJlcn1cblx0XHQgKi9cblx0XHR2YXIgc2NvcmVPYmplY3QgPSAoZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgZmllbGRfY291bnQgPSBmaWVsZHMubGVuZ3RoO1xuXHRcdFx0aWYgKCFmaWVsZF9jb3VudCkge1xuXHRcdFx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiAwOyB9O1xuXHRcdFx0fVxuXHRcdFx0aWYgKGZpZWxkX2NvdW50ID09PSAxKSB7XG5cdFx0XHRcdHJldHVybiBmdW5jdGlvbih0b2tlbiwgZGF0YSkge1xuXHRcdFx0XHRcdHJldHVybiBzY29yZVZhbHVlKGRhdGFbZmllbGRzWzBdXSwgdG9rZW4pO1xuXHRcdFx0XHR9O1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKHRva2VuLCBkYXRhKSB7XG5cdFx0XHRcdGZvciAodmFyIGkgPSAwLCBzdW0gPSAwOyBpIDwgZmllbGRfY291bnQ7IGkrKykge1xuXHRcdFx0XHRcdHN1bSArPSBzY29yZVZhbHVlKGRhdGFbZmllbGRzW2ldXSwgdG9rZW4pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBzdW0gLyBmaWVsZF9jb3VudDtcblx0XHRcdH07XG5cdFx0fSkoKTtcblxuXHRcdGlmICghdG9rZW5fY291bnQpIHtcblx0XHRcdHJldHVybiBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07XG5cdFx0fVxuXHRcdGlmICh0b2tlbl9jb3VudCA9PT0gMSkge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdFx0cmV0dXJuIHNjb3JlT2JqZWN0KHRva2Vuc1swXSwgZGF0YSk7XG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdGlmIChzZWFyY2gub3B0aW9ucy5jb25qdW5jdGlvbiA9PT0gJ2FuZCcpIHtcblx0XHRcdHJldHVybiBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHRcdHZhciBzY29yZTtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIHN1bSA9IDA7IGkgPCB0b2tlbl9jb3VudDsgaSsrKSB7XG5cdFx0XHRcdFx0c2NvcmUgPSBzY29yZU9iamVjdCh0b2tlbnNbaV0sIGRhdGEpO1xuXHRcdFx0XHRcdGlmIChzY29yZSA8PSAwKSByZXR1cm4gMDtcblx0XHRcdFx0XHRzdW0gKz0gc2NvcmU7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHN1bSAvIHRva2VuX2NvdW50O1xuXHRcdFx0fTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDAsIHN1bSA9IDA7IGkgPCB0b2tlbl9jb3VudDsgaSsrKSB7XG5cdFx0XHRcdFx0c3VtICs9IHNjb3JlT2JqZWN0KHRva2Vuc1tpXSwgZGF0YSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHN1bSAvIHRva2VuX2NvdW50O1xuXHRcdFx0fTtcblx0XHR9XG5cdH07XG5cblx0LyoqXG5cdCAqIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXBhcmUgdHdvXG5cdCAqIHJlc3VsdHMsIGZvciBzb3J0aW5nIHB1cnBvc2VzLiBJZiBubyBzb3J0aW5nIHNob3VsZFxuXHQgKiBiZSBwZXJmb3JtZWQsIGBudWxsYCB3aWxsIGJlIHJldHVybmVkLlxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ3xvYmplY3R9IHNlYXJjaFxuXHQgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9uc1xuXHQgKiBAcmV0dXJuIGZ1bmN0aW9uKGEsYilcblx0ICovXG5cdFNpZnRlci5wcm90b3R5cGUuZ2V0U29ydEZ1bmN0aW9uID0gZnVuY3Rpb24oc2VhcmNoLCBvcHRpb25zKSB7XG5cdFx0dmFyIGksIG4sIHNlbGYsIGZpZWxkLCBmaWVsZHMsIGZpZWxkc19jb3VudCwgbXVsdGlwbGllciwgbXVsdGlwbGllcnMsIGdldF9maWVsZCwgaW1wbGljaXRfc2NvcmUsIHNvcnQ7XG5cblx0XHRzZWxmICAgPSB0aGlzO1xuXHRcdHNlYXJjaCA9IHNlbGYucHJlcGFyZVNlYXJjaChzZWFyY2gsIG9wdGlvbnMpO1xuXHRcdHNvcnQgICA9ICghc2VhcmNoLnF1ZXJ5ICYmIG9wdGlvbnMuc29ydF9lbXB0eSkgfHwgb3B0aW9ucy5zb3J0O1xuXG5cdFx0LyoqXG5cdFx0ICogRmV0Y2hlcyB0aGUgc3BlY2lmaWVkIHNvcnQgZmllbGQgdmFsdWVcblx0XHQgKiBmcm9tIGEgc2VhcmNoIHJlc3VsdCBpdGVtLlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtICB7c3RyaW5nfSBuYW1lXG5cdFx0ICogQHBhcmFtICB7b2JqZWN0fSByZXN1bHRcblx0XHQgKiBAcmV0dXJuIHttaXhlZH1cblx0XHQgKi9cblx0XHRnZXRfZmllbGQgPSBmdW5jdGlvbihuYW1lLCByZXN1bHQpIHtcblx0XHRcdGlmIChuYW1lID09PSAnJHNjb3JlJykgcmV0dXJuIHJlc3VsdC5zY29yZTtcblx0XHRcdHJldHVybiBzZWxmLml0ZW1zW3Jlc3VsdC5pZF1bbmFtZV07XG5cdFx0fTtcblxuXHRcdC8vIHBhcnNlIG9wdGlvbnNcblx0XHRmaWVsZHMgPSBbXTtcblx0XHRpZiAoc29ydCkge1xuXHRcdFx0Zm9yIChpID0gMCwgbiA9IHNvcnQubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG5cdFx0XHRcdGlmIChzZWFyY2gucXVlcnkgfHwgc29ydFtpXS5maWVsZCAhPT0gJyRzY29yZScpIHtcblx0XHRcdFx0XHRmaWVsZHMucHVzaChzb3J0W2ldKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIHRoZSBcIiRzY29yZVwiIGZpZWxkIGlzIGltcGxpZWQgdG8gYmUgdGhlIHByaW1hcnlcblx0XHQvLyBzb3J0IGZpZWxkLCB1bmxlc3MgaXQncyBtYW51YWxseSBzcGVjaWZpZWRcblx0XHRpZiAoc2VhcmNoLnF1ZXJ5KSB7XG5cdFx0XHRpbXBsaWNpdF9zY29yZSA9IHRydWU7XG5cdFx0XHRmb3IgKGkgPSAwLCBuID0gZmllbGRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuXHRcdFx0XHRpZiAoZmllbGRzW2ldLmZpZWxkID09PSAnJHNjb3JlJykge1xuXHRcdFx0XHRcdGltcGxpY2l0X3Njb3JlID0gZmFsc2U7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmIChpbXBsaWNpdF9zY29yZSkge1xuXHRcdFx0XHRmaWVsZHMudW5zaGlmdCh7ZmllbGQ6ICckc2NvcmUnLCBkaXJlY3Rpb246ICdkZXNjJ30pO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRmb3IgKGkgPSAwLCBuID0gZmllbGRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuXHRcdFx0XHRpZiAoZmllbGRzW2ldLmZpZWxkID09PSAnJHNjb3JlJykge1xuXHRcdFx0XHRcdGZpZWxkcy5zcGxpY2UoaSwgMSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRtdWx0aXBsaWVycyA9IFtdO1xuXHRcdGZvciAoaSA9IDAsIG4gPSBmaWVsZHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG5cdFx0XHRtdWx0aXBsaWVycy5wdXNoKGZpZWxkc1tpXS5kaXJlY3Rpb24gPT09ICdkZXNjJyA/IC0xIDogMSk7XG5cdFx0fVxuXG5cdFx0Ly8gYnVpbGQgZnVuY3Rpb25cblx0XHRmaWVsZHNfY291bnQgPSBmaWVsZHMubGVuZ3RoO1xuXHRcdGlmICghZmllbGRzX2NvdW50KSB7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9IGVsc2UgaWYgKGZpZWxkc19jb3VudCA9PT0gMSkge1xuXHRcdFx0ZmllbGQgPSBmaWVsZHNbMF0uZmllbGQ7XG5cdFx0XHRtdWx0aXBsaWVyID0gbXVsdGlwbGllcnNbMF07XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oYSwgYikge1xuXHRcdFx0XHRyZXR1cm4gbXVsdGlwbGllciAqIGNtcChcblx0XHRcdFx0XHRnZXRfZmllbGQoZmllbGQsIGEpLFxuXHRcdFx0XHRcdGdldF9maWVsZChmaWVsZCwgYilcblx0XHRcdFx0KTtcblx0XHRcdH07XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBmdW5jdGlvbihhLCBiKSB7XG5cdFx0XHRcdHZhciBpLCByZXN1bHQsIGFfdmFsdWUsIGJfdmFsdWUsIGZpZWxkO1xuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgZmllbGRzX2NvdW50OyBpKyspIHtcblx0XHRcdFx0XHRmaWVsZCA9IGZpZWxkc1tpXS5maWVsZDtcblx0XHRcdFx0XHRyZXN1bHQgPSBtdWx0aXBsaWVyc1tpXSAqIGNtcChcblx0XHRcdFx0XHRcdGdldF9maWVsZChmaWVsZCwgYSksXG5cdFx0XHRcdFx0XHRnZXRfZmllbGQoZmllbGQsIGIpXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRpZiAocmVzdWx0KSByZXR1cm4gcmVzdWx0O1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0fTtcblx0XHR9XG5cdH07XG5cblx0LyoqXG5cdCAqIFBhcnNlcyBhIHNlYXJjaCBxdWVyeSBhbmQgcmV0dXJucyBhbiBvYmplY3Rcblx0ICogd2l0aCB0b2tlbnMgYW5kIGZpZWxkcyByZWFkeSB0byBiZSBwb3B1bGF0ZWRcblx0ICogd2l0aCByZXN1bHRzLlxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlcblx0ICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnNcblx0ICogQHJldHVybnMge29iamVjdH1cblx0ICovXG5cdFNpZnRlci5wcm90b3R5cGUucHJlcGFyZVNlYXJjaCA9IGZ1bmN0aW9uKHF1ZXJ5LCBvcHRpb25zKSB7XG5cdFx0aWYgKHR5cGVvZiBxdWVyeSA9PT0gJ29iamVjdCcpIHJldHVybiBxdWVyeTtcblxuXHRcdG9wdGlvbnMgPSBleHRlbmQoe30sIG9wdGlvbnMpO1xuXG5cdFx0dmFyIG9wdGlvbl9maWVsZHMgICAgID0gb3B0aW9ucy5maWVsZHM7XG5cdFx0dmFyIG9wdGlvbl9zb3J0ICAgICAgID0gb3B0aW9ucy5zb3J0O1xuXHRcdHZhciBvcHRpb25fc29ydF9lbXB0eSA9IG9wdGlvbnMuc29ydF9lbXB0eTtcblxuXHRcdGlmIChvcHRpb25fZmllbGRzICYmICFpc19hcnJheShvcHRpb25fZmllbGRzKSkgb3B0aW9ucy5maWVsZHMgPSBbb3B0aW9uX2ZpZWxkc107XG5cdFx0aWYgKG9wdGlvbl9zb3J0ICYmICFpc19hcnJheShvcHRpb25fc29ydCkpIG9wdGlvbnMuc29ydCA9IFtvcHRpb25fc29ydF07XG5cdFx0aWYgKG9wdGlvbl9zb3J0X2VtcHR5ICYmICFpc19hcnJheShvcHRpb25fc29ydF9lbXB0eSkpIG9wdGlvbnMuc29ydF9lbXB0eSA9IFtvcHRpb25fc29ydF9lbXB0eV07XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0b3B0aW9ucyA6IG9wdGlvbnMsXG5cdFx0XHRxdWVyeSAgIDogU3RyaW5nKHF1ZXJ5IHx8ICcnKS50b0xvd2VyQ2FzZSgpLFxuXHRcdFx0dG9rZW5zICA6IHRoaXMudG9rZW5pemUocXVlcnkpLFxuXHRcdFx0dG90YWwgICA6IDAsXG5cdFx0XHRpdGVtcyAgIDogW11cblx0XHR9O1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBTZWFyY2hlcyB0aHJvdWdoIGFsbCBpdGVtcyBhbmQgcmV0dXJucyBhIHNvcnRlZCBhcnJheSBvZiBtYXRjaGVzLlxuXHQgKlxuXHQgKiBUaGUgYG9wdGlvbnNgIHBhcmFtZXRlciBjYW4gY29udGFpbjpcblx0ICpcblx0ICogICAtIGZpZWxkcyB7c3RyaW5nfGFycmF5fVxuXHQgKiAgIC0gc29ydCB7YXJyYXl9XG5cdCAqICAgLSBzY29yZSB7ZnVuY3Rpb259XG5cdCAqICAgLSBmaWx0ZXIge2Jvb2x9XG5cdCAqICAgLSBsaW1pdCB7aW50ZWdlcn1cblx0ICpcblx0ICogUmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZzpcblx0ICpcblx0ICogICAtIG9wdGlvbnMge29iamVjdH1cblx0ICogICAtIHF1ZXJ5IHtzdHJpbmd9XG5cdCAqICAgLSB0b2tlbnMge2FycmF5fVxuXHQgKiAgIC0gdG90YWwge2ludH1cblx0ICogICAtIGl0ZW1zIHthcnJheX1cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5XG5cdCAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zXG5cdCAqIEByZXR1cm5zIHtvYmplY3R9XG5cdCAqL1xuXHRTaWZ0ZXIucHJvdG90eXBlLnNlYXJjaCA9IGZ1bmN0aW9uKHF1ZXJ5LCBvcHRpb25zKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLCB2YWx1ZSwgc2NvcmUsIHNlYXJjaCwgY2FsY3VsYXRlU2NvcmU7XG5cdFx0dmFyIGZuX3NvcnQ7XG5cdFx0dmFyIGZuX3Njb3JlO1xuXG5cdFx0c2VhcmNoICA9IHRoaXMucHJlcGFyZVNlYXJjaChxdWVyeSwgb3B0aW9ucyk7XG5cdFx0b3B0aW9ucyA9IHNlYXJjaC5vcHRpb25zO1xuXHRcdHF1ZXJ5ICAgPSBzZWFyY2gucXVlcnk7XG5cblx0XHQvLyBnZW5lcmF0ZSByZXN1bHQgc2NvcmluZyBmdW5jdGlvblxuXHRcdGZuX3Njb3JlID0gb3B0aW9ucy5zY29yZSB8fCBzZWxmLmdldFNjb3JlRnVuY3Rpb24oc2VhcmNoKTtcblxuXHRcdC8vIHBlcmZvcm0gc2VhcmNoIGFuZCBzb3J0XG5cdFx0aWYgKHF1ZXJ5Lmxlbmd0aCkge1xuXHRcdFx0c2VsZi5pdGVyYXRvcihzZWxmLml0ZW1zLCBmdW5jdGlvbihpdGVtLCBpZCkge1xuXHRcdFx0XHRzY29yZSA9IGZuX3Njb3JlKGl0ZW0pO1xuXHRcdFx0XHRpZiAob3B0aW9ucy5maWx0ZXIgPT09IGZhbHNlIHx8IHNjb3JlID4gMCkge1xuXHRcdFx0XHRcdHNlYXJjaC5pdGVtcy5wdXNoKHsnc2NvcmUnOiBzY29yZSwgJ2lkJzogaWR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNlbGYuaXRlcmF0b3Ioc2VsZi5pdGVtcywgZnVuY3Rpb24oaXRlbSwgaWQpIHtcblx0XHRcdFx0c2VhcmNoLml0ZW1zLnB1c2goeydzY29yZSc6IDEsICdpZCc6IGlkfSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRmbl9zb3J0ID0gc2VsZi5nZXRTb3J0RnVuY3Rpb24oc2VhcmNoLCBvcHRpb25zKTtcblx0XHRpZiAoZm5fc29ydCkgc2VhcmNoLml0ZW1zLnNvcnQoZm5fc29ydCk7XG5cblx0XHQvLyBhcHBseSBsaW1pdHNcblx0XHRzZWFyY2gudG90YWwgPSBzZWFyY2guaXRlbXMubGVuZ3RoO1xuXHRcdGlmICh0eXBlb2Ygb3B0aW9ucy5saW1pdCA9PT0gJ251bWJlcicpIHtcblx0XHRcdHNlYXJjaC5pdGVtcyA9IHNlYXJjaC5pdGVtcy5zbGljZSgwLCBvcHRpb25zLmxpbWl0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2VhcmNoO1xuXHR9O1xuXG5cdC8vIHV0aWxpdGllc1xuXHQvLyAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtXG5cblx0dmFyIGNtcCA9IGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRpZiAodHlwZW9mIGEgPT09ICdudW1iZXInICYmIHR5cGVvZiBiID09PSAnbnVtYmVyJykge1xuXHRcdFx0cmV0dXJuIGEgPiBiID8gMSA6IChhIDwgYiA/IC0xIDogMCk7XG5cdFx0fVxuXHRcdGEgPSBhc2NpaWZvbGQoU3RyaW5nKGEgfHwgJycpKTtcblx0XHRiID0gYXNjaWlmb2xkKFN0cmluZyhiIHx8ICcnKSk7XG5cdFx0aWYgKGEgPiBiKSByZXR1cm4gMTtcblx0XHRpZiAoYiA+IGEpIHJldHVybiAtMTtcblx0XHRyZXR1cm4gMDtcblx0fTtcblxuXHR2YXIgZXh0ZW5kID0gZnVuY3Rpb24oYSwgYikge1xuXHRcdHZhciBpLCBuLCBrLCBvYmplY3Q7XG5cdFx0Zm9yIChpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcblx0XHRcdG9iamVjdCA9IGFyZ3VtZW50c1tpXTtcblx0XHRcdGlmICghb2JqZWN0KSBjb250aW51ZTtcblx0XHRcdGZvciAoayBpbiBvYmplY3QpIHtcblx0XHRcdFx0aWYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eShrKSkge1xuXHRcdFx0XHRcdGFba10gPSBvYmplY3Rba107XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIGE7XG5cdH07XG5cblx0dmFyIHRyaW0gPSBmdW5jdGlvbihzdHIpIHtcblx0XHRyZXR1cm4gKHN0ciArICcnKS5yZXBsYWNlKC9eXFxzK3xcXHMrJHwvZywgJycpO1xuXHR9O1xuXG5cdHZhciBlc2NhcGVfcmVnZXggPSBmdW5jdGlvbihzdHIpIHtcblx0XHRyZXR1cm4gKHN0ciArICcnKS5yZXBsYWNlKC8oWy4/KiteJFtcXF1cXFxcKCl7fXwtXSkvZywgJ1xcXFwkMScpO1xuXHR9O1xuXG5cdHZhciBpc19hcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgKCQgJiYgJC5pc0FycmF5KSB8fCBmdW5jdGlvbihvYmplY3QpIHtcblx0XHRyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iamVjdCkgPT09ICdbb2JqZWN0IEFycmF5XSc7XG5cdH07XG5cblx0dmFyIERJQUNSSVRJQ1MgPSB7XG5cdFx0J2EnOiAnW2HDgMOBw4LDg8OEw4XDoMOhw6LDo8Okw6XEgMSBxIXEhF0nLFxuXHRcdCdjJzogJ1tjw4fDp8SHxIbEjcSMXScsXG5cdFx0J2QnOiAnW2TEkcSQxI/Ejl0nLFxuXHRcdCdlJzogJ1tlw4jDicOKw4vDqMOpw6rDq8SbxJrEksSTxJnEmF0nLFxuXHRcdCdpJzogJ1tpw4zDjcOOw4/DrMOtw67Dr8SqxKtdJyxcblx0XHQnbCc6ICdbbMWCxYFdJyxcblx0XHQnbic6ICdbbsORw7HFiMWHxYTFg10nLFxuXHRcdCdvJzogJ1tvw5LDk8OUw5XDlcOWw5jDssOzw7TDtcO2w7jFjMWNXScsXG5cdFx0J3InOiAnW3LFmcWYXScsXG5cdFx0J3MnOiAnW3PFoMWhxZvFml0nLFxuXHRcdCd0JzogJ1t0xaXFpF0nLFxuXHRcdCd1JzogJ1t1w5nDmsObw5zDucO6w7vDvMWvxa7FqsWrXScsXG5cdFx0J3knOiAnW3nFuMO/w73DnV0nLFxuXHRcdCd6JzogJ1t6xb3FvsW8xbvFusW5XSdcblx0fTtcblxuXHR2YXIgYXNjaWlmb2xkID0gKGZ1bmN0aW9uKCkge1xuXHRcdHZhciBpLCBuLCBrLCBjaHVuaztcblx0XHR2YXIgZm9yZWlnbmxldHRlcnMgPSAnJztcblx0XHR2YXIgbG9va3VwID0ge307XG5cdFx0Zm9yIChrIGluIERJQUNSSVRJQ1MpIHtcblx0XHRcdGlmIChESUFDUklUSUNTLmhhc093blByb3BlcnR5KGspKSB7XG5cdFx0XHRcdGNodW5rID0gRElBQ1JJVElDU1trXS5zdWJzdHJpbmcoMiwgRElBQ1JJVElDU1trXS5sZW5ndGggLSAxKTtcblx0XHRcdFx0Zm9yZWlnbmxldHRlcnMgKz0gY2h1bms7XG5cdFx0XHRcdGZvciAoaSA9IDAsIG4gPSBjaHVuay5sZW5ndGg7IGkgPCBuOyBpKyspIHtcblx0XHRcdFx0XHRsb29rdXBbY2h1bmsuY2hhckF0KGkpXSA9IGs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0dmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAoJ1snICsgIGZvcmVpZ25sZXR0ZXJzICsgJ10nLCAnZycpO1xuXHRcdHJldHVybiBmdW5jdGlvbihzdHIpIHtcblx0XHRcdHJldHVybiBzdHIucmVwbGFjZShyZWdleHAsIGZ1bmN0aW9uKGZvcmVpZ25sZXR0ZXIpIHtcblx0XHRcdFx0cmV0dXJuIGxvb2t1cFtmb3JlaWdubGV0dGVyXTtcblx0XHRcdH0pLnRvTG93ZXJDYXNlKCk7XG5cdFx0fTtcblx0fSkoKTtcblxuXG5cdC8vIGV4cG9ydFxuXHQvLyAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtXG5cblx0cmV0dXJuIFNpZnRlcjtcbn0pKTtcblxuIiwiLypcblNsaWNrIEZpbmRlclxuKi9cInVzZSBzdHJpY3RcIlxuXG4vLyBOb3RhYmxlIGNoYW5nZXMgZnJvbSBTbGljay5GaW5kZXIgMS4wLnhcblxuLy8gZmFzdGVyIGJvdHRvbSAtPiB1cCBleHByZXNzaW9uIG1hdGNoaW5nXG4vLyBwcmVmZXJzIG1lbnRhbCBzYW5pdHkgb3ZlciAqb2JzZXNzaXZlIGNvbXB1bHNpdmUqIG1pbGxpc2Vjb25kcyBzYXZpbmdzXG4vLyB1c2VzIHByb3RvdHlwZXMgaW5zdGVhZCBvZiBvYmplY3RzXG4vLyB0cmllcyB0byB1c2UgbWF0Y2hlc1NlbGVjdG9yIHNtYXJ0bHksIHdoZW5ldmVyIGF2YWlsYWJsZVxuLy8gY2FuIHBvcHVsYXRlIG9iamVjdHMgYXMgd2VsbCBhcyBhcnJheXNcbi8vIGxvdHMgb2Ygc3R1ZmYgaXMgYnJva2VuIG9yIG5vdCBpbXBsZW1lbnRlZFxuXG52YXIgcGFyc2UgPSByZXF1aXJlKFwiLi9wYXJzZXJcIilcblxuLy8gdXRpbGl0aWVzXG5cbnZhciBpbmRleCA9IDAsXG4gICAgY291bnRlciA9IGRvY3VtZW50Ll9fY291bnRlciA9IChwYXJzZUludChkb2N1bWVudC5fX2NvdW50ZXIgfHwgLTEsIDM2KSArIDEpLnRvU3RyaW5nKDM2KSxcbiAgICBrZXkgPSBcInVpZDpcIiArIGNvdW50ZXJcblxudmFyIHVuaXF1ZUlEID0gZnVuY3Rpb24obiwgeG1sKXtcbiAgICBpZiAobiA9PT0gd2luZG93KSByZXR1cm4gXCJ3aW5kb3dcIlxuICAgIGlmIChuID09PSBkb2N1bWVudCkgcmV0dXJuIFwiZG9jdW1lbnRcIlxuICAgIGlmIChuID09PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHJldHVybiBcImh0bWxcIlxuXG4gICAgaWYgKHhtbCkge1xuICAgICAgICB2YXIgdWlkID0gbi5nZXRBdHRyaWJ1dGUoa2V5KVxuICAgICAgICBpZiAoIXVpZCkge1xuICAgICAgICAgICAgdWlkID0gKGluZGV4KyspLnRvU3RyaW5nKDM2KVxuICAgICAgICAgICAgbi5zZXRBdHRyaWJ1dGUoa2V5LCB1aWQpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVpZFxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBuW2tleV0gfHwgKG5ba2V5XSA9IChpbmRleCsrKS50b1N0cmluZygzNikpXG4gICAgfVxufVxuXG52YXIgdW5pcXVlSURYTUwgPSBmdW5jdGlvbihuKSB7XG4gICAgcmV0dXJuIHVuaXF1ZUlEKG4sIHRydWUpXG59XG5cbnZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbihvYmplY3Qpe1xuICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gXCJbb2JqZWN0IEFycmF5XVwiXG59XG5cbi8vIHRlc3RzXG5cbnZhciB1bmlxdWVJbmRleCA9IDA7XG5cbnZhciBIQVMgPSB7XG5cbiAgICBHRVRfRUxFTUVOVF9CWV9JRDogZnVuY3Rpb24odGVzdCwgaWQpe1xuICAgICAgICBpZCA9IFwic2xpY2tfXCIgKyAodW5pcXVlSW5kZXgrKyk7XG4gICAgICAgIC8vIGNoZWNrcyBpZiB0aGUgZG9jdW1lbnQgaGFzIGdldEVsZW1lbnRCeUlkLCBhbmQgaXQgd29ya3NcbiAgICAgICAgdGVzdC5pbm5lckhUTUwgPSAnPGEgaWQ9XCInICsgaWQgKyAnXCI+PC9hPidcbiAgICAgICAgcmV0dXJuICEhdGhpcy5nZXRFbGVtZW50QnlJZChpZClcbiAgICB9LFxuXG4gICAgUVVFUllfU0VMRUNUT1I6IGZ1bmN0aW9uKHRlc3Qpe1xuICAgICAgICAvLyB0aGlzIHN1cHBvc2VkbHkgZml4ZXMgYSB3ZWJraXQgYnVnIHdpdGggbWF0Y2hlc1NlbGVjdG9yIC8gcXVlcnlTZWxlY3RvciAmIG50aC1jaGlsZFxuICAgICAgICB0ZXN0LmlubmVySFRNTCA9ICdfPHN0eWxlPjpudGgtY2hpbGQoMil7fTwvc3R5bGU+J1xuXG4gICAgICAgIC8vIGNoZWNrcyBpZiB0aGUgZG9jdW1lbnQgaGFzIHF1ZXJ5U2VsZWN0b3JBbGwsIGFuZCBpdCB3b3Jrc1xuICAgICAgICB0ZXN0LmlubmVySFRNTCA9ICc8YSBjbGFzcz1cIk1pWFwiPjwvYT4nXG5cbiAgICAgICAgcmV0dXJuIHRlc3QucXVlcnlTZWxlY3RvckFsbCgnLk1pWCcpLmxlbmd0aCA9PT0gMVxuICAgIH0sXG5cbiAgICBFWFBBTkRPUzogZnVuY3Rpb24odGVzdCwgaWQpe1xuICAgICAgICBpZCA9IFwic2xpY2tfXCIgKyAodW5pcXVlSW5kZXgrKyk7XG4gICAgICAgIC8vIGNoZWNrcyBpZiB0aGUgZG9jdW1lbnQgaGFzIGVsZW1lbnRzIHRoYXQgc3VwcG9ydCBleHBhbmRvc1xuICAgICAgICB0ZXN0Ll9jdXN0b21fcHJvcGVydHlfID0gaWRcbiAgICAgICAgcmV0dXJuIHRlc3QuX2N1c3RvbV9wcm9wZXJ0eV8gPT09IGlkXG4gICAgfSxcblxuICAgIC8vIFRPRE86IHVzZSB0aGlzID9cblxuICAgIC8vIENIRUNLRURfUVVFUllfU0VMRUNUT1I6IGZ1bmN0aW9uKHRlc3Qpe1xuICAgIC8vXG4gICAgLy8gICAgIC8vIGNoZWNrcyBpZiB0aGUgZG9jdW1lbnQgc3VwcG9ydHMgdGhlIGNoZWNrZWQgcXVlcnkgc2VsZWN0b3JcbiAgICAvLyAgICAgdGVzdC5pbm5lckhUTUwgPSAnPHNlbGVjdD48b3B0aW9uIHNlbGVjdGVkPVwic2VsZWN0ZWRcIj5hPC9vcHRpb24+PC9zZWxlY3Q+J1xuICAgIC8vICAgICByZXR1cm4gdGVzdC5xdWVyeVNlbGVjdG9yQWxsKCc6Y2hlY2tlZCcpLmxlbmd0aCA9PT0gMVxuICAgIC8vIH0sXG5cbiAgICAvLyBUT0RPOiB1c2UgdGhpcyA/XG5cbiAgICAvLyBFTVBUWV9BVFRSSUJVVEVfUVVFUllfU0VMRUNUT1I6IGZ1bmN0aW9uKHRlc3Qpe1xuICAgIC8vXG4gICAgLy8gICAgIC8vIGNoZWNrcyBpZiB0aGUgZG9jdW1lbnQgc3VwcG9ydHMgdGhlIGVtcHR5IGF0dHJpYnV0ZSBxdWVyeSBzZWxlY3RvclxuICAgIC8vICAgICB0ZXN0LmlubmVySFRNTCA9ICc8YSBjbGFzcz1cIlwiPjwvYT4nXG4gICAgLy8gICAgIHJldHVybiB0ZXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tjbGFzcyo9XCJcIl0nKS5sZW5ndGggPT09IDFcbiAgICAvLyB9LFxuXG4gICAgTUFUQ0hFU19TRUxFQ1RPUjogZnVuY3Rpb24odGVzdCl7XG5cbiAgICAgICAgdGVzdC5jbGFzc05hbWUgPSBcIk1pWFwiXG5cbiAgICAgICAgLy8gY2hlY2tzIGlmIHRoZSBkb2N1bWVudCBoYXMgbWF0Y2hlc1NlbGVjdG9yLCBhbmQgd2UgY2FuIHVzZSBpdC5cblxuICAgICAgICB2YXIgbWF0Y2hlcyA9IHRlc3QubWF0Y2hlc1NlbGVjdG9yIHx8IHRlc3QubW96TWF0Y2hlc1NlbGVjdG9yIHx8IHRlc3Qud2Via2l0TWF0Y2hlc1NlbGVjdG9yXG5cbiAgICAgICAgLy8gaWYgbWF0Y2hlc1NlbGVjdG9yIHRyb3dzIGVycm9ycyBvbiBpbmNvcnJlY3Qgc3ludGF4IHdlIGNhbiB1c2UgaXRcbiAgICAgICAgaWYgKG1hdGNoZXMpIHRyeSB7XG4gICAgICAgICAgICBtYXRjaGVzLmNhbGwodGVzdCwgJzpzbGljaycpXG4gICAgICAgIH0gY2F0Y2goZSl7XG4gICAgICAgICAgICAvLyBqdXN0IGFzIGEgc2FmZXR5IHByZWNhdXRpb24sIGFsc28gdGVzdCBpZiBpdCB3b3JrcyBvbiBtaXhlZGNhc2UgKGxpa2UgcXVlcnlTZWxlY3RvckFsbClcbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzLmNhbGwodGVzdCwgXCIuTWlYXCIpID8gbWF0Y2hlcyA6IGZhbHNlXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9LFxuXG4gICAgR0VUX0VMRU1FTlRTX0JZX0NMQVNTX05BTUU6IGZ1bmN0aW9uKHRlc3Qpe1xuICAgICAgICB0ZXN0LmlubmVySFRNTCA9ICc8YSBjbGFzcz1cImZcIj48L2E+PGEgY2xhc3M9XCJiXCI+PC9hPidcbiAgICAgICAgaWYgKHRlc3QuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYicpLmxlbmd0aCAhPT0gMSkgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgdGVzdC5maXJzdENoaWxkLmNsYXNzTmFtZSA9ICdiJ1xuICAgICAgICBpZiAodGVzdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdiJykubGVuZ3RoICE9PSAyKSByZXR1cm4gZmFsc2VcblxuICAgICAgICAvLyBPcGVyYSA5LjYgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSBkb2VzbnQgZGV0ZWN0cyB0aGUgY2xhc3MgaWYgaXRzIG5vdCB0aGUgZmlyc3Qgb25lXG4gICAgICAgIHRlc3QuaW5uZXJIVE1MID0gJzxhIGNsYXNzPVwiYVwiPjwvYT48YSBjbGFzcz1cImYgYiBhXCI+PC9hPidcbiAgICAgICAgaWYgKHRlc3QuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYScpLmxlbmd0aCAhPT0gMikgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgLy8gdGVzdHMgcGFzc2VkXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfSxcblxuICAgIC8vIG5vIG5lZWQgdG8ga25vd1xuXG4gICAgLy8gR0VUX0VMRU1FTlRfQllfSURfTk9UX05BTUU6IGZ1bmN0aW9uKHRlc3QsIGlkKXtcbiAgICAvLyAgICAgdGVzdC5pbm5lckhUTUwgPSAnPGEgbmFtZT1cIicrIGlkICsnXCI+PC9hPjxiIGlkPVwiJysgaWQgKydcIj48L2I+J1xuICAgIC8vICAgICByZXR1cm4gdGhpcy5nZXRFbGVtZW50QnlJZChpZCkgIT09IHRlc3QuZmlyc3RDaGlsZFxuICAgIC8vIH0sXG5cbiAgICAvLyB0aGlzIGlzIGFsd2F5cyBjaGVja2VkIGZvciBhbmQgZml4ZWRcblxuICAgIC8vIFNUQVJfR0VUX0VMRU1FTlRTX0JZX1RBR19OQU1FOiBmdW5jdGlvbih0ZXN0KXtcbiAgICAvL1xuICAgIC8vICAgICAvLyBJRSByZXR1cm5zIGNvbW1lbnQgbm9kZXMgZm9yIGdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJykgZm9yIHNvbWUgZG9jdW1lbnRzXG4gICAgLy8gICAgIHRlc3QuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVDb21tZW50KCcnKSlcbiAgICAvLyAgICAgaWYgKHRlc3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKS5sZW5ndGggPiAwKSByZXR1cm4gZmFsc2VcbiAgICAvL1xuICAgIC8vICAgICAvLyBJRSByZXR1cm5zIGNsb3NlZCBub2RlcyAoRUc6XCI8L2Zvbz5cIikgZm9yIGdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJykgZm9yIHNvbWUgZG9jdW1lbnRzXG4gICAgLy8gICAgIHRlc3QuaW5uZXJIVE1MID0gJ2ZvbzwvZm9vPidcbiAgICAvLyAgICAgaWYgKHRlc3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKS5sZW5ndGgpIHJldHVybiBmYWxzZVxuICAgIC8vXG4gICAgLy8gICAgIC8vIHRlc3RzIHBhc3NlZFxuICAgIC8vICAgICByZXR1cm4gdHJ1ZVxuICAgIC8vIH0sXG5cbiAgICAvLyB0aGlzIGlzIGFsd2F5cyBjaGVja2VkIGZvciBhbmQgZml4ZWRcblxuICAgIC8vIFNUQVJfUVVFUllfU0VMRUNUT1I6IGZ1bmN0aW9uKHRlc3Qpe1xuICAgIC8vXG4gICAgLy8gICAgIC8vIHJldHVybnMgY2xvc2VkIG5vZGVzIChFRzpcIjwvZm9vPlwiKSBmb3IgcXVlcnlTZWxlY3RvcignKicpIGZvciBzb21lIGRvY3VtZW50c1xuICAgIC8vICAgICB0ZXN0LmlubmVySFRNTCA9ICdmb288L2Zvbz4nXG4gICAgLy8gICAgIHJldHVybiAhISh0ZXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJyonKS5sZW5ndGgpXG4gICAgLy8gfSxcblxuICAgIEdFVF9BVFRSSUJVVEU6IGZ1bmN0aW9uKHRlc3Qpe1xuICAgICAgICAvLyB0ZXN0cyBmb3Igd29ya2luZyBnZXRBdHRyaWJ1dGUgaW1wbGVtZW50YXRpb25cbiAgICAgICAgdmFyIHNob3V0ID0gXCJmdXMgcm8gZGFoXCJcbiAgICAgICAgdGVzdC5pbm5lckhUTUwgPSAnPGEgY2xhc3M9XCInICsgc2hvdXQgKyAnXCI+PC9hPidcbiAgICAgICAgcmV0dXJuIHRlc3QuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykgPT09IHNob3V0XG4gICAgfVxuXG59XG5cbi8vIEZpbmRlclxuXG52YXIgRmluZGVyID0gZnVuY3Rpb24gRmluZGVyKGRvY3VtZW50KXtcblxuICAgIHRoaXMuZG9jdW1lbnQgICAgICAgID0gZG9jdW1lbnRcbiAgICB2YXIgcm9vdCA9IHRoaXMucm9vdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudFxuICAgIHRoaXMudGVzdGVkICAgICAgICAgID0ge31cblxuICAgIC8vIHVuaXF1ZUlEXG5cbiAgICB0aGlzLnVuaXF1ZUlEID0gdGhpcy5oYXMoXCJFWFBBTkRPU1wiKSA/IHVuaXF1ZUlEIDogdW5pcXVlSURYTUxcblxuICAgIC8vIGdldEF0dHJpYnV0ZVxuXG4gICAgdGhpcy5nZXRBdHRyaWJ1dGUgPSAodGhpcy5oYXMoXCJHRVRfQVRUUklCVVRFXCIpKSA/IGZ1bmN0aW9uKG5vZGUsIG5hbWUpe1xuXG4gICAgICAgIHJldHVybiBub2RlLmdldEF0dHJpYnV0ZShuYW1lKVxuXG4gICAgfSA6IGZ1bmN0aW9uKG5vZGUsIG5hbWUpe1xuXG4gICAgICAgIG5vZGUgPSBub2RlLmdldEF0dHJpYnV0ZU5vZGUobmFtZSlcbiAgICAgICAgcmV0dXJuIChub2RlICYmIG5vZGUuc3BlY2lmaWVkKSA/IG5vZGUudmFsdWUgOiBudWxsXG5cbiAgICB9XG5cbiAgICAvLyBoYXNBdHRyaWJ1dGVcblxuICAgIHRoaXMuaGFzQXR0cmlidXRlID0gKHJvb3QuaGFzQXR0cmlidXRlKSA/IGZ1bmN0aW9uKG5vZGUsIGF0dHJpYnV0ZSl7XG5cbiAgICAgICAgcmV0dXJuIG5vZGUuaGFzQXR0cmlidXRlKGF0dHJpYnV0ZSlcblxuICAgIH0gOiBmdW5jdGlvbihub2RlLCBhdHRyaWJ1dGUpIHtcblxuICAgICAgICBub2RlID0gbm9kZS5nZXRBdHRyaWJ1dGVOb2RlKGF0dHJpYnV0ZSlcbiAgICAgICAgcmV0dXJuICEhKG5vZGUgJiYgbm9kZS5zcGVjaWZpZWQpXG5cbiAgICB9XG5cbiAgICAvLyBjb250YWluc1xuXG4gICAgdGhpcy5jb250YWlucyA9IChkb2N1bWVudC5jb250YWlucyAmJiByb290LmNvbnRhaW5zKSA/IGZ1bmN0aW9uKGNvbnRleHQsIG5vZGUpe1xuXG4gICAgICAgIHJldHVybiBjb250ZXh0LmNvbnRhaW5zKG5vZGUpXG5cbiAgICB9IDogKHJvb3QuY29tcGFyZURvY3VtZW50UG9zaXRpb24pID8gZnVuY3Rpb24oY29udGV4dCwgbm9kZSl7XG5cbiAgICAgICAgcmV0dXJuIGNvbnRleHQgPT09IG5vZGUgfHwgISEoY29udGV4dC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihub2RlKSAmIDE2KVxuXG4gICAgfSA6IGZ1bmN0aW9uKGNvbnRleHQsIG5vZGUpe1xuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGlmIChub2RlID09PSBjb250ZXh0KSByZXR1cm4gdHJ1ZVxuICAgICAgICB9IHdoaWxlICgobm9kZSA9IG5vZGUucGFyZW50Tm9kZSkpXG5cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgLy8gc29ydFxuICAgIC8vIGNyZWRpdHMgdG8gU2l6emxlIChodHRwOi8vc2l6emxlanMuY29tLylcblxuICAgIHRoaXMuc29ydGVyID0gKHJvb3QuY29tcGFyZURvY3VtZW50UG9zaXRpb24pID8gZnVuY3Rpb24oYSwgYil7XG5cbiAgICAgICAgaWYgKCFhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uIHx8ICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKSByZXR1cm4gMFxuICAgICAgICByZXR1cm4gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSAmIDQgPyAtMSA6IGEgPT09IGIgPyAwIDogMVxuXG4gICAgfSA6ICgnc291cmNlSW5kZXgnIGluIHJvb3QpID8gZnVuY3Rpb24oYSwgYil7XG5cbiAgICAgICAgaWYgKCFhLnNvdXJjZUluZGV4IHx8ICFiLnNvdXJjZUluZGV4KSByZXR1cm4gMFxuICAgICAgICByZXR1cm4gYS5zb3VyY2VJbmRleCAtIGIuc291cmNlSW5kZXhcblxuICAgIH0gOiAoZG9jdW1lbnQuY3JlYXRlUmFuZ2UpID8gZnVuY3Rpb24oYSwgYil7XG5cbiAgICAgICAgaWYgKCFhLm93bmVyRG9jdW1lbnQgfHwgIWIub3duZXJEb2N1bWVudCkgcmV0dXJuIDBcbiAgICAgICAgdmFyIGFSYW5nZSA9IGEub3duZXJEb2N1bWVudC5jcmVhdGVSYW5nZSgpLFxuICAgICAgICAgICAgYlJhbmdlID0gYi5vd25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKClcblxuICAgICAgICBhUmFuZ2Uuc2V0U3RhcnQoYSwgMClcbiAgICAgICAgYVJhbmdlLnNldEVuZChhLCAwKVxuICAgICAgICBiUmFuZ2Uuc2V0U3RhcnQoYiwgMClcbiAgICAgICAgYlJhbmdlLnNldEVuZChiLCAwKVxuICAgICAgICByZXR1cm4gYVJhbmdlLmNvbXBhcmVCb3VuZGFyeVBvaW50cyhSYW5nZS5TVEFSVF9UT19FTkQsIGJSYW5nZSlcblxuICAgIH0gOiBudWxsXG5cbiAgICB0aGlzLmZhaWxlZCA9IHt9XG5cbiAgICB2YXIgbmF0aXZlTWF0Y2hlcyA9IHRoaXMuaGFzKFwiTUFUQ0hFU19TRUxFQ1RPUlwiKVxuXG4gICAgaWYgKG5hdGl2ZU1hdGNoZXMpIHRoaXMubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24obm9kZSwgZXhwcmVzc2lvbil7XG5cbiAgICAgICAgaWYgKHRoaXMuZmFpbGVkW2V4cHJlc3Npb25dKSByZXR1cm4gbnVsbFxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gbmF0aXZlTWF0Y2hlcy5jYWxsKG5vZGUsIGV4cHJlc3Npb24pXG4gICAgICAgIH0gY2F0Y2goZSl7XG4gICAgICAgICAgICBpZiAoc2xpY2suZGVidWcpIGNvbnNvbGUud2FybihcIm1hdGNoZXNTZWxlY3RvciBmYWlsZWQgb24gXCIgKyBleHByZXNzaW9uKVxuICAgICAgICAgICAgdGhpcy5mYWlsZWRbZXhwcmVzc2lvbl0gPSB0cnVlXG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBpZiAodGhpcy5oYXMoXCJRVUVSWV9TRUxFQ1RPUlwiKSl7XG5cbiAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsID0gZnVuY3Rpb24obm9kZSwgZXhwcmVzc2lvbil7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmZhaWxlZFtleHByZXNzaW9uXSkgcmV0dXJuIHRydWVcblxuICAgICAgICAgICAgdmFyIHJlc3VsdCwgX2lkLCBfZXhwcmVzc2lvbiwgX2NvbWJpbmF0b3IsIF9ub2RlXG5cblxuICAgICAgICAgICAgLy8gbm9uLWRvY3VtZW50IHJvb3RlZCBRU0FcbiAgICAgICAgICAgIC8vIGNyZWRpdHMgdG8gQW5kcmV3IER1cG9udFxuXG4gICAgICAgICAgICBpZiAobm9kZSAhPT0gdGhpcy5kb2N1bWVudCl7XG5cbiAgICAgICAgICAgICAgICBfY29tYmluYXRvciA9IGV4cHJlc3Npb25bMF0uY29tYmluYXRvclxuXG4gICAgICAgICAgICAgICAgX2lkICAgICAgICAgPSBub2RlLmdldEF0dHJpYnV0ZShcImlkXCIpXG4gICAgICAgICAgICAgICAgX2V4cHJlc3Npb24gPSBleHByZXNzaW9uXG5cbiAgICAgICAgICAgICAgICBpZiAoIV9pZCl7XG4gICAgICAgICAgICAgICAgICAgIF9ub2RlID0gbm9kZVxuICAgICAgICAgICAgICAgICAgICBfaWQgPSBcIl9fc2xpY2tfX1wiXG4gICAgICAgICAgICAgICAgICAgIF9ub2RlLnNldEF0dHJpYnV0ZShcImlkXCIsIF9pZClcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBleHByZXNzaW9uID0gXCIjXCIgKyBfaWQgKyBcIiBcIiArIF9leHByZXNzaW9uXG5cblxuICAgICAgICAgICAgICAgIC8vIHRoZXNlIGNvbWJpbmF0b3JzIG5lZWQgYSBwYXJlbnROb2RlIGR1ZSB0byBob3cgcXVlcnlTZWxlY3RvckFsbCB3b3Jrcywgd2hpY2ggaXM6XG4gICAgICAgICAgICAgICAgLy8gZmluZGluZyBhbGwgdGhlIGVsZW1lbnRzIHRoYXQgbWF0Y2ggdGhlIGdpdmVuIHNlbGVjdG9yXG4gICAgICAgICAgICAgICAgLy8gdGhlbiBmaWx0ZXJpbmcgYnkgdGhlIG9uZXMgdGhhdCBoYXZlIHRoZSBzcGVjaWZpZWQgZWxlbWVudCBhcyBhbiBhbmNlc3RvclxuICAgICAgICAgICAgICAgIGlmIChfY29tYmluYXRvci5pbmRleE9mKFwiflwiKSA+IC0xIHx8IF9jb21iaW5hdG9yLmluZGV4T2YoXCIrXCIpID4gLTEpe1xuXG4gICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGVcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlKSByZXN1bHQgPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIG5vZGUgaGFzIG5vIHBhcmVudE5vZGUsIHdlIHJldHVybiBcInRydWVcIiBhcyBpZiBpdCBmYWlsZWQsIHdpdGhvdXQgcG9sbHV0aW5nIHRoZSBmYWlsZWQgY2FjaGVcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXJlc3VsdCkgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBub2RlLnF1ZXJ5U2VsZWN0b3JBbGwoZXhwcmVzc2lvbi50b1N0cmluZygpKVxuICAgICAgICAgICAgfSBjYXRjaChlKXtcbiAgICAgICAgICAgICAgICBpZiAoc2xpY2suZGVidWcpIGNvbnNvbGUud2FybihcInF1ZXJ5U2VsZWN0b3JBbGwgZmFpbGVkIG9uIFwiICsgKF9leHByZXNzaW9uIHx8IGV4cHJlc3Npb24pKVxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZmFpbGVkW19leHByZXNzaW9uIHx8IGV4cHJlc3Npb25dID0gdHJ1ZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoX25vZGUpIF9ub2RlLnJlbW92ZUF0dHJpYnV0ZShcImlkXCIpXG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHRcblxuICAgICAgICB9XG5cbiAgICB9XG5cbn1cblxuRmluZGVyLnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbihGRUFUVVJFKXtcblxuICAgIHZhciB0ZXN0ZWQgICAgICAgID0gdGhpcy50ZXN0ZWQsXG4gICAgICAgIHRlc3RlZEZFQVRVUkUgPSB0ZXN0ZWRbRkVBVFVSRV1cblxuICAgIGlmICh0ZXN0ZWRGRUFUVVJFICE9IG51bGwpIHJldHVybiB0ZXN0ZWRGRUFUVVJFXG5cbiAgICB2YXIgcm9vdCAgICAgPSB0aGlzLnJvb3QsXG4gICAgICAgIGRvY3VtZW50ID0gdGhpcy5kb2N1bWVudCxcbiAgICAgICAgdGVzdE5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG5cbiAgICB0ZXN0Tm9kZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImRpc3BsYXk6IG5vbmU7XCIpXG5cbiAgICByb290LmFwcGVuZENoaWxkKHRlc3ROb2RlKVxuXG4gICAgdmFyIFRFU1QgPSBIQVNbRkVBVFVSRV0sIHJlc3VsdCA9IGZhbHNlXG5cbiAgICBpZiAoVEVTVCkgdHJ5IHtcbiAgICAgICAgcmVzdWx0ID0gVEVTVC5jYWxsKGRvY3VtZW50LCB0ZXN0Tm9kZSlcbiAgICB9IGNhdGNoKGUpe31cblxuICAgIGlmIChzbGljay5kZWJ1ZyAmJiAhcmVzdWx0KSBjb25zb2xlLndhcm4oXCJkb2N1bWVudCBoYXMgbm8gXCIgKyBGRUFUVVJFKVxuXG4gICAgcm9vdC5yZW1vdmVDaGlsZCh0ZXN0Tm9kZSlcblxuICAgIHJldHVybiB0ZXN0ZWRbRkVBVFVSRV0gPSByZXN1bHRcblxufVxuXG52YXIgY29tYmluYXRvcnMgPSB7XG5cbiAgICBcIiBcIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7XG5cbiAgICAgICAgdmFyIGl0ZW0sIGl0ZW1zXG5cbiAgICAgICAgdmFyIG5vSWQgPSAhcGFydC5pZCwgbm9UYWcgPSAhcGFydC50YWcsIG5vQ2xhc3MgPSAhcGFydC5jbGFzc2VzXG5cbiAgICAgICAgaWYgKHBhcnQuaWQgJiYgbm9kZS5nZXRFbGVtZW50QnlJZCAmJiB0aGlzLmhhcyhcIkdFVF9FTEVNRU5UX0JZX0lEXCIpKXtcbiAgICAgICAgICAgIGl0ZW0gPSBub2RlLmdldEVsZW1lbnRCeUlkKHBhcnQuaWQpXG5cbiAgICAgICAgICAgIC8vIHJldHVybiBvbmx5IGlmIGlkIGlzIGZvdW5kLCBlbHNlIGtlZXAgY2hlY2tpbmdcbiAgICAgICAgICAgIC8vIG1pZ2h0IGJlIGEgdGFkIHNsb3dlciBvbiBub24tZXhpc3RpbmcgaWRzLCBidXQgbGVzcyBpbnNhbmVcblxuICAgICAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbS5nZXRBdHRyaWJ1dGUoJ2lkJykgPT09IHBhcnQuaWQpe1xuICAgICAgICAgICAgICAgIGl0ZW1zID0gW2l0ZW1dXG4gICAgICAgICAgICAgICAgbm9JZCA9IHRydWVcbiAgICAgICAgICAgICAgICAvLyBpZiB0YWcgaXMgc3Rhciwgbm8gbmVlZCB0byBjaGVjayBpdCBpbiBtYXRjaCgpXG4gICAgICAgICAgICAgICAgaWYgKHBhcnQudGFnID09PSBcIipcIikgbm9UYWcgPSB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWl0ZW1zKXtcblxuICAgICAgICAgICAgaWYgKHBhcnQuY2xhc3NlcyAmJiBub2RlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgdGhpcy5oYXMoXCJHRVRfRUxFTUVOVFNfQllfQ0xBU1NfTkFNRVwiKSl7XG4gICAgICAgICAgICAgICAgaXRlbXMgPSBub2RlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUocGFydC5jbGFzc0xpc3QpXG4gICAgICAgICAgICAgICAgbm9DbGFzcyA9IHRydWVcbiAgICAgICAgICAgICAgICAvLyBpZiB0YWcgaXMgc3Rhciwgbm8gbmVlZCB0byBjaGVjayBpdCBpbiBtYXRjaCgpXG4gICAgICAgICAgICAgICAgaWYgKHBhcnQudGFnID09PSBcIipcIikgbm9UYWcgPSB0cnVlXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGl0ZW1zID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShwYXJ0LnRhZylcbiAgICAgICAgICAgICAgICAvLyBpZiB0YWcgaXMgc3RhciwgbmVlZCB0byBjaGVjayBpdCBpbiBtYXRjaCBiZWNhdXNlIGl0IGNvdWxkIHNlbGVjdCBqdW5rLCBib2hvXG4gICAgICAgICAgICAgICAgaWYgKHBhcnQudGFnICE9PSBcIipcIikgbm9UYWcgPSB0cnVlXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghaXRlbXMgfHwgIWl0ZW1zLmxlbmd0aCkgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpdGVtID0gaXRlbXNbaSsrXTspXG4gICAgICAgICAgICBpZiAoKG5vVGFnICYmIG5vSWQgJiYgbm9DbGFzcyAmJiAhcGFydC5hdHRyaWJ1dGVzICYmICFwYXJ0LnBzZXVkb3MpIHx8IHRoaXMubWF0Y2goaXRlbSwgcGFydCwgbm9UYWcsIG5vSWQsIG5vQ2xhc3MpKVxuICAgICAgICAgICAgICAgIHB1c2goaXRlbSlcblxuICAgICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgfSxcblxuICAgIFwiPlwiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gZGlyZWN0IGNoaWxkcmVuXG4gICAgICAgIGlmICgobm9kZSA9IG5vZGUuZmlyc3RDaGlsZCkpIGRvIHtcbiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09IDEgJiYgdGhpcy5tYXRjaChub2RlLCBwYXJ0KSkgcHVzaChub2RlKVxuICAgICAgICB9IHdoaWxlICgobm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpKVxuICAgIH0sXG5cbiAgICBcIitcIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7IC8vIG5leHQgc2libGluZ1xuICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHRTaWJsaW5nKSkgaWYgKG5vZGUubm9kZVR5cGUgPT0gMSl7XG4gICAgICAgICAgICBpZiAodGhpcy5tYXRjaChub2RlLCBwYXJ0KSkgcHVzaChub2RlKVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBcIl5cIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7IC8vIGZpcnN0IGNoaWxkXG4gICAgICAgIG5vZGUgPSBub2RlLmZpcnN0Q2hpbGRcbiAgICAgICAgaWYgKG5vZGUpe1xuICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKG5vZGUsIHBhcnQpKSBwdXNoKG5vZGUpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbWJpbmF0b3JzWycrJ10uY2FsbCh0aGlzLCBub2RlLCBwYXJ0LCBwdXNoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIFwiflwiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gbmV4dCBzaWJsaW5nc1xuICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHRTaWJsaW5nKSl7XG4gICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSAmJiB0aGlzLm1hdGNoKG5vZGUsIHBhcnQpKSBwdXNoKG5vZGUpXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgXCIrK1wiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gbmV4dCBzaWJsaW5nIGFuZCBwcmV2aW91cyBzaWJsaW5nXG4gICAgICAgIGNvbWJpbmF0b3JzWycrJ10uY2FsbCh0aGlzLCBub2RlLCBwYXJ0LCBwdXNoKVxuICAgICAgICBjb21iaW5hdG9yc1snISsnXS5jYWxsKHRoaXMsIG5vZGUsIHBhcnQsIHB1c2gpXG4gICAgfSxcblxuICAgIFwifn5cIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7IC8vIG5leHQgc2libGluZ3MgYW5kIHByZXZpb3VzIHNpYmxpbmdzXG4gICAgICAgIGNvbWJpbmF0b3JzWyd+J10uY2FsbCh0aGlzLCBub2RlLCBwYXJ0LCBwdXNoKVxuICAgICAgICBjb21iaW5hdG9yc1snIX4nXS5jYWxsKHRoaXMsIG5vZGUsIHBhcnQsIHB1c2gpXG4gICAgfSxcblxuICAgIFwiIVwiOiBmdW5jdGlvbihub2RlLCBwYXJ0LCBwdXNoKXsgLy8gYWxsIHBhcmVudCBub2RlcyB1cCB0byBkb2N1bWVudFxuICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLnBhcmVudE5vZGUpKSBpZiAobm9kZSAhPT0gdGhpcy5kb2N1bWVudCAmJiB0aGlzLm1hdGNoKG5vZGUsIHBhcnQpKSBwdXNoKG5vZGUpXG4gICAgfSxcblxuICAgIFwiIT5cIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7IC8vIGRpcmVjdCBwYXJlbnQgKG9uZSBsZXZlbClcbiAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZVxuICAgICAgICBpZiAobm9kZSAhPT0gdGhpcy5kb2N1bWVudCAmJiB0aGlzLm1hdGNoKG5vZGUsIHBhcnQpKSBwdXNoKG5vZGUpXG4gICAgfSxcblxuICAgIFwiIStcIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7IC8vIHByZXZpb3VzIHNpYmxpbmdcbiAgICAgICAgd2hpbGUgKChub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcpKSBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKXtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKG5vZGUsIHBhcnQpKSBwdXNoKG5vZGUpXG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIFwiIV5cIjogZnVuY3Rpb24obm9kZSwgcGFydCwgcHVzaCl7IC8vIGxhc3QgY2hpbGRcbiAgICAgICAgbm9kZSA9IG5vZGUubGFzdENoaWxkXG4gICAgICAgIGlmIChub2RlKXtcbiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09IDEpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKG5vZGUsIHBhcnQpKSBwdXNoKG5vZGUpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbWJpbmF0b3JzWychKyddLmNhbGwodGhpcywgbm9kZSwgcGFydCwgcHVzaClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBcIiF+XCI6IGZ1bmN0aW9uKG5vZGUsIHBhcnQsIHB1c2gpeyAvLyBwcmV2aW91cyBzaWJsaW5nc1xuICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLnByZXZpb3VzU2libGluZykpe1xuICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEgJiYgdGhpcy5tYXRjaChub2RlLCBwYXJ0KSkgcHVzaChub2RlKVxuICAgICAgICB9XG4gICAgfVxuXG59XG5cbkZpbmRlci5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24oY29udGV4dCwgZXhwcmVzc2lvbiwgZm91bmQpe1xuXG4gICAgaWYgKCFjb250ZXh0KSBjb250ZXh0ID0gdGhpcy5kb2N1bWVudFxuICAgIGVsc2UgaWYgKCFjb250ZXh0Lm5vZGVUeXBlICYmIGNvbnRleHQuZG9jdW1lbnQpIGNvbnRleHQgPSBjb250ZXh0LmRvY3VtZW50XG5cbiAgICB2YXIgZXhwcmVzc2lvbnMgPSBwYXJzZShleHByZXNzaW9uKVxuXG4gICAgLy8gbm8gZXhwcmVzc2lvbnMgd2VyZSBwYXJzZWQuIHRvZG86IGlzIHRoaXMgcmVhbGx5IG5lY2Vzc2FyeT9cbiAgICBpZiAoIWV4cHJlc3Npb25zIHx8ICFleHByZXNzaW9ucy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgZXhwcmVzc2lvblwiKVxuXG4gICAgaWYgKCFmb3VuZCkgZm91bmQgPSBbXVxuXG4gICAgdmFyIHVuaXF1ZXMsIHB1c2ggPSBpc0FycmF5KGZvdW5kKSA/IGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICBmb3VuZFtmb3VuZC5sZW5ndGhdID0gbm9kZVxuICAgIH0gOiBmdW5jdGlvbihub2RlKXtcbiAgICAgICAgZm91bmRbZm91bmQubGVuZ3RoKytdID0gbm9kZVxuICAgIH1cblxuICAgIC8vIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgZXhwcmVzc2lvbiB3ZSBuZWVkIHRvIGNoZWNrIGZvciBkdXBsaWNhdGVzIHdoZW4gd2UgcHVzaCB0byBmb3VuZFxuICAgIC8vIHRoaXMgc2ltcGx5IHNhdmVzIHRoZSBvbGQgcHVzaCBhbmQgd3JhcHMgaXQgYXJvdW5kIGFuIHVpZCBkdXBlIGNoZWNrLlxuICAgIGlmIChleHByZXNzaW9ucy5sZW5ndGggPiAxKXtcbiAgICAgICAgdW5pcXVlcyA9IHt9XG4gICAgICAgIHZhciBwbHVzaCA9IHB1c2hcbiAgICAgICAgcHVzaCA9IGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgdmFyIHVpZCA9IHVuaXF1ZUlEKG5vZGUpXG4gICAgICAgICAgICBpZiAoIXVuaXF1ZXNbdWlkXSl7XG4gICAgICAgICAgICAgICAgdW5pcXVlc1t1aWRdID0gdHJ1ZVxuICAgICAgICAgICAgICAgIHBsdXNoKG5vZGUpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB3YWxrZXJcblxuICAgIHZhciBub2RlLCBub2RlcywgcGFydFxuXG4gICAgbWFpbjogZm9yICh2YXIgaSA9IDA7IGV4cHJlc3Npb24gPSBleHByZXNzaW9uc1tpKytdOyl7XG5cbiAgICAgICAgLy8gcXVlcnlTZWxlY3RvclxuXG4gICAgICAgIC8vIFRPRE86IG1vcmUgZnVuY3Rpb25hbCB0ZXN0c1xuXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzIHF1ZXJ5U2VsZWN0b3JBbGwgKGFuZCB0aGUgZXhwcmVzc2lvbiBkb2VzIG5vdCBmYWlsKSB1c2UgaXQuXG4gICAgICAgIGlmICghc2xpY2subm9RU0EgJiYgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKXtcblxuICAgICAgICAgICAgbm9kZXMgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoY29udGV4dCwgZXhwcmVzc2lvbilcbiAgICAgICAgICAgIGlmIChub2RlcyAhPT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGVzICYmIG5vZGVzLmxlbmd0aCkgZm9yICh2YXIgaiA9IDA7IG5vZGUgPSBub2Rlc1tqKytdOykgaWYgKG5vZGUubm9kZU5hbWUgPiAnQCcpe1xuICAgICAgICAgICAgICAgICAgICBwdXNoKG5vZGUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlIG1haW5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzIG9ubHkgb25lIHBhcnQgaW4gdGhlIGV4cHJlc3Npb24gd2UgZG9uJ3QgbmVlZCB0byBjaGVjayBlYWNoIHBhcnQgZm9yIGR1cGxpY2F0ZXMuXG4gICAgICAgIC8vIHRvZG86IHRoaXMgbWlnaHQgYmUgdG9vIG5haXZlLiB3aGlsZSBzb2xpZCwgdGhlcmUgY2FuIGJlIGV4cHJlc3Npb24gc2VxdWVuY2VzIHRoYXQgZG8gbm90XG4gICAgICAgIC8vIHByb2R1Y2UgZHVwbGljYXRlcy4gXCJib2R5IGRpdlwiIGZvciBpbnN0YW5jZSwgY2FuIG5ldmVyIGdpdmUgeW91IGVhY2ggZGl2IG1vcmUgdGhhbiBvbmNlLlxuICAgICAgICAvLyBcImJvZHkgZGl2IGFcIiBvbiB0aGUgb3RoZXIgaGFuZCBtaWdodC5cbiAgICAgICAgaWYgKGV4cHJlc3Npb24ubGVuZ3RoID09PSAxKXtcblxuICAgICAgICAgICAgcGFydCA9IGV4cHJlc3Npb25bMF1cbiAgICAgICAgICAgIGNvbWJpbmF0b3JzW3BhcnQuY29tYmluYXRvcl0uY2FsbCh0aGlzLCBjb250ZXh0LCBwYXJ0LCBwdXNoKVxuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHZhciBjcyA9IFtjb250ZXh0XSwgYywgZiwgdSwgcCA9IGZ1bmN0aW9uKG5vZGUpe1xuICAgICAgICAgICAgICAgIHZhciB1aWQgPSB1bmlxdWVJRChub2RlKVxuICAgICAgICAgICAgICAgIGlmICghdVt1aWRdKXtcbiAgICAgICAgICAgICAgICAgICAgdVt1aWRdID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICBmW2YubGVuZ3RoXSA9IG5vZGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGxvb3AgdGhlIGV4cHJlc3Npb24gcGFydHNcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBwYXJ0ID0gZXhwcmVzc2lvbltqKytdOyl7XG4gICAgICAgICAgICAgICAgZiA9IFtdOyB1ID0ge31cbiAgICAgICAgICAgICAgICAvLyBsb29wIHRoZSBjb250ZXh0c1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBjID0gY3NbaysrXTspIGNvbWJpbmF0b3JzW3BhcnQuY29tYmluYXRvcl0uY2FsbCh0aGlzLCBjLCBwYXJ0LCBwKVxuICAgICAgICAgICAgICAgIC8vIG5vdGhpbmcgd2FzIGZvdW5kLCB0aGUgZXhwcmVzc2lvbiBmYWlsZWQsIGNvbnRpbnVlIHRvIHRoZSBuZXh0IGV4cHJlc3Npb24uXG4gICAgICAgICAgICAgICAgaWYgKCFmLmxlbmd0aCkgY29udGludWUgbWFpblxuICAgICAgICAgICAgICAgIGNzID0gZiAvLyBzZXQgdGhlIGNvbnRleHRzIGZvciBmdXR1cmUgcGFydHMgKGlmIGFueSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGkgPT09IDApIGZvdW5kID0gZiAvLyBmaXJzdCBleHByZXNzaW9uLiBkaXJlY3RseSBzZXQgZm91bmQuXG4gICAgICAgICAgICBlbHNlIGZvciAodmFyIGwgPSAwOyBsIDwgZi5sZW5ndGg7IGwrKykgcHVzaChmW2xdKSAvLyBhbnkgb3RoZXIgZXhwcmVzc2lvbiBuZWVkcyB0byBwdXNoIHRvIGZvdW5kLlxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBpZiAodW5pcXVlcyAmJiBmb3VuZCAmJiBmb3VuZC5sZW5ndGggPiAxKSB0aGlzLnNvcnQoZm91bmQpXG5cbiAgICByZXR1cm4gZm91bmRcblxufVxuXG5GaW5kZXIucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbihub2Rlcyl7XG4gICAgcmV0dXJuIHRoaXMuc29ydGVyID8gQXJyYXkucHJvdG90eXBlLnNvcnQuY2FsbChub2RlcywgdGhpcy5zb3J0ZXIpIDogbm9kZXNcbn1cblxuLy8gVE9ETzogbW9zdCBvZiB0aGVzZSBwc2V1ZG8gc2VsZWN0b3JzIGluY2x1ZGUgPGh0bWw+IGFuZCBxc2EgZG9lc250LiBmaXhtZS5cblxudmFyIHBzZXVkb3MgPSB7XG5cblxuICAgIC8vIFRPRE86IHJldHVybnMgZGlmZmVyZW50IHJlc3VsdHMgdGhhbiBxc2EgZW1wdHkuXG5cbiAgICAnZW1wdHknOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gISh0aGlzICYmIHRoaXMubm9kZVR5cGUgPT09IDEpICYmICEodGhpcy5pbm5lclRleHQgfHwgdGhpcy50ZXh0Q29udGVudCB8fCAnJykubGVuZ3RoXG4gICAgfSxcblxuICAgICdub3QnOiBmdW5jdGlvbihleHByZXNzaW9uKXtcbiAgICAgICAgcmV0dXJuICFzbGljay5tYXRjaCh0aGlzLCBleHByZXNzaW9uKVxuICAgIH0sXG5cbiAgICAnY29udGFpbnMnOiBmdW5jdGlvbih0ZXh0KXtcbiAgICAgICAgcmV0dXJuICh0aGlzLmlubmVyVGV4dCB8fCB0aGlzLnRleHRDb250ZW50IHx8ICcnKS5pbmRleE9mKHRleHQpID4gLTFcbiAgICB9LFxuXG4gICAgJ2ZpcnN0LWNoaWxkJzogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzXG4gICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUucHJldmlvdXNTaWJsaW5nKSkgaWYgKG5vZGUubm9kZVR5cGUgPT0gMSkgcmV0dXJuIGZhbHNlXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfSxcblxuICAgICdsYXN0LWNoaWxkJzogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzXG4gICAgICAgIHdoaWxlICgobm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpKSBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKSByZXR1cm4gZmFsc2VcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9LFxuXG4gICAgJ29ubHktY2hpbGQnOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgcHJldiA9IHRoaXNcbiAgICAgICAgd2hpbGUgKChwcmV2ID0gcHJldi5wcmV2aW91c1NpYmxpbmcpKSBpZiAocHJldi5ub2RlVHlwZSA9PSAxKSByZXR1cm4gZmFsc2VcblxuICAgICAgICB2YXIgbmV4dCA9IHRoaXNcbiAgICAgICAgd2hpbGUgKChuZXh0ID0gbmV4dC5uZXh0U2libGluZykpIGlmIChuZXh0Lm5vZGVUeXBlID09IDEpIHJldHVybiBmYWxzZVxuXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfSxcblxuICAgICdmaXJzdC1vZi10eXBlJzogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLCBub2RlTmFtZSA9IG5vZGUubm9kZU5hbWVcbiAgICAgICAgd2hpbGUgKChub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcpKSBpZiAobm9kZS5ub2RlTmFtZSA9PSBub2RlTmFtZSkgcmV0dXJuIGZhbHNlXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfSxcblxuICAgICdsYXN0LW9mLXR5cGUnOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMsIG5vZGVOYW1lID0gbm9kZS5ub2RlTmFtZVxuICAgICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLm5leHRTaWJsaW5nKSkgaWYgKG5vZGUubm9kZU5hbWUgPT0gbm9kZU5hbWUpIHJldHVybiBmYWxzZVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG5cbiAgICAnb25seS1vZi10eXBlJzogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHByZXYgPSB0aGlzLCBub2RlTmFtZSA9IHRoaXMubm9kZU5hbWVcbiAgICAgICAgd2hpbGUgKChwcmV2ID0gcHJldi5wcmV2aW91c1NpYmxpbmcpKSBpZiAocHJldi5ub2RlTmFtZSA9PSBub2RlTmFtZSkgcmV0dXJuIGZhbHNlXG4gICAgICAgIHZhciBuZXh0ID0gdGhpc1xuICAgICAgICB3aGlsZSAoKG5leHQgPSBuZXh0Lm5leHRTaWJsaW5nKSkgaWYgKG5leHQubm9kZU5hbWUgPT0gbm9kZU5hbWUpIHJldHVybiBmYWxzZVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG5cbiAgICAnZW5hYmxlZCc6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiAhdGhpcy5kaXNhYmxlZFxuICAgIH0sXG5cbiAgICAnZGlzYWJsZWQnOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5kaXNhYmxlZFxuICAgIH0sXG5cbiAgICAnY2hlY2tlZCc6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrZWQgfHwgdGhpcy5zZWxlY3RlZFxuICAgIH0sXG5cbiAgICAnc2VsZWN0ZWQnOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFxuICAgIH0sXG5cbiAgICAnZm9jdXMnOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgZG9jID0gdGhpcy5vd25lckRvY3VtZW50XG4gICAgICAgIHJldHVybiBkb2MuYWN0aXZlRWxlbWVudCA9PT0gdGhpcyAmJiAodGhpcy5ocmVmIHx8IHRoaXMudHlwZSB8fCBzbGljay5oYXNBdHRyaWJ1dGUodGhpcywgJ3RhYmluZGV4JykpXG4gICAgfSxcblxuICAgICdyb290JzogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuICh0aGlzID09PSB0aGlzLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KVxuICAgIH1cblxufVxuXG5GaW5kZXIucHJvdG90eXBlLm1hdGNoID0gZnVuY3Rpb24obm9kZSwgYml0LCBub1RhZywgbm9JZCwgbm9DbGFzcyl7XG5cbiAgICAvLyBUT0RPOiBtb3JlIGZ1bmN0aW9uYWwgdGVzdHMgP1xuXG4gICAgaWYgKCFzbGljay5ub1FTQSAmJiB0aGlzLm1hdGNoZXNTZWxlY3Rvcil7XG4gICAgICAgIHZhciBtYXRjaGVzID0gdGhpcy5tYXRjaGVzU2VsZWN0b3Iobm9kZSwgYml0KVxuICAgICAgICBpZiAobWF0Y2hlcyAhPT0gbnVsbCkgcmV0dXJuIG1hdGNoZXNcbiAgICB9XG5cbiAgICAvLyBub3JtYWwgbWF0Y2hpbmdcblxuICAgIGlmICghbm9UYWcgJiYgYml0LnRhZyl7XG5cbiAgICAgICAgdmFyIG5vZGVOYW1lID0gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGlmIChiaXQudGFnID09PSBcIipcIil7XG4gICAgICAgICAgICBpZiAobm9kZU5hbWUgPCBcIkBcIikgcmV0dXJuIGZhbHNlXG4gICAgICAgIH0gZWxzZSBpZiAobm9kZU5hbWUgIT0gYml0LnRhZyl7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgaWYgKCFub0lkICYmIGJpdC5pZCAmJiBub2RlLmdldEF0dHJpYnV0ZSgnaWQnKSAhPT0gYml0LmlkKSByZXR1cm4gZmFsc2VcblxuICAgIHZhciBpLCBwYXJ0XG5cbiAgICBpZiAoIW5vQ2xhc3MgJiYgYml0LmNsYXNzZXMpe1xuXG4gICAgICAgIHZhciBjbGFzc05hbWUgPSB0aGlzLmdldEF0dHJpYnV0ZShub2RlLCBcImNsYXNzXCIpXG4gICAgICAgIGlmICghY2xhc3NOYW1lKSByZXR1cm4gZmFsc2VcblxuICAgICAgICBmb3IgKHBhcnQgaW4gYml0LmNsYXNzZXMpIGlmICghUmVnRXhwKCcoXnxcXFxccyknICsgYml0LmNsYXNzZXNbcGFydF0gKyAnKFxcXFxzfCQpJykudGVzdChjbGFzc05hbWUpKSByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICB2YXIgbmFtZSwgdmFsdWVcblxuICAgIGlmIChiaXQuYXR0cmlidXRlcykgZm9yIChpID0gMDsgcGFydCA9IGJpdC5hdHRyaWJ1dGVzW2krK107KXtcblxuICAgICAgICB2YXIgb3BlcmF0b3IgID0gcGFydC5vcGVyYXRvcixcbiAgICAgICAgICAgIGVzY2FwZWQgICA9IHBhcnQuZXNjYXBlZFZhbHVlXG5cbiAgICAgICAgbmFtZSAgPSBwYXJ0Lm5hbWVcbiAgICAgICAgdmFsdWUgPSBwYXJ0LnZhbHVlXG5cbiAgICAgICAgaWYgKCFvcGVyYXRvcil7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUobm9kZSwgbmFtZSkpIHJldHVybiBmYWxzZVxuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHZhciBhY3R1YWwgPSB0aGlzLmdldEF0dHJpYnV0ZShub2RlLCBuYW1lKVxuICAgICAgICAgICAgaWYgKGFjdHVhbCA9PSBudWxsKSByZXR1cm4gZmFsc2VcblxuICAgICAgICAgICAgc3dpdGNoIChvcGVyYXRvcil7XG4gICAgICAgICAgICAgICAgY2FzZSAnXj0nIDogaWYgKCFSZWdFeHAoICAgICAgJ14nICsgZXNjYXBlZCAgICAgICAgICAgICkudGVzdChhY3R1YWwpKSByZXR1cm4gZmFsc2U7IGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAnJD0nIDogaWYgKCFSZWdFeHAoICAgICAgICAgICAgZXNjYXBlZCArICckJyAgICAgICkudGVzdChhY3R1YWwpKSByZXR1cm4gZmFsc2U7IGJyZWFrXG4gICAgICAgICAgICAgICAgY2FzZSAnfj0nIDogaWYgKCFSZWdFeHAoJyhefFxcXFxzKScgKyBlc2NhcGVkICsgJyhcXFxcc3wkKScpLnRlc3QoYWN0dWFsKSkgcmV0dXJuIGZhbHNlOyBicmVha1xuICAgICAgICAgICAgICAgIGNhc2UgJ3w9JyA6IGlmICghUmVnRXhwKCAgICAgICdeJyArIGVzY2FwZWQgKyAnKC18JCknICApLnRlc3QoYWN0dWFsKSkgcmV0dXJuIGZhbHNlOyBicmVha1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnPScgIDogaWYgKGFjdHVhbCAhPT0gdmFsdWUpIHJldHVybiBmYWxzZTsgYnJlYWtcbiAgICAgICAgICAgICAgICBjYXNlICcqPScgOiBpZiAoYWN0dWFsLmluZGV4T2YodmFsdWUpID09PSAtMSkgcmV0dXJuIGZhbHNlOyBicmVha1xuICAgICAgICAgICAgICAgIGRlZmF1bHQgICA6IHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYml0LnBzZXVkb3MpIGZvciAoaSA9IDA7IHBhcnQgPSBiaXQucHNldWRvc1tpKytdOyl7XG5cbiAgICAgICAgbmFtZSAgPSBwYXJ0Lm5hbWVcbiAgICAgICAgdmFsdWUgPSBwYXJ0LnZhbHVlXG5cbiAgICAgICAgaWYgKHBzZXVkb3NbbmFtZV0pIHJldHVybiBwc2V1ZG9zW25hbWVdLmNhbGwobm9kZSwgdmFsdWUpXG5cbiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKG5vZGUsIG5hbWUpICE9PSB2YWx1ZSkgcmV0dXJuIGZhbHNlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzQXR0cmlidXRlKG5vZGUsIG5hbWUpKSByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWVcblxufVxuXG5GaW5kZXIucHJvdG90eXBlLm1hdGNoZXMgPSBmdW5jdGlvbihub2RlLCBleHByZXNzaW9uKXtcblxuICAgIHZhciBleHByZXNzaW9ucyA9IHBhcnNlKGV4cHJlc3Npb24pXG5cbiAgICBpZiAoZXhwcmVzc2lvbnMubGVuZ3RoID09PSAxICYmIGV4cHJlc3Npb25zWzBdLmxlbmd0aCA9PT0gMSl7IC8vIHNpbXBsZXN0IG1hdGNoXG4gICAgICAgIHJldHVybiB0aGlzLm1hdGNoKG5vZGUsIGV4cHJlc3Npb25zWzBdWzBdKVxuICAgIH1cblxuICAgIC8vIFRPRE86IG1vcmUgZnVuY3Rpb25hbCB0ZXN0cyA/XG5cbiAgICBpZiAoIXNsaWNrLm5vUVNBICYmIHRoaXMubWF0Y2hlc1NlbGVjdG9yKXtcbiAgICAgICAgdmFyIG1hdGNoZXMgPSB0aGlzLm1hdGNoZXNTZWxlY3Rvcihub2RlLCBleHByZXNzaW9ucylcbiAgICAgICAgaWYgKG1hdGNoZXMgIT09IG51bGwpIHJldHVybiBtYXRjaGVzXG4gICAgfVxuXG4gICAgdmFyIG5vZGVzID0gdGhpcy5zZWFyY2godGhpcy5kb2N1bWVudCwgZXhwcmVzc2lvbiwge2xlbmd0aDogMH0pXG5cbiAgICBmb3IgKHZhciBpID0gMCwgcmVzOyByZXMgPSBub2Rlc1tpKytdOykgaWYgKG5vZGUgPT09IHJlcykgcmV0dXJuIHRydWVcbiAgICByZXR1cm4gZmFsc2VcblxufVxuXG52YXIgZmluZGVycyA9IHt9XG5cbnZhciBmaW5kZXIgPSBmdW5jdGlvbihjb250ZXh0KXtcbiAgICB2YXIgZG9jID0gY29udGV4dCB8fCBkb2N1bWVudFxuICAgIGlmIChkb2Mub3duZXJEb2N1bWVudCkgZG9jID0gZG9jLm93bmVyRG9jdW1lbnRcbiAgICBlbHNlIGlmIChkb2MuZG9jdW1lbnQpIGRvYyA9IGRvYy5kb2N1bWVudFxuXG4gICAgaWYgKGRvYy5ub2RlVHlwZSAhPT0gOSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcImludmFsaWQgZG9jdW1lbnRcIilcblxuICAgIHZhciB1aWQgPSB1bmlxdWVJRChkb2MpXG4gICAgcmV0dXJuIGZpbmRlcnNbdWlkXSB8fCAoZmluZGVyc1t1aWRdID0gbmV3IEZpbmRlcihkb2MpKVxufVxuXG4vLyAuLi4gQVBJIC4uLlxuXG52YXIgc2xpY2sgPSBmdW5jdGlvbihleHByZXNzaW9uLCBjb250ZXh0KXtcbiAgICByZXR1cm4gc2xpY2suc2VhcmNoKGV4cHJlc3Npb24sIGNvbnRleHQpXG59XG5cbnNsaWNrLnNlYXJjaCA9IGZ1bmN0aW9uKGV4cHJlc3Npb24sIGNvbnRleHQsIGZvdW5kKXtcbiAgICByZXR1cm4gZmluZGVyKGNvbnRleHQpLnNlYXJjaChjb250ZXh0LCBleHByZXNzaW9uLCBmb3VuZClcbn1cblxuc2xpY2suZmluZCA9IGZ1bmN0aW9uKGV4cHJlc3Npb24sIGNvbnRleHQpe1xuICAgIHJldHVybiBmaW5kZXIoY29udGV4dCkuc2VhcmNoKGNvbnRleHQsIGV4cHJlc3Npb24pWzBdIHx8IG51bGxcbn1cblxuc2xpY2suZ2V0QXR0cmlidXRlID0gZnVuY3Rpb24obm9kZSwgbmFtZSl7XG4gICAgcmV0dXJuIGZpbmRlcihub2RlKS5nZXRBdHRyaWJ1dGUobm9kZSwgbmFtZSlcbn1cblxuc2xpY2suaGFzQXR0cmlidXRlID0gZnVuY3Rpb24obm9kZSwgbmFtZSl7XG4gICAgcmV0dXJuIGZpbmRlcihub2RlKS5oYXNBdHRyaWJ1dGUobm9kZSwgbmFtZSlcbn1cblxuc2xpY2suY29udGFpbnMgPSBmdW5jdGlvbihjb250ZXh0LCBub2RlKXtcbiAgICByZXR1cm4gZmluZGVyKGNvbnRleHQpLmNvbnRhaW5zKGNvbnRleHQsIG5vZGUpXG59XG5cbnNsaWNrLm1hdGNoZXMgPSBmdW5jdGlvbihub2RlLCBleHByZXNzaW9uKXtcbiAgICByZXR1cm4gZmluZGVyKG5vZGUpLm1hdGNoZXMobm9kZSwgZXhwcmVzc2lvbilcbn1cblxuc2xpY2suc29ydCA9IGZ1bmN0aW9uKG5vZGVzKXtcbiAgICBpZiAobm9kZXMgJiYgbm9kZXMubGVuZ3RoID4gMSkgZmluZGVyKG5vZGVzWzBdKS5zb3J0KG5vZGVzKVxuICAgIHJldHVybiBub2Rlc1xufVxuXG5zbGljay5wYXJzZSA9IHBhcnNlO1xuXG4vLyBzbGljay5kZWJ1ZyA9IHRydWVcbi8vIHNsaWNrLm5vUVNBICA9IHRydWVcblxubW9kdWxlLmV4cG9ydHMgPSBzbGlja1xuIiwiLypcbnNsaWNrXG4qL1widXNlIHN0cmljdFwiXG5cbm1vZHVsZS5leHBvcnRzID0gXCJkb2N1bWVudFwiIGluIGdsb2JhbCA/IHJlcXVpcmUoXCIuL2ZpbmRlclwiKSA6IHsgcGFyc2U6IHJlcXVpcmUoXCIuL3BhcnNlclwiKSB9XG4iLCIvKlxuU2xpY2sgUGFyc2VyXG4gLSBvcmlnaW5hbGx5IGNyZWF0ZWQgYnkgdGhlIGFsbWlnaHR5IFRob21hcyBBeWxvdHQgPEBzdWJ0bGVncmFkaWVudD4gKGh0dHA6Ly9zdWJ0bGVncmFkaWVudC5jb20pXG4qL1widXNlIHN0cmljdFwiXG5cbi8vIE5vdGFibGUgY2hhbmdlcyBmcm9tIFNsaWNrLlBhcnNlciAxLjAueFxuXG4vLyBUaGUgcGFyc2VyIG5vdyB1c2VzIDIgY2xhc3NlczogRXhwcmVzc2lvbnMgYW5kIEV4cHJlc3Npb25cbi8vIGBuZXcgRXhwcmVzc2lvbnNgIHByb2R1Y2VzIGFuIGFycmF5LWxpa2Ugb2JqZWN0IGNvbnRhaW5pbmcgYSBsaXN0IG9mIEV4cHJlc3Npb24gb2JqZWN0c1xuLy8gLSBFeHByZXNzaW9uczo6dG9TdHJpbmcoKSBwcm9kdWNlcyBhIGNsZWFuZWQgdXAgZXhwcmVzc2lvbnMgc3RyaW5nXG4vLyBgbmV3IEV4cHJlc3Npb25gIHByb2R1Y2VzIGFuIGFycmF5LWxpa2Ugb2JqZWN0XG4vLyAtIEV4cHJlc3Npb246OnRvU3RyaW5nKCkgcHJvZHVjZXMgYSBjbGVhbmVkIHVwIGV4cHJlc3Npb24gc3RyaW5nXG4vLyBUaGUgb25seSBleHBvc2VkIG1ldGhvZCBpcyBwYXJzZSwgd2hpY2ggcHJvZHVjZXMgYSAoY2FjaGVkKSBgbmV3IEV4cHJlc3Npb25zYCBpbnN0YW5jZVxuLy8gcGFyc2VkLnJhdyBpcyBubyBsb25nZXIgcHJlc2VudCwgdXNlIC50b1N0cmluZygpXG4vLyBwYXJzZWQuZXhwcmVzc2lvbiBpcyBub3cgdXNlbGVzcywganVzdCB1c2UgdGhlIGluZGljZXNcbi8vIHBhcnNlZC5yZXZlcnNlKCkgaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm93LCBkdWUgdG8gaXRzIGFwcGFyZW50IHVzZWxlc3NuZXNzXG4vLyBPdGhlciBjaGFuZ2VzIGluIHRoZSBFeHByZXNzaW9ucyBvYmplY3Q6XG4vLyAtIGNsYXNzTmFtZXMgYXJlIG5vdyB1bmlxdWUsIGFuZCBzYXZlIGJvdGggZXNjYXBlZCBhbmQgdW5lc2NhcGVkIHZhbHVlc1xuLy8gLSBhdHRyaWJ1dGVzIG5vdyBzYXZlIGJvdGggZXNjYXBlZCBhbmQgdW5lc2NhcGVkIHZhbHVlc1xuLy8gLSBwc2V1ZG9zIG5vdyBzYXZlIGJvdGggZXNjYXBlZCBhbmQgdW5lc2NhcGVkIHZhbHVlc1xuXG52YXIgZXNjYXBlUmUgICA9IC8oWy0uKis/XiR7fSgpfFtcXF1cXC9cXFxcXSkvZyxcbiAgICB1bmVzY2FwZVJlID0gL1xcXFwvZ1xuXG52YXIgZXNjYXBlID0gZnVuY3Rpb24oc3RyaW5nKXtcbiAgICAvLyBYUmVnRXhwIHYyLjAuMC1iZXRhLTNcbiAgICAvLyDCqyBodHRwczovL2dpdGh1Yi5jb20vc2xldml0aGFuL1hSZWdFeHAvYmxvYi9tYXN0ZXIvc3JjL3hyZWdleHAuanNcbiAgICByZXR1cm4gKHN0cmluZyArIFwiXCIpLnJlcGxhY2UoZXNjYXBlUmUsICdcXFxcJDEnKVxufVxuXG52YXIgdW5lc2NhcGUgPSBmdW5jdGlvbihzdHJpbmcpe1xuICAgIHJldHVybiAoc3RyaW5nICsgXCJcIikucmVwbGFjZSh1bmVzY2FwZVJlLCAnJylcbn1cblxudmFyIHNsaWNrUmUgPSBSZWdFeHAoXG4vKlxuIyEvdXNyL2Jpbi9lbnYgcnVieVxucHV0cyBcIlxcdFxcdFwiICsgREFUQS5yZWFkLmdzdWIoL1xcKFxcP3hcXCl8XFxzKyMuKiR8XFxzK3xcXFxcJHxcXFxcbi8sJycpXG5fX0VORF9fXG4gICAgXCIoP3gpXig/OlxcXG4gICAgICBcXFxccyogKCAsICkgXFxcXHMqICAgICAgICAgICAgICAgIyBTZXBhcmF0b3IgICAgICAgICAgXFxuXFxcbiAgICB8IFxcXFxzKiAoIDxjb21iaW5hdG9yPisgKSBcXFxccyogICAjIENvbWJpbmF0b3IgICAgICAgICBcXG5cXFxuICAgIHwgICAgICAoIFxcXFxzKyApICAgICAgICAgICAgICAgICAjIENvbWJpbmF0b3JDaGlsZHJlbiBcXG5cXFxuICAgIHwgICAgICAoIDx1bmljb2RlPisgfCBcXFxcKiApICAgICAjIFRhZyAgICAgICAgICAgICAgICBcXG5cXFxuICAgIHwgXFxcXCMgICggPHVuaWNvZGU+KyAgICAgICApICAgICAjIElEICAgICAgICAgICAgICAgICBcXG5cXFxuICAgIHwgXFxcXC4gICggPHVuaWNvZGU+KyAgICAgICApICAgICAjIENsYXNzTmFtZSAgICAgICAgICBcXG5cXFxuICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBBdHRyaWJ1dGUgICAgICAgICAgXFxuXFxcbiAgICBcXFxcWyAgXFxcbiAgICAgICAgXFxcXHMqICg8dW5pY29kZTE+KykgICg/OiAgXFxcbiAgICAgICAgICAgIFxcXFxzKiAoWypeJCF+fF0/PSkgICg/OiAgXFxcbiAgICAgICAgICAgICAgICBcXFxccyogKD86XFxcbiAgICAgICAgICAgICAgICAgICAgKFtcXFwiJ10/KSguKj8pXFxcXDkgXFxcbiAgICAgICAgICAgICAgICApXFxcbiAgICAgICAgICAgICkgIFxcXG4gICAgICAgICk/ICBcXFxccyogIFxcXG4gICAgXFxcXF0oPyFcXFxcXSkgXFxuXFxcbiAgICB8ICAgOisgKCA8dW5pY29kZT4rICkoPzpcXFxuICAgIFxcXFwoICg/OlxcXG4gICAgICAgICg/OihbXFxcIiddKShbXlxcXFwxMl0qKVxcXFwxMil8KCg/OlxcXFwoW14pXStcXFxcKXxbXigpXSopKylcXFxuICAgICkgXFxcXClcXFxuICAgICk/XFxcbiAgICApXCJcbiovXG5cIl4oPzpcXFxccyooLClcXFxccyp8XFxcXHMqKDxjb21iaW5hdG9yPispXFxcXHMqfChcXFxccyspfCg8dW5pY29kZT4rfFxcXFwqKXxcXFxcIyg8dW5pY29kZT4rKXxcXFxcLig8dW5pY29kZT4rKXxcXFxcW1xcXFxzKig8dW5pY29kZTE+KykoPzpcXFxccyooWypeJCF+fF0/PSkoPzpcXFxccyooPzooW1xcXCInXT8pKC4qPylcXFxcOSkpKT9cXFxccypcXFxcXSg/IVxcXFxdKXwoOispKDx1bmljb2RlPispKD86XFxcXCgoPzooPzooW1xcXCInXSkoW15cXFxcMTNdKilcXFxcMTMpfCgoPzpcXFxcKFteKV0rXFxcXCl8W14oKV0qKSspKVxcXFwpKT8pXCJcbiAgICAucmVwbGFjZSgvPGNvbWJpbmF0b3I+LywgJ1snICsgZXNjYXBlKFwiPit+YCFAJCVeJj17fVxcXFw7PC9cIikgKyAnXScpXG4gICAgLnJlcGxhY2UoLzx1bmljb2RlPi9nLCAnKD86W1xcXFx3XFxcXHUwMGExLVxcXFx1RkZGRi1dfFxcXFxcXFxcW15cXFxcczAtOWEtZl0pJylcbiAgICAucmVwbGFjZSgvPHVuaWNvZGUxPi9nLCAnKD86WzpcXFxcd1xcXFx1MDBhMS1cXFxcdUZGRkYtXXxcXFxcXFxcXFteXFxcXHMwLTlhLWZdKScpXG4pXG5cbi8vIFBhcnRcblxudmFyIFBhcnQgPSBmdW5jdGlvbiBQYXJ0KGNvbWJpbmF0b3Ipe1xuICAgIHRoaXMuY29tYmluYXRvciA9IGNvbWJpbmF0b3IgfHwgXCIgXCJcbiAgICB0aGlzLnRhZyA9IFwiKlwiXG59XG5cblBhcnQucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKXtcblxuICAgIGlmICghdGhpcy5yYXcpe1xuXG4gICAgICAgIHZhciB4cHIgPSBcIlwiLCBrLCBwYXJ0XG5cbiAgICAgICAgeHByICs9IHRoaXMudGFnIHx8IFwiKlwiXG4gICAgICAgIGlmICh0aGlzLmlkKSB4cHIgKz0gXCIjXCIgKyB0aGlzLmlkXG4gICAgICAgIGlmICh0aGlzLmNsYXNzZXMpIHhwciArPSBcIi5cIiArIHRoaXMuY2xhc3NMaXN0LmpvaW4oXCIuXCIpXG4gICAgICAgIGlmICh0aGlzLmF0dHJpYnV0ZXMpIGZvciAoayA9IDA7IHBhcnQgPSB0aGlzLmF0dHJpYnV0ZXNbaysrXTspe1xuICAgICAgICAgICAgeHByICs9IFwiW1wiICsgcGFydC5uYW1lICsgKHBhcnQub3BlcmF0b3IgPyBwYXJ0Lm9wZXJhdG9yICsgJ1wiJyArIHBhcnQudmFsdWUgKyAnXCInIDogJycpICsgXCJdXCJcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wc2V1ZG9zKSBmb3IgKGsgPSAwOyBwYXJ0ID0gdGhpcy5wc2V1ZG9zW2srK107KXtcbiAgICAgICAgICAgIHhwciArPSBcIjpcIiArIHBhcnQubmFtZVxuICAgICAgICAgICAgaWYgKHBhcnQudmFsdWUpIHhwciArPSBcIihcIiArIHBhcnQudmFsdWUgKyBcIilcIlxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yYXcgPSB4cHJcblxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJhd1xufVxuXG4vLyBFeHByZXNzaW9uXG5cbnZhciBFeHByZXNzaW9uID0gZnVuY3Rpb24gRXhwcmVzc2lvbigpe1xuICAgIHRoaXMubGVuZ3RoID0gMFxufVxuXG5FeHByZXNzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCl7XG5cbiAgICBpZiAoIXRoaXMucmF3KXtcblxuICAgICAgICB2YXIgeHByID0gXCJcIlxuXG4gICAgICAgIGZvciAodmFyIGogPSAwLCBiaXQ7IGJpdCA9IHRoaXNbaisrXTspe1xuICAgICAgICAgICAgaWYgKGogIT09IDEpIHhwciArPSBcIiBcIlxuICAgICAgICAgICAgaWYgKGJpdC5jb21iaW5hdG9yICE9PSBcIiBcIikgeHByICs9IGJpdC5jb21iaW5hdG9yICsgXCIgXCJcbiAgICAgICAgICAgIHhwciArPSBiaXRcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmF3ID0geHByXG5cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5yYXdcbn1cblxudmFyIHJlcGxhY2VyID0gZnVuY3Rpb24oXG4gICAgcmF3TWF0Y2gsXG5cbiAgICBzZXBhcmF0b3IsXG4gICAgY29tYmluYXRvcixcbiAgICBjb21iaW5hdG9yQ2hpbGRyZW4sXG5cbiAgICB0YWdOYW1lLFxuICAgIGlkLFxuICAgIGNsYXNzTmFtZSxcblxuICAgIGF0dHJpYnV0ZUtleSxcbiAgICBhdHRyaWJ1dGVPcGVyYXRvcixcbiAgICBhdHRyaWJ1dGVRdW90ZSxcbiAgICBhdHRyaWJ1dGVWYWx1ZSxcblxuICAgIHBzZXVkb01hcmtlcixcbiAgICBwc2V1ZG9DbGFzcyxcbiAgICBwc2V1ZG9RdW90ZSxcbiAgICBwc2V1ZG9DbGFzc1F1b3RlZFZhbHVlLFxuICAgIHBzZXVkb0NsYXNzVmFsdWVcbil7XG5cbiAgICB2YXIgZXhwcmVzc2lvbiwgY3VycmVudFxuXG4gICAgaWYgKHNlcGFyYXRvciB8fCAhdGhpcy5sZW5ndGgpe1xuICAgICAgICBleHByZXNzaW9uID0gdGhpc1t0aGlzLmxlbmd0aCsrXSA9IG5ldyBFeHByZXNzaW9uXG4gICAgICAgIGlmIChzZXBhcmF0b3IpIHJldHVybiAnJ1xuICAgIH1cblxuICAgIGlmICghZXhwcmVzc2lvbikgZXhwcmVzc2lvbiA9IHRoaXNbdGhpcy5sZW5ndGggLSAxXVxuXG4gICAgaWYgKGNvbWJpbmF0b3IgfHwgY29tYmluYXRvckNoaWxkcmVuIHx8ICFleHByZXNzaW9uLmxlbmd0aCl7XG4gICAgICAgIGN1cnJlbnQgPSBleHByZXNzaW9uW2V4cHJlc3Npb24ubGVuZ3RoKytdID0gbmV3IFBhcnQoY29tYmluYXRvcilcbiAgICB9XG5cbiAgICBpZiAoIWN1cnJlbnQpIGN1cnJlbnQgPSBleHByZXNzaW9uW2V4cHJlc3Npb24ubGVuZ3RoIC0gMV1cblxuICAgIGlmICh0YWdOYW1lKXtcblxuICAgICAgICBjdXJyZW50LnRhZyA9IHVuZXNjYXBlKHRhZ05hbWUpXG5cbiAgICB9IGVsc2UgaWYgKGlkKXtcblxuICAgICAgICBjdXJyZW50LmlkID0gdW5lc2NhcGUoaWQpXG5cbiAgICB9IGVsc2UgaWYgKGNsYXNzTmFtZSl7XG5cbiAgICAgICAgdmFyIHVuZXNjYXBlZCA9IHVuZXNjYXBlKGNsYXNzTmFtZSlcblxuICAgICAgICB2YXIgY2xhc3NlcyA9IGN1cnJlbnQuY2xhc3NlcyB8fCAoY3VycmVudC5jbGFzc2VzID0ge30pXG4gICAgICAgIGlmICghY2xhc3Nlc1t1bmVzY2FwZWRdKXtcbiAgICAgICAgICAgIGNsYXNzZXNbdW5lc2NhcGVkXSA9IGVzY2FwZShjbGFzc05hbWUpXG4gICAgICAgICAgICB2YXIgY2xhc3NMaXN0ID0gY3VycmVudC5jbGFzc0xpc3QgfHwgKGN1cnJlbnQuY2xhc3NMaXN0ID0gW10pXG4gICAgICAgICAgICBjbGFzc0xpc3QucHVzaCh1bmVzY2FwZWQpXG4gICAgICAgICAgICBjbGFzc0xpc3Quc29ydCgpXG4gICAgICAgIH1cblxuICAgIH0gZWxzZSBpZiAocHNldWRvQ2xhc3Mpe1xuXG4gICAgICAgIHBzZXVkb0NsYXNzVmFsdWUgPSBwc2V1ZG9DbGFzc1ZhbHVlIHx8IHBzZXVkb0NsYXNzUXVvdGVkVmFsdWVcblxuICAgICAgICA7KGN1cnJlbnQucHNldWRvcyB8fCAoY3VycmVudC5wc2V1ZG9zID0gW10pKS5wdXNoKHtcbiAgICAgICAgICAgIHR5cGUgICAgICAgICA6IHBzZXVkb01hcmtlci5sZW5ndGggPT0gMSA/ICdjbGFzcycgOiAnZWxlbWVudCcsXG4gICAgICAgICAgICBuYW1lICAgICAgICAgOiB1bmVzY2FwZShwc2V1ZG9DbGFzcyksXG4gICAgICAgICAgICBlc2NhcGVkTmFtZSAgOiBlc2NhcGUocHNldWRvQ2xhc3MpLFxuICAgICAgICAgICAgdmFsdWUgICAgICAgIDogcHNldWRvQ2xhc3NWYWx1ZSA/IHVuZXNjYXBlKHBzZXVkb0NsYXNzVmFsdWUpIDogbnVsbCxcbiAgICAgICAgICAgIGVzY2FwZWRWYWx1ZSA6IHBzZXVkb0NsYXNzVmFsdWUgPyBlc2NhcGUocHNldWRvQ2xhc3NWYWx1ZSkgOiBudWxsXG4gICAgICAgIH0pXG5cbiAgICB9IGVsc2UgaWYgKGF0dHJpYnV0ZUtleSl7XG5cbiAgICAgICAgYXR0cmlidXRlVmFsdWUgPSBhdHRyaWJ1dGVWYWx1ZSA/IGVzY2FwZShhdHRyaWJ1dGVWYWx1ZSkgOiBudWxsXG5cbiAgICAgICAgOyhjdXJyZW50LmF0dHJpYnV0ZXMgfHwgKGN1cnJlbnQuYXR0cmlidXRlcyA9IFtdKSkucHVzaCh7XG4gICAgICAgICAgICBvcGVyYXRvciAgICAgOiBhdHRyaWJ1dGVPcGVyYXRvcixcbiAgICAgICAgICAgIG5hbWUgICAgICAgICA6IHVuZXNjYXBlKGF0dHJpYnV0ZUtleSksXG4gICAgICAgICAgICBlc2NhcGVkTmFtZSAgOiBlc2NhcGUoYXR0cmlidXRlS2V5KSxcbiAgICAgICAgICAgIHZhbHVlICAgICAgICA6IGF0dHJpYnV0ZVZhbHVlID8gdW5lc2NhcGUoYXR0cmlidXRlVmFsdWUpIDogbnVsbCxcbiAgICAgICAgICAgIGVzY2FwZWRWYWx1ZSA6IGF0dHJpYnV0ZVZhbHVlID8gZXNjYXBlKGF0dHJpYnV0ZVZhbHVlKSA6IG51bGxcbiAgICAgICAgfSlcblxuICAgIH1cblxuICAgIHJldHVybiAnJ1xuXG59XG5cbi8vIEV4cHJlc3Npb25zXG5cbnZhciBFeHByZXNzaW9ucyA9IGZ1bmN0aW9uIEV4cHJlc3Npb25zKGV4cHJlc3Npb24pe1xuICAgIHRoaXMubGVuZ3RoID0gMFxuXG4gICAgdmFyIHNlbGYgPSB0aGlzXG5cbiAgICB2YXIgb3JpZ2luYWwgPSBleHByZXNzaW9uLCByZXBsYWNlZFxuXG4gICAgd2hpbGUgKGV4cHJlc3Npb24pe1xuICAgICAgICByZXBsYWNlZCA9IGV4cHJlc3Npb24ucmVwbGFjZShzbGlja1JlLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHJlcGxhY2VyLmFwcGx5KHNlbGYsIGFyZ3VtZW50cylcbiAgICAgICAgfSlcbiAgICAgICAgaWYgKHJlcGxhY2VkID09PSBleHByZXNzaW9uKSB0aHJvdyBuZXcgRXJyb3Iob3JpZ2luYWwgKyAnIGlzIGFuIGludmFsaWQgZXhwcmVzc2lvbicpXG4gICAgICAgIGV4cHJlc3Npb24gPSByZXBsYWNlZFxuICAgIH1cbn1cblxuRXhwcmVzc2lvbnMucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKXtcbiAgICBpZiAoIXRoaXMucmF3KXtcbiAgICAgICAgdmFyIGV4cHJlc3Npb25zID0gW11cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGV4cHJlc3Npb247IGV4cHJlc3Npb24gPSB0aGlzW2krK107KSBleHByZXNzaW9ucy5wdXNoKGV4cHJlc3Npb24pXG4gICAgICAgIHRoaXMucmF3ID0gZXhwcmVzc2lvbnMuam9pbihcIiwgXCIpXG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucmF3XG59XG5cbnZhciBjYWNoZSA9IHt9XG5cbnZhciBwYXJzZSA9IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xuICAgIGlmIChleHByZXNzaW9uID09IG51bGwpIHJldHVybiBudWxsXG4gICAgZXhwcmVzc2lvbiA9ICgnJyArIGV4cHJlc3Npb24pLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKVxuICAgIHJldHVybiBjYWNoZVtleHByZXNzaW9uXSB8fCAoY2FjaGVbZXhwcmVzc2lvbl0gPSBuZXcgRXhwcmVzc2lvbnMoZXhwcmVzc2lvbikpXG59XG5cbm1vZHVsZS5leHBvcnRzID0gcGFyc2VcbiIsIi8qKiFcbiAqIFNvcnRhYmxlXG4gKiBAYXV0aG9yXHRSdWJhWGEgICA8dHJhc2hAcnViYXhhLm9yZz5cbiAqIEBsaWNlbnNlIE1JVFxuICovXG5cblxuKGZ1bmN0aW9uIChmYWN0b3J5KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXG5cdGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuXHRcdGRlZmluZShmYWN0b3J5KTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIG1vZHVsZS5leHBvcnRzICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0fVxuXHRlbHNlIGlmICh0eXBlb2YgUGFja2FnZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFNvcnRhYmxlID0gZmFjdG9yeSgpOyAgLy8gZXhwb3J0IGZvciBNZXRlb3IuanNcblx0fVxuXHRlbHNlIHtcblx0XHQvKiBqc2hpbnQgc3ViOnRydWUgKi9cblx0XHR3aW5kb3dbXCJTb3J0YWJsZVwiXSA9IGZhY3RvcnkoKTtcblx0fVxufSkoZnVuY3Rpb24gKCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHR2YXIgZHJhZ0VsLFxuXHRcdGdob3N0RWwsXG5cdFx0Y2xvbmVFbCxcblx0XHRyb290RWwsXG5cdFx0bmV4dEVsLFxuXG5cdFx0c2Nyb2xsRWwsXG5cdFx0c2Nyb2xsUGFyZW50RWwsXG5cblx0XHRsYXN0RWwsXG5cdFx0bGFzdENTUyxcblxuXHRcdG9sZEluZGV4LFxuXHRcdG5ld0luZGV4LFxuXG5cdFx0YWN0aXZlR3JvdXAsXG5cdFx0YXV0b1Njcm9sbCA9IHt9LFxuXG5cdFx0dGFwRXZ0LFxuXHRcdHRvdWNoRXZ0LFxuXG5cdFx0ZXhwYW5kbyA9ICdTb3J0YWJsZScgKyAobmV3IERhdGUpLmdldFRpbWUoKSxcblxuXHRcdHdpbiA9IHdpbmRvdyxcblx0XHRkb2N1bWVudCA9IHdpbi5kb2N1bWVudCxcblx0XHRwYXJzZUludCA9IHdpbi5wYXJzZUludCxcblxuXHRcdHN1cHBvcnREcmFnZ2FibGUgPSAhISgnZHJhZ2dhYmxlJyBpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSksXG5cblxuXHRcdF9zaWxlbnQgPSBmYWxzZSxcblxuXHRcdF9kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24gKHJvb3RFbCwgbmFtZSwgdGFyZ2V0RWwsIGZyb21FbCwgc3RhcnRJbmRleCwgbmV3SW5kZXgpIHtcblx0XHRcdHZhciBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnQnKTtcblxuXHRcdFx0ZXZ0LmluaXRFdmVudChuYW1lLCB0cnVlLCB0cnVlKTtcblxuXHRcdFx0ZXZ0Lml0ZW0gPSB0YXJnZXRFbCB8fCByb290RWw7XG5cdFx0XHRldnQuZnJvbSA9IGZyb21FbCB8fCByb290RWw7XG5cdFx0XHRldnQuY2xvbmUgPSBjbG9uZUVsO1xuXG5cdFx0XHRldnQub2xkSW5kZXggPSBzdGFydEluZGV4O1xuXHRcdFx0ZXZ0Lm5ld0luZGV4ID0gbmV3SW5kZXg7XG5cblx0XHRcdHJvb3RFbC5kaXNwYXRjaEV2ZW50KGV2dCk7XG5cdFx0fSxcblxuXHRcdF9jdXN0b21FdmVudHMgPSAnb25BZGQgb25VcGRhdGUgb25SZW1vdmUgb25TdGFydCBvbkVuZCBvbkZpbHRlciBvblNvcnQnLnNwbGl0KCcgJyksXG5cblx0XHRub29wID0gZnVuY3Rpb24gKCkge30sXG5cblx0XHRhYnMgPSBNYXRoLmFicyxcblx0XHRzbGljZSA9IFtdLnNsaWNlLFxuXG5cdFx0dG91Y2hEcmFnT3Zlckxpc3RlbmVycyA9IFtdLFxuXG5cdFx0X2F1dG9TY3JvbGwgPSBfdGhyb3R0bGUoZnVuY3Rpb24gKC8qKkV2ZW50Ki9ldnQsIC8qKk9iamVjdCovb3B0aW9ucywgLyoqSFRNTEVsZW1lbnQqL3Jvb3RFbCkge1xuXHRcdFx0Ly8gQnVnOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD01MDU1MjFcblx0XHRcdGlmIChyb290RWwgJiYgb3B0aW9ucy5zY3JvbGwpIHtcblx0XHRcdFx0dmFyIGVsLFxuXHRcdFx0XHRcdHJlY3QsXG5cdFx0XHRcdFx0c2VucyA9IG9wdGlvbnMuc2Nyb2xsU2Vuc2l0aXZpdHksXG5cdFx0XHRcdFx0c3BlZWQgPSBvcHRpb25zLnNjcm9sbFNwZWVkLFxuXG5cdFx0XHRcdFx0eCA9IGV2dC5jbGllbnRYLFxuXHRcdFx0XHRcdHkgPSBldnQuY2xpZW50WSxcblxuXHRcdFx0XHRcdHdpbldpZHRoID0gd2luZG93LmlubmVyV2lkdGgsXG5cdFx0XHRcdFx0d2luSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0LFxuXG5cdFx0XHRcdFx0dngsXG5cdFx0XHRcdFx0dnlcblx0XHRcdFx0O1xuXG5cdFx0XHRcdC8vIERlbGVjdCBzY3JvbGxFbFxuXHRcdFx0XHRpZiAoc2Nyb2xsUGFyZW50RWwgIT09IHJvb3RFbCkge1xuXHRcdFx0XHRcdHNjcm9sbEVsID0gb3B0aW9ucy5zY3JvbGw7XG5cdFx0XHRcdFx0c2Nyb2xsUGFyZW50RWwgPSByb290RWw7XG5cblx0XHRcdFx0XHRpZiAoc2Nyb2xsRWwgPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdHNjcm9sbEVsID0gcm9vdEVsO1xuXG5cdFx0XHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0XHRcdGlmICgoc2Nyb2xsRWwub2Zmc2V0V2lkdGggPCBzY3JvbGxFbC5zY3JvbGxXaWR0aCkgfHxcblx0XHRcdFx0XHRcdFx0XHQoc2Nyb2xsRWwub2Zmc2V0SGVpZ2h0IDwgc2Nyb2xsRWwuc2Nyb2xsSGVpZ2h0KVxuXHRcdFx0XHRcdFx0XHQpIHtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHQvKiBqc2hpbnQgYm9zczp0cnVlICovXG5cdFx0XHRcdFx0XHR9IHdoaWxlIChzY3JvbGxFbCA9IHNjcm9sbEVsLnBhcmVudE5vZGUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzY3JvbGxFbCkge1xuXHRcdFx0XHRcdGVsID0gc2Nyb2xsRWw7XG5cdFx0XHRcdFx0cmVjdCA9IHNjcm9sbEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcdFx0XHRcdHZ4ID0gKGFicyhyZWN0LnJpZ2h0IC0geCkgPD0gc2VucykgLSAoYWJzKHJlY3QubGVmdCAtIHgpIDw9IHNlbnMpO1xuXHRcdFx0XHRcdHZ5ID0gKGFicyhyZWN0LmJvdHRvbSAtIHkpIDw9IHNlbnMpIC0gKGFicyhyZWN0LnRvcCAtIHkpIDw9IHNlbnMpO1xuXHRcdFx0XHR9XG5cblxuXHRcdFx0XHRpZiAoISh2eCB8fCB2eSkpIHtcblx0XHRcdFx0XHR2eCA9ICh3aW5XaWR0aCAtIHggPD0gc2VucykgLSAoeCA8PSBzZW5zKTtcblx0XHRcdFx0XHR2eSA9ICh3aW5IZWlnaHQgLSB5IDw9IHNlbnMpIC0gKHkgPD0gc2Vucyk7XG5cblx0XHRcdFx0XHQvKiBqc2hpbnQgZXhwcjp0cnVlICovXG5cdFx0XHRcdFx0KHZ4IHx8IHZ5KSAmJiAoZWwgPSB3aW4pO1xuXHRcdFx0XHR9XG5cblxuXHRcdFx0XHRpZiAoYXV0b1Njcm9sbC52eCAhPT0gdnggfHwgYXV0b1Njcm9sbC52eSAhPT0gdnkgfHwgYXV0b1Njcm9sbC5lbCAhPT0gZWwpIHtcblx0XHRcdFx0XHRhdXRvU2Nyb2xsLmVsID0gZWw7XG5cdFx0XHRcdFx0YXV0b1Njcm9sbC52eCA9IHZ4O1xuXHRcdFx0XHRcdGF1dG9TY3JvbGwudnkgPSB2eTtcblxuXHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwoYXV0b1Njcm9sbC5waWQpO1xuXG5cdFx0XHRcdFx0aWYgKGVsKSB7XG5cdFx0XHRcdFx0XHRhdXRvU2Nyb2xsLnBpZCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGVsID09PSB3aW4pIHtcblx0XHRcdFx0XHRcdFx0XHR3aW4uc2Nyb2xsVG8od2luLnNjcm9sbFggKyB2eCAqIHNwZWVkLCB3aW4uc2Nyb2xsWSArIHZ5ICogc3BlZWQpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHZ5ICYmIChlbC5zY3JvbGxUb3AgKz0gdnkgKiBzcGVlZCk7XG5cdFx0XHRcdFx0XHRcdFx0dnggJiYgKGVsLnNjcm9sbExlZnQgKz0gdnggKiBzcGVlZCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0sIDI0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LCAzMClcblx0O1xuXG5cblxuXHQvKipcblx0ICogQGNsYXNzICBTb3J0YWJsZVxuXHQgKiBAcGFyYW0gIHtIVE1MRWxlbWVudH0gIGVsXG5cdCAqIEBwYXJhbSAge09iamVjdH0gICAgICAgW29wdGlvbnNdXG5cdCAqL1xuXHRmdW5jdGlvbiBTb3J0YWJsZShlbCwgb3B0aW9ucykge1xuXHRcdHRoaXMuZWwgPSBlbDsgLy8gcm9vdCBlbGVtZW50XG5cdFx0dGhpcy5vcHRpb25zID0gb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KTtcblxuXG5cdFx0Ly8gRGVmYXVsdCBvcHRpb25zXG5cdFx0dmFyIGRlZmF1bHRzID0ge1xuXHRcdFx0Z3JvdXA6IE1hdGgucmFuZG9tKCksXG5cdFx0XHRzb3J0OiB0cnVlLFxuXHRcdFx0ZGlzYWJsZWQ6IGZhbHNlLFxuXHRcdFx0c3RvcmU6IG51bGwsXG5cdFx0XHRoYW5kbGU6IG51bGwsXG5cdFx0XHRzY3JvbGw6IHRydWUsXG5cdFx0XHRzY3JvbGxTZW5zaXRpdml0eTogMzAsXG5cdFx0XHRzY3JvbGxTcGVlZDogMTAsXG5cdFx0XHRkcmFnZ2FibGU6IC9bdW9dbC9pLnRlc3QoZWwubm9kZU5hbWUpID8gJ2xpJyA6ICc+KicsXG5cdFx0XHRnaG9zdENsYXNzOiAnc29ydGFibGUtZ2hvc3QnLFxuXHRcdFx0aWdub3JlOiAnYSwgaW1nJyxcblx0XHRcdGZpbHRlcjogbnVsbCxcblx0XHRcdGFuaW1hdGlvbjogMCxcblx0XHRcdHNldERhdGE6IGZ1bmN0aW9uIChkYXRhVHJhbnNmZXIsIGRyYWdFbCkge1xuXHRcdFx0XHRkYXRhVHJhbnNmZXIuc2V0RGF0YSgnVGV4dCcsIGRyYWdFbC50ZXh0Q29udGVudCk7XG5cdFx0XHR9LFxuXHRcdFx0ZHJvcEJ1YmJsZTogZmFsc2UsXG5cdFx0XHRkcmFnb3ZlckJ1YmJsZTogZmFsc2Vcblx0XHR9O1xuXG5cblx0XHQvLyBTZXQgZGVmYXVsdCBvcHRpb25zXG5cdFx0Zm9yICh2YXIgbmFtZSBpbiBkZWZhdWx0cykge1xuXHRcdFx0IShuYW1lIGluIG9wdGlvbnMpICYmIChvcHRpb25zW25hbWVdID0gZGVmYXVsdHNbbmFtZV0pO1xuXHRcdH1cblxuXG5cdFx0dmFyIGdyb3VwID0gb3B0aW9ucy5ncm91cDtcblxuXHRcdGlmICghZ3JvdXAgfHwgdHlwZW9mIGdyb3VwICE9ICdvYmplY3QnKSB7XG5cdFx0XHRncm91cCA9IG9wdGlvbnMuZ3JvdXAgPSB7IG5hbWU6IGdyb3VwIH07XG5cdFx0fVxuXG5cblx0XHRbJ3B1bGwnLCAncHV0J10uZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG5cdFx0XHRpZiAoIShrZXkgaW4gZ3JvdXApKSB7XG5cdFx0XHRcdGdyb3VwW2tleV0gPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cblx0XHQvLyBEZWZpbmUgZXZlbnRzXG5cdFx0X2N1c3RvbUV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG5cdFx0XHRvcHRpb25zW25hbWVdID0gX2JpbmQodGhpcywgb3B0aW9uc1tuYW1lXSB8fCBub29wKTtcblx0XHRcdF9vbihlbCwgbmFtZS5zdWJzdHIoMikudG9Mb3dlckNhc2UoKSwgb3B0aW9uc1tuYW1lXSk7XG5cdFx0fSwgdGhpcyk7XG5cblxuXHRcdC8vIEV4cG9ydCBvcHRpb25zXG5cdFx0b3B0aW9ucy5ncm91cHMgPSAnICcgKyBncm91cC5uYW1lICsgKGdyb3VwLnB1dC5qb2luID8gJyAnICsgZ3JvdXAucHV0LmpvaW4oJyAnKSA6ICcnKSArICcgJztcblx0XHRlbFtleHBhbmRvXSA9IG9wdGlvbnM7XG5cblxuXHRcdC8vIEJpbmQgYWxsIHByaXZhdGUgbWV0aG9kc1xuXHRcdGZvciAodmFyIGZuIGluIHRoaXMpIHtcblx0XHRcdGlmIChmbi5jaGFyQXQoMCkgPT09ICdfJykge1xuXHRcdFx0XHR0aGlzW2ZuXSA9IF9iaW5kKHRoaXMsIHRoaXNbZm5dKTtcblx0XHRcdH1cblx0XHR9XG5cblxuXHRcdC8vIEJpbmQgZXZlbnRzXG5cdFx0X29uKGVsLCAnbW91c2Vkb3duJywgdGhpcy5fb25UYXBTdGFydCk7XG5cdFx0X29uKGVsLCAndG91Y2hzdGFydCcsIHRoaXMuX29uVGFwU3RhcnQpO1xuXG5cdFx0X29uKGVsLCAnZHJhZ292ZXInLCB0aGlzKTtcblx0XHRfb24oZWwsICdkcmFnZW50ZXInLCB0aGlzKTtcblxuXHRcdHRvdWNoRHJhZ092ZXJMaXN0ZW5lcnMucHVzaCh0aGlzLl9vbkRyYWdPdmVyKTtcblxuXHRcdC8vIFJlc3RvcmUgc29ydGluZ1xuXHRcdG9wdGlvbnMuc3RvcmUgJiYgdGhpcy5zb3J0KG9wdGlvbnMuc3RvcmUuZ2V0KHRoaXMpKTtcblx0fVxuXG5cblx0U29ydGFibGUucHJvdG90eXBlID0gLyoqIEBsZW5kcyBTb3J0YWJsZS5wcm90b3R5cGUgKi8ge1xuXHRcdGNvbnN0cnVjdG9yOiBTb3J0YWJsZSxcblxuXG5cdFx0X2RyYWdTdGFydGVkOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRpZiAocm9vdEVsICYmIGRyYWdFbCkge1xuXHRcdFx0XHQvLyBBcHBseSBlZmZlY3Rcblx0XHRcdFx0X3RvZ2dsZUNsYXNzKGRyYWdFbCwgdGhpcy5vcHRpb25zLmdob3N0Q2xhc3MsIHRydWUpO1xuXG5cdFx0XHRcdFNvcnRhYmxlLmFjdGl2ZSA9IHRoaXM7XG5cblx0XHRcdFx0Ly8gRHJhZyBzdGFydCBldmVudFxuXHRcdFx0XHRfZGlzcGF0Y2hFdmVudChyb290RWwsICdzdGFydCcsIGRyYWdFbCwgcm9vdEVsLCBvbGRJbmRleCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXG5cdFx0X29uVGFwU3RhcnQ6IGZ1bmN0aW9uICgvKipFdmVudHxUb3VjaEV2ZW50Ki9ldnQpIHtcblx0XHRcdHZhciB0eXBlID0gZXZ0LnR5cGUsXG5cdFx0XHRcdHRvdWNoID0gZXZ0LnRvdWNoZXMgJiYgZXZ0LnRvdWNoZXNbMF0sXG5cdFx0XHRcdHRhcmdldCA9ICh0b3VjaCB8fCBldnQpLnRhcmdldCxcblx0XHRcdFx0b3JpZ2luYWxUYXJnZXQgPSB0YXJnZXQsXG5cdFx0XHRcdG9wdGlvbnMgPSAgdGhpcy5vcHRpb25zLFxuXHRcdFx0XHRlbCA9IHRoaXMuZWwsXG5cdFx0XHRcdGZpbHRlciA9IG9wdGlvbnMuZmlsdGVyO1xuXG5cdFx0XHRpZiAodHlwZSA9PT0gJ21vdXNlZG93bicgJiYgZXZ0LmJ1dHRvbiAhPT0gMCB8fCBvcHRpb25zLmRpc2FibGVkKSB7XG5cdFx0XHRcdHJldHVybjsgLy8gb25seSBsZWZ0IGJ1dHRvbiBvciBlbmFibGVkXG5cdFx0XHR9XG5cblx0XHRcdHRhcmdldCA9IF9jbG9zZXN0KHRhcmdldCwgb3B0aW9ucy5kcmFnZ2FibGUsIGVsKTtcblxuXHRcdFx0aWYgKCF0YXJnZXQpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBnZXQgdGhlIGluZGV4IG9mIHRoZSBkcmFnZ2VkIGVsZW1lbnQgd2l0aGluIGl0cyBwYXJlbnRcblx0XHRcdG9sZEluZGV4ID0gX2luZGV4KHRhcmdldCk7XG5cblx0XHRcdC8vIENoZWNrIGZpbHRlclxuXHRcdFx0aWYgKHR5cGVvZiBmaWx0ZXIgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKGZpbHRlci5jYWxsKHRoaXMsIGV2dCwgdGFyZ2V0LCB0aGlzKSkge1xuXHRcdFx0XHRcdF9kaXNwYXRjaEV2ZW50KG9yaWdpbmFsVGFyZ2V0LCAnZmlsdGVyJywgdGFyZ2V0LCBlbCwgb2xkSW5kZXgpO1xuXHRcdFx0XHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHJldHVybjsgLy8gY2FuY2VsIGRuZFxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmIChmaWx0ZXIpIHtcblx0XHRcdFx0ZmlsdGVyID0gZmlsdGVyLnNwbGl0KCcsJykuc29tZShmdW5jdGlvbiAoY3JpdGVyaWEpIHtcblx0XHRcdFx0XHRjcml0ZXJpYSA9IF9jbG9zZXN0KG9yaWdpbmFsVGFyZ2V0LCBjcml0ZXJpYS50cmltKCksIGVsKTtcblxuXHRcdFx0XHRcdGlmIChjcml0ZXJpYSkge1xuXHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQoY3JpdGVyaWEsICdmaWx0ZXInLCB0YXJnZXQsIGVsLCBvbGRJbmRleCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChmaWx0ZXIpIHtcblx0XHRcdFx0XHRldnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRyZXR1cm47IC8vIGNhbmNlbCBkbmRcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cblx0XHRcdGlmIChvcHRpb25zLmhhbmRsZSAmJiAhX2Nsb3Nlc3Qob3JpZ2luYWxUYXJnZXQsIG9wdGlvbnMuaGFuZGxlLCBlbCkpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cblx0XHRcdC8vIFByZXBhcmUgYGRyYWdzdGFydGBcblx0XHRcdGlmICh0YXJnZXQgJiYgIWRyYWdFbCAmJiAodGFyZ2V0LnBhcmVudE5vZGUgPT09IGVsKSkge1xuXHRcdFx0XHR0YXBFdnQgPSBldnQ7XG5cblx0XHRcdFx0cm9vdEVsID0gdGhpcy5lbDtcblx0XHRcdFx0ZHJhZ0VsID0gdGFyZ2V0O1xuXHRcdFx0XHRuZXh0RWwgPSBkcmFnRWwubmV4dFNpYmxpbmc7XG5cdFx0XHRcdGFjdGl2ZUdyb3VwID0gdGhpcy5vcHRpb25zLmdyb3VwO1xuXG5cdFx0XHRcdGRyYWdFbC5kcmFnZ2FibGUgPSB0cnVlO1xuXG5cdFx0XHRcdC8vIERpc2FibGUgXCJkcmFnZ2FibGVcIlxuXHRcdFx0XHRvcHRpb25zLmlnbm9yZS5zcGxpdCgnLCcpLmZvckVhY2goZnVuY3Rpb24gKGNyaXRlcmlhKSB7XG5cdFx0XHRcdFx0X2ZpbmQodGFyZ2V0LCBjcml0ZXJpYS50cmltKCksIF9kaXNhYmxlRHJhZ2dhYmxlKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKHRvdWNoKSB7XG5cdFx0XHRcdFx0Ly8gVG91Y2ggZGV2aWNlIHN1cHBvcnRcblx0XHRcdFx0XHR0YXBFdnQgPSB7XG5cdFx0XHRcdFx0XHR0YXJnZXQ6IHRhcmdldCxcblx0XHRcdFx0XHRcdGNsaWVudFg6IHRvdWNoLmNsaWVudFgsXG5cdFx0XHRcdFx0XHRjbGllbnRZOiB0b3VjaC5jbGllbnRZXG5cdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdHRoaXMuX29uRHJhZ1N0YXJ0KHRhcEV2dCwgJ3RvdWNoJyk7XG5cdFx0XHRcdFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRfb24oZG9jdW1lbnQsICdtb3VzZXVwJywgdGhpcy5fb25Ecm9wKTtcblx0XHRcdFx0X29uKGRvY3VtZW50LCAndG91Y2hlbmQnLCB0aGlzLl9vbkRyb3ApO1xuXHRcdFx0XHRfb24oZG9jdW1lbnQsICd0b3VjaGNhbmNlbCcsIHRoaXMuX29uRHJvcCk7XG5cblx0XHRcdFx0X29uKGRyYWdFbCwgJ2RyYWdlbmQnLCB0aGlzKTtcblx0XHRcdFx0X29uKHJvb3RFbCwgJ2RyYWdzdGFydCcsIHRoaXMuX29uRHJhZ1N0YXJ0KTtcblxuXHRcdFx0XHRpZiAoIXN1cHBvcnREcmFnZ2FibGUpIHtcblx0XHRcdFx0XHR0aGlzLl9vbkRyYWdTdGFydCh0YXBFdnQsIHRydWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7XG5cdFx0XHRcdFx0XHRkb2N1bWVudC5zZWxlY3Rpb24uZW1wdHkoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0d2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0X2VtdWxhdGVEcmFnT3ZlcjogZnVuY3Rpb24gKCkge1xuXHRcdFx0aWYgKHRvdWNoRXZ0KSB7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuXG5cdFx0XHRcdHZhciB0YXJnZXQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KHRvdWNoRXZ0LmNsaWVudFgsIHRvdWNoRXZ0LmNsaWVudFkpLFxuXHRcdFx0XHRcdHBhcmVudCA9IHRhcmdldCxcblx0XHRcdFx0XHRncm91cE5hbWUgPSAnICcgKyB0aGlzLm9wdGlvbnMuZ3JvdXAubmFtZSArICcnLFxuXHRcdFx0XHRcdGkgPSB0b3VjaERyYWdPdmVyTGlzdGVuZXJzLmxlbmd0aDtcblxuXHRcdFx0XHRpZiAocGFyZW50KSB7XG5cdFx0XHRcdFx0ZG8ge1xuXHRcdFx0XHRcdFx0aWYgKHBhcmVudFtleHBhbmRvXSAmJiBwYXJlbnRbZXhwYW5kb10uZ3JvdXBzLmluZGV4T2YoZ3JvdXBOYW1lKSA+IC0xKSB7XG5cdFx0XHRcdFx0XHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdFx0XHRcdFx0XHR0b3VjaERyYWdPdmVyTGlzdGVuZXJzW2ldKHtcblx0XHRcdFx0XHRcdFx0XHRcdGNsaWVudFg6IHRvdWNoRXZ0LmNsaWVudFgsXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGllbnRZOiB0b3VjaEV2dC5jbGllbnRZLFxuXHRcdFx0XHRcdFx0XHRcdFx0dGFyZ2V0OiB0YXJnZXQsXG5cdFx0XHRcdFx0XHRcdFx0XHRyb290RWw6IHBhcmVudFxuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHRhcmdldCA9IHBhcmVudDsgLy8gc3RvcmUgbGFzdCBlbGVtZW50XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8qIGpzaGludCBib3NzOnRydWUgKi9cblx0XHRcdFx0XHR3aGlsZSAocGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0X2NzcyhnaG9zdEVsLCAnZGlzcGxheScsICcnKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cblx0XHRfb25Ub3VjaE1vdmU6IGZ1bmN0aW9uICgvKipUb3VjaEV2ZW50Ki9ldnQpIHtcblx0XHRcdGlmICh0YXBFdnQpIHtcblx0XHRcdFx0dmFyIHRvdWNoID0gZXZ0LnRvdWNoZXMgPyBldnQudG91Y2hlc1swXSA6IGV2dCxcblx0XHRcdFx0XHRkeCA9IHRvdWNoLmNsaWVudFggLSB0YXBFdnQuY2xpZW50WCxcblx0XHRcdFx0XHRkeSA9IHRvdWNoLmNsaWVudFkgLSB0YXBFdnQuY2xpZW50WSxcblx0XHRcdFx0XHR0cmFuc2xhdGUzZCA9IGV2dC50b3VjaGVzID8gJ3RyYW5zbGF0ZTNkKCcgKyBkeCArICdweCwnICsgZHkgKyAncHgsMCknIDogJ3RyYW5zbGF0ZSgnICsgZHggKyAncHgsJyArIGR5ICsgJ3B4KSc7XG5cblx0XHRcdFx0dG91Y2hFdnQgPSB0b3VjaDtcblxuXHRcdFx0XHRfY3NzKGdob3N0RWwsICd3ZWJraXRUcmFuc2Zvcm0nLCB0cmFuc2xhdGUzZCk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ21velRyYW5zZm9ybScsIHRyYW5zbGF0ZTNkKTtcblx0XHRcdFx0X2NzcyhnaG9zdEVsLCAnbXNUcmFuc2Zvcm0nLCB0cmFuc2xhdGUzZCk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ3RyYW5zZm9ybScsIHRyYW5zbGF0ZTNkKTtcblxuXHRcdFx0XHRldnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cblx0XHRfb25EcmFnU3RhcnQ6IGZ1bmN0aW9uICgvKipFdmVudCovZXZ0LCAvKipib29sZWFuKi91c2VGYWxsYmFjaykge1xuXHRcdFx0dmFyIGRhdGFUcmFuc2ZlciA9IGV2dC5kYXRhVHJhbnNmZXIsXG5cdFx0XHRcdG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG5cblx0XHRcdHRoaXMuX29mZlVwRXZlbnRzKCk7XG5cblx0XHRcdGlmIChhY3RpdmVHcm91cC5wdWxsID09ICdjbG9uZScpIHtcblx0XHRcdFx0Y2xvbmVFbCA9IGRyYWdFbC5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0XHRcdF9jc3MoY2xvbmVFbCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuXHRcdFx0XHRyb290RWwuaW5zZXJ0QmVmb3JlKGNsb25lRWwsIGRyYWdFbCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh1c2VGYWxsYmFjaykge1xuXHRcdFx0XHR2YXIgcmVjdCA9IGRyYWdFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcblx0XHRcdFx0XHRjc3MgPSBfY3NzKGRyYWdFbCksXG5cdFx0XHRcdFx0Z2hvc3RSZWN0O1xuXG5cdFx0XHRcdGdob3N0RWwgPSBkcmFnRWwuY2xvbmVOb2RlKHRydWUpO1xuXG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ3RvcCcsIHJlY3QudG9wIC0gcGFyc2VJbnQoY3NzLm1hcmdpblRvcCwgMTApKTtcblx0XHRcdFx0X2NzcyhnaG9zdEVsLCAnbGVmdCcsIHJlY3QubGVmdCAtIHBhcnNlSW50KGNzcy5tYXJnaW5MZWZ0LCAxMCkpO1xuXHRcdFx0XHRfY3NzKGdob3N0RWwsICd3aWR0aCcsIHJlY3Qud2lkdGgpO1xuXHRcdFx0XHRfY3NzKGdob3N0RWwsICdoZWlnaHQnLCByZWN0LmhlaWdodCk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ29wYWNpdHknLCAnMC44Jyk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ3Bvc2l0aW9uJywgJ2ZpeGVkJyk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ3pJbmRleCcsICcxMDAwMDAnKTtcblxuXHRcdFx0XHRyb290RWwuYXBwZW5kQ2hpbGQoZ2hvc3RFbCk7XG5cblx0XHRcdFx0Ly8gRml4aW5nIGRpbWVuc2lvbnMuXG5cdFx0XHRcdGdob3N0UmVjdCA9IGdob3N0RWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cdFx0XHRcdF9jc3MoZ2hvc3RFbCwgJ3dpZHRoJywgcmVjdC53aWR0aCAqIDIgLSBnaG9zdFJlY3Qud2lkdGgpO1xuXHRcdFx0XHRfY3NzKGdob3N0RWwsICdoZWlnaHQnLCByZWN0LmhlaWdodCAqIDIgLSBnaG9zdFJlY3QuaGVpZ2h0KTtcblxuXHRcdFx0XHRpZiAodXNlRmFsbGJhY2sgPT09ICd0b3VjaCcpIHtcblx0XHRcdFx0XHQvLyBCaW5kIHRvdWNoIGV2ZW50c1xuXHRcdFx0XHRcdF9vbihkb2N1bWVudCwgJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlKTtcblx0XHRcdFx0XHRfb24oZG9jdW1lbnQsICd0b3VjaGVuZCcsIHRoaXMuX29uRHJvcCk7XG5cdFx0XHRcdFx0X29uKGRvY3VtZW50LCAndG91Y2hjYW5jZWwnLCB0aGlzLl9vbkRyb3ApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIE9sZCBicndvc2VyXG5cdFx0XHRcdFx0X29uKGRvY3VtZW50LCAnbW91c2Vtb3ZlJywgdGhpcy5fb25Ub3VjaE1vdmUpO1xuXHRcdFx0XHRcdF9vbihkb2N1bWVudCwgJ21vdXNldXAnLCB0aGlzLl9vbkRyb3ApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5fbG9vcElkID0gc2V0SW50ZXJ2YWwodGhpcy5fZW11bGF0ZURyYWdPdmVyLCAxNTApO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGlmIChkYXRhVHJhbnNmZXIpIHtcblx0XHRcdFx0XHRkYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJztcblx0XHRcdFx0XHRvcHRpb25zLnNldERhdGEgJiYgb3B0aW9ucy5zZXREYXRhLmNhbGwodGhpcywgZGF0YVRyYW5zZmVyLCBkcmFnRWwpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0X29uKGRvY3VtZW50LCAnZHJvcCcsIHRoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRzZXRUaW1lb3V0KHRoaXMuX2RyYWdTdGFydGVkLCAwKTtcblx0XHR9LFxuXG5cdFx0X29uRHJhZ092ZXI6IGZ1bmN0aW9uICgvKipFdmVudCovZXZ0KSB7XG5cdFx0XHR2YXIgZWwgPSB0aGlzLmVsLFxuXHRcdFx0XHR0YXJnZXQsXG5cdFx0XHRcdGRyYWdSZWN0LFxuXHRcdFx0XHRyZXZlcnQsXG5cdFx0XHRcdG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsXG5cdFx0XHRcdGdyb3VwID0gb3B0aW9ucy5ncm91cCxcblx0XHRcdFx0Z3JvdXBQdXQgPSBncm91cC5wdXQsXG5cdFx0XHRcdGlzT3duZXIgPSAoYWN0aXZlR3JvdXAgPT09IGdyb3VwKSxcblx0XHRcdFx0Y2FuU29ydCA9IG9wdGlvbnMuc29ydDtcblxuXHRcdFx0aWYgKCFkcmFnRWwpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZXZ0LnByZXZlbnREZWZhdWx0ICE9PSB2b2lkIDApIHtcblx0XHRcdFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCFvcHRpb25zLmRyYWdvdmVyQnViYmxlICYmIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFjdGl2ZUdyb3VwICYmICFvcHRpb25zLmRpc2FibGVkICYmXG5cdFx0XHRcdChpc093bmVyXG5cdFx0XHRcdFx0PyBjYW5Tb3J0IHx8IChyZXZlcnQgPSAhcm9vdEVsLmNvbnRhaW5zKGRyYWdFbCkpXG5cdFx0XHRcdFx0OiBhY3RpdmVHcm91cC5wdWxsICYmIGdyb3VwUHV0ICYmIChcblx0XHRcdFx0XHRcdChhY3RpdmVHcm91cC5uYW1lID09PSBncm91cC5uYW1lKSB8fCAvLyBieSBOYW1lXG5cdFx0XHRcdFx0XHQoZ3JvdXBQdXQuaW5kZXhPZiAmJiB+Z3JvdXBQdXQuaW5kZXhPZihhY3RpdmVHcm91cC5uYW1lKSkgLy8gYnkgQXJyYXlcblx0XHRcdFx0XHQpXG5cdFx0XHRcdCkgJiZcblx0XHRcdFx0KGV2dC5yb290RWwgPT09IHZvaWQgMCB8fCBldnQucm9vdEVsID09PSB0aGlzLmVsKVxuXHRcdFx0KSB7XG5cdFx0XHRcdC8vIFNtYXJ0IGF1dG8tc2Nyb2xsaW5nXG5cdFx0XHRcdF9hdXRvU2Nyb2xsKGV2dCwgb3B0aW9ucywgdGhpcy5lbCk7XG5cblx0XHRcdFx0aWYgKF9zaWxlbnQpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0YXJnZXQgPSBfY2xvc2VzdChldnQudGFyZ2V0LCBvcHRpb25zLmRyYWdnYWJsZSwgZWwpO1xuXHRcdFx0XHRkcmFnUmVjdCA9IGRyYWdFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuXG5cdFx0XHRcdGlmIChyZXZlcnQpIHtcblx0XHRcdFx0XHRfY2xvbmVIaWRlKHRydWUpO1xuXG5cdFx0XHRcdFx0aWYgKGNsb25lRWwgfHwgbmV4dEVsKSB7XG5cdFx0XHRcdFx0XHRyb290RWwuaW5zZXJ0QmVmb3JlKGRyYWdFbCwgY2xvbmVFbCB8fCBuZXh0RWwpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRlbHNlIGlmICghY2FuU29ydCkge1xuXHRcdFx0XHRcdFx0cm9vdEVsLmFwcGVuZENoaWxkKGRyYWdFbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblxuXHRcdFx0XHRpZiAoKGVsLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgfHwgKGVsLmNoaWxkcmVuWzBdID09PSBnaG9zdEVsKSB8fFxuXHRcdFx0XHRcdChlbCA9PT0gZXZ0LnRhcmdldCkgJiYgKHRhcmdldCA9IF9naG9zdEluQm90dG9tKGVsLCBldnQpKVxuXHRcdFx0XHQpIHtcblx0XHRcdFx0XHRpZiAodGFyZ2V0KSB7XG5cdFx0XHRcdFx0XHRpZiAodGFyZ2V0LmFuaW1hdGVkKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHRhcmdldFJlY3QgPSB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0X2Nsb25lSGlkZShpc093bmVyKTtcblxuXHRcdFx0XHRcdGVsLmFwcGVuZENoaWxkKGRyYWdFbCk7XG5cdFx0XHRcdFx0dGhpcy5fYW5pbWF0ZShkcmFnUmVjdCwgZHJhZ0VsKTtcblx0XHRcdFx0XHR0YXJnZXQgJiYgdGhpcy5fYW5pbWF0ZSh0YXJnZXRSZWN0LCB0YXJnZXQpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2UgaWYgKHRhcmdldCAmJiAhdGFyZ2V0LmFuaW1hdGVkICYmIHRhcmdldCAhPT0gZHJhZ0VsICYmICh0YXJnZXQucGFyZW50Tm9kZVtleHBhbmRvXSAhPT0gdm9pZCAwKSkge1xuXHRcdFx0XHRcdGlmIChsYXN0RWwgIT09IHRhcmdldCkge1xuXHRcdFx0XHRcdFx0bGFzdEVsID0gdGFyZ2V0O1xuXHRcdFx0XHRcdFx0bGFzdENTUyA9IF9jc3ModGFyZ2V0KTtcblx0XHRcdFx0XHR9XG5cblxuXHRcdFx0XHRcdHZhciB0YXJnZXRSZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuXHRcdFx0XHRcdFx0d2lkdGggPSB0YXJnZXRSZWN0LnJpZ2h0IC0gdGFyZ2V0UmVjdC5sZWZ0LFxuXHRcdFx0XHRcdFx0aGVpZ2h0ID0gdGFyZ2V0UmVjdC5ib3R0b20gLSB0YXJnZXRSZWN0LnRvcCxcblx0XHRcdFx0XHRcdGZsb2F0aW5nID0gL2xlZnR8cmlnaHR8aW5saW5lLy50ZXN0KGxhc3RDU1MuY3NzRmxvYXQgKyBsYXN0Q1NTLmRpc3BsYXkpLFxuXHRcdFx0XHRcdFx0aXNXaWRlID0gKHRhcmdldC5vZmZzZXRXaWR0aCA+IGRyYWdFbC5vZmZzZXRXaWR0aCksXG5cdFx0XHRcdFx0XHRpc0xvbmcgPSAodGFyZ2V0Lm9mZnNldEhlaWdodCA+IGRyYWdFbC5vZmZzZXRIZWlnaHQpLFxuXHRcdFx0XHRcdFx0aGFsZndheSA9IChmbG9hdGluZyA/IChldnQuY2xpZW50WCAtIHRhcmdldFJlY3QubGVmdCkgLyB3aWR0aCA6IChldnQuY2xpZW50WSAtIHRhcmdldFJlY3QudG9wKSAvIGhlaWdodCkgPiAwLjUsXG5cdFx0XHRcdFx0XHRuZXh0U2libGluZyA9IHRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmcsXG5cdFx0XHRcdFx0XHRhZnRlclxuXHRcdFx0XHRcdDtcblxuXHRcdFx0XHRcdF9zaWxlbnQgPSB0cnVlO1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoX3Vuc2lsZW50LCAzMCk7XG5cblx0XHRcdFx0XHRfY2xvbmVIaWRlKGlzT3duZXIpO1xuXG5cdFx0XHRcdFx0aWYgKGZsb2F0aW5nKSB7XG5cdFx0XHRcdFx0XHRhZnRlciA9ICh0YXJnZXQucHJldmlvdXNFbGVtZW50U2libGluZyA9PT0gZHJhZ0VsKSAmJiAhaXNXaWRlIHx8IGhhbGZ3YXkgJiYgaXNXaWRlO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRhZnRlciA9IChuZXh0U2libGluZyAhPT0gZHJhZ0VsKSAmJiAhaXNMb25nIHx8IGhhbGZ3YXkgJiYgaXNMb25nO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChhZnRlciAmJiAhbmV4dFNpYmxpbmcpIHtcblx0XHRcdFx0XHRcdGVsLmFwcGVuZENoaWxkKGRyYWdFbCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHRhcmdldC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShkcmFnRWwsIGFmdGVyID8gbmV4dFNpYmxpbmcgOiB0YXJnZXQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHRoaXMuX2FuaW1hdGUoZHJhZ1JlY3QsIGRyYWdFbCk7XG5cdFx0XHRcdFx0dGhpcy5fYW5pbWF0ZSh0YXJnZXRSZWN0LCB0YXJnZXQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdF9hbmltYXRlOiBmdW5jdGlvbiAocHJldlJlY3QsIHRhcmdldCkge1xuXHRcdFx0dmFyIG1zID0gdGhpcy5vcHRpb25zLmFuaW1hdGlvbjtcblxuXHRcdFx0aWYgKG1zKSB7XG5cdFx0XHRcdHZhciBjdXJyZW50UmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuXHRcdFx0XHRfY3NzKHRhcmdldCwgJ3RyYW5zaXRpb24nLCAnbm9uZScpO1xuXHRcdFx0XHRfY3NzKHRhcmdldCwgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUzZCgnXG5cdFx0XHRcdFx0KyAocHJldlJlY3QubGVmdCAtIGN1cnJlbnRSZWN0LmxlZnQpICsgJ3B4LCdcblx0XHRcdFx0XHQrIChwcmV2UmVjdC50b3AgLSBjdXJyZW50UmVjdC50b3ApICsgJ3B4LDApJ1xuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdHRhcmdldC5vZmZzZXRXaWR0aDsgLy8gcmVwYWludFxuXG5cdFx0XHRcdF9jc3ModGFyZ2V0LCAndHJhbnNpdGlvbicsICdhbGwgJyArIG1zICsgJ21zJyk7XG5cdFx0XHRcdF9jc3ModGFyZ2V0LCAndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZTNkKDAsMCwwKScpO1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dCh0YXJnZXQuYW5pbWF0ZWQpO1xuXHRcdFx0XHR0YXJnZXQuYW5pbWF0ZWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRfY3NzKHRhcmdldCwgJ3RyYW5zaXRpb24nLCAnJyk7XG5cdFx0XHRcdFx0X2Nzcyh0YXJnZXQsICd0cmFuc2Zvcm0nLCAnJyk7XG5cdFx0XHRcdFx0dGFyZ2V0LmFuaW1hdGVkID0gZmFsc2U7XG5cdFx0XHRcdH0sIG1zKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0X29mZlVwRXZlbnRzOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRfb2ZmKGRvY3VtZW50LCAnbW91c2V1cCcsIHRoaXMuX29uRHJvcCk7XG5cdFx0XHRfb2ZmKGRvY3VtZW50LCAndG91Y2htb3ZlJywgdGhpcy5fb25Ub3VjaE1vdmUpO1xuXHRcdFx0X29mZihkb2N1bWVudCwgJ3RvdWNoZW5kJywgdGhpcy5fb25Ecm9wKTtcblx0XHRcdF9vZmYoZG9jdW1lbnQsICd0b3VjaGNhbmNlbCcsIHRoaXMuX29uRHJvcCk7XG5cdFx0fSxcblxuXHRcdF9vbkRyb3A6IGZ1bmN0aW9uICgvKipFdmVudCovZXZ0KSB7XG5cdFx0XHR2YXIgZWwgPSB0aGlzLmVsLFxuXHRcdFx0XHRvcHRpb25zID0gdGhpcy5vcHRpb25zO1xuXG5cdFx0XHRjbGVhckludGVydmFsKHRoaXMuX2xvb3BJZCk7XG5cdFx0XHRjbGVhckludGVydmFsKGF1dG9TY3JvbGwucGlkKTtcblxuXHRcdFx0Ly8gVW5iaW5kIGV2ZW50c1xuXHRcdFx0X29mZihkb2N1bWVudCwgJ2Ryb3AnLCB0aGlzKTtcblx0XHRcdF9vZmYoZG9jdW1lbnQsICdtb3VzZW1vdmUnLCB0aGlzLl9vblRvdWNoTW92ZSk7XG5cdFx0XHRfb2ZmKGVsLCAnZHJhZ3N0YXJ0JywgdGhpcy5fb25EcmFnU3RhcnQpO1xuXG5cdFx0XHR0aGlzLl9vZmZVcEV2ZW50cygpO1xuXG5cdFx0XHRpZiAoZXZ0KSB7XG5cdFx0XHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHQhb3B0aW9ucy5kcm9wQnViYmxlICYmIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcblxuXHRcdFx0XHRnaG9zdEVsICYmIGdob3N0RWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChnaG9zdEVsKTtcblxuXHRcdFx0XHRpZiAoZHJhZ0VsKSB7XG5cdFx0XHRcdFx0X29mZihkcmFnRWwsICdkcmFnZW5kJywgdGhpcyk7XG5cblx0XHRcdFx0XHRfZGlzYWJsZURyYWdnYWJsZShkcmFnRWwpO1xuXHRcdFx0XHRcdF90b2dnbGVDbGFzcyhkcmFnRWwsIHRoaXMub3B0aW9ucy5naG9zdENsYXNzLCBmYWxzZSk7XG5cblx0XHRcdFx0XHRpZiAocm9vdEVsICE9PSBkcmFnRWwucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdFx0bmV3SW5kZXggPSBfaW5kZXgoZHJhZ0VsKTtcblxuXHRcdFx0XHRcdFx0Ly8gZHJhZyBmcm9tIG9uZSBsaXN0IGFuZCBkcm9wIGludG8gYW5vdGhlclxuXHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQoZHJhZ0VsLnBhcmVudE5vZGUsICdzb3J0JywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cdFx0XHRcdFx0XHRfZGlzcGF0Y2hFdmVudChyb290RWwsICdzb3J0JywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cblx0XHRcdFx0XHRcdC8vIEFkZCBldmVudFxuXHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQoZHJhZ0VsLCAnYWRkJywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cblx0XHRcdFx0XHRcdC8vIFJlbW92ZSBldmVudFxuXHRcdFx0XHRcdFx0X2Rpc3BhdGNoRXZlbnQocm9vdEVsLCAncmVtb3ZlJywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIGNsb25lXG5cdFx0XHRcdFx0XHRjbG9uZUVsICYmIGNsb25lRWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjbG9uZUVsKTtcblxuXHRcdFx0XHRcdFx0aWYgKGRyYWdFbC5uZXh0U2libGluZyAhPT0gbmV4dEVsKSB7XG5cdFx0XHRcdFx0XHRcdC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRyYWdnZWQgZWxlbWVudCB3aXRoaW4gaXRzIHBhcmVudFxuXHRcdFx0XHRcdFx0XHRuZXdJbmRleCA9IF9pbmRleChkcmFnRWwpO1xuXG5cdFx0XHRcdFx0XHRcdC8vIGRyYWcgJiBkcm9wIHdpdGhpbiB0aGUgc2FtZSBsaXN0XG5cdFx0XHRcdFx0XHRcdF9kaXNwYXRjaEV2ZW50KHJvb3RFbCwgJ3VwZGF0ZScsIGRyYWdFbCwgcm9vdEVsLCBvbGRJbmRleCwgbmV3SW5kZXgpO1xuXHRcdFx0XHRcdFx0XHRfZGlzcGF0Y2hFdmVudChyb290RWwsICdzb3J0JywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gRHJhZyBlbmQgZXZlbnRcblx0XHRcdFx0XHRTb3J0YWJsZS5hY3RpdmUgJiYgX2Rpc3BhdGNoRXZlbnQocm9vdEVsLCAnZW5kJywgZHJhZ0VsLCByb290RWwsIG9sZEluZGV4LCBuZXdJbmRleCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBOdWxsaW5nXG5cdFx0XHRcdHJvb3RFbCA9XG5cdFx0XHRcdGRyYWdFbCA9XG5cdFx0XHRcdGdob3N0RWwgPVxuXHRcdFx0XHRuZXh0RWwgPVxuXHRcdFx0XHRjbG9uZUVsID1cblxuXHRcdFx0XHRzY3JvbGxFbCA9XG5cdFx0XHRcdHNjcm9sbFBhcmVudEVsID1cblxuXHRcdFx0XHR0YXBFdnQgPVxuXHRcdFx0XHR0b3VjaEV2dCA9XG5cblx0XHRcdFx0bGFzdEVsID1cblx0XHRcdFx0bGFzdENTUyA9XG5cblx0XHRcdFx0YWN0aXZlR3JvdXAgPVxuXHRcdFx0XHRTb3J0YWJsZS5hY3RpdmUgPSBudWxsO1xuXG5cdFx0XHRcdC8vIFNhdmUgc29ydGluZ1xuXHRcdFx0XHR0aGlzLnNhdmUoKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cblx0XHRoYW5kbGVFdmVudDogZnVuY3Rpb24gKC8qKkV2ZW50Ki9ldnQpIHtcblx0XHRcdHZhciB0eXBlID0gZXZ0LnR5cGU7XG5cblx0XHRcdGlmICh0eXBlID09PSAnZHJhZ292ZXInIHx8IHR5cGUgPT09ICdkcmFnZW50ZXInKSB7XG5cdFx0XHRcdHRoaXMuX29uRHJhZ092ZXIoZXZ0KTtcblx0XHRcdFx0X2dsb2JhbERyYWdPdmVyKGV2dCk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmICh0eXBlID09PSAnZHJvcCcgfHwgdHlwZSA9PT0gJ2RyYWdlbmQnKSB7XG5cdFx0XHRcdHRoaXMuX29uRHJvcChldnQpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblxuXHRcdC8qKlxuXHRcdCAqIFNlcmlhbGl6ZXMgdGhlIGl0ZW0gaW50byBhbiBhcnJheSBvZiBzdHJpbmcuXG5cdFx0ICogQHJldHVybnMge1N0cmluZ1tdfVxuXHRcdCAqL1xuXHRcdHRvQXJyYXk6IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBvcmRlciA9IFtdLFxuXHRcdFx0XHRlbCxcblx0XHRcdFx0Y2hpbGRyZW4gPSB0aGlzLmVsLmNoaWxkcmVuLFxuXHRcdFx0XHRpID0gMCxcblx0XHRcdFx0biA9IGNoaWxkcmVuLmxlbmd0aDtcblxuXHRcdFx0Zm9yICg7IGkgPCBuOyBpKyspIHtcblx0XHRcdFx0ZWwgPSBjaGlsZHJlbltpXTtcblx0XHRcdFx0aWYgKF9jbG9zZXN0KGVsLCB0aGlzLm9wdGlvbnMuZHJhZ2dhYmxlLCB0aGlzLmVsKSkge1xuXHRcdFx0XHRcdG9yZGVyLnB1c2goZWwuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJykgfHwgX2dlbmVyYXRlSWQoZWwpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3JkZXI7XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogU29ydHMgdGhlIGVsZW1lbnRzIGFjY29yZGluZyB0byB0aGUgYXJyYXkuXG5cdFx0ICogQHBhcmFtICB7U3RyaW5nW119ICBvcmRlciAgb3JkZXIgb2YgdGhlIGl0ZW1zXG5cdFx0ICovXG5cdFx0c29ydDogZnVuY3Rpb24gKG9yZGVyKSB7XG5cdFx0XHR2YXIgaXRlbXMgPSB7fSwgcm9vdEVsID0gdGhpcy5lbDtcblxuXHRcdFx0dGhpcy50b0FycmF5KCkuZm9yRWFjaChmdW5jdGlvbiAoaWQsIGkpIHtcblx0XHRcdFx0dmFyIGVsID0gcm9vdEVsLmNoaWxkcmVuW2ldO1xuXG5cdFx0XHRcdGlmIChfY2xvc2VzdChlbCwgdGhpcy5vcHRpb25zLmRyYWdnYWJsZSwgcm9vdEVsKSkge1xuXHRcdFx0XHRcdGl0ZW1zW2lkXSA9IGVsO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0aGlzKTtcblxuXHRcdFx0b3JkZXIuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcblx0XHRcdFx0aWYgKGl0ZW1zW2lkXSkge1xuXHRcdFx0XHRcdHJvb3RFbC5yZW1vdmVDaGlsZChpdGVtc1tpZF0pO1xuXHRcdFx0XHRcdHJvb3RFbC5hcHBlbmRDaGlsZChpdGVtc1tpZF0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cblx0XHQvKipcblx0XHQgKiBTYXZlIHRoZSBjdXJyZW50IHNvcnRpbmdcblx0XHQgKi9cblx0XHRzYXZlOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgc3RvcmUgPSB0aGlzLm9wdGlvbnMuc3RvcmU7XG5cdFx0XHRzdG9yZSAmJiBzdG9yZS5zZXQodGhpcyk7XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogRm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgc2V0LCBnZXQgdGhlIGZpcnN0IGVsZW1lbnQgdGhhdCBtYXRjaGVzIHRoZSBzZWxlY3RvciBieSB0ZXN0aW5nIHRoZSBlbGVtZW50IGl0c2VsZiBhbmQgdHJhdmVyc2luZyB1cCB0aHJvdWdoIGl0cyBhbmNlc3RvcnMgaW4gdGhlIERPTSB0cmVlLlxuXHRcdCAqIEBwYXJhbSAgIHtIVE1MRWxlbWVudH0gIGVsXG5cdFx0ICogQHBhcmFtICAge1N0cmluZ30gICAgICAgW3NlbGVjdG9yXSAgZGVmYXVsdDogYG9wdGlvbnMuZHJhZ2dhYmxlYFxuXHRcdCAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxudWxsfVxuXHRcdCAqL1xuXHRcdGNsb3Nlc3Q6IGZ1bmN0aW9uIChlbCwgc2VsZWN0b3IpIHtcblx0XHRcdHJldHVybiBfY2xvc2VzdChlbCwgc2VsZWN0b3IgfHwgdGhpcy5vcHRpb25zLmRyYWdnYWJsZSwgdGhpcy5lbCk7XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogU2V0L2dldCBvcHRpb25cblx0XHQgKiBAcGFyYW0gICB7c3RyaW5nfSBuYW1lXG5cdFx0ICogQHBhcmFtICAgeyp9ICAgICAgW3ZhbHVlXVxuXHRcdCAqIEByZXR1cm5zIHsqfVxuXHRcdCAqL1xuXHRcdG9wdGlvbjogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG5cdFx0XHR2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcblxuXHRcdFx0aWYgKHZhbHVlID09PSB2b2lkIDApIHtcblx0XHRcdFx0cmV0dXJuIG9wdGlvbnNbbmFtZV07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRvcHRpb25zW25hbWVdID0gdmFsdWU7XG5cdFx0XHR9XG5cdFx0fSxcblxuXG5cdFx0LyoqXG5cdFx0ICogRGVzdHJveVxuXHRcdCAqL1xuXHRcdGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBlbCA9IHRoaXMuZWwsIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG5cblx0XHRcdF9jdXN0b21FdmVudHMuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkge1xuXHRcdFx0XHRfb2ZmKGVsLCBuYW1lLnN1YnN0cigyKS50b0xvd2VyQ2FzZSgpLCBvcHRpb25zW25hbWVdKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRfb2ZmKGVsLCAnbW91c2Vkb3duJywgdGhpcy5fb25UYXBTdGFydCk7XG5cdFx0XHRfb2ZmKGVsLCAndG91Y2hzdGFydCcsIHRoaXMuX29uVGFwU3RhcnQpO1xuXG5cdFx0XHRfb2ZmKGVsLCAnZHJhZ292ZXInLCB0aGlzKTtcblx0XHRcdF9vZmYoZWwsICdkcmFnZW50ZXInLCB0aGlzKTtcblxuXHRcdFx0Ly9yZW1vdmUgZHJhZ2dhYmxlIGF0dHJpYnV0ZXNcblx0XHRcdEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoZWwucXVlcnlTZWxlY3RvckFsbCgnW2RyYWdnYWJsZV0nKSwgZnVuY3Rpb24gKGVsKSB7XG5cdFx0XHRcdGVsLnJlbW92ZUF0dHJpYnV0ZSgnZHJhZ2dhYmxlJyk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dG91Y2hEcmFnT3Zlckxpc3RlbmVycy5zcGxpY2UodG91Y2hEcmFnT3Zlckxpc3RlbmVycy5pbmRleE9mKHRoaXMuX29uRHJhZ092ZXIpLCAxKTtcblxuXHRcdFx0dGhpcy5fb25Ecm9wKCk7XG5cblx0XHRcdHRoaXMuZWwgPSBudWxsO1xuXHRcdH1cblx0fTtcblxuXG5cdGZ1bmN0aW9uIF9jbG9uZUhpZGUoc3RhdGUpIHtcblx0XHRpZiAoY2xvbmVFbCAmJiAoY2xvbmVFbC5zdGF0ZSAhPT0gc3RhdGUpKSB7XG5cdFx0XHRfY3NzKGNsb25lRWwsICdkaXNwbGF5Jywgc3RhdGUgPyAnbm9uZScgOiAnJyk7XG5cdFx0XHQhc3RhdGUgJiYgY2xvbmVFbC5zdGF0ZSAmJiByb290RWwuaW5zZXJ0QmVmb3JlKGNsb25lRWwsIGRyYWdFbCk7XG5cdFx0XHRjbG9uZUVsLnN0YXRlID0gc3RhdGU7XG5cdFx0fVxuXHR9XG5cblxuXHRmdW5jdGlvbiBfYmluZChjdHgsIGZuKSB7XG5cdFx0dmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG5cdFx0cmV0dXJuXHRmbi5iaW5kID8gZm4uYmluZC5hcHBseShmbiwgW2N0eF0uY29uY2F0KGFyZ3MpKSA6IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmbi5hcHBseShjdHgsIGFyZ3MuY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzKSkpO1xuXHRcdH07XG5cdH1cblxuXG5cdGZ1bmN0aW9uIF9jbG9zZXN0KC8qKkhUTUxFbGVtZW50Ki9lbCwgLyoqU3RyaW5nKi9zZWxlY3RvciwgLyoqSFRNTEVsZW1lbnQqL2N0eCkge1xuXHRcdGlmIChlbCkge1xuXHRcdFx0Y3R4ID0gY3R4IHx8IGRvY3VtZW50O1xuXHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zcGxpdCgnLicpO1xuXG5cdFx0XHR2YXIgdGFnID0gc2VsZWN0b3Iuc2hpZnQoKS50b1VwcGVyQ2FzZSgpLFxuXHRcdFx0XHRyZSA9IG5ldyBSZWdFeHAoJ1xcXFxzKCcgKyBzZWxlY3Rvci5qb2luKCd8JykgKyAnKVxcXFxzJywgJ2cnKTtcblxuXHRcdFx0ZG8ge1xuXHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0KHRhZyA9PT0gJz4qJyAmJiBlbC5wYXJlbnROb2RlID09PSBjdHgpIHx8IChcblx0XHRcdFx0XHRcdCh0YWcgPT09ICcnIHx8IGVsLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT0gdGFnKSAmJlxuXHRcdFx0XHRcdFx0KCFzZWxlY3Rvci5sZW5ndGggfHwgKCgnICcgKyBlbC5jbGFzc05hbWUgKyAnICcpLm1hdGNoKHJlKSB8fCBbXSkubGVuZ3RoID09IHNlbGVjdG9yLmxlbmd0aClcblx0XHRcdFx0XHQpXG5cdFx0XHRcdCkge1xuXHRcdFx0XHRcdHJldHVybiBlbDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0d2hpbGUgKGVsICE9PSBjdHggJiYgKGVsID0gZWwucGFyZW50Tm9kZSkpO1xuXHRcdH1cblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblxuXHRmdW5jdGlvbiBfZ2xvYmFsRHJhZ092ZXIoLyoqRXZlbnQqL2V2dCkge1xuXHRcdGV2dC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICdtb3ZlJztcblx0XHRldnQucHJldmVudERlZmF1bHQoKTtcblx0fVxuXG5cblx0ZnVuY3Rpb24gX29uKGVsLCBldmVudCwgZm4pIHtcblx0XHRlbC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBmbiwgZmFsc2UpO1xuXHR9XG5cblxuXHRmdW5jdGlvbiBfb2ZmKGVsLCBldmVudCwgZm4pIHtcblx0XHRlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBmbiwgZmFsc2UpO1xuXHR9XG5cblxuXHRmdW5jdGlvbiBfdG9nZ2xlQ2xhc3MoZWwsIG5hbWUsIHN0YXRlKSB7XG5cdFx0aWYgKGVsKSB7XG5cdFx0XHRpZiAoZWwuY2xhc3NMaXN0KSB7XG5cdFx0XHRcdGVsLmNsYXNzTGlzdFtzdGF0ZSA/ICdhZGQnIDogJ3JlbW92ZSddKG5hbWUpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHZhciBjbGFzc05hbWUgPSAoJyAnICsgZWwuY2xhc3NOYW1lICsgJyAnKS5yZXBsYWNlKC9cXHMrL2csICcgJykucmVwbGFjZSgnICcgKyBuYW1lICsgJyAnLCAnJyk7XG5cdFx0XHRcdGVsLmNsYXNzTmFtZSA9IGNsYXNzTmFtZSArIChzdGF0ZSA/ICcgJyArIG5hbWUgOiAnJyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblxuXHRmdW5jdGlvbiBfY3NzKGVsLCBwcm9wLCB2YWwpIHtcblx0XHR2YXIgc3R5bGUgPSBlbCAmJiBlbC5zdHlsZTtcblxuXHRcdGlmIChzdHlsZSkge1xuXHRcdFx0aWYgKHZhbCA9PT0gdm9pZCAwKSB7XG5cdFx0XHRcdGlmIChkb2N1bWVudC5kZWZhdWx0VmlldyAmJiBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKSB7XG5cdFx0XHRcdFx0dmFsID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbCwgJycpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2UgaWYgKGVsLmN1cnJlbnRTdHlsZSkge1xuXHRcdFx0XHRcdHZhbCA9IGVsLmN1cnJlbnRTdHlsZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBwcm9wID09PSB2b2lkIDAgPyB2YWwgOiB2YWxbcHJvcF07XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0aWYgKCEocHJvcCBpbiBzdHlsZSkpIHtcblx0XHRcdFx0XHRwcm9wID0gJy13ZWJraXQtJyArIHByb3A7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzdHlsZVtwcm9wXSA9IHZhbCArICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJyA/ICcnIDogJ3B4Jyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblxuXHRmdW5jdGlvbiBfZmluZChjdHgsIHRhZ05hbWUsIGl0ZXJhdG9yKSB7XG5cdFx0aWYgKGN0eCkge1xuXHRcdFx0dmFyIGxpc3QgPSBjdHguZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnTmFtZSksIGkgPSAwLCBuID0gbGlzdC5sZW5ndGg7XG5cblx0XHRcdGlmIChpdGVyYXRvcikge1xuXHRcdFx0XHRmb3IgKDsgaSA8IG47IGkrKykge1xuXHRcdFx0XHRcdGl0ZXJhdG9yKGxpc3RbaV0sIGkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBsaXN0O1xuXHRcdH1cblxuXHRcdHJldHVybiBbXTtcblx0fVxuXG5cblx0ZnVuY3Rpb24gX2Rpc2FibGVEcmFnZ2FibGUoZWwpIHtcblx0XHRlbC5kcmFnZ2FibGUgPSBmYWxzZTtcblx0fVxuXG5cblx0ZnVuY3Rpb24gX3Vuc2lsZW50KCkge1xuXHRcdF9zaWxlbnQgPSBmYWxzZTtcblx0fVxuXG5cblx0LyoqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxmYWxzZX0gKi9cblx0ZnVuY3Rpb24gX2dob3N0SW5Cb3R0b20oZWwsIGV2dCkge1xuXHRcdHZhciBsYXN0RWwgPSBlbC5sYXN0RWxlbWVudENoaWxkLCByZWN0ID0gbGFzdEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcdHJldHVybiAoZXZ0LmNsaWVudFkgLSAocmVjdC50b3AgKyByZWN0LmhlaWdodCkgPiA1KSAmJiBsYXN0RWw7IC8vIG1pbiBkZWx0YVxuXHR9XG5cblxuXHQvKipcblx0ICogR2VuZXJhdGUgaWRcblx0ICogQHBhcmFtICAge0hUTUxFbGVtZW50fSBlbFxuXHQgKiBAcmV0dXJucyB7U3RyaW5nfVxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0ZnVuY3Rpb24gX2dlbmVyYXRlSWQoZWwpIHtcblx0XHR2YXIgc3RyID0gZWwudGFnTmFtZSArIGVsLmNsYXNzTmFtZSArIGVsLnNyYyArIGVsLmhyZWYgKyBlbC50ZXh0Q29udGVudCxcblx0XHRcdGkgPSBzdHIubGVuZ3RoLFxuXHRcdFx0c3VtID0gMDtcblxuXHRcdHdoaWxlIChpLS0pIHtcblx0XHRcdHN1bSArPSBzdHIuY2hhckNvZGVBdChpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc3VtLnRvU3RyaW5nKDM2KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBpbmRleCBvZiBhbiBlbGVtZW50IHdpdGhpbiBpdHMgcGFyZW50XG5cdCAqIEBwYXJhbSBlbFxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0ZnVuY3Rpb24gX2luZGV4KC8qKkhUTUxFbGVtZW50Ki9lbCkge1xuXHRcdHZhciBpbmRleCA9IDA7XG5cdFx0d2hpbGUgKGVsICYmIChlbCA9IGVsLnByZXZpb3VzRWxlbWVudFNpYmxpbmcpKSB7XG5cdFx0XHRpZiAoZWwubm9kZU5hbWUudG9VcHBlckNhc2UoKSAhPT0gJ1RFTVBMQVRFJykge1xuXHRcdFx0XHRpbmRleCsrO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gaW5kZXg7XG5cdH1cblxuXHRmdW5jdGlvbiBfdGhyb3R0bGUoY2FsbGJhY2ssIG1zKSB7XG5cdFx0dmFyIGFyZ3MsIF90aGlzO1xuXG5cdFx0cmV0dXJuIGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmIChhcmdzID09PSB2b2lkIDApIHtcblx0XHRcdFx0YXJncyA9IGFyZ3VtZW50cztcblx0XHRcdFx0X3RoaXMgPSB0aGlzO1xuXG5cdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmIChhcmdzLmxlbmd0aCA9PT0gMSkge1xuXHRcdFx0XHRcdFx0Y2FsbGJhY2suY2FsbChfdGhpcywgYXJnc1swXSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNhbGxiYWNrLmFwcGx5KF90aGlzLCBhcmdzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRhcmdzID0gdm9pZCAwO1xuXHRcdFx0XHR9LCBtcyk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuXG5cblx0Ly8gRXhwb3J0IHV0aWxzXG5cdFNvcnRhYmxlLnV0aWxzID0ge1xuXHRcdG9uOiBfb24sXG5cdFx0b2ZmOiBfb2ZmLFxuXHRcdGNzczogX2Nzcyxcblx0XHRmaW5kOiBfZmluZCxcblx0XHRiaW5kOiBfYmluZCxcblx0XHRpczogZnVuY3Rpb24gKGVsLCBzZWxlY3Rvcikge1xuXHRcdFx0cmV0dXJuICEhX2Nsb3Nlc3QoZWwsIHNlbGVjdG9yLCBlbCk7XG5cdFx0fSxcblx0XHR0aHJvdHRsZTogX3Rocm90dGxlLFxuXHRcdGNsb3Nlc3Q6IF9jbG9zZXN0LFxuXHRcdHRvZ2dsZUNsYXNzOiBfdG9nZ2xlQ2xhc3MsXG5cdFx0ZGlzcGF0Y2hFdmVudDogX2Rpc3BhdGNoRXZlbnQsXG5cdFx0aW5kZXg6IF9pbmRleFxuXHR9O1xuXG5cblx0U29ydGFibGUudmVyc2lvbiA9ICcxLjEuMSc7XG5cblxuXHQvKipcblx0ICogQ3JlYXRlIHNvcnRhYmxlIGluc3RhbmNlXG5cdCAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9ICBlbFxuXHQgKiBAcGFyYW0ge09iamVjdH0gICAgICBbb3B0aW9uc11cblx0ICovXG5cdFNvcnRhYmxlLmNyZWF0ZSA9IGZ1bmN0aW9uIChlbCwgb3B0aW9ucykge1xuXHRcdHJldHVybiBuZXcgU29ydGFibGUoZWwsIG9wdGlvbnMpO1xuXHR9O1xuXG5cdC8vIEV4cG9ydFxuXHRyZXR1cm4gU29ydGFibGU7XG59KTtcbiJdfQ==
